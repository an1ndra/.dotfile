var gy=(_,F,H)=>{if(!F.has(_))throw TypeError("Cannot "+H)};var Ms=(_,F,H)=>(gy(_,F,"read from private field"),H?H.call(_):F.get(_)),wh=(_,F,H)=>{if(F.has(_))throw TypeError("Cannot add the same private member more than once");F instanceof WeakSet?F.add(_):F.set(_,H)},rl=(_,F,H,$)=>(gy(_,F,"write to private field"),$?$.call(_,H):F.set(_,H),H);(()=>{var __webpack_modules__={879:(_,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.ByteStream=void 0;class H{constructor(W){this.bytes=W,this.byteIndexCurrent=0}hasMoreBytes(){return this.byteIndexCurrent<this.bytes.length}readBytes(W){const ne=this.byteIndexCurrent;return this.byteIndexCurrent+=W,this.bytes.slice(ne,this.byteIndexCurrent)}readByte(){let W=this.bytes[this.byteIndexCurrent];return this.byteIndexCurrent++,W}readString(W){let ne="";for(let re=0;re<W;re++){const se=this.readByte();se!=0&&(ne+=String.fromCharCode(se))}return ne}}F.ByteStream=H},7106:(_,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.ChunkSize=F.HeaderSizeInBytes=F.FileNameMaxLength=void 0,F.FileNameMaxLength=99,F.HeaderSizeInBytes=500,F.ChunkSize=512},5759:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.TarFile=void 0;const $=H(879),W=H(7106),ne=H(4108),re=H(3335);class se{constructor(z){this.entries=z}static fromBytes(z){const U=new $.ByteStream(z),L=[],G=W.ChunkSize;let le=0;for(;U.hasMoreBytes()==!0;){const X=U.readBytes(G);let Ge=!0;for(let Qe=0;Qe<X.length;Qe++)if(X[Qe]!=0){Ge=!1;break}if(Ge==!0){if(le++,le==2)break}else{le=0;const Qe=ne.TarFileEntry.fromBytes(X,U);L.push(Qe)}}let k=new se(L);return k.consolidateLongPathEntries(),k}consolidateLongPathEntries(){var z;const U=re.TarFileTypeFlag.Instances().LongFilePath.name,L=this.entries;for(let G=0;G<L.length;G++){const le=L[G];if(((z=le.header.typeFlag)===null||z===void 0?void 0:z.name)==U){const k=L[G+1];k.header.fileName=le.dataAsBytes.reduce((X,Ge)=>X+=String.fromCharCode(Ge),""),k.header.fileName=k.header.fileName.replace(/\0/g,""),L.splice(G,1),G--}}}}F.TarFile=se},4108:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.TarFileEntry=void 0;const $=H(7106),W=H(2895);class ne{constructor(se,oe){this.header=se,this.dataAsBytes=oe}static fromBytes(se,oe){const z=$.ChunkSize,U=W.TarFileEntryHeader.fromBytes(se),L=U.fileSizeInBytes,le=Math.ceil(L/z)*z,k=oe.readBytes(le).slice(0,L);return new ne(U,k)}}F.TarFileEntry=ne},2895:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.TarFileEntryHeader=void 0;const $=H(879),W=H(3335);class ne{constructor(se,oe,z,U,L,G,le,k,X,Ge,Qe,rt,ye,_e,be,ae){this.fileName=se,this.fileMode=oe,this.userIDOfOwner=z,this.userIDOfGroup=U,this.fileSizeInBytes=L,this.timeModifiedInUnixFormat=G,this.checksum=le,this.typeFlag=k,this.nameOfLinkedFile=X,this.uStarIndicator=Ge,this.uStarVersion=Qe,this.userNameOfOwner=rt,this.groupNameOfOwner=ye,this.deviceNumberMajor=_e,this.deviceNumberMinor=be,this.filenamePrefix=ae,this.fullFileName=ae.length?ae.endsWith("/")?ae+se:ae+"/"+se:se}static fromBytes(se){const oe=new $.ByteStream(se),z=oe.readString(100).trim(),U=oe.readString(8),L=oe.readString(8),G=oe.readString(8),le=oe.readString(12),k=oe.readBytes(12),X=oe.readString(8),Ge=oe.readString(1),Qe=oe.readString(100),rt=oe.readString(6),ye=oe.readString(2),_e=oe.readString(32),be=oe.readString(32),ae=oe.readString(8),ue=oe.readString(8),we=oe.readString(155),Re=oe.readBytes(12),Ee=parseInt(le.trim(),8),Ie=parseInt(X,8),Fe=W.TarFileTypeFlag.Instances()._All,Ve="_"+Ge,it=Fe[Ve];return new ne(z,U,L,G,Ee,k,Ie,it,Qe,rt,ye,_e,be,ae,ue,we)}}F.TarFileEntryHeader=ne},3335:(_,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.TarFileTypeFlag=void 0;class H{constructor(ne,re){this.value=ne,this.id="_"+this.value,this.name=re}static Instances(){return H._instances==null&&(H._instances=new $),H._instances}}F.TarFileTypeFlag=H;class ${constructor(){this.Normal=new H("0","Normal"),this.HardLink=new H("1","Hard Link"),this.SymbolicLink=new H("2","Symbolic Link"),this.CharacterSpecial=new H("3","Character Special"),this.BlockSpecial=new H("4","Block Special"),this.Directory=new H("5","Directory"),this.FIFO=new H("6","FIFO"),this.ContiguousFile=new H("7","Contiguous File"),this.LongFilePath=new H("L","././@LongLink"),this._All=[this.Normal,this.HardLink,this.SymbolicLink,this.CharacterSpecial,this.BlockSpecial,this.Directory,this.FIFO,this.ContiguousFile,this.LongFilePath];for(let ne=0;ne<this._All.length;ne++){const re=this._All[ne];this._All[re.id]=re}}}},5790:(_,F,H)=>{"use strict";var $;$={value:!0},F.t9=$=$=$=void 0;const W=H(5759);$={enumerable:!0,get:function(){return W.TarFile}};const ne=H(4108);$={enumerable:!0,get:function(){return ne.TarFileEntry}};const re=H(2895);$={enumerable:!0,get:function(){return re.TarFileEntryHeader}},F.t9=se=>W.TarFile.fromBytes(se)},5186:(_,F,H)=>{var $=H(3698),W=H(2505),ne=H(6417),re=Function.bind,se=re.bind(re);function oe(le,k,X){var Ge=se(ne,null).apply(null,X?[k,X]:[k]);le.api={remove:Ge},le.remove=Ge,["before","error","after","wrap"].forEach(function(Qe){var rt=X?[k,Qe,X]:[k,Qe];le[Qe]=le.api[Qe]=se(W,null).apply(null,rt)})}function z(){var le="h",k={registry:{}},X=$.bind(null,k,le);return oe(X,k,le),X}function U(){var le={registry:{}},k=$.bind(null,le);return oe(k,le),k}var L=!1;function G(){return L||(console.warn('[before-after-hook]: "Hook()" repurposing warning, use "Hook.Collection()". Read more: https://git.io/upgrade-before-after-hook-to-1.4'),L=!0),U()}G.Singular=z.bind(),G.Collection=U.bind(),_.exports=G,_.exports.Hook=G,_.exports.Singular=G.Singular,_.exports.Collection=G.Collection},2505:_=>{_.exports=F;function F(H,$,W,ne){var re=ne;H.registry[W]||(H.registry[W]=[]),$==="before"&&(ne=function(se,oe){return Promise.resolve().then(re.bind(null,oe)).then(se.bind(null,oe))}),$==="after"&&(ne=function(se,oe){var z;return Promise.resolve().then(se.bind(null,oe)).then(function(U){return z=U,re(z,oe)}).then(function(){return z})}),$==="error"&&(ne=function(se,oe){return Promise.resolve().then(se.bind(null,oe)).catch(function(z){return re(z,oe)})}),H.registry[W].push({hook:ne,orig:re})}},3698:_=>{_.exports=F;function F(H,$,W,ne){if(typeof W!="function")throw new Error("method for before hook must be a function");return ne||(ne={}),Array.isArray($)?$.reverse().reduce(function(re,se){return F.bind(null,H,se,re,ne)},W)():Promise.resolve().then(function(){return H.registry[$]?H.registry[$].reduce(function(re,se){return se.hook.bind(null,re,ne)},W)():W(ne)})}},6417:_=>{_.exports=F;function F(H,$,W){if(!!H.registry[$]){var ne=H.registry[$].map(function(re){return re.orig}).indexOf(W);ne!==-1&&H.registry[$].splice(ne,1)}}},6744:(_,F,H)=>{"use strict";const $=H(3349),W=H(7529),ne=H(8050),re=H(4339),se=(oe,z={})=>{let U=[];if(Array.isArray(oe))for(let L of oe){let G=se.create(L,z);Array.isArray(G)?U.push(...G):U.push(G)}else U=[].concat(se.create(oe,z));return z&&z.expand===!0&&z.nodupes===!0&&(U=[...new Set(U)]),U};se.parse=(oe,z={})=>re(oe,z),se.stringify=(oe,z={})=>$(typeof oe=="string"?se.parse(oe,z):oe,z),se.compile=(oe,z={})=>(typeof oe=="string"&&(oe=se.parse(oe,z)),W(oe,z)),se.expand=(oe,z={})=>{typeof oe=="string"&&(oe=se.parse(oe,z));let U=ne(oe,z);return z.noempty===!0&&(U=U.filter(Boolean)),z.nodupes===!0&&(U=[...new Set(U)]),U},se.create=(oe,z={})=>oe===""||oe.length<3?[oe]:z.expand!==!0?se.compile(oe,z):se.expand(oe,z),_.exports=se},7529:(_,F,H)=>{"use strict";const $=H(2664),W=H(3083),ne=(re,se={})=>{let oe=(z,U={})=>{let L=W.isInvalidBrace(U),G=z.invalid===!0&&se.escapeInvalid===!0,le=L===!0||G===!0,k=se.escapeInvalid===!0?"\\":"",X="";if(z.isOpen===!0||z.isClose===!0)return k+z.value;if(z.type==="open")return le?k+z.value:"(";if(z.type==="close")return le?k+z.value:")";if(z.type==="comma")return z.prev.type==="comma"?"":le?z.value:"|";if(z.value)return z.value;if(z.nodes&&z.ranges>0){let Ge=W.reduce(z.nodes),Qe=$(...Ge,{...se,wrap:!1,toRegex:!0});if(Qe.length!==0)return Ge.length>1&&Qe.length>1?`(${Qe})`:Qe}if(z.nodes)for(let Ge of z.nodes)X+=oe(Ge,z);return X};return oe(re)};_.exports=ne},6611:_=>{"use strict";_.exports={MAX_LENGTH:1024*64,CHAR_0:"0",CHAR_9:"9",CHAR_UPPERCASE_A:"A",CHAR_LOWERCASE_A:"a",CHAR_UPPERCASE_Z:"Z",CHAR_LOWERCASE_Z:"z",CHAR_LEFT_PARENTHESES:"(",CHAR_RIGHT_PARENTHESES:")",CHAR_ASTERISK:"*",CHAR_AMPERSAND:"&",CHAR_AT:"@",CHAR_BACKSLASH:"\\",CHAR_BACKTICK:"`",CHAR_CARRIAGE_RETURN:"\r",CHAR_CIRCUMFLEX_ACCENT:"^",CHAR_COLON:":",CHAR_COMMA:",",CHAR_DOLLAR:"$",CHAR_DOT:".",CHAR_DOUBLE_QUOTE:'"',CHAR_EQUAL:"=",CHAR_EXCLAMATION_MARK:"!",CHAR_FORM_FEED:"\f",CHAR_FORWARD_SLASH:"/",CHAR_HASH:"#",CHAR_HYPHEN_MINUS:"-",CHAR_LEFT_ANGLE_BRACKET:"<",CHAR_LEFT_CURLY_BRACE:"{",CHAR_LEFT_SQUARE_BRACKET:"[",CHAR_LINE_FEED:`
`,CHAR_NO_BREAK_SPACE:"\xA0",CHAR_PERCENT:"%",CHAR_PLUS:"+",CHAR_QUESTION_MARK:"?",CHAR_RIGHT_ANGLE_BRACKET:">",CHAR_RIGHT_CURLY_BRACE:"}",CHAR_RIGHT_SQUARE_BRACKET:"]",CHAR_SEMICOLON:";",CHAR_SINGLE_QUOTE:"'",CHAR_SPACE:" ",CHAR_TAB:"	",CHAR_UNDERSCORE:"_",CHAR_VERTICAL_LINE:"|",CHAR_ZERO_WIDTH_NOBREAK_SPACE:"\uFEFF"}},8050:(_,F,H)=>{"use strict";const $=H(2664),W=H(3349),ne=H(3083),re=(oe="",z="",U=!1)=>{let L=[];if(oe=[].concat(oe),z=[].concat(z),!z.length)return oe;if(!oe.length)return U?ne.flatten(z).map(G=>`{${G}}`):z;for(let G of oe)if(Array.isArray(G))for(let le of G)L.push(re(le,z,U));else for(let le of z)U===!0&&typeof le=="string"&&(le=`{${le}}`),L.push(Array.isArray(le)?re(G,le,U):G+le);return ne.flatten(L)},se=(oe,z={})=>{let U=z.rangeLimit===void 0?1e3:z.rangeLimit,L=(G,le={})=>{G.queue=[];let k=le,X=le.queue;for(;k.type!=="brace"&&k.type!=="root"&&k.parent;)k=k.parent,X=k.queue;if(G.invalid||G.dollar){X.push(re(X.pop(),W(G,z)));return}if(G.type==="brace"&&G.invalid!==!0&&G.nodes.length===2){X.push(re(X.pop(),["{}"]));return}if(G.nodes&&G.ranges>0){let ye=ne.reduce(G.nodes);if(ne.exceedsLimit(...ye,z.step,U))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let _e=$(...ye,z);_e.length===0&&(_e=W(G,z)),X.push(re(X.pop(),_e)),G.nodes=[];return}let Ge=ne.encloseBrace(G),Qe=G.queue,rt=G;for(;rt.type!=="brace"&&rt.type!=="root"&&rt.parent;)rt=rt.parent,Qe=rt.queue;for(let ye=0;ye<G.nodes.length;ye++){let _e=G.nodes[ye];if(_e.type==="comma"&&G.type==="brace"){ye===1&&Qe.push(""),Qe.push("");continue}if(_e.type==="close"){X.push(re(X.pop(),Qe,Ge));continue}if(_e.value&&_e.type!=="open"){Qe.push(re(Qe.pop(),_e.value));continue}_e.nodes&&L(_e,G)}return Qe};return ne.flatten(L(oe))};_.exports=se},4339:(_,F,H)=>{"use strict";const $=H(3349),{MAX_LENGTH:W,CHAR_BACKSLASH:ne,CHAR_BACKTICK:re,CHAR_COMMA:se,CHAR_DOT:oe,CHAR_LEFT_PARENTHESES:z,CHAR_RIGHT_PARENTHESES:U,CHAR_LEFT_CURLY_BRACE:L,CHAR_RIGHT_CURLY_BRACE:G,CHAR_LEFT_SQUARE_BRACKET:le,CHAR_RIGHT_SQUARE_BRACKET:k,CHAR_DOUBLE_QUOTE:X,CHAR_SINGLE_QUOTE:Ge,CHAR_NO_BREAK_SPACE:Qe,CHAR_ZERO_WIDTH_NOBREAK_SPACE:rt}=H(6611),ye=(_e,be={})=>{if(typeof _e!="string")throw new TypeError("Expected a string");let ae=be||{},ue=typeof ae.maxLength=="number"?Math.min(W,ae.maxLength):W;if(_e.length>ue)throw new SyntaxError(`Input length (${_e.length}), exceeds max characters (${ue})`);let we={type:"root",input:_e,nodes:[]},Re=[we],Ee=we,Ie=we,Fe=0,Ve=_e.length,it=0,lt=0,ve,je={};const Ke=()=>_e[it++],We=Ue=>{if(Ue.type==="text"&&Ie.type==="dot"&&(Ie.type="text"),Ie&&Ie.type==="text"&&Ue.type==="text"){Ie.value+=Ue.value;return}return Ee.nodes.push(Ue),Ue.parent=Ee,Ue.prev=Ie,Ie=Ue,Ue};for(We({type:"bos"});it<Ve;)if(Ee=Re[Re.length-1],ve=Ke(),!(ve===rt||ve===Qe)){if(ve===ne){We({type:"text",value:(be.keepEscaping?ve:"")+Ke()});continue}if(ve===k){We({type:"text",value:"\\"+ve});continue}if(ve===le){Fe++;let Ue=!0,ut;for(;it<Ve&&(ut=Ke());){if(ve+=ut,ut===le){Fe++;continue}if(ut===ne){ve+=Ke();continue}if(ut===k&&(Fe--,Fe===0))break}We({type:"text",value:ve});continue}if(ve===z){Ee=We({type:"paren",nodes:[]}),Re.push(Ee),We({type:"text",value:ve});continue}if(ve===U){if(Ee.type!=="paren"){We({type:"text",value:ve});continue}Ee=Re.pop(),We({type:"text",value:ve}),Ee=Re[Re.length-1];continue}if(ve===X||ve===Ge||ve===re){let Ue=ve,ut;for(be.keepQuotes!==!0&&(ve="");it<Ve&&(ut=Ke());){if(ut===ne){ve+=ut+Ke();continue}if(ut===Ue){be.keepQuotes===!0&&(ve+=ut);break}ve+=ut}We({type:"text",value:ve});continue}if(ve===L){lt++;let Ue=Ie.value&&Ie.value.slice(-1)==="$"||Ee.dollar===!0;Ee=We({type:"brace",open:!0,close:!1,dollar:Ue,depth:lt,commas:0,ranges:0,nodes:[]}),Re.push(Ee),We({type:"open",value:ve});continue}if(ve===G){if(Ee.type!=="brace"){We({type:"text",value:ve});continue}let Ue="close";Ee=Re.pop(),Ee.close=!0,We({type:Ue,value:ve}),lt--,Ee=Re[Re.length-1];continue}if(ve===se&&lt>0){if(Ee.ranges>0){Ee.ranges=0;let Ue=Ee.nodes.shift();Ee.nodes=[Ue,{type:"text",value:$(Ee)}]}We({type:"comma",value:ve}),Ee.commas++;continue}if(ve===oe&&lt>0&&Ee.commas===0){let Ue=Ee.nodes;if(lt===0||Ue.length===0){We({type:"text",value:ve});continue}if(Ie.type==="dot"){if(Ee.range=[],Ie.value+=ve,Ie.type="range",Ee.nodes.length!==3&&Ee.nodes.length!==5){Ee.invalid=!0,Ee.ranges=0,Ie.type="text";continue}Ee.ranges++,Ee.args=[];continue}if(Ie.type==="range"){Ue.pop();let ut=Ue[Ue.length-1];ut.value+=Ie.value+ve,Ie=ut,Ee.ranges--;continue}We({type:"dot",value:ve});continue}We({type:"text",value:ve})}do if(Ee=Re.pop(),Ee.type!=="root"){Ee.nodes.forEach(gt=>{gt.nodes||(gt.type==="open"&&(gt.isOpen=!0),gt.type==="close"&&(gt.isClose=!0),gt.nodes||(gt.type="text"),gt.invalid=!0)});let Ue=Re[Re.length-1],ut=Ue.nodes.indexOf(Ee);Ue.nodes.splice(ut,1,...Ee.nodes)}while(Re.length>0);return We({type:"eos"}),we};_.exports=ye},3349:(_,F,H)=>{"use strict";const $=H(3083);_.exports=(W,ne={})=>{let re=(se,oe={})=>{let z=ne.escapeInvalid&&$.isInvalidBrace(oe),U=se.invalid===!0&&ne.escapeInvalid===!0,L="";if(se.value)return(z||U)&&$.isOpenOrClose(se)?"\\"+se.value:se.value;if(se.value)return se.value;if(se.nodes)for(let G of se.nodes)L+=re(G);return L};return re(W)}},3083:(_,F)=>{"use strict";F.isInteger=H=>typeof H=="number"?Number.isInteger(H):typeof H=="string"&&H.trim()!==""?Number.isInteger(Number(H)):!1,F.find=(H,$)=>H.nodes.find(W=>W.type===$),F.exceedsLimit=(H,$,W=1,ne)=>ne===!1||!F.isInteger(H)||!F.isInteger($)?!1:(Number($)-Number(H))/Number(W)>=ne,F.escapeNode=(H,$=0,W)=>{let ne=H.nodes[$];!ne||(W&&ne.type===W||ne.type==="open"||ne.type==="close")&&ne.escaped!==!0&&(ne.value="\\"+ne.value,ne.escaped=!0)},F.encloseBrace=H=>H.type!=="brace"?!1:H.commas>>0+H.ranges>>0==0?(H.invalid=!0,!0):!1,F.isInvalidBrace=H=>H.type!=="brace"?!1:H.invalid===!0||H.dollar?!0:H.commas>>0+H.ranges>>0==0||H.open!==!0||H.close!==!0?(H.invalid=!0,!0):!1,F.isOpenOrClose=H=>H.type==="open"||H.type==="close"?!0:H.open===!0||H.close===!0,F.reduce=H=>H.reduce(($,W)=>(W.type==="text"&&$.push(W.value),W.type==="range"&&(W.type="text"),$),[]),F.flatten=(...H)=>{const $=[],W=ne=>{for(let re=0;re<ne.length;re++){let se=ne[re];Array.isArray(se)?W(se,$):se!==void 0&&$.push(se)}return $};return W(H),$}},5175:_=>{"use strict";function F(H){if(!/^data:/i.test(H))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');H=H.replace(/\r?\n/g,"");const $=H.indexOf(",");if($===-1||$<=4)throw new TypeError("malformed data: URI");const W=H.substring(5,$).split(";");let ne="",re=!1;const se=W[0]||"text/plain";let oe=se;for(let G=1;G<W.length;G++)W[G]==="base64"?re=!0:(oe+=`;${W[G]}`,W[G].indexOf("charset=")===0&&(ne=W[G].substring(8)));!W[0]&&!ne.length&&(oe+=";charset=US-ASCII",ne="US-ASCII");const z=re?"base64":"ascii",U=unescape(H.substring($+1)),L=Buffer.from(U,z);return L.type=se,L.typeFull=oe,L.charset=ne,L}_.exports=F},6724:()=>{},1:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";const Token=__webpack_require__(3416),strtok3=__webpack_require__(5849),{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=__webpack_require__(6188),supported=__webpack_require__(9898),minimumBytes=4100;async function fromStream(_){const F=await strtok3.fromStream(_);try{return await fromTokenizer(F)}finally{await F.close()}}async function fromBuffer(_){if(!(_ instanceof Uint8Array||_ instanceof ArrayBuffer||Buffer.isBuffer(_)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof _}\``);const F=_ instanceof Buffer?_:Buffer.from(_);if(!(F&&F.length>1))return;const H=strtok3.fromBuffer(F);return fromTokenizer(H)}function _check(_,F,H){H={offset:0,...H};for(const[$,W]of F.entries())if(H.mask){if(W!==(H.mask[$]&_[$+H.offset]))return!1}else if(W!==_[$+H.offset])return!1;return!0}async function fromTokenizer(_){try{return _fromTokenizer(_)}catch(F){if(!(F instanceof strtok3.EndOfStreamError))throw F}}async function _fromTokenizer(_){let F=Buffer.alloc(minimumBytes);const H=12,$=(ne,re)=>_check(F,ne,re),W=(ne,re)=>$(stringToBytes(ne),re);if(_.fileInfo.size||(_.fileInfo.size=Number.MAX_SAFE_INTEGER),await _.peekBuffer(F,{length:H,mayBeLess:!0}),$([66,77]))return{ext:"bmp",mime:"image/bmp"};if($([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if($([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if($([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if($([37,33]))return await _.peekBuffer(F,{length:24,mayBeLess:!0}),W("PS-Adobe-",{offset:2})&&W(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if($([31,160])||$([31,157]))return{ext:"Z",mime:"application/x-compress"};if($([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if($([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if($([31,139,8]))return{ext:"gz",mime:"application/gzip"};if($([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(W("ID3")){await _.ignore(6);const ne=await _.readToken(uint32SyncSafeToken);return _.position+ne>_.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await _.ignore(ne),fromTokenizer(_))}if(W("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((F[0]===67||F[0]===70)&&$([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if($([71,73,70]))return{ext:"gif",mime:"image/gif"};if(W("FLIF"))return{ext:"flif",mime:"image/flif"};if(W("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(W("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(W("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(W("FORM"))return{ext:"aif",mime:"audio/aiff"};if(W("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if($([80,75,3,4])){try{for(;_.position+30<_.fileInfo.size;){await _.readBuffer(F,{length:30});const ne={compressedSize:F.readUInt32LE(18),uncompressedSize:F.readUInt32LE(22),filenameLength:F.readUInt16LE(26),extraFieldLength:F.readUInt16LE(28)};if(ne.filename=await _.readToken(new Token.StringType(ne.filenameLength,"utf-8")),await _.ignore(ne.extraFieldLength),ne.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if(ne.filename.endsWith(".rels")||ne.filename.endsWith(".xml"))switch(ne.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if(ne.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(ne.filename.startsWith("3D/")&&ne.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if(ne.filename==="mimetype"&&ne.compressedSize===ne.uncompressedSize)switch(await _.readToken(new Token.StringType(ne.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}if(ne.compressedSize===0){let re=-1;for(;re<0&&_.position<_.fileInfo.size;)await _.peekBuffer(F,{mayBeLess:!0}),re=F.indexOf("504B0304",0,"hex"),await _.ignore(re>=0?re:F.length)}else await _.ignore(ne.compressedSize)}}catch(ne){if(!(ne instanceof strtok3.EndOfStreamError))throw ne}return{ext:"zip",mime:"application/zip"}}if(W("OggS")){await _.ignore(28);const ne=Buffer.alloc(8);return await _.readBuffer(ne),_check(ne,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(ne,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(ne,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(ne,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(ne,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(ne,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if($([80,75])&&(F[2]===3||F[2]===5||F[2]===7)&&(F[3]===4||F[3]===6||F[3]===8))return{ext:"zip",mime:"application/zip"};if(W("ftyp",{offset:4})&&(F[8]&96)!=0){const ne=F.toString("binary",8,12).replace("\0"," ").trim();switch(ne){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return ne.startsWith("3g")?ne.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(W("MThd"))return{ext:"mid",mime:"audio/midi"};if(W("wOFF")&&($([0,1,0,0],{offset:4})||W("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(W("wOF2")&&($([0,1,0,0],{offset:4})||W("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if($([212,195,178,161])||$([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(W("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(W("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(W("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if($([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(W("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(W("%PDF")){await _.ignore(1350);const ne=10*1024*1024,re=Buffer.alloc(Math.min(ne,_.fileInfo.size));return await _.readBuffer(re,{mayBeLess:!0}),re.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if($([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if($([73,73,42,0]))return W("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:$([28,0,254,0],{offset:8})||$([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:$([8,0,0,0],{offset:4})&&($([45,0,254,0],{offset:8})||$([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(F=Buffer.alloc(24),await _.peekBuffer(F),($([16,251,134,1],{offset:4})||$([8,0,0,0],{offset:4}))&&$([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if($([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(W("MAC "))return{ext:"ape",mime:"audio/ape"};if($([26,69,223,163])){async function ne(){const U=await _.peekNumber(Token.UINT8);let L=128,G=0;for(;(U&L)==0;)++G,L>>=1;const le=Buffer.alloc(G+1);return await _.readBuffer(le),le}async function re(){const U=await ne(),L=await ne();L[0]^=128>>L.length-1;const G=Math.min(6,L.length);return{id:U.readUIntBE(0,U.length),len:L.readUIntBE(L.length-G,G)}}async function se(U,L){for(;L>0;){const G=await re();if(G.id===17026)return _.readToken(new Token.StringType(G.len,"utf-8"));await _.ignore(G.len),--L}}const oe=await re();switch(await se(1,oe.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if($([82,73,70,70])){if($([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if($([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if($([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(W("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if($([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(W("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(W("MSCF")||W("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if($([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if($([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if($([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if($([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(W("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(W("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if($([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(W("IMPM"))return{ext:"it",mime:"audio/x-it"};if(W("-lh0-",{offset:2})||W("-lh1-",{offset:2})||W("-lh2-",{offset:2})||W("-lh3-",{offset:2})||W("-lh4-",{offset:2})||W("-lh5-",{offset:2})||W("-lh6-",{offset:2})||W("-lh7-",{offset:2})||W("-lzs-",{offset:2})||W("-lz4-",{offset:2})||W("-lz5-",{offset:2})||W("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if($([0,0,1,186])){if($([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if($([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(W("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if($([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(W("<?xml "))return{ext:"xml",mime:"application/xml"};if($([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if($([82,97,114,33,26,7])&&(F[6]===0||F[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(W("solid "))return{ext:"stl",mime:"model/stl"};if(W("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(W("!<arch>"))return await _.ignore(8),await _.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if($([137,80,78,71,13,10,26,10])){await _.ignore(8);async function ne(){return{length:await _.readToken(Token.INT32_BE),type:await _.readToken(new Token.StringType(4,"binary"))}}do{const re=await ne();if(re.length<0)return;switch(re.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await _.ignore(re.length+4)}}while(_.position+8<_.fileInfo.size);return{ext:"png",mime:"image/png"}}if($([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if($([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if($([102,114,101,101],{offset:4})||$([109,100,97,116],{offset:4})||$([109,111,111,118],{offset:4})||$([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if($([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(W("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if($([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if($([48,38,178,117,142,102,207,17,166,217])){async function ne(){const re=Buffer.alloc(16);return await _.readBuffer(re),{id:re,size:Number(await _.readToken(Token.UINT64_LE))}}for(await _.ignore(30);_.position+24<_.fileInfo.size;){const re=await ne();let se=re.size-24;if(_check(re.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const oe=Buffer.alloc(16);if(se-=await _.readBuffer(oe),_check(oe,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(oe,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await _.ignore(se)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if($([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if(($([126,16,4])||$([126,24,4]))&&$([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if($([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if($([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await _.ignore(20),await _.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if($([255,10])||$([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if($([0,0,1,186])||$([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if($([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if($([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if($([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if($([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await _.peekBuffer(F,{length:Math.min(256,_.fileInfo.size),mayBeLess:!0}),W("BEGIN:")){if(W("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(W("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(W("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(W("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(W("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if($([4,0,0,0])&&F.length>=16){const ne=F.readUInt32LE(12);if(ne>12&&F.length>=ne+16)try{const re=F.slice(16,ne+16).toString();if(JSON.parse(re).files)return{ext:"asar",mime:"application/x-asar"}}catch(re){}}if($([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(W("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if($([71],{offset:4})&&($([71],{offset:192})||$([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if($([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if($([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if($([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if($([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if($([76,80],{offset:34})&&($([0,0,1],{offset:8})||$([1,0,2],{offset:8})||$([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if($([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await _.peekBuffer(F,{length:Math.min(512,_.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(F))return{ext:"tar",mime:"application/x-tar"};if($([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(W("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(F.length>=2&&$([255,224],{offset:0,mask:[255,224]})){if($([16],{offset:1,mask:[22]}))return $([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if($([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if($([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if($([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const _=new stream.PassThrough;let F;stream.pipeline?F=stream.pipeline(readableStream,_,()=>{}):F=readableStream.pipe(_);const H=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const $=await fromBuffer(H);_.fileType=$}catch($){reject($)}resolve(F)})}),fileType={fromStream,fromTokenizer,fromBuffer,stream};Object.defineProperty(fileType,"extensions",{get(){return new Set(supported.extensions)}}),Object.defineProperty(fileType,"mimeTypes",{get(){return new Set(supported.mimeTypes)}}),module.exports=fileType},7769:(_,F,H)=>{"use strict";const $=H(6597),W=H(1);async function ne(se){const oe=await $.fromFile(se);try{return await W.fromTokenizer(oe)}finally{await oe.close()}}const re={fromFile:ne};Object.assign(re,W),Object.defineProperty(re,"extensions",{get(){return W.extensions}}),Object.defineProperty(re,"mimeTypes",{get(){return W.mimeTypes}}),_.exports=re},9898:_=>{"use strict";_.exports={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]}},6188:(_,F)=>{"use strict";F.stringToBytes=H=>[...H].map($=>$.charCodeAt(0)),F.tarHeaderChecksumMatches=(H,$=0)=>{const W=parseInt(H.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(W))return!1;let ne=8*32;for(let re=$;re<$+148;re++)ne+=H[re];for(let re=$+156;re<$+512;re++)ne+=H[re];return W===ne},F.uint32SyncSafeToken={get:(H,$)=>H[$+3]&127|H[$+2]<<7|H[$+1]<<14|H[$]<<21,len:4}},2664:(_,F,H)=>{"use strict";/*!
 * fill-range <https://github.com/jonschlinkert/fill-range>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Licensed under the MIT License.
 */const $=H(3837),W=H(5702),ne=ae=>ae!==null&&typeof ae=="object"&&!Array.isArray(ae),re=ae=>ue=>ae===!0?Number(ue):String(ue),se=ae=>typeof ae=="number"||typeof ae=="string"&&ae!=="",oe=ae=>Number.isInteger(+ae),z=ae=>{let ue=`${ae}`,we=-1;if(ue[0]==="-"&&(ue=ue.slice(1)),ue==="0")return!1;for(;ue[++we]==="0";);return we>0},U=(ae,ue,we)=>typeof ae=="string"||typeof ue=="string"?!0:we.stringify===!0,L=(ae,ue,we)=>{if(ue>0){let Re=ae[0]==="-"?"-":"";Re&&(ae=ae.slice(1)),ae=Re+ae.padStart(Re?ue-1:ue,"0")}return we===!1?String(ae):ae},G=(ae,ue)=>{let we=ae[0]==="-"?"-":"";for(we&&(ae=ae.slice(1),ue--);ae.length<ue;)ae="0"+ae;return we?"-"+ae:ae},le=(ae,ue)=>{ae.negatives.sort((Fe,Ve)=>Fe<Ve?-1:Fe>Ve?1:0),ae.positives.sort((Fe,Ve)=>Fe<Ve?-1:Fe>Ve?1:0);let we=ue.capture?"":"?:",Re="",Ee="",Ie;return ae.positives.length&&(Re=ae.positives.join("|")),ae.negatives.length&&(Ee=`-(${we}${ae.negatives.join("|")})`),Re&&Ee?Ie=`${Re}|${Ee}`:Ie=Re||Ee,ue.wrap?`(${we}${Ie})`:Ie},k=(ae,ue,we,Re)=>{if(we)return W(ae,ue,{wrap:!1,...Re});let Ee=String.fromCharCode(ae);if(ae===ue)return Ee;let Ie=String.fromCharCode(ue);return`[${Ee}-${Ie}]`},X=(ae,ue,we)=>{if(Array.isArray(ae)){let Re=we.wrap===!0,Ee=we.capture?"":"?:";return Re?`(${Ee}${ae.join("|")})`:ae.join("|")}return W(ae,ue,we)},Ge=(...ae)=>new RangeError("Invalid range arguments: "+$.inspect(...ae)),Qe=(ae,ue,we)=>{if(we.strictRanges===!0)throw Ge([ae,ue]);return[]},rt=(ae,ue)=>{if(ue.strictRanges===!0)throw new TypeError(`Expected step "${ae}" to be a number`);return[]},ye=(ae,ue,we=1,Re={})=>{let Ee=Number(ae),Ie=Number(ue);if(!Number.isInteger(Ee)||!Number.isInteger(Ie)){if(Re.strictRanges===!0)throw Ge([ae,ue]);return[]}Ee===0&&(Ee=0),Ie===0&&(Ie=0);let Fe=Ee>Ie,Ve=String(ae),it=String(ue),lt=String(we);we=Math.max(Math.abs(we),1);let ve=z(Ve)||z(it)||z(lt),je=ve?Math.max(Ve.length,it.length,lt.length):0,Ke=ve===!1&&U(ae,ue,Re)===!1,We=Re.transform||re(Ke);if(Re.toRegex&&we===1)return k(G(ae,je),G(ue,je),!0,Re);let Ue={negatives:[],positives:[]},ut=Ce=>Ue[Ce<0?"negatives":"positives"].push(Math.abs(Ce)),gt=[],_t=0;for(;Fe?Ee>=Ie:Ee<=Ie;)Re.toRegex===!0&&we>1?ut(Ee):gt.push(L(We(Ee,_t),je,Ke)),Ee=Fe?Ee-we:Ee+we,_t++;return Re.toRegex===!0?we>1?le(Ue,Re):X(gt,null,{wrap:!1,...Re}):gt},_e=(ae,ue,we=1,Re={})=>{if(!oe(ae)&&ae.length>1||!oe(ue)&&ue.length>1)return Qe(ae,ue,Re);let Ee=Re.transform||(Ke=>String.fromCharCode(Ke)),Ie=`${ae}`.charCodeAt(0),Fe=`${ue}`.charCodeAt(0),Ve=Ie>Fe,it=Math.min(Ie,Fe),lt=Math.max(Ie,Fe);if(Re.toRegex&&we===1)return k(it,lt,!1,Re);let ve=[],je=0;for(;Ve?Ie>=Fe:Ie<=Fe;)ve.push(Ee(Ie,je)),Ie=Ve?Ie-we:Ie+we,je++;return Re.toRegex===!0?X(ve,null,{wrap:!1,options:Re}):ve},be=(ae,ue,we,Re={})=>{if(ue==null&&se(ae))return[ae];if(!se(ae)||!se(ue))return Qe(ae,ue,Re);if(typeof we=="function")return be(ae,ue,1,{transform:we});if(ne(we))return be(ae,ue,0,we);let Ee={...Re};return Ee.capture===!0&&(Ee.wrap=!0),we=we||Ee.step||1,oe(we)?oe(ae)&&oe(ue)?ye(ae,ue,we,Ee):_e(ae,ue,Math.max(Math.abs(we),1),Ee):we!=null&&!ne(we)?rt(we,Ee):be(ae,ue,1,we)};_.exports=be},7360:function(_,F){var H,$,W;(function(ne,re){$=[],H=re,W=typeof H=="function"?H.apply(F,$):H,W!==void 0&&(_.exports=W)})(this,function(){function re(ye){var _e={single:function(be,ae,ue){if(!be||(Ge(be)||(be=_e.getPreparedSearch(be)),!ae))return null;Ge(ae)||(ae=_e.getPrepared(ae));var we=ue&&ue.allowTypo!==void 0?ue.allowTypo:ye&&ye.allowTypo!==void 0?ye.allowTypo:!0,Re=we?_e.algorithm:_e.algorithmNoTypo;return Re(be,ae,be[0])},go:function(be,ae,ue){if(!be)return U;be=_e.prepareSearch(be);var we=be[0],Re=ue&&ue.threshold||ye&&ye.threshold||-9007199254740991,Ee=ue&&ue.limit||ye&&ye.limit||9007199254740991,Ie=ue&&ue.allowTypo!==void 0?ue.allowTypo:ye&&ye.allowTypo!==void 0?ye.allowTypo:!0,Fe=Ie?_e.algorithm:_e.algorithmNoTypo,Ve=0,it=0,lt=ae.length;if(ue&&ue.keys)for(var ve=ue.scoreFn||k,je=ue.keys,Ke=je.length,We=lt-1;We>=0;--We){for(var Ue=ae[We],ut=new Array(Ke),gt=Ke-1;gt>=0;--gt){var _t=je[gt],Ce=X(Ue,_t);if(!Ce){ut[gt]=null;continue}Ge(Ce)||(Ce=_e.getPrepared(Ce)),ut[gt]=Fe(be,Ce,we)}ut.obj=Ue;var Rt=ve(ut);Rt!==null&&(Rt<Re||(ut.score=Rt,Ve<Ee?(rt.add(ut),++Ve):(++it,Rt>rt.peek().score&&rt.replaceTop(ut))))}else if(ue&&ue.key)for(var _t=ue.key,We=lt-1;We>=0;--We){var Ue=ae[We],Ce=X(Ue,_t);if(!!Ce){Ge(Ce)||(Ce=_e.getPrepared(Ce));var Ct=Fe(be,Ce,we);Ct!==null&&(Ct.score<Re||(Ct={target:Ct.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:Ct.score,indexes:Ct.indexes,obj:Ue},Ve<Ee?(rt.add(Ct),++Ve):(++it,Ct.score>rt.peek().score&&rt.replaceTop(Ct))))}}else for(var We=lt-1;We>=0;--We){var Ce=ae[We];if(!!Ce){Ge(Ce)||(Ce=_e.getPrepared(Ce));var Ct=Fe(be,Ce,we);Ct!==null&&(Ct.score<Re||(Ve<Ee?(rt.add(Ct),++Ve):(++it,Ct.score>rt.peek().score&&rt.replaceTop(Ct))))}}if(Ve===0)return U;for(var It=new Array(Ve),We=Ve-1;We>=0;--We)It[We]=rt.poll();return It.total=Ve+it,It},goAsync:function(be,ae,ue){var we=!1,Re=new Promise(function(Ee,Ie){if(!be)return Ee(U);be=_e.prepareSearch(be);var Fe=be[0],Ve=Qe(),it=ae.length-1,lt=ue&&ue.threshold||ye&&ye.threshold||-9007199254740991,ve=ue&&ue.limit||ye&&ye.limit||9007199254740991,je=ue&&ue.allowTypo!==void 0?ue.allowTypo:ye&&ye.allowTypo!==void 0?ye.allowTypo:!0,Ke=je?_e.algorithm:_e.algorithmNoTypo,We=0,Ue=0;function ut(){if(we)return Ie("canceled");var gt=Date.now();if(ue&&ue.keys)for(var _t=ue.scoreFn||k,Ce=ue.keys,Rt=Ce.length;it>=0;--it){for(var Ct=ae[it],It=new Array(Rt),ke=Rt-1;ke>=0;--ke){var Pe=Ce[ke],vt=X(Ct,Pe);if(!vt){It[ke]=null;continue}Ge(vt)||(vt=_e.getPrepared(vt)),It[ke]=Ke(be,vt,Fe)}It.obj=Ct;var Tt=_t(It);if(Tt!==null&&!(Tt<lt)&&(It.score=Tt,We<ve?(Ve.add(It),++We):(++Ue,Tt>Ve.peek().score&&Ve.replaceTop(It)),it%1e3==0&&Date.now()-gt>=10)){se?setImmediate(ut):setTimeout(ut);return}}else if(ue&&ue.key)for(var Pe=ue.key;it>=0;--it){var Ct=ae[it],vt=X(Ct,Pe);if(!!vt){Ge(vt)||(vt=_e.getPrepared(vt));var kt=Ke(be,vt,Fe);if(kt!==null&&!(kt.score<lt)&&(kt={target:kt.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:kt.score,indexes:kt.indexes,obj:Ct},We<ve?(Ve.add(kt),++We):(++Ue,kt.score>Ve.peek().score&&Ve.replaceTop(kt)),it%1e3==0&&Date.now()-gt>=10)){se?setImmediate(ut):setTimeout(ut);return}}}else for(;it>=0;--it){var vt=ae[it];if(!!vt){Ge(vt)||(vt=_e.getPrepared(vt));var kt=Ke(be,vt,Fe);if(kt!==null&&!(kt.score<lt)&&(We<ve?(Ve.add(kt),++We):(++Ue,kt.score>Ve.peek().score&&Ve.replaceTop(kt)),it%1e3==0&&Date.now()-gt>=10)){se?setImmediate(ut):setTimeout(ut);return}}}if(We===0)return Ee(U);for(var Tr=new Array(We),Yt=We-1;Yt>=0;--Yt)Tr[Yt]=Ve.poll();Tr.total=We+Ue,Ee(Tr)}se?setImmediate(ut):ut()});return Re.cancel=function(){we=!0},Re},highlight:function(be,ae,ue){if(be===null)return null;ae===void 0&&(ae="<b>"),ue===void 0&&(ue="</b>");for(var we="",Re=0,Ee=!1,Ie=be.target,Fe=Ie.length,Ve=be.indexes,it=0;it<Fe;++it){var lt=Ie[it];if(Ve[Re]===it){if(++Re,Ee||(Ee=!0,we+=ae),Re===Ve.length){we+=lt+ue+Ie.substr(it+1);break}}else Ee&&(Ee=!1,we+=ue);we+=lt}return we},prepare:function(be){if(!!be)return{target:be,_targetLowerCodes:_e.prepareLowerCodes(be),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(be){if(!!be)return{target:be,_targetLowerCodes:_e.prepareLowerCodes(be),_nextBeginningIndexes:_e.prepareNextBeginningIndexes(be),score:null,indexes:null,obj:null}},prepareSearch:function(be){if(!!be)return _e.prepareLowerCodes(be)},getPrepared:function(be){if(be.length>999)return _e.prepare(be);var ae=oe.get(be);return ae!==void 0||(ae=_e.prepare(be),oe.set(be,ae)),ae},getPreparedSearch:function(be){if(be.length>999)return _e.prepareSearch(be);var ae=z.get(be);return ae!==void 0||(ae=_e.prepareSearch(be),z.set(be,ae)),ae},algorithm:function(be,ae,ue){for(var we=ae._targetLowerCodes,Re=be.length,Ee=we.length,Ie=0,Fe=0,Ve=0,it=0;;){var lt=ue===we[Fe];if(lt){if(L[it++]=Fe,++Ie,Ie===Re)break;ue=be[Ve===0?Ie:Ve===Ie?Ie+1:Ve===Ie-1?Ie-1:Ie]}if(++Fe,Fe>=Ee)for(;;){if(Ie<=1)return null;if(Ve===0){--Ie;var ve=be[Ie];if(ue===ve)continue;Ve=Ie}else{if(Ve===1)return null;--Ve,Ie=Ve,ue=be[Ie+1];var ve=be[Ie];if(ue===ve)continue}it=Ie,Fe=L[it-1]+1;break}}var Ie=0,je=0,Ke=!1,We=0,Ue=ae._nextBeginningIndexes;Ue===null&&(Ue=ae._nextBeginningIndexes=_e.prepareNextBeginningIndexes(ae.target));var ut=Fe=L[0]===0?0:Ue[L[0]-1];if(Fe!==Ee)for(;;)if(Fe>=Ee){if(Ie<=0){if(++je,je>Re-2)break;if(be[je]===be[je+1])continue;Fe=ut;continue}--Ie;var gt=G[--We];Fe=Ue[gt]}else{var lt=be[je===0?Ie:je===Ie?Ie+1:je===Ie-1?Ie-1:Ie]===we[Fe];if(lt){if(G[We++]=Fe,++Ie,Ie===Re){Ke=!0;break}++Fe}else Fe=Ue[Fe]}{if(Ke)var _t=G,Ce=We;else var _t=L,Ce=it;for(var Rt=0,Ct=-1,It=0;It<Re;++It){var Fe=_t[It];Ct!==Fe-1&&(Rt-=Fe),Ct=Fe}Ke?je!==0&&(Rt+=-20):(Rt*=1e3,Ve!==0&&(Rt+=-20)),Rt-=Ee-Re,ae.score=Rt,ae.indexes=new Array(Ce);for(var It=Ce-1;It>=0;--It)ae.indexes[It]=_t[It];return ae}},algorithmNoTypo:function(be,ae,ue){for(var we=ae._targetLowerCodes,Re=be.length,Ee=we.length,Ie=0,Fe=0,Ve=0;;){var it=ue===we[Fe];if(it){if(L[Ve++]=Fe,++Ie,Ie===Re)break;ue=be[Ie]}if(++Fe,Fe>=Ee)return null}var Ie=0,lt=!1,ve=0,je=ae._nextBeginningIndexes;je===null&&(je=ae._nextBeginningIndexes=_e.prepareNextBeginningIndexes(ae.target));var Ke=Fe=L[0]===0?0:je[L[0]-1];if(Fe!==Ee)for(;;)if(Fe>=Ee){if(Ie<=0)break;--Ie;var We=G[--ve];Fe=je[We]}else{var it=be[Ie]===we[Fe];if(it){if(G[ve++]=Fe,++Ie,Ie===Re){lt=!0;break}++Fe}else Fe=je[Fe]}{if(lt)var Ue=G,ut=ve;else var Ue=L,ut=Ve;for(var gt=0,_t=-1,Ce=0;Ce<Re;++Ce){var Fe=Ue[Ce];_t!==Fe-1&&(gt-=Fe),_t=Fe}lt||(gt*=1e3),gt-=Ee-Re,ae.score=gt,ae.indexes=new Array(ut);for(var Ce=ut-1;Ce>=0;--Ce)ae.indexes[Ce]=Ue[Ce];return ae}},prepareLowerCodes:function(be){for(var ae=be.length,ue=[],we=be.toLowerCase(),Re=0;Re<ae;++Re)ue[Re]=we.charCodeAt(Re);return ue},prepareBeginningIndexes:function(be){for(var ae=be.length,ue=[],we=0,Re=!1,Ee=!1,Ie=0;Ie<ae;++Ie){var Fe=be.charCodeAt(Ie),Ve=Fe>=65&&Fe<=90,it=Ve||Fe>=97&&Fe<=122||Fe>=48&&Fe<=57,lt=Ve&&!Re||!Ee||!it;Re=Ve,Ee=it,lt&&(ue[we++]=Ie)}return ue},prepareNextBeginningIndexes:function(be){for(var ae=be.length,ue=_e.prepareBeginningIndexes(be),we=[],Re=ue[0],Ee=0,Ie=0;Ie<ae;++Ie)Re>Ie?we[Ie]=Re:(Re=ue[++Ee],we[Ie]=Re===void 0?ae:Re);return we},cleanup:le,new:re};return _e}var se=typeof window=="undefined",oe=new Map,z=new Map,U=[];U.total=0;var L=[],G=[];function le(){oe.clear(),z.clear(),L=[],G=[]}function k(ye){for(var _e=-9007199254740991,be=ye.length-1;be>=0;--be){var ae=ye[be];if(ae!==null){var ue=ae.score;ue>_e&&(_e=ue)}}return _e===-9007199254740991?null:_e}function X(ye,_e){var be=ye[_e];if(be!==void 0)return be;var ae=_e;Array.isArray(_e)||(ae=_e.split("."));for(var ue=ae.length,we=-1;ye&&++we<ue;)ye=ye[ae[we]];return ye}function Ge(ye){return typeof ye=="object"}var Qe=function(){var ye=[],_e=0,be={};function ae(){for(var ue=0,we=ye[ue],Re=1;Re<_e;){var Ee=Re+1;ue=Re,Ee<_e&&ye[Ee].score<ye[Re].score&&(ue=Ee),ye[ue-1>>1]=ye[ue],Re=1+(ue<<1)}for(var Ie=ue-1>>1;ue>0&&we.score<ye[Ie].score;Ie=(ue=Ie)-1>>1)ye[ue]=ye[Ie];ye[ue]=we}return be.add=function(ue){var we=_e;ye[_e++]=ue;for(var Re=we-1>>1;we>0&&ue.score<ye[Re].score;Re=(we=Re)-1>>1)ye[we]=ye[Re];ye[we]=ue},be.poll=function(){if(_e!==0){var ue=ye[0];return ye[0]=ye[--_e],ae(),ue}},be.peek=function(ue){if(_e!==0)return ye[0]},be.replaceTop=function(ue){ye[0]=ue,ae()},be},rt=Qe();return re()})},645:(_,F)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */F.read=function(H,$,W,ne,re){var se,oe,z=re*8-ne-1,U=(1<<z)-1,L=U>>1,G=-7,le=W?re-1:0,k=W?-1:1,X=H[$+le];for(le+=k,se=X&(1<<-G)-1,X>>=-G,G+=z;G>0;se=se*256+H[$+le],le+=k,G-=8);for(oe=se&(1<<-G)-1,se>>=-G,G+=ne;G>0;oe=oe*256+H[$+le],le+=k,G-=8);if(se===0)se=1-L;else{if(se===U)return oe?NaN:(X?-1:1)*(1/0);oe=oe+Math.pow(2,ne),se=se-L}return(X?-1:1)*oe*Math.pow(2,se-ne)},F.write=function(H,$,W,ne,re,se){var oe,z,U,L=se*8-re-1,G=(1<<L)-1,le=G>>1,k=re===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=ne?0:se-1,Ge=ne?1:-1,Qe=$<0||$===0&&1/$<0?1:0;for($=Math.abs($),isNaN($)||$===1/0?(z=isNaN($)?1:0,oe=G):(oe=Math.floor(Math.log($)/Math.LN2),$*(U=Math.pow(2,-oe))<1&&(oe--,U*=2),oe+le>=1?$+=k/U:$+=k*Math.pow(2,1-le),$*U>=2&&(oe++,U/=2),oe+le>=G?(z=0,oe=G):oe+le>=1?(z=($*U-1)*Math.pow(2,re),oe=oe+le):(z=$*Math.pow(2,le-1)*Math.pow(2,re),oe=0));re>=8;H[W+X]=z&255,X+=Ge,z/=256,re-=8);for(oe=oe<<re|z,L+=re;L>0;H[W+X]=oe&255,X+=Ge,oe/=256,L-=8);H[W+X-Ge]|=Qe*128}},9924:_=>{"use strict";/*!
 * is-number <https://github.com/jonschlinkert/is-number>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */_.exports=function(F){return typeof F=="number"?F-F==0:typeof F=="string"&&F.trim()!==""?Number.isFinite?Number.isFinite(+F):isFinite(+F):!1}},850:(_,F,H)=>{"use strict";const $=H(3837),W=H(6744),ne=H(9444),re=H(8702),se=z=>z===""||z==="./",oe=(z,U,L)=>{U=[].concat(U),z=[].concat(z);let G=new Set,le=new Set,k=new Set,X=0,Ge=ye=>{k.add(ye.output),L&&L.onResult&&L.onResult(ye)};for(let ye=0;ye<U.length;ye++){let _e=ne(String(U[ye]),{...L,onResult:Ge},!0),be=_e.state.negated||_e.state.negatedExtglob;be&&X++;for(let ae of z){let ue=_e(ae,!0);!(be?!ue.isMatch:ue.isMatch)||(be?G.add(ue.output):(G.delete(ue.output),le.add(ue.output)))}}let rt=(X===U.length?[...k]:[...le]).filter(ye=>!G.has(ye));if(L&&rt.length===0){if(L.failglob===!0)throw new Error(`No matches found for "${U.join(", ")}"`);if(L.nonull===!0||L.nullglob===!0)return L.unescape?U.map(ye=>ye.replace(/\\/g,"")):U}return rt};oe.match=oe,oe.matcher=(z,U)=>ne(z,U),oe.isMatch=(z,U,L)=>ne(U,L)(z),oe.any=oe.isMatch,oe.not=(z,U,L={})=>{U=[].concat(U).map(String);let G=new Set,le=[],X=oe(z,U,{...L,onResult:Ge=>{L.onResult&&L.onResult(Ge),le.push(Ge.output)}});for(let Ge of le)X.includes(Ge)||G.add(Ge);return[...G]},oe.contains=(z,U,L)=>{if(typeof z!="string")throw new TypeError(`Expected a string: "${$.inspect(z)}"`);if(Array.isArray(U))return U.some(G=>oe.contains(z,G,L));if(typeof U=="string"){if(se(z)||se(U))return!1;if(z.includes(U)||z.startsWith("./")&&z.slice(2).includes(U))return!0}return oe.isMatch(z,U,{...L,contains:!0})},oe.matchKeys=(z,U,L)=>{if(!re.isObject(z))throw new TypeError("Expected the first argument to be an object");let G=oe(Object.keys(z),U,L),le={};for(let k of G)le[k]=z[k];return le},oe.some=(z,U,L)=>{let G=[].concat(z);for(let le of[].concat(U)){let k=ne(String(le),L);if(G.some(X=>k(X)))return!0}return!1},oe.every=(z,U,L)=>{let G=[].concat(z);for(let le of[].concat(U)){let k=ne(String(le),L);if(!G.every(X=>k(X)))return!1}return!0},oe.all=(z,U,L)=>{if(typeof z!="string")throw new TypeError(`Expected a string: "${$.inspect(z)}"`);return[].concat(U).every(G=>ne(G,L)(z))},oe.capture=(z,U,L)=>{let G=re.isWindows(L),k=ne.makeRe(String(z),{...L,capture:!0}).exec(G?re.toPosixSlashes(U):U);if(k)return k.slice(1).map(X=>X===void 0?"":X)},oe.makeRe=(...z)=>ne.makeRe(...z),oe.scan=(...z)=>ne.scan(...z),oe.parse=(z,U)=>{let L=[];for(let G of[].concat(z||[]))for(let le of W(String(G),U))L.push(ne.parse(le,U));return L},oe.braces=(z,U)=>{if(typeof z!="string")throw new TypeError("Expected a string");return U&&U.nobrace===!0||!/\{.*\}/.test(z)?[z]:W(z,U)},oe.braceExpand=(z,U)=>{if(typeof z!="string")throw new TypeError("Expected a string");return oe.braces(z,{...U,expand:!0})},_.exports=oe},447:(_,F,H)=>{var $=H(2479);_.exports=$(W),_.exports.strict=$(ne),W.proto=W(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return W(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return ne(this)},configurable:!0})});function W(re){var se=function(){return se.called?se.value:(se.called=!0,se.value=re.apply(this,arguments))};return se.called=!1,se}function ne(re){var se=function(){if(se.called)throw new Error(se.onceError);return se.called=!0,se.value=re.apply(this,arguments)},oe=re.name||"Function wrapped with `once`";return se.onceError=oe+" shouldn't be called more than once",se.called=!1,se}},7279:(_,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.EndOfStreamError=F.defaultMessages=void 0,F.defaultMessages="End-Of-Stream";class H extends Error{constructor(){super(F.defaultMessages)}}F.EndOfStreamError=H},5167:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.StreamReader=F.EndOfStreamError=void 0;const $=H(7279);var W=H(7279);Object.defineProperty(F,"EndOfStreamError",{enumerable:!0,get:function(){return W.EndOfStreamError}});class ne{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((z,U)=>{this.reject=U,this.resolve=z})}}const re=1*1024*1024;class se{constructor(z){if(this.s=z,this.request=null,this.endOfStream=!1,this.peekQueue=[],!z.read||!z.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new $.EndOfStreamError)),this.s.once("error",U=>this.reject(U)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(z,U,L){const G=await this.read(z,U,L);return this.peekQueue.push(z.subarray(U,U+G)),G}async read(z,U,L){if(L===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new $.EndOfStreamError;let G=L,le=0;for(;this.peekQueue.length>0&&G>0;){const k=this.peekQueue.pop();if(!k)throw new Error("peekData should be defined");const X=Math.min(k.length,G);z.set(k.subarray(0,X),U+le),le+=X,G-=X,X<k.length&&this.peekQueue.push(k.subarray(X))}for(;G>0&&!this.endOfStream;){const k=Math.min(G,re),X=await this._read(z,U+le,k);if(le+=X,X<k)break;G-=X}return le}async _read(z,U,L){if(this.request)throw new Error("Concurrent read operation?");const G=this.s.read(L);return G?(z.set(G,U),G.length):(this.request={buffer:z,offset:U,length:L,deferred:new ne},this.s.once("readable",()=>{this.tryRead()}),this.request.deferred.promise)}tryRead(){if(!this.request)throw new Error("this.request should be defined");const z=this.s.read(this.request.length);z?(this.request.buffer.set(z,this.request.offset),this.request.deferred.resolve(z.length),this.request=null):this.s.once("readable",()=>{this.tryRead()})}reject(z){this.endOfStream=!0,this.request&&(this.request.deferred.reject(z),this.request=null)}}F.StreamReader=se},9444:(_,F,H)=>{"use strict";_.exports=H(6087)},1006:(_,F,H)=>{"use strict";const $=H(1017),W="\\\\/",ne=`[^${W}]`,re="\\.",se="\\+",oe="\\?",z="\\/",U="(?=.)",L="[^/]",G=`(?:${z}|$)`,le=`(?:^|${z})`,k=`${re}{1,2}${G}`,X=`(?!${re})`,Ge=`(?!${le}${k})`,Qe=`(?!${re}{0,1}${G})`,rt=`(?!${k})`,ye=`[^.${z}]`,_e=`${L}*?`,be={DOT_LITERAL:re,PLUS_LITERAL:se,QMARK_LITERAL:oe,SLASH_LITERAL:z,ONE_CHAR:U,QMARK:L,END_ANCHOR:G,DOTS_SLASH:k,NO_DOT:X,NO_DOTS:Ge,NO_DOT_SLASH:Qe,NO_DOTS_SLASH:rt,QMARK_NO_DOT:ye,STAR:_e,START_ANCHOR:le},ae={...be,SLASH_LITERAL:`[${W}]`,QMARK:ne,STAR:`${ne}*?`,DOTS_SLASH:`${re}{1,2}(?:[${W}]|$)`,NO_DOT:`(?!${re})`,NO_DOTS:`(?!(?:^|[${W}])${re}{1,2}(?:[${W}]|$))`,NO_DOT_SLASH:`(?!${re}{0,1}(?:[${W}]|$))`,NO_DOTS_SLASH:`(?!${re}{1,2}(?:[${W}]|$))`,QMARK_NO_DOT:`[^.${W}]`,START_ANCHOR:`(?:^|[${W}])`,END_ANCHOR:`(?:[${W}]|$)`},ue={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};_.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:ue,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:$.sep,extglobChars(we){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${we.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(we){return we===!0?ae:be}}},3376:(_,F,H)=>{"use strict";const $=H(1006),W=H(8702),{MAX_LENGTH:ne,POSIX_REGEX_SOURCE:re,REGEX_NON_SPECIAL_CHARS:se,REGEX_SPECIAL_CHARS_BACKREF:oe,REPLACEMENTS:z}=$,U=(le,k)=>{if(typeof k.expandRange=="function")return k.expandRange(...le,k);le.sort();const X=`[${le.join("-")}]`;try{new RegExp(X)}catch(Ge){return le.map(Qe=>W.escapeRegex(Qe)).join("..")}return X},L=(le,k)=>`Missing ${le}: "${k}" - use "\\\\${k}" to match literal characters`,G=(le,k)=>{if(typeof le!="string")throw new TypeError("Expected a string");le=z[le]||le;const X={...k},Ge=typeof X.maxLength=="number"?Math.min(ne,X.maxLength):ne;let Qe=le.length;if(Qe>Ge)throw new SyntaxError(`Input length: ${Qe}, exceeds maximum allowed length: ${Ge}`);const rt={type:"bos",value:"",output:X.prepend||""},ye=[rt],_e=X.capture?"":"?:",be=W.isWindows(k),ae=$.globChars(be),ue=$.extglobChars(ae),{DOT_LITERAL:we,PLUS_LITERAL:Re,SLASH_LITERAL:Ee,ONE_CHAR:Ie,DOTS_SLASH:Fe,NO_DOT:Ve,NO_DOT_SLASH:it,NO_DOTS_SLASH:lt,QMARK:ve,QMARK_NO_DOT:je,STAR:Ke,START_ANCHOR:We}=ae,Ue=st=>`(${_e}(?:(?!${We}${st.dot?Fe:we}).)*?)`,ut=X.dot?"":Ve,gt=X.dot?ve:je;let _t=X.bash===!0?Ue(X):Ke;X.capture&&(_t=`(${_t})`),typeof X.noext=="boolean"&&(X.noextglob=X.noext);const Ce={input:le,index:-1,start:0,dot:X.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:ye};le=W.removePrefix(le,Ce),Qe=le.length;const Rt=[],Ct=[],It=[];let ke=rt,Pe;const vt=()=>Ce.index===Qe-1,Tt=Ce.peek=(st=1)=>le[Ce.index+st],kt=Ce.advance=()=>le[++Ce.index]||"",Tr=()=>le.slice(Ce.index+1),Yt=(st="",zt=0)=>{Ce.consumed+=st,Ce.index+=zt},lr=st=>{Ce.output+=st.output!=null?st.output:st.value,Yt(st.value)},Qn=()=>{let st=1;for(;Tt()==="!"&&(Tt(2)!=="("||Tt(3)==="?");)kt(),Ce.start++,st++;return st%2==0?!1:(Ce.negated=!0,Ce.start++,!0)},Mr=st=>{Ce[st]++,It.push(st)},_r=st=>{Ce[st]--,It.pop()},St=st=>{if(ke.type==="globstar"){const zt=Ce.braces>0&&(st.type==="comma"||st.type==="brace"),tt=st.extglob===!0||Rt.length&&(st.type==="pipe"||st.type==="paren");st.type!=="slash"&&st.type!=="paren"&&!zt&&!tt&&(Ce.output=Ce.output.slice(0,-ke.output.length),ke.type="star",ke.value="*",ke.output=_t,Ce.output+=ke.output)}if(Rt.length&&st.type!=="paren"&&(Rt[Rt.length-1].inner+=st.value),(st.value||st.output)&&lr(st),ke&&ke.type==="text"&&st.type==="text"){ke.value+=st.value,ke.output=(ke.output||"")+st.value;return}st.prev=ke,ye.push(st),ke=st},or=(st,zt)=>{const tt={...ue[zt],conditions:1,inner:""};tt.prev=ke,tt.parens=Ce.parens,tt.output=Ce.output;const At=(X.capture?"(":"")+tt.open;Mr("parens"),St({type:st,value:zt,output:Ce.output?"":Ie}),St({type:"paren",extglob:!0,value:kt(),output:At}),Rt.push(tt)},Xn=st=>{let zt=st.close+(X.capture?")":""),tt;if(st.type==="negate"){let At=_t;st.inner&&st.inner.length>1&&st.inner.includes("/")&&(At=Ue(X)),(At!==_t||vt()||/^\)+$/.test(Tr()))&&(zt=st.close=`)$))${At}`),st.inner.includes("*")&&(tt=Tr())&&/^\.[^\\/.]+$/.test(tt)&&(zt=st.close=`)${tt})${At})`),st.prev.type==="bos"&&(Ce.negatedExtglob=!0)}St({type:"paren",extglob:!0,value:Pe,output:zt}),_r("parens")};if(X.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(le)){let st=!1,zt=le.replace(oe,(tt,At,Kt,br,ur,En)=>br==="\\"?(st=!0,tt):br==="?"?At?At+br+(ur?ve.repeat(ur.length):""):En===0?gt+(ur?ve.repeat(ur.length):""):ve.repeat(Kt.length):br==="."?we.repeat(Kt.length):br==="*"?At?At+br+(ur?_t:""):_t:At?tt:`\\${tt}`);return st===!0&&(X.unescape===!0?zt=zt.replace(/\\/g,""):zt=zt.replace(/\\+/g,tt=>tt.length%2==0?"\\\\":tt?"\\":"")),zt===le&&X.contains===!0?(Ce.output=le,Ce):(Ce.output=W.wrapOutput(zt,Ce,k),Ce)}for(;!vt();){if(Pe=kt(),Pe==="\0")continue;if(Pe==="\\"){const tt=Tt();if(tt==="/"&&X.bash!==!0||tt==="."||tt===";")continue;if(!tt){Pe+="\\",St({type:"text",value:Pe});continue}const At=/^\\+/.exec(Tr());let Kt=0;if(At&&At[0].length>2&&(Kt=At[0].length,Ce.index+=Kt,Kt%2!=0&&(Pe+="\\")),X.unescape===!0?Pe=kt():Pe+=kt(),Ce.brackets===0){St({type:"text",value:Pe});continue}}if(Ce.brackets>0&&(Pe!=="]"||ke.value==="["||ke.value==="[^")){if(X.posix!==!1&&Pe===":"){const tt=ke.value.slice(1);if(tt.includes("[")&&(ke.posix=!0,tt.includes(":"))){const At=ke.value.lastIndexOf("["),Kt=ke.value.slice(0,At),br=ke.value.slice(At+2),ur=re[br];if(ur){ke.value=Kt+ur,Ce.backtrack=!0,kt(),!rt.output&&ye.indexOf(ke)===1&&(rt.output=Ie);continue}}}(Pe==="["&&Tt()!==":"||Pe==="-"&&Tt()==="]")&&(Pe=`\\${Pe}`),Pe==="]"&&(ke.value==="["||ke.value==="[^")&&(Pe=`\\${Pe}`),X.posix===!0&&Pe==="!"&&ke.value==="["&&(Pe="^"),ke.value+=Pe,lr({value:Pe});continue}if(Ce.quotes===1&&Pe!=='"'){Pe=W.escapeRegex(Pe),ke.value+=Pe,lr({value:Pe});continue}if(Pe==='"'){Ce.quotes=Ce.quotes===1?0:1,X.keepQuotes===!0&&St({type:"text",value:Pe});continue}if(Pe==="("){Mr("parens"),St({type:"paren",value:Pe});continue}if(Pe===")"){if(Ce.parens===0&&X.strictBrackets===!0)throw new SyntaxError(L("opening","("));const tt=Rt[Rt.length-1];if(tt&&Ce.parens===tt.parens+1){Xn(Rt.pop());continue}St({type:"paren",value:Pe,output:Ce.parens?")":"\\)"}),_r("parens");continue}if(Pe==="["){if(X.nobracket===!0||!Tr().includes("]")){if(X.nobracket!==!0&&X.strictBrackets===!0)throw new SyntaxError(L("closing","]"));Pe=`\\${Pe}`}else Mr("brackets");St({type:"bracket",value:Pe});continue}if(Pe==="]"){if(X.nobracket===!0||ke&&ke.type==="bracket"&&ke.value.length===1){St({type:"text",value:Pe,output:`\\${Pe}`});continue}if(Ce.brackets===0){if(X.strictBrackets===!0)throw new SyntaxError(L("opening","["));St({type:"text",value:Pe,output:`\\${Pe}`});continue}_r("brackets");const tt=ke.value.slice(1);if(ke.posix!==!0&&tt[0]==="^"&&!tt.includes("/")&&(Pe=`/${Pe}`),ke.value+=Pe,lr({value:Pe}),X.literalBrackets===!1||W.hasRegexChars(tt))continue;const At=W.escapeRegex(ke.value);if(Ce.output=Ce.output.slice(0,-ke.value.length),X.literalBrackets===!0){Ce.output+=At,ke.value=At;continue}ke.value=`(${_e}${At}|${ke.value})`,Ce.output+=ke.value;continue}if(Pe==="{"&&X.nobrace!==!0){Mr("braces");const tt={type:"brace",value:Pe,output:"(",outputIndex:Ce.output.length,tokensIndex:Ce.tokens.length};Ct.push(tt),St(tt);continue}if(Pe==="}"){const tt=Ct[Ct.length-1];if(X.nobrace===!0||!tt){St({type:"text",value:Pe,output:Pe});continue}let At=")";if(tt.dots===!0){const Kt=ye.slice(),br=[];for(let ur=Kt.length-1;ur>=0&&(ye.pop(),Kt[ur].type!=="brace");ur--)Kt[ur].type!=="dots"&&br.unshift(Kt[ur].value);At=U(br,X),Ce.backtrack=!0}if(tt.comma!==!0&&tt.dots!==!0){const Kt=Ce.output.slice(0,tt.outputIndex),br=Ce.tokens.slice(tt.tokensIndex);tt.value=tt.output="\\{",Pe=At="\\}",Ce.output=Kt;for(const ur of br)Ce.output+=ur.output||ur.value}St({type:"brace",value:Pe,output:At}),_r("braces"),Ct.pop();continue}if(Pe==="|"){Rt.length>0&&Rt[Rt.length-1].conditions++,St({type:"text",value:Pe});continue}if(Pe===","){let tt=Pe;const At=Ct[Ct.length-1];At&&It[It.length-1]==="braces"&&(At.comma=!0,tt="|"),St({type:"comma",value:Pe,output:tt});continue}if(Pe==="/"){if(ke.type==="dot"&&Ce.index===Ce.start+1){Ce.start=Ce.index+1,Ce.consumed="",Ce.output="",ye.pop(),ke=rt;continue}St({type:"slash",value:Pe,output:Ee});continue}if(Pe==="."){if(Ce.braces>0&&ke.type==="dot"){ke.value==="."&&(ke.output=we);const tt=Ct[Ct.length-1];ke.type="dots",ke.output+=Pe,ke.value+=Pe,tt.dots=!0;continue}if(Ce.braces+Ce.parens===0&&ke.type!=="bos"&&ke.type!=="slash"){St({type:"text",value:Pe,output:we});continue}St({type:"dot",value:Pe,output:we});continue}if(Pe==="?"){if(!(ke&&ke.value==="(")&&X.noextglob!==!0&&Tt()==="("&&Tt(2)!=="?"){or("qmark",Pe);continue}if(ke&&ke.type==="paren"){const At=Tt();let Kt=Pe;if(At==="<"&&!W.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(ke.value==="("&&!/[!=<:]/.test(At)||At==="<"&&!/<([!=]|\w+>)/.test(Tr()))&&(Kt=`\\${Pe}`),St({type:"text",value:Pe,output:Kt});continue}if(X.dot!==!0&&(ke.type==="slash"||ke.type==="bos")){St({type:"qmark",value:Pe,output:je});continue}St({type:"qmark",value:Pe,output:ve});continue}if(Pe==="!"){if(X.noextglob!==!0&&Tt()==="("&&(Tt(2)!=="?"||!/[!=<:]/.test(Tt(3)))){or("negate",Pe);continue}if(X.nonegate!==!0&&Ce.index===0){Qn();continue}}if(Pe==="+"){if(X.noextglob!==!0&&Tt()==="("&&Tt(2)!=="?"){or("plus",Pe);continue}if(ke&&ke.value==="("||X.regex===!1){St({type:"plus",value:Pe,output:Re});continue}if(ke&&(ke.type==="bracket"||ke.type==="paren"||ke.type==="brace")||Ce.parens>0){St({type:"plus",value:Pe});continue}St({type:"plus",value:Re});continue}if(Pe==="@"){if(X.noextglob!==!0&&Tt()==="("&&Tt(2)!=="?"){St({type:"at",extglob:!0,value:Pe,output:""});continue}St({type:"text",value:Pe});continue}if(Pe!=="*"){(Pe==="$"||Pe==="^")&&(Pe=`\\${Pe}`);const tt=se.exec(Tr());tt&&(Pe+=tt[0],Ce.index+=tt[0].length),St({type:"text",value:Pe});continue}if(ke&&(ke.type==="globstar"||ke.star===!0)){ke.type="star",ke.star=!0,ke.value+=Pe,ke.output=_t,Ce.backtrack=!0,Ce.globstar=!0,Yt(Pe);continue}let st=Tr();if(X.noextglob!==!0&&/^\([^?]/.test(st)){or("star",Pe);continue}if(ke.type==="star"){if(X.noglobstar===!0){Yt(Pe);continue}const tt=ke.prev,At=tt.prev,Kt=tt.type==="slash"||tt.type==="bos",br=At&&(At.type==="star"||At.type==="globstar");if(X.bash===!0&&(!Kt||st[0]&&st[0]!=="/")){St({type:"star",value:Pe,output:""});continue}const ur=Ce.braces>0&&(tt.type==="comma"||tt.type==="brace"),En=Rt.length&&(tt.type==="pipe"||tt.type==="paren");if(!Kt&&tt.type!=="paren"&&!ur&&!En){St({type:"star",value:Pe,output:""});continue}for(;st.slice(0,3)==="/**";){const Cn=le[Ce.index+4];if(Cn&&Cn!=="/")break;st=st.slice(3),Yt("/**",3)}if(tt.type==="bos"&&vt()){ke.type="globstar",ke.value+=Pe,ke.output=Ue(X),Ce.output=ke.output,Ce.globstar=!0,Yt(Pe);continue}if(tt.type==="slash"&&tt.prev.type!=="bos"&&!br&&vt()){Ce.output=Ce.output.slice(0,-(tt.output+ke.output).length),tt.output=`(?:${tt.output}`,ke.type="globstar",ke.output=Ue(X)+(X.strictSlashes?")":"|$)"),ke.value+=Pe,Ce.globstar=!0,Ce.output+=tt.output+ke.output,Yt(Pe);continue}if(tt.type==="slash"&&tt.prev.type!=="bos"&&st[0]==="/"){const Cn=st[1]!==void 0?"|$":"";Ce.output=Ce.output.slice(0,-(tt.output+ke.output).length),tt.output=`(?:${tt.output}`,ke.type="globstar",ke.output=`${Ue(X)}${Ee}|${Ee}${Cn})`,ke.value+=Pe,Ce.output+=tt.output+ke.output,Ce.globstar=!0,Yt(Pe+kt()),St({type:"slash",value:"/",output:""});continue}if(tt.type==="bos"&&st[0]==="/"){ke.type="globstar",ke.value+=Pe,ke.output=`(?:^|${Ee}|${Ue(X)}${Ee})`,Ce.output=ke.output,Ce.globstar=!0,Yt(Pe+kt()),St({type:"slash",value:"/",output:""});continue}Ce.output=Ce.output.slice(0,-ke.output.length),ke.type="globstar",ke.output=Ue(X),ke.value+=Pe,Ce.output+=ke.output,Ce.globstar=!0,Yt(Pe);continue}const zt={type:"star",value:Pe,output:_t};if(X.bash===!0){zt.output=".*?",(ke.type==="bos"||ke.type==="slash")&&(zt.output=ut+zt.output),St(zt);continue}if(ke&&(ke.type==="bracket"||ke.type==="paren")&&X.regex===!0){zt.output=Pe,St(zt);continue}(Ce.index===Ce.start||ke.type==="slash"||ke.type==="dot")&&(ke.type==="dot"?(Ce.output+=it,ke.output+=it):X.dot===!0?(Ce.output+=lt,ke.output+=lt):(Ce.output+=ut,ke.output+=ut),Tt()!=="*"&&(Ce.output+=Ie,ke.output+=Ie)),St(zt)}for(;Ce.brackets>0;){if(X.strictBrackets===!0)throw new SyntaxError(L("closing","]"));Ce.output=W.escapeLast(Ce.output,"["),_r("brackets")}for(;Ce.parens>0;){if(X.strictBrackets===!0)throw new SyntaxError(L("closing",")"));Ce.output=W.escapeLast(Ce.output,"("),_r("parens")}for(;Ce.braces>0;){if(X.strictBrackets===!0)throw new SyntaxError(L("closing","}"));Ce.output=W.escapeLast(Ce.output,"{"),_r("braces")}if(X.strictSlashes!==!0&&(ke.type==="star"||ke.type==="bracket")&&St({type:"maybe_slash",value:"",output:`${Ee}?`}),Ce.backtrack===!0){Ce.output="";for(const st of Ce.tokens)Ce.output+=st.output!=null?st.output:st.value,st.suffix&&(Ce.output+=st.suffix)}return Ce};G.fastpaths=(le,k)=>{const X={...k},Ge=typeof X.maxLength=="number"?Math.min(ne,X.maxLength):ne,Qe=le.length;if(Qe>Ge)throw new SyntaxError(`Input length: ${Qe}, exceeds maximum allowed length: ${Ge}`);le=z[le]||le;const rt=W.isWindows(k),{DOT_LITERAL:ye,SLASH_LITERAL:_e,ONE_CHAR:be,DOTS_SLASH:ae,NO_DOT:ue,NO_DOTS:we,NO_DOTS_SLASH:Re,STAR:Ee,START_ANCHOR:Ie}=$.globChars(rt),Fe=X.dot?we:ue,Ve=X.dot?Re:ue,it=X.capture?"":"?:",lt={negated:!1,prefix:""};let ve=X.bash===!0?".*?":Ee;X.capture&&(ve=`(${ve})`);const je=ut=>ut.noglobstar===!0?ve:`(${it}(?:(?!${Ie}${ut.dot?ae:ye}).)*?)`,Ke=ut=>{switch(ut){case"*":return`${Fe}${be}${ve}`;case".*":return`${ye}${be}${ve}`;case"*.*":return`${Fe}${ve}${ye}${be}${ve}`;case"*/*":return`${Fe}${ve}${_e}${be}${Ve}${ve}`;case"**":return Fe+je(X);case"**/*":return`(?:${Fe}${je(X)}${_e})?${Ve}${be}${ve}`;case"**/*.*":return`(?:${Fe}${je(X)}${_e})?${Ve}${ve}${ye}${be}${ve}`;case"**/.*":return`(?:${Fe}${je(X)}${_e})?${ye}${be}${ve}`;default:{const gt=/^(.*?)\.(\w+)$/.exec(ut);if(!gt)return;const _t=Ke(gt[1]);return _t?_t+ye+gt[2]:void 0}}},We=W.removePrefix(le,lt);let Ue=Ke(We);return Ue&&X.strictSlashes!==!0&&(Ue+=`${_e}?`),Ue},_.exports=G},6087:(_,F,H)=>{"use strict";const $=H(1017),W=H(3921),ne=H(3376),re=H(8702),se=H(1006),oe=U=>U&&typeof U=="object"&&!Array.isArray(U),z=(U,L,G=!1)=>{if(Array.isArray(U)){const _e=U.map(ae=>z(ae,L,G));return ae=>{for(const ue of _e){const we=ue(ae);if(we)return we}return!1}}const le=oe(U)&&U.tokens&&U.input;if(U===""||typeof U!="string"&&!le)throw new TypeError("Expected pattern to be a non-empty string");const k=L||{},X=re.isWindows(L),Ge=le?z.compileRe(U,L):z.makeRe(U,L,!1,!0),Qe=Ge.state;delete Ge.state;let rt=()=>!1;if(k.ignore){const _e={...L,ignore:null,onMatch:null,onResult:null};rt=z(k.ignore,_e,G)}const ye=(_e,be=!1)=>{const{isMatch:ae,match:ue,output:we}=z.test(_e,Ge,L,{glob:U,posix:X}),Re={glob:U,state:Qe,regex:Ge,posix:X,input:_e,output:we,match:ue,isMatch:ae};return typeof k.onResult=="function"&&k.onResult(Re),ae===!1?(Re.isMatch=!1,be?Re:!1):rt(_e)?(typeof k.onIgnore=="function"&&k.onIgnore(Re),Re.isMatch=!1,be?Re:!1):(typeof k.onMatch=="function"&&k.onMatch(Re),be?Re:!0)};return G&&(ye.state=Qe),ye};z.test=(U,L,G,{glob:le,posix:k}={})=>{if(typeof U!="string")throw new TypeError("Expected input to be a string");if(U==="")return{isMatch:!1,output:""};const X=G||{},Ge=X.format||(k?re.toPosixSlashes:null);let Qe=U===le,rt=Qe&&Ge?Ge(U):U;return Qe===!1&&(rt=Ge?Ge(U):U,Qe=rt===le),(Qe===!1||X.capture===!0)&&(X.matchBase===!0||X.basename===!0?Qe=z.matchBase(U,L,G,k):Qe=L.exec(rt)),{isMatch:Boolean(Qe),match:Qe,output:rt}},z.matchBase=(U,L,G,le=re.isWindows(G))=>(L instanceof RegExp?L:z.makeRe(L,G)).test($.basename(U)),z.isMatch=(U,L,G)=>z(L,G)(U),z.parse=(U,L)=>Array.isArray(U)?U.map(G=>z.parse(G,L)):ne(U,{...L,fastpaths:!1}),z.scan=(U,L)=>W(U,L),z.compileRe=(U,L,G=!1,le=!1)=>{if(G===!0)return U.output;const k=L||{},X=k.contains?"":"^",Ge=k.contains?"":"$";let Qe=`${X}(?:${U.output})${Ge}`;U&&U.negated===!0&&(Qe=`^(?!${Qe}).*$`);const rt=z.toRegex(Qe,L);return le===!0&&(rt.state=U),rt},z.makeRe=(U,L={},G=!1,le=!1)=>{if(!U||typeof U!="string")throw new TypeError("Expected a non-empty string");let k={negated:!1,fastpaths:!0};return L.fastpaths!==!1&&(U[0]==="."||U[0]==="*")&&(k.output=ne.fastpaths(U,L)),k.output||(k=ne(U,L)),z.compileRe(k,L,G,le)},z.toRegex=(U,L)=>{try{const G=L||{};return new RegExp(U,G.flags||(G.nocase?"i":""))}catch(G){if(L&&L.debug===!0)throw G;return/$^/}},z.constants=se,_.exports=z},3921:(_,F,H)=>{"use strict";const $=H(8702),{CHAR_ASTERISK:W,CHAR_AT:ne,CHAR_BACKWARD_SLASH:re,CHAR_COMMA:se,CHAR_DOT:oe,CHAR_EXCLAMATION_MARK:z,CHAR_FORWARD_SLASH:U,CHAR_LEFT_CURLY_BRACE:L,CHAR_LEFT_PARENTHESES:G,CHAR_LEFT_SQUARE_BRACKET:le,CHAR_PLUS:k,CHAR_QUESTION_MARK:X,CHAR_RIGHT_CURLY_BRACE:Ge,CHAR_RIGHT_PARENTHESES:Qe,CHAR_RIGHT_SQUARE_BRACKET:rt}=H(1006),ye=ae=>ae===U||ae===re,_e=ae=>{ae.isPrefix!==!0&&(ae.depth=ae.isGlobstar?1/0:1)},be=(ae,ue)=>{const we=ue||{},Re=ae.length-1,Ee=we.parts===!0||we.scanToEnd===!0,Ie=[],Fe=[],Ve=[];let it=ae,lt=-1,ve=0,je=0,Ke=!1,We=!1,Ue=!1,ut=!1,gt=!1,_t=!1,Ce=!1,Rt=!1,Ct=!1,It=!1,ke=0,Pe,vt,Tt={value:"",depth:0,isGlob:!1};const kt=()=>lt>=Re,Tr=()=>it.charCodeAt(lt+1),Yt=()=>(Pe=vt,it.charCodeAt(++lt));for(;lt<Re;){vt=Yt();let St;if(vt===re){Ce=Tt.backslashes=!0,vt=Yt(),vt===L&&(_t=!0);continue}if(_t===!0||vt===L){for(ke++;kt()!==!0&&(vt=Yt());){if(vt===re){Ce=Tt.backslashes=!0,Yt();continue}if(vt===L){ke++;continue}if(_t!==!0&&vt===oe&&(vt=Yt())===oe){if(Ke=Tt.isBrace=!0,Ue=Tt.isGlob=!0,It=!0,Ee===!0)continue;break}if(_t!==!0&&vt===se){if(Ke=Tt.isBrace=!0,Ue=Tt.isGlob=!0,It=!0,Ee===!0)continue;break}if(vt===Ge&&(ke--,ke===0)){_t=!1,Ke=Tt.isBrace=!0,It=!0;break}}if(Ee===!0)continue;break}if(vt===U){if(Ie.push(lt),Fe.push(Tt),Tt={value:"",depth:0,isGlob:!1},It===!0)continue;if(Pe===oe&&lt===ve+1){ve+=2;continue}je=lt+1;continue}if(we.noext!==!0&&(vt===k||vt===ne||vt===W||vt===X||vt===z)===!0&&Tr()===G){if(Ue=Tt.isGlob=!0,ut=Tt.isExtglob=!0,It=!0,vt===z&&lt===ve&&(Ct=!0),Ee===!0){for(;kt()!==!0&&(vt=Yt());){if(vt===re){Ce=Tt.backslashes=!0,vt=Yt();continue}if(vt===Qe){Ue=Tt.isGlob=!0,It=!0;break}}continue}break}if(vt===W){if(Pe===W&&(gt=Tt.isGlobstar=!0),Ue=Tt.isGlob=!0,It=!0,Ee===!0)continue;break}if(vt===X){if(Ue=Tt.isGlob=!0,It=!0,Ee===!0)continue;break}if(vt===le){for(;kt()!==!0&&(St=Yt());){if(St===re){Ce=Tt.backslashes=!0,Yt();continue}if(St===rt){We=Tt.isBracket=!0,Ue=Tt.isGlob=!0,It=!0;break}}if(Ee===!0)continue;break}if(we.nonegate!==!0&&vt===z&&lt===ve){Rt=Tt.negated=!0,ve++;continue}if(we.noparen!==!0&&vt===G){if(Ue=Tt.isGlob=!0,Ee===!0){for(;kt()!==!0&&(vt=Yt());){if(vt===G){Ce=Tt.backslashes=!0,vt=Yt();continue}if(vt===Qe){It=!0;break}}continue}break}if(Ue===!0){if(It=!0,Ee===!0)continue;break}}we.noext===!0&&(ut=!1,Ue=!1);let lr=it,Qn="",Mr="";ve>0&&(Qn=it.slice(0,ve),it=it.slice(ve),je-=ve),lr&&Ue===!0&&je>0?(lr=it.slice(0,je),Mr=it.slice(je)):Ue===!0?(lr="",Mr=it):lr=it,lr&&lr!==""&&lr!=="/"&&lr!==it&&ye(lr.charCodeAt(lr.length-1))&&(lr=lr.slice(0,-1)),we.unescape===!0&&(Mr&&(Mr=$.removeBackslashes(Mr)),lr&&Ce===!0&&(lr=$.removeBackslashes(lr)));const _r={prefix:Qn,input:ae,start:ve,base:lr,glob:Mr,isBrace:Ke,isBracket:We,isGlob:Ue,isExtglob:ut,isGlobstar:gt,negated:Rt,negatedExtglob:Ct};if(we.tokens===!0&&(_r.maxDepth=0,ye(vt)||Fe.push(Tt),_r.tokens=Fe),we.parts===!0||we.tokens===!0){let St;for(let or=0;or<Ie.length;or++){const Xn=St?St+1:ve,st=Ie[or],zt=ae.slice(Xn,st);we.tokens&&(or===0&&ve!==0?(Fe[or].isPrefix=!0,Fe[or].value=Qn):Fe[or].value=zt,_e(Fe[or]),_r.maxDepth+=Fe[or].depth),(or!==0||zt!=="")&&Ve.push(zt),St=st}if(St&&St+1<ae.length){const or=ae.slice(St+1);Ve.push(or),we.tokens&&(Fe[Fe.length-1].value=or,_e(Fe[Fe.length-1]),_r.maxDepth+=Fe[Fe.length-1].depth)}_r.slashes=Ie,_r.parts=Ve}return _r};_.exports=be},8702:(_,F,H)=>{"use strict";const $=H(1017),W=process.platform==="win32",{REGEX_BACKSLASH:ne,REGEX_REMOVE_BACKSLASH:re,REGEX_SPECIAL_CHARS:se,REGEX_SPECIAL_CHARS_GLOBAL:oe}=H(1006);F.isObject=z=>z!==null&&typeof z=="object"&&!Array.isArray(z),F.hasRegexChars=z=>se.test(z),F.isRegexChar=z=>z.length===1&&F.hasRegexChars(z),F.escapeRegex=z=>z.replace(oe,"\\$1"),F.toPosixSlashes=z=>z.replace(ne,"/"),F.removeBackslashes=z=>z.replace(re,U=>U==="\\"?"":U),F.supportsLookbehinds=()=>{const z=process.version.slice(1).split(".").map(Number);return z.length===3&&z[0]>=9||z[0]===8&&z[1]>=10},F.isWindows=z=>z&&typeof z.windows=="boolean"?z.windows:W===!0||$.sep==="\\",F.escapeLast=(z,U,L)=>{const G=z.lastIndexOf(U,L);return G===-1?z:z[G-1]==="\\"?F.escapeLast(z,U,G-1):`${z.slice(0,G)}\\${z.slice(G)}`},F.removePrefix=(z,U={})=>{let L=z;return L.startsWith("./")&&(L=L.slice(2),U.prefix="./"),L},F.wrapOutput=(z,U={},L={})=>{const G=L.contains?"":"^",le=L.contains?"":"$";let k=`${G}(?:${z})${le}`;return U.negated===!0&&(k=`(?:^(?!${k}).*$)`),k}},842:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.AbstractTokenizer=void 0;const $=H(5167);class W{constructor(re){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=re||{}}async readToken(re,se=this.position){const oe=Buffer.alloc(re.len);if(await this.readBuffer(oe,{position:se})<re.len)throw new $.EndOfStreamError;return re.get(oe,0)}async peekToken(re,se=this.position){const oe=Buffer.alloc(re.len);if(await this.peekBuffer(oe,{position:se})<re.len)throw new $.EndOfStreamError;return re.get(oe,0)}async readNumber(re){if(await this.readBuffer(this.numBuffer,{length:re.len})<re.len)throw new $.EndOfStreamError;return re.get(this.numBuffer,0)}async peekNumber(re){if(await this.peekBuffer(this.numBuffer,{length:re.len})<re.len)throw new $.EndOfStreamError;return re.get(this.numBuffer,0)}async ignore(re){if(this.fileInfo.size!==void 0){const se=this.fileInfo.size-this.position;if(re>se)return this.position+=se,se}return this.position+=re,re}async close(){}normalizeOptions(re,se){if(se&&se.position!==void 0&&se.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return se?{mayBeLess:se.mayBeLess===!0,offset:se.offset?se.offset:0,length:se.length?se.length:re.length-(se.offset?se.offset:0),position:se.position?se.position:this.position}:{mayBeLess:!1,offset:0,length:re.length,position:this.position}}}F.AbstractTokenizer=W},778:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.BufferTokenizer=void 0;const $=H(5167),W=H(842);class ne extends W.AbstractTokenizer{constructor(se,oe){super(oe);this.uint8Array=se,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:se.length}async readBuffer(se,oe){if(oe&&oe.position){if(oe.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=oe.position}const z=await this.peekBuffer(se,oe);return this.position+=z,z}async peekBuffer(se,oe){const z=this.normalizeOptions(se,oe),U=Math.min(this.uint8Array.length-z.position,z.length);if(!z.mayBeLess&&U<z.length)throw new $.EndOfStreamError;return se.set(this.uint8Array.subarray(z.position,z.position+U),z.offset),U}async close(){}}F.BufferTokenizer=ne},7859:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.fromFile=F.FileTokenizer=void 0;const $=H(842),W=H(5167),ne=H(7209);class re extends $.AbstractTokenizer{constructor(z,U){super(U);this.fd=z}async readBuffer(z,U){const L=this.normalizeOptions(z,U);this.position=L.position;const G=await ne.read(this.fd,z,L.offset,L.length,L.position);if(this.position+=G.bytesRead,G.bytesRead<L.length&&(!U||!U.mayBeLess))throw new W.EndOfStreamError;return G.bytesRead}async peekBuffer(z,U){const L=this.normalizeOptions(z,U),G=await ne.read(this.fd,z,L.offset,L.length,L.position);if(!L.mayBeLess&&G.bytesRead<L.length)throw new W.EndOfStreamError;return G.bytesRead}async close(){return ne.close(this.fd)}}F.FileTokenizer=re;async function se(oe){const z=await ne.stat(oe);if(!z.isFile)throw new Error(`File not a file: ${oe}`);const U=await ne.open(oe,"r");return new re(U,{path:oe,size:z.size})}F.fromFile=se},7209:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.readFile=F.writeFileSync=F.writeFile=F.read=F.open=F.close=F.stat=F.createReadStream=F.pathExists=void 0;const $=H(7147);F.pathExists=$.existsSync,F.createReadStream=$.createReadStream;async function W(L){return new Promise((G,le)=>{$.stat(L,(k,X)=>{k?le(k):G(X)})})}F.stat=W;async function ne(L){return new Promise((G,le)=>{$.close(L,k=>{k?le(k):G()})})}F.close=ne;async function re(L,G){return new Promise((le,k)=>{$.open(L,G,(X,Ge)=>{X?k(X):le(Ge)})})}F.open=re;async function se(L,G,le,k,X){return new Promise((Ge,Qe)=>{$.read(L,G,le,k,X,(rt,ye,_e)=>{rt?Qe(rt):Ge({bytesRead:ye,buffer:_e})})})}F.read=se;async function oe(L,G){return new Promise((le,k)=>{$.writeFile(L,G,X=>{X?k(X):le()})})}F.writeFile=oe;function z(L,G){$.writeFileSync(L,G)}F.writeFileSync=z;async function U(L){return new Promise((G,le)=>{$.readFile(L,(k,X)=>{k?le(k):G(X)})})}F.readFile=U},599:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.ReadStreamTokenizer=void 0;const $=H(842),W=H(5167),ne=256e3;class re extends $.AbstractTokenizer{constructor(oe,z){super(z);this.streamReader=new W.StreamReader(oe)}async getFileInfo(){return this.fileInfo}async readBuffer(oe,z){const U=this.normalizeOptions(oe,z),L=U.position-this.position;if(L>0)return await this.ignore(L),this.readBuffer(oe,z);if(L<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(U.length===0)return 0;const G=await this.streamReader.read(oe,U.offset,U.length);if(this.position+=G,(!z||!z.mayBeLess)&&G<U.length)throw new W.EndOfStreamError;return G}async peekBuffer(oe,z){const U=this.normalizeOptions(oe,z);let L=0;if(U.position){const G=U.position-this.position;if(G>0){const le=new Uint8Array(U.length+G);return L=await this.peekBuffer(le,{mayBeLess:U.mayBeLess}),oe.set(le.subarray(G),U.offset),L-G}else if(G<0)throw new Error("Cannot peek from a negative offset in a stream")}if(U.length>0){try{L=await this.streamReader.peek(oe,U.offset,U.length)}catch(G){if(z&&z.mayBeLess&&G instanceof W.EndOfStreamError)return 0;throw G}if(!U.mayBeLess&&L<U.length)throw new W.EndOfStreamError}return L}async ignore(oe){const z=Math.min(ne,oe),U=new Uint8Array(z);let L=0;for(;L<oe;){const G=oe-L,le=await this.readBuffer(U,{length:Math.min(z,G)});if(le<0)return le;L+=le}return L}}F.ReadStreamTokenizer=re},5849:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.fromBuffer=F.fromStream=F.EndOfStreamError=void 0;const $=H(599),W=H(778);var ne=H(5167);Object.defineProperty(F,"EndOfStreamError",{enumerable:!0,get:function(){return ne.EndOfStreamError}});function re(oe,z){return z=z||{},new $.ReadStreamTokenizer(oe,z)}F.fromStream=re;function se(oe,z){return new W.BufferTokenizer(oe,z)}F.fromBuffer=se},6597:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.fromStream=F.fromBuffer=F.EndOfStreamError=F.fromFile=void 0;const $=H(7209),W=H(5849);var ne=H(7859);Object.defineProperty(F,"fromFile",{enumerable:!0,get:function(){return ne.fromFile}});var re=H(5849);Object.defineProperty(F,"EndOfStreamError",{enumerable:!0,get:function(){return re.EndOfStreamError}}),Object.defineProperty(F,"fromBuffer",{enumerable:!0,get:function(){return re.fromBuffer}});async function se(oe,z){if(z=z||{},oe.path){const U=await $.stat(oe.path);z.path=oe.path,z.size=U.size}return W.fromStream(oe,z)}F.fromStream=se},5702:(_,F,H)=>{"use strict";/*!
 * to-regex-range <https://github.com/micromatch/to-regex-range>
 *
 * Copyright (c) 2015-present, Jon Schlinkert.
 * Released under the MIT License.
 */const $=H(9924),W=(ye,_e,be)=>{if($(ye)===!1)throw new TypeError("toRegexRange: expected the first argument to be a number");if(_e===void 0||ye===_e)return String(ye);if($(_e)===!1)throw new TypeError("toRegexRange: expected the second argument to be a number.");let ae={relaxZeros:!0,...be};typeof ae.strictZeros=="boolean"&&(ae.relaxZeros=ae.strictZeros===!1);let ue=String(ae.relaxZeros),we=String(ae.shorthand),Re=String(ae.capture),Ee=String(ae.wrap),Ie=ye+":"+_e+"="+ue+we+Re+Ee;if(W.cache.hasOwnProperty(Ie))return W.cache[Ie].result;let Fe=Math.min(ye,_e),Ve=Math.max(ye,_e);if(Math.abs(Fe-Ve)===1){let Ke=ye+"|"+_e;return ae.capture?`(${Ke})`:ae.wrap===!1?Ke:`(?:${Ke})`}let it=Qe(ye)||Qe(_e),lt={min:ye,max:_e,a:Fe,b:Ve},ve=[],je=[];if(it&&(lt.isPadded=it,lt.maxLen=String(lt.max).length),Fe<0){let Ke=Ve<0?Math.abs(Ve):1;je=oe(Ke,Math.abs(Fe),lt,ae),Fe=lt.a=0}return Ve>=0&&(ve=oe(Fe,Ve,lt,ae)),lt.negatives=je,lt.positives=ve,lt.result=ne(je,ve,ae),ae.capture===!0?lt.result=`(${lt.result})`:ae.wrap!==!1&&ve.length+je.length>1&&(lt.result=`(?:${lt.result})`),W.cache[Ie]=lt,lt.result};function ne(ye,_e,be){let ae=z(ye,_e,"-",!1,be)||[],ue=z(_e,ye,"",!1,be)||[],we=z(ye,_e,"-?",!0,be)||[];return ae.concat(we).concat(ue).join("|")}function re(ye,_e){let be=1,ae=1,ue=le(ye,be),we=new Set([_e]);for(;ye<=ue&&ue<=_e;)we.add(ue),be+=1,ue=le(ye,be);for(ue=k(_e+1,ae)-1;ye<ue&&ue<=_e;)we.add(ue),ae+=1,ue=k(_e+1,ae)-1;return we=[...we],we.sort(L),we}function se(ye,_e,be){if(ye===_e)return{pattern:ye,count:[],digits:0};let ae=U(ye,_e),ue=ae.length,we="",Re=0;for(let Ee=0;Ee<ue;Ee++){let[Ie,Fe]=ae[Ee];Ie===Fe?we+=Ie:Ie!=="0"||Fe!=="9"?we+=Ge(Ie,Fe,be):Re++}return Re&&(we+=be.shorthand===!0?"\\d":"[0-9]"),{pattern:we,count:[Re],digits:ue}}function oe(ye,_e,be,ae){let ue=re(ye,_e),we=[],Re=ye,Ee;for(let Ie=0;Ie<ue.length;Ie++){let Fe=ue[Ie],Ve=se(String(Re),String(Fe),ae),it="";if(!be.isPadded&&Ee&&Ee.pattern===Ve.pattern){Ee.count.length>1&&Ee.count.pop(),Ee.count.push(Ve.count[0]),Ee.string=Ee.pattern+X(Ee.count),Re=Fe+1;continue}be.isPadded&&(it=rt(Fe,be,ae)),Ve.string=it+Ve.pattern+X(Ve.count),we.push(Ve),Re=Fe+1,Ee=Ve}return we}function z(ye,_e,be,ae,ue){let we=[];for(let Re of ye){let{string:Ee}=Re;!ae&&!G(_e,"string",Ee)&&we.push(be+Ee),ae&&G(_e,"string",Ee)&&we.push(be+Ee)}return we}function U(ye,_e){let be=[];for(let ae=0;ae<ye.length;ae++)be.push([ye[ae],_e[ae]]);return be}function L(ye,_e){return ye>_e?1:_e>ye?-1:0}function G(ye,_e,be){return ye.some(ae=>ae[_e]===be)}function le(ye,_e){return Number(String(ye).slice(0,-_e)+"9".repeat(_e))}function k(ye,_e){return ye-ye%Math.pow(10,_e)}function X(ye){let[_e=0,be=""]=ye;return be||_e>1?`{${_e+(be?","+be:"")}}`:""}function Ge(ye,_e,be){return`[${ye}${_e-ye==1?"":"-"}${_e}]`}function Qe(ye){return/^-?(0+)\d/.test(ye)}function rt(ye,_e,be){if(!_e.isPadded)return ye;let ae=Math.abs(_e.maxLen-String(ye).length),ue=be.relaxZeros!==!1;switch(ae){case 0:return"";case 1:return ue?"0?":"0";case 2:return ue?"0{0,2}":"00";default:return ue?`0{0,${ae}}`:`0{${ae}}`}}W.cache={},W.clearCache=()=>W.cache={},_.exports=W},3416:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.AnsiStringType=F.StringType=F.BufferType=F.Uint8ArrayType=F.IgnoreType=F.Float80_LE=F.Float80_BE=F.Float64_LE=F.Float64_BE=F.Float32_LE=F.Float32_BE=F.Float16_LE=F.Float16_BE=F.INT64_BE=F.UINT64_BE=F.INT64_LE=F.UINT64_LE=F.INT32_LE=F.INT32_BE=F.INT24_BE=F.INT24_LE=F.INT16_LE=F.INT16_BE=F.INT8=F.UINT32_BE=F.UINT32_LE=F.UINT24_BE=F.UINT24_LE=F.UINT16_BE=F.UINT16_LE=F.UINT8=void 0;const $=H(645);function W(U){return new DataView(U.buffer,U.byteOffset)}F.UINT8={len:1,get(U,L){return W(U).getUint8(L)},put(U,L,G){return W(U).setUint8(L,G),L+1}},F.UINT16_LE={len:2,get(U,L){return W(U).getUint16(L,!0)},put(U,L,G){return W(U).setUint16(L,G,!0),L+2}},F.UINT16_BE={len:2,get(U,L){return W(U).getUint16(L)},put(U,L,G){return W(U).setUint16(L,G),L+2}},F.UINT24_LE={len:3,get(U,L){const G=W(U);return G.getUint8(L)+(G.getUint16(L+1,!0)<<8)},put(U,L,G){const le=W(U);return le.setUint8(L,G&255),le.setUint16(L+1,G>>8,!0),L+3}},F.UINT24_BE={len:3,get(U,L){const G=W(U);return(G.getUint16(L)<<8)+G.getUint8(L+2)},put(U,L,G){const le=W(U);return le.setUint16(L,G>>8),le.setUint8(L+2,G&255),L+3}},F.UINT32_LE={len:4,get(U,L){return W(U).getUint32(L,!0)},put(U,L,G){return W(U).setUint32(L,G,!0),L+4}},F.UINT32_BE={len:4,get(U,L){return W(U).getUint32(L)},put(U,L,G){return W(U).setUint32(L,G),L+4}},F.INT8={len:1,get(U,L){return W(U).getInt8(L)},put(U,L,G){return W(U).setInt8(L,G),L+2}},F.INT16_BE={len:2,get(U,L){return W(U).getInt16(L)},put(U,L,G){return W(U).setInt16(L,G),L+2}},F.INT16_LE={len:2,get(U,L){return W(U).getInt16(L,!0)},put(U,L,G){return W(U).setInt16(L,G,!0),L+2}},F.INT24_LE={len:3,get(U,L){const G=F.UINT24_LE.get(U,L);return G>8388607?G-16777216:G},put(U,L,G){const le=W(U);return le.setUint8(L,G&255),le.setUint16(L+1,G>>8,!0),L+3}},F.INT24_BE={len:3,get(U,L){const G=F.UINT24_BE.get(U,L);return G>8388607?G-16777216:G},put(U,L,G){const le=W(U);return le.setUint16(L,G>>8),le.setUint8(L+2,G&255),L+3}},F.INT32_BE={len:4,get(U,L){return W(U).getInt32(L)},put(U,L,G){return W(U).setInt32(L,G),L+4}},F.INT32_LE={len:4,get(U,L){return W(U).getInt32(L,!0)},put(U,L,G){return W(U).setInt32(L,G,!0),L+4}},F.UINT64_LE={len:8,get(U,L){return W(U).getBigUint64(L,!0)},put(U,L,G){return W(U).setBigUint64(L,G,!0),L+8}},F.INT64_LE={len:8,get(U,L){return W(U).getBigInt64(L,!0)},put(U,L,G){return W(U).setBigInt64(L,G,!0),L+8}},F.UINT64_BE={len:8,get(U,L){return W(U).getBigUint64(L)},put(U,L,G){return W(U).setBigUint64(L,G),L+8}},F.INT64_BE={len:8,get(U,L){return W(U).getBigInt64(L)},put(U,L,G){return W(U).setBigInt64(L,G),L+8}},F.Float16_BE={len:2,get(U,L){return $.read(U,L,!1,10,this.len)},put(U,L,G){return $.write(U,G,L,!1,10,this.len),L+this.len}},F.Float16_LE={len:2,get(U,L){return $.read(U,L,!0,10,this.len)},put(U,L,G){return $.write(U,G,L,!0,10,this.len),L+this.len}},F.Float32_BE={len:4,get(U,L){return W(U).getFloat32(L)},put(U,L,G){return W(U).setFloat32(L,G),L+4}},F.Float32_LE={len:4,get(U,L){return W(U).getFloat32(L,!0)},put(U,L,G){return W(U).setFloat32(L,G,!0),L+4}},F.Float64_BE={len:8,get(U,L){return W(U).getFloat64(L)},put(U,L,G){return W(U).setFloat64(L,G),L+8}},F.Float64_LE={len:8,get(U,L){return W(U).getFloat64(L,!0)},put(U,L,G){return W(U).setFloat64(L,G,!0),L+8}},F.Float80_BE={len:10,get(U,L){return $.read(U,L,!1,63,this.len)},put(U,L,G){return $.write(U,G,L,!1,63,this.len),L+this.len}},F.Float80_LE={len:10,get(U,L){return $.read(U,L,!0,63,this.len)},put(U,L,G){return $.write(U,G,L,!0,63,this.len),L+this.len}};class ne{constructor(L){this.len=L}get(L,G){}}F.IgnoreType=ne;class re{constructor(L){this.len=L}get(L,G){return L.subarray(G,G+this.len)}}F.Uint8ArrayType=re;class se{constructor(L){this.len=L}get(L,G){return L.slice(G,G+this.len)}}F.BufferType=se;class oe{constructor(L,G){this.len=L,this.encoding=G}get(L,G){return Buffer.from(L).toString(this.encoding,G,G+this.len)}}F.StringType=oe;class z{constructor(L){this.len=L}static decode(L,G,le){let k="";for(let X=G;X<le;++X)k+=z.codePointToString(z.singleByteDecoder(L[X]));return k}static inRange(L,G,le){return G<=L&&L<=le}static codePointToString(L){return L<=65535?String.fromCharCode(L):(L-=65536,String.fromCharCode((L>>10)+55296,(L&1023)+56320))}static singleByteDecoder(L){if(z.inRange(L,0,127))return L;const G=z.windows1252[L-128];if(G===null)throw Error("invaliding encoding");return G}get(L,G=0){return z.decode(L,G,G+this.len)}}F.AnsiStringType=z,z.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]},8361:(_,F,H)=>{var $=Object.create,W=Object.defineProperty,ne=Object.getOwnPropertyDescriptor,re=Object.getOwnPropertyNames,se=Object.getOwnPropertySymbols,oe=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,L=(s,x,o)=>x in s?W(s,x,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[x]=o,G=(s,x)=>{for(var o in x||(x={}))z.call(x,o)&&L(s,o,x[o]);if(se)for(var o of se(x))U.call(x,o)&&L(s,o,x[o]);return s},le=s=>W(s,"__esModule",{value:!0}),k=(s,x)=>()=>(x||s((x={exports:{}}).exports,x),x.exports),X=(s,x)=>{le(s);for(var o in x)W(s,o,{get:x[o],enumerable:!0})},Ge=(s,x,o)=>{if(x&&typeof x=="object"||typeof x=="function")for(let c of re(x))!z.call(s,c)&&c!=="default"&&W(s,c,{get:()=>x[c],enumerable:!(o=ne(x,c))||o.enumerable});return s},Qe=s=>Ge(le(W(s!=null?$(oe(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s),rt=k((s,x)=>{"use strict";var o=function(){function c(){}return c.info=function(f){for(var u=[],h=1;h<arguments.length;h++)u[h-1]=arguments[h];c.enableDebug&&console.info(c.TAG+f,u)},c.warn=function(f){for(var u=[],h=1;h<arguments.length;h++)u[h-1]=arguments[h];c.disableWarnings||console.warn(c.TAG+f,u)},c.enableDebug=!1,c.disableWarnings=!1,c.disableErrors=!1,c.TAG="ApplicationInsights:",c}();x.exports=o}),ye=k(s=>{"use strict";var x=s&&s.__assign||function(){return x=Object.assign||function(u){for(var h,p=1,g=arguments.length;p<g;p++){h=arguments[p];for(var b in h)Object.prototype.hasOwnProperty.call(h,b)&&(u[b]=h[b])}return u},x.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.AsyncScopeManager=s.OpenTelemetryScopeManagerWrapper=void 0;var o=Di(),c=H(2361),f=function(){function u(){}return u.prototype.active=function(){var h=this,p=o.CorrelationContextManager.getCurrentContext();return x(x({},p),{getValue:function(g){return h._activeSymbol?g===h._activeSymbol?p:!1:(h._activeSymbol=g,p)},setValue:function(){}})},u.prototype.with=function(h,p){var g=h.parentSpanId,b=h.name,w=u._spanToContext(h,g,b);return o.CorrelationContextManager.runWithContext(w,p)()},u.prototype.bind=function(h){return typeof h=="function"?o.CorrelationContextManager.wrapCallback(h):(h instanceof c.EventEmitter&&o.CorrelationContextManager.wrapEmitter(h),h)},u.prototype.enable=function(){return o.CorrelationContextManager.enable(),this},u.prototype.disable=function(){return o.CorrelationContextManager.disable(),this},u._spanToContext=function(h,p,g){var b=p?"|"+h.spanContext().traceId+"."+p+".":h.spanContext().traceId,w=x(x({},h.spanContext()),{traceFlags:h.spanContext().traceFlags}),y=o.CorrelationContextManager.spanToContextObject(w,b,g);return y},u}();s.OpenTelemetryScopeManagerWrapper=f,s.AsyncScopeManager=new f}),_e=k((s,x)=>{s=x.exports=Lt;var o;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?o=function(){var Y=Array.prototype.slice.call(arguments,0);Y.unshift("SEMVER"),console.log.apply(console,Y)}:o=function(){},s.SEMVER_SPEC_VERSION="2.0.0";var c=256,f=Number.MAX_SAFE_INTEGER||9007199254740991,u=16,h=s.re=[],p=s.src=[],g=0,b=g++;p[b]="0|[1-9]\\d*";var w=g++;p[w]="[0-9]+";var y=g++;p[y]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var S=g++;p[S]="("+p[b]+")\\.("+p[b]+")\\.("+p[b]+")";var C=g++;p[C]="("+p[w]+")\\.("+p[w]+")\\.("+p[w]+")";var T=g++;p[T]="(?:"+p[b]+"|"+p[y]+")";var A=g++;p[A]="(?:"+p[w]+"|"+p[y]+")";var O=g++;p[O]="(?:-("+p[T]+"(?:\\."+p[T]+")*))";var D=g++;p[D]="(?:-?("+p[A]+"(?:\\."+p[A]+")*))";var q=g++;p[q]="[0-9A-Za-z-]+";var Q=g++;p[Q]="(?:\\+("+p[q]+"(?:\\."+p[q]+")*))";var V=g++,ie="v?"+p[S]+p[O]+"?"+p[Q]+"?";p[V]="^"+ie+"$";var pe="[v=\\s]*"+p[C]+p[D]+"?"+p[Q]+"?",me=g++;p[me]="^"+pe+"$";var Se=g++;p[Se]="((?:<|>)?=?)";var He=g++;p[He]=p[w]+"|x|X|\\*";var ze=g++;p[ze]=p[b]+"|x|X|\\*";var ot=g++;p[ot]="[v=\\s]*("+p[ze]+")(?:\\.("+p[ze]+")(?:\\.("+p[ze]+")(?:"+p[O]+")?"+p[Q]+"?)?)?";var mt=g++;p[mt]="[v=\\s]*("+p[He]+")(?:\\.("+p[He]+")(?:\\.("+p[He]+")(?:"+p[D]+")?"+p[Q]+"?)?)?";var Nt=g++;p[Nt]="^"+p[Se]+"\\s*"+p[ot]+"$";var Pt=g++;p[Pt]="^"+p[Se]+"\\s*"+p[mt]+"$";var Zt=g++;p[Zt]="(?:^|[^\\d])(\\d{1,"+u+"})(?:\\.(\\d{1,"+u+"}))?(?:\\.(\\d{1,"+u+"}))?(?:$|[^\\d])";var $t=g++;p[$t]="(?:~>?)";var Xe=g++;p[Xe]="(\\s*)"+p[$t]+"\\s+",h[Xe]=new RegExp(p[Xe],"g");var at="$1~",Ne=g++;p[Ne]="^"+p[$t]+p[ot]+"$";var ht=g++;p[ht]="^"+p[$t]+p[mt]+"$";var dt=g++;p[dt]="(?:\\^)";var jt=g++;p[jt]="(\\s*)"+p[dt]+"\\s+",h[jt]=new RegExp(p[jt],"g");var wt="$1^",er=g++;p[er]="^"+p[dt]+p[ot]+"$";var hr=g++;p[hr]="^"+p[dt]+p[mt]+"$";var he=g++;p[he]="^"+p[Se]+"\\s*("+pe+")$|^$";var mr=g++;p[mr]="^"+p[Se]+"\\s*("+ie+")$|^$";var Oe=g++;p[Oe]="(\\s*)"+p[Se]+"\\s*("+pe+"|"+p[ot]+")",h[Oe]=new RegExp(p[Oe],"g");var fr="$1$2$3",Hr=g++;p[Hr]="^\\s*("+p[ot]+")\\s+-\\s+("+p[ot]+")\\s*$";var bt=g++;p[bt]="^\\s*("+p[mt]+")\\s+-\\s+("+p[mt]+")\\s*$";var xt=g++;for(p[xt]="(<|>)?=?\\s*\\*",tr=0;tr<g;tr++)o(tr,p[tr]),h[tr]||(h[tr]=new RegExp(p[tr]));var tr;s.parse=Sr;function Sr(Y,de){if((!de||typeof de!="object")&&(de={loose:!!de,includePrerelease:!1}),Y instanceof Lt)return Y;if(typeof Y!="string"||Y.length>c)return null;var ce=de.loose?h[me]:h[V];if(!ce.test(Y))return null;try{return new Lt(Y,de)}catch(Ze){return null}}s.valid=pa;function pa(Y,de){var ce=Sr(Y,de);return ce?ce.version:null}s.clean=An;function An(Y,de){var ce=Sr(Y.trim().replace(/^[=v]+/,""),de);return ce?ce.version:null}s.SemVer=Lt;function Lt(Y,de){if((!de||typeof de!="object")&&(de={loose:!!de,includePrerelease:!1}),Y instanceof Lt){if(Y.loose===de.loose)return Y;Y=Y.version}else if(typeof Y!="string")throw new TypeError("Invalid Version: "+Y);if(Y.length>c)throw new TypeError("version is longer than "+c+" characters");if(!(this instanceof Lt))return new Lt(Y,de);o("SemVer",Y,de),this.options=de,this.loose=!!de.loose;var ce=Y.trim().match(de.loose?h[me]:h[V]);if(!ce)throw new TypeError("Invalid Version: "+Y);if(this.raw=Y,this.major=+ce[1],this.minor=+ce[2],this.patch=+ce[3],this.major>f||this.major<0)throw new TypeError("Invalid major version");if(this.minor>f||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>f||this.patch<0)throw new TypeError("Invalid patch version");ce[4]?this.prerelease=ce[4].split(".").map(function(Ze){if(/^[0-9]+$/.test(Ze)){var nt=+Ze;if(nt>=0&&nt<f)return nt}return Ze}):this.prerelease=[],this.build=ce[5]?ce[5].split("."):[],this.format()}Lt.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Lt.prototype.toString=function(){return this.version},Lt.prototype.compare=function(Y){return o("SemVer.compare",this.version,this.options,Y),Y instanceof Lt||(Y=new Lt(Y,this.options)),this.compareMain(Y)||this.comparePre(Y)},Lt.prototype.compareMain=function(Y){return Y instanceof Lt||(Y=new Lt(Y,this.options)),ct(this.major,Y.major)||ct(this.minor,Y.minor)||ct(this.patch,Y.patch)},Lt.prototype.comparePre=function(Y){if(Y instanceof Lt||(Y=new Lt(Y,this.options)),this.prerelease.length&&!Y.prerelease.length)return-1;if(!this.prerelease.length&&Y.prerelease.length)return 1;if(!this.prerelease.length&&!Y.prerelease.length)return 0;var de=0;do{var ce=this.prerelease[de],Ze=Y.prerelease[de];if(o("prerelease compare",de,ce,Ze),ce===void 0&&Ze===void 0)return 0;if(Ze===void 0)return 1;if(ce===void 0)return-1;if(ce!==Ze)return ct(ce,Ze)}while(++de)},Lt.prototype.inc=function(Y,de){switch(Y){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",de);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",de);break;case"prepatch":this.prerelease.length=0,this.inc("patch",de),this.inc("pre",de);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",de),this.inc("pre",de);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var ce=this.prerelease.length;--ce>=0;)typeof this.prerelease[ce]=="number"&&(this.prerelease[ce]++,ce=-2);ce===-1&&this.prerelease.push(0)}de&&(this.prerelease[0]===de?isNaN(this.prerelease[1])&&(this.prerelease=[de,0]):this.prerelease=[de,0]);break;default:throw new Error("invalid increment argument: "+Y)}return this.format(),this.raw=this.version,this},s.inc=fs;function fs(Y,de,ce,Ze){typeof ce=="string"&&(Ze=ce,ce=void 0);try{return new Lt(Y,ce).inc(de,Ze).version}catch(nt){return null}}s.diff=fo;function fo(Y,de){if(di(Y,de))return null;var ce=Sr(Y),Ze=Sr(de),nt="";if(ce.prerelease.length||Ze.prerelease.length){nt="pre";var ft="prerelease"}for(var yt in ce)if((yt==="major"||yt==="minor"||yt==="patch")&&ce[yt]!==Ze[yt])return nt+yt;return ft}s.compareIdentifiers=ct;var Gt=/^[0-9]+$/;function ct(Y,de){var ce=Gt.test(Y),Ze=Gt.test(de);return ce&&Ze&&(Y=+Y,de=+de),Y===de?0:ce&&!Ze?-1:Ze&&!ce?1:Y<de?-1:1}s.rcompareIdentifiers=Ur;function Ur(Y,de){return ct(de,Y)}s.major=en;function en(Y,de){return new Lt(Y,de).major}s.minor=Ni;function Ni(Y,de){return new Lt(Y,de).minor}s.patch=Mi;function Mi(Y,de){return new Lt(Y,de).patch}s.compare=tn;function tn(Y,de,ce){return new Lt(Y,ce).compare(new Lt(de,ce))}s.compareLoose=li;function li(Y,de){return tn(Y,de,!0)}s.rcompare=Hn;function Hn(Y,de,ce){return tn(de,Y,ce)}s.sort=Li;function Li(Y,de){return Y.sort(function(ce,Ze){return s.compare(ce,Ze,de)})}s.rsort=ui;function ui(Y,de){return Y.sort(function(ce,Ze){return s.rcompare(ce,Ze,de)})}s.gt=rn;function rn(Y,de,ce){return tn(Y,de,ce)>0}s.lt=In;function In(Y,de,ce){return tn(Y,de,ce)<0}s.eq=di;function di(Y,de,ce){return tn(Y,de,ce)===0}s.neq=Pn;function Pn(Y,de,ce){return tn(Y,de,ce)!==0}s.gte=ps;function ps(Y,de,ce){return tn(Y,de,ce)>=0}s.lte=Rr;function Rr(Y,de,ce){return tn(Y,de,ce)<=0}s.cmp=hi;function hi(Y,de,ce,Ze){switch(de){case"===":return typeof Y=="object"&&(Y=Y.version),typeof ce=="object"&&(ce=ce.version),Y===ce;case"!==":return typeof Y=="object"&&(Y=Y.version),typeof ce=="object"&&(ce=ce.version),Y!==ce;case"":case"=":case"==":return di(Y,ce,Ze);case"!=":return Pn(Y,ce,Ze);case">":return rn(Y,ce,Ze);case">=":return ps(Y,ce,Ze);case"<":return In(Y,ce,Ze);case"<=":return Rr(Y,ce,Ze);default:throw new TypeError("Invalid operator: "+de)}}s.Comparator=nn;function nn(Y,de){if((!de||typeof de!="object")&&(de={loose:!!de,includePrerelease:!1}),Y instanceof nn){if(Y.loose===!!de.loose)return Y;Y=Y.value}if(!(this instanceof nn))return new nn(Y,de);o("comparator",Y,de),this.options=de,this.loose=!!de.loose,this.parse(Y),this.semver===pr?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}var pr={};nn.prototype.parse=function(Y){var de=this.options.loose?h[he]:h[mr],ce=Y.match(de);if(!ce)throw new TypeError("Invalid comparator: "+Y);this.operator=ce[1],this.operator==="="&&(this.operator=""),ce[2]?this.semver=new Lt(ce[2],this.options.loose):this.semver=pr},nn.prototype.toString=function(){return this.value},nn.prototype.test=function(Y){return o("Comparator.test",Y,this.options.loose),this.semver===pr?!0:(typeof Y=="string"&&(Y=new Lt(Y,this.options)),hi(Y,this.operator,this.semver,this.options))},nn.prototype.intersects=function(Y,de){if(!(Y instanceof nn))throw new TypeError("a Comparator is required");(!de||typeof de!="object")&&(de={loose:!!de,includePrerelease:!1});var ce;if(this.operator==="")return ce=new Ye(Y.value,de),va(this.value,ce,de);if(Y.operator==="")return ce=new Ye(this.value,de),va(Y.semver,ce,de);var Ze=(this.operator===">="||this.operator===">")&&(Y.operator===">="||Y.operator===">"),nt=(this.operator==="<="||this.operator==="<")&&(Y.operator==="<="||Y.operator==="<"),ft=this.semver.version===Y.semver.version,yt=(this.operator===">="||this.operator==="<=")&&(Y.operator===">="||Y.operator==="<="),Ht=hi(this.semver,"<",Y.semver,de)&&(this.operator===">="||this.operator===">")&&(Y.operator==="<="||Y.operator==="<"),Ut=hi(this.semver,">",Y.semver,de)&&(this.operator==="<="||this.operator==="<")&&(Y.operator===">="||Y.operator===">");return Ze||nt||ft&&yt||Ht||Ut},s.Range=Ye;function Ye(Y,de){if((!de||typeof de!="object")&&(de={loose:!!de,includePrerelease:!1}),Y instanceof Ye)return Y.loose===!!de.loose&&Y.includePrerelease===!!de.includePrerelease?Y:new Ye(Y.raw,de);if(Y instanceof nn)return new Ye(Y.value,de);if(!(this instanceof Ye))return new Ye(Y,de);if(this.options=de,this.loose=!!de.loose,this.includePrerelease=!!de.includePrerelease,this.raw=Y,this.set=Y.split(/\s*\|\|\s*/).map(function(ce){return this.parseRange(ce.trim())},this).filter(function(ce){return ce.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+Y);this.format()}Ye.prototype.format=function(){return this.range=this.set.map(function(Y){return Y.join(" ").trim()}).join("||").trim(),this.range},Ye.prototype.toString=function(){return this.range},Ye.prototype.parseRange=function(Y){var de=this.options.loose;Y=Y.trim();var ce=de?h[bt]:h[Hr];Y=Y.replace(ce,Jl),o("hyphen replace",Y),Y=Y.replace(h[Oe],fr),o("comparator trim",Y,h[Oe]),Y=Y.replace(h[Xe],at),Y=Y.replace(h[jt],wt),Y=Y.split(/\s+/).join(" ");var Ze=de?h[he]:h[mr],nt=Y.split(" ").map(function(ft){return po(ft,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(nt=nt.filter(function(ft){return!!ft.match(Ze)})),nt=nt.map(function(ft){return new nn(ft,this.options)},this),nt},Ye.prototype.intersects=function(Y,de){if(!(Y instanceof Ye))throw new TypeError("a Range is required");return this.set.some(function(ce){return ce.every(function(Ze){return Y.set.some(function(nt){return nt.every(function(ft){return Ze.intersects(ft,de)})})})})},s.toComparators=Dr;function Dr(Y,de){return new Ye(Y,de).set.map(function(ce){return ce.map(function(Ze){return Ze.value}).join(" ").trim().split(" ")})}function po(Y,de){return o("comp",Y,de),Y=Bt(Y,de),o("caret",Y),Y=Er(Y,de),o("tildes",Y),Y=jr(Y,de),o("xrange",Y),Y=vn(Y,de),o("stars",Y),Y}function rr(Y){return!Y||Y.toLowerCase()==="x"||Y==="*"}function Er(Y,de){return Y.trim().split(/\s+/).map(function(ce){return Un(ce,de)}).join(" ")}function Un(Y,de){var ce=de.loose?h[ht]:h[Ne];return Y.replace(ce,function(Ze,nt,ft,yt,Ht){o("tilde",Y,Ze,nt,ft,yt,Ht);var Ut;return rr(nt)?Ut="":rr(ft)?Ut=">="+nt+".0.0 <"+(+nt+1)+".0.0":rr(yt)?Ut=">="+nt+"."+ft+".0 <"+nt+"."+(+ft+1)+".0":Ht?(o("replaceTilde pr",Ht),Ut=">="+nt+"."+ft+"."+yt+"-"+Ht+" <"+nt+"."+(+ft+1)+".0"):Ut=">="+nt+"."+ft+"."+yt+" <"+nt+"."+(+ft+1)+".0",o("tilde return",Ut),Ut})}function Bt(Y,de){return Y.trim().split(/\s+/).map(function(ce){return ga(ce,de)}).join(" ")}function ga(Y,de){o("caret",Y,de);var ce=de.loose?h[hr]:h[er];return Y.replace(ce,function(Ze,nt,ft,yt,Ht){o("caret",Y,Ze,nt,ft,yt,Ht);var Ut;return rr(nt)?Ut="":rr(ft)?Ut=">="+nt+".0.0 <"+(+nt+1)+".0.0":rr(yt)?nt==="0"?Ut=">="+nt+"."+ft+".0 <"+nt+"."+(+ft+1)+".0":Ut=">="+nt+"."+ft+".0 <"+(+nt+1)+".0.0":Ht?(o("replaceCaret pr",Ht),nt==="0"?ft==="0"?Ut=">="+nt+"."+ft+"."+yt+"-"+Ht+" <"+nt+"."+ft+"."+(+yt+1):Ut=">="+nt+"."+ft+"."+yt+"-"+Ht+" <"+nt+"."+(+ft+1)+".0":Ut=">="+nt+"."+ft+"."+yt+"-"+Ht+" <"+(+nt+1)+".0.0"):(o("no pr"),nt==="0"?ft==="0"?Ut=">="+nt+"."+ft+"."+yt+" <"+nt+"."+ft+"."+(+yt+1):Ut=">="+nt+"."+ft+"."+yt+" <"+nt+"."+(+ft+1)+".0":Ut=">="+nt+"."+ft+"."+yt+" <"+(+nt+1)+".0.0"),o("caret return",Ut),Ut})}function jr(Y,de){return o("replaceXRanges",Y,de),Y.split(/\s+/).map(function(ce){return fi(ce,de)}).join(" ")}function fi(Y,de){Y=Y.trim();var ce=de.loose?h[Pt]:h[Nt];return Y.replace(ce,function(Ze,nt,ft,yt,Ht,Ut){o("xRange",Y,Ze,nt,ft,yt,Ht,Ut);var bn=rr(ft),sr=bn||rr(yt),Vt=sr||rr(Ht),Dt=Vt;return nt==="="&&Dt&&(nt=""),bn?nt===">"||nt==="<"?Ze="<0.0.0":Ze="*":nt&&Dt?(sr&&(yt=0),Ht=0,nt===">"?(nt=">=",sr?(ft=+ft+1,yt=0,Ht=0):(yt=+yt+1,Ht=0)):nt==="<="&&(nt="<",sr?ft=+ft+1:yt=+yt+1),Ze=nt+ft+"."+yt+"."+Ht):sr?Ze=">="+ft+".0.0 <"+(+ft+1)+".0.0":Vt&&(Ze=">="+ft+"."+yt+".0 <"+ft+"."+(+yt+1)+".0"),o("xRange return",Ze),Ze})}function vn(Y,de){return o("replaceStars",Y,de),Y.trim().replace(h[xt],"")}function Jl(Y,de,ce,Ze,nt,ft,yt,Ht,Ut,bn,sr,Vt,Dt){return rr(ce)?de="":rr(Ze)?de=">="+ce+".0.0":rr(nt)?de=">="+ce+"."+Ze+".0":de=">="+de,rr(Ut)?Ht="":rr(bn)?Ht="<"+(+Ut+1)+".0.0":rr(sr)?Ht="<"+Ut+"."+(+bn+1)+".0":Vt?Ht="<="+Ut+"."+bn+"."+sr+"-"+Vt:Ht="<="+Ht,(de+" "+Ht).trim()}Ye.prototype.test=function(Y){if(!Y)return!1;typeof Y=="string"&&(Y=new Lt(Y,this.options));for(var de=0;de<this.set.length;de++)if(ma(this.set[de],Y,this.options))return!0;return!1};function ma(Y,de,ce){for(var Ze=0;Ze<Y.length;Ze++)if(!Y[Ze].test(de))return!1;if(de.prerelease.length&&!ce.includePrerelease){for(Ze=0;Ze<Y.length;Ze++)if(o(Y[Ze].semver),Y[Ze].semver!==pr&&Y[Ze].semver.prerelease.length>0){var nt=Y[Ze].semver;if(nt.major===de.major&&nt.minor===de.minor&&nt.patch===de.patch)return!0}return!1}return!0}s.satisfies=va;function va(Y,de,ce){try{de=new Ye(de,ce)}catch(Ze){return!1}return de.test(Y)}s.maxSatisfying=eu;function eu(Y,de,ce){var Ze=null,nt=null;try{var ft=new Ye(de,ce)}catch(yt){return null}return Y.forEach(function(yt){ft.test(yt)&&(!Ze||nt.compare(yt)===-1)&&(Ze=yt,nt=new Lt(Ze,ce))}),Ze}s.minSatisfying=go;function go(Y,de,ce){var Ze=null,nt=null;try{var ft=new Ye(de,ce)}catch(yt){return null}return Y.forEach(function(yt){ft.test(yt)&&(!Ze||nt.compare(yt)===1)&&(Ze=yt,nt=new Lt(Ze,ce))}),Ze}s.minVersion=mo;function mo(Y,de){Y=new Ye(Y,de);var ce=new Lt("0.0.0");if(Y.test(ce)||(ce=new Lt("0.0.0-0"),Y.test(ce)))return ce;ce=null;for(var Ze=0;Ze<Y.set.length;++Ze){var nt=Y.set[Ze];nt.forEach(function(ft){var yt=new Lt(ft.semver.version);switch(ft.operator){case">":yt.prerelease.length===0?yt.patch++:yt.prerelease.push(0),yt.raw=yt.format();case"":case">=":(!ce||rn(ce,yt))&&(ce=yt);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+ft.operator)}})}return ce&&Y.test(ce)?ce:null}s.validRange=tu;function tu(Y,de){try{return new Ye(Y,de).range||"*"}catch(ce){return null}}s.ltr=ru;function ru(Y,de,ce){return gs(Y,de,"<",ce)}s.gtr=nu;function nu(Y,de,ce){return gs(Y,de,">",ce)}s.outside=gs;function gs(Y,de,ce,Ze){Y=new Lt(Y,Ze),de=new Ye(de,Ze);var nt,ft,yt,Ht,Ut;switch(ce){case">":nt=rn,ft=Rr,yt=In,Ht=">",Ut=">=";break;case"<":nt=In,ft=ps,yt=rn,Ht="<",Ut="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(va(Y,de,Ze))return!1;for(var bn=0;bn<de.set.length;++bn){var sr=de.set[bn],Vt=null,Dt=null;if(sr.forEach(function(Ar){Ar.semver===pr&&(Ar=new nn(">=0.0.0")),Vt=Vt||Ar,Dt=Dt||Ar,nt(Ar.semver,Vt.semver,Ze)?Vt=Ar:yt(Ar.semver,Dt.semver,Ze)&&(Dt=Ar)}),Vt.operator===Ht||Vt.operator===Ut||(!Dt.operator||Dt.operator===Ht)&&ft(Y,Dt.semver)||Dt.operator===Ut&&yt(Y,Dt.semver))return!1}return!0}s.prerelease=yn;function yn(Y,de){var ce=Sr(Y,de);return ce&&ce.prerelease.length?ce.prerelease:null}s.intersects=_n;function _n(Y,de,ce){return Y=new Ye(Y,ce),de=new Ye(de,ce),Y.intersects(de)}s.coerce=ms;function ms(Y){if(Y instanceof Lt)return Y;if(typeof Y!="string")return null;var de=Y.match(h[Zt]);return de==null?null:Sr(de[1]+"."+(de[2]||"0")+"."+(de[3]||"0"))}}),be=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.makePatchingRequire=void 0;var x=H(1017),o=_e(),c=H(8188),f=Object.keys(process.binding("natives")),u=c.prototype.require;function h(p){var g={};return function(b){var w=u.apply(this,arguments);if(p[b]){var y=c._resolveFilename(b,this);if(g.hasOwnProperty(y))return g[y];var S=void 0;if(f.indexOf(b)<0)try{S=u.call(this,x.join(b,"package.json")).version}catch(q){return w}else S=process.version.substring(1);var C=S.indexOf("-");C>=0&&(S=S.substring(0,C));for(var T=w,A=0,O=p[b];A<O.length;A++){var D=O[A];o.satisfies(S,D.versionSpecifier)&&(T=D.patch(T,y))}return g[y]=T}return w}}s.makePatchingRequire=h}),ae=k((s,x)=>{x.exports={name:"diagnostic-channel",version:"1.0.0",main:"./dist/src/channel.js",types:"./dist/src/channel.d.ts",scripts:{build:"tsc",lint:"tslint -c tslint.json -p tsconfig.json",clean:"rimraf ./dist",test:"mocha ./dist/tests/**/*.js"},homepage:"https://github.com/Microsoft/node-diagnostic-channel",bugs:{url:"https://github.com/Microsoft/node-diagnostic-channel/issues"},repository:{type:"git",url:"https://github.com/Microsoft/node-diagnostic-channel.git"},description:"Provides a context-saving pub/sub channel to connect diagnostic event publishers and subscribers",dependencies:{semver:"^5.3.0"},devDependencies:{"@types/mocha":"^2.2.40","@types/node":"~8.0.0",mocha:"^3.2.0",rimraf:"^2.6.1",tslint:"^5.0.0",typescript:"4.1.2"},files:["dist/src/**/*.d.ts","dist/src/**/*.js","LICENSE","README.md","package.json"],license:"MIT"}}),ue=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.channel=s.makePatchingRequire=void 0;var x=be(),o=be();Object.defineProperty(s,"makePatchingRequire",{enumerable:!0,get:function(){return o.makePatchingRequire}});var c=function(h){return!0},f=function(){function h(){this.version=ae().version,this.subscribers={},this.contextPreservationFunction=function(p){return p},this.knownPatches={},this.currentlyPublishing=!1}return h.prototype.shouldPublish=function(p){var g=this.subscribers[p];return g?g.some(function(b){var w=b.filter;return!w||w(!1)}):!1},h.prototype.publish=function(p,g){if(!this.currentlyPublishing){var b=this.subscribers[p];if(b){var w={timestamp:Date.now(),data:g};this.currentlyPublishing=!0,b.forEach(function(y){var S=y.listener,C=y.filter;try{C&&C(!0)&&S(w)}catch(T){}}),this.currentlyPublishing=!1}}},h.prototype.subscribe=function(p,g,b){b===void 0&&(b=c),this.subscribers[p]||(this.subscribers[p]=[]),this.subscribers[p].push({listener:g,filter:b})},h.prototype.unsubscribe=function(p,g,b){b===void 0&&(b=c);var w=this.subscribers[p];if(w){for(var y=0;y<w.length;++y)if(w[y].listener===g&&w[y].filter===b)return w.splice(y,1),!0}return!1},h.prototype.reset=function(){var p=this;this.subscribers={},this.contextPreservationFunction=function(g){return g},Object.getOwnPropertyNames(this.knownPatches).forEach(function(g){return delete p.knownPatches[g]})},h.prototype.bindToContext=function(p){return this.contextPreservationFunction(p)},h.prototype.addContextPreservation=function(p){var g=this.contextPreservationFunction;this.contextPreservationFunction=function(b){return p(g(b))}},h.prototype.registerMonkeyPatch=function(p,g){this.knownPatches[p]||(this.knownPatches[p]=[]),this.knownPatches[p].push(g)},h.prototype.getPatchesObject=function(){return this.knownPatches},h}();global.diagnosticsSource||(global.diagnosticsSource=new f,u=H(8188),u.prototype.require=x.makePatchingRequire(global.diagnosticsSource.getPatchesObject()));var u;s.channel=global.diagnosticsSource}),we=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Re=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BaggageImpl=void 0;var x=function(){function o(c){this._entries=c?new Map(c):new Map}return o.prototype.getEntry=function(c){var f=this._entries.get(c);if(f)return Object.assign({},f)},o.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(c){var f=c[0],u=c[1];return[f,u]})},o.prototype.setEntry=function(c,f){var u=new o(this._entries);return u._entries.set(c,f),u},o.prototype.removeEntry=function(c){var f=new o(this._entries);return f._entries.delete(c),f},o.prototype.removeEntries=function(){for(var c=[],f=0;f<arguments.length;f++)c[f]=arguments[f];for(var u=new o(this._entries),h=0,p=c;h<p.length;h++){var g=p[h];u._entries.delete(g)}return u},o.prototype.clear=function(){return new o},o}();s.BaggageImpl=x}),Ee=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.baggageEntryMetadataSymbol=void 0,s.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")}),Ie=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.baggageEntryMetadataFromString=s.createBaggage=void 0;var x=Xt(),o=Re(),c=Ee();function f(h){return h===void 0&&(h={}),new o.BaggageImpl(new Map(Object.entries(h)))}s.createBaggage=f;function u(h){return typeof h!="string"&&(x.diag.error("Cannot create baggage metadata from unknown type: "+typeof h),h=""),{__TYPE__:c.baggageEntryMetadataSymbol,toString:function(){return h}}}s.baggageEntryMetadataFromString=u}),Fe=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Ve=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),it=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DiagConsoleLogger=void 0;var x=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],o=function(){function c(){function f(h){return function(){var p=arguments;if(console){var g=console[h];if(typeof g!="function"&&(g=console.log),typeof g=="function")return g.apply(console,p)}}}for(var u=0;u<x.length;u++)this[x[u].n]=f(x[u].c)}return c}();s.DiagConsoleLogger=o}),lt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DiagLogLevel=void 0;var x;(function(o){o[o.NONE=0]="NONE",o[o.ERROR=30]="ERROR",o[o.WARN=50]="WARN",o[o.INFO=60]="INFO",o[o.DEBUG=70]="DEBUG",o[o.VERBOSE=80]="VERBOSE",o[o.ALL=9999]="ALL"})(x=s.DiagLogLevel||(s.DiagLogLevel={}))}),ve=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(it(),s),o(lt(),s)}),je=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.defaultTextMapSetter=s.defaultTextMapGetter=void 0,s.defaultTextMapGetter={get:function(x,o){if(x!=null)return x[o]},keys:function(x){return x==null?[]:Object.keys(x)}},s.defaultTextMapSetter={set:function(x,o,c){x!=null&&(x[o]=c)}}}),Ke=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),We=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Ue=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ROOT_CONTEXT=s.createContextKey=void 0;function x(c){return Symbol.for(c)}s.createContextKey=x;var o=function(){function c(f){var u=this;u._currentContext=f?new Map(f):new Map,u.getValue=function(h){return u._currentContext.get(h)},u.setValue=function(h,p){var g=new c(u._currentContext);return g._currentContext.set(h,p),g},u.deleteValue=function(h){var p=new c(u._currentContext);return p._currentContext.delete(h),p}}return c}();s.ROOT_CONTEXT=new o}),ut=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.TraceFlags=void 0;var x;(function(o){o[o.NONE=0]="NONE",o[o.SAMPLED=1]="SAMPLED"})(x=s.TraceFlags||(s.TraceFlags={}))}),gt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.wrapSpanContext=s.isSpanContextValid=s.isValidSpanId=s.isValidTraceId=s.INVALID_SPAN_CONTEXT=s.INVALID_TRACEID=s.INVALID_SPANID=void 0;var x=_t(),o=ut(),c=/^([0-9a-f]{32})$/i,f=/^[0-9a-f]{16}$/i;s.INVALID_SPANID="0000000000000000",s.INVALID_TRACEID="00000000000000000000000000000000",s.INVALID_SPAN_CONTEXT={traceId:s.INVALID_TRACEID,spanId:s.INVALID_SPANID,traceFlags:o.TraceFlags.NONE};function u(b){return c.test(b)&&b!==s.INVALID_TRACEID}s.isValidTraceId=u;function h(b){return f.test(b)&&b!==s.INVALID_SPANID}s.isValidSpanId=h;function p(b){return u(b.traceId)&&h(b.spanId)}s.isSpanContextValid=p;function g(b){return new x.NonRecordingSpan(b)}s.wrapSpanContext=g}),_t=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NonRecordingSpan=void 0;var x=gt(),o=function(){function c(f){f===void 0&&(f=x.INVALID_SPAN_CONTEXT),this._spanContext=f}return c.prototype.spanContext=function(){return this._spanContext},c.prototype.setAttribute=function(f,u){return this},c.prototype.setAttributes=function(f){return this},c.prototype.addEvent=function(f,u){return this},c.prototype.setStatus=function(f){return this},c.prototype.updateName=function(f){return this},c.prototype.end=function(f){},c.prototype.isRecording=function(){return!1},c.prototype.recordException=function(f,u){},c}();s.NonRecordingSpan=o}),Ce=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.getSpanContext=s.setSpanContext=s.deleteSpan=s.setSpan=s.getSpan=void 0;var x=Ue(),o=_t(),c=x.createContextKey("OpenTelemetry Context Key SPAN");function f(b){return b.getValue(c)||void 0}s.getSpan=f;function u(b,w){return b.setValue(c,w)}s.setSpan=u;function h(b){return b.deleteValue(c)}s.deleteSpan=h;function p(b,w){return u(b,new o.NonRecordingSpan(w))}s.setSpanContext=p;function g(b){var w;return(w=f(b))===null||w===void 0?void 0:w.spanContext()}s.getSpanContext=g}),Rt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NoopTracer=void 0;var x=Xt(),o=Ce(),c=_t(),f=gt(),u=function(){function p(){}return p.prototype.startSpan=function(g,b,w){var y=Boolean(b==null?void 0:b.root);if(y)return new c.NonRecordingSpan;var S=w&&o.getSpanContext(w);return h(S)&&f.isSpanContextValid(S)?new c.NonRecordingSpan(S):new c.NonRecordingSpan},p.prototype.startActiveSpan=function(g,b,w,y){var S,C,T;if(!(arguments.length<2)){arguments.length===2?T=b:arguments.length===3?(S=b,T=w):(S=b,C=w,T=y);var A=C!=null?C:x.context.active(),O=this.startSpan(g,S,A),D=o.setSpan(A,O);return x.context.with(D,T,void 0,O)}},p}();s.NoopTracer=u;function h(p){return typeof p=="object"&&typeof p.spanId=="string"&&typeof p.traceId=="string"&&typeof p.traceFlags=="number"}}),Ct=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProxyTracer=void 0;var x=Rt(),o=function(){function c(f,u,h){this._provider=f,this.name=u,this.version=h}return c.prototype.startSpan=function(f,u,h){return this._getTracer().startSpan(f,u,h)},c.prototype.startActiveSpan=function(f,u,h,p){var g=this._getTracer();return Reflect.apply(g.startActiveSpan,g,arguments)},c.prototype._getTracer=function(){if(this._delegate)return this._delegate;var f=this._provider.getDelegateTracer(this.name,this.version);return f?(this._delegate=f,this._delegate):new x.NoopTracer},c}();s.ProxyTracer=o}),It=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NoopTracerProvider=void 0;var x=Rt(),o=function(){function c(){}return c.prototype.getTracer=function(f,u){return new x.NoopTracer},c}();s.NoopTracerProvider=o}),ke=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProxyTracerProvider=void 0;var x=Ct(),o=It(),c=new o.NoopTracerProvider,f=function(){function u(){}return u.prototype.getTracer=function(h,p){var g;return(g=this.getDelegateTracer(h,p))!==null&&g!==void 0?g:new x.ProxyTracer(this,h,p)},u.prototype.getDelegate=function(){var h;return(h=this._delegate)!==null&&h!==void 0?h:c},u.prototype.setDelegate=function(h){this._delegate=h},u.prototype.getDelegateTracer=function(h,p){var g;return(g=this._delegate)===null||g===void 0?void 0:g.getTracer(h,p)},u}();s.ProxyTracerProvider=f}),Pe=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),vt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SamplingDecision=void 0;var x;(function(o){o[o.NOT_RECORD=0]="NOT_RECORD",o[o.RECORD=1]="RECORD",o[o.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(x=s.SamplingDecision||(s.SamplingDecision={}))}),Tt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),kt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SpanKind=void 0;var x;(function(o){o[o.INTERNAL=0]="INTERNAL",o[o.SERVER=1]="SERVER",o[o.CLIENT=2]="CLIENT",o[o.PRODUCER=3]="PRODUCER",o[o.CONSUMER=4]="CONSUMER"})(x=s.SpanKind||(s.SpanKind={}))}),Tr=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Yt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),lr=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SpanStatusCode=void 0;var x;(function(o){o[o.UNSET=0]="UNSET",o[o.OK=1]="OK",o[o.ERROR=2]="ERROR"})(x=s.SpanStatusCode||(s.SpanStatusCode={}))}),Qn=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Mr=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),_r=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),St=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),or=k(s=>{"use strict";var x=s&&s.__spreadArray||function(f,u){for(var h=0,p=u.length,g=f.length;h<p;h++,g++)f[g]=u[h];return f};Object.defineProperty(s,"__esModule",{value:!0}),s.NoopContextManager=void 0;var o=Ue(),c=function(){function f(){}return f.prototype.active=function(){return o.ROOT_CONTEXT},f.prototype.with=function(u,h,p){for(var g=[],b=3;b<arguments.length;b++)g[b-3]=arguments[b];return h.call.apply(h,x([p],g))},f.prototype.bind=function(u,h){return h},f.prototype.enable=function(){return this},f.prototype.disable=function(){return this},f}();s.NoopContextManager=c}),Xn=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s._globalThis=void 0,s._globalThis=typeof globalThis=="object"?globalThis:global}),st=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Xn(),s)}),zt=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(st(),s)}),tt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.VERSION=void 0,s.VERSION="1.0.1"}),At=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.isCompatible=s._makeCompatibilityCheck=void 0;var x=tt(),o=/^(\d+)\.(\d+)\.(\d+)(?:-(.*))?$/;function c(f){var u=new Set([f]),h=new Set,p=f.match(o);if(!p)return function(){return!1};var g={major:+p[1],minor:+p[2],patch:+p[3]};function b(y){return h.add(y),!1}function w(y){return u.add(y),!0}return function(y){if(u.has(y))return!0;if(h.has(y))return!1;var S=y.match(o);if(!S)return b(y);var C={major:+S[1],minor:+S[2],patch:+S[3]};return g.major!==C.major?b(y):g.major===0?g.minor===C.minor&&g.patch<=C.patch?w(y):b(y):g.minor<=C.minor?w(y):b(y)}}s._makeCompatibilityCheck=c,s.isCompatible=c(x.VERSION)}),Kt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.unregisterGlobal=s.getGlobal=s.registerGlobal=void 0;var x=zt(),o=tt(),c=At(),f=o.VERSION.split(".")[0],u=Symbol.for("opentelemetry.js.api."+f),h=x._globalThis;function p(w,y,S,C){var T;C===void 0&&(C=!1);var A=h[u]=(T=h[u])!==null&&T!==void 0?T:{version:o.VERSION};if(!C&&A[w]){var O=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+w);return S.error(O.stack||O.message),!1}if(A.version!==o.VERSION){var O=new Error("@opentelemetry/api: All API registration versions must match");return S.error(O.stack||O.message),!1}return A[w]=y,S.debug("@opentelemetry/api: Registered a global for "+w+" v"+o.VERSION+"."),!0}s.registerGlobal=p;function g(w){var y,S,C=(y=h[u])===null||y===void 0?void 0:y.version;if(!(!C||!c.isCompatible(C)))return(S=h[u])===null||S===void 0?void 0:S[w]}s.getGlobal=g;function b(w,y){y.debug("@opentelemetry/api: Unregistering a global for "+w+" v"+o.VERSION+".");var S=h[u];S&&delete S[w]}s.unregisterGlobal=b}),br=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DiagComponentLogger=void 0;var x=Kt(),o=function(){function f(u){this._namespace=u.namespace||"DiagComponentLogger"}return f.prototype.debug=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return c("debug",this._namespace,u)},f.prototype.error=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return c("error",this._namespace,u)},f.prototype.info=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return c("info",this._namespace,u)},f.prototype.warn=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return c("warn",this._namespace,u)},f.prototype.verbose=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return c("verbose",this._namespace,u)},f}();s.DiagComponentLogger=o;function c(f,u,h){var p=x.getGlobal("diag");if(p)return h.unshift(u),p[f].apply(p,h)}}),ur=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.createLogLevelDiagLogger=void 0;var x=lt();function o(c,f){c<x.DiagLogLevel.NONE?c=x.DiagLogLevel.NONE:c>x.DiagLogLevel.ALL&&(c=x.DiagLogLevel.ALL),f=f||{};function u(h,p){var g=f[h];return typeof g=="function"&&c>=p?g.bind(f):function(){}}return{error:u("error",x.DiagLogLevel.ERROR),warn:u("warn",x.DiagLogLevel.WARN),info:u("info",x.DiagLogLevel.INFO),debug:u("debug",x.DiagLogLevel.DEBUG),verbose:u("verbose",x.DiagLogLevel.VERBOSE)}}s.createLogLevelDiagLogger=o}),En=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DiagAPI=void 0;var x=br(),o=ur(),c=lt(),f=Kt(),u="diag",h=function(){function p(){function g(w){return function(){var y=f.getGlobal("diag");if(y)return y[w].apply(y,arguments)}}var b=this;b.setLogger=function(w,y){var S,C;if(y===void 0&&(y=c.DiagLogLevel.INFO),w===b){var T=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return b.error((S=T.stack)!==null&&S!==void 0?S:T.message),!1}var A=f.getGlobal("diag"),O=o.createLogLevelDiagLogger(y,w);if(A){var D=(C=new Error().stack)!==null&&C!==void 0?C:"<failed to generate stacktrace>";A.warn("Current logger will be overwritten from "+D),O.warn("Current logger will overwrite one already registered from "+D)}return f.registerGlobal("diag",O,b,!0)},b.disable=function(){f.unregisterGlobal(u,b)},b.createComponentLogger=function(w){return new x.DiagComponentLogger(w)},b.verbose=g("verbose"),b.debug=g("debug"),b.info=g("info"),b.warn=g("warn"),b.error=g("error")}return p.instance=function(){return this._instance||(this._instance=new p),this._instance},p}();s.DiagAPI=h}),Cn=k(s=>{"use strict";var x=s&&s.__spreadArray||function(g,b){for(var w=0,y=b.length,S=g.length;w<y;w++,S++)g[S]=b[w];return g};Object.defineProperty(s,"__esModule",{value:!0}),s.ContextAPI=void 0;var o=or(),c=Kt(),f=En(),u="context",h=new o.NoopContextManager,p=function(){function g(){}return g.getInstance=function(){return this._instance||(this._instance=new g),this._instance},g.prototype.setGlobalContextManager=function(b){return c.registerGlobal(u,b,f.DiagAPI.instance())},g.prototype.active=function(){return this._getContextManager().active()},g.prototype.with=function(b,w,y){for(var S,C=[],T=3;T<arguments.length;T++)C[T-3]=arguments[T];return(S=this._getContextManager()).with.apply(S,x([b,w,y],C))},g.prototype.bind=function(b,w){return this._getContextManager().bind(b,w)},g.prototype._getContextManager=function(){return c.getGlobal(u)||h},g.prototype.disable=function(){this._getContextManager().disable(),c.unregisterGlobal(u,f.DiagAPI.instance())},g}();s.ContextAPI=p}),Ls=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.TraceAPI=void 0;var x=Kt(),o=ke(),c=gt(),f=Ce(),u=En(),h="trace",p=function(){function g(){this._proxyTracerProvider=new o.ProxyTracerProvider,this.wrapSpanContext=c.wrapSpanContext,this.isSpanContextValid=c.isSpanContextValid,this.deleteSpan=f.deleteSpan,this.getSpan=f.getSpan,this.getSpanContext=f.getSpanContext,this.setSpan=f.setSpan,this.setSpanContext=f.setSpanContext}return g.getInstance=function(){return this._instance||(this._instance=new g),this._instance},g.prototype.setGlobalTracerProvider=function(b){return this._proxyTracerProvider.setDelegate(b),x.registerGlobal(h,this._proxyTracerProvider,u.DiagAPI.instance())},g.prototype.getTracerProvider=function(){return x.getGlobal(h)||this._proxyTracerProvider},g.prototype.getTracer=function(b,w){return this.getTracerProvider().getTracer(b,w)},g.prototype.disable=function(){x.unregisterGlobal(h,u.DiagAPI.instance()),this._proxyTracerProvider=new o.ProxyTracerProvider},g}();s.TraceAPI=p}),Fs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NoopTextMapPropagator=void 0;var x=function(){function o(){}return o.prototype.inject=function(c,f){},o.prototype.extract=function(c,f){return c},o.prototype.fields=function(){return[]},o}();s.NoopTextMapPropagator=x}),$s=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.deleteBaggage=s.setBaggage=s.getBaggage=void 0;var x=Ue(),o=x.createContextKey("OpenTelemetry Baggage Key");function c(h){return h.getValue(o)||void 0}s.getBaggage=c;function f(h,p){return h.setValue(o,p)}s.setBaggage=f;function u(h){return h.deleteValue(o)}s.deleteBaggage=u}),Bs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.PropagationAPI=void 0;var x=Kt(),o=Fs(),c=je(),f=$s(),u=Ie(),h=En(),p="propagation",g=new o.NoopTextMapPropagator,b=function(){function w(){this.createBaggage=u.createBaggage,this.getBaggage=f.getBaggage,this.setBaggage=f.setBaggage,this.deleteBaggage=f.deleteBaggage}return w.getInstance=function(){return this._instance||(this._instance=new w),this._instance},w.prototype.setGlobalPropagator=function(y){return x.registerGlobal(p,y,h.DiagAPI.instance())},w.prototype.inject=function(y,S,C){return C===void 0&&(C=c.defaultTextMapSetter),this._getGlobalPropagator().inject(y,S,C)},w.prototype.extract=function(y,S,C){return C===void 0&&(C=c.defaultTextMapGetter),this._getGlobalPropagator().extract(y,S,C)},w.prototype.fields=function(){return this._getGlobalPropagator().fields()},w.prototype.disable=function(){x.unregisterGlobal(p,h.DiagAPI.instance())},w.prototype._getGlobalPropagator=function(){return x.getGlobal(p)||g},w}();s.PropagationAPI=b}),Xt=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(b,w,y,S){S===void 0&&(S=y),Object.defineProperty(b,S,{enumerable:!0,get:function(){return w[y]}})}:function(b,w,y,S){S===void 0&&(S=y),b[S]=w[y]}),o=s&&s.__exportStar||function(b,w){for(var y in b)y!=="default"&&!Object.prototype.hasOwnProperty.call(w,y)&&x(w,b,y)};Object.defineProperty(s,"__esModule",{value:!0}),s.diag=s.propagation=s.trace=s.context=s.isValidSpanId=s.isValidTraceId=s.isSpanContextValid=s.INVALID_SPAN_CONTEXT=s.INVALID_TRACEID=s.INVALID_SPANID=s.baggageEntryMetadataFromString=void 0,o(we(),s);var c=Ie();Object.defineProperty(s,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return c.baggageEntryMetadataFromString}}),o(Fe(),s),o(Ve(),s),o(ve(),s),o(je(),s),o(Ke(),s),o(We(),s),o(Ct(),s),o(ke(),s),o(Pe(),s),o(vt(),s),o(Tt(),s),o(kt(),s),o(Tr(),s),o(Yt(),s),o(lr(),s),o(ut(),s),o(Qn(),s),o(Mr(),s),o(_r(),s);var f=gt();Object.defineProperty(s,"INVALID_SPANID",{enumerable:!0,get:function(){return f.INVALID_SPANID}}),Object.defineProperty(s,"INVALID_TRACEID",{enumerable:!0,get:function(){return f.INVALID_TRACEID}}),Object.defineProperty(s,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return f.INVALID_SPAN_CONTEXT}}),Object.defineProperty(s,"isSpanContextValid",{enumerable:!0,get:function(){return f.isSpanContextValid}}),Object.defineProperty(s,"isValidTraceId",{enumerable:!0,get:function(){return f.isValidTraceId}}),Object.defineProperty(s,"isValidSpanId",{enumerable:!0,get:function(){return f.isValidSpanId}}),o(Ue(),s),o(St(),s);var u=Cn();s.context=u.ContextAPI.getInstance();var h=Ls();s.trace=h.TraceAPI.getInstance();var p=Bs();s.propagation=p.PropagationAPI.getInstance();var g=En();s.diag=g.DiagAPI.instance(),s.default={trace:s.trace,context:s.context,propagation:s.propagation,diag:s.diag}}),Bo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.isTracingSuppressed=s.unsuppressTracing=s.suppressTracing=void 0;var x=Xt(),o=x.createContextKey("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function c(h){return h.setValue(o,!0)}s.suppressTracing=c;function f(h){return h.deleteValue(o)}s.unsuppressTracing=f;function u(h){return h.getValue(o)===!0}s.isTracingSuppressed=u}),Qr=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BAGGAGE_MAX_TOTAL_LENGTH=s.BAGGAGE_MAX_PER_NAME_VALUE_PAIRS=s.BAGGAGE_MAX_NAME_VALUE_PAIRS=s.BAGGAGE_HEADER=s.BAGGAGE_ITEMS_SEPARATOR=s.BAGGAGE_PROPERTIES_SEPARATOR=s.BAGGAGE_KEY_PAIR_SEPARATOR=void 0,s.BAGGAGE_KEY_PAIR_SEPARATOR="=",s.BAGGAGE_PROPERTIES_SEPARATOR=";",s.BAGGAGE_ITEMS_SEPARATOR=",",s.BAGGAGE_HEADER="baggage",s.BAGGAGE_MAX_NAME_VALUE_PAIRS=180,s.BAGGAGE_MAX_PER_NAME_VALUE_PAIRS=4096,s.BAGGAGE_MAX_TOTAL_LENGTH=8192}),Yi=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.parseKeyPairsIntoRecord=s.parsePairKeyValue=s.getKeyPairs=s.serializeKeyPairs=void 0;var x=Xt(),o=Qr(),c=p=>p.reduce((g,b)=>{let w=`${g}${g!==""?o.BAGGAGE_ITEMS_SEPARATOR:""}${b}`;return w.length>o.BAGGAGE_MAX_TOTAL_LENGTH?g:w},"");s.serializeKeyPairs=c;var f=p=>p.getAllEntries().map(([g,b])=>`${encodeURIComponent(g)}=${encodeURIComponent(b.value)}`);s.getKeyPairs=f;var u=p=>{let g=p.split(o.BAGGAGE_PROPERTIES_SEPARATOR);if(g.length<=0)return;let b=g.shift();if(!b)return;let w=b.split(o.BAGGAGE_KEY_PAIR_SEPARATOR);if(w.length!==2)return;let y=decodeURIComponent(w[0].trim()),S=decodeURIComponent(w[1].trim()),C;return g.length>0&&(C=x.baggageEntryMetadataFromString(g.join(o.BAGGAGE_PROPERTIES_SEPARATOR))),{key:y,value:S,metadata:C}};s.parsePairKeyValue=u;var h=p=>typeof p!="string"||p.length===0?{}:p.split(o.BAGGAGE_ITEMS_SEPARATOR).map(g=>s.parsePairKeyValue(g)).filter(g=>g!==void 0&&g.value.length>0).reduce((g,b)=>(g[b.key]=b.value,g),{});s.parseKeyPairsIntoRecord=h}),Hs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.HttpBaggagePropagator=void 0;var x=Xt(),o=Bo(),c=Qr(),f=Yi(),u=class{inject(h,p,g){let b=x.propagation.getBaggage(h);if(!b||o.isTracingSuppressed(h))return;let w=f.getKeyPairs(b).filter(S=>S.length<=c.BAGGAGE_MAX_PER_NAME_VALUE_PAIRS).slice(0,c.BAGGAGE_MAX_NAME_VALUE_PAIRS),y=f.serializeKeyPairs(w);y.length>0&&g.set(p,c.BAGGAGE_HEADER,y)}extract(h,p,g){let b=g.get(p,c.BAGGAGE_HEADER);if(!b)return h;let w={};return b.length===0||(b.split(c.BAGGAGE_ITEMS_SEPARATOR).forEach(y=>{let S=f.parsePairKeyValue(y);if(S){let C={value:S.value};S.metadata&&(C.metadata=S.metadata),w[S.key]=C}}),Object.entries(w).length===0)?h:x.propagation.setBaggage(h,x.propagation.createBaggage(w))}fields(){return[c.BAGGAGE_HEADER]}};s.HttpBaggagePropagator=u}),nl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.isAttributeValue=s.sanitizeAttributes=void 0;function x(u){let h={};if(u==null||typeof u!="object")return h;for(let[p,g]of Object.entries(u))o(g)&&(Array.isArray(g)?h[p]=g.slice():h[p]=g);return h}s.sanitizeAttributes=x;function o(u){return u==null?!0:Array.isArray(u)?c(u):f(u)}s.isAttributeValue=o;function c(u){let h;for(let p of u)if(p!=null){if(!h){if(f(p)){h=typeof p;continue}return!1}if(typeof p!==h)return!1}return!0}function f(u){switch(typeof u){case"number":return!0;case"boolean":return!0;case"string":return!0}return!1}}),$a=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.loggingErrorHandler=void 0;var x=Xt();function o(){return u=>{x.diag.error(c(u))}}s.loggingErrorHandler=o;function c(u){return typeof u=="string"?u:JSON.stringify(f(u))}function f(u){let h={},p=u;for(;p!==null;)Object.getOwnPropertyNames(p).forEach(g=>{if(h[g])return;let b=p[g];b&&(h[g]=String(b))}),p=Object.getPrototypeOf(p);return h}}),Ho=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.globalErrorHandler=s.setGlobalErrorHandler=void 0;var x=$a(),o=x.loggingErrorHandler();function c(u){o=u}s.setGlobalErrorHandler=c;var f=u=>{try{o(u)}catch(h){}};s.globalErrorHandler=f}),Uo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.TracesSamplerValues=void 0;var x;(function(o){o.AlwaysOff="always_off",o.AlwaysOn="always_on",o.ParentBasedAlwaysOff="parentbased_always_off",o.ParentBasedAlwaysOn="parentbased_always_on",o.ParentBasedTraceIdRatio="parentbased_traceidratio",o.TraceIdRatio="traceidratio"})(x=s.TracesSamplerValues||(s.TracesSamplerValues={}))}),Us=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.parseEnvironment=s.DEFAULT_ENVIRONMENT=void 0;var x=Xt(),o=Uo(),c=",",f=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT"];function u(C){return f.indexOf(C)>-1}var h=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function p(C){return h.indexOf(C)>-1}s.DEFAULT_ENVIRONMENT={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:x.DiagLogLevel.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:o.TracesSamplerValues.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:""};function g(C,T,A,O=-1/0,D=1/0){if(typeof A[C]!="undefined"){let q=Number(A[C]);isNaN(q)||(q<O?T[C]=O:q>D?T[C]=D:T[C]=q)}}function b(C,T,A,O=c){let D=A[C];typeof D=="string"&&(T[C]=D.split(O).map(q=>q.trim()))}var w={ALL:x.DiagLogLevel.ALL,VERBOSE:x.DiagLogLevel.VERBOSE,DEBUG:x.DiagLogLevel.DEBUG,INFO:x.DiagLogLevel.INFO,WARN:x.DiagLogLevel.WARN,ERROR:x.DiagLogLevel.ERROR,NONE:x.DiagLogLevel.NONE};function y(C,T,A){let O=A[C];if(typeof O=="string"){let D=w[O.toUpperCase()];D!=null&&(T[C]=D)}}function S(C){let T={};for(let A in s.DEFAULT_ENVIRONMENT){let O=A;switch(O){case"OTEL_LOG_LEVEL":y(O,T,C);break;default:if(u(O))g(O,T,C);else if(p(O))b(O,T,C);else{let D=C[O];typeof D!="undefined"&&D!==null&&(T[O]=String(D))}}}return T}s.parseEnvironment=S}),Nn=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.getEnv=void 0;var x=H(2037),o=Us();function c(){let f=o.parseEnvironment(process.env);return Object.assign({HOSTNAME:x.hostname()},o.DEFAULT_ENVIRONMENT,f)}s.getEnv=c}),Zi=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.hexToBase64=void 0;function x(o){let c=o.length,f="";for(let u=0;u<c;u+=2){let h=o.substring(u,u+2),p=parseInt(h,16);f+=String.fromCharCode(p)}return Buffer.from(f,"ascii").toString("base64")}s.hexToBase64=x}),Ci=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.RandomIdGenerator=void 0;var x=8,o=16,c=class{constructor(){this.generateTraceId=u(o),this.generateSpanId=u(x)}};s.RandomIdGenerator=c;var f=Buffer.allocUnsafe(o);function u(h){return function(){for(let p=0;p<h/4;p++)f.writeUInt32BE(Math.random()*2**32>>>0,p*4);for(let p=0;p<h&&!(f[p]>0);p++)p===h-1&&(f[h-1]=1);return f.toString("hex",0,h)}}}),Yn=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.otperformance=void 0;var x=H(4074);s.otperformance=x.performance}),Ji=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.VERSION=void 0,s.VERSION="0.23.0"}),Xr=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.RpcGrpcStatusCodeValues=s.MessagingOperationValues=s.MessagingDestinationKindValues=s.HttpFlavorValues=s.NetTransportValues=s.FaasInvokedProviderValues=s.FaasDocumentOperationValues=s.FaasTriggerValues=s.DbCassandraConsistencyLevelValues=s.DbSystemValues=s.SemanticAttributes=void 0,s.SemanticAttributes={DB_SYSTEM:"db.system",DB_CONNECTION_STRING:"db.connection_string",DB_USER:"db.user",DB_JDBC_DRIVER_CLASSNAME:"db.jdbc.driver_classname",DB_NAME:"db.name",DB_STATEMENT:"db.statement",DB_OPERATION:"db.operation",DB_MSSQL_INSTANCE_NAME:"db.mssql.instance_name",DB_CASSANDRA_KEYSPACE:"db.cassandra.keyspace",DB_CASSANDRA_PAGE_SIZE:"db.cassandra.page_size",DB_CASSANDRA_CONSISTENCY_LEVEL:"db.cassandra.consistency_level",DB_CASSANDRA_TABLE:"db.cassandra.table",DB_CASSANDRA_IDEMPOTENCE:"db.cassandra.idempotence",DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:"db.cassandra.speculative_execution_count",DB_CASSANDRA_COORDINATOR_ID:"db.cassandra.coordinator.id",DB_CASSANDRA_COORDINATOR_DC:"db.cassandra.coordinator.dc",DB_HBASE_NAMESPACE:"db.hbase.namespace",DB_REDIS_DATABASE_INDEX:"db.redis.database_index",DB_MONGODB_COLLECTION:"db.mongodb.collection",DB_SQL_TABLE:"db.sql.table",EXCEPTION_TYPE:"exception.type",EXCEPTION_MESSAGE:"exception.message",EXCEPTION_STACKTRACE:"exception.stacktrace",EXCEPTION_ESCAPED:"exception.escaped",FAAS_TRIGGER:"faas.trigger",FAAS_EXECUTION:"faas.execution",FAAS_DOCUMENT_COLLECTION:"faas.document.collection",FAAS_DOCUMENT_OPERATION:"faas.document.operation",FAAS_DOCUMENT_TIME:"faas.document.time",FAAS_DOCUMENT_NAME:"faas.document.name",FAAS_TIME:"faas.time",FAAS_CRON:"faas.cron",FAAS_COLDSTART:"faas.coldstart",FAAS_INVOKED_NAME:"faas.invoked_name",FAAS_INVOKED_PROVIDER:"faas.invoked_provider",FAAS_INVOKED_REGION:"faas.invoked_region",NET_TRANSPORT:"net.transport",NET_PEER_IP:"net.peer.ip",NET_PEER_PORT:"net.peer.port",NET_PEER_NAME:"net.peer.name",NET_HOST_IP:"net.host.ip",NET_HOST_PORT:"net.host.port",NET_HOST_NAME:"net.host.name",PEER_SERVICE:"peer.service",ENDUSER_ID:"enduser.id",ENDUSER_ROLE:"enduser.role",ENDUSER_SCOPE:"enduser.scope",THREAD_ID:"thread.id",THREAD_NAME:"thread.name",CODE_FUNCTION:"code.function",CODE_NAMESPACE:"code.namespace",CODE_FILEPATH:"code.filepath",CODE_LINENO:"code.lineno",HTTP_METHOD:"http.method",HTTP_URL:"http.url",HTTP_TARGET:"http.target",HTTP_HOST:"http.host",HTTP_SCHEME:"http.scheme",HTTP_STATUS_CODE:"http.status_code",HTTP_FLAVOR:"http.flavor",HTTP_USER_AGENT:"http.user_agent",HTTP_REQUEST_CONTENT_LENGTH:"http.request_content_length",HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:"http.request_content_length_uncompressed",HTTP_RESPONSE_CONTENT_LENGTH:"http.response_content_length",HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:"http.response_content_length_uncompressed",HTTP_SERVER_NAME:"http.server_name",HTTP_ROUTE:"http.route",HTTP_CLIENT_IP:"http.client_ip",AWS_DYNAMODB_TABLE_NAMES:"aws.dynamodb.table_names",AWS_DYNAMODB_CONSUMED_CAPACITY:"aws.dynamodb.consumed_capacity",AWS_DYNAMODB_ITEM_COLLECTION_METRICS:"aws.dynamodb.item_collection_metrics",AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:"aws.dynamodb.provisioned_read_capacity",AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:"aws.dynamodb.provisioned_write_capacity",AWS_DYNAMODB_CONSISTENT_READ:"aws.dynamodb.consistent_read",AWS_DYNAMODB_PROJECTION:"aws.dynamodb.projection",AWS_DYNAMODB_LIMIT:"aws.dynamodb.limit",AWS_DYNAMODB_ATTRIBUTES_TO_GET:"aws.dynamodb.attributes_to_get",AWS_DYNAMODB_INDEX_NAME:"aws.dynamodb.index_name",AWS_DYNAMODB_SELECT:"aws.dynamodb.select",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:"aws.dynamodb.global_secondary_indexes",AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:"aws.dynamodb.local_secondary_indexes",AWS_DYNAMODB_EXCLUSIVE_START_TABLE:"aws.dynamodb.exclusive_start_table",AWS_DYNAMODB_TABLE_COUNT:"aws.dynamodb.table_count",AWS_DYNAMODB_SCAN_FORWARD:"aws.dynamodb.scan_forward",AWS_DYNAMODB_SEGMENT:"aws.dynamodb.segment",AWS_DYNAMODB_TOTAL_SEGMENTS:"aws.dynamodb.total_segments",AWS_DYNAMODB_COUNT:"aws.dynamodb.count",AWS_DYNAMODB_SCANNED_COUNT:"aws.dynamodb.scanned_count",AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:"aws.dynamodb.attribute_definitions",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:"aws.dynamodb.global_secondary_index_updates",MESSAGING_SYSTEM:"messaging.system",MESSAGING_DESTINATION:"messaging.destination",MESSAGING_DESTINATION_KIND:"messaging.destination_kind",MESSAGING_TEMP_DESTINATION:"messaging.temp_destination",MESSAGING_PROTOCOL:"messaging.protocol",MESSAGING_PROTOCOL_VERSION:"messaging.protocol_version",MESSAGING_URL:"messaging.url",MESSAGING_MESSAGE_ID:"messaging.message_id",MESSAGING_CONVERSATION_ID:"messaging.conversation_id",MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:"messaging.message_payload_size_bytes",MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:"messaging.message_payload_compressed_size_bytes",MESSAGING_OPERATION:"messaging.operation",MESSAGING_RABBITMQ_ROUTING_KEY:"messaging.rabbitmq.routing_key",MESSAGING_KAFKA_MESSAGE_KEY:"messaging.kafka.message_key",MESSAGING_KAFKA_CONSUMER_GROUP:"messaging.kafka.consumer_group",MESSAGING_KAFKA_CLIENT_ID:"messaging.kafka.client_id",MESSAGING_KAFKA_PARTITION:"messaging.kafka.partition",MESSAGING_KAFKA_TOMBSTONE:"messaging.kafka.tombstone",RPC_SYSTEM:"rpc.system",RPC_SERVICE:"rpc.service",RPC_METHOD:"rpc.method",RPC_GRPC_STATUS_CODE:"rpc.grpc.status_code",RPC_JSONRPC_VERSION:"rpc.jsonrpc.version",RPC_JSONRPC_METHOD:"rpc.jsonrpc.method",RPC_JSONRPC_REQUEST_ID:"rpc.jsonrpc.request_id",RPC_JSONRPC_ERROR_CODE:"rpc.jsonrpc.error_code",RPC_JSONRPC_ERROR_MESSAGE:"rpc.jsonrpc.error_message"};var x;(function(y){y.OTHER_SQL="other_sql",y.MSSQL="mssql",y.MYSQL="mysql",y.ORACLE="oracle",y.DB2="db2",y.POSTGRESQL="postgresql",y.REDSHIFT="redshift",y.HIVE="hive",y.CLOUDSCAPE="cloudscape",y.HSQLDB="hsqldb",y.PROGRESS="progress",y.MAXDB="maxdb",y.HANADB="hanadb",y.INGRES="ingres",y.FIRSTSQL="firstsql",y.EDB="edb",y.CACHE="cache",y.ADABAS="adabas",y.FIREBIRD="firebird",y.DERBY="derby",y.FILEMAKER="filemaker",y.INFORMIX="informix",y.INSTANTDB="instantdb",y.INTERBASE="interbase",y.MARIADB="mariadb",y.NETEZZA="netezza",y.PERVASIVE="pervasive",y.POINTBASE="pointbase",y.SQLITE="sqlite",y.SYBASE="sybase",y.TERADATA="teradata",y.VERTICA="vertica",y.H2="h2",y.COLDFUSION="coldfusion",y.CASSANDRA="cassandra",y.HBASE="hbase",y.MONGODB="mongodb",y.REDIS="redis",y.COUCHBASE="couchbase",y.COUCHDB="couchdb",y.COSMOSDB="cosmosdb",y.DYNAMODB="dynamodb",y.NEO4J="neo4j",y.GEODE="geode",y.ELASTICSEARCH="elasticsearch",y.MEMCACHED="memcached",y.COCKROACHDB="cockroachdb"})(x=s.DbSystemValues||(s.DbSystemValues={}));var o;(function(y){y.ALL="all",y.EACH_QUORUM="each_quorum",y.QUORUM="quorum",y.LOCAL_QUORUM="local_quorum",y.ONE="one",y.TWO="two",y.THREE="three",y.LOCAL_ONE="local_one",y.ANY="any",y.SERIAL="serial",y.LOCAL_SERIAL="local_serial"})(o=s.DbCassandraConsistencyLevelValues||(s.DbCassandraConsistencyLevelValues={}));var c;(function(y){y.DATASOURCE="datasource",y.HTTP="http",y.PUBSUB="pubsub",y.TIMER="timer",y.OTHER="other"})(c=s.FaasTriggerValues||(s.FaasTriggerValues={}));var f;(function(y){y.INSERT="insert",y.EDIT="edit",y.DELETE="delete"})(f=s.FaasDocumentOperationValues||(s.FaasDocumentOperationValues={}));var u;(function(y){y.AWS="aws",y.AZURE="azure",y.GCP="gcp"})(u=s.FaasInvokedProviderValues||(s.FaasInvokedProviderValues={}));var h;(function(y){y.IP_TCP="ip_tcp",y.IP_UDP="ip_udp",y.IP="ip",y.UNIX="unix",y.PIPE="pipe",y.INPROC="inproc",y.OTHER="other"})(h=s.NetTransportValues||(s.NetTransportValues={}));var p;(function(y){y.HTTP_1_0="1.0",y.HTTP_1_1="1.1",y.HTTP_2_0="2.0",y.SPDY="SPDY",y.QUIC="QUIC"})(p=s.HttpFlavorValues||(s.HttpFlavorValues={}));var g;(function(y){y.QUEUE="queue",y.TOPIC="topic"})(g=s.MessagingDestinationKindValues||(s.MessagingDestinationKindValues={}));var b;(function(y){y.RECEIVE="receive",y.PROCESS="process"})(b=s.MessagingOperationValues||(s.MessagingOperationValues={}));var w;(function(y){y[y.OK=0]="OK",y[y.CANCELLED=1]="CANCELLED",y[y.UNKNOWN=2]="UNKNOWN",y[y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",y[y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",y[y.NOT_FOUND=5]="NOT_FOUND",y[y.ALREADY_EXISTS=6]="ALREADY_EXISTS",y[y.PERMISSION_DENIED=7]="PERMISSION_DENIED",y[y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",y[y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",y[y.ABORTED=10]="ABORTED",y[y.OUT_OF_RANGE=11]="OUT_OF_RANGE",y[y.UNIMPLEMENTED=12]="UNIMPLEMENTED",y[y.INTERNAL=13]="INTERNAL",y[y.UNAVAILABLE=14]="UNAVAILABLE",y[y.DATA_LOSS=15]="DATA_LOSS",y[y.UNAUTHENTICATED=16]="UNAUTHENTICATED"})(w=s.RpcGrpcStatusCodeValues||(s.RpcGrpcStatusCodeValues={}))}),js=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Xr(),s)}),Zn=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.TelemetrySdkLanguageValues=s.OsTypeValues=s.HostArchValues=s.AwsEcsLaunchtypeValues=s.CloudPlatformValues=s.CloudProviderValues=s.ResourceAttributes=void 0,s.ResourceAttributes={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"};var x;(function(p){p.AWS="aws",p.AZURE="azure",p.GCP="gcp"})(x=s.CloudProviderValues||(s.CloudProviderValues={}));var o;(function(p){p.AWS_EC2="aws_ec2",p.AWS_ECS="aws_ecs",p.AWS_EKS="aws_eks",p.AWS_LAMBDA="aws_lambda",p.AWS_ELASTIC_BEANSTALK="aws_elastic_beanstalk",p.AZURE_VM="azure_vm",p.AZURE_CONTAINER_INSTANCES="azure_container_instances",p.AZURE_AKS="azure_aks",p.AZURE_FUNCTIONS="azure_functions",p.AZURE_APP_SERVICE="azure_app_service",p.GCP_COMPUTE_ENGINE="gcp_compute_engine",p.GCP_CLOUD_RUN="gcp_cloud_run",p.GCP_KUBERNETES_ENGINE="gcp_kubernetes_engine",p.GCP_CLOUD_FUNCTIONS="gcp_cloud_functions",p.GCP_APP_ENGINE="gcp_app_engine"})(o=s.CloudPlatformValues||(s.CloudPlatformValues={}));var c;(function(p){p.EC2="ec2",p.FARGATE="fargate"})(c=s.AwsEcsLaunchtypeValues||(s.AwsEcsLaunchtypeValues={}));var f;(function(p){p.AMD64="amd64",p.ARM32="arm32",p.ARM64="arm64",p.IA64="ia64",p.PPC32="ppc32",p.PPC64="ppc64",p.X86="x86"})(f=s.HostArchValues||(s.HostArchValues={}));var u;(function(p){p.WINDOWS="windows",p.LINUX="linux",p.DARWIN="darwin",p.FREEBSD="freebsd",p.NETBSD="netbsd",p.OPENBSD="openbsd",p.DRAGONFLYBSD="dragonflybsd",p.HPUX="hpux",p.AIX="aix",p.SOLARIS="solaris",p.Z_OS="z_os"})(u=s.OsTypeValues||(s.OsTypeValues={}));var h;(function(p){p.CPP="cpp",p.DOTNET="dotnet",p.ERLANG="erlang",p.GO="go",p.JAVA="java",p.NODEJS="nodejs",p.PHP="php",p.PYTHON="python",p.RUBY="ruby",p.WEBJS="webjs"})(h=s.TelemetrySdkLanguageValues||(s.TelemetrySdkLanguageValues={}))}),qs=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Zn(),s)}),Yr=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(js(),s),o(qs(),s)}),zs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SDK_INFO=void 0;var x=Ji(),o=Yr();s.SDK_INFO={[o.ResourceAttributes.TELEMETRY_SDK_NAME]:"opentelemetry",[o.ResourceAttributes.PROCESS_RUNTIME_NAME]:"node",[o.ResourceAttributes.TELEMETRY_SDK_LANGUAGE]:o.TelemetrySdkLanguageValues.NODEJS,[o.ResourceAttributes.TELEMETRY_SDK_VERSION]:x.VERSION}}),Ws=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.unrefTimer=void 0;function x(o){o.unref()}s.unrefTimer=x}),Gs=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Nn(),s),o(Zi(),s),o(Ci(),s),o(Yn(),s),o(zs(),s),o(Ws(),s)}),jo=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Gs(),s)}),Vs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.isTimeInput=s.isTimeInputHrTime=s.hrTimeToMicroseconds=s.hrTimeToMilliseconds=s.hrTimeToNanoseconds=s.hrTimeToTimeStamp=s.hrTimeDuration=s.timeInputToHrTime=s.hrTime=void 0;var x=jo(),o=9,c=Math.pow(10,o);function f(A){let O=A/1e3,D=Math.trunc(O),q=Number((O-D).toFixed(o))*c;return[D,q]}function u(){let A=x.otperformance.timeOrigin;if(typeof A!="number"){let O=x.otperformance;A=O.timing&&O.timing.fetchStart}return A}function h(A){let O=f(u()),D=f(typeof A=="number"?A:x.otperformance.now()),q=O[0]+D[0],Q=O[1]+D[1];return Q>c&&(Q-=c,q+=1),[q,Q]}s.hrTime=h;function p(A){if(C(A))return A;if(typeof A=="number")return A<u()?h(A):f(A);if(A instanceof Date)return f(A.getTime());throw TypeError("Invalid input type")}s.timeInputToHrTime=p;function g(A,O){let D=O[0]-A[0],q=O[1]-A[1];return q<0&&(D-=1,q+=c),[D,q]}s.hrTimeDuration=g;function b(A){let O=o,D=`${"0".repeat(O)}${A[1]}Z`,q=D.substr(D.length-O-1);return new Date(A[0]*1e3).toISOString().replace("000Z",q)}s.hrTimeToTimeStamp=b;function w(A){return A[0]*c+A[1]}s.hrTimeToNanoseconds=w;function y(A){return Math.round(A[0]*1e3+A[1]/1e6)}s.hrTimeToMilliseconds=y;function S(A){return Math.round(A[0]*1e6+A[1]/1e3)}s.hrTimeToMicroseconds=S;function C(A){return Array.isArray(A)&&A.length===2&&typeof A[0]=="number"&&typeof A[1]=="number"}s.isTimeInputHrTime=C;function T(A){return C(A)||typeof A=="number"||A instanceof Date}s.isTimeInput=T}),il=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),ol=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ExportResultCode=void 0;var x;(function(o){o[o.SUCCESS=0]="SUCCESS",o[o.FAILED=1]="FAILED"})(x=s.ExportResultCode||(s.ExportResultCode={}))}),al=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CompositePropagator=void 0;var x=Xt(),o=class{constructor(c={}){var f;this._propagators=(f=c.propagators)!==null&&f!==void 0?f:[],this._fields=Array.from(new Set(this._propagators.map(u=>typeof u.fields=="function"?u.fields():[]).reduce((u,h)=>u.concat(h),[])))}inject(c,f,u){for(let h of this._propagators)try{h.inject(c,f,u)}catch(p){x.diag.warn(`Failed to inject with ${h.constructor.name}. Err: ${p.message}`)}}extract(c,f,u){return this._propagators.reduce((h,p)=>{try{return p.extract(h,f,u)}catch(g){x.diag.warn(`Failed to inject with ${p.constructor.name}. Err: ${g.message}`)}return h},c)}fields(){return this._fields.slice()}};s.CompositePropagator=o}),Ks=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.validateValue=s.validateKey=void 0;var x="[_0-9a-z-*/]",o=`[a-z]${x}{0,255}`,c=`[a-z0-9]${x}{0,240}@[a-z]${x}{0,13}`,f=new RegExp(`^(?:${o}|${c})$`),u=/^[ -~]{0,255}[!-~]$/,h=/,|=/;function p(b){return f.test(b)}s.validateKey=p;function g(b){return u.test(b)&&!h.test(b)}s.validateValue=g}),qo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.TraceState=void 0;var x=Ks(),o=32,c=512,f=",",u="=",h=class{constructor(p){this._internalState=new Map,p&&this._parse(p)}set(p,g){let b=this._clone();return b._internalState.has(p)&&b._internalState.delete(p),b._internalState.set(p,g),b}unset(p){let g=this._clone();return g._internalState.delete(p),g}get(p){return this._internalState.get(p)}serialize(){return this._keys().reduce((p,g)=>(p.push(g+u+this.get(g)),p),[]).join(f)}_parse(p){p.length>c||(this._internalState=p.split(f).reverse().reduce((g,b)=>{let w=b.trim(),y=w.indexOf(u);if(y!==-1){let S=w.slice(0,y),C=w.slice(y+1,b.length);x.validateKey(S)&&x.validateValue(C)&&g.set(S,C)}return g},new Map),this._internalState.size>o&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,o))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){let p=new h;return p._internalState=new Map(this._internalState),p}};s.TraceState=h}),sl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.HttpTraceContextPropagator=s.parseTraceParent=s.TRACE_STATE_HEADER=s.TRACE_PARENT_HEADER=void 0;var x=Xt(),o=Bo(),c=qo();s.TRACE_PARENT_HEADER="traceparent",s.TRACE_STATE_HEADER="tracestate";var f="00",u="(?!ff)[\\da-f]{2}",h="(?![0]{32})[\\da-f]{32}",p="(?![0]{16})[\\da-f]{16}",g="[\\da-f]{2}",b=new RegExp(`^\\s?(${u})-(${h})-(${p})-(${g})(-.*)?\\s?$`);function w(S){let C=b.exec(S);return!C||C[1]==="00"&&C[5]?null:{traceId:C[2],spanId:C[3],traceFlags:parseInt(C[4],16)}}s.parseTraceParent=w;var y=class{inject(S,C,T){let A=x.trace.getSpanContext(S);if(!A||o.isTracingSuppressed(S)||!x.isSpanContextValid(A))return;let O=`${f}-${A.traceId}-${A.spanId}-0${Number(A.traceFlags||x.TraceFlags.NONE).toString(16)}`;T.set(C,s.TRACE_PARENT_HEADER,O),A.traceState&&T.set(C,s.TRACE_STATE_HEADER,A.traceState.serialize())}extract(S,C,T){let A=T.get(C,s.TRACE_PARENT_HEADER);if(!A)return S;let O=Array.isArray(A)?A[0]:A;if(typeof O!="string")return S;let D=w(O);if(!D)return S;D.isRemote=!0;let q=T.get(C,s.TRACE_STATE_HEADER);if(q){let Q=Array.isArray(q)?q.join(","):q;D.traceState=new c.TraceState(typeof Q=="string"?Q:void 0)}return x.trace.setSpanContext(S,D)}fields(){return[s.TRACE_PARENT_HEADER,s.TRACE_STATE_HEADER]}};s.HttpTraceContextPropagator=y}),zo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),eo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.getRPCMetadata=s.deleteRPCMetadata=s.setRPCMetadata=s.RPCType=void 0;var x=Xt(),o=x.createContextKey("OpenTelemetry SDK Context Key RPC_METADATA"),c;(function(p){p.HTTP="http"})(c=s.RPCType||(s.RPCType={}));function f(p,g){return p.setValue(o,g)}s.setRPCMetadata=f;function u(p){return p.deleteValue(o)}s.deleteRPCMetadata=u;function h(p){return p.getValue(o)}s.getRPCMetadata=h}),to=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AlwaysOffSampler=void 0;var x=Xt(),o=class{shouldSample(){return{decision:x.SamplingDecision.NOT_RECORD}}toString(){return"AlwaysOffSampler"}};s.AlwaysOffSampler=o}),Zr=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AlwaysOnSampler=void 0;var x=Xt(),o=class{shouldSample(){return{decision:x.SamplingDecision.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}};s.AlwaysOnSampler=o}),Ba=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ParentBasedSampler=void 0;var x=Xt(),o=Ho(),c=to(),f=Zr(),u=class{constructor(h){var p,g,b,w;this._root=h.root,this._root||(o.globalErrorHandler(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new f.AlwaysOnSampler),this._remoteParentSampled=(p=h.remoteParentSampled)!==null&&p!==void 0?p:new f.AlwaysOnSampler,this._remoteParentNotSampled=(g=h.remoteParentNotSampled)!==null&&g!==void 0?g:new c.AlwaysOffSampler,this._localParentSampled=(b=h.localParentSampled)!==null&&b!==void 0?b:new f.AlwaysOnSampler,this._localParentNotSampled=(w=h.localParentNotSampled)!==null&&w!==void 0?w:new c.AlwaysOffSampler}shouldSample(h,p,g,b,w,y){let S=x.trace.getSpanContext(h);return!S||!x.isSpanContextValid(S)?this._root.shouldSample(h,p,g,b,w,y):S.isRemote?S.traceFlags&x.TraceFlags.SAMPLED?this._remoteParentSampled.shouldSample(h,p,g,b,w,y):this._remoteParentNotSampled.shouldSample(h,p,g,b,w,y):S.traceFlags&x.TraceFlags.SAMPLED?this._localParentSampled.shouldSample(h,p,g,b,w,y):this._localParentNotSampled.shouldSample(h,p,g,b,w,y)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}};s.ParentBasedSampler=u}),Jn=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.TraceIdRatioBasedSampler=void 0;var x=Xt(),o=class{constructor(c=0){this._ratio=c,this._ratio=this._normalize(c),this._upperBound=Math.floor(this._ratio*4294967295)}shouldSample(c,f){return{decision:x.isValidTraceId(f)&&this._accumulate(f)<this._upperBound?x.SamplingDecision.RECORD_AND_SAMPLED:x.SamplingDecision.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(c){return typeof c!="number"||isNaN(c)?0:c>=1?1:c<=0?0:c}_accumulate(c){let f=0;for(let u=0;u<c.length/8;u++){let h=u*8,p=parseInt(c.slice(h,h+8),16);f=(f^p)>>>0}return f}};s.TraceIdRatioBasedSampler=o}),ro=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.isUrlIgnored=s.urlMatches=void 0;function x(c,f){return typeof f=="string"?c===f:f.test(c)}s.urlMatches=x;function o(c,f){if(!f)return!1;for(let u of f)if(x(c,u))return!0;return!1}s.isUrlIgnored=o}),Wo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.isWrapped=void 0;function x(o){return typeof o=="function"&&typeof o.__original=="function"&&typeof o.__unwrap=="function"&&o.__wrapped===!0}s.isWrapped=x}),Jr=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),s.baggageUtils=void 0,o(Hs(),s),o(nl(),s),o(Ho(),s),o($a(),s),o(Vs(),s),o(il(),s),o(ol(),s),o(Ji(),s),s.baggageUtils=Yi(),o(jo(),s),o(al(),s),o(sl(),s),o(zo(),s),o(eo(),s),o(to(),s),o(Zr(),s),o(Ba(),s),o(Jn(),s),o(Bo(),s),o(qo(),s),o(Us(),s),o(Uo(),s),o(ro(),s),o(Wo(),s),o(Ji(),s)}),cl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ExceptionEventName=void 0,s.ExceptionEventName="exception"}),Qs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Span=void 0;var x=Xt(),o=Jr(),c=Yr(),f=cl(),u=class{constructor(h,p,g,b,w,y,S=[],C=o.hrTime()){this.attributes={},this.links=[],this.events=[],this.status={code:x.SpanStatusCode.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=g,this._spanContext=b,this.parentSpanId=y,this.kind=w,this.links=S,this.startTime=o.timeInputToHrTime(C),this.resource=h.resource,this.instrumentationLibrary=h.instrumentationLibrary,this._spanLimits=h.getSpanLimits(),this._spanProcessor=h.getActiveSpanProcessor(),this._spanProcessor.onStart(this,p)}spanContext(){return this._spanContext}setAttribute(h,p){return p==null||this._isSpanEnded()?this:h.length===0?(x.diag.warn(`Invalid attribute key: ${h}`),this):o.isAttributeValue(p)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,h)?this:(this.attributes[h]=p,this):(x.diag.warn(`Invalid attribute value set for key: ${h}`),this)}setAttributes(h){for(let[p,g]of Object.entries(h))this.setAttribute(p,g);return this}addEvent(h,p,g){return this._isSpanEnded()?this:(this.events.length>=this._spanLimits.eventCountLimit&&(x.diag.warn("Dropping extra events."),this.events.shift()),o.isTimeInput(p)&&(typeof g=="undefined"&&(g=p),p=void 0),typeof g=="undefined"&&(g=o.hrTime()),this.events.push({name:h,attributes:p,time:o.timeInputToHrTime(g)}),this)}setStatus(h){return this._isSpanEnded()?this:(this.status=h,this)}updateName(h){return this._isSpanEnded()?this:(this.name=h,this)}end(h=o.hrTime()){if(this._isSpanEnded()){x.diag.error("You can only call end() on a span once.");return}this._ended=!0,this.endTime=o.timeInputToHrTime(h),this._duration=o.hrTimeDuration(this.startTime,this.endTime),this._duration[0]<0&&x.diag.warn("Inconsistent start and end time, startTime > endTime",this.startTime,this.endTime),this._spanProcessor.onEnd(this)}isRecording(){return this._ended===!1}recordException(h,p=o.hrTime()){let g={};typeof h=="string"?g[c.SemanticAttributes.EXCEPTION_MESSAGE]=h:h&&(h.code?g[c.SemanticAttributes.EXCEPTION_TYPE]=h.code.toString():h.name&&(g[c.SemanticAttributes.EXCEPTION_TYPE]=h.name),h.message&&(g[c.SemanticAttributes.EXCEPTION_MESSAGE]=h.message),h.stack&&(g[c.SemanticAttributes.EXCEPTION_STACKTRACE]=h.stack)),g[c.SemanticAttributes.EXCEPTION_TYPE]||g[c.SemanticAttributes.EXCEPTION_MESSAGE]?this.addEvent(f.ExceptionEventName,g,p):x.diag.warn(`Failed to record an exception ${h}`)}get duration(){return this._duration}get ended(){return this._ended}_isSpanEnded(){return this._ended&&x.diag.warn("Can not execute the operation on ended Span {traceId: %s, spanId: %s}",this._spanContext.traceId,this._spanContext.spanId),this._ended}};s.Span=u}),Go=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.buildSamplerFromEnv=s.DEFAULT_CONFIG=void 0;var x=Xt(),o=Jr(),c=o.getEnv(),f=o.TracesSamplerValues.AlwaysOn;s.DEFAULT_CONFIG={sampler:u(c),forceFlushTimeoutMillis:3e4,spanLimits:{attributeCountLimit:o.getEnv().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:o.getEnv().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:o.getEnv().OTEL_SPAN_EVENT_COUNT_LIMIT}};function u(g=o.getEnv()){switch(g.OTEL_TRACES_SAMPLER){case o.TracesSamplerValues.AlwaysOn:return new o.AlwaysOnSampler;case o.TracesSamplerValues.AlwaysOff:return new o.AlwaysOffSampler;case o.TracesSamplerValues.ParentBasedAlwaysOn:return new o.ParentBasedSampler({root:new o.AlwaysOnSampler});case o.TracesSamplerValues.ParentBasedAlwaysOff:return new o.ParentBasedSampler({root:new o.AlwaysOffSampler});case o.TracesSamplerValues.TraceIdRatio:return new o.TraceIdRatioBasedSampler(p(g));case o.TracesSamplerValues.ParentBasedTraceIdRatio:return new o.ParentBasedSampler({root:new o.TraceIdRatioBasedSampler(p(g))});default:return x.diag.error(`OTEL_TRACES_SAMPLER value "${g.OTEL_TRACES_SAMPLER} invalid, defaulting to ${f}".`),new o.AlwaysOnSampler}}s.buildSamplerFromEnv=u;var h=1;function p(g){if(g.OTEL_TRACES_SAMPLER_ARG===void 0||g.OTEL_TRACES_SAMPLER_ARG==="")return x.diag.error(`OTEL_TRACES_SAMPLER_ARG is blank, defaulting to ${h}.`),h;let b=Number(g.OTEL_TRACES_SAMPLER_ARG);return isNaN(b)?(x.diag.error(`OTEL_TRACES_SAMPLER_ARG=${g.OTEL_TRACES_SAMPLER_ARG} was given, but it is invalid, defaulting to ${h}.`),h):b<0||b>1?(x.diag.error(`OTEL_TRACES_SAMPLER_ARG=${g.OTEL_TRACES_SAMPLER_ARG} was given, but it is out of range ([0..1]), defaulting to ${h}.`),h):b}}),Mn=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.mergeConfig=void 0;var x=Go();function o(c){let f={sampler:x.buildSamplerFromEnv()},u=Object.assign({},x.DEFAULT_CONFIG,f,c);return u.spanLimits=Object.assign({},x.DEFAULT_CONFIG.spanLimits,c.spanLimits||{}),u}s.mergeConfig=o}),Xs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Tracer=void 0;var x=Xt(),o=Jr(),c=Qs(),f=Mn(),u=class{constructor(p,g,b){this._tracerProvider=b;let w=f.mergeConfig(g);this._sampler=w.sampler,this._spanLimits=w.spanLimits,this._idGenerator=g.idGenerator||new o.RandomIdGenerator,this.resource=b.resource,this.instrumentationLibrary=p}startSpan(p,g={},b=x.context.active()){var w,y;if(o.isTracingSuppressed(b))return x.diag.debug("Instrumentation suppressed, returning Noop Span"),x.trace.wrapSpanContext(x.INVALID_SPAN_CONTEXT);let S=h(g,b),C=this._idGenerator.generateSpanId(),T,A,O;!S||!x.trace.isSpanContextValid(S)?T=this._idGenerator.generateTraceId():(T=S.traceId,A=S.traceState,O=S.spanId);let D=(w=g.kind)!==null&&w!==void 0?w:x.SpanKind.INTERNAL,q=(y=g.links)!==null&&y!==void 0?y:[],Q=o.sanitizeAttributes(g.attributes),V=this._sampler.shouldSample(g.root?x.trace.setSpanContext(b,x.INVALID_SPAN_CONTEXT):b,T,p,D,Q,q),ie=V.decision===x.SamplingDecision.RECORD_AND_SAMPLED?x.TraceFlags.SAMPLED:x.TraceFlags.NONE,pe={traceId:T,spanId:C,traceFlags:ie,traceState:A};if(V.decision===x.SamplingDecision.NOT_RECORD)return x.diag.debug("Recording is off, propagating context in a non-recording span"),x.trace.wrapSpanContext(pe);let me=new c.Span(this,b,p,pe,D,O,q,g.startTime);return me.setAttributes(Object.assign(Q,V.attributes)),me}startActiveSpan(p,g,b,w){let y,S,C;if(arguments.length<2)return;arguments.length===2?C=g:arguments.length===3?(y=g,C=b):(y=g,S=b,C=w);let T=S!=null?S:x.context.active(),A=this.startSpan(p,y,T),O=x.trace.setSpan(T,A);return x.context.with(O,C,void 0,A)}getSpanLimits(){return this._spanLimits}getActiveSpanProcessor(){return this._tracerProvider.getActiveSpanProcessor()}};s.Tracer=u;function h(p,g){if(!p.root)return x.trace.getSpanContext(g)}}),Ys=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.defaultServiceName=void 0;function x(){return`unknown_service:${process.argv0}`}s.defaultServiceName=x}),ll=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.detectResources=void 0;var x=hn(),o=Xt(),c=H(3837),f=async(h={})=>{let p=Object.assign(h),g=await Promise.all((p.detectors||[]).map(async b=>{try{let w=await b.detect(p);return o.diag.debug(`${b.constructor.name} found resource.`,w),w}catch(w){return o.diag.debug(`${b.constructor.name} failed: ${w.message}`),x.Resource.empty()}}));return u(g),g.reduce((b,w)=>b.merge(w),x.Resource.empty())};s.detectResources=f;var u=h=>{h.forEach(p=>{if(Object.keys(p.attributes).length>0){let g=c.inspect(p.attributes,{depth:2,breakLength:1/0,sorted:!0,compact:!1});o.diag.verbose(g)}})}}),Zs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.envDetector=void 0;var x=Xt(),o=Jr(),c=Yr(),f=xi(),u=class{constructor(){this._MAX_LENGTH=255,this._COMMA_SEPARATOR=",",this._LABEL_KEY_VALUE_SPLITTER="=",this._ERROR_MESSAGE_INVALID_CHARS="should be a ASCII string with a length greater than 0 and not exceed "+this._MAX_LENGTH+" characters.",this._ERROR_MESSAGE_INVALID_VALUE="should be a ASCII string with a length not exceed "+this._MAX_LENGTH+" characters."}async detect(h){let p={},g=o.getEnv(),b=g.OTEL_RESOURCE_ATTRIBUTES,w=g.OTEL_SERVICE_NAME;if(b)try{let y=this._parseResourceAttributes(b);Object.assign(p,y)}catch(y){x.diag.debug(`EnvDetector failed: ${y.message}`)}return w&&(p[c.ResourceAttributes.SERVICE_NAME]=w),new f.Resource(p)}_parseResourceAttributes(h){if(!h)return{};let p={},g=h.split(this._COMMA_SEPARATOR,-1);for(let b of g){let w=b.split(this._LABEL_KEY_VALUE_SPLITTER,-1);if(w.length!==2)continue;let[y,S]=w;if(y=y.trim(),S=S.trim().split('^"|"$').join(""),!this._isValidAndNotEmpty(y))throw new Error(`Attribute key ${this._ERROR_MESSAGE_INVALID_CHARS}`);if(!this._isValid(S))throw new Error(`Attribute value ${this._ERROR_MESSAGE_INVALID_VALUE}`);p[y]=S}return p}_isValid(h){return h.length<=this._MAX_LENGTH&&this._isPrintableString(h)}_isPrintableString(h){for(let p=0;p<h.length;p++){let g=h.charAt(p);if(g<=" "||g>="~")return!1}return!0}_isValidAndNotEmpty(h){return h.length>0&&this._isValid(h)}};s.envDetector=new u}),Ha=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.processDetector=void 0;var x=Xt(),o=Yr(),c=xi(),f=class{async detect(u){let h={[o.ResourceAttributes.PROCESS_PID]:process.pid,[o.ResourceAttributes.PROCESS_EXECUTABLE_NAME]:process.title||"",[o.ResourceAttributes.PROCESS_COMMAND]:process.argv[1]||"",[o.ResourceAttributes.PROCESS_COMMAND_LINE]:process.argv.join(" ")||""};return this._getResourceAttributes(h,u)}_getResourceAttributes(u,h){return u[o.ResourceAttributes.PROCESS_EXECUTABLE_NAME]===""||u[o.ResourceAttributes.PROCESS_EXECUTABLE_PATH]===""||u[o.ResourceAttributes.PROCESS_COMMAND]===""||u[o.ResourceAttributes.PROCESS_COMMAND_LINE]===""?(x.diag.debug("ProcessDetector failed: Unable to find required process resources. "),c.Resource.empty()):new c.Resource(Object.assign({},u))}};s.processDetector=new f}),no=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Zs(),s),o(Ha(),s)}),ei=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Ys(),s),o(ll(),s),o(no(),s)}),Ua=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(ei(),s)}),hn=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Resource=void 0;var x=Yr(),o=Jr(),c=Ua(),f=class{constructor(u){this.attributes=u}static empty(){return f.EMPTY}static default(){return new f({[x.ResourceAttributes.SERVICE_NAME]:c.defaultServiceName(),[x.ResourceAttributes.TELEMETRY_SDK_LANGUAGE]:o.SDK_INFO[x.ResourceAttributes.TELEMETRY_SDK_LANGUAGE],[x.ResourceAttributes.TELEMETRY_SDK_NAME]:o.SDK_INFO[x.ResourceAttributes.TELEMETRY_SDK_NAME],[x.ResourceAttributes.TELEMETRY_SDK_VERSION]:o.SDK_INFO[x.ResourceAttributes.TELEMETRY_SDK_VERSION]})}merge(u){if(!u||!Object.keys(u.attributes).length)return this;let h=Object.assign({},this.attributes,u.attributes);return new f(h)}};s.Resource=f,f.EMPTY=new f({})}),Ti=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Vo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),xi=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(hn(),s),o(Ua(),s),o(Ti(),s),o(Vo(),s)}),ul=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.MultiSpanProcessor=void 0;var x=Jr(),o=class{constructor(c){this._spanProcessors=c}forceFlush(){let c=[];for(let f of this._spanProcessors)c.push(f.forceFlush());return new Promise(f=>{Promise.all(c).then(()=>{f()}).catch(u=>{x.globalErrorHandler(u||new Error("MultiSpanProcessor: forceFlush failed")),f()})})}onStart(c,f){for(let u of this._spanProcessors)u.onStart(c,f)}onEnd(c){for(let f of this._spanProcessors)f.onEnd(c)}shutdown(){let c=[];for(let f of this._spanProcessors)c.push(f.shutdown());return new Promise((f,u)=>{Promise.all(c).then(()=>{f()},u)})}};s.MultiSpanProcessor=o}),ti=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.NoopSpanProcessor=void 0;var x=class{onStart(o,c){}onEnd(o){}shutdown(){return Promise.resolve()}forceFlush(){return Promise.resolve()}};s.NoopSpanProcessor=x}),ja=k((s,x)=>{var o=200,c="__lodash_hash_undefined__",f=800,u=16,h=9007199254740991,p="[object Arguments]",g="[object Array]",b="[object AsyncFunction]",w="[object Boolean]",y="[object Date]",S="[object Error]",C="[object Function]",T="[object GeneratorFunction]",A="[object Map]",O="[object Number]",D="[object Null]",q="[object Object]",Q="[object Proxy]",V="[object RegExp]",ie="[object Set]",pe="[object String]",me="[object Undefined]",Se="[object WeakMap]",He="[object ArrayBuffer]",ze="[object DataView]",ot="[object Float32Array]",mt="[object Float64Array]",Nt="[object Int8Array]",Pt="[object Int16Array]",Zt="[object Int32Array]",$t="[object Uint8Array]",Xe="[object Uint8ClampedArray]",at="[object Uint16Array]",Ne="[object Uint32Array]",ht=/[\\^$.*+?()[\]{}|]/g,dt=/^\[object .+?Constructor\]$/,jt=/^(?:0|[1-9]\d*)$/,wt={};wt[ot]=wt[mt]=wt[Nt]=wt[Pt]=wt[Zt]=wt[$t]=wt[Xe]=wt[at]=wt[Ne]=!0,wt[p]=wt[g]=wt[He]=wt[w]=wt[ze]=wt[y]=wt[S]=wt[C]=wt[A]=wt[O]=wt[q]=wt[V]=wt[ie]=wt[pe]=wt[Se]=!1;var er=typeof global=="object"&&global&&global.Object===Object&&global,hr=typeof self=="object"&&self&&self.Object===Object&&self,he=er||hr||Function("return this")(),mr=typeof s=="object"&&s&&!s.nodeType&&s,Oe=mr&&typeof x=="object"&&x&&!x.nodeType&&x,fr=Oe&&Oe.exports===mr,Hr=fr&&er.process,bt=function(){try{var Z=Oe&&Oe.require&&Oe.require("util").types;return Z||Hr&&Hr.binding&&Hr.binding("util")}catch(ge){}}(),xt=bt&&bt.isTypedArray;function tr(Z,ge,xe){switch(xe.length){case 0:return Z.call(ge);case 1:return Z.call(ge,xe[0]);case 2:return Z.call(ge,xe[0],xe[1]);case 3:return Z.call(ge,xe[0],xe[1],xe[2])}return Z.apply(ge,xe)}function Sr(Z,ge){for(var xe=-1,pt=Array(Z);++xe<Z;)pt[xe]=ge(xe);return pt}function pa(Z){return function(ge){return Z(ge)}}function An(Z,ge){return Z==null?void 0:Z[ge]}function Lt(Z,ge){return function(xe){return Z(ge(xe))}}var fs=Array.prototype,fo=Function.prototype,Gt=Object.prototype,ct=he["__core-js_shared__"],Ur=fo.toString,en=Gt.hasOwnProperty,Ni=function(){var Z=/[^.]+$/.exec(ct&&ct.keys&&ct.keys.IE_PROTO||"");return Z?"Symbol(src)_1."+Z:""}(),Mi=Gt.toString,tn=Ur.call(Object),li=RegExp("^"+Ur.call(en).replace(ht,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hn=fr?he.Buffer:void 0,Li=he.Symbol,ui=he.Uint8Array,rn=Hn?Hn.allocUnsafe:void 0,In=Lt(Object.getPrototypeOf,Object),di=Object.create,Pn=Gt.propertyIsEnumerable,ps=fs.splice,Rr=Li?Li.toStringTag:void 0,hi=function(){try{var Z=Ec(Object,"defineProperty");return Z({},"",{}),Z}catch(ge){}}(),nn=Hn?Hn.isBuffer:void 0,pr=Math.max,Ye=Date.now,Dr=Ec(he,"Map"),po=Ec(Object,"create"),rr=function(){function Z(){}return function(ge){if(!_o(ge))return{};if(di)return di(ge);Z.prototype=ge;var xe=new Z;return Z.prototype=void 0,xe}}();function Er(Z){var ge=-1,xe=Z==null?0:Z.length;for(this.clear();++ge<xe;){var pt=Z[ge];this.set(pt[0],pt[1])}}function Un(){this.__data__=po?po(null):{},this.size=0}function Bt(Z){var ge=this.has(Z)&&delete this.__data__[Z];return this.size-=ge?1:0,ge}function ga(Z){var ge=this.__data__;if(po){var xe=ge[Z];return xe===c?void 0:xe}return en.call(ge,Z)?ge[Z]:void 0}function jr(Z){var ge=this.__data__;return po?ge[Z]!==void 0:en.call(ge,Z)}function fi(Z,ge){var xe=this.__data__;return this.size+=this.has(Z)?0:1,xe[Z]=po&&ge===void 0?c:ge,this}Er.prototype.clear=Un,Er.prototype.delete=Bt,Er.prototype.get=ga,Er.prototype.has=jr,Er.prototype.set=fi;function vn(Z){var ge=-1,xe=Z==null?0:Z.length;for(this.clear();++ge<xe;){var pt=Z[ge];this.set(pt[0],pt[1])}}function Jl(){this.__data__=[],this.size=0}function ma(Z){var ge=this.__data__,xe=Ht(ge,Z);if(xe<0)return!1;var pt=ge.length-1;return xe==pt?ge.pop():ps.call(ge,xe,1),--this.size,!0}function va(Z){var ge=this.__data__,xe=Ht(ge,Z);return xe<0?void 0:ge[xe][1]}function eu(Z){return Ht(this.__data__,Z)>-1}function go(Z,ge){var xe=this.__data__,pt=Ht(xe,Z);return pt<0?(++this.size,xe.push([Z,ge])):xe[pt][1]=ge,this}vn.prototype.clear=Jl,vn.prototype.delete=ma,vn.prototype.get=va,vn.prototype.has=eu,vn.prototype.set=go;function mo(Z){var ge=-1,xe=Z==null?0:Z.length;for(this.clear();++ge<xe;){var pt=Z[ge];this.set(pt[0],pt[1])}}function tu(){this.size=0,this.__data__={hash:new Er,map:new(Dr||vn),string:new Er}}function ru(Z){var ge=iu(this,Z).delete(Z);return this.size-=ge?1:0,ge}function nu(Z){return iu(this,Z).get(Z)}function gs(Z){return iu(this,Z).has(Z)}function yn(Z,ge){var xe=iu(this,Z),pt=xe.size;return xe.set(Z,ge),this.size+=xe.size==pt?0:1,this}mo.prototype.clear=tu,mo.prototype.delete=ru,mo.prototype.get=nu,mo.prototype.has=gs,mo.prototype.set=yn;function _n(Z){var ge=this.__data__=new vn(Z);this.size=ge.size}function ms(){this.__data__=new vn,this.size=0}function Y(Z){var ge=this.__data__,xe=ge.delete(Z);return this.size=ge.size,xe}function de(Z){return this.__data__.get(Z)}function ce(Z){return this.__data__.has(Z)}function Ze(Z,ge){var xe=this.__data__;if(xe instanceof vn){var pt=xe.__data__;if(!Dr||pt.length<o-1)return pt.push([Z,ge]),this.size=++xe.size,this;xe=this.__data__=new mo(pt)}return xe.set(Z,ge),this.size=xe.size,this}_n.prototype.clear=ms,_n.prototype.delete=Y,_n.prototype.get=de,_n.prototype.has=ce,_n.prototype.set=Ze;function nt(Z,ge){var xe=yo(Z),pt=!xe&&dd(Z),qt=!xe&&!pt&&Ih(Z),ar=!xe&&!pt&&!qt&&xc(Z),gr=xe||pt||qt||ar,Mt=gr?Sr(Z.length,String):[],vr=Mt.length;for(var ln in Z)(ge||en.call(Z,ln))&&!(gr&&(ln=="length"||qt&&(ln=="offset"||ln=="parent")||ar&&(ln=="buffer"||ln=="byteLength"||ln=="byteOffset")||Th(ln,vr)))&&Mt.push(ln);return Mt}function ft(Z,ge,xe){(xe!==void 0&&!vo(Z[ge],xe)||xe===void 0&&!(ge in Z))&&Ut(Z,ge,xe)}function yt(Z,ge,xe){var pt=Z[ge];(!(en.call(Z,ge)&&vo(pt,xe))||xe===void 0&&!(ge in Z))&&Ut(Z,ge,xe)}function Ht(Z,ge){for(var xe=Z.length;xe--;)if(vo(Z[xe][0],ge))return xe;return-1}function Ut(Z,ge,xe){ge=="__proto__"&&hi?hi(Z,ge,{configurable:!0,enumerable:!0,value:xe,writable:!0}):Z[ge]=xe}var bn=Ch();function sr(Z){return Z==null?Z===void 0?me:D:Rr&&Rr in Object(Z)?Rp(Z):ou(Z)}function Vt(Z){return bo(Z)&&sr(Z)==p}function Dt(Z){if(!_o(Z)||xh(Z))return!1;var ge=Tc(Z)?li:dt;return ge.test(su(Z))}function Ar(Z){return bo(Z)&&fd(Z.length)&&!!wt[sr(Z)]}function Sh(Z){if(!_o(Z))return Rh(Z);var ge=ud(Z),xe=[];for(var pt in Z)pt=="constructor"&&(ge||!en.call(Z,pt))||xe.push(pt);return xe}function od(Z,ge,xe,pt,qt){Z!==ge&&bn(ge,function(ar,gr){if(qt||(qt=new _n),_o(ar))Eh(Z,ge,gr,xe,od,pt,qt);else{var Mt=pt?pt(au(Z,gr),ar,gr+"",Z,ge,qt):void 0;Mt===void 0&&(Mt=ar),ft(Z,gr,Mt)}},Dh)}function Eh(Z,ge,xe,pt,qt,ar,gr){var Mt=au(Z,xe),vr=au(ge,xe),ln=gr.get(vr);if(ln){ft(Z,xe,ln);return}var on=ar?ar(Mt,vr,xe+"",Z,ge,gr):void 0,wo=on===void 0;if(wo){var vd=yo(vr),yd=!vd&&Ih(vr),_d=!vd&&!yd&&xc(vr);on=vr,vd||yd||_d?yo(Mt)?on=Mt:hd(Mt)?on=Tp(Mt):yd?(wo=!1,on=sd(vr,!0)):_d?(wo=!1,on=wc(vr,!0)):on=[]:Ph(vr)||dd(vr)?(on=Mt,dd(Mt)?on=Oh(Mt):(!_o(Mt)||Tc(Mt))&&(on=ld(vr))):wo=!1}wo&&(gr.set(vr,on),qt(on,vr,pt,ar,gr),gr.delete(vr)),ft(Z,xe,on)}function Cp(Z,ge){return ya(Ah(Z,ge,vs),Z+"")}var ad=hi?function(Z,ge){return hi(Z,"toString",{configurable:!0,enumerable:!1,value:gd(ge),writable:!0})}:vs;function sd(Z,ge){if(ge)return Z.slice();var xe=Z.length,pt=rn?rn(xe):new Z.constructor(xe);return Z.copy(pt),pt}function cd(Z){var ge=new Z.constructor(Z.byteLength);return new ui(ge).set(new ui(Z)),ge}function wc(Z,ge){var xe=ge?cd(Z.buffer):Z.buffer;return new Z.constructor(xe,Z.byteOffset,Z.length)}function Tp(Z,ge){var xe=-1,pt=Z.length;for(ge||(ge=Array(pt));++xe<pt;)ge[xe]=Z[xe];return ge}function xp(Z,ge,xe,pt){var qt=!xe;xe||(xe={});for(var ar=-1,gr=ge.length;++ar<gr;){var Mt=ge[ar],vr=pt?pt(xe[Mt],Z[Mt],Mt,xe,Z):void 0;vr===void 0&&(vr=Z[Mt]),qt?Ut(xe,Mt,vr):yt(xe,Mt,vr)}return xe}function Sc(Z){return Cp(function(ge,xe){var pt=-1,qt=xe.length,ar=qt>1?xe[qt-1]:void 0,gr=qt>2?xe[2]:void 0;for(ar=Z.length>3&&typeof ar=="function"?(qt--,ar):void 0,gr&&Cc(xe[0],xe[1],gr)&&(ar=qt<3?void 0:ar,qt=1),ge=Object(ge);++pt<qt;){var Mt=xe[pt];Mt&&Z(ge,Mt,pt,ar)}return ge})}function Ch(Z){return function(ge,xe,pt){for(var qt=-1,ar=Object(ge),gr=pt(ge),Mt=gr.length;Mt--;){var vr=gr[Z?Mt:++qt];if(xe(ar[vr],vr,ar)===!1)break}return ge}}function iu(Z,ge){var xe=Z.__data__;return pi(ge)?xe[typeof ge=="string"?"string":"hash"]:xe.map}function Ec(Z,ge){var xe=An(Z,ge);return Dt(xe)?xe:void 0}function Rp(Z){var ge=en.call(Z,Rr),xe=Z[Rr];try{Z[Rr]=void 0;var pt=!0}catch(ar){}var qt=Mi.call(Z);return pt&&(ge?Z[Rr]=xe:delete Z[Rr]),qt}function ld(Z){return typeof Z.constructor=="function"&&!ud(Z)?rr(In(Z)):{}}function Th(Z,ge){var xe=typeof Z;return ge=ge==null?h:ge,!!ge&&(xe=="number"||xe!="symbol"&&jt.test(Z))&&Z>-1&&Z%1==0&&Z<ge}function Cc(Z,ge,xe){if(!_o(xe))return!1;var pt=typeof ge;return(pt=="number"?cu(xe)&&Th(ge,xe.length):pt=="string"&&ge in xe)?vo(xe[ge],Z):!1}function pi(Z){var ge=typeof Z;return ge=="string"||ge=="number"||ge=="symbol"||ge=="boolean"?Z!=="__proto__":Z===null}function xh(Z){return!!Ni&&Ni in Z}function ud(Z){var ge=Z&&Z.constructor,xe=typeof ge=="function"&&ge.prototype||Gt;return Z===xe}function Rh(Z){var ge=[];if(Z!=null)for(var xe in Object(Z))ge.push(xe);return ge}function ou(Z){return Mi.call(Z)}function Ah(Z,ge,xe){return ge=pr(ge===void 0?Z.length-1:ge,0),function(){for(var pt=arguments,qt=-1,ar=pr(pt.length-ge,0),gr=Array(ar);++qt<ar;)gr[qt]=pt[ge+qt];qt=-1;for(var Mt=Array(ge+1);++qt<ge;)Mt[qt]=pt[qt];return Mt[ge]=xe(gr),tr(Z,this,Mt)}}function au(Z,ge){if(!(ge==="constructor"&&typeof Z[ge]=="function")&&ge!="__proto__")return Z[ge]}var ya=Ap(ad);function Ap(Z){var ge=0,xe=0;return function(){var pt=Ye(),qt=u-(pt-xe);if(xe=pt,qt>0){if(++ge>=f)return arguments[0]}else ge=0;return Z.apply(void 0,arguments)}}function su(Z){if(Z!=null){try{return Ur.call(Z)}catch(ge){}try{return Z+""}catch(ge){}}return""}function vo(Z,ge){return Z===ge||Z!==Z&&ge!==ge}var dd=Vt(function(){return arguments}())?Vt:function(Z){return bo(Z)&&en.call(Z,"callee")&&!Pn.call(Z,"callee")},yo=Array.isArray;function cu(Z){return Z!=null&&fd(Z.length)&&!Tc(Z)}function hd(Z){return bo(Z)&&cu(Z)}var Ih=nn||md;function Tc(Z){if(!_o(Z))return!1;var ge=sr(Z);return ge==C||ge==T||ge==b||ge==Q}function fd(Z){return typeof Z=="number"&&Z>-1&&Z%1==0&&Z<=h}function _o(Z){var ge=typeof Z;return Z!=null&&(ge=="object"||ge=="function")}function bo(Z){return Z!=null&&typeof Z=="object"}function Ph(Z){if(!bo(Z)||sr(Z)!=q)return!1;var ge=In(Z);if(ge===null)return!0;var xe=en.call(ge,"constructor")&&ge.constructor;return typeof xe=="function"&&xe instanceof xe&&Ur.call(xe)==tn}var xc=xt?pa(xt):Ar;function Oh(Z){return xp(Z,Dh(Z))}function Dh(Z){return cu(Z)?nt(Z,!0):Sh(Z)}var pd=Sc(function(Z,ge,xe){od(Z,ge,xe)});function gd(Z){return function(){return Z}}function vs(Z){return Z}function md(){return!1}x.exports=pd}),dl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BatchSpanProcessorBase=void 0;var x=Xt(),o=Jr(),c=class{constructor(f,u){this._exporter=f,this._finishedSpans=[],this._isShutdown=!1,this._shuttingDownPromise=Promise.resolve();let h=o.getEnv();this._maxExportBatchSize=typeof(u==null?void 0:u.maxExportBatchSize)=="number"?u.maxExportBatchSize:h.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof(u==null?void 0:u.maxQueueSize)=="number"?u.maxQueueSize:h.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof(u==null?void 0:u.scheduledDelayMillis)=="number"?u.scheduledDelayMillis:h.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof(u==null?void 0:u.exportTimeoutMillis)=="number"?u.exportTimeoutMillis:h.OTEL_BSP_EXPORT_TIMEOUT}forceFlush(){return this._isShutdown?this._shuttingDownPromise:this._flushAll()}onStart(f){}onEnd(f){this._isShutdown||this._addToBuffer(f)}shutdown(){return this._isShutdown?this._shuttingDownPromise:(this._isShutdown=!0,this._shuttingDownPromise=new Promise((f,u)=>{Promise.resolve().then(()=>this.onShutdown()).then(()=>this._flushAll()).then(()=>this._exporter.shutdown()).then(f).catch(h=>{u(h)})}),this._shuttingDownPromise)}_addToBuffer(f){this._finishedSpans.length>=this._maxQueueSize||(this._finishedSpans.push(f),this._maybeStartTimer())}_flushAll(){return new Promise((f,u)=>{let h=[],p=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);for(let g=0,b=p;g<b;g++)h.push(this._flushOneBatch());Promise.all(h).then(()=>{f()}).catch(u)})}_flushOneBatch(){return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise((f,u)=>{let h=setTimeout(()=>{u(new Error("Timeout"))},this._exportTimeoutMillis);x.context.with(o.suppressTracing(x.context.active()),()=>{this._exporter.export(this._finishedSpans.splice(0,this._maxExportBatchSize),p=>{var g;clearTimeout(h),p.code===o.ExportResultCode.SUCCESS?f():u((g=p.error)!==null&&g!==void 0?g:new Error("BatchSpanProcessor: span export failed"))})})})}_maybeStartTimer(){this._timer===void 0&&(this._timer=setTimeout(()=>{this._flushOneBatch().then(()=>{this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(f=>{o.globalErrorHandler(f)})},this._scheduledDelayMillis),o.unrefTimer(this._timer))}_clearTimer(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)}};s.BatchSpanProcessorBase=c}),hl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BatchSpanProcessor=void 0;var x=dl(),o=class extends x.BatchSpanProcessorBase{onShutdown(){}};s.BatchSpanProcessor=o}),fl=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(hl(),s)}),qa=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(fl(),s)}),pl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BasicTracerProvider=s.ForceFlushState=void 0;var x=Xt(),o=Jr(),c=xi(),f=oo(),u=Go(),h=ul(),p=ti(),g=ja(),b=qa(),w;(function(S){S[S.resolved=0]="resolved",S[S.timeout=1]="timeout",S[S.error=2]="error",S[S.unresolved=3]="unresolved"})(w=s.ForceFlushState||(s.ForceFlushState={}));var y=class{constructor(S={}){var C;this._registeredSpanProcessors=[],this._tracers=new Map;let T=g({},u.DEFAULT_CONFIG,S);this.resource=(C=T.resource)!==null&&C!==void 0?C:c.Resource.empty(),this.resource=c.Resource.default().merge(this.resource),this._config=Object.assign({},T,{resource:this.resource});let A=this._buildExporterFromEnv();if(A!==void 0){let O=new b.BatchSpanProcessor(A);this.activeSpanProcessor=O}else this.activeSpanProcessor=new p.NoopSpanProcessor}getTracer(S,C){let T=`${S}@${C||""}`;return this._tracers.has(T)||this._tracers.set(T,new f.Tracer({name:S,version:C},this._config,this)),this._tracers.get(T)}addSpanProcessor(S){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(C=>x.diag.error("Error while trying to shutdown current span processor",C)),this._registeredSpanProcessors.push(S),this.activeSpanProcessor=new h.MultiSpanProcessor(this._registeredSpanProcessors)}getActiveSpanProcessor(){return this.activeSpanProcessor}register(S={}){x.trace.setGlobalTracerProvider(this),S.propagator===void 0&&(S.propagator=this._buildPropagatorFromEnv()),S.contextManager&&x.context.setGlobalContextManager(S.contextManager),S.propagator&&x.propagation.setGlobalPropagator(S.propagator)}forceFlush(){let S=this._config.forceFlushTimeoutMillis,C=this._registeredSpanProcessors.map(T=>new Promise(A=>{let O,D=setTimeout(()=>{A(new Error(`Span processor did not completed within timeout period of ${S} ms`)),O=w.timeout},S);T.forceFlush().then(()=>{clearTimeout(D),O!==w.timeout&&(O=w.resolved,A(O))}).catch(q=>{clearTimeout(D),O=w.error,A(q)})}));return new Promise((T,A)=>{Promise.all(C).then(O=>{let D=O.filter(q=>q!==w.resolved);D.length>0?A(D):T()}).catch(O=>A([O]))})}shutdown(){return this.activeSpanProcessor.shutdown()}_getPropagator(S){var C;return(C=y._registeredPropagators.get(S))===null||C===void 0?void 0:C()}_getSpanExporter(S){var C;return(C=y._registeredExporters.get(S))===null||C===void 0?void 0:C()}_buildPropagatorFromEnv(){let S=Array.from(new Set(o.getEnv().OTEL_PROPAGATORS)),C=S.map(T=>{let A=this._getPropagator(T);return A||x.diag.warn(`Propagator "${T}" requested through environment variable is unavailable.`),A}).reduce((T,A)=>(A&&T.push(A),T),[]);if(C.length!==0)return S.length===1?C[0]:new o.CompositePropagator({propagators:C})}_buildExporterFromEnv(){let S=o.getEnv().OTEL_TRACES_EXPORTER;if(S==="none")return;let C=this._getSpanExporter(S);return C||x.diag.error(`Exporter "${S}" requested through environment variable is unavailable.`),C}};s.BasicTracerProvider=y,y._registeredPropagators=new Map([["tracecontext",()=>new o.HttpTraceContextPropagator],["baggage",()=>new o.HttpBaggagePropagator]]),y._registeredExporters=new Map}),Ko=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ConsoleSpanExporter=void 0;var x=Jr(),o=class{export(c,f){return this._sendSpans(c,f)}shutdown(){return this._sendSpans([]),Promise.resolve()}_exportInfo(c){return{traceId:c.spanContext().traceId,parentId:c.parentSpanId,name:c.name,id:c.spanContext().spanId,kind:c.kind,timestamp:x.hrTimeToMicroseconds(c.startTime),duration:x.hrTimeToMicroseconds(c.duration),attributes:c.attributes,status:c.status,events:c.events}}_sendSpans(c,f){for(let u of c)console.log(this._exportInfo(u));if(f)return f({code:x.ExportResultCode.SUCCESS})}};s.ConsoleSpanExporter=o}),gl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.InMemorySpanExporter=void 0;var x=Jr(),o=class{constructor(){this._finishedSpans=[],this._stopped=!1}export(c,f){if(this._stopped)return f({code:x.ExportResultCode.FAILED,error:new Error("Exporter has been stopped")});this._finishedSpans.push(...c),setTimeout(()=>f({code:x.ExportResultCode.SUCCESS}),0)}shutdown(){return this._stopped=!0,this._finishedSpans=[],Promise.resolve()}reset(){this._finishedSpans=[]}getFinishedSpans(){return this._finishedSpans}};s.InMemorySpanExporter=o}),io=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Js=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SimpleSpanProcessor=void 0;var x=Xt(),o=Jr(),c=class{constructor(f){this._exporter=f,this._isShutdown=!1,this._shuttingDownPromise=Promise.resolve()}forceFlush(){return Promise.resolve()}onStart(f){}onEnd(f){this._isShutdown||x.context.with(o.suppressTracing(x.context.active()),()=>{this._exporter.export([f],u=>{var h;u.code!==o.ExportResultCode.SUCCESS&&o.globalErrorHandler((h=u.error)!==null&&h!==void 0?h:new Error(`SimpleSpanProcessor: span export failed (status ${u})`))})})}shutdown(){return this._isShutdown?this._shuttingDownPromise:(this._isShutdown=!0,this._shuttingDownPromise=new Promise((f,u)=>{Promise.resolve().then(()=>this._exporter.shutdown()).then(f).catch(h=>{u(h)})}),this._shuttingDownPromise)}};s.SimpleSpanProcessor=c}),ml=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),ec=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Ri=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Ai=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),oo=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Xs(),s),o(pl(),s),o(qa(),s),o(Ko(),s),o(gl(),s),o(io(),s),o(Js(),s),o(ml(),s),o(ti(),s),o(Qs(),s),o(ec(),s),o(Ri(),s),o(Ai(),s)}),za=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.azureCoreTracing=s.AzureMonitorSymbol=void 0;var x=ue();s.AzureMonitorSymbol="Azure_Monitor_Tracer";var o=!1,c=function(u){if(o)return u;try{var h=oo(),p=Xt(),g=new h.BasicTracerProvider,b=g.getTracer("applicationinsights tracer"),w=u.setTracer;u.setTracer=function(y){var S=y.startSpan;y.startSpan=function(C,T,A){var O=S.call(this,C,T,A),D=O.end;return O.end=function(){var q=D.apply(this,arguments);return x.channel.publish("azure-coretracing",O),q},O},y[s.AzureMonitorSymbol]=!0,w.call(this,y)},p.trace.getSpan(p.context.active()),u.setTracer(b),o=!0}catch(y){}return u};s.azureCoreTracing={versionSpecifier:">= 1.0.0 < 2.0.0",patch:c};function f(){x.channel.registerMonkeyPatch("@azure/core-tracing",s.azureCoreTracing)}s.enable=f}),vl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.bunyan=void 0;var x=ue(),o=function(f){var u=f.prototype._emit;return f.prototype._emit=function(h,p){var g=u.apply(this,arguments);if(!p){var b=g;b||(b=u.call(this,h,!0)),x.channel.publish("bunyan",{level:h.level,result:b})}return g},f};s.bunyan={versionSpecifier:">= 1.0.0 < 2.0.0",patch:o};function c(){x.channel.registerMonkeyPatch("bunyan",s.bunyan)}s.enable=c}),Qo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.console=void 0;var x=ue(),o=H(2781),c=function(u){var h=new o.Writable,p=new o.Writable;h.write=function(T){if(!T)return!0;var A=T.toString();return x.channel.publish("console",{message:A}),!0},p.write=function(T){if(!T)return!0;var A=T.toString();return x.channel.publish("console",{message:A,stderr:!0}),!0};for(var g=new u.Console(h,p),b=["log","info","warn","error","dir","time","timeEnd","trace","assert"],w=function(T){var A=u[T];A&&(u[T]=function(){if(g[T])try{g[T].apply(g,arguments)}catch(O){}return A.apply(u,arguments)})},y=0,S=b;y<S.length;y++){var C=S[y];w(C)}return u};s.console={versionSpecifier:">= 4.0.0",patch:c};function f(){x.channel.registerMonkeyPatch("console",s.console),H(6206)}s.enable=f}),Wa=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.mongoCore=void 0;var x=ue(),o=function(f){var u=f.Server.prototype.connect;return f.Server.prototype.connect=function(){var h=u.apply(this,arguments),p=this.s.pool.write;this.s.pool.write=function(){var b=typeof arguments[1]=="function"?1:2;return typeof arguments[b]=="function"&&(arguments[b]=x.channel.bindToContext(arguments[b])),p.apply(this,arguments)};var g=this.s.pool.logout;return this.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=x.channel.bindToContext(arguments[1])),g.apply(this,arguments)},h},f};s.mongoCore={versionSpecifier:">= 2.0.0 < 4.0.0",patch:o};function c(){x.channel.registerMonkeyPatch("mongodb-core",s.mongoCore)}s.enable=c}),Ga=k(s=>{"use strict";var x=s&&s.__assign||function(){return x=Object.assign||function(g){for(var b,w=1,y=arguments.length;w<y;w++){b=arguments[w];for(var S in b)Object.prototype.hasOwnProperty.call(b,S)&&(g[S]=b[S])}return g},x.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.mongo330=s.mongo3=s.mongo2=void 0;var o=ue(),c=function(g){var b=g.instrument({operationIdGenerator:{next:function(){return o.channel.bindToContext(function(y){return y()})}}}),w={};return b.on("started",function(y){w[y.requestId]||(w[y.requestId]=x(x({},y),{time:new Date}))}),b.on("succeeded",function(y){var S=w[y.requestId];S&&delete w[y.requestId],typeof y.operationId=="function"?y.operationId(function(){return o.channel.publish("mongodb",{startedData:S,event:y,succeeded:!0})}):o.channel.publish("mongodb",{startedData:S,event:y,succeeded:!0})}),b.on("failed",function(y){var S=w[y.requestId];S&&delete w[y.requestId],typeof y.operationId=="function"?y.operationId(function(){return o.channel.publish("mongodb",{startedData:S,event:y,succeeded:!1})}):o.channel.publish("mongodb",{startedData:S,event:y,succeeded:!1})}),g},f=function(g){var b=g.instrument(),w={},y={};return b.on("started",function(S){w[S.requestId]||(y[S.requestId]=o.channel.bindToContext(function(C){return C()}),w[S.requestId]=x(x({},S),{time:new Date}))}),b.on("succeeded",function(S){var C=w[S.requestId];C&&delete w[S.requestId],typeof S=="object"&&typeof y[S.requestId]=="function"&&(y[S.requestId](function(){return o.channel.publish("mongodb",{startedData:C,event:S,succeeded:!0})}),delete y[S.requestId])}),b.on("failed",function(S){var C=w[S.requestId];C&&delete w[S.requestId],typeof S=="object"&&typeof y[S.requestId]=="function"&&(y[S.requestId](function(){return o.channel.publish("mongodb",{startedData:C,event:S,succeeded:!1})}),delete y[S.requestId])}),g},u=function(g){var b=g.Server.prototype.connect;return g.Server.prototype.connect=function(){var w=b.apply(this,arguments),y=this.s.coreTopology.s.pool.write;this.s.coreTopology.s.pool.write=function(){var C=typeof arguments[1]=="function"?1:2;return typeof arguments[C]=="function"&&(arguments[C]=o.channel.bindToContext(arguments[C])),y.apply(this,arguments)};var S=this.s.coreTopology.s.pool.logout;return this.s.coreTopology.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=o.channel.bindToContext(arguments[1])),S.apply(this,arguments)},w},g},h=function(g){u(g);var b=g.instrument(),w={},y={};return b.on("started",function(S){w[S.requestId]||(y[S.requestId]=o.channel.bindToContext(function(C){return C()}),w[S.requestId]=S)}),b.on("succeeded",function(S){var C=w[S.requestId];C&&delete w[S.requestId],typeof S=="object"&&typeof y[S.requestId]=="function"&&(y[S.requestId](function(){return o.channel.publish("mongodb",{startedData:C,event:S,succeeded:!0})}),delete y[S.requestId])}),b.on("failed",function(S){var C=w[S.requestId];C&&delete w[S.requestId],typeof S=="object"&&typeof y[S.requestId]=="function"&&(y[S.requestId](function(){return o.channel.publish("mongodb",{startedData:C,event:S,succeeded:!1})}),delete y[S.requestId])}),g};s.mongo2={versionSpecifier:">= 2.0.0 <= 3.0.5",patch:c},s.mongo3={versionSpecifier:"> 3.0.5 < 3.3.0",patch:f},s.mongo330={versionSpecifier:">= 3.3.0 < 4.0.0",patch:h};function p(){o.channel.registerMonkeyPatch("mongodb",s.mongo2),o.channel.registerMonkeyPatch("mongodb",s.mongo3),o.channel.registerMonkeyPatch("mongodb",s.mongo330)}s.enable=p}),yl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.mysql=void 0;var x=ue(),o=H(1017),c=function(u,h){var p=function(C,T){return function(A,O){var D=C[A];D&&(C[A]=function(){for(var q=arguments.length-1,Q=arguments.length-1;Q>=0;--Q)if(typeof arguments[Q]=="function"){q=Q;break}else if(typeof arguments[Q]!="undefined")break;var V=arguments[q],ie={result:null,startTime:null,startDate:null};typeof V=="function"&&(O?(ie.startTime=process.hrtime(),ie.startDate=new Date,arguments[q]=x.channel.bindToContext(O(ie,V))):arguments[q]=x.channel.bindToContext(V));var pe=D.apply(this,arguments);return ie.result=pe,pe})}},g=function(C,T){return p(C.prototype,T+".prototype")},b=["connect","changeUser","ping","statistics","end"],w=H(3255)(o.dirname(h)+"/lib/Connection");b.forEach(function(C){return g(w,"Connection")(C)}),p(w,"Connection")("createQuery",function(C,T){return function(A){var O=process.hrtime(C.startTime),D=O[0]*1e3+O[1]/1e6|0;x.channel.publish("mysql",{query:C.result,callbackArgs:arguments,err:A,duration:D,time:C.startDate}),T.apply(this,arguments)}});var y=["_enqueueCallback"],S=H(9118)(o.dirname(h)+"/lib/Pool");return y.forEach(function(C){return g(S,"Pool")(C)}),u};s.mysql={versionSpecifier:">= 2.0.0 < 3.0.0",patch:c};function f(){x.channel.registerMonkeyPatch("mysql",s.mysql)}s.enable=f}),_l=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.postgresPool1=void 0;var x=ue();function o(f){var u=f.prototype.connect;return f.prototype.connect=function(h){return h&&(arguments[0]=x.channel.bindToContext(h)),u.apply(this,arguments)},f}s.postgresPool1={versionSpecifier:">= 1.0.0 < 3.0.0",patch:o};function c(){x.channel.registerMonkeyPatch("pg-pool",s.postgresPool1)}s.enable=c}),bl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.postgres7=s.postgres6=void 0;var x=ue(),o=H(2361);function c(h,p){var g=h.Client.prototype.query,b="__diagnosticOriginalFunc";return h.Client.prototype.query=function(w,y,S){var C={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},T=process.hrtime(),A;function O(D){D&&D[b]&&(D=D[b]);var q=x.channel.bindToContext(function(Q,V){var ie=process.hrtime(T);if(C.result=V&&{rowCount:V.rowCount,command:V.command},C.error=Q,C.duration=Math.ceil(ie[0]*1e3+ie[1]/1e6),x.channel.publish("postgres",C),Q){if(D)return D.apply(this,arguments);A&&A instanceof o.EventEmitter&&A.emit("error",Q)}else D&&D.apply(this,arguments)});try{return Object.defineProperty(q,b,{value:D}),q}catch(Q){return D}}try{typeof w=="string"?y instanceof Array?(C.query.preparable={text:w,args:y},S=O(S)):(C.query.text=w,S?S=O(S):y=O(y)):(typeof w.name=="string"?C.query.plan=w.name:w.values instanceof Array?C.query.preparable={text:w.text,args:w.values}:C.query.text=w.text,S?S=O(S):y?y=O(y):w.callback=O(w.callback))}catch(D){return g.apply(this,arguments)}return arguments[0]=w,arguments[1]=y,arguments[2]=S,arguments.length=arguments.length>3?arguments.length:3,A=g.apply(this,arguments),A},h}function f(h,p){var g=h.Client.prototype.query,b="__diagnosticOriginalFunc";return h.Client.prototype.query=function(w,y,S){var C=this,T=!!S,A={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},O=process.hrtime(),D;function q(Q){Q&&Q[b]&&(Q=Q[b]);var V=x.channel.bindToContext(function(ie,pe){var me=process.hrtime(O);if(A.result=pe&&{rowCount:pe.rowCount,command:pe.command},A.error=ie,A.duration=Math.ceil(me[0]*1e3+me[1]/1e6),x.channel.publish("postgres",A),ie){if(Q)return Q.apply(this,arguments);D&&D instanceof o.EventEmitter&&D.emit("error",ie)}else Q&&Q.apply(this,arguments)});try{return Object.defineProperty(V,b,{value:Q}),V}catch(ie){return Q}}try{typeof w=="string"?y instanceof Array?(A.query.preparable={text:w,args:y},T=typeof S=="function",S=T?q(S):S):(A.query.text=w,S?(T=typeof S=="function",S=T?q(S):S):(T=typeof y=="function",y=T?q(y):y)):(typeof w.name=="string"?A.query.plan=w.name:w.values instanceof Array?A.query.preparable={text:w.text,args:w.values}:A.query.text=w.text,S?(T=typeof S=="function",S=q(S)):y?(T=typeof y=="function",y=T?q(y):y):(T=typeof w.callback=="function",w.callback=T?q(w.callback):w.callback))}catch(Q){return g.apply(this,arguments)}return arguments[0]=w,arguments[1]=y,arguments[2]=S,arguments.length=arguments.length>3?arguments.length:3,D=g.apply(this,arguments),T?D:D.then(function(Q){return q()(void 0,Q),new C._Promise(function(V,ie){V(Q)})}).catch(function(Q){return q()(Q,void 0),new C._Promise(function(V,ie){ie(Q)})})},h}s.postgres6={versionSpecifier:"6.*",patch:c},s.postgres7={versionSpecifier:">=7.* <=8.*",patch:f};function u(){x.channel.registerMonkeyPatch("pg",s.postgres6),x.channel.registerMonkeyPatch("pg",s.postgres7)}s.enable=u}),wl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.redis=void 0;var x=ue(),o=function(f){var u=f.RedisClient.prototype.internal_send_command;return f.RedisClient.prototype.internal_send_command=function(h){if(h){var p=h.callback;if(!p||!p.pubsubBound){var g=this.address,b=process.hrtime(),w=new Date;h.callback=x.channel.bindToContext(function(y,S){var C=process.hrtime(b),T=C[0]*1e3+C[1]/1e6|0;x.channel.publish("redis",{duration:T,address:g,commandObj:h,err:y,result:S,time:w}),typeof p=="function"&&p.apply(this,arguments)}),h.callback.pubsubBound=!0}}return u.call(this,h)},f};s.redis={versionSpecifier:">= 2.0.0 < 4.0.0",patch:o};function c(){x.channel.registerMonkeyPatch("redis",s.redis)}s.enable=c}),fn=k(s=>{"use strict";var x=s&&s.__assign||function(){return x=Object.assign||function(u){for(var h,p=1,g=arguments.length;p<g;p++){h=arguments[p];for(var b in h)Object.prototype.hasOwnProperty.call(h,b)&&(u[b]=h[b])}return u},x.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.tedious=void 0;var o=ue(),c=function(u){var h=u.Connection.prototype.makeRequest;return u.Connection.prototype.makeRequest=function(){function p(b){var w=process.hrtime(),y={query:{},database:{host:null,port:null},result:null,error:null,duration:0};return o.channel.bindToContext(function(S,C,T){var A=process.hrtime(w);y=x(x({},y),{database:{host:this.connection.config.server,port:this.connection.config.options.port},result:!S&&{rowCount:C,rows:T},query:{text:this.parametersByName.statement.value},error:S,duration:Math.ceil(A[0]*1e3+A[1]/1e6)}),o.channel.publish("tedious",y),b.call(this,S,C,T)})}var g=arguments[0];arguments[0].callback=p(g.callback),h.apply(this,arguments)},u};s.tedious={versionSpecifier:">= 6.0.0 < 9.0.0",patch:c};function f(){o.channel.registerMonkeyPatch("tedious",s.tedious)}s.enable=f}),Sl=k(s=>{"use strict";var x=s&&s.__extends||function(){var p=function(g,b){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,y){w.__proto__=y}||function(w,y){for(var S in y)Object.prototype.hasOwnProperty.call(y,S)&&(w[S]=y[S])},p(g,b)};return function(g,b){p(g,b);function w(){this.constructor=g}g.prototype=b===null?Object.create(b):(w.prototype=b.prototype,new w)}}(),o=s&&s.__rest||function(p,g){var b={};for(var w in p)Object.prototype.hasOwnProperty.call(p,w)&&g.indexOf(w)<0&&(b[w]=p[w]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,w=Object.getOwnPropertySymbols(p);y<w.length;y++)g.indexOf(w[y])<0&&Object.prototype.propertyIsEnumerable.call(p,w[y])&&(b[w[y]]=p[w[y]]);return b};Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.winston2=s.winston3=void 0;var c=ue(),f=function(p){var g=p.Logger.prototype.log,b,w=function(y,S,C){var T;return b===p.config.npm.levels?T="npm":b===p.config.syslog.levels?T="syslog":T="unknown",c.channel.publish("winston",{level:y,message:S,meta:C,levelKind:T}),S};return p.Logger.prototype.log=function(){return b=this.levels,!this.filters||this.filters.length===0?this.filters=[w]:this.filters[this.filters.length-1]!==w&&(this.filters=this.filters.filter(function(y){return y!==w}),this.filters.push(w)),g.apply(this,arguments)},p},u=function(p){var g=function(C,T){var A;return C.config.npm.levels[T]!=null?A="npm":C.config.syslog.levels[T]!=null?A="syslog":A="unknown",A},b=function(C){x(T,C);function T(A,O){var D=C.call(this,O)||this;return D.winston=A,D}return T.prototype.log=function(A,O){var D=A.message,q=A.level,Q=A.meta,V=o(A,["message","level","meta"]);q=typeof Symbol.for=="function"?A[Symbol.for("level")]:q,D=A instanceof Error?A:D;var ie=g(this.winston,q);Q=Q||{};for(var pe in V)V.hasOwnProperty(pe)&&(Q[pe]=V[pe]);c.channel.publish("winston",{message:D,level:q,levelKind:ie,meta:Q}),O()},T}(p.Transport);function w(){var C=arguments[0].levels||p.config.npm.levels,T;for(var A in C)C.hasOwnProperty(A)&&(T=T===void 0||C[A]>C[T]?A:T);this.add(new b(p,{level:T}))}var y=p.createLogger;p.createLogger=function(){var C=arguments[0].levels||p.config.npm.levels,T;for(var A in C)C.hasOwnProperty(A)&&(T=T===void 0||C[A]>C[T]?A:T);var O=y.apply(this,arguments);O.add(new b(p,{level:T}));var D=O.configure;return O.configure=function(){D.apply(this,arguments),w.apply(this,arguments)},O};var S=p.configure;return p.configure=function(){S.apply(this,arguments),w.apply(this,arguments)},p.add(new b(p)),p};s.winston3={versionSpecifier:"3.x",patch:u},s.winston2={versionSpecifier:"2.x",patch:f};function h(){c.channel.registerMonkeyPatch("winston",s.winston2),c.channel.registerMonkeyPatch("winston",s.winston3)}s.enable=h}),El=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.tedious=s.pgPool=s.pg=s.winston=s.redis=s.mysql=s.mongodb=s.mongodbCore=s.console=s.bunyan=s.azuresdk=void 0;var x=za();s.azuresdk=x;var o=vl();s.bunyan=o;var c=Qo();s.console=c;var f=Wa();s.mongodbCore=f;var u=Ga();s.mongodb=u;var h=yl();s.mysql=h;var p=_l();s.pgPool=p;var g=bl();s.pg=g;var b=wl();s.redis=b;var w=fn();s.tedious=w;var y=Sl();s.winston=y;function S(){o.enable(),c.enable(),f.enable(),u.enable(),h.enable(),g.enable(),p.enable(),b.enable(),y.enable(),x.enable(),w.enable()}s.enable=S}),Va=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.registerContextPreservation=s.IsInitialized=void 0;var x=ye(),o=rt();s.IsInitialized=!process.env.APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL;var c="DiagnosticChannel";if(s.IsInitialized){f=El(),u=process.env.APPLICATION_INSIGHTS_NO_PATCH_MODULES||"",h=u.split(","),p={bunyan:f.bunyan,console:f.console,mongodb:f.mongodb,mongodbCore:f.mongodbCore,mysql:f.mysql,redis:f.redis,pg:f.pg,pgPool:f.pgPool,winston:f.winston,azuresdk:f.azuresdk};for(g in p)h.indexOf(g)===-1&&(p[g].enable(),o.info(c,"Subscribed to "+g+" events"));h.length>0&&o.info(c,"Some modules will not be patched",h)}else o.info(c,"Not subscribing to dependency autocollection because APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL was set");var f,u,h,p,g;function b(w){if(s.IsInitialized){var y=ue();y.channel.addContextPreservation(w),y.channel.spanContextPropagator=x.AsyncScopeManager}}s.registerContextPreservation=b}),Ln=k((s,x)=>{"use strict";x.exports={requestContextHeader:"request-context",requestContextSourceKey:"appId",requestContextTargetKey:"appId",requestIdHeader:"request-id",parentIdHeader:"x-ms-request-id",rootIdHeader:"x-ms-request-root-id",correlationContextHeader:"correlation-context",traceparentHeader:"traceparent",traceStateHeader:"tracestate"}}),Lr=k((s,x)=>{"use strict";var o=s&&s.__assign||function(){return o=Object.assign||function(w){for(var y,S=1,C=arguments.length;S<C;S++){y=arguments[S];for(var T in y)Object.prototype.hasOwnProperty.call(y,T)&&(w[T]=y[T])}return w},o.apply(this,arguments)},c=H(3685),f=H(5687),u=H(7310),h=H(2057),p=rt(),g=Ln(),b=function(){function w(){}return w.getCookie=function(y,S){var C="";if(y&&y.length&&typeof S=="string")for(var T=y+"=",A=S.split(";"),O=0;O<A.length;O++){var S=A[O];if(S=w.trim(S),S&&S.indexOf(T)===0){C=S.substring(T.length,A[O].length);break}}return C},w.trim=function(y){return typeof y=="string"?y.replace(/^\s+|\s+$/g,""):""},w.int32ArrayToBase64=function(y){var S=function(D,q){return String.fromCharCode(D>>q&255)},C=function(D){return S(D,24)+S(D,16)+S(D,8)+S(D,0)},T=y.map(C).join(""),A=Buffer.from?Buffer.from(T,"binary"):new Buffer(T,"binary"),O=A.toString("base64");return O.substr(0,O.indexOf("="))},w.random32=function(){return 4294967296*Math.random()|0},w.randomu32=function(){return w.random32()+2147483648},w.w3cTraceId=function(){for(var y=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],S="",C,T=0;T<4;T++)C=w.random32(),S+=y[C&15]+y[C>>4&15]+y[C>>8&15]+y[C>>12&15]+y[C>>16&15]+y[C>>20&15]+y[C>>24&15]+y[C>>28&15];var A=y[8+Math.random()*4|0];return S.substr(0,8)+S.substr(9,4)+"4"+S.substr(13,3)+A+S.substr(16,3)+S.substr(19,12)},w.w3cSpanId=function(){return w.w3cTraceId().substring(16)},w.isValidW3CId=function(y){return y.length===32&&y!=="00000000000000000000000000000000"},w.isArray=function(y){return Object.prototype.toString.call(y)==="[object Array]"},w.isError=function(y){return y instanceof Error},w.isPrimitive=function(y){var S=typeof y;return S==="string"||S==="number"||S==="boolean"},w.isDate=function(y){return Object.prototype.toString.call(y)==="[object Date]"},w.msToTimeSpan=function(y){(isNaN(y)||y<0)&&(y=0);var S=(y/1e3%60).toFixed(7).replace(/0{0,4}$/,""),C=""+Math.floor(y/(1e3*60))%60,T=""+Math.floor(y/(1e3*60*60))%24,A=Math.floor(y/(1e3*60*60*24));S=S.indexOf(".")<2?"0"+S:S,C=C.length<2?"0"+C:C,T=T.length<2?"0"+T:T;var O=A>0?A+".":"";return O+T+":"+C+":"+S},w.extractError=function(y){var S=y;return{message:y.message,code:S.code||S.id||""}},w.extractObject=function(y){return y instanceof Error?w.extractError(y):typeof y.toJSON=="function"?y.toJSON():y},w.validateStringMap=function(y){if(typeof y!="object"){p.info("Invalid properties dropped from payload");return}var S={};for(var C in y){var T="",A=y[C],O=typeof A;if(w.isPrimitive(A))T=A.toString();else if(A===null||O==="undefined")T="";else if(O==="function"){p.info("key: "+C+" was function; will not serialize");continue}else{var D=w.isArray(A)?A:w.extractObject(A);try{w.isPrimitive(D)?T=D:T=JSON.stringify(D)}catch(q){T=A.constructor.name.toString()+" (Error: "+q.message+")",p.info("key: "+C+", could not be serialized")}}S[C]=T.substring(0,w.MAX_PROPERTY_LENGTH)}return S},w.canIncludeCorrelationHeader=function(y,S){var C=y&&y.config&&y.config.correlationHeaderExcludedDomains;if(!C||C.length==0||!S)return!0;for(var T=0;T<C.length;T++){var A=new RegExp(C[T].replace(/\./g,".").replace(/\*/g,".*"));if(A.test(u.parse(S).hostname))return!1}return!0},w.getCorrelationContextTarget=function(y,S){var C=y.headers&&y.headers[g.requestContextHeader];if(C)for(var T=C.split(","),A=0;A<T.length;++A){var O=T[A].split("=");if(O.length==2&&O[0]==S)return O[1]}},w.makeRequest=function(y,S,C,T){S&&S.indexOf("//")===0&&(S="https:"+S);var A=u.parse(S),O=o(o({},C),{host:A.hostname,port:A.port,path:A.pathname}),D=void 0;if(A.protocol==="https:"&&(D=y.proxyHttpsUrl||void 0),A.protocol==="http:"&&(D=y.proxyHttpUrl||void 0),D){D.indexOf("//")===0&&(D="http:"+D);var q=u.parse(D);q.protocol==="https:"?(p.info("Proxies that use HTTPS are not supported"),D=void 0):O=o(o({},O),{host:q.hostname,port:q.port||"80",path:S,headers:o(o({},O.headers),{Host:A.hostname})})}var Q=A.protocol==="https:"&&!D;return Q&&y.httpsAgent!==void 0?O.agent=y.httpsAgent:!Q&&y.httpAgent!==void 0?O.agent=y.httpAgent:Q&&(O.agent=w.tlsRestrictedAgent),Q?f.request(O,T):c.request(O,T)},w.safeIncludeCorrelationHeader=function(y,S,C){var T;if(typeof C=="string")T=C;else if(C instanceof Array)T=C.join(",");else if(C&&typeof C.toString=="function")try{T=C.toString()}catch(A){p.warn("Outgoing request-context header could not be read. Correlation of requests may be lost.",A,C)}T?w.addCorrelationIdHeaderFromString(y,S,T):S.setHeader(g.requestContextHeader,g.requestContextSourceKey+"="+y.config.correlationId)},w.dumpObj=function(y){var S=Object.prototype.toString.call(y),C="";return S==="[object Error]"?C="{ stack: '"+y.stack+"', message: '"+y.message+"', name: '"+y.name+"'":C=JSON.stringify(y),S+C},w.addCorrelationIdHeaderFromString=function(y,S,C){var T=C.split(","),A=g.requestContextSourceKey+"=",O=T.some(function(D){return D.substring(0,A.length)===A});O||S.setHeader(g.requestContextHeader,C+","+g.requestContextSourceKey+"="+y.config.correlationId)},w.MAX_PROPERTY_LENGTH=8192,w.tlsRestrictedAgent=new f.Agent({keepAlive:!0,maxSockets:25,secureOptions:h.SSL_OP_NO_SSLv2|h.SSL_OP_NO_SSLv3|h.SSL_OP_NO_TLSv1|h.SSL_OP_NO_TLSv1_1}),w}();x.exports=b}),pn=k((s,x)=>{"use strict";var o=Lr(),c=rt(),f=function(){function u(){}return u.queryCorrelationId=function(h,p){var g=h.profileQueryEndpoint+"/api/profiles/"+h.instrumentationKey+"/appId";if(u.completedLookups.hasOwnProperty(g)){p(u.completedLookups[g]);return}else if(u.pendingLookups[g]){u.pendingLookups[g].push(p);return}u.pendingLookups[g]=[p];var b=function(){if(u.pendingLookups[g]){var w={method:"GET",disableAppInsightsAutoCollection:!0};c.info(u.TAG,w);var y=o.makeRequest(h,g,w,function(S){if(S.statusCode===200){var C="";S.setEncoding("utf-8"),S.on("data",function(T){C+=T}),S.on("end",function(){c.info(u.TAG,C);var T=u.correlationIdPrefix+C;u.completedLookups[g]=T,u.pendingLookups[g]&&u.pendingLookups[g].forEach(function(A){return A(T)}),delete u.pendingLookups[g]})}else S.statusCode>=400&&S.statusCode<500?(u.completedLookups[g]=void 0,delete u.pendingLookups[g]):setTimeout(b,h.correlationIdRetryIntervalMs)});y&&(y.on("error",function(S){c.warn(u.TAG,S)}),y.end())}};setTimeout(b,0)},u.cancelCorrelationIdQuery=function(h,p){var g=h.profileQueryEndpoint+"/api/profiles/"+h.instrumentationKey+"/appId",b=u.pendingLookups[g];b&&(u.pendingLookups[g]=b.filter(function(w){return w!=p}),u.pendingLookups[g].length==0&&delete u.pendingLookups[g])},u.generateRequestId=function(h){if(h){h=h[0]=="|"?h:"|"+h,h[h.length-1]!=="."&&(h+=".");var p=(u.currentRootId++).toString(16);return u.appendSuffix(h,p,"_")}else return u.generateRootId()},u.getRootId=function(h){var p=h.indexOf(".");p<0&&(p=h.length);var g=h[0]==="|"?1:0;return h.substring(g,p)},u.generateRootId=function(){return"|"+o.w3cTraceId()+"."},u.appendSuffix=function(h,p,g){if(h.length+p.length<u.requestIdMaxLength)return h+p+g;var b=u.requestIdMaxLength-9;if(h.length>b)for(;b>1;--b){var w=h[b-1];if(w==="."||w==="_")break}if(b<=1)return u.generateRootId();for(p=o.randomu32().toString(16);p.length<8;)p="0"+p;return h.substring(0,b)+p+"#"},u.TAG="CorrelationIdManager",u.correlationIdPrefix="cid-v1:",u.w3cEnabled=!0,u.pendingLookups={},u.completedLookups={},u.requestIdMaxLength=1024,u.currentRootId=o.randomu32(),u}();x.exports=f}),gn=k((s,x)=>{"use strict";var o=Lr(),c=pn(),f=function(){function u(h,p){if(this.traceFlag=u.DEFAULT_TRACE_FLAG,this.version=u.DEFAULT_VERSION,h&&typeof h=="string")if(h.split(",").length>1)this.traceId=o.w3cTraceId(),this.spanId=o.w3cTraceId().substr(0,16);else{var g=h.trim().split("-"),b=g.length;b>=4?(this.version=g[0],this.traceId=g[1],this.spanId=g[2],this.traceFlag=g[3]):(this.traceId=o.w3cTraceId(),this.spanId=o.w3cTraceId().substr(0,16)),this.version.match(/^[0-9a-f]{2}$/g)||(this.version=u.DEFAULT_VERSION,this.traceId=o.w3cTraceId()),this.version==="00"&&b!==4&&(this.traceId=o.w3cTraceId(),this.spanId=o.w3cTraceId().substr(0,16)),this.version==="ff"&&(this.version=u.DEFAULT_VERSION,this.traceId=o.w3cTraceId(),this.spanId=o.w3cTraceId().substr(0,16)),this.version.match(/^0[0-9a-f]$/g)||(this.version=u.DEFAULT_VERSION),this.traceFlag.match(/^[0-9a-f]{2}$/g)||(this.traceFlag=u.DEFAULT_TRACE_FLAG,this.traceId=o.w3cTraceId()),u.isValidTraceId(this.traceId)||(this.traceId=o.w3cTraceId()),u.isValidSpanId(this.spanId)||(this.spanId=o.w3cTraceId().substr(0,16),this.traceId=o.w3cTraceId()),this.parentId=this.getBackCompatRequestId()}else if(p){this.parentId=p.slice();var w=c.getRootId(p);u.isValidTraceId(w)||(this.legacyRootId=w,w=o.w3cTraceId()),p.indexOf("|")!==-1&&(p=p.substring(1+p.substring(0,p.length-1).lastIndexOf("."),p.length-1)),this.traceId=w,this.spanId=p}else this.traceId=o.w3cTraceId(),this.spanId=o.w3cTraceId().substr(0,16)}return u.isValidTraceId=function(h){return h.match(/^[0-9a-f]{32}$/)&&h!=="00000000000000000000000000000000"},u.isValidSpanId=function(h){return h.match(/^[0-9a-f]{16}$/)&&h!=="0000000000000000"},u.formatOpenTelemetryTraceFlags=function(h){var p="0"+h.toString(16);return p.substring(p.length-2)},u.prototype.getBackCompatRequestId=function(){return"|"+this.traceId+"."+this.spanId+"."},u.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},u.prototype.updateSpanId=function(){this.spanId=o.w3cTraceId().substr(0,16)},u.DEFAULT_TRACE_FLAG="01",u.DEFAULT_VERSION="00",u}();x.exports=f}),tc=k((s,x)=>{"use strict";var o=function(){function c(f){this.fieldmap=[],!!f&&(this.fieldmap=this.parseHeader(f))}return c.prototype.toString=function(){var f=this.fieldmap;return!f||f.length==0?null:f.join(", ")},c.validateKeyChars=function(f){var u=f.split("@");if(u.length==2){var h=u[0].trim(),p=u[1].trim(),g=Boolean(h.match(/^[\ ]?[a-z0-9\*\-\_/]{1,241}$/)),b=Boolean(p.match(/^[\ ]?[a-z0-9\*\-\_/]{1,14}$/));return g&&b}else if(u.length==1)return Boolean(f.match(/^[\ ]?[a-z0-9\*\-\_/]{1,256}$/));return!1},c.prototype.parseHeader=function(f){var u=[],h={},p=f.split(",");if(p.length>32)return null;for(var g=0,b=p;g<b.length;g++){var w=b[g],y=w.trim();if(y.length!==0){var S=y.split("=");if(S.length!==2||!c.validateKeyChars(S[0])||h[S[0]])return null;h[S[0]]=!0,u.push(y)}}return u},c.strict=!0,c}();x.exports=o}),Tn=k((s,x)=>{"use strict";var o=function(){function c(){}return c}();x.exports=o}),Cl=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=Tn(),f=function(u){o(h,u);function h(){var p=u.call(this)||this;return p.ver=2,p.properties={},p.measurements={},p}return h}(c);x.exports=f}),Ka=k((s,x)=>{"use strict";var o=function(){function c(){}return c}();x.exports=o}),Xo=k((s,x)=>{"use strict";var o=function(){function c(){this.applicationVersion="ai.application.ver",this.deviceId="ai.device.id",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceOEMName="ai.device.oemName",this.deviceOSVersion="ai.device.osVersion",this.deviceType="ai.device.type",this.locationIp="ai.location.ip",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.userAccountId="ai.user.accountId",this.userId="ai.user.id",this.userAuthUserId="ai.user.authUserId",this.cloudRole="ai.cloud.role",this.cloudRoleInstance="ai.cloud.roleInstance",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion",this.internalNodeName="ai.internal.nodeName"}return c}();x.exports=o}),Tl=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=Ka(),f=function(u){o(h,u);function h(){return u.call(this)||this}return h}(c);x.exports=f}),Qa=k((s,x)=>{"use strict";var o;(function(c){c[c.Measurement=0]="Measurement",c[c.Aggregation=1]="Aggregation"})(o||(o={})),x.exports=o}),rc=k((s,x)=>{"use strict";var o=Qa(),c=function(){function f(){this.kind=o.Measurement}return f}();x.exports=c}),nc=k((s,x)=>{"use strict";var o=function(){function c(){this.ver=1,this.sampleRate=100,this.tags={}}return c}();x.exports=o}),ri=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=Tn(),f=function(u){o(h,u);function h(){var p=u.call(this)||this;return p.ver=2,p.properties={},p.measurements={},p}return h}(c);x.exports=f}),Ii=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=Tn(),f=function(u){o(h,u);function h(){var p=u.call(this)||this;return p.ver=2,p.exceptions=[],p.properties={},p.measurements={},p}return h}(c);x.exports=f}),ic=k((s,x)=>{"use strict";var o=function(){function c(){this.hasFullStack=!0,this.parsedStack=[]}return c}();x.exports=o}),xl=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=Tn(),f=function(u){o(h,u);function h(){var p=u.call(this)||this;return p.ver=2,p.properties={},p}return h}(c);x.exports=f}),Yo=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=Tn(),f=function(u){o(h,u);function h(){var p=u.call(this)||this;return p.ver=2,p.metrics=[],p.properties={},p}return h}(c);x.exports=f}),Rl=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=ri(),f=function(u){o(h,u);function h(){var p=u.call(this)||this;return p.ver=2,p.properties={},p.measurements={},p}return h}(c);x.exports=f}),Al=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=Tn(),f=function(u){o(h,u);function h(){var p=u.call(this)||this;return p.ver=2,p.success=!0,p.properties={},p.measurements={},p}return h}(c);x.exports=f}),oc=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var u=function(h,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,b){g.__proto__=b}||function(g,b){for(var w in b)Object.prototype.hasOwnProperty.call(b,w)&&(g[w]=b[w])},u(h,p)};return function(h,p){u(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),c=Tn(),f=function(u){o(h,u);function h(){var p=u.call(this)||this;return p.ver=2,p.properties={},p.measurements={},p}return h}(c);x.exports=f}),Il=k((s,x)=>{"use strict";var o;(function(c){c[c.Verbose=0]="Verbose",c[c.Information=1]="Information",c[c.Warning=2]="Warning",c[c.Error=3]="Error",c[c.Critical=4]="Critical"})(o||(o={})),x.exports=o}),Zo=k((s,x)=>{"use strict";var o=function(){function c(){}return c}();x.exports=o}),ao=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AvailabilityData=Cl(),s.Base=Ka(),s.ContextTagKeys=Xo(),s.Data=Tl(),s.DataPoint=rc(),s.DataPointType=Qa(),s.Domain=Tn(),s.Envelope=nc(),s.EventData=ri(),s.ExceptionData=Ii(),s.ExceptionDetails=ic(),s.MessageData=xl(),s.MetricData=Yo(),s.PageViewData=Rl(),s.RemoteDependencyData=Al(),s.RequestData=oc(),s.SeverityLevel=Il(),s.StackFrame=Zo()}),Pl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.domainSupportsProperties=s.RemoteDependencyDataConstants=void 0;var x=ao(),o=function(){function f(){}return f.TYPE_HTTP="Http",f.TYPE_AI="Http (tracked component)",f}();s.RemoteDependencyDataConstants=o;function c(f){return"properties"in f||f instanceof x.EventData||f instanceof x.ExceptionData||f instanceof x.MessageData||f instanceof x.MetricData||f instanceof x.PageViewData||f instanceof x.RemoteDependencyData||f instanceof x.RequestData}s.domainSupportsProperties=c}),Ol=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Xa=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),ac=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Jo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),ni=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),ii=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),so=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),co=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Ya=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Dl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Za=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),kl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),sc=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.TelemetryType=s.TelemetryTypeString=s.baseTypeToTelemetryType=s.telemetryTypeToBaseType=void 0;function x(f){switch(f){case c.Event:return"EventData";case c.Exception:return"ExceptionData";case c.Trace:return"MessageData";case c.Metric:return"MetricData";case c.Request:return"RequestData";case c.Dependency:return"RemoteDependencyData";case c.Availability:return"AvailabilityData";case c.PageView:return"PageViewData"}}s.telemetryTypeToBaseType=x;function o(f){switch(f){case"EventData":return c.Event;case"ExceptionData":return c.Exception;case"MessageData":return c.Trace;case"MetricData":return c.Metric;case"RequestData":return c.Request;case"RemoteDependencyData":return c.Dependency;case"AvailabilityData":return c.Availability;case"PageViewData":return c.PageView}}s.baseTypeToTelemetryType=o,s.TelemetryTypeString={Event:"EventData",Exception:"ExceptionData",Trace:"MessageData",Metric:"MetricData",Request:"RequestData",Dependency:"RemoteDependencyData",Availability:"AvailabilityData",PageView:"PageViewData"};var c;(function(f){f[f.Event=0]="Event",f[f.Exception=1]="Exception",f[f.Trace=2]="Trace",f[f.Metric=3]="Metric",f[f.Request=4]="Request",f[f.Dependency=5]="Dependency",f[f.Availability=6]="Availability",f[f.PageView=7]="PageView"})(c=s.TelemetryType||(s.TelemetryType={}))}),ea=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Ol(),s),o(Xa(),s),o(ac(),s),o(Jo(),s),o(ni(),s),o(ii(),s),o(so(),s),o(co(),s),o(Ya(),s),o(Dl(),s),o(Za(),s),o(kl(),s),o(sc(),s)}),Ja=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),es=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),ts=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Nl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),cc=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),rs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),lc=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),ns=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Ml=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Ja(),s),o(es(),s),o(ts(),s),o(Nl(),s),o(cc(),s),o(rs(),s),o(lc(),s),o(ns(),s)}),Fr=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(Pl(),s),o(ao(),s),o(ea(),s),o(Ml(),s)}),is=k((s,x)=>{"use strict";var o=function(){function c(){}return c.prototype.getUrl=function(){return this.url},c.prototype.RequestParser=function(){this.startTime=+new Date},c.prototype._setStatus=function(f,u){var h=+new Date;this.duration=h-this.startTime,this.statusCode=f;var p=this.properties||{};if(u){if(typeof u=="string")p.error=u;else if(u instanceof Error)p.error=u.message;else if(typeof u=="object")for(var g in u)p[g]=u[g]&&u[g].toString&&u[g].toString()}this.properties=p},c.prototype._isSuccess=function(){return 0<this.statusCode&&this.statusCode<400},c}();x.exports=o}),oi=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var S=function(C,T){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,O){A.__proto__=O}||function(A,O){for(var D in O)Object.prototype.hasOwnProperty.call(O,D)&&(A[D]=O[D])},S(C,T)};return function(C,T){S(C,T);function A(){this.constructor=C}C.prototype=T===null?Object.create(T):(A.prototype=T.prototype,new A)}}(),c=H(7310),f=Fr(),u=Lr(),h=Ln(),p=is(),g=pn(),b=tc(),w=gn(),y=function(S){o(C,S);function C(T,A){var O=S.call(this)||this;return T&&(O.method=T.method,O.url=O._getAbsoluteUrl(T),O.startTime=+new Date,O.socketRemoteAddress=T.socket&&T.socket.remoteAddress,O.parseHeaders(T,A),T.connection&&(O.connectionRemoteAddress=T.connection.remoteAddress,O.legacySocketRemoteAddress=T.connection.socket&&T.connection.socket.remoteAddress)),O}return C.prototype.onError=function(T,A){this._setStatus(void 0,T),A&&(this.duration=A)},C.prototype.onResponse=function(T,A){this._setStatus(T.statusCode,void 0),A&&(this.duration=A)},C.prototype.getRequestTelemetry=function(T){var A={id:this.requestId,name:this.method+" "+c.parse(this.url).pathname,url:this.url,source:this.sourceCorrelationId,duration:this.duration,resultCode:this.statusCode?this.statusCode.toString():null,success:this._isSuccess(),properties:this.properties};if(T&&T.time?A.time=T.time:this.startTime&&(A.time=new Date(this.startTime)),T){for(var O in T)A[O]||(A[O]=T[O]);if(T.properties)for(var O in T.properties)A.properties[O]=T.properties[O]}return A},C.prototype.getRequestTags=function(T){var A={};for(var O in T)A[O]=T[O];return A[C.keys.locationIp]=T[C.keys.locationIp]||this._getIp(),A[C.keys.sessionId]=T[C.keys.sessionId]||this._getId("ai_session"),A[C.keys.userId]=T[C.keys.userId]||this._getId("ai_user"),A[C.keys.userAuthUserId]=T[C.keys.userAuthUserId]||this._getId("ai_authUser"),A[C.keys.operationName]=this.getOperationName(T),A[C.keys.operationParentId]=this.getOperationParentId(T),A[C.keys.operationId]=this.getOperationId(T),A},C.prototype.getOperationId=function(T){return T[C.keys.operationId]||this.operationId},C.prototype.getOperationParentId=function(T){return T[C.keys.operationParentId]||this.parentId||this.getOperationId(T)},C.prototype.getOperationName=function(T){return T[C.keys.operationName]||this.method+" "+c.parse(this.url).pathname},C.prototype.getRequestId=function(){return this.requestId},C.prototype.getCorrelationContextHeader=function(){return this.correlationContextHeader},C.prototype.getTraceparent=function(){return this.traceparent},C.prototype.getTracestate=function(){return this.tracestate},C.prototype.getLegacyRootId=function(){return this.legacyRootId},C.prototype._getAbsoluteUrl=function(T){if(!T.headers)return T.url;var A=T.connection?T.connection.encrypted:null,O=c.parse(T.url),D=O.pathname,q=O.search,Q=A||T.headers["x-forwarded-proto"]=="https"?"https":"http",V=c.format({protocol:Q,host:T.headers.host,pathname:D,search:q});return V},C.prototype._getIp=function(){var T=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,A=function(D){var q=T.exec(D);if(q)return q[0]},O=A(this.rawHeaders["x-forwarded-for"])||A(this.rawHeaders["x-client-ip"])||A(this.rawHeaders["x-real-ip"])||A(this.connectionRemoteAddress)||A(this.socketRemoteAddress)||A(this.legacySocketRemoteAddress);return!O&&this.connectionRemoteAddress&&this.connectionRemoteAddress.substr&&this.connectionRemoteAddress.substr(0,2)==="::"&&(O="127.0.0.1"),O},C.prototype._getId=function(T){var A=this.rawHeaders&&this.rawHeaders.cookie&&typeof this.rawHeaders.cookie=="string"&&this.rawHeaders.cookie||"",O=C.parseId(u.getCookie(T,A));return O},C.prototype.setBackCompatFromThisTraceContext=function(){this.operationId=this.traceparent.traceId,this.traceparent.legacyRootId&&(this.legacyRootId=this.traceparent.legacyRootId),this.parentId=this.traceparent.parentId,this.traceparent.updateSpanId(),this.requestId=this.traceparent.getBackCompatRequestId()},C.prototype.parseHeaders=function(T,A){if(this.rawHeaders=T.headers||T.rawHeaders,this.userAgent=T.headers&&T.headers["user-agent"],this.sourceCorrelationId=u.getCorrelationContextTarget(T,h.requestContextSourceKey),T.headers){var O=T.headers[h.traceStateHeader]?T.headers[h.traceStateHeader].toString():null,D=T.headers[h.traceparentHeader]?T.headers[h.traceparentHeader].toString():null,q=T.headers[h.requestIdHeader]?T.headers[h.requestIdHeader].toString():null,Q=T.headers[h.parentIdHeader]?T.headers[h.parentIdHeader].toString():null,V=T.headers[h.rootIdHeader]?T.headers[h.rootIdHeader].toString():null;this.correlationContextHeader=T.headers[h.correlationContextHeader]?T.headers[h.correlationContextHeader].toString():null,g.w3cEnabled&&(D||O)?(this.traceparent=new w(D?D.toString():null),this.tracestate=D&&O&&new b(O?O.toString():null),this.setBackCompatFromThisTraceContext()):q?g.w3cEnabled?(this.traceparent=new w(null,q),this.setBackCompatFromThisTraceContext()):(this.parentId=q,this.requestId=g.generateRequestId(this.parentId),this.operationId=g.getRootId(this.requestId)):g.w3cEnabled?(this.traceparent=new w,this.traceparent.parentId=Q,this.traceparent.legacyRootId=V||Q,this.setBackCompatFromThisTraceContext()):(this.parentId=Q,this.requestId=g.generateRequestId(V||this.parentId),this.correlationContextHeader=null,this.operationId=g.getRootId(this.requestId)),A&&(this.requestId=A,this.operationId=g.getRootId(this.requestId))}},C.parseId=function(T){var A=T.split("|");return A.length>0?A[0]:""},C.keys=new f.ContextTagKeys,C}(p);x.exports=y}),Pi=k((s,x)=>{"use strict";function o(w){return typeof w=="function"}var c=console.error.bind(console);function f(w,y,S){var C=!!w[y]&&w.propertyIsEnumerable(y);Object.defineProperty(w,y,{configurable:!0,enumerable:C,writable:!0,value:S})}function u(w){w&&w.logger&&(o(w.logger)?c=w.logger:c("new logger isn't a function, not replacing"))}function h(w,y,S){if(!w||!w[y]){c("no original function "+y+" to wrap");return}if(!S){c("no wrapper function"),c(new Error().stack);return}if(!o(w[y])||!o(S)){c("original object and wrapper must be functions");return}var C=w[y],T=S(C,y);return f(T,"__original",C),f(T,"__unwrap",function(){w[y]===T&&f(w,y,C)}),f(T,"__wrapped",!0),f(w,y,T),T}function p(w,y,S){if(w)Array.isArray(w)||(w=[w]);else{c("must provide one or more modules to patch"),c(new Error().stack);return}if(!(y&&Array.isArray(y))){c("must provide one or more functions to wrap on modules");return}w.forEach(function(C){y.forEach(function(T){h(C,T,S)})})}function g(w,y){if(!w||!w[y]){c("no function to unwrap."),c(new Error().stack);return}if(!w[y].__unwrap)c("no original to unwrap to -- has "+y+" already been unwrapped?");else return w[y].__unwrap()}function b(w,y){if(w)Array.isArray(w)||(w=[w]);else{c("must provide one or more modules to patch"),c(new Error().stack);return}if(!(y&&Array.isArray(y))){c("must provide one or more functions to unwrap on modules");return}w.forEach(function(S){y.forEach(function(C){g(S,C)})})}u.wrap=h,u.massWrap=p,u.unwrap=g,u.massUnwrap=b,x.exports=u}),ai=k((s,x)=>{"use strict";var o=Pi(),c=o.wrap,f=o.unwrap,u="wrap@before";function h(y,S,C){var T=!!y[S]&&y.propertyIsEnumerable(S);Object.defineProperty(y,S,{configurable:!0,enumerable:T,writable:!0,value:C})}function p(y,S){for(var C=S.length,T=0;T<C;T++){var A=S[T],O=y[u];if(typeof O=="function")O(A);else if(Array.isArray(O))for(var D=O.length,q=0;q<D;q++)O[q](A)}}function g(y,S){var C;return C=y._events&&y._events[S],Array.isArray(C)||(C?C=[C]:C=[]),C}function b(y,S,C){var T=g(y,S),A=T.filter(function(O){return C.indexOf(O)===-1});A.length>0&&p(y,A)}function w(y,S){if(y){var C=y;if(typeof y=="function")C=S(y);else if(Array.isArray(y)){C=[];for(var T=0;T<y.length;T++)C[T]=S(y[T])}return C}}x.exports=function(y,S,C){if(!y||!y.on||!y.addListener||!y.removeListener||!y.emit)throw new Error("can only wrap real EEs");if(!S)throw new Error("must have function to run on listener addition");if(!C)throw new Error("must have function to wrap listeners when emitting");function T(O){return function(D,q){var Q=g(this,D).slice();try{var V=O.call(this,D,q);return b(this,D,Q),V}finally{this.on.__wrapped||c(this,"on",T),this.addListener.__wrapped||c(this,"addListener",T)}}}function A(O){return function(D){if(!this._events||!this._events[D])return O.apply(this,arguments);var q=this._events[D];function Q(V){return function(){this._events[D]=q;try{return V.apply(this,arguments)}finally{q=this._events[D],this._events[D]=w(q,C)}}}c(this,"removeListener",Q);try{return this._events[D]=w(q,C),O.apply(this,arguments)}finally{f(this,"removeListener"),this._events[D]=q}}}y[u]?typeof y[u]=="function"?h(y,u,[y[u],S]):Array.isArray(y[u])&&y[u].push(S):h(y,u,S),y.__wrapped||(c(y,"addListener",T),c(y,"on",T),c(y,"emit",A),h(y,"__unwrap",function(){f(y,"addListener"),f(y,"on"),f(y,"emit"),delete y[u],delete y.__wrapped}),h(y,"__wrapped",!0))}}),os=k((s,x)=>{"use strict";var o=H(3837),c=H(9491),f=ai(),u=H(852),h="cls@contexts",p="error@context",g=process.env.DEBUG_CLS_HOOKED,b=-1;x.exports={getNamespace:y,createNamespace:S,destroyNamespace:C,reset:T,ERROR_SYMBOL:p};function w(O){this.name=O,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}w.prototype.set=function(O,D){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[O]=D,g){let q=" ".repeat(this._indent<0?0:this._indent);A(q+"CONTEXT-SET KEY:"+O+"="+D+" in ns:"+this.name+" currentUid:"+b+" active:"+o.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return D},w.prototype.get=function(O){if(!this.active){if(g){let D=u.currentId(),q=u.triggerAsyncId(),Q=" ".repeat(this._indent<0?0:this._indent);A(`${Q}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${O}=undefined currentUid:${b} asyncHooksCurrentId:${D} triggerId:${q} len:${this._set.length}`)}return}if(g){let D=u.executionAsyncId(),q=u.triggerAsyncId(),Q=" ".repeat(this._indent<0?0:this._indent);A(Q+"CONTEXT-GETTING KEY:"+O+"="+this.active[O]+" ("+this.name+") currentUid:"+b+" active:"+o.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),A(`${Q}CONTEXT-GETTING KEY: (${this.name}) ${O}=${this.active[O]} currentUid:${b} asyncHooksCurrentId:${D} triggerId:${q} len:${this._set.length} active:${o.inspect(this.active)}`)}return this.active[O]},w.prototype.createContext=function(){let O=Object.create(this.active?this.active:Object.prototype);if(O._ns_name=this.name,O.id=b,g){let D=u.executionAsyncId(),q=u.triggerAsyncId(),Q=" ".repeat(this._indent<0?0:this._indent);A(`${Q}CONTEXT-CREATED Context: (${this.name}) currentUid:${b} asyncHooksCurrentId:${D} triggerId:${q} len:${this._set.length} context:${o.inspect(O,{showHidden:!0,depth:2,colors:!0})}`)}return O},w.prototype.run=function(O){let D=this.createContext();this.enter(D);try{if(g){let q=u.triggerAsyncId(),Q=u.executionAsyncId(),V=" ".repeat(this._indent<0?0:this._indent);A(`${V}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${b} triggerId:${q} asyncHooksCurrentId:${Q} len:${this._set.length} context:${o.inspect(D)}`)}return O(D),D}catch(q){throw q&&(q[p]=D),q}finally{if(g){let q=u.triggerAsyncId(),Q=u.executionAsyncId(),V=" ".repeat(this._indent<0?0:this._indent);A(`${V}CONTEXT-RUN END: (${this.name}) currentUid:${b} triggerId:${q} asyncHooksCurrentId:${Q} len:${this._set.length} ${o.inspect(D)}`)}this.exit(D)}},w.prototype.runAndReturn=function(O){let D;return this.run(function(q){D=O(q)}),D},w.prototype.runPromise=function(O){let D=this.createContext();this.enter(D);let q=O(D);if(!q||!q.then||!q.catch)throw new Error("fn must return a promise.");return g&&A("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+b+" len:"+this._set.length+" "+o.inspect(D)),q.then(Q=>(g&&A("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+b+" len:"+this._set.length+" "+o.inspect(D)),this.exit(D),Q)).catch(Q=>{throw Q[p]=D,g&&A("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+b+" len:"+this._set.length+" "+o.inspect(D)),this.exit(D),Q})},w.prototype.bind=function(O,D){D||(this.active?D=this.active:D=this.createContext());let q=this;return function(){q.enter(D);try{return O.apply(this,arguments)}catch(Q){throw Q&&(Q[p]=D),Q}finally{q.exit(D)}}},w.prototype.enter=function(O){if(c.ok(O,"context must be provided for entering"),g){let D=u.executionAsyncId(),q=u.triggerAsyncId(),Q=" ".repeat(this._indent<0?0:this._indent);A(`${Q}CONTEXT-ENTER: (${this.name}) currentUid:${b} triggerId:${q} asyncHooksCurrentId:${D} len:${this._set.length} ${o.inspect(O)}`)}this._set.push(this.active),this.active=O},w.prototype.exit=function(O){if(c.ok(O,"context must be provided for exiting"),g){let q=u.executionAsyncId(),Q=u.triggerAsyncId(),V=" ".repeat(this._indent<0?0:this._indent);A(`${V}CONTEXT-EXIT: (${this.name}) currentUid:${b} triggerId:${Q} asyncHooksCurrentId:${q} len:${this._set.length} ${o.inspect(O)}`)}if(this.active===O){c.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let D=this._set.lastIndexOf(O);D<0?(g&&A("??ERROR?? context exiting but not entered - ignoring: "+o.inspect(O)),c.ok(D>=0,`context not currently entered; can't exit. 
`+o.inspect(this)+`
`+o.inspect(O))):(c.ok(D,"can't remove top context"),this._set.splice(D,1))},w.prototype.bindEmitter=function(O){c.ok(O.on&&O.addListener&&O.emit,"can only bind real EEs");let D=this,q="context@"+this.name;function Q(ie){!ie||(ie[h]||(ie[h]=Object.create(null)),ie[h][q]={namespace:D,context:D.active})}function V(ie){if(!(ie&&ie[h]))return ie;let pe=ie,me=ie[h];return Object.keys(me).forEach(function(Se){let He=me[Se];pe=He.namespace.bind(pe,He.context)}),pe}f(O,Q,V)},w.prototype.fromException=function(O){return O[p]};function y(O){return process.namespaces[O]}function S(O){c.ok(O,"namespace must be given a name."),g&&A(`NS-CREATING NAMESPACE (${O})`);let D=new w(O);return D.id=b,u.createHook({init(q,Q,V,ie){if(b=u.executionAsyncId(),D.active){if(D._contexts.set(q,D.active),g){let pe=" ".repeat(D._indent<0?0:D._indent);A(`${pe}INIT [${Q}] (${O}) asyncId:${q} currentUid:${b} triggerId:${V} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} resource:${ie}`)}}else if(b===0){let pe=u.triggerAsyncId(),me=D._contexts.get(pe);if(me){if(D._contexts.set(q,me),g){let Se=" ".repeat(D._indent<0?0:D._indent);A(`${Se}INIT USING CONTEXT FROM TRIGGERID [${Q}] (${O}) asyncId:${q} currentUid:${b} triggerId:${pe} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} resource:${ie}`)}}else if(g){let Se=" ".repeat(D._indent<0?0:D._indent);A(`${Se}INIT MISSING CONTEXT [${Q}] (${O}) asyncId:${q} currentUid:${b} triggerId:${pe} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} resource:${ie}`)}}if(g&&Q==="PROMISE"){A(o.inspect(ie,{showHidden:!0}));let pe=ie.parentId,me=" ".repeat(D._indent<0?0:D._indent);A(`${me}INIT RESOURCE-PROMISE [${Q}] (${O}) parentId:${pe} asyncId:${q} currentUid:${b} triggerId:${V} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} resource:${ie}`)}},before(q){b=u.executionAsyncId();let Q;if(Q=D._contexts.get(q)||D._contexts.get(b),Q){if(g){let V=u.triggerAsyncId(),ie=" ".repeat(D._indent<0?0:D._indent);A(`${ie}BEFORE (${O}) asyncId:${q} currentUid:${b} triggerId:${V} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} context:${o.inspect(Q)}`),D._indent+=2}D.enter(Q)}else if(g){let V=u.triggerAsyncId(),ie=" ".repeat(D._indent<0?0:D._indent);A(`${ie}BEFORE MISSING CONTEXT (${O}) asyncId:${q} currentUid:${b} triggerId:${V} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${o.inspect(D._contexts,{showHidden:!0,depth:2,colors:!0})}`),D._indent+=2}},after(q){b=u.executionAsyncId();let Q;if(Q=D._contexts.get(q)||D._contexts.get(b),Q){if(g){let V=u.triggerAsyncId();D._indent-=2;let ie=" ".repeat(D._indent<0?0:D._indent);A(`${ie}AFTER (${O}) asyncId:${q} currentUid:${b} triggerId:${V} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} context:${o.inspect(Q)}`)}D.exit(Q)}else if(g){let V=u.triggerAsyncId();D._indent-=2;let ie=" ".repeat(D._indent<0?0:D._indent);A(`${ie}AFTER MISSING CONTEXT (${O}) asyncId:${q} currentUid:${b} triggerId:${V} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} context:${o.inspect(Q)}`)}},destroy(q){if(b=u.executionAsyncId(),g){let Q=u.triggerAsyncId(),V=" ".repeat(D._indent<0?0:D._indent);A(`${V}DESTROY (${O}) currentUid:${b} asyncId:${q} triggerId:${Q} active:${o.inspect(D.active,{showHidden:!0,depth:2,colors:!0})} context:${o.inspect(D._contexts.get(b))}`)}D._contexts.delete(q)}}).enable(),process.namespaces[O]=D,D}function C(O){let D=y(O);c.ok(D,`can't delete nonexistent namespace! "`+O+'"'),c.ok(D.id,"don't assign to process.namespaces directly! "+o.inspect(D)),process.namespaces[O]=null}function T(){process.namespaces&&Object.keys(process.namespaces).forEach(function(O){C(O)}),process.namespaces=Object.create(null)}process.namespaces={};function A(...O){g&&process._rawDebug(`${o.format(...O)}`)}}),ta=k((s,x)=>{"use strict";function o(){}x.exports=function(){let c=this._hooks,f=this._state,u=process.nextTick;process.nextTick=function(){if(!f.enabled)return u.apply(process,arguments);let h=new Array(arguments.length);for(let w=0;w<arguments.length;w++)h[w]=arguments[w];let p=h[0];if(typeof p!="function")throw new TypeError("callback is not a function");let g=new o,b=--f.counter;return c.init.call(g,b,0,null,null),h[0]=function(){c.pre.call(g,b);let w=!0;try{p.apply(this,arguments),w=!1}finally{w&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){c.post.call(g,b,!0),c.destroy.call(null,b)})}c.post.call(g,b,!1),c.destroy.call(null,b)},u.apply(process,h)}}}),lo=k((s,x)=>{"use strict";function o(){}x.exports=function(){let c=this._hooks,f=this._state,u=global.Promise,h=u.prototype.then;u.prototype.then=w;function p(y,S,C,T){return typeof y!="function"?T?g(C):b(C):function(){c.pre.call(S,C);try{return y.apply(this,arguments)}finally{c.post.call(S,C,!1),c.destroy.call(null,C)}}}function g(y){return function(S){return c.destroy.call(null,y),S}}function b(y){return function(S){throw c.destroy.call(null,y),S}}function w(y,S){if(!f.enabled)return h.call(this,y,S);let C=new o,T=--f.counter;return c.init.call(C,T,0,null,null),h.call(this,p(y,C,T,!0),p(S,C,T,!1))}}}),ra=k((s,x)=>{"use strict";var o=H(9512);function c(){}function f(){}function u(){}var h=new Map,p=new Map,g=new Map,b=null,w=!1;x.exports=function(){y(this._hooks,this._state,"setTimeout","clearTimeout",c,h,!0),y(this._hooks,this._state,"setInterval","clearInterval",f,p,!1),y(this._hooks,this._state,"setImmediate","clearImmediate",u,g,!0),global.setTimeout=o.setTimeout,global.setInterval=o.setInterval,global.setImmediate=o.setImmediate,global.clearTimeout=o.clearTimeout,global.clearInterval=o.clearInterval,global.clearImmediate=o.clearImmediate};function y(S,C,T,A,O,D,q){let Q=o[T],V=o[A];o[T]=function(){if(!C.enabled)return Q.apply(o,arguments);let ie=new Array(arguments.length);for(let ze=0;ze<arguments.length;ze++)ie[ze]=arguments[ze];let pe=ie[0];if(typeof pe!="function")throw new TypeError('"callback" argument must be a function');let me=new O,Se=--C.counter,He;return S.init.call(me,Se,0,null,null),ie[0]=function(){b=He,S.pre.call(me,Se);let ze=!0;try{pe.apply(this,arguments),ze=!1}finally{ze&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){S.post.call(me,Se,!0),D.delete(He),S.destroy.call(null,Se)})}S.post.call(me,Se,!1),b=null,(q||w)&&(w=!1,D.delete(He),S.destroy.call(null,Se))},He=Q.apply(o,ie),D.set(He,Se),He},o[A]=function(ie){if(b===ie&&ie!==null)w=!0;else if(D.has(ie)){let pe=D.get(ie);D.delete(ie),S.destroy.call(null,pe)}V.apply(o,arguments)}}}),xn=k((s,x)=>{x.exports={name:"async-hook-jl",description:"Inspect the life of handle objects in node",version:"1.7.6",author:"Andreas Madsen <amwebdk@gmail.com>",main:"./index.js",scripts:{test:"node ./test/runner.js && eslint ."},repository:{type:"git",url:"git://github.com/jeff-lewis/async-hook-jl.git"},keywords:["async","async hooks","inspect","async wrap"],license:"MIT",dependencies:{"stack-chain":"^1.3.7"},devDependencies:{async:"1.5.x","cli-color":"1.1.x",eslint:"^3.4.0",endpoint:"0.4.x"},engines:{node:"^4.7 || >=6.9 || >=7.3"}}}),as=k((s,x)=>{"use strict";var o=process.binding("async_wrap"),c=o.Providers.TIMERWRAP,f={nextTick:ta(),promise:lo(),timers:ra()},u=new Set;function h(){this.enabled=!1,this.counter=0}function p(){let w=this.initFns=[],y=this.preFns=[],S=this.postFns=[],C=this.destroyFns=[];this.init=function(T,A,O,D){if(A===c){u.add(T);return}for(let q of w)q(T,this,A,O,D)},this.pre=function(T){if(!u.has(T))for(let A of y)A(T,this)},this.post=function(T,A){if(!u.has(T))for(let O of S)O(T,this,A)},this.destroy=function(T){if(u.has(T)){u.delete(T);return}for(let A of C)A(T)}}p.prototype.add=function(w){w.init&&this.initFns.push(w.init),w.pre&&this.preFns.push(w.pre),w.post&&this.postFns.push(w.post),w.destroy&&this.destroyFns.push(w.destroy)};function g(w,y){let S=w.indexOf(y);S!==-1&&w.splice(S,1)}p.prototype.remove=function(w){w.init&&g(this.initFns,w.init),w.pre&&g(this.preFns,w.pre),w.post&&g(this.postFns,w.post),w.destroy&&g(this.destroyFns,w.destroy)};function b(){this._state=new h,this._hooks=new p,this.version=xn().version,this.providers=o.Providers;for(let w of Object.keys(f))f[w].call(this);process.env.hasOwnProperty("NODE_ASYNC_HOOK_WARNING")&&console.warn("warning: you are using async-hook-jl which is unstable."),o.setupHooks({init:this._hooks.init,pre:this._hooks.pre,post:this._hooks.post,destroy:this._hooks.destroy})}x.exports=b,b.prototype.addHooks=function(w){this._hooks.add(w)},b.prototype.removeHooks=function(w){this._hooks.remove(w)},b.prototype.enable=function(){this._state.enabled=!0,o.enable()},b.prototype.disable=function(){this._state.enabled=!1,o.disable()}}),uc=k((s,x)=>{x.exports={name:"stack-chain",description:"API for combining call site modifiers",version:"1.3.7",author:"Andreas Madsen <amwebdk@gmail.com>",scripts:{test:"tap ./test/simple"},repository:{type:"git",url:"git://github.com/AndreasMadsen/stack-chain.git"},keywords:["stack","chain","trace","call site","concat","format"],devDependencies:{tap:"2.x.x","uglify-js":"2.5.x"},license:"MIT"}}),Oi=k((s,x)=>{function o(c){try{return Error.prototype.toString.call(c)}catch(f){try{return"<error: "+f+">"}catch(u){return"<error>"}}}x.exports=function(c,f){var u=[];u.push(o(c));for(var h=0;h<f.length;h++){var p=f[h],g;try{g=p.toString()}catch(b){try{g="<error: "+b+">"}catch(w){g="<error>"}}u.push("    at "+g)}return u.join(`
`)}}),dc=k((s,x)=>{var o=Oi();function c(){this.extend=new h,this.filter=new h,this.format=new p,this.version=uc().version}var f=!1;c.prototype.callSite=function y(S){S||(S={}),f=!0;var C={};Error.captureStackTrace(C,y);var T=C.stack;return f=!1,T=T.slice(S.slice||0),S.extend&&(T=this.extend._modify(C,T)),S.filter&&(T=this.filter._modify(C,T)),T};var u=new c;function h(){this._modifiers=[]}h.prototype._modify=function(y,S){for(var C=0,T=this._modifiers.length;C<T;C++)S=this._modifiers[C](y,S);return S},h.prototype.attach=function(y){this._modifiers.push(y)},h.prototype.deattach=function(y){var S=this._modifiers.indexOf(y);return S===-1?!1:(this._modifiers.splice(S,1),!0)};function p(){this._formater=o,this._previous=void 0}p.prototype.replace=function(y){y?this._formater=y:this.restore()},p.prototype.restore=function(){this._formater=o,this._previous=void 0},p.prototype._backup=function(){this._previous=this._formater},p.prototype._roolback=function(){this._previous===o?this.replace(void 0):this.replace(this._previous),this._previous=void 0},Error.prepareStackTrace&&u.format.replace(Error.prepareStackTrace);var g=!1;function b(y,S){if(f)return S;if(g)return o(y,S);var C=S.concat();C=u.extend._modify(y,C),C=u.filter._modify(y,C),C=C.slice(0,Error.stackTraceLimit),Object.isExtensible(y)&&Object.getOwnPropertyDescriptor(y,"callSite")===void 0&&(y.callSite={original:S,mutated:C}),g=!0;var T=u.format._formater(y,C);return g=!1,T}Object.defineProperty(Error,"prepareStackTrace",{get:function(){return b},set:function(y){y===b?u.format._roolback():(u.format._backup(),u.format.replace(y))}});function w(){return this.stack,this.callSite}Object.defineProperty(Error.prototype,"callSite",{get:w,set:function(y){Object.defineProperty(this,"callSite",{value:y,writable:!0,configurable:!0})},configurable:!0}),x.exports=u}),hc=k((s,x)=>{if(global._stackChain)if(global._stackChain.version===uc().version)x.exports=global._stackChain;else throw new Error("Conflicting version of stack-chain found");else x.exports=global._stackChain=dc()}),na=k((s,x)=>{"use strict";var o=as();if(global._asyncHook)if(global._asyncHook.version===xn().version)x.exports=global._asyncHook;else throw new Error("Conflicting version of async-hook-jl found");else hc().filter.attach(function(c,f){return f.filter(function(u){let h=u.getFileName();return!(h&&h.slice(0,__dirname.length)===__dirname)})}),x.exports=global._asyncHook=new o}),Ll=k((s,x)=>{"use strict";var o=H(3837),c=H(9491),f=ai(),u=na(),h="cls@contexts",p="error@context",g=[];for(let V in u.providers)g[u.providers[V]]=V;var b=process.env.DEBUG_CLS_HOOKED,w=-1;x.exports={getNamespace:S,createNamespace:C,destroyNamespace:T,reset:A,ERROR_SYMBOL:p};function y(V){this.name=V,this.active=null,this._set=[],this.id=null,this._contexts=new Map}y.prototype.set=function(V,ie){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return b&&O("    SETTING KEY:"+V+"="+ie+" in ns:"+this.name+" uid:"+w+" active:"+o.inspect(this.active,!0)),this.active[V]=ie,ie},y.prototype.get=function(V){if(!this.active){b&&O("    GETTING KEY:"+V+"=undefined "+this.name+" uid:"+w+" active:"+o.inspect(this.active,!0));return}return b&&O("    GETTING KEY:"+V+"="+this.active[V]+" "+this.name+" uid:"+w+" active:"+o.inspect(this.active,!0)),this.active[V]},y.prototype.createContext=function(){b&&O("   CREATING Context: "+this.name+" uid:"+w+" len:"+this._set.length+"  active:"+o.inspect(this.active,!0,2,!0));let V=Object.create(this.active?this.active:Object.prototype);return V._ns_name=this.name,V.id=w,b&&O("   CREATED Context: "+this.name+" uid:"+w+" len:"+this._set.length+"  context:"+o.inspect(V,!0,2,!0)),V},y.prototype.run=function(V){let ie=this.createContext();this.enter(ie);try{return b&&O(" BEFORE RUN: "+this.name+" uid:"+w+" len:"+this._set.length+" "+o.inspect(ie)),V(ie),ie}catch(pe){throw pe&&(pe[p]=ie),pe}finally{b&&O(" AFTER RUN: "+this.name+" uid:"+w+" len:"+this._set.length+" "+o.inspect(ie)),this.exit(ie)}},y.prototype.runAndReturn=function(V){var ie;return this.run(function(pe){ie=V(pe)}),ie},y.prototype.runPromise=function(V){let ie=this.createContext();this.enter(ie);let pe=V(ie);if(!pe||!pe.then||!pe.catch)throw new Error("fn must return a promise.");return b&&O(" BEFORE runPromise: "+this.name+" uid:"+w+" len:"+this._set.length+" "+o.inspect(ie)),pe.then(me=>(b&&O(" AFTER runPromise: "+this.name+" uid:"+w+" len:"+this._set.length+" "+o.inspect(ie)),this.exit(ie),me)).catch(me=>{throw me[p]=ie,b&&O(" AFTER runPromise: "+this.name+" uid:"+w+" len:"+this._set.length+" "+o.inspect(ie)),this.exit(ie),me})},y.prototype.bind=function(V,ie){ie||(this.active?ie=this.active:ie=this.createContext());let pe=this;return function(){pe.enter(ie);try{return V.apply(this,arguments)}catch(me){throw me&&(me[p]=ie),me}finally{pe.exit(ie)}}},y.prototype.enter=function(V){c.ok(V,"context must be provided for entering"),b&&O("  ENTER "+this.name+" uid:"+w+" len:"+this._set.length+" context: "+o.inspect(V)),this._set.push(this.active),this.active=V},y.prototype.exit=function(V){if(c.ok(V,"context must be provided for exiting"),b&&O("  EXIT "+this.name+" uid:"+w+" len:"+this._set.length+" context: "+o.inspect(V)),this.active===V){c.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let ie=this._set.lastIndexOf(V);ie<0?(b&&O("??ERROR?? context exiting but not entered - ignoring: "+o.inspect(V)),c.ok(ie>=0,`context not currently entered; can't exit. 
`+o.inspect(this)+`
`+o.inspect(V))):(c.ok(ie,"can't remove top context"),this._set.splice(ie,1))},y.prototype.bindEmitter=function(V){c.ok(V.on&&V.addListener&&V.emit,"can only bind real EEs");let ie=this,pe="context@"+this.name;function me(He){!He||(He[h]||(He[h]=Object.create(null)),He[h][pe]={namespace:ie,context:ie.active})}function Se(He){if(!(He&&He[h]))return He;let ze=He,ot=He[h];return Object.keys(ot).forEach(function(mt){let Nt=ot[mt];ze=Nt.namespace.bind(ze,Nt.context)}),ze}f(V,me,Se)},y.prototype.fromException=function(V){return V[p]};function S(V){return process.namespaces[V]}function C(V){c.ok(V,"namespace must be given a name."),b&&O("CREATING NAMESPACE "+V);let ie=new y(V);return ie.id=w,u.addHooks({init(pe,me,Se,He,ze){w=pe,He?(ie._contexts.set(pe,ie._contexts.get(He)),b&&O("PARENTID: "+V+" uid:"+pe+" parent:"+He+" provider:"+Se)):ie._contexts.set(w,ie.active),b&&O("INIT "+V+" uid:"+pe+" parent:"+He+" provider:"+g[Se]+" active:"+o.inspect(ie.active,!0))},pre(pe,me){w=pe;let Se=ie._contexts.get(pe);Se?(b&&O(" PRE "+V+" uid:"+pe+" handle:"+D(me)+" context:"+o.inspect(Se)),ie.enter(Se)):b&&O(" PRE MISSING CONTEXT "+V+" uid:"+pe+" handle:"+D(me))},post(pe,me){w=pe;let Se=ie._contexts.get(pe);Se?(b&&O(" POST "+V+" uid:"+pe+" handle:"+D(me)+" context:"+o.inspect(Se)),ie.exit(Se)):b&&O(" POST MISSING CONTEXT "+V+" uid:"+pe+" handle:"+D(me))},destroy(pe){w=pe,b&&O("DESTROY "+V+" uid:"+pe+" context:"+o.inspect(ie._contexts.get(w))+" active:"+o.inspect(ie.active,!0)),ie._contexts.delete(pe)}}),process.namespaces[V]=ie,ie}function T(V){let ie=S(V);c.ok(ie,`can't delete nonexistent namespace! "`+V+'"'),c.ok(ie.id,"don't assign to process.namespaces directly! "+o.inspect(ie)),process.namespaces[V]=null}function A(){process.namespaces&&Object.keys(process.namespaces).forEach(function(V){T(V)}),process.namespaces=Object.create(null)}process.namespaces={},u._state&&!u._state.enabled&&u.enable();function O(V){process.env.DEBUG&&process._rawDebug(V)}function D(V){if(!V)return V;if(typeof V=="function")return V.name?V.name:(V.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1];if(V.constructor&&V.constructor.name)return V.constructor.name}if(b){q=hc();for(Q in q.filter._modifiers)q.filter.deattach(Q)}var q,Q}),Fl=k((s,x)=>{"use strict";var o=_e();process&&o.gte(process.versions.node,"8.0.0")?x.exports=os():x.exports=Ll()}),$l=k((s,x)=>{var o=Pi().wrap,c=1<<0,f=1<<1,u=1<<2,h=1<<3,p=[],g=0,b=!1,w=[],y,S;function C(me,Se){var He=me.length,ze=Se.length,ot=[];if(He===0&&ze===0)return ot;for(var mt=0;mt<He;mt++)ot[mt]=me[mt];if(ze===0)return ot;for(var Nt=0;Nt<ze;Nt++){var Pt=!0;for(mt=0;mt<He;mt++)if(me[mt].uid===Se[Nt].uid){Pt=!1;break}Pt&&ot.push(Se[Nt])}return ot}process._fatalException?(T=!1,y=function(me){var Se=p.length;if(T||Se===0)return!1;var He=!1;T=!0;for(var ze=0;ze<Se;++ze){var ot=p[ze];if((ot.flags&h)!=0){var mt=A&&A[ot.uid];He=ot.error(mt,me)||He}}return T=!1,w.length>0&&(p=w.pop()),A=void 0,He&&!b},S=function(me,Se,He){var ze=[];b=!0;for(var ot=0;ot<He;++ot){var mt=Se[ot];if(ze[mt.uid]=mt.data,(mt.flags&c)!=0){var Nt=mt.create(mt.data);Nt!==void 0&&(ze[mt.uid]=Nt)}}return b=!1,function(){A=ze,w.push(p),p=C(Se,p),b=!0;for(var Pt=0;Pt<He;++Pt)(Se[Pt].flags&f)>0&&Se[Pt].before(this,ze[Se[Pt].uid]);b=!1;var Zt=me.apply(this,arguments);for(b=!0,Pt=0;Pt<He;++Pt)(Se[Pt].flags&u)>0&&Se[Pt].after(this,ze[Se[Pt].uid]);return b=!1,p=w.pop(),A=void 0,Zt}},o(process,"_fatalException",function(me){return function(Se){return y(Se)||me(Se)}})):(O=!1,y=function(me){if(O)throw me;for(var Se=!1,He=p.length,ze=0;ze<He;++ze){var ot=p[ze];(ot.flags&h)!=0&&(Se=ot.error(null,me)||Se)}if(!Se&&b)throw me},S=function(me,Se,He){var ze=[];b=!0;for(var ot=0;ot<He;++ot){var mt=Se[ot];if(ze[mt.uid]=mt.data,(mt.flags&c)!=0){var Nt=mt.create(mt.data);Nt!==void 0&&(ze[mt.uid]=Nt)}}return b=!1,function(){var Pt=!1,Zt=!1;w.push(p),p=C(Se,p),b=!0;for(var $t=0;$t<He;++$t)(Se[$t].flags&f)>0&&Se[$t].before(this,ze[Se[$t].uid]);b=!1;var Xe;try{Xe=me.apply(this,arguments)}catch(at){Pt=!0;for(var $t=0;$t<He;++$t)if((p[$t].flags&h)!=0)try{Zt=p[$t].error(ze[Se[$t].uid],at)||Zt}catch(ht){throw O=!0,ht}if(!Zt)throw process.removeListener("uncaughtException",y),process._originalNextTick(function(){process.addListener("uncaughtException",y)}),at}finally{if(!Pt||Zt){for(b=!0,$t=0;$t<He;++$t)(Se[$t].flags&u)>0&&Se[$t].after(this,ze[Se[$t].uid]);b=!1}p=w.pop()}return Xe}},process.addListener("uncaughtException",y));var T,A,O;function D(me,Se,He){b=!0;for(var ze=0;ze<He;++ze){var ot=Se[ze];ot.create&&ot.create(ot.data)}return b=!1,function(){w.push(p),p=C(Se,p);var mt=me.apply(this,arguments);return p=w.pop(),mt}}function q(me){var Se=p.length;if(Se===0)return me;for(var He=p.slice(),ze=0;ze<Se;++ze)if(He[ze].flags>0)return S(me,He,Se);return D(me,He,Se)}function Q(me,Se){typeof me.create=="function"&&(this.create=me.create,this.flags|=c),typeof me.before=="function"&&(this.before=me.before,this.flags|=f),typeof me.after=="function"&&(this.after=me.after,this.flags|=u),typeof me.error=="function"&&(this.error=me.error,this.flags|=h),this.uid=++g,this.data=Se===void 0?null:Se}Q.prototype.create=void 0,Q.prototype.before=void 0,Q.prototype.after=void 0,Q.prototype.error=void 0,Q.prototype.data=void 0,Q.prototype.uid=0,Q.prototype.flags=0;function V(me,Se){if(typeof me!="object"||!me)throw new TypeError("callbacks argument must be an object");return me instanceof Q?me:new Q(me,Se)}function ie(me,Se){var He;me instanceof Q?He=me:He=V(me,Se);for(var ze=!1,ot=0;ot<p.length;ot++)if(He===p[ot]){ze=!0;break}return ze||p.push(He),He}function pe(me){for(var Se=0;Se<p.length;Se++)if(me===p[Se]){p.splice(Se,1);break}}process.createAsyncListener=V,process.addAsyncListener=ie,process.removeAsyncListener=pe,x.exports=q}),Bl=k((s,x)=>{"use strict";x.exports=(o,c)=>class extends o{constructor(f){var u,h;super(g);var p=this;try{f.apply(u,h)}catch(b){h[1](b)}return p;function g(b,w){u=this,h=[y,S];function y(C){return c(p,!1),b(C)}function S(C){return c(p,!1),w(C)}}}}}),Hl=k(()=>{"use strict";if(process.addAsyncListener)throw new Error("Don't require polyfill unless needed");var s=Pi(),x=_e(),o=s.wrap,c=s.massWrap,f=$l(),u=H(3837),h=x.gte(process.version,"6.0.0"),p=x.gte(process.version,"7.0.0"),g=x.gte(process.version,"8.0.0"),b=x.gte(process.version,"11.0.0"),w=H(1808);p&&!w._normalizeArgs?w._normalizeArgs=function(Xe){if(Xe.length===0)return[{},null];var at=Xe[0],Ne={};typeof at=="object"&&at!==null?Ne=at:$t(at)?Ne.path=at:(Ne.port=at,Xe.length>1&&typeof Xe[1]=="string"&&(Ne.host=Xe[1]));var ht=Xe[Xe.length-1];return typeof ht!="function"?[Ne,null]:[Ne,ht]}:!p&&!w._normalizeConnectArgs&&(w._normalizeConnectArgs=function(Xe){var at={};function Ne(dt){return(dt=Number(dt))>=0?dt:!1}typeof Xe[0]=="object"&&Xe[0]!==null?at=Xe[0]:typeof Xe[0]=="string"&&Ne(Xe[0])===!1?at.path=Xe[0]:(at.port=Xe[0],typeof Xe[1]=="string"&&(at.host=Xe[1]));var ht=Xe[Xe.length-1];return typeof ht=="function"?[at,ht]:[at]}),"_setUpListenHandle"in w.Server.prototype?o(w.Server.prototype,"_setUpListenHandle",y):o(w.Server.prototype,"_listen2",y);function y(Xe){return function(){this.on("connection",function(at){at._handle&&(at._handle.onread=f(at._handle.onread))});try{return Xe.apply(this,arguments)}finally{this._handle&&this._handle.onconnection&&(this._handle.onconnection=f(this._handle.onconnection))}}}function S(Xe){if(Xe&&Xe._handle){var at=Xe._handle;at._originalOnread||(at._originalOnread=at.onread),at.onread=f(at._originalOnread)}}o(w.Socket.prototype,"connect",function(Xe){return function(){var at;g&&Array.isArray(arguments[0])&&Object.getOwnPropertySymbols(arguments[0]).length>0?at=arguments[0]:at=p?w._normalizeArgs(arguments):w._normalizeConnectArgs(arguments),at[1]&&(at[1]=f(at[1]));var Ne=Xe.apply(this,at);return S(this),Ne}});var C=H(3685);o(C.Agent.prototype,"addRequest",function(Xe){return function(at){var Ne=at.onSocket;return at.onSocket=f(function(ht){return S(ht),Ne.apply(this,arguments)}),Xe.apply(this,arguments)}});var T=H(2081);function A(Xe){Array.isArray(Xe.stdio)&&Xe.stdio.forEach(function(at){at&&at._handle&&(at._handle.onread=f(at._handle.onread),o(at._handle,"close",Pt))}),Xe._handle&&(Xe._handle.onexit=f(Xe._handle.onexit))}T.ChildProcess?o(T.ChildProcess.prototype,"spawn",function(Xe){return function(){var at=Xe.apply(this,arguments);return A(this),at}}):c(T,["execFile","fork","spawn"],function(Xe){return function(){var at=Xe.apply(this,arguments);return A(at),at}}),process._fatalException||(process._originalNextTick=process.nextTick);var O=[];process._nextDomainTick&&O.push("_nextDomainTick"),process._tickDomainCallback&&O.push("_tickDomainCallback"),c(process,O,Nt),o(process,"nextTick",Pt);var D=["setTimeout","setInterval"];global.setImmediate&&D.push("setImmediate");var q=H(9512),Q=global.setTimeout===q.setTimeout;c(q,D,Pt),Q&&c(global,D,Pt);var V=H(9523);c(V,["lookup","resolve","resolve4","resolve6","resolveCname","resolveMx","resolveNs","resolveTxt","resolveSrv","reverse"],Nt),V.resolveNaptr&&o(V,"resolveNaptr",Nt);var ie=H(7147);c(ie,["watch","rename","truncate","chown","fchown","chmod","fchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","watchFile","unwatchFile","exists"],Nt),ie.lchown&&o(ie,"lchown",Nt),ie.lchmod&&o(ie,"lchmod",Nt),ie.ftruncate&&o(ie,"ftruncate",Nt);var pe;try{pe=H(9796)}catch(Xe){}pe&&pe.Deflate&&pe.Deflate.prototype&&(me=Object.getPrototypeOf(pe.Deflate.prototype),me._transform?o(me,"_transform",Nt):me.write&&me.flush&&me.end&&c(me,["write","flush","end"],Nt));var me,Se;try{Se=H(6113)}catch(Xe){}Se&&(He=["pbkdf2","randomBytes"],b||He.push("pseudoRandomBytes"),c(Se,He,Nt));var He,ze=!!global.Promise&&Promise.toString()==="function Promise() { [native code] }"&&Promise.toString.toString()==="function toString() { [native code] }";ze&&(ot=process.addAsyncListener({create:function(){ze=!1}}),global.Promise.resolve(!0).then(function(){ze=!1}),process.removeAsyncListener(ot));var ot;ze&&mt();function mt(){var Xe=global.Promise;function at(wt){if(!(this instanceof at))return Xe(wt);if(typeof wt!="function")return new Xe(wt);var er,hr,he=new Xe(mr);he.__proto__=at.prototype;try{wt.apply(er,hr)}catch(Oe){hr[1](Oe)}return he;function mr(Oe,fr){er=this,hr=[Hr,bt];function Hr(xt){return ht(he,!1),Oe(xt)}function bt(xt){return ht(he,!1),fr(xt)}}}if(u.inherits(at,Xe),o(Xe.prototype,"then",jt),Xe.prototype.chain&&o(Xe.prototype,"chain",jt),h)global.Promise=Bl()(Xe,ht);else{var Ne=["all","race","reject","resolve","accept","defer"];Ne.forEach(function(wt){typeof Xe[wt]=="function"&&(at[wt]=Xe[wt])}),global.Promise=at}function ht(wt,er){(!wt.__asl_wrapper||er)&&(wt.__asl_wrapper=f(dt))}function dt(wt,er,hr,he){var mr;try{return mr=er.call(wt,hr),{returnVal:mr,error:!1}}catch(Oe){return{errorVal:Oe,error:!0}}finally{mr instanceof Xe?he.__asl_wrapper=function(){var Oe=mr.__asl_wrapper||dt;return Oe.apply(this,arguments)}:ht(he,!0)}}function jt(wt){return function(){var er=this,hr=wt.apply(er,Array.prototype.map.call(arguments,he));return hr.__asl_wrapper=function(mr,Oe,fr,Hr){return er.__asl_wrapper?(er.__asl_wrapper(mr,function(){},null,hr),hr.__asl_wrapper(mr,Oe,fr,Hr)):dt(mr,Oe,fr,Hr)},hr;function he(mr){return typeof mr!="function"?mr:f(function(Oe){var fr=(er.__asl_wrapper||dt)(this,mr,Oe,hr);if(fr.error)throw fr.errorVal;return fr.returnVal})}}}}function Nt(Xe){var at=function(){var Ne,ht=arguments.length-1;if(typeof arguments[ht]=="function"){Ne=Array(arguments.length);for(var dt=0;dt<arguments.length-1;dt++)Ne[dt]=arguments[dt];Ne[ht]=f(arguments[ht])}return Xe.apply(this,Ne||arguments)};switch(Xe.length){case 1:return function(Ne){return arguments.length!==1?at.apply(this,arguments):(typeof Ne=="function"&&(Ne=f(Ne)),Xe.call(this,Ne))};case 2:return function(Ne,ht){return arguments.length!==2?at.apply(this,arguments):(typeof ht=="function"&&(ht=f(ht)),Xe.call(this,Ne,ht))};case 3:return function(Ne,ht,dt){return arguments.length!==3?at.apply(this,arguments):(typeof dt=="function"&&(dt=f(dt)),Xe.call(this,Ne,ht,dt))};case 4:return function(Ne,ht,dt,jt){return arguments.length!==4?at.apply(this,arguments):(typeof jt=="function"&&(jt=f(jt)),Xe.call(this,Ne,ht,dt,jt))};case 5:return function(Ne,ht,dt,jt,wt){return arguments.length!==5?at.apply(this,arguments):(typeof wt=="function"&&(wt=f(wt)),Xe.call(this,Ne,ht,dt,jt,wt))};case 6:return function(Ne,ht,dt,jt,wt,er){return arguments.length!==6?at.apply(this,arguments):(typeof er=="function"&&(er=f(er)),Xe.call(this,Ne,ht,dt,jt,wt,er))};default:return at}}function Pt(Xe){var at=function(){var Ne;if(typeof arguments[0]=="function"){Ne=Array(arguments.length),Ne[0]=f(arguments[0]);for(var ht=1;ht<arguments.length;ht++)Ne[ht]=arguments[ht]}return Xe.apply(this,Ne||arguments)};switch(Xe.length){case 1:return function(Ne){return arguments.length!==1?at.apply(this,arguments):(typeof Ne=="function"&&(Ne=f(Ne)),Xe.call(this,Ne))};case 2:return function(Ne,ht){return arguments.length!==2?at.apply(this,arguments):(typeof Ne=="function"&&(Ne=f(Ne)),Xe.call(this,Ne,ht))};case 3:return function(Ne,ht,dt){return arguments.length!==3?at.apply(this,arguments):(typeof Ne=="function"&&(Ne=f(Ne)),Xe.call(this,Ne,ht,dt))};case 4:return function(Ne,ht,dt,jt){return arguments.length!==4?at.apply(this,arguments):(typeof Ne=="function"&&(Ne=f(Ne)),Xe.call(this,Ne,ht,dt,jt))};case 5:return function(Ne,ht,dt,jt,wt){return arguments.length!==5?at.apply(this,arguments):(typeof Ne=="function"&&(Ne=f(Ne)),Xe.call(this,Ne,ht,dt,jt,wt))};case 6:return function(Ne,ht,dt,jt,wt,er){return arguments.length!==6?at.apply(this,arguments):(typeof Ne=="function"&&(Ne=f(Ne)),Xe.call(this,Ne,ht,dt,jt,wt,er))};default:return at}}function Zt(Xe){return(Xe=Number(Xe))>=0?Xe:!1}function $t(Xe){return typeof Xe=="string"&&Zt(Xe)===!1}}),Ul=k((s,x)=>{"use strict";var o=H(9491),c=ai(),f="cls@contexts",u="error@context";process.addAsyncListener||Hl();function h(y){this.name=y,this.active=null,this._set=[],this.id=null}h.prototype.set=function(y,S){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return this.active[y]=S,S},h.prototype.get=function(y){if(this.active)return this.active[y]},h.prototype.createContext=function(){return Object.create(this.active)},h.prototype.run=function(y){var S=this.createContext();this.enter(S);try{return y(S),S}catch(C){throw C&&(C[u]=S),C}finally{this.exit(S)}},h.prototype.runAndReturn=function(y){var S;return this.run(function(C){S=y(C)}),S},h.prototype.bind=function(y,S){S||(this.active?S=this.active:S=this.createContext());var C=this;return function(){C.enter(S);try{return y.apply(this,arguments)}catch(T){throw T&&(T[u]=S),T}finally{C.exit(S)}}},h.prototype.enter=function(y){o.ok(y,"context must be provided for entering"),this._set.push(this.active),this.active=y},h.prototype.exit=function(y){if(o.ok(y,"context must be provided for exiting"),this.active===y){o.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}var S=this._set.lastIndexOf(y);o.ok(S>=0,"context not currently entered; can't exit"),o.ok(S,"can't remove top context"),this._set.splice(S,1)},h.prototype.bindEmitter=function(y){o.ok(y.on&&y.addListener&&y.emit,"can only bind real EEs");var S=this,C="context@"+this.name;function T(O){!O||(O[f]||(O[f]=Object.create(null)),O[f][C]={namespace:S,context:S.active})}function A(O){if(!(O&&O[f]))return O;var D=O,q=O[f];return Object.keys(q).forEach(function(Q){var V=q[Q];D=V.namespace.bind(D,V.context)}),D}c(y,T,A)},h.prototype.fromException=function(y){return y[u]};function p(y){return process.namespaces[y]}function g(y){o.ok(y,"namespace must be given a name!");var S=new h(y);return S.id=process.addAsyncListener({create:function(){return S.active},before:function(C,T){T&&S.enter(T)},after:function(C,T){T&&S.exit(T)},error:function(C){C&&S.exit(C)}}),process.namespaces[y]=S,S}function b(y){var S=p(y);o.ok(S,"can't delete nonexistent namespace!"),o.ok(S.id,"don't assign to process.namespaces directly!"),process.removeAsyncListener(S.id),process.namespaces[y]=null}function w(){process.namespaces&&Object.keys(process.namespaces).forEach(function(y){b(y)}),process.namespaces=Object.create(null)}process.namespaces||w(),x.exports={getNamespace:p,createNamespace:g,destroyNamespace:b,reset:w}}),Di=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CorrelationContextManager=void 0;var x=rt(),o=Va(),c=gn(),f=tc(),u=oi(),h=function(){function g(){}return g.getCurrentContext=function(){if(!g.enabled)return null;var b=g.session.get(g.CONTEXT_NAME);return b===void 0?null:b},g.generateContextObject=function(b,w,y,S,C,T){return w=w||b,this.enabled?{operation:{name:y,id:b,parentId:w,traceparent:C,tracestate:T},customProperties:new p(S)}:null},g.spanToContextObject=function(b,w,y){var S=new c;return S.traceId=b.traceId,S.spanId=b.spanId,S.traceFlag=c.formatOpenTelemetryTraceFlags(b.traceFlags)||c.DEFAULT_TRACE_FLAG,S.parentId=w,g.generateContextObject(S.traceId,S.parentId,y,null,S)},g.runWithContext=function(b,w){var y;return g.enabled?g.session.bind(w,(y={},y[g.CONTEXT_NAME]=b,y))():w()},g.wrapEmitter=function(b){g.enabled&&g.session.bindEmitter(b)},g.wrapCallback=function(b,w){var y;return g.enabled?g.session.bind(b,w?(y={},y[g.CONTEXT_NAME]=w,y):void 0):b},g.enable=function(b){if(!this.enabled){if(!this.isNodeVersionCompatible()){this.enabled=!1;return}g.hasEverEnabled||(this.forceClsHooked=b,this.hasEverEnabled=!0,typeof this.cls=="undefined"&&(g.forceClsHooked===!0||g.forceClsHooked===void 0&&g.shouldUseClsHooked()?this.cls=Fl():this.cls=Ul()),g.session=this.cls.createNamespace("AI-CLS-Session"),o.registerContextPreservation(function(w){return g.session.bind(w)})),this.enabled=!0}},g.startOperation=function(b,w){var y=b&&b.traceContext||null,S=b&&b.traceId?b:null,C=b&&b.headers;if(S){var T=new c("00-"+S.traceId+"-"+S.spanId+"-01"),A=new f(S.traceState?S.traceState.serialize():null),O=g.generateContextObject(S.traceId,"|"+S.traceId+"."+S.spanId+".",typeof w=="string"?w:"",void 0,T,A);return O}if(y){var T=new c(y.traceparent),A=new f(y.tracestate),D=typeof w=="object"?new u(w):null,O=g.generateContextObject(T.traceId,T.parentId,typeof w=="string"?w:D.getOperationName({}),D&&D.getCorrelationContextHeader()||void 0,T,A);return O}if(C){var T=new c(C.traceparent?C.traceparent.toString():null),A=new f(C.tracestate?C.tracestate.toString():null),D=new u(b),O=g.generateContextObject(T.traceId,T.parentId,D.getOperationName({}),D.getCorrelationContextHeader(),T,A);return O}return x.warn("startOperation was called with invalid arguments",arguments),null},g.disable=function(){this.enabled=!1},g.reset=function(){g.hasEverEnabled&&(g.session=null,g.session=this.cls.createNamespace("AI-CLS-Session"))},g.isNodeVersionCompatible=function(){var b=process.versions.node.split(".");return parseInt(b[0])>3||parseInt(b[0])>2&&parseInt(b[1])>2},g.shouldUseClsHooked=function(){var b=process.versions.node.split(".");return parseInt(b[0])>8||parseInt(b[0])>=8&&parseInt(b[1])>=2},g.canUseClsHooked=function(){var b=process.versions.node.split("."),w=parseInt(b[0])>8||parseInt(b[0])>=8&&parseInt(b[1])>=0,y=parseInt(b[0])<8||parseInt(b[0])<=8&&parseInt(b[1])<2,S=parseInt(b[0])>4||parseInt(b[0])>=4&&parseInt(b[1])>=7;return!(w&&y)&&S},g.enabled=!1,g.hasEverEnabled=!1,g.forceClsHooked=void 0,g.CONTEXT_NAME="ApplicationInsights-Context",g}();s.CorrelationContextManager=h;var p=function(){function g(b){this.props=[],this.addHeaderData(b)}return g.prototype.addHeaderData=function(b){var w=b?b.split(", "):[];this.props=w.map(function(y){var S=y.split("=");return{key:S[0],value:S[1]}}).concat(this.props)},g.prototype.serializeToHeader=function(){return this.props.map(function(b){return b.key+"="+b.value}).join(", ")},g.prototype.getProperty=function(b){for(var w=0;w<this.props.length;++w){var y=this.props[w];if(y.key===b)return y.value}},g.prototype.setProperty=function(b,w){if(g.bannedCharacters.test(b)||g.bannedCharacters.test(w)){x.warn("Correlation context property keys and values must not contain ',' or '='. setProperty was called with key: "+b+" and value: "+w);return}for(var y=0;y<this.props.length;++y){var S=this.props[y];if(S.key===b){S.value=w;return}}this.props.push({key:b,value:w})},g.bannedCharacters=/[,=]/,g}()}),jl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.dispose=s.enable=void 0;var x=Fr(),o=ue(),c=[],f=function(p){var g=p.data.message;c.forEach(function(b){g instanceof Error?b.trackException({exception:g}):(g.lastIndexOf(`
`)==g.length-1&&(g=g.substring(0,g.length-1)),b.trackTrace({message:g,severity:p.data.stderr?x.SeverityLevel.Warning:x.SeverityLevel.Information}))})};function u(p,g){p?(c.length===0&&o.channel.subscribe("console",f),c.push(g)):(c=c.filter(function(b){return b!=g}),c.length===0&&o.channel.unsubscribe("console",f))}s.enable=u;function h(){o.channel.unsubscribe("console",f),c=[]}s.dispose=h}),ql=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.dispose=s.enable=void 0;var x=Fr(),o=ue(),c=[],f={10:x.SeverityLevel.Verbose,20:x.SeverityLevel.Verbose,30:x.SeverityLevel.Information,40:x.SeverityLevel.Warning,50:x.SeverityLevel.Error,60:x.SeverityLevel.Critical},u=function(g){var b=g.data.result;c.forEach(function(w){var y=f[g.data.level];b instanceof Error?w.trackException({exception:b}):w.trackTrace({message:b,severity:y})})};function h(g,b){g?(c.length===0&&o.channel.subscribe("bunyan",u),c.push(b)):(c=c.filter(function(w){return w!=b}),c.length===0&&o.channel.unsubscribe("bunyan",u))}s.enable=h;function p(){o.channel.unsubscribe("bunyan",u),c=[]}s.dispose=p}),zl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.dispose=s.enable=void 0;var x=Fr(),o=ue(),c=[],f={syslog:function(g){var b={emerg:x.SeverityLevel.Critical,alert:x.SeverityLevel.Critical,crit:x.SeverityLevel.Critical,error:x.SeverityLevel.Error,warning:x.SeverityLevel.Warning,notice:x.SeverityLevel.Information,info:x.SeverityLevel.Information,debug:x.SeverityLevel.Verbose};return b[g]===void 0?x.SeverityLevel.Information:b[g]},npm:function(g){var b={error:x.SeverityLevel.Error,warn:x.SeverityLevel.Warning,info:x.SeverityLevel.Information,verbose:x.SeverityLevel.Verbose,debug:x.SeverityLevel.Verbose,silly:x.SeverityLevel.Verbose};return b[g]===void 0?x.SeverityLevel.Information:b[g]},unknown:function(g){return x.SeverityLevel.Information}},u=function(g){var b=g.data.message;c.forEach(function(w){if(b instanceof Error)w.trackException({exception:b,properties:g.data.meta});else{var y=f[g.data.levelKind](g.data.level);w.trackTrace({message:b,severity:y,properties:g.data.meta})}})};function h(g,b){g?(c.length===0&&o.channel.subscribe("winston",u),c.push(b)):(c=c.filter(function(w){return w!=b}),c.length===0&&o.channel.unsubscribe("winston",u))}s.enable=h;function p(){o.channel.unsubscribe("winston",u),c=[]}s.dispose=p}),Wl=k((s,x)=>{"use strict";var o=Va(),c=function(){function f(u){if(f.INSTANCE)throw new Error("Console logging adapter tracking should be configured from the applicationInsights object");this._client=u,f.INSTANCE=this}return f.prototype.enable=function(u,h){o.IsInitialized&&(jl().enable(u&&h,this._client),ql().enable(u,this._client),zl().enable(u,this._client))},f.prototype.isInitialized=function(){return this._isInitialized},f.prototype.dispose=function(){f.INSTANCE=null,this.enable(!1,!1)},f._methodNames=["debug","info","log","warn","error"],f}();x.exports=c}),fc=k((s,x)=>{"use strict";var o=function(){function c(f){if(c.INSTANCE)throw new Error("Exception tracking should be configured from the applicationInsights object");c.INSTANCE=this,this._client=f;var u=process.versions.node.split(".");c._canUseUncaughtExceptionMonitor=parseInt(u[0])>13||parseInt(u[0])===13&&parseInt(u[1])>=7}return c.prototype.isInitialized=function(){return this._isInitialized},c.prototype.enable=function(f){var u=this;if(f){this._isInitialized=!0;var h=this;if(!this._exceptionListenerHandle){var p=function(g,b,w){w===void 0&&(w=new Error(c._FALLBACK_ERROR_MESSAGE)),u._client.trackException({exception:w}),u._client.flush({isAppCrashing:!0}),g&&b&&process.listeners(b).length===1&&(console.error(w),process.exit(1))};c._canUseUncaughtExceptionMonitor?(this._exceptionListenerHandle=p.bind(this,!1,void 0),process.on(c.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle)):(this._exceptionListenerHandle=p.bind(this,!0,c.UNCAUGHT_EXCEPTION_HANDLER_NAME),this._rejectionListenerHandle=p.bind(this,!1,void 0),process.on(c.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.on(c.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle))}}else this._exceptionListenerHandle&&(c._canUseUncaughtExceptionMonitor?process.removeListener(c.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle):(process.removeListener(c.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.removeListener(c.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle)),this._exceptionListenerHandle=void 0,this._rejectionListenerHandle=void 0,delete this._exceptionListenerHandle,delete this._rejectionListenerHandle)},c.prototype.dispose=function(){c.INSTANCE=null,this.enable(!1),this._isInitialized=!1},c.INSTANCE=null,c.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME="uncaughtExceptionMonitor",c.UNCAUGHT_EXCEPTION_HANDLER_NAME="uncaughtException",c.UNHANDLED_REJECTION_HANDLER_NAME="unhandledRejection",c._RETHROW_EXIT_MESSAGE="Application Insights Rethrow Exception Handler",c._FALLBACK_ERROR_MESSAGE="A promise was rejected without providing an error. Application Insights generated this error stack for you.",c._canUseUncaughtExceptionMonitor=!1,c}();x.exports=o}),Fn=k(s=>{"use strict";var x;Object.defineProperty(s,"__esModule",{value:!0}),s.HeartBeatMetricName=s.DependencyTypeName=s.SpanAttribute=s.TelemetryTypeStringToQuickPulseDocumentType=s.TelemetryTypeStringToQuickPulseType=s.QuickPulseType=s.QuickPulseDocumentType=s.PerformanceToQuickPulseCounter=s.MetricId=s.PerformanceCounter=s.QuickPulseCounter=s.DEFAULT_LIVEMETRICS_HOST=s.DEFAULT_LIVEMETRICS_ENDPOINT=s.DEFAULT_BREEZE_ENDPOINT=void 0,s.DEFAULT_BREEZE_ENDPOINT="https://dc.services.visualstudio.com",s.DEFAULT_LIVEMETRICS_ENDPOINT="https://rt.services.visualstudio.com",s.DEFAULT_LIVEMETRICS_HOST="rt.services.visualstudio.com";var o;(function(u){u.COMMITTED_BYTES="\\Memory\\Committed Bytes",u.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",u.REQUEST_RATE="\\ApplicationInsights\\Requests/Sec",u.REQUEST_FAILURE_RATE="\\ApplicationInsights\\Requests Failed/Sec",u.REQUEST_DURATION="\\ApplicationInsights\\Request Duration",u.DEPENDENCY_RATE="\\ApplicationInsights\\Dependency Calls/Sec",u.DEPENDENCY_FAILURE_RATE="\\ApplicationInsights\\Dependency Calls Failed/Sec",u.DEPENDENCY_DURATION="\\ApplicationInsights\\Dependency Call Duration",u.EXCEPTION_RATE="\\ApplicationInsights\\Exceptions/Sec"})(o=s.QuickPulseCounter||(s.QuickPulseCounter={}));var c;(function(u){u.PRIVATE_BYTES="\\Process(??APP_WIN32_PROC??)\\Private Bytes",u.AVAILABLE_BYTES="\\Memory\\Available Bytes",u.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",u.PROCESS_TIME="\\Process(??APP_WIN32_PROC??)\\% Processor Time",u.REQUEST_RATE="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Requests/Sec",u.REQUEST_DURATION="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Request Execution Time"})(c=s.PerformanceCounter||(s.PerformanceCounter={}));var f;(function(u){u.REQUESTS_DURATION="requests/duration",u.DEPENDENCIES_DURATION="dependencies/duration",u.EXCEPTIONS_COUNT="exceptions/count",u.TRACES_COUNT="traces/count"})(f=s.MetricId||(s.MetricId={})),s.PerformanceToQuickPulseCounter=(x={},x[c.PROCESSOR_TIME]=o.PROCESSOR_TIME,x[c.REQUEST_RATE]=o.REQUEST_RATE,x[c.REQUEST_DURATION]=o.REQUEST_DURATION,x[o.COMMITTED_BYTES]=o.COMMITTED_BYTES,x[o.REQUEST_FAILURE_RATE]=o.REQUEST_FAILURE_RATE,x[o.DEPENDENCY_RATE]=o.DEPENDENCY_RATE,x[o.DEPENDENCY_FAILURE_RATE]=o.DEPENDENCY_FAILURE_RATE,x[o.DEPENDENCY_DURATION]=o.DEPENDENCY_DURATION,x[o.EXCEPTION_RATE]=o.EXCEPTION_RATE,x),s.QuickPulseDocumentType={Event:"Event",Exception:"Exception",Trace:"Trace",Metric:"Metric",Request:"Request",Dependency:"RemoteDependency",Availability:"Availability",PageView:"PageView"},s.QuickPulseType={Event:"EventTelemetryDocument",Exception:"ExceptionTelemetryDocument",Trace:"TraceTelemetryDocument",Metric:"MetricTelemetryDocument",Request:"RequestTelemetryDocument",Dependency:"DependencyTelemetryDocument",Availability:"AvailabilityTelemetryDocument",PageView:"PageViewTelemetryDocument"},s.TelemetryTypeStringToQuickPulseType={EventData:s.QuickPulseType.Event,ExceptionData:s.QuickPulseType.Exception,MessageData:s.QuickPulseType.Trace,MetricData:s.QuickPulseType.Metric,RequestData:s.QuickPulseType.Request,RemoteDependencyData:s.QuickPulseType.Dependency,AvailabilityData:s.QuickPulseType.Availability,PageViewData:s.QuickPulseType.PageView},s.TelemetryTypeStringToQuickPulseDocumentType={EventData:s.QuickPulseDocumentType.Event,ExceptionData:s.QuickPulseDocumentType.Exception,MessageData:s.QuickPulseDocumentType.Trace,MetricData:s.QuickPulseDocumentType.Metric,RequestData:s.QuickPulseDocumentType.Request,RemoteDependencyData:s.QuickPulseDocumentType.Dependency,AvailabilityData:s.QuickPulseDocumentType.Availability,PageViewData:s.QuickPulseDocumentType.PageView},s.SpanAttribute={HttpHost:"http.host",HttpMethod:"http.method",HttpPort:"http.port",HttpStatusCode:"http.status_code",HttpUrl:"http.url",HttpUserAgent:"http.user_agent",GrpcMethod:"grpc.method",GrpcService:"rpc.service"},s.DependencyTypeName={Grpc:"GRPC",Http:"HTTP",InProc:"InProc"},s.HeartBeatMetricName="HeartBeat"}),ss=k((s,x)=>{"use strict";var o=H(2037),c=Fn(),f=function(){function u(h,p,g){p===void 0&&(p=6e4),g===void 0&&(g=!1),this._lastIntervalRequestExecutionTime=0,this._lastIntervalDependencyExecutionTime=0,u.INSTANCE||(u.INSTANCE=this),this._isInitialized=!1,this._client=h,this._collectionInterval=p,this._enableLiveMetricsCounters=g}return u.prototype.enable=function(h,p){var g=this;this._isEnabled=h,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),h?this._handle||(this._lastCpus=o.cpus(),this._lastRequests={totalRequestCount:u._totalRequestCount,totalFailedRequestCount:u._totalFailedRequestCount,time:+new Date},this._lastDependencies={totalDependencyCount:u._totalDependencyCount,totalFailedDependencyCount:u._totalFailedDependencyCount,time:+new Date},this._lastExceptions={totalExceptionCount:u._totalExceptionCount,time:+new Date},typeof process.cpuUsage=="function"&&(this._lastAppCpuUsage=process.cpuUsage()),this._lastHrtime=process.hrtime(),this._collectionInterval=p||this._collectionInterval,this._handle=setInterval(function(){return g.trackPerformance()},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},u.countRequest=function(h,p){var g;if(u.isEnabled()){if(typeof h=="string")g=+new Date("1970-01-01T"+h+"Z");else if(typeof h=="number")g=h;else return;u._intervalRequestExecutionTime+=g,p===!1&&u._totalFailedRequestCount++,u._totalRequestCount++}},u.countException=function(){u._totalExceptionCount++},u.countDependency=function(h,p){var g;if(u.isEnabled()){if(typeof h=="string")g=+new Date("1970-01-01T"+h+"Z");else if(typeof h=="number")g=h;else return;u._intervalDependencyExecutionTime+=g,p===!1&&u._totalFailedDependencyCount++,u._totalDependencyCount++}},u.prototype.isInitialized=function(){return this._isInitialized},u.isEnabled=function(){return u.INSTANCE&&u.INSTANCE._isEnabled},u.prototype.trackPerformance=function(){this._trackCpu(),this._trackMemory(),this._trackNetwork(),this._trackDependencyRate(),this._trackExceptionRate()},u.prototype._trackCpu=function(){var h=o.cpus();if(h&&h.length&&this._lastCpus&&h.length===this._lastCpus.length){for(var p=0,g=0,b=0,w=0,y=0,S=0;!!h&&S<h.length;S++){var C=h[S],T=this._lastCpus[S],A="% cpu("+S+") ",O=C.model,D=C.speed,q=C.times,Q=T.times,V=q.user-Q.user||0;p+=V;var ie=q.sys-Q.sys||0;g+=ie;var pe=q.nice-Q.nice||0;b+=pe;var me=q.idle-Q.idle||0;w+=me;var Se=q.irq-Q.irq||0;y+=Se}var He=void 0;if(typeof process.cpuUsage=="function"){var ze=process.cpuUsage(),ot=process.hrtime(),mt=ze.user-this._lastAppCpuUsage.user+(ze.system-this._lastAppCpuUsage.system)||0;if(typeof this._lastHrtime!="undefined"&&this._lastHrtime.length===2){var Nt=(ot[0]-this._lastHrtime[0])*1e6+(ot[1]-this._lastHrtime[1])/1e3||0;He=100*mt/(Nt*h.length)}this._lastAppCpuUsage=ze,this._lastHrtime=ot}var Pt=p+g+b+w+y||1;this._client.trackMetric({name:c.PerformanceCounter.PROCESSOR_TIME,value:(Pt-w)/Pt*100}),this._client.trackMetric({name:c.PerformanceCounter.PROCESS_TIME,value:He||p/Pt*100})}this._lastCpus=h},u.prototype._trackMemory=function(){var h=o.freemem(),p=process.memoryUsage().rss,g=o.totalmem()-h;this._client.trackMetric({name:c.PerformanceCounter.PRIVATE_BYTES,value:p}),this._client.trackMetric({name:c.PerformanceCounter.AVAILABLE_BYTES,value:h}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:c.QuickPulseCounter.COMMITTED_BYTES,value:g})},u.prototype._trackNetwork=function(){var h=this._lastRequests,p={totalRequestCount:u._totalRequestCount,totalFailedRequestCount:u._totalFailedRequestCount,time:+new Date},g=p.totalRequestCount-h.totalRequestCount||0,b=p.totalFailedRequestCount-h.totalFailedRequestCount||0,w=p.time-h.time,y=w/1e3,S=(u._intervalRequestExecutionTime-this._lastIntervalRequestExecutionTime)/g||0;if(this._lastIntervalRequestExecutionTime=u._intervalRequestExecutionTime,w>0){var C=g/y,T=b/y;this._client.trackMetric({name:c.PerformanceCounter.REQUEST_RATE,value:C}),(!this._enableLiveMetricsCounters||g>0)&&this._client.trackMetric({name:c.PerformanceCounter.REQUEST_DURATION,value:S}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:c.QuickPulseCounter.REQUEST_FAILURE_RATE,value:T})}this._lastRequests=p},u.prototype._trackDependencyRate=function(){if(this._enableLiveMetricsCounters){var h=this._lastDependencies,p={totalDependencyCount:u._totalDependencyCount,totalFailedDependencyCount:u._totalFailedDependencyCount,time:+new Date},g=p.totalDependencyCount-h.totalDependencyCount||0,b=p.totalFailedDependencyCount-h.totalFailedDependencyCount||0,w=p.time-h.time,y=w/1e3,S=(u._intervalDependencyExecutionTime-this._lastIntervalDependencyExecutionTime)/g||0;if(this._lastIntervalDependencyExecutionTime=u._intervalDependencyExecutionTime,w>0){var C=g/y,T=b/y;this._client.trackMetric({name:c.QuickPulseCounter.DEPENDENCY_RATE,value:C}),this._client.trackMetric({name:c.QuickPulseCounter.DEPENDENCY_FAILURE_RATE,value:T}),(!this._enableLiveMetricsCounters||g>0)&&this._client.trackMetric({name:c.QuickPulseCounter.DEPENDENCY_DURATION,value:S})}this._lastDependencies=p}},u.prototype._trackExceptionRate=function(){if(this._enableLiveMetricsCounters){var h=this._lastExceptions,p={totalExceptionCount:u._totalExceptionCount,time:+new Date},g=p.totalExceptionCount-h.totalExceptionCount||0,b=p.time-h.time,w=b/1e3;if(b>0){var y=g/w;this._client.trackMetric({name:c.QuickPulseCounter.EXCEPTION_RATE,value:y})}this._lastExceptions=p}},u.prototype.dispose=function(){u.INSTANCE=null,this.enable(!1),this._isInitialized=!1},u._totalRequestCount=0,u._totalFailedRequestCount=0,u._totalDependencyCount=0,u._totalFailedDependencyCount=0,u._totalExceptionCount=0,u._intervalDependencyExecutionTime=0,u._intervalRequestExecutionTime=0,u}();x.exports=f}),Wt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AggregatedMetricCounter=void 0;var x=function(){function o(c){this.dimensions=c,this.totalCount=0,this.lastTotalCount=0,this.intervalExecutionTime=0,this.lastTime=+new Date,this.lastIntervalExecutionTime=0}return o}();s.AggregatedMetricCounter=x}),cs=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.PreaggregatedMetricPropertyNames=void 0,s.PreaggregatedMetricPropertyNames={cloudRoleInstance:"cloud/roleInstance",cloudRoleName:"cloud/roleName",operationSynthetic:"operation/synthetic",requestSuccess:"Request.Success",requestResultCode:"request/resultCode",dependencyType:"Dependency.Type",dependencyTarget:"dependency/target",dependencySuccess:"Dependency.Success",dependencyResultCode:"dependency/resultCode",traceSeverityLevel:"trace/severityLevel"}}),ls=k((s,x)=>{"use strict";var o=s&&s.__assign||function(){return o=Object.assign||function(p){for(var g,b=1,w=arguments.length;b<w;b++){g=arguments[b];for(var y in g)Object.prototype.hasOwnProperty.call(g,y)&&(p[y]=g[y])}return p},o.apply(this,arguments)},c=Fn(),f=Wt(),u=cs(),h=function(){function p(g,b){b===void 0&&(b=6e4),p.INSTANCE||(p.INSTANCE=this),this._isInitialized=!1,p._dependencyCountersCollection=[],p._requestCountersCollection=[],p._exceptionCountersCollection=[],p._traceCountersCollection=[],this._client=g,this._collectionInterval=b}return p.prototype.enable=function(g,b){var w=this;this._isEnabled=g,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),g?this._handle||(this._collectionInterval=b||this._collectionInterval,this._handle=setInterval(function(){return w.trackPreAggregatedMetrics()},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},p.countException=function(g){if(p.isEnabled()){var b=p._getAggregatedCounter(g,this._exceptionCountersCollection);b.totalCount++}},p.countTrace=function(g){if(p.isEnabled()){var b=p._getAggregatedCounter(g,this._traceCountersCollection);b.totalCount++}},p.countRequest=function(g,b){if(p.isEnabled()){var w,y=p._getAggregatedCounter(b,this._requestCountersCollection);if(typeof g=="string")w=+new Date("1970-01-01T"+g+"Z");else if(typeof g=="number")w=g;else return;y.intervalExecutionTime+=w,y.totalCount++}},p.countDependency=function(g,b){if(p.isEnabled()){var w=p._getAggregatedCounter(b,this._dependencyCountersCollection),y;if(typeof g=="string")y=+new Date("1970-01-01T"+g+"Z");else if(typeof g=="number")y=g;else return;w.intervalExecutionTime+=y,w.totalCount++}},p.prototype.isInitialized=function(){return this._isInitialized},p.isEnabled=function(){return p.INSTANCE&&p.INSTANCE._isEnabled},p.prototype.trackPreAggregatedMetrics=function(){this._trackRequestMetrics(),this._trackDependencyMetrics(),this._trackExceptionMetrics(),this._trackTraceMetrics()},p._getAggregatedCounter=function(g,b){for(var w=!1,y=0;y<b.length;y++){if(g===b[y].dimensions)return b[y];if(Object.keys(g).length===Object.keys(b[y].dimensions).length){for(var S in g)if(g[S]!=b[y].dimensions[S]){w=!0;break}if(!w)return b[y];w=!1}}var C=new f.AggregatedMetricCounter(g);return b.push(C),C},p.prototype._trackRequestMetrics=function(){for(var g=0;g<p._requestCountersCollection.length;g++){var b=p._requestCountersCollection[g];b.time=+new Date;var w=b.totalCount-b.lastTotalCount||0,y=b.time-b.lastTime,S=(b.intervalExecutionTime-b.lastIntervalExecutionTime)/w||0;b.lastIntervalExecutionTime=b.intervalExecutionTime,y>0&&w>0&&this._trackPreAggregatedMetric({name:"Server response time",dimensions:b.dimensions,value:S,count:w,aggregationInterval:y,metricType:c.MetricId.REQUESTS_DURATION}),b.lastTotalCount=b.totalCount,b.lastTime=b.time}},p.prototype._trackDependencyMetrics=function(){for(var g=0;g<p._dependencyCountersCollection.length;g++){var b=p._dependencyCountersCollection[g];b.time=+new Date;var w=b.totalCount-b.lastTotalCount||0,y=b.time-b.lastTime,S=(b.intervalExecutionTime-b.lastIntervalExecutionTime)/w||0;b.lastIntervalExecutionTime=b.intervalExecutionTime,y>0&&w>0&&this._trackPreAggregatedMetric({name:"Dependency duration",dimensions:b.dimensions,value:S,count:w,aggregationInterval:y,metricType:c.MetricId.DEPENDENCIES_DURATION}),b.lastTotalCount=b.totalCount,b.lastTime=b.time}},p.prototype._trackExceptionMetrics=function(){for(var g=0;g<p._exceptionCountersCollection.length;g++){var b=p._exceptionCountersCollection[g],w=b.totalCount-b.lastTotalCount||0,y=b.time-b.lastTime;this._trackPreAggregatedMetric({name:"Exceptions",dimensions:b.dimensions,value:w,count:w,aggregationInterval:y,metricType:c.MetricId.EXCEPTIONS_COUNT}),b.lastTotalCount=b.totalCount,b.lastTime=b.time}},p.prototype._trackTraceMetrics=function(){for(var g=0;g<p._traceCountersCollection.length;g++){var b=p._traceCountersCollection[g],w=b.totalCount-b.lastTotalCount||0,y=b.time-b.lastTime;this._trackPreAggregatedMetric({name:"Traces",dimensions:b.dimensions,value:w,count:w,aggregationInterval:y,metricType:c.MetricId.TRACES_COUNT}),b.lastTotalCount=b.totalCount,b.lastTime=b.time}},p.prototype._trackPreAggregatedMetric=function(g){var b={};for(var w in g.dimensions)b[u.PreaggregatedMetricPropertyNames[w]]=g.dimensions[w];b=o(o({},b),{"_MS.MetricId":g.metricType,"_MS.AggregationIntervalMs":String(g.aggregationInterval),"_MS.IsAutocollected":"True"});var y={name:g.name,value:g.value,count:g.count,properties:b,kind:"Aggregation"};this._client.trackMetric(y)},p.prototype.dispose=function(){p.INSTANCE=null,this.enable(!1),this._isInitialized=!1},p}();x.exports=h}),ki=k((s,x)=>{"use strict";var o=H(2037),c=H(7147),f=H(1017),u=Fr(),h=rt(),p=function(){function g(b){this.keys=new u.ContextTagKeys,this.tags={},this._loadApplicationContext(b),this._loadDeviceContext(),this._loadInternalContext()}return g.prototype._loadApplicationContext=function(b){if(b=b||f.resolve(__dirname,"../../../../package.json"),!g.appVersion[b]){g.appVersion[b]="unknown";try{var w=JSON.parse(c.readFileSync(b,"utf8"));w&&typeof w.version=="string"&&(g.appVersion[b]=w.version)}catch(y){h.info("unable to read app version: ",y)}}this.tags[this.keys.applicationVersion]=g.appVersion[b]},g.prototype._loadDeviceContext=function(){this.tags[this.keys.deviceId]="",this.tags[this.keys.cloudRoleInstance]=o&&o.hostname(),this.tags[this.keys.deviceOSVersion]=o&&o.type()+" "+o.release(),this.tags[this.keys.cloudRole]=g.DefaultRoleName,this.tags["ai.device.osArchitecture"]=o&&o.arch(),this.tags["ai.device.osPlatform"]=o&&o.platform()},g.prototype._loadInternalContext=function(){var b=f.resolve(__dirname,"../../package.json");if(!g.sdkVersion){g.sdkVersion="unknown";try{var w=JSON.parse(c.readFileSync(b,"utf8"));w&&typeof w.version=="string"&&(g.sdkVersion=w.version)}catch(y){h.info("unable to read app version: ",y)}}this.tags[this.keys.internalSdkVersion]="node:"+g.sdkVersion},g.DefaultRoleName="Web",g.appVersion={},g.sdkVersion=null,g}();x.exports=p}),$n=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var w=function(y,S){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,T){C.__proto__=T}||function(C,T){for(var A in T)Object.prototype.hasOwnProperty.call(T,A)&&(C[A]=T[A])},w(y,S)};return function(y,S){w(y,S);function C(){this.constructor=y}y.prototype=S===null?Object.create(S):(C.prototype=S.prototype,new C)}}(),c=H(7310),f=Fr(),u=Lr(),h=Ln(),p=is(),g=pn(),b=function(w){o(y,w);function y(S,C){var T=w.call(this)||this;return C&&C.method&&S&&(T.method=C.method,T.url=y._getUrlFromRequestOptions(S,C),T.startTime=+new Date),T}return y.prototype.onError=function(S){this._setStatus(void 0,S)},y.prototype.onResponse=function(S){this._setStatus(S.statusCode,void 0),this.correlationId=u.getCorrelationContextTarget(S,h.requestContextTargetKey)},y.prototype.getDependencyTelemetry=function(S,C){var T=c.parse(this.url);T.search=void 0,T.hash=void 0;var A=this.method.toUpperCase()+" "+T.pathname,O=f.RemoteDependencyDataConstants.TYPE_HTTP,D=T.hostname;T.port&&(D+=":"+T.port),this.correlationId?(O=f.RemoteDependencyDataConstants.TYPE_AI,this.correlationId!==g.correlationIdPrefix&&(D+=" | "+this.correlationId)):O=f.RemoteDependencyDataConstants.TYPE_HTTP;var q={id:C,name:A,data:this.url,duration:this.duration,success:this._isSuccess(),resultCode:this.statusCode?this.statusCode.toString():null,properties:this.properties||{},dependencyTypeName:O,target:D};if(S&&S.time?q.time=S.time:this.startTime&&(q.time=new Date(this.startTime)),S){for(var Q in S)q[Q]||(q[Q]=S[Q]);if(S.properties)for(var Q in S.properties)q.properties[Q]=S.properties[Q]}return q},y._getUrlFromRequestOptions=function(S,C){if(typeof S=="string")if(S.indexOf("http://")===0||S.indexOf("https://")===0)S=c.parse(S);else{var T=c.parse(S);T.host==="443"?S=c.parse("https://"+S):S=c.parse("http://"+S)}else{if(S&&typeof c.URL=="function"&&S instanceof c.URL)return c.format(S);var A=S;S={},A&&Object.keys(A).forEach(function(q){S[q]=A[q]})}if(S.path){var O=c.parse(S.path);S.pathname=O.pathname,S.search=O.search}if(S.host&&S.port){var D=c.parse("http://"+S.host);!D.port&&S.port&&(S.hostname=S.host,delete S.host)}return S.protocol=S.protocol||C.agent&&C.agent.protocol||C.protocol||void 0,S.hostname=S.hostname||"localhost",c.format(S)},y}(p);x.exports=b}),Rn=k(s=>{"use strict";var x=s&&s.__assign||function(){return x=Object.assign||function(h){for(var p,g=1,b=arguments.length;g<b;g++){p=arguments[g];for(var w in p)Object.prototype.hasOwnProperty.call(p,w)&&(h[w]=p[w])}return h},x.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.spanToTelemetryContract=void 0;var o=Xt(),c=Fn();function f(h){var p=x({},h);return Object.keys(c.SpanAttribute).forEach(function(g){delete p[g]}),p}function u(h){var p="|"+h.spanContext().traceId+"."+h.spanContext().spanId+".",g=Math.round(h._duration[0]*1e3+h._duration[1]/1e6),b=h.attributes["peer.address"]?h.attributes["peer.address"].toString():"",w=h.attributes.component?h.attributes.component.toString():"",y=w.toUpperCase()===c.DependencyTypeName.Http||!!h.attributes[c.SpanAttribute.HttpUrl],S=w.toLowerCase()===c.DependencyTypeName.Grpc;if(y){var C=h.attributes[c.SpanAttribute.HttpMethod]||"GET",T=new URL(h.attributes[c.SpanAttribute.HttpUrl].toString()),A=h.attributes[c.SpanAttribute.HttpHost]||T.host,O=h.attributes[c.SpanAttribute.HttpPort]||T.port||null,D=T.pathname||"/",q=C+" "+D,Q=c.DependencyTypeName.Http,V=O?(A+":"+O).toString():A.toString(),ie=T.toString(),pe=h.attributes[c.SpanAttribute.HttpStatusCode]||h.status.code||0,me=pe<400;return{id:p,name:q,dependencyTypeName:Q,target:V,data:ie,success:me,duration:g,url:ie,resultCode:String(pe),properties:f(h.attributes)}}else if(S){var C=h.attributes[c.SpanAttribute.GrpcMethod]||"rpc",Se=h.attributes[c.SpanAttribute.GrpcService],He=Se?C+" "+Se:h.name;return{id:p,duration:g,name:He,target:Se.toString(),data:Se.toString()||He,url:Se.toString()||He,dependencyTypeName:c.DependencyTypeName.Grpc,resultCode:String(h.status.code||0),success:h.status.code===0,properties:f(h.attributes)}}else{var ze=h.name,ot=h.links&&h.links.map(function(mt){return{operation_Id:mt.context.traceId,id:mt.context.spanId}});return{id:p,duration:g,name:ze,target:b,data:b||ze,url:b||ze,dependencyTypeName:h.kind===o.SpanKind.INTERNAL?c.DependencyTypeName.InProc:w||h.name,resultCode:String(h.status.code||0),success:h.status.code===0,properties:x(x({},f(h.attributes)),{"_MS.links":ot||void 0})}}}s.spanToTelemetryContract=u}),Or=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.subscriber=void 0;var x=Xt(),o=ue(),c=gn(),f=Rn(),u=ye(),h=[],p=function(b){var w=b.data,y=f.spanToTelemetryContract(w),S=w.spanContext(),C=new c;C.traceId=S.traceId,C.spanId=S.spanId,C.traceFlag=c.formatOpenTelemetryTraceFlags(S.traceFlags),C.parentId=w.parentSpanId?"|"+S.traceId+"."+w.parentSpanId+".":null,u.AsyncScopeManager.with(w,function(){h.forEach(function(T){w.kind===x.SpanKind.SERVER?T.trackRequest(y):(w.kind===x.SpanKind.CLIENT||w.kind===x.SpanKind.INTERNAL)&&T.trackDependency(y)})})};s.subscriber=p;function g(b,w){b?(h.length===0&&o.channel.subscribe("azure-coretracing",s.subscriber),h.push(w)):(h=h.filter(function(y){return y!=w}),h.length===0&&o.channel.unsubscribe("azure-coretracing",s.subscriber))}s.enable=g}),uo=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.subscriber=void 0;var x=ue(),o=[],c=function(u){u.data.event.commandName!=="ismaster"&&o.forEach(function(h){var p=u.data.startedData&&u.data.startedData.databaseName||"Unknown database";h.trackDependency({target:p,data:u.data.event.commandName,name:u.data.event.commandName,duration:u.data.event.duration,success:u.data.succeeded,resultCode:u.data.succeeded?"0":"1",time:u.data.startedData.time,dependencyTypeName:"mongodb"})})};s.subscriber=c;function f(u,h){u?(o.length===0&&x.channel.subscribe("mongodb",s.subscriber),o.push(h)):(o=o.filter(function(p){return p!=h}),o.length===0&&x.channel.unsubscribe("mongodb",s.subscriber))}s.enable=f}),ia=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.subscriber=void 0;var x=ue(),o=[],c=function(u){o.forEach(function(h){var p=u.data.query||{},g=p.sql||"Unknown query",b=!u.data.err,w=p._connection||{},y=w.config||{},S=y.socketPath?y.socketPath:(y.host||"localhost")+":"+y.port;h.trackDependency({target:S,data:g,name:g,duration:u.data.duration,success:b,resultCode:b?"0":"1",time:u.data.time,dependencyTypeName:"mysql"})})};s.subscriber=c;function f(u,h){u?(o.length===0&&x.channel.subscribe("mysql",s.subscriber),o.push(h)):(o=o.filter(function(p){return p!=h}),o.length===0&&x.channel.unsubscribe("mysql",s.subscriber))}s.enable=f}),si=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.subscriber=void 0;var x=ue(),o=[],c=function(u){o.forEach(function(h){u.data.commandObj.command!=="info"&&h.trackDependency({target:u.data.address,name:u.data.commandObj.command,data:u.data.commandObj.command,duration:u.data.duration,success:!u.data.err,resultCode:u.data.err?"1":"0",time:u.data.time,dependencyTypeName:"redis"})})};s.subscriber=c;function f(u,h){u?(o.length===0&&x.channel.subscribe("redis",s.subscriber),o.push(h)):(o=o.filter(function(p){return p!=h}),o.length===0&&x.channel.unsubscribe("redis",s.subscriber))}s.enable=f}),us=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.enable=s.subscriber=void 0;var x=ue(),o=[],c=function(u){o.forEach(function(h){var p=u.data.query,g=p.preparable&&p.preparable.text||p.plan||p.text||"unknown query",b=!u.data.error,w=u.data.database.host+":"+u.data.database.port;h.trackDependency({target:w,data:g,name:g,duration:u.data.duration,success:b,resultCode:b?"0":"1",time:u.data.time,dependencyTypeName:"postgres"})})};s.subscriber=c;function f(u,h){u?(o.length===0&&x.channel.subscribe("postgres",s.subscriber),o.push(h)):(o=o.filter(function(p){return p!=h}),o.length===0&&x.channel.unsubscribe("postgres",s.subscriber))}s.enable=f}),ci=k((s,x)=>{"use strict";var o=s&&s.__spreadArrays||function(){for(var T=0,A=0,O=arguments.length;A<O;A++)T+=arguments[A].length;for(var D=Array(T),q=0,A=0;A<O;A++)for(var Q=arguments[A],V=0,ie=Q.length;V<ie;V++,q++)D[q]=Q[V];return D},c=H(3685),f=H(5687),u=rt(),h=Lr(),p=Ln(),g=$n(),b=Di(),w=pn(),y=gn(),S=Va(),C=function(){function T(A){if(T.INSTANCE)throw new Error("Client request tracking should be configured from the applicationInsights object");T.INSTANCE=this,this._client=A}return T.prototype.enable=function(A){this._isEnabled=A,this._isEnabled&&!this._isInitialized&&this._initialize(),S.IsInitialized&&(Or().enable(!0,this._client),uo().enable(A,this._client),ia().enable(A,this._client),si().enable(A,this._client),us().enable(A,this._client))},T.prototype.isInitialized=function(){return this._isInitialized},T.prototype._initialize=function(){var A=this;this._isInitialized=!0;var O=c.request,D=f.request,q=function(Q,V){var ie=!V[T.disableCollectionRequestOption]&&!Q[T.alreadyAutoCollectedFlag];V.headers&&V.headers["user-agent"]&&V.headers["user-agent"].toString().indexOf("azsdk-js")!==-1&&(ie=!1),Q[T.alreadyAutoCollectedFlag]=!0,Q&&V&&ie&&(b.CorrelationContextManager.wrapEmitter(Q),T.trackRequest(A._client,{options:V,request:Q}))};c.request=function(Q){for(var V=[],ie=1;ie<arguments.length;ie++)V[ie-1]=arguments[ie];var pe=O.call.apply(O,o([c,Q],V));return q(pe,Q),pe},f.request=function(Q){for(var V=[],ie=1;ie<arguments.length;ie++)V[ie-1]=arguments[ie];var pe=D.call.apply(D,o([f,Q],V));return q(pe,Q),pe},c.get=function(Q){for(var V,ie=[],pe=1;pe<arguments.length;pe++)ie[pe-1]=arguments[pe];var me=(V=c.request).call.apply(V,o([c,Q],ie));return me.end(),me},f.get=function(Q){for(var V,ie=[],pe=1;pe<arguments.length;pe++)ie[pe-1]=arguments[pe];var me=(V=f.request).call.apply(V,o([f,Q],ie));return me.end(),me}},T.trackRequest=function(A,O){if(!O.options||!O.request||!A){u.info("AutoCollectHttpDependencies.trackRequest was called with invalid parameters: ",!O.options,!O.request,!A);return}var D=new g(O.options,O.request),q=b.CorrelationContextManager.getCurrentContext(),Q,V;if(q&&q.operation&&q.operation.traceparent&&y.isValidTraceId(q.operation.traceparent.traceId))q.operation.traceparent.updateSpanId(),Q=q.operation.traceparent.getBackCompatRequestId();else if(w.w3cEnabled){var ie=new y;V=ie.toString(),Q=ie.getBackCompatRequestId()}else Q=q&&q.operation&&q.operation.parentId+T.requestNumber+++".";if(h.canIncludeCorrelationHeader(A,D.getUrl())&&O.request.getHeader&&O.request.setHeader&&A.config&&A.config.correlationId){var pe=O.request.getHeader(p.requestContextHeader);try{h.safeIncludeCorrelationHeader(A,O.request,pe)}catch(He){u.warn("Request-Context header could not be set. Correlation of requests may be lost",He)}if(q&&q.operation)try{if(O.request.setHeader(p.requestIdHeader,Q),A.config.ignoreLegacyHeaders||(O.request.setHeader(p.parentIdHeader,q.operation.id),O.request.setHeader(p.rootIdHeader,Q)),V||q.operation.traceparent)O.request.setHeader(p.traceparentHeader,V||q.operation.traceparent.toString());else if(w.w3cEnabled){var ie=new y().toString();O.request.setHeader(p.traceparentHeader,ie)}if(q.operation.tracestate){var me=q.operation.tracestate.toString();me&&O.request.setHeader(p.traceStateHeader,me)}var Se=q.customProperties.serializeToHeader();Se&&O.request.setHeader(p.correlationContextHeader,Se)}catch(He){u.warn("Correlation headers could not be set. Correlation of requests may be lost.",He)}}O.request.on&&(O.request.on("response",function(He){D.onResponse(He);var ze=D.getDependencyTelemetry(O,Q);ze.contextObjects=ze.contextObjects||{},ze.contextObjects["http.RequestOptions"]=O.options,ze.contextObjects["http.ClientRequest"]=O.request,ze.contextObjects["http.ClientResponse"]=He,A.trackDependency(ze)}),O.request.on("error",function(He){D.onError(He);var ze=D.getDependencyTelemetry(O,Q);ze.contextObjects=ze.contextObjects||{},ze.contextObjects["http.RequestOptions"]=O.options,ze.contextObjects["http.ClientRequest"]=O.request,ze.contextObjects.Error=He,A.trackDependency(ze)}),O.request.on("abort",function(){D.onError(new Error);var He=D.getDependencyTelemetry(O,Q);He.contextObjects=He.contextObjects||{},He.contextObjects["http.RequestOptions"]=O.options,He.contextObjects["http.ClientRequest"]=O.request,A.trackDependency(He)}))},T.prototype.dispose=function(){T.INSTANCE=null,this.enable(!1),this._isInitialized=!1},T.disableCollectionRequestOption="disableAppInsightsAutoCollection",T.requestNumber=1,T.alreadyAutoCollectedFlag="_appInsightsAutoCollected",T}();x.exports=C}),oa=k((s,x)=>{"use strict";var o=H(2037),c=Fn(),f=Lr(),u=ki(),h=ci(),p="http://169.254.169.254/metadata/instance/compute",g="api-version=2017-12-01",b="format=json",w="ENETUNREACH",y=function(){function S(C){this._collectionInterval=9e5,this._vmData={},this._azInst_vmId="",this._azInst_subscriptionId="",this._azInst_osType="",S.INSTANCE||(S.INSTANCE=this),this._isInitialized=!1,this._client=C}return S.prototype.enable=function(C,T){var A=this;this._isEnabled=C,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),C?this._handle||(this._handle=setInterval(function(){return A.trackHeartBeat(T,function(){})},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=null)},S.prototype.isInitialized=function(){return this._isInitialized},S.isEnabled=function(){return S.INSTANCE&&S.INSTANCE._isEnabled},S.prototype.trackHeartBeat=function(C,T){var A=this,O=!1,D={},q=u.sdkVersion;D.sdk=q,D.osType=o.type(),process.env.WEBSITE_SITE_NAME?(D.appSrv_SiteName=process.env.WEBSITE_SITE_NAME||"",D.appSrv_wsStamp=process.env.WEBSITE_HOME_STAMPNAME||"",D.appSrv_wsHost=process.env.WEBSITE_HOSTNAME||""):process.env.FUNCTIONS_WORKER_RUNTIME?D.azfunction_appId=process.env.WEBSITE_HOSTNAME:C&&(this._isVM===void 0?(O=!0,this._getAzureComputeMetadata(C,function(){A._isVM&&Object.keys(A._vmData).length>0&&(D.azInst_vmId=A._vmData.vmId||"",D.azInst_subscriptionId=A._vmData.subscriptionId||"",D.azInst_osType=A._vmData.osType||"",A._azInst_vmId=A._vmData.vmId||"",A._azInst_subscriptionId=A._vmData.subscriptionId||"",A._azInst_osType=A._vmData.osType||""),A._client.trackMetric({name:c.HeartBeatMetricName,value:0,properties:D}),T()})):this._isVM&&(D.azInst_vmId=this._azInst_vmId,D.azInst_subscriptionId=this._azInst_subscriptionId,D.azInst_osType=this._azInst_osType)),O||(this._client.trackMetric({name:c.HeartBeatMetricName,value:0,properties:D}),T())},S.prototype.dispose=function(){S.INSTANCE=null,this.enable(!1),this._isInitialized=!1},S.prototype._getAzureComputeMetadata=function(C,T){var A,O=this,D=p+"?"+g+"&"+b,q=(A={method:"GET"},A[h.disableCollectionRequestOption]=!0,A.headers={Metadata:"True"},A),Q=f.makeRequest(C,D,q,function(V){if(V.statusCode===200){O._isVM=!0;var ie="";V.on("data",function(pe){ie+=pe}),V.on("end",function(){O._vmData=O._isJSON(ie)?JSON.parse(ie):{},T()})}else T()});Q&&(Q.on("error",function(V){V&&V.message&&V.message.indexOf(w)>-1&&(O._isVM=!1),T()}),Q.end())},S.prototype._isJSON=function(C){try{return JSON.parse(C)&&!!C}catch(T){return!1}},S}();x.exports=y}),aa=k((s,x)=>{"use strict";var o=H(3685),c=H(5687),f=rt(),u=Lr(),h=Ln(),p=oi(),g=Di(),b=ss(),w=function(){function y(S){if(y.INSTANCE)throw new Error("Server request tracking should be configured from the applicationInsights object");y.INSTANCE=this,this._client=S}return y.prototype.enable=function(S){this._isEnabled=S,(this._isAutoCorrelating||this._isEnabled||b.isEnabled())&&!this._isInitialized&&(this.useAutoCorrelation(this._isAutoCorrelating),this._initialize())},y.prototype.useAutoCorrelation=function(S,C){S&&!this._isAutoCorrelating?g.CorrelationContextManager.enable(C):!S&&this._isAutoCorrelating&&g.CorrelationContextManager.disable(),this._isAutoCorrelating=S},y.prototype.isInitialized=function(){return this._isInitialized},y.prototype.isAutoCorrelating=function(){return this._isAutoCorrelating},y.prototype._generateCorrelationContext=function(S){if(this._isAutoCorrelating)return g.CorrelationContextManager.generateContextObject(S.getOperationId(this._client.context.tags),S.getRequestId(),S.getOperationName(this._client.context.tags),S.getCorrelationContextHeader(),S.getTraceparent(),S.getTracestate())},y.prototype._initialize=function(){var S=this;this._isInitialized=!0;var C=function(D){if(D){if(typeof D!="function")throw new Error("onRequest handler must be a function");return function(q,Q){g.CorrelationContextManager.wrapEmitter(q),g.CorrelationContextManager.wrapEmitter(Q);var V=q&&!q[y.alreadyAutoCollectedFlag];if(q&&V){var ie=new p(q),pe=S._generateCorrelationContext(ie);g.CorrelationContextManager.runWithContext(pe,function(){S._isEnabled&&(q[y.alreadyAutoCollectedFlag]=!0,y.trackRequest(S._client,{request:q,response:Q},ie)),typeof D=="function"&&D(q,Q)})}else typeof D=="function"&&D(q,Q)}}},T=function(D){var q=D.addListener.bind(D);D.addListener=function(Q,V){switch(Q){case"request":case"checkContinue":return q(Q,C(V));default:return q(Q,V)}},D.on=D.addListener},A=o.createServer;o.createServer=function(D,q){if(q&&typeof q=="function"){var Q=A(D,C(q));return T(Q),Q}else{var Q=A(C(D));return T(Q),Q}};var O=c.createServer;c.createServer=function(D,q){var Q=O(D,C(q));return T(Q),Q}},y.trackRequestSync=function(S,C){if(!C.request||!C.response||!S){f.info("AutoCollectHttpRequests.trackRequestSync was called with invalid parameters: ",!C.request,!C.response,!S);return}y.addResponseCorrelationIdHeader(S,C.response);var T=g.CorrelationContextManager.getCurrentContext(),A=new p(C.request,T&&T.operation.parentId);T&&(T.operation.id=A.getOperationId(S.context.tags)||T.operation.id,T.operation.name=A.getOperationName(S.context.tags)||T.operation.name,T.operation.parentId=A.getRequestId()||T.operation.parentId,T.customProperties.addHeaderData(A.getCorrelationContextHeader())),y.endRequest(S,A,C,C.duration,C.error)},y.trackRequest=function(S,C,T){if(!C.request||!C.response||!S){f.info("AutoCollectHttpRequests.trackRequest was called with invalid parameters: ",!C.request,!C.response,!S);return}var A=g.CorrelationContextManager.getCurrentContext(),O=T||new p(C.request,A&&A.operation.parentId);u.canIncludeCorrelationHeader(S,O.getUrl())&&y.addResponseCorrelationIdHeader(S,C.response),A&&!T&&(A.operation.id=O.getOperationId(S.context.tags)||A.operation.id,A.operation.name=O.getOperationName(S.context.tags)||A.operation.name,A.operation.parentId=O.getOperationParentId(S.context.tags)||A.operation.parentId,A.customProperties.addHeaderData(O.getCorrelationContextHeader())),C.response.once&&C.response.once("finish",function(){y.endRequest(S,O,C,null,null)}),C.request.on&&C.request.on("error",function(D){y.endRequest(S,O,C,null,D)}),C.request.on&&C.request.on("aborted",function(){var D="The request has been aborted and the network socket has closed.";y.endRequest(S,O,C,null,D)})},y.addResponseCorrelationIdHeader=function(S,C){if(S.config&&S.config.correlationId&&C.getHeader&&C.setHeader&&!C.headersSent){var T=C.getHeader(h.requestContextHeader);u.safeIncludeCorrelationHeader(S,C,T)}},y.endRequest=function(S,C,T,A,O){O?C.onError(O,A):C.onResponse(T.response,A);var D=C.getRequestTelemetry(T);if(D.tagOverrides=C.getRequestTags(S.context.tags),T.tagOverrides)for(var q in T.tagOverrides)D.tagOverrides[q]=T.tagOverrides[q];var Q=C.getLegacyRootId();Q&&(D.properties.ai_legacyRootId=Q),D.contextObjects=D.contextObjects||{},D.contextObjects["http.ServerRequest"]=T.request,D.contextObjects["http.ServerResponse"]=T.response,S.trackRequest(D)},y.prototype.dispose=function(){y.INSTANCE=null,this.enable(!1),this._isInitialized=!1,g.CorrelationContextManager.disable(),this._isAutoCorrelating=!1},y.alreadyAutoCollectedFlag="_appInsightsAutoCollected",y}();x.exports=w}),pc=k((s,x)=>{"use strict";var o=s&&s.__assign||function(){return o=Object.assign||function(w){for(var y,S=1,C=arguments.length;S<C;S++){y=arguments[S];for(var T in y)Object.prototype.hasOwnProperty.call(y,T)&&(w[T]=y[T])}return w},o.apply(this,arguments)},c=H(2037),f=Fr(),u=Fn(),h=Lr(),p=rt(),g=h.w3cTraceId(),b=function(){function w(){}return w.createQuickPulseEnvelope=function(y,S,C,T){var A=c&&typeof c.hostname=="function"&&c.hostname()||"Unknown",O=T.tags&&T.keys&&T.keys.cloudRoleInstance&&T.tags[T.keys.cloudRoleInstance]||A,D=T.tags&&T.keys&&T.keys.cloudRole&&T.tags[T.keys.cloudRole]||null,q={Documents:S.length>0?S:null,InstrumentationKey:C.instrumentationKey||"",Metrics:y.length>0?y:null,InvariantVersion:1,Timestamp:"/Date("+Date.now()+")/",Version:T.tags[T.keys.internalSdkVersion],StreamId:g,MachineName:A,Instance:O,RoleName:D};return q},w.createQuickPulseMetric=function(y){var S;return S={Name:y.name,Value:y.value,Weight:y.count||1},S},w.telemetryEnvelopeToQuickPulseDocument=function(y){switch(y.data.baseType){case f.TelemetryTypeString.Event:return w.createQuickPulseEventDocument(y);case f.TelemetryTypeString.Exception:return w.createQuickPulseExceptionDocument(y);case f.TelemetryTypeString.Trace:return w.createQuickPulseTraceDocument(y);case f.TelemetryTypeString.Dependency:return w.createQuickPulseDependencyDocument(y);case f.TelemetryTypeString.Request:return w.createQuickPulseRequestDocument(y)}return null},w.createQuickPulseEventDocument=function(y){var S=w.createQuickPulseDocument(y),C=y.data.baseData.name,T=o(o({},S),{Name:C});return T},w.createQuickPulseTraceDocument=function(y){var S=w.createQuickPulseDocument(y),C=y.data.baseData.severityLevel||0,T=o(o({},S),{Message:y.data.baseData.message,SeverityLevel:f.SeverityLevel[C]});return T},w.createQuickPulseExceptionDocument=function(y){var S=w.createQuickPulseDocument(y),C=y.data.baseData.exceptions,T="",A="",O="";C&&C.length>0&&(C[0].parsedStack&&C[0].parsedStack.length>0?C[0].parsedStack.forEach(function(q){T+=q.assembly+`
`}):C[0].stack&&C[0].stack.length>0&&(T=C[0].stack),A=C[0].message,O=C[0].typeName);var D=o(o({},S),{Exception:T,ExceptionMessage:A,ExceptionType:O});return D},w.createQuickPulseRequestDocument=function(y){var S=w.createQuickPulseDocument(y),C=y.data.baseData,T=o(o({},S),{Name:C.name,Success:C.success,Duration:C.duration,ResponseCode:C.responseCode,OperationName:C.name});return T},w.createQuickPulseDependencyDocument=function(y){var S=w.createQuickPulseDocument(y),C=y.data.baseData,T=o(o({},S),{Name:C.name,Target:C.target,Success:C.success,Duration:C.duration,ResultCode:C.resultCode,CommandName:C.data,OperationName:S.OperationId,DependencyTypeName:C.type});return T},w.createQuickPulseDocument=function(y){var S,C,T,A;y.data.baseType?(C=u.TelemetryTypeStringToQuickPulseType[y.data.baseType],S=u.TelemetryTypeStringToQuickPulseDocumentType[y.data.baseType]):p.warn("Document type invalid; not sending live metric document",y.data.baseType),T=y.tags[w.keys.operationId],A=w.aggregateProperties(y);var O={DocumentType:S,__type:C,OperationId:T,Version:"1.0",Properties:A};return O},w.aggregateProperties=function(y){var S=[],C=y.data.baseData.measurements||{};for(var T in C)if(C.hasOwnProperty(T)){var A=C[T],O={key:T,value:A};S.push(O)}var D=y.data.baseData.properties||{};for(var T in D)if(D.hasOwnProperty(T)){var A=D[T],O={key:T,value:A};S.push(O)}return S},w.keys=new f.ContextTagKeys,w}();x.exports=b}),gc=k((s,x)=>{"use strict";var o=function(){return(Date.now()+621355968e5)*1e4};x.exports={getTransmissionTime:o}}),sa=k((s,x)=>{"use strict";var o=s&&s.__awaiter||function(y,S,C,T){function A(O){return O instanceof C?O:new C(function(D){D(O)})}return new(C||(C=Promise))(function(O,D){function q(ie){try{V(T.next(ie))}catch(pe){D(pe)}}function Q(ie){try{V(T.throw(ie))}catch(pe){D(pe)}}function V(ie){ie.done?O(ie.value):A(ie.value).then(q,Q)}V((T=T.apply(y,S||[])).next())})},c=s&&s.__generator||function(y,S){var C={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},T,A,O,D;return D={next:q(0),throw:q(1),return:q(2)},typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function q(V){return function(ie){return Q([V,ie])}}function Q(V){if(T)throw new TypeError("Generator is already executing.");for(;C;)try{if(T=1,A&&(O=V[0]&2?A.return:V[0]?A.throw||((O=A.return)&&O.call(A),0):A.next)&&!(O=O.call(A,V[1])).done)return O;switch(A=0,O&&(V=[V[0]&2,O.value]),V[0]){case 0:case 1:O=V;break;case 4:return C.label++,{value:V[1],done:!1};case 5:C.label++,A=V[1],V=[0];continue;case 7:V=C.ops.pop(),C.trys.pop();continue;default:if(O=C.trys,!(O=O.length>0&&O[O.length-1])&&(V[0]===6||V[0]===2)){C=0;continue}if(V[0]===3&&(!O||V[1]>O[0]&&V[1]<O[3])){C.label=V[1];break}if(V[0]===6&&C.label<O[1]){C.label=O[1],O=V;break}if(O&&C.label<O[2]){C.label=O[2],C.ops.push(V);break}O[2]&&C.ops.pop(),C.trys.pop();continue}V=S.call(y,C)}catch(ie){V=[6,ie],A=0}finally{T=O=0}if(V[0]&5)throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}},f=H(5687),u=ci(),h=rt(),p=gc(),g=Lr(),b={method:"POST",time:"x-ms-qps-transmission-time",pollingIntervalHint:"x-ms-qps-service-polling-interval-hint",endpointRedirect:"x-ms-qps-service-endpoint-redirect",instanceName:"x-ms-qps-instance-name",streamId:"x-ms-qps-stream-id",machineName:"x-ms-qps-machine-name",roleName:"x-ms-qps-role-name",streamid:"x-ms-qps-stream-id",invariantVersion:"x-ms-qps-invariant-version",subscribed:"x-ms-qps-subscribed"},w=function(){function y(S){this._config=S,this._consecutiveErrors=0}return y.prototype.ping=function(S,C,T){var A=[{name:b.streamId,value:S.StreamId},{name:b.machineName,value:S.MachineName},{name:b.roleName,value:S.RoleName},{name:b.instanceName,value:S.Instance},{name:b.invariantVersion,value:S.InvariantVersion.toString()}];this._submitData(S,C,T,"ping",A)},y.prototype.post=function(S,C,T){return o(this,void 0,void 0,function(){return c(this,function(A){switch(A.label){case 0:return[4,this._submitData([S],C,T,"post")];case 1:return A.sent(),[2]}})})},y.prototype._submitData=function(S,C,T,A,O){return o(this,void 0,void 0,function(){var D,q,Q,V,ie,pe=this;return c(this,function(me){return D=JSON.stringify(S),q=(V={},V[u.disableCollectionRequestOption]=!0,V.host=C&&C.length>0?C:this._config.quickPulseHost,V.method=b.method,V.path="/QuickPulseService.svc/"+A+"?ikey="+this._config.instrumentationKey,V.headers=(ie={Expect:"100-continue"},ie[b.time]=p.getTransmissionTime(),ie["Content-Type"]="application/json",ie["Content-Length"]=Buffer.byteLength(D),ie),V),O&&O.length>0&&O.forEach(function(Se){return q.headers[Se.name]=Se.value}),this._config.httpsAgent?q.agent=this._config.httpsAgent:q.agent=g.tlsRestrictedAgent,Q=f.request(q,function(Se){if(Se.statusCode==200){var He=Se.headers[b.subscribed]==="true",ze=Se.headers[b.endpointRedirect]?Se.headers[b.endpointRedirect].toString():null,ot=Se.headers[b.pollingIntervalHint]?parseInt(Se.headers[b.pollingIntervalHint].toString()):null;pe._consecutiveErrors=0,T(He,Se,ze,ot)}else pe._onError("StatusCode:"+Se.statusCode+" StatusMessage:"+Se.statusMessage),T()}),Q.on("error",function(Se){pe._onError(Se),T()}),Q.write(D),Q.end(),[2]})})},y.prototype._onError=function(S){this._consecutiveErrors++;var C="Transient error connecting to the Live Metrics endpoint. This packet will not appear in your Live Metrics Stream. Error:";this._consecutiveErrors%y.MAX_QPS_FAILURES_BEFORE_WARN==0?(C="Live Metrics endpoint could not be reached "+this._consecutiveErrors+" consecutive times. Most recent error:",h.warn(y.TAG,C,S)):h.info(y.TAG,C,S)},y.TAG="QuickPulseSender",y.MAX_QPS_FAILURES_BEFORE_WARN=25,y}();x.exports=w}),mc=k((s,x)=>{"use strict";var o=s&&s.__awaiter||function(w,y,S,C){function T(A){return A instanceof S?A:new S(function(O){O(A)})}return new(S||(S=Promise))(function(A,O){function D(V){try{Q(C.next(V))}catch(ie){O(ie)}}function q(V){try{Q(C.throw(V))}catch(ie){O(ie)}}function Q(V){V.done?A(V.value):T(V.value).then(D,q)}Q((C=C.apply(w,y||[])).next())})},c=s&&s.__generator||function(w,y){var S={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},C,T,A,O;return O={next:D(0),throw:D(1),return:D(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function D(Q){return function(V){return q([Q,V])}}function q(Q){if(C)throw new TypeError("Generator is already executing.");for(;S;)try{if(C=1,T&&(A=Q[0]&2?T.return:Q[0]?T.throw||((A=T.return)&&A.call(T),0):T.next)&&!(A=A.call(T,Q[1])).done)return A;switch(T=0,A&&(Q=[Q[0]&2,A.value]),Q[0]){case 0:case 1:A=Q;break;case 4:return S.label++,{value:Q[1],done:!1};case 5:S.label++,T=Q[1],Q=[0];continue;case 7:Q=S.ops.pop(),S.trys.pop();continue;default:if(A=S.trys,!(A=A.length>0&&A[A.length-1])&&(Q[0]===6||Q[0]===2)){S=0;continue}if(Q[0]===3&&(!A||Q[1]>A[0]&&Q[1]<A[3])){S.label=Q[1];break}if(Q[0]===6&&S.label<A[1]){S.label=A[1],A=Q;break}if(A&&S.label<A[2]){S.label=A[2],S.ops.push(Q);break}A[2]&&S.ops.pop(),S.trys.pop();continue}Q=y.call(w,S)}catch(V){Q=[6,V],T=0}finally{C=A=0}if(Q[0]&5)throw Q[1];return{value:Q[0]?Q[1]:void 0,done:!0}}},f=rt(),u=pc(),h=sa(),p=Fn(),g=ki(),b=function(){function w(y,S){this._isCollectingData=!1,this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0,this._metrics={},this._documents=[],this._collectors=[],this._redirectedHost=null,this._pollingIntervalHint=-1,this.config=y,this.context=S||new g,this._sender=new h(this.config),this._isEnabled=!1}return w.prototype.addCollector=function(y){this._collectors.push(y)},w.prototype.trackMetric=function(y){this._addMetric(y)},w.prototype.addDocument=function(y){var S=u.telemetryEnvelopeToQuickPulseDocument(y);S&&this._documents.push(S)},w.prototype.enable=function(y){y&&!this._isEnabled?(this._isEnabled=!0,this._goQuickPulse()):!y&&this._isEnabled&&(this._isEnabled=!1,clearTimeout(this._handle),this._handle=void 0)},w.prototype.enableCollectors=function(y){this._collectors.forEach(function(S){S.enable(y)})},w.prototype._addMetric=function(y){var S=y.value,C=y.count||1,T=p.PerformanceToQuickPulseCounter[y.name];T&&(this._metrics[T]?(this._metrics[T].Value=(this._metrics[T].Value*this._metrics[T].Weight+S*C)/(this._metrics[T].Weight+C),this._metrics[T].Weight+=C):(this._metrics[T]=u.createQuickPulseMetric(y),this._metrics[T].Name=T,this._metrics[T].Weight=1))},w.prototype._resetQuickPulseBuffer=function(){delete this._metrics,this._metrics={},this._documents.length=0},w.prototype._goQuickPulse=function(){return o(this,void 0,void 0,function(){var y,S,C,T,A=this;return c(this,function(O){switch(O.label){case 0:return y=Object.keys(this._metrics).map(function(D){return A._metrics[D]}),S=u.createQuickPulseEnvelope(y,this._documents.slice(),this.config,this.context),this._resetQuickPulseBuffer(),this._isCollectingData?[4,this._post(S)]:[3,2];case 1:return O.sent(),[3,3];case 2:this._ping(S),O.label=3;case 3:return C=this._pollingIntervalHint>0?this._pollingIntervalHint:w.PING_INTERVAL,T=this._isCollectingData?w.POST_INTERVAL:C,this._isCollectingData&&Date.now()-this._lastSuccessTime>=w.MAX_POST_WAIT_TIME&&!this._lastSendSucceeded?(this._isCollectingData=!1,T=w.FALLBACK_INTERVAL):!this._isCollectingData&&Date.now()-this._lastSuccessTime>=w.MAX_PING_WAIT_TIME&&!this._lastSendSucceeded&&(T=w.FALLBACK_INTERVAL),this._lastSendSucceeded=null,this._handle=setTimeout(this._goQuickPulse.bind(this),T),this._handle.unref(),[2]}})})},w.prototype._ping=function(y){this._sender.ping(y,this._redirectedHost,this._quickPulseDone.bind(this))},w.prototype._post=function(y){return o(this,void 0,void 0,function(){return c(this,function(S){switch(S.label){case 0:return[4,this._sender.post(y,this._redirectedHost,this._quickPulseDone.bind(this))];case 1:return S.sent(),[2]}})})},w.prototype._quickPulseDone=function(y,S,C,T){y!=null?(this._isCollectingData!==y&&(f.info("Live Metrics sending data",y),this.enableCollectors(y)),this._isCollectingData=y,C&&C.length>0&&(this._redirectedHost=C,f.info("Redirecting endpoint to: ",C)),T&&T>0&&(this._pollingIntervalHint=T),S&&S.statusCode<300&&S.statusCode>=200?(this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0):this._lastSendSucceeded=!1):this._lastSendSucceeded=!1},w.MAX_POST_WAIT_TIME=2e4,w.MAX_PING_WAIT_TIME=6e4,w.FALLBACK_INTERVAL=6e4,w.PING_INTERVAL=5e3,w.POST_INTERVAL=1e3,w}();x.exports=b}),vc=k((s,x)=>{"use strict";var o=Fn(),c=function(){function f(){}return f.parse=function(u){if(!u)return{};var h=u.split(f._FIELDS_SEPARATOR),p=h.reduce(function(b,w){var y=w.split(f._FIELD_KEY_VALUE_SEPARATOR);if(y.length===2){var S=y[0].toLowerCase(),C=y[1];b[S]=C}return b},{});if(Object.keys(p).length>0){if(p.endpointsuffix){var g=p.location?p.location+".":"";p.ingestionendpoint=p.ingestionendpoint||"https://"+g+"dc."+p.endpointsuffix,p.liveendpoint=p.liveendpoint||"https://"+g+"live."+p.endpointsuffix}p.ingestionendpoint=p.ingestionendpoint||o.DEFAULT_BREEZE_ENDPOINT,p.liveendpoint=p.liveendpoint||o.DEFAULT_LIVEMETRICS_ENDPOINT}return p},f._FIELDS_SEPARATOR=";",f._FIELD_KEY_VALUE_SEPARATOR="=",f}();x.exports=c}),yc=k((s,x)=>{"use strict";var o=pn(),c=vc(),f=rt(),u=Fn(),h=H(7310),p=function(){function g(b){var w=this;this.endpointBase=u.DEFAULT_BREEZE_ENDPOINT;var y=process.env[g.ENV_connectionString],S=c.parse(b),C=c.parse(y),T=!S.instrumentationkey&&Object.keys(S).length>0?null:b;this.instrumentationKey=S.instrumentationkey||T||C.instrumentationkey||g._getInstrumentationKey(),g._validateInstrumentationKey(this.instrumentationKey),this.endpointUrl=(S.ingestionendpoint||C.ingestionendpoint||this.endpointBase)+"/v2.1/track",this.maxBatchSize=250,this.maxBatchIntervalMs=15e3,this.disableAppInsights=!1,this.samplingPercentage=100,this.correlationIdRetryIntervalMs=30*1e3,this.correlationHeaderExcludedDomains=["*.core.windows.net","*.core.chinacloudapi.cn","*.core.cloudapi.de","*.core.usgovcloudapi.net","*.core.microsoft.scloud","*.core.eaglex.ic.gov"],this.setCorrelationId=function(A){return w.correlationId=A},this.proxyHttpUrl=process.env[g.ENV_http_proxy]||void 0,this.proxyHttpsUrl=process.env[g.ENV_https_proxy]||void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.profileQueryEndpoint=S.ingestionendpoint||C.ingestionendpoint||process.env[g.ENV_profileQueryEndpoint]||this.endpointBase,this._quickPulseHost=S.liveendpoint||C.liveendpoint||process.env[g.ENV_quickPulseHost]||u.DEFAULT_LIVEMETRICS_HOST,this._quickPulseHost.match(/^https?:\/\//)&&(this._quickPulseHost=h.parse(this._quickPulseHost).host)}return Object.defineProperty(g.prototype,"profileQueryEndpoint",{get:function(){return this._profileQueryEndpoint},set:function(b){o.cancelCorrelationIdQuery(this,this.setCorrelationId),this._profileQueryEndpoint=b,this.correlationId=o.correlationIdPrefix,o.queryCorrelationId(this,this.setCorrelationId)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"quickPulseHost",{get:function(){return this._quickPulseHost},set:function(b){this._quickPulseHost=b},enumerable:!1,configurable:!0}),g._getInstrumentationKey=function(){var b=process.env[g.ENV_iKey]||process.env[g.ENV_azurePrefix+g.ENV_iKey]||process.env[g.legacy_ENV_iKey]||process.env[g.ENV_azurePrefix+g.legacy_ENV_iKey];if(!b||b=="")throw new Error("Instrumentation key not found, pass the key in the config to this method or set the key in the environment variable APPINSIGHTS_INSTRUMENTATIONKEY before starting the server");return b},g._validateInstrumentationKey=function(b){var w="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",y=new RegExp(w);return y.test(b)},g.ENV_azurePrefix="APPSETTING_",g.ENV_iKey="APPINSIGHTS_INSTRUMENTATIONKEY",g.legacy_ENV_iKey="APPINSIGHTS_INSTRUMENTATION_KEY",g.ENV_profileQueryEndpoint="APPINSIGHTS_PROFILE_QUERY_ENDPOINT",g.ENV_quickPulseHost="APPINSIGHTS_QUICKPULSE_HOST",g.ENV_connectionString="APPLICATIONINSIGHTS_CONNECTION_STRING",g.ENV_nativeMetricsDisablers="APPLICATION_INSIGHTS_DISABLE_EXTENDED_METRIC",g.ENV_nativeMetricsDisableAll="APPLICATION_INSIGHTS_DISABLE_ALL_EXTENDED_METRICS",g.ENV_http_proxy="http_proxy",g.ENV_https_proxy="https_proxy",g}();x.exports=p}),Gl=k(s=>{"use strict";var x=s&&s.__assign||function(){return x=Object.assign||function(h){for(var p,g=1,b=arguments.length;g<b;g++){p=arguments[g];for(var w in p)Object.prototype.hasOwnProperty.call(p,w)&&(h[w]=p[w])}return h},x.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.AutoCollectNativePerformance=void 0;var o=yc(),c=ki(),f=rt(),u=function(){function h(p){this._disabledMetrics={},h.INSTANCE&&h.INSTANCE.dispose(),h.INSTANCE=this,this._client=p}return h.isNodeVersionCompatible=function(){var p=process.versions.node.split(".");return parseInt(p[0])>=6},h.prototype.enable=function(p,g,b){var w=this;if(g===void 0&&(g={}),b===void 0&&(b=6e4),!!h.isNodeVersionCompatible()){if(h._metricsAvailable==null&&p&&!this._isInitialized)try{var y=H(9166);h._emitter=new y,h._metricsAvailable=!0,f.info("Native metrics module successfully loaded!")}catch(S){h._metricsAvailable=!1;return}this._isEnabled=p,this._disabledMetrics=g,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),this._isEnabled&&h._emitter?(h._emitter.enable(!0,b),this._handle||(this._handle=setInterval(function(){return w._trackNativeMetrics()},b),this._handle.unref())):h._emitter&&(h._emitter.enable(!1),this._handle&&(clearInterval(this._handle),this._handle=void 0))}},h.prototype.dispose=function(){this.enable(!1)},h.parseEnabled=function(p){var g=process.env[o.ENV_nativeMetricsDisableAll],b=process.env[o.ENV_nativeMetricsDisablers];if(g)return{isEnabled:!1,disabledMetrics:{}};if(b){var w=b.split(","),y={};if(w.length>0)for(var S=0,C=w;S<C.length;S++){var T=C[S];y[T]=!0}return typeof p=="object"?{isEnabled:!0,disabledMetrics:x(x({},p),y)}:{isEnabled:p,disabledMetrics:y}}return typeof p=="boolean"?{isEnabled:p,disabledMetrics:{}}:{isEnabled:!0,disabledMetrics:p}},h.prototype._trackNativeMetrics=function(){var p=!0;typeof this._isEnabled!="object"&&(p=this._isEnabled),p&&(this._trackGarbageCollection(),this._trackEventLoop(),this._trackHeapUsage())},h.prototype._trackGarbageCollection=function(){var p;if(!this._disabledMetrics.gc){var g=h._emitter.getGCData();for(var b in g){var w=g[b].metrics,y=b+" Garbage Collection Duration",S=Math.sqrt(w.sumSquares/w.count-Math.pow(w.total/w.count,2))||0;this._client.trackMetric({name:y,value:w.total,count:w.count,max:w.max,min:w.min,stdDev:S,tagOverrides:(p={},p[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+c.sdkVersion,p)})}}},h.prototype._trackEventLoop=function(){var p;if(!this._disabledMetrics.loop){var g=h._emitter.getLoopData(),b=g.loopUsage;if(b.count!=0){var w="Event Loop CPU Time",y=Math.sqrt(b.sumSquares/b.count-Math.pow(b.total/b.count,2))||0;this._client.trackMetric({name:w,value:b.total,count:b.count,min:b.min,max:b.max,stdDev:y,tagOverrides:(p={},p[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+c.sdkVersion,p)})}}},h.prototype._trackHeapUsage=function(){var p,g,b;if(!this._disabledMetrics.heap){var w=process.memoryUsage(),y=w.heapUsed,S=w.heapTotal,C=w.rss;this._client.trackMetric({name:"Memory Usage (Heap)",value:y,count:1,tagOverrides:(p={},p[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+c.sdkVersion,p)}),this._client.trackMetric({name:"Memory Total (Heap)",value:S,count:1,tagOverrides:(g={},g[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+c.sdkVersion,g)}),this._client.trackMetric({name:"Memory Usage (Non-Heap)",value:C-S,count:1,tagOverrides:(b={},b[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+c.sdkVersion,b)})}},h}();s.AutoCollectNativePerformance=u}),Vl=k((s,x)=>{"use strict";var o=rt(),c=function(){function f(u,h,p,g){this._buffer=[],this._lastSend=0,this._isDisabled=u,this._getBatchSize=h,this._getBatchIntervalMs=p,this._sender=g}return f.prototype.setUseDiskRetryCaching=function(u,h,p){this._sender.setDiskRetryMode(u,h,p)},f.prototype.send=function(u){var h=this;if(!this._isDisabled()){if(!u){o.warn("Cannot send null/undefined telemetry");return}if(this._buffer.push(u),this._buffer.length>=this._getBatchSize()){this.triggerSend(!1);return}!this._timeoutHandle&&this._buffer.length>0&&(this._timeoutHandle=setTimeout(function(){h._timeoutHandle=null,h.triggerSend(!1)},this._getBatchIntervalMs()))}},f.prototype.triggerSend=function(u,h){var p=this._buffer.length<1;p||(u?(this._sender.saveOnCrash(this._buffer),typeof h=="function"&&h("data saved on crash")):this._sender.send(this._buffer,h)),this._lastSend=+new Date,this._buffer=[],clearTimeout(this._timeoutHandle),this._timeoutHandle=null,p&&typeof h=="function"&&h("no data to send")},f}();x.exports=c}),id=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.azureRoleEnvironmentTelemetryProcessor=void 0;function x(o,c){process.env.WEBSITE_SITE_NAME&&(o.tags[c.keys.cloudRole]=process.env.WEBSITE_SITE_NAME)}s.azureRoleEnvironmentTelemetryProcessor=x}),ca=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.getSamplingHashCode=s.samplingTelemetryProcessor=void 0;var x=Fr();function o(f,u){var h=f.sampleRate,p=!1;return h==null||h>=100||f.data&&x.TelemetryType.Metric===x.baseTypeToTelemetryType(f.data.baseType)?!0:(u.correlationContext&&u.correlationContext.operation?p=c(u.correlationContext.operation.id)<h:p=Math.random()*100<h,p)}s.samplingTelemetryProcessor=o;function c(f){var u=-2147483648,h=2147483647,p=5381;if(!f)return 0;for(;f.length<8;)f=f+f;for(var g=0;g<f.length;g++)p=((p<<5)+p|0)+f.charCodeAt(g)|0;return p=p<=u?h:Math.abs(p),p/h*100}s.getSamplingHashCode=c}),Kl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.performanceMetricsTelemetryProcessor=void 0;var x=ss(),o=Fr();function c(f,u){switch(u&&u.addDocument(f),f.data.baseType){case o.TelemetryTypeString.Exception:x.countException();break;case o.TelemetryTypeString.Request:var h=f.data.baseData;x.countRequest(h.duration,h.success);break;case o.TelemetryTypeString.Dependency:var p=f.data.baseData;x.countDependency(p.duration,p.success);break}return!0}s.performanceMetricsTelemetryProcessor=c}),_c=k(s=>{"use strict";var x=s&&s.__assign||function(){return x=Object.assign||function(h){for(var p,g=1,b=arguments.length;g<b;g++){p=arguments[g];for(var w in p)Object.prototype.hasOwnProperty.call(p,w)&&(h[w]=p[w])}return h},x.apply(this,arguments)};Object.defineProperty(s,"__esModule",{value:!0}),s.preAggregatedMetricsTelemetryProcessor=void 0;var o=Fr(),c=ls(),f=Fr();function u(h,p){if(c.isEnabled())switch(h.data.baseType){case f.TelemetryTypeString.Exception:var g=h.data.baseData;g.properties=x(x({},g.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Exceptions', Ver:'1.1')"});var b={cloudRoleInstance:h.tags[p.keys.cloudRoleInstance],cloudRoleName:h.tags[p.keys.cloudRole]};c.countException(b);break;case f.TelemetryTypeString.Trace:var w=h.data.baseData;w.properties=x(x({},w.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Traces', Ver:'1.1')"});var y={cloudRoleInstance:h.tags[p.keys.cloudRoleInstance],cloudRoleName:h.tags[p.keys.cloudRole],traceSeverityLevel:o.SeverityLevel[w.severity]};c.countTrace(y);break;case f.TelemetryTypeString.Request:var S=h.data.baseData;S.properties=x(x({},S.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Requests', Ver:'1.1')"});var C={cloudRoleInstance:h.tags[p.keys.cloudRoleInstance],cloudRoleName:h.tags[p.keys.cloudRole],operationSynthetic:h.tags[p.keys.operationSyntheticSource],requestSuccess:S.success,requestResultCode:S.responseCode};c.countRequest(S.duration,C);break;case f.TelemetryTypeString.Dependency:var T=h.data.baseData;T.properties=x(x({},T.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Dependencies', Ver:'1.1')"});var A={cloudRoleInstance:h.tags[p.keys.cloudRoleInstance],cloudRoleName:h.tags[p.keys.cloudRole],operationSynthetic:h.tags[p.keys.operationSyntheticSource],dependencySuccess:T.success,dependencyType:T.type,dependencyTarget:T.target,dependencyResultCode:T.resultCode};c.countDependency(T.duration,A);break}return!0}s.preAggregatedMetricsTelemetryProcessor=u}),la=k(s=>{"use strict";var x=s&&s.__createBinding||(Object.create?function(c,f,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return f[u]}})}:function(c,f,u,h){h===void 0&&(h=u),c[h]=f[u]}),o=s&&s.__exportStar||function(c,f){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(f,u)&&x(f,c,u)};Object.defineProperty(s,"__esModule",{value:!0}),o(id(),s),o(ca(),s),o(Kl(),s),o(_c(),s)}),ua=k((s,x)=>{"use strict";var o=s&&s.__awaiter||function(C,T,A,O){function D(q){return q instanceof A?q:new A(function(Q){Q(q)})}return new(A||(A=Promise))(function(q,Q){function V(me){try{pe(O.next(me))}catch(Se){Q(Se)}}function ie(me){try{pe(O.throw(me))}catch(Se){Q(Se)}}function pe(me){me.done?q(me.value):D(me.value).then(V,ie)}pe((O=O.apply(C,T||[])).next())})},c=s&&s.__generator||function(C,T){var A={label:0,sent:function(){if(q[0]&1)throw q[1];return q[1]},trys:[],ops:[]},O,D,q,Q;return Q={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(Q[Symbol.iterator]=function(){return this}),Q;function V(pe){return function(me){return ie([pe,me])}}function ie(pe){if(O)throw new TypeError("Generator is already executing.");for(;A;)try{if(O=1,D&&(q=pe[0]&2?D.return:pe[0]?D.throw||((q=D.return)&&q.call(D),0):D.next)&&!(q=q.call(D,pe[1])).done)return q;switch(D=0,q&&(pe=[pe[0]&2,q.value]),pe[0]){case 0:case 1:q=pe;break;case 4:return A.label++,{value:pe[1],done:!1};case 5:A.label++,D=pe[1],pe=[0];continue;case 7:pe=A.ops.pop(),A.trys.pop();continue;default:if(q=A.trys,!(q=q.length>0&&q[q.length-1])&&(pe[0]===6||pe[0]===2)){A=0;continue}if(pe[0]===3&&(!q||pe[1]>q[0]&&pe[1]<q[3])){A.label=pe[1];break}if(pe[0]===6&&A.label<q[1]){A.label=q[1],q=pe;break}if(q&&A.label<q[2]){A.label=q[2],A.ops.push(pe);break}q[2]&&A.ops.pop(),A.trys.pop();continue}pe=T.call(C,A)}catch(me){pe=[6,me],D=0}finally{O=q=0}if(pe[0]&5)throw pe[1];return{value:pe[0]?pe[1]:void 0,done:!0}}},f=H(7147),u=H(2037),h=H(1017),p=H(9796),g=H(2081),b=rt(),w=ci(),y=Lr(),S=function(){function C(T,A,O){if(this._redirectedHost=null,this._config=T,this._onSuccess=A,this._onError=O,this._enableDiskRetryMode=!1,this._resendInterval=C.WAIT_BETWEEN_RESEND,this._maxBytesOnDisk=C.MAX_BYTES_ON_DISK,this._numConsecutiveFailures=0,this._numConsecutiveRedirects=0,this._resendTimer=null,this._fileCleanupTimer=null,this._tempDir=h.join(u.tmpdir(),C.TEMPDIR_PREFIX+this._config.instrumentationKey),!C.OS_PROVIDES_FILE_PROTECTION)if(C.USE_ICACLS){try{C.OS_PROVIDES_FILE_PROTECTION=f.existsSync(C.ICACLS_PATH)}catch(D){}C.OS_PROVIDES_FILE_PROTECTION||b.warn(C.TAG,"Could not find ICACLS in expected location! This is necessary to use disk retry mode on Windows.")}else C.OS_PROVIDES_FILE_PROTECTION=!0}return C.prototype.setDiskRetryMode=function(T,A,O){var D=this;this._enableDiskRetryMode=C.OS_PROVIDES_FILE_PROTECTION&&T,typeof A=="number"&&A>=0&&(this._resendInterval=Math.floor(A)),typeof O=="number"&&O>=0&&(this._maxBytesOnDisk=Math.floor(O)),T&&!C.OS_PROVIDES_FILE_PROTECTION&&(this._enableDiskRetryMode=!1,b.warn(C.TAG,"Ignoring request to enable disk retry mode. Sufficient file protection capabilities were not detected.")),this._enableDiskRetryMode?this._fileCleanupTimer||(this._fileCleanupTimer=setTimeout(function(){D._fileCleanupTask()},C.CLEANUP_TIMEOUT),this._fileCleanupTimer.unref()):this._fileCleanupTimer&&clearTimeout(this._fileCleanupTimer)},C.prototype.send=function(T,A){return o(this,void 0,void 0,function(){var O,D,q,Q,V=this;return c(this,function(ie){return T&&(O=this._redirectedHost||this._config.endpointUrl,D={method:"POST",withCredentials:!1,headers:{"Content-Type":"application/x-json-stream"}},q="",T.forEach(function(pe){var me=V._stringify(pe);typeof me=="string"&&(q+=me+`
`)}),q.length>0&&(q=q.substring(0,q.length-1)),Q=Buffer.from?Buffer.from(q):new Buffer(q),p.gzip(Q,function(pe,me){var Se=me;pe?(b.warn(pe),Se=Q,D.headers["Content-Length"]=Q.length.toString()):(D.headers["Content-Encoding"]="gzip",D.headers["Content-Length"]=me.length.toString()),b.info(C.TAG,D),D[w.disableCollectionRequestOption]=!0;var He=function(ot){ot.setEncoding("utf-8");var mt="";ot.on("data",function(Nt){mt+=Nt}),ot.on("end",function(){if(V._numConsecutiveFailures=0,V._enableDiskRetryMode){if(ot.statusCode===200)V._resendTimer||(V._resendTimer=setTimeout(function(){V._resendTimer=null,V._sendFirstFileOnDisk()},V._resendInterval),V._resendTimer.unref());else if(V._isRetriable(ot.statusCode))try{var Nt=JSON.parse(mt),Pt=[];Nt.errors.forEach(function($t){V._isRetriable($t.statusCode)&&Pt.push(T[$t.index])}),Pt.length>0&&V._storeToDisk(Pt)}catch($t){V._storeToDisk(T)}}if(ot.statusCode===307||ot.statusCode===308)if(V._numConsecutiveRedirects++,V._numConsecutiveRedirects<10){var Zt=ot.headers.location?ot.headers.location.toString():null;Zt&&(V._redirectedHost=Zt,V.send(T,A))}else typeof A=="function"&&A("Error sending telemetry because of circular redirects.");else V._numConsecutiveRedirects=0,typeof A=="function"&&A(mt),b.info(C.TAG,mt),typeof V._onSuccess=="function"&&V._onSuccess(mt)})},ze=y.makeRequest(V._config,O,D,He);ze.on("error",function(ot){if(V._numConsecutiveFailures++,!V._enableDiskRetryMode||V._numConsecutiveFailures>0&&V._numConsecutiveFailures%C.MAX_CONNECTION_FAILURES_BEFORE_WARN==0){var mt="Ingestion endpoint could not be reached. This batch of telemetry items has been lost. Use Disk Retry Caching to enable resending of failed telemetry. Error:";V._enableDiskRetryMode&&(mt="Ingestion endpoint could not be reached "+V._numConsecutiveFailures+" consecutive times. There may be resulting telemetry loss. Most recent error:"),b.warn(C.TAG,mt,y.dumpObj(ot))}else{var mt="Transient failure to reach ingestion endpoint. This batch of telemetry items will be retried. Error:";b.info(C.TAG,mt,y.dumpObj(ot))}V._onErrorHelper(ot),typeof A=="function"&&(ot&&A(y.dumpObj(ot)),A("Error sending telemetry")),V._enableDiskRetryMode&&V._storeToDisk(T)}),ze.write(Se),ze.end()})),[2]})})},C.prototype.saveOnCrash=function(T){this._enableDiskRetryMode&&this._storeToDiskSync(this._stringify(T))},C.prototype._isRetriable=function(T){return T===206||T===408||T===429||T===439||T===500||T===503},C.prototype._runICACLS=function(T,A){var O=g.spawn(C.ICACLS_PATH,T,{windowsHide:!0});O.on("error",function(D){return A(D)}),O.on("close",function(D,q){return A(D===0?null:new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+D+")"))})},C.prototype._runICACLSSync=function(T){if(g.spawnSync){var A=g.spawnSync(C.ICACLS_PATH,T,{windowsHide:!0});if(A.error)throw A.error;if(A.status!==0)throw new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+A.status+")")}else throw new Error("Could not synchronously call ICACLS under current version of Node.js")},C.prototype._getACLIdentity=function(T){if(C.ACL_IDENTITY)return T(null,C.ACL_IDENTITY);var A=g.spawn(C.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]}),O="";A.stdout.on("data",function(D){return O+=D}),A.on("error",function(D){return T(D,null)}),A.on("close",function(D,q){return C.ACL_IDENTITY=O&&O.trim(),T(D===0?null:new Error("Getting ACL identity did not succeed (PS returned code "+D+")"),C.ACL_IDENTITY)})},C.prototype._getACLIdentitySync=function(){if(C.ACL_IDENTITY)return C.ACL_IDENTITY;if(g.spawnSync){var T=g.spawnSync(C.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]});if(T.error)throw T.error;if(T.status!==0)throw new Error("Getting ACL identity did not succeed (PS returned code "+T.status+")");return C.ACL_IDENTITY=T.stdout&&T.stdout.toString().trim(),C.ACL_IDENTITY}else throw new Error("Could not synchronously get ACL identity under current version of Node.js")},C.prototype._getACLArguments=function(T,A){return[T,"/grant","*S-1-5-32-544:(OI)(CI)F","/grant",A+":(OI)(CI)F","/inheritance:r"]},C.prototype._applyACLRules=function(T,A){var O=this;if(!C.USE_ICACLS)return A(null);if(C.ACLED_DIRECTORIES[T]===void 0)C.ACLED_DIRECTORIES[T]=!1,this._getACLIdentity(function(D,q){if(D)return C.ACLED_DIRECTORIES[T]=!1,A(D);O._runICACLS(O._getACLArguments(T,q),function(Q){return C.ACLED_DIRECTORIES[T]=!Q,A(Q)})});else return A(C.ACLED_DIRECTORIES[T]?null:new Error("Setting ACL restrictions did not succeed (cached result)"))},C.prototype._applyACLRulesSync=function(T){if(C.USE_ICACLS){if(C.ACLED_DIRECTORIES[T]===void 0){this._runICACLSSync(this._getACLArguments(T,this._getACLIdentitySync())),C.ACLED_DIRECTORIES[T]=!0;return}else if(!C.ACLED_DIRECTORIES[T])throw new Error("Setting ACL restrictions did not succeed (cached result)")}},C.prototype._confirmDirExists=function(T,A){var O=this;f.lstat(T,function(D,q){D&&D.code==="ENOENT"?f.mkdir(T,function(Q){Q&&Q.code!=="EEXIST"?A(Q):O._applyACLRules(T,A)}):!D&&q.isDirectory()?O._applyACLRules(T,A):A(D||new Error("Path existed but was not a directory"))})},C.prototype._getShallowDirectorySize=function(T,A){f.readdir(T,function(O,D){if(O)return A(O,-1);var q=null,Q=0,V=0;if(D.length===0){A(null,0);return}for(var ie=0;ie<D.length;ie++)f.stat(h.join(T,D[ie]),function(pe,me){V++,pe?q=pe:me.isFile()&&(Q+=me.size),V===D.length&&(q?A(q,-1):A(q,Q))})})},C.prototype._getShallowDirectorySizeSync=function(T){for(var A=f.readdirSync(T),O=0,D=0;D<A.length;D++)O+=f.statSync(h.join(T,A[D])).size;return O},C.prototype._storeToDisk=function(T){var A=this;b.info(C.TAG,"Checking existence of data storage directory: "+this._tempDir),this._confirmDirExists(this._tempDir,function(O){if(O){b.warn(C.TAG,"Error while checking/creating directory: "+(O&&O.message)),A._onErrorHelper(O);return}A._getShallowDirectorySize(A._tempDir,function(D,q){if(D||q<0){b.warn(C.TAG,"Error while checking directory size: "+(D&&D.message)),A._onErrorHelper(D);return}else if(q>A._maxBytesOnDisk){b.warn(C.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+q);return}var Q=new Date().getTime()+".ai.json",V=h.join(A._tempDir,Q);b.info(C.TAG,"saving data to disk at: "+V),f.writeFile(V,A._stringify(T),{mode:384},function(ie){return A._onErrorHelper(ie)})})})},C.prototype._storeToDiskSync=function(T){try{b.info(C.TAG,"Checking existence of data storage directory: "+this._tempDir),f.existsSync(this._tempDir)||f.mkdirSync(this._tempDir),this._applyACLRulesSync(this._tempDir);var A=this._getShallowDirectorySizeSync(this._tempDir);if(A>this._maxBytesOnDisk){b.info(C.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+A);return}var O=new Date().getTime()+".ai.json",D=h.join(this._tempDir,O);b.info(C.TAG,"saving data before crash to disk at: "+D),f.writeFileSync(D,T,{mode:384})}catch(q){b.warn(C.TAG,"Error while saving data to disk: "+(q&&q.message)),this._onErrorHelper(q)}},C.prototype._sendFirstFileOnDisk=function(){var T=this;f.exists(this._tempDir,function(A){A&&f.readdir(T._tempDir,function(O,D){if(O)T._onErrorHelper(O);else if(D=D.filter(function(V){return h.basename(V).indexOf(".ai.json")>-1}),D.length>0){var q=D[0],Q=h.join(T._tempDir,q);f.readFile(Q,function(V,ie){V?T._onErrorHelper(V):f.unlink(Q,function(pe){if(pe)T._onErrorHelper(pe);else try{var me=JSON.parse(ie.toString());T.send(me)}catch(Se){b.warn("Failed to read persisted file",Se)}})})}})})},C.prototype._onErrorHelper=function(T){typeof this._onError=="function"&&this._onError(T)},C.prototype._stringify=function(T){try{return JSON.stringify(T)}catch(A){b.warn("Failed to serialize payload",A,T)}},C.prototype._fileCleanupTask=function(){var T=this;f.exists(this._tempDir,function(A){A&&f.readdir(T._tempDir,function(O,D){O?T._onErrorHelper(O):(D=D.filter(function(q){return h.basename(q).indexOf(".ai.json")>-1}),D.length>0&&D.forEach(function(q){var Q=new Date(parseInt(q.split(".ai.json")[0])),V=new Date(+new Date-C.FILE_RETEMPTION_PERIOD)>Q;if(V){var ie=h.join(T._tempDir,q);f.unlink(ie,function(pe){pe&&T._onErrorHelper(pe)})}}))})})},C.TAG="Sender",C.ICACLS_PATH=process.env.systemdrive+"/windows/system32/icacls.exe",C.POWERSHELL_PATH=process.env.systemdrive+"/windows/system32/windowspowershell/v1.0/powershell.exe",C.ACLED_DIRECTORIES={},C.ACL_IDENTITY=null,C.WAIT_BETWEEN_RESEND=60*1e3,C.MAX_BYTES_ON_DISK=50*1024*1024,C.MAX_CONNECTION_FAILURES_BEFORE_WARN=5,C.CLEANUP_TIMEOUT=60*60*1e3,C.FILE_RETEMPTION_PERIOD=7*24*60*60*1e3,C.TEMPDIR_PREFIX="appInsights-node",C.OS_PROVIDES_FILE_PROTECTION=!1,C.USE_ICACLS=u.type()==="Windows_NT",C}();x.exports=S}),da=k((s,x)=>{"use strict";var o=Fr(),c=Lr(),f=Di(),u=function(){function p(){}return p.createEnvelope=function(g,b,w,y,S){var C=null;switch(b){case o.TelemetryType.Trace:C=p.createTraceData(g);break;case o.TelemetryType.Dependency:C=p.createDependencyData(g);break;case o.TelemetryType.Event:C=p.createEventData(g);break;case o.TelemetryType.Exception:C=p.createExceptionData(g);break;case o.TelemetryType.Request:C=p.createRequestData(g);break;case o.TelemetryType.Metric:C=p.createMetricData(g);break;case o.TelemetryType.Availability:C=p.createAvailabilityData(g);break;case o.TelemetryType.PageView:C=p.createPageViewData(g);break}if(w&&o.domainSupportsProperties(C.baseData)){if(C&&C.baseData)if(!C.baseData.properties)C.baseData.properties=w;else for(var T in w)C.baseData.properties[T]||(C.baseData.properties[T]=w[T]);C.baseData.properties=c.validateStringMap(C.baseData.properties)}var A=S&&S.instrumentationKey||"",O=new o.Envelope;return O.data=C,O.iKey=A,O.name="Microsoft.ApplicationInsights."+A.replace(/-/g,"")+"."+C.baseType.substr(0,C.baseType.length-4),O.tags=this.getTags(y,g.tagOverrides),O.time=new Date().toISOString(),O.ver=1,O.sampleRate=S?S.samplingPercentage:100,b===o.TelemetryType.Metric&&(O.sampleRate=100),O},p.createTraceData=function(g){var b=new o.MessageData;b.message=g.message,b.properties=g.properties,isNaN(g.severity)?b.severityLevel=o.SeverityLevel.Information:b.severityLevel=g.severity;var w=new o.Data;return w.baseType=o.telemetryTypeToBaseType(o.TelemetryType.Trace),w.baseData=b,w},p.createDependencyData=function(g){var b=new o.RemoteDependencyData;typeof g.name=="string"&&(b.name=g.name.length>1024?g.name.slice(0,1021)+"...":g.name),b.data=g.data,b.target=g.target,b.duration=c.msToTimeSpan(g.duration),b.success=g.success,b.type=g.dependencyTypeName,b.properties=g.properties,b.resultCode=g.resultCode?g.resultCode+"":"",g.id?b.id=g.id:b.id=c.w3cTraceId();var w=new o.Data;return w.baseType=o.telemetryTypeToBaseType(o.TelemetryType.Dependency),w.baseData=b,w},p.createEventData=function(g){var b=new o.EventData;b.name=g.name,b.properties=g.properties,b.measurements=g.measurements;var w=new o.Data;return w.baseType=o.telemetryTypeToBaseType(o.TelemetryType.Event),w.baseData=b,w},p.createExceptionData=function(g){var b=new o.ExceptionData;b.properties=g.properties,isNaN(g.severity)?b.severityLevel=o.SeverityLevel.Error:b.severityLevel=g.severity,b.measurements=g.measurements,b.exceptions=[];var w=g.exception.stack,y=new o.ExceptionDetails;y.message=g.exception.message,y.typeName=g.exception.name,y.parsedStack=this.parseStack(w),y.hasFullStack=c.isArray(y.parsedStack)&&y.parsedStack.length>0,b.exceptions.push(y);var S=new o.Data;return S.baseType=o.telemetryTypeToBaseType(o.TelemetryType.Exception),S.baseData=b,S},p.createRequestData=function(g){var b=new o.RequestData;g.id?b.id=g.id:b.id=c.w3cTraceId(),b.name=g.name,b.url=g.url,b.source=g.source,b.duration=c.msToTimeSpan(g.duration),b.responseCode=g.resultCode?g.resultCode+"":"",b.success=g.success,b.properties=g.properties;var w=new o.Data;return w.baseType=o.telemetryTypeToBaseType(o.TelemetryType.Request),w.baseData=b,w},p.createMetricData=function(g){var b=new o.MetricData;b.metrics=[];var w=new o.DataPoint;w.count=isNaN(g.count)?1:g.count,w.kind=o.DataPointType.Aggregation,w.max=isNaN(g.max)?g.value:g.max,w.min=isNaN(g.min)?g.value:g.min,w.name=g.name,w.stdDev=isNaN(g.stdDev)?0:g.stdDev,w.value=g.value,b.metrics.push(w),b.properties=g.properties;var y=new o.Data;return y.baseType=o.telemetryTypeToBaseType(o.TelemetryType.Metric),y.baseData=b,y},p.createAvailabilityData=function(g){var b=new o.AvailabilityData;g.id?b.id=g.id:b.id=c.w3cTraceId(),b.name=g.name,b.duration=c.msToTimeSpan(g.duration),b.success=g.success,b.runLocation=g.runLocation,b.message=g.message,b.measurements=g.measurements,b.properties=g.properties;var w=new o.Data;return w.baseType=o.telemetryTypeToBaseType(o.TelemetryType.Availability),w.baseData=b,w},p.createPageViewData=function(g){var b=new o.PageViewData;b.name=g.name,b.duration=c.msToTimeSpan(g.duration),b.url=g.url,b.measurements=g.measurements,b.properties=g.properties;var w=new o.Data;return w.baseType=o.telemetryTypeToBaseType(o.TelemetryType.PageView),w.baseData=b,w},p.getTags=function(g,b){var w=f.CorrelationContextManager.getCurrentContext(),y={};if(g&&g.tags)for(var S in g.tags)y[S]=g.tags[S];if(b)for(var S in b)y[S]=b[S];return w&&(y[g.keys.operationId]=y[g.keys.operationId]||w.operation.id,y[g.keys.operationName]=y[g.keys.operationName]||w.operation.name,y[g.keys.operationParentId]=y[g.keys.operationParentId]||w.operation.parentId),y},p.parseStack=function(g){var b=void 0;if(typeof g=="string"){var w=g.split(`
`);b=[];for(var y=0,S=0,C=0;C<=w.length;C++){var T=w[C];if(h.regex.test(T)){var A=new h(w[C],y++);S+=A.sizeInBytes,b.push(A)}}var O=32*1024;if(S>O)for(var D=0,q=b.length-1,Q=0,V=D,ie=q;D<q;){var pe=b[D].sizeInBytes,me=b[q].sizeInBytes;if(Q+=pe+me,Q>O){var Se=ie-V+1;b.splice(V,Se);break}V=D,ie=q,D++,q--}}return b},p}(),h=function(){function p(g,b){this.sizeInBytes=0,this.level=b,this.method="<no_method>",this.assembly=c.trim(g);var w=g.match(p.regex);w&&w.length>=5&&(this.method=c.trim(w[2])||this.method,this.fileName=c.trim(w[4])||"<no_filename>",this.line=parseInt(w[5])||0),this.sizeInBytes+=this.method.length,this.sizeInBytes+=this.fileName.length,this.sizeInBytes+=this.assembly.length,this.sizeInBytes+=p.baseSize,this.sizeInBytes+=this.level.toString().length,this.sizeInBytes+=this.line.toString().length}return p.regex=/^(\s+at)?(.*?)(\@|\s\(|\s)([^\(\n]+):(\d+):(\d+)(\)?)$/,p.baseSize=58,p}();x.exports=u}),ho=k((s,x)=>{"use strict";var o=H(7310),c=yc(),f=ki(),u=Fr(),h=Vl(),p=la(),g=Di(),b=ua(),w=Lr(),y=rt(),S=da(),C=function(){function T(A){this._telemetryProcessors=[],this._enableAzureProperties=!1;var O=new c(A);this.config=O,this.context=new f,this.commonProperties={};var D=new b(this.config);this.channel=new h(function(){return O.disableAppInsights},function(){return O.maxBatchSize},function(){return O.maxBatchIntervalMs},D)}return T.prototype.trackAvailability=function(A){this.track(A,u.TelemetryType.Availability)},T.prototype.trackPageView=function(A){this.track(A,u.TelemetryType.PageView)},T.prototype.trackTrace=function(A){this.track(A,u.TelemetryType.Trace)},T.prototype.trackMetric=function(A){this.track(A,u.TelemetryType.Metric)},T.prototype.trackException=function(A){A&&A.exception&&!w.isError(A.exception)&&(A.exception=new Error(A.exception.toString())),this.track(A,u.TelemetryType.Exception)},T.prototype.trackEvent=function(A){this.track(A,u.TelemetryType.Event)},T.prototype.trackRequest=function(A){this.track(A,u.TelemetryType.Request)},T.prototype.trackDependency=function(A){A&&!A.target&&A.data&&(A.target=o.parse(A.data).host),this.track(A,u.TelemetryType.Dependency)},T.prototype.flush=function(A){this.channel.triggerSend(A?!!A.isAppCrashing:!1,A?A.callback:void 0)},T.prototype.track=function(A,O){if(A&&u.telemetryTypeToBaseType(O)){var D=S.createEnvelope(A,O,this.commonProperties,this.context,this.config);A.time&&(D.time=A.time.toISOString()),this._enableAzureProperties&&p.azureRoleEnvironmentTelemetryProcessor(D,this.context);var q=this.runTelemetryProcessors(D,A.contextObjects);q=q&&p.samplingTelemetryProcessor(D,{correlationContext:g.CorrelationContextManager.getCurrentContext()}),p.preAggregatedMetricsTelemetryProcessor(D,this.context),q&&(p.performanceMetricsTelemetryProcessor(D,this.quickPulseClient),this.channel.send(D))}else y.warn("track() requires telemetry object and telemetryType to be specified.")},T.prototype.setAutoPopulateAzureProperties=function(A){this._enableAzureProperties=A},T.prototype.addTelemetryProcessor=function(A){this._telemetryProcessors.push(A)},T.prototype.clearTelemetryProcessors=function(){this._telemetryProcessors=[]},T.prototype.runTelemetryProcessors=function(A,O){var D=!0,q=this._telemetryProcessors.length;if(q===0)return D;O=O||{},O.correlationContext=g.CorrelationContextManager.getCurrentContext();for(var Q=0;Q<q;++Q)try{var V=this._telemetryProcessors[Q];if(V&&V.apply(null,[A,O])===!1){D=!1;break}}catch(ie){D=!0,y.warn("One of telemetry processors failed, telemetry item will be sent.",ie,A)}return D&&(A&&A.tags&&(A.tags=w.validateStringMap(A.tags)),A&&A.data&&A.data.baseData&&A.data.baseData.properties&&(A.data.baseData.properties=w.validateStringMap(A.data.baseData.properties))),D},T}();x.exports=C}),ha=k((s,x)=>{"use strict";var o=s&&s.__extends||function(){var g=function(b,w){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,S){y.__proto__=S}||function(y,S){for(var C in S)Object.prototype.hasOwnProperty.call(S,C)&&(y[C]=S[C])},g(b,w)};return function(b,w){g(b,w);function y(){this.constructor=b}b.prototype=w===null?Object.create(w):(y.prototype=w.prototype,new y)}}(),c=ho(),f=aa(),u=ci(),h=rt(),p=function(g){o(b,g);function b(){return g!==null&&g.apply(this,arguments)||this}return b.prototype.trackNodeHttpRequestSync=function(w){w&&w.request&&w.response&&w.duration?f.trackRequestSync(this,w):h.warn("trackNodeHttpRequestSync requires NodeHttpRequestTelemetry object with request, response and duration specified.")},b.prototype.trackNodeHttpRequest=function(w){(w.duration||w.error)&&h.warn("trackNodeHttpRequest will ignore supplied duration and error parameters. These values are collected from the request and response objects."),w&&w.request&&w.response?f.trackRequest(this,w):h.warn("trackNodeHttpRequest requires NodeHttpRequestTelemetry object with request and response specified.")},b.prototype.trackNodeHttpDependency=function(w){w&&w.request?u.trackRequest(this,w):h.warn("trackNodeHttpDependency requires NodeHttpDependencyTelemetry object with request specified.")},b}(c);x.exports=p}),Ql=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),Xl=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.dispose=s.Configuration=s.wrapWithCorrelationContext=s.startOperation=s.getCorrelationContext=s.start=s.setup=s.liveMetricsClient=s.defaultClient=s.DistributedTracingModes=void 0;var x=Di(),o=Wl(),c=fc(),f=ss(),u=ls(),h=oa(),p=ci(),g=aa(),b=pn(),w=rt(),y=mc(),S=Gl();s.TelemetryClient=ha(),s.Contracts=Fr(),s.azureFunctionsTypes=Ql();var C;(function(bt){bt[bt.AI=0]="AI",bt[bt.AI_AND_W3C=1]="AI_AND_W3C"})(C=s.DistributedTracingModes||(s.DistributedTracingModes={}));var T=!0,A=!1,O=!0,D=!0,q=!0,Q=!1,V=!0,ie=!0,pe=!0,me=!0,Se,He=!1,ze=!0,ot,mt=void 0,Nt=void 0,Pt,Zt,$t,Xe,at,Ne,ht,dt,jt=!1,wt;function er(bt){return s.defaultClient?w.info("The default client is already setup"):(s.defaultClient=new s.TelemetryClient(bt),Pt=new o(s.defaultClient),Zt=new c(s.defaultClient),$t=new f(s.defaultClient),Xe=new u(s.defaultClient),at=new h(s.defaultClient),ht=new g(s.defaultClient),dt=new p(s.defaultClient),Ne||(Ne=new S.AutoCollectNativePerformance(s.defaultClient))),s.defaultClient&&s.defaultClient.channel&&s.defaultClient.channel.setUseDiskRetryCaching(pe,mt,Nt),fr}s.setup=er;function hr(){return s.defaultClient?(jt=!0,Pt.enable(T,A),Zt.enable(O),$t.enable(D),Xe.enable(q),at.enable(Q,s.defaultClient.config),Ne.enable(ze,ot),ht.useAutoCorrelation(me,Se),ht.enable(V),dt.enable(ie),s.liveMetricsClient&&He&&s.liveMetricsClient.enable(He)):w.warn("Start cannot be called before setup"),fr}s.start=hr;function he(){return me?x.CorrelationContextManager.getCurrentContext():null}s.getCorrelationContext=he;function mr(bt,xt){return x.CorrelationContextManager.startOperation(bt,xt)}s.startOperation=mr;function Oe(bt,xt){return x.CorrelationContextManager.wrapCallback(bt,xt)}s.wrapWithCorrelationContext=Oe;var fr=function(){function bt(){}return bt.setDistributedTracingMode=function(xt){return b.w3cEnabled=xt===C.AI_AND_W3C,bt},bt.setAutoCollectConsole=function(xt,tr){return tr===void 0&&(tr=!1),T=xt,A=tr,jt&&Pt.enable(xt,tr),bt},bt.setAutoCollectExceptions=function(xt){return O=xt,jt&&Zt.enable(xt),bt},bt.setAutoCollectPerformance=function(xt,tr){tr===void 0&&(tr=!0),D=xt;var Sr=S.AutoCollectNativePerformance.parseEnabled(tr);return ze=Sr.isEnabled,ot=Sr.disabledMetrics,jt&&($t.enable(xt),Ne.enable(Sr.isEnabled,Sr.disabledMetrics)),bt},bt.setAutoCollectPreAggregatedMetrics=function(xt){return q=xt,jt&&Xe.enable(xt),bt},bt.setAutoCollectHeartbeat=function(xt){return Q=xt,jt&&at.enable(xt,s.defaultClient.config),bt},bt.setAutoCollectRequests=function(xt){return V=xt,jt&&ht.enable(xt),bt},bt.setAutoCollectDependencies=function(xt){return ie=xt,jt&&dt.enable(xt),bt},bt.setAutoDependencyCorrelation=function(xt,tr){return me=xt,Se=tr,jt&&ht.useAutoCorrelation(xt,tr),bt},bt.setUseDiskRetryCaching=function(xt,tr,Sr){return pe=xt,mt=tr,Nt=Sr,s.defaultClient&&s.defaultClient.channel&&s.defaultClient.channel.setUseDiskRetryCaching(xt,tr,Sr),bt},bt.setInternalLogging=function(xt,tr){return xt===void 0&&(xt=!1),tr===void 0&&(tr=!0),w.enableDebug=xt,w.disableWarnings=!tr,bt},bt.setSendLiveMetrics=function(xt){return xt===void 0&&(xt=!1),s.defaultClient?(!s.liveMetricsClient&&xt?(s.liveMetricsClient=new y(s.defaultClient.config,null),wt=new f(s.liveMetricsClient,1e3,!0),s.liveMetricsClient.addCollector(wt),s.defaultClient.quickPulseClient=s.liveMetricsClient):s.liveMetricsClient&&s.liveMetricsClient.enable(xt),He=xt,bt):(w.warn("Live metrics client cannot be setup without the default client"),bt)},bt.start=hr,bt}();s.Configuration=fr;function Hr(){b.w3cEnabled=!0,s.defaultClient=null,jt=!1,Pt&&Pt.dispose(),Zt&&Zt.dispose(),$t&&$t.dispose(),Xe&&Xe.dispose(),at&&at.dispose(),Ne&&Ne.dispose(),ht&&ht.dispose(),dt&&dt.dispose(),s.liveMetricsClient&&(s.liveMetricsClient.enable(!1),He=!1,s.liveMetricsClient=void 0)}s.dispose=Hr});X(F,{default:()=>hs});var ds=Qe(H(2037)),Bn=Qe(H(9496)),dr=Qe(H(9496)),fa=Qe(H(9496)),mn;(function(s){s.ON="on",s.ERROR="error",s.OFF="off"})(mn||(mn={}));function bc(){let s="telemetry",x="enableTelemetry";return fa.env.isTelemetryEnabled!==void 0?fa.env.isTelemetryEnabled?mn.ON:mn.OFF:fa.workspace.getConfiguration(s).get(x)?mn.ON:mn.OFF}var Yl=class{constructor(s,x,o,c,f){this.extensionId=s,this.extensionVersion=x,this.telemetryAppender=o,this.osShim=c,this.firstParty=!1,this.userOptIn=!1,this.errorOptIn=!1,this.disposables=[],this.firstParty=!!f,this.updateUserOptStatus(),dr.env.onDidChangeTelemetryEnabled!==void 0?(this.disposables.push(dr.env.onDidChangeTelemetryEnabled(()=>this.updateUserOptStatus())),this.disposables.push(dr.workspace.onDidChangeConfiguration(()=>this.updateUserOptStatus()))):this.disposables.push(dr.workspace.onDidChangeConfiguration(()=>this.updateUserOptStatus()))}updateUserOptStatus(){let s=bc();this.userOptIn=s===mn.ON,this.errorOptIn=s===mn.ERROR||s===mn.ON,(this.userOptIn||this.errorOptIn)&&this.telemetryAppender.instantiateAppender()}cleanRemoteName(s){if(!s)return"none";let x="other";return["ssh-remote","dev-container","attached-container","wsl"].forEach(o=>{s.indexOf(`${o}+`)===0&&(x=o)}),x}get extension(){return this._extension===void 0&&(this._extension=dr.extensions.getExtension(this.extensionId)),this._extension}cloneAndChange(s,x){if(s===null||typeof s!="object"||typeof x!="function")return s;let o={};for(let c in s)o[c]=x(c,s[c]);return o}shouldSendErrorTelemetry(){return this.errorOptIn===!1?!1:this.firstParty?this.cleanRemoteName(dr.env.remoteName)!=="other"?!0:!(this.extension===void 0||this.extension.extensionKind===dr.ExtensionKind.Workspace||dr.env.uiKind===dr.UIKind.Web):!0}getCommonProperties(){let s=Object.create(null);if(s["common.os"]=this.osShim.platform,s["common.platformversion"]=(this.osShim.release||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),s["common.extname"]=this.extensionId,s["common.extversion"]=this.extensionVersion,dr&&dr.env){switch(s["common.vscodemachineid"]=dr.env.machineId,s["common.vscodesessionid"]=dr.env.sessionId,s["common.vscodeversion"]=dr.version,s["common.isnewappinstall"]=dr.env.isNewAppInstall?dr.env.isNewAppInstall.toString():"false",s["common.product"]=dr.env.appHost,dr.env.uiKind){case dr.UIKind.Web:s["common.uikind"]="web";break;case dr.UIKind.Desktop:s["common.uikind"]="desktop";break;default:s["common.uikind"]="unknown"}s["common.remotename"]=this.cleanRemoteName(dr.env.remoteName)}return s}anonymizeFilePaths(s,x){let o;if(s==null)return"";let c=[];dr.env.appRoot!==""&&c.push(new RegExp(dr.env.appRoot.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi")),this.extension&&c.push(new RegExp(this.extension.extensionPath.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"));let f=s;if(x){let u=[];for(let b of c)for(;(o=b.exec(s))&&o;)u.push([o.index,b.lastIndex]);let h=/^[\\/]?(node_modules|node_modules\.asar)[\\/]/,p=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-._]+(\\\\|\\|\/))+[\w-._]*/g,g=0;for(f="";(o=p.exec(s))&&o;)o[0]&&!h.test(o[0])&&u.every(([b,w])=>o.index<b||o.index>=w)&&(f+=s.substring(g,o.index)+"<REDACTED: user-file-path>",g=p.lastIndex);g<s.length&&(f+=s.substr(g))}for(let u of c)f=f.replace(u,"");return f}removePropertiesWithPossibleUserInfo(s){if(typeof s!="object")return;let x=Object.create(null);for(let o of Object.keys(s)){let c=s[o];if(!c)continue;let f=/@[a-zA-Z0-9-.]+/;/\S*(key|token|sig|password|passwd|pwd)[="':\s]+\S*/.test(c.toLowerCase())?x[o]="<REDACTED: secret>":f.test(c)?x[o]="<REDACTED: email>":x[o]=c}return x}sendTelemetryEvent(s,x,o){if(this.userOptIn&&s!==""){x=G(G({},x),this.getCommonProperties());let c=this.cloneAndChange(x,(f,u)=>this.anonymizeFilePaths(u,this.firstParty));this.telemetryAppender.logEvent(`${this.extensionId}/${s}`,{properties:this.removePropertiesWithPossibleUserInfo(c),measurements:o})}}sendTelemetryErrorEvent(s,x,o,c){if(this.errorOptIn&&s!==""){x=G(G({},x),this.getCommonProperties());let f=this.cloneAndChange(x,(u,h)=>this.shouldSendErrorTelemetry()?this.anonymizeFilePaths(h,this.firstParty):c===void 0||c.indexOf(u)!==-1?"REDACTED":this.anonymizeFilePaths(h,this.firstParty));this.telemetryAppender.logEvent(`${this.extensionId}/${s}`,{properties:this.removePropertiesWithPossibleUserInfo(f),measurements:o})}}sendTelemetryException(s,x,o){if(this.shouldSendErrorTelemetry()&&this.errorOptIn&&s){x=G(G({},x),this.getCommonProperties());let c=this.cloneAndChange(x,(f,u)=>this.anonymizeFilePaths(u,this.firstParty));s.stack&&(s.stack=this.anonymizeFilePaths(s.stack,this.firstParty)),this.telemetryAppender.logException(s,{properties:this.removePropertiesWithPossibleUserInfo(c),measurements:o})}}dispose(){return this.telemetryAppender.flush(),Promise.all(this.disposables.map(s=>s.dispose()))}},Zl=class{constructor(s){this._key=s,this._isInstantiated=!1,bc()!==mn.OFF&&this.instantiateAppender()}logEvent(s,x){!this._appInsightsClient||this._appInsightsClient.trackEvent({name:s,properties:x==null?void 0:x.properties,measurements:x==null?void 0:x.measurements})}logException(s,x){!this._appInsightsClient||this._appInsightsClient.trackException({exception:s,properties:x==null?void 0:x.properties,measurements:x==null?void 0:x.measurements})}flush(){return this._appInsightsClient&&(this._appInsightsClient.flush(),this._appInsightsClient=void 0),Promise.resolve(void 0)}instantiateAppender(){this._isInstantiated||Promise.resolve().then(()=>Qe(Xl())).then(s=>{s.defaultClient?(this._appInsightsClient=new s.TelemetryClient(this._key),this._appInsightsClient.channel.setUseDiskRetryCaching(!0)):(s.setup(this._key).setAutoCollectRequests(!1).setAutoCollectPerformance(!1).setAutoCollectExceptions(!1).setAutoCollectDependencies(!1).setAutoDependencyCorrelation(!1).setAutoCollectConsole(!1).setUseDiskRetryCaching(!0).start(),this._appInsightsClient=s.defaultClient),Bn&&Bn.env&&(this._appInsightsClient.context.tags[this._appInsightsClient.context.keys.userId]=Bn.env.machineId,this._appInsightsClient.context.tags[this._appInsightsClient.context.keys.sessionId]=Bn.env.sessionId,this._appInsightsClient.context.tags[this._appInsightsClient.context.keys.cloudRole]=Bn.env.appName,this._appInsightsClient.context.tags[this._appInsightsClient.context.keys.cloudRoleInstance]=Bn.env.appName),this._key&&this._key.indexOf("AIF-")===0&&(this._appInsightsClient.config.endpointUrl="https://vortex.data.microsoft.com/collect/v1"),this._isInstantiated=!0})}},hs=class extends Yl{constructor(s,x,o,c){let f=new Zl(o);o&&o.indexOf("AIF-")===0&&(c=!0);super(s,x,f,{release:ds.release(),platform:ds.platform()},c)}}},3255:_=>{function F(H){var $=new Error("Cannot find module '"+H+"'");throw $.code="MODULE_NOT_FOUND",$}F.keys=()=>[],F.resolve=F,F.id=3255,_.exports=F},9118:_=>{function F(H){var $=new Error("Cannot find module '"+H+"'");throw $.code="MODULE_NOT_FOUND",$}F.keys=()=>[],F.resolve=F,F.id=9118,_.exports=F},800:(_,F,H)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0}),F.config=F.loadMessageBundle=F.localize=F.format=F.setPseudo=F.isPseudo=F.isDefined=F.BundleFormat=F.MessageFormat=void 0;var $=H(1926),W;(function(le){le.file="file",le.bundle="bundle",le.both="both"})(W=F.MessageFormat||(F.MessageFormat={}));var ne;(function(le){le.standalone="standalone",le.languagePack="languagePack"})(ne=F.BundleFormat||(F.BundleFormat={}));var re;(function(le){function k(X){var Ge=X;return Ge&&se(Ge.key)&&se(Ge.comment)}le.is=k})(re||(re={}));function se(le){return typeof le!="undefined"}F.isDefined=se,F.isPseudo=!1;function oe(le){F.isPseudo=le}F.setPseudo=oe;function z(le,k){var X;return F.isPseudo&&(le="\uFF3B"+le.replace(/[aouei]/g,"$&$&")+"\uFF3D"),k.length===0?X=le:X=le.replace(/\{(\d+)\}/g,function(Ge,Qe){var rt=Qe[0],ye=k[rt],_e=Ge;return typeof ye=="string"?_e=ye:(typeof ye=="number"||typeof ye=="boolean"||ye===void 0||ye===null)&&(_e=String(ye)),_e}),X}F.format=z;function U(le,k){for(var X=[],Ge=2;Ge<arguments.length;Ge++)X[Ge-2]=arguments[Ge];return z(k,X)}F.localize=U;function L(le){return $.default().loadMessageBundle(le)}F.loadMessageBundle=L;function G(le){return $.default().config(le)}F.config=G},1926:(_,F)=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});var H;function $(){if(H===void 0)throw new Error("No runtime abstraction layer installed");return H}(function(W){function ne(re){if(re===void 0)throw new Error("No runtime abstraction layer provided");H=re}W.install=ne})($||($={})),F.default=$},8472:(_,F,H)=>{"use strict";var $;$={value:!0},$=F.loadMessageBundle=void 0;var W=H(1017),ne=H(7147),re=H(1926),se=H(800),oe=H(800);$={enumerable:!0,get:function(){return oe.MessageFormat}},$={enumerable:!0,get:function(){return oe.BundleFormat}};var z=Object.prototype.toString;function U(ve){return z.call(ve)==="[object Number]"}function L(ve){return z.call(ve)==="[object String]"}function G(ve){return ve===!0||ve===!1}function le(ve){return JSON.parse(ne.readFileSync(ve,"utf8"))}var k,X;function Ge(){if(X={locale:void 0,language:void 0,languagePackSupport:!1,cacheLanguageResolution:!0,messageFormat:se.MessageFormat.bundle},L(process.env.VSCODE_NLS_CONFIG))try{var ve=JSON.parse(process.env.VSCODE_NLS_CONFIG),je=void 0;if(ve.availableLanguages){var Ke=ve.availableLanguages["*"];L(Ke)&&(je=Ke)}if(L(ve.locale)&&(X.locale=ve.locale.toLowerCase()),je===void 0?X.language=X.locale:je!=="en"&&(X.language=je),G(ve._languagePackSupport)&&(X.languagePackSupport=ve._languagePackSupport),L(ve._cacheRoot)&&(X.cacheRoot=ve._cacheRoot),L(ve._languagePackId)&&(X.languagePackId=ve._languagePackId),L(ve._translationsConfigFile)){X.translationsConfigFile=ve._translationsConfigFile;try{X.translationsConfig=le(X.translationsConfigFile)}catch(Ue){if(ve._corruptedFile){var We=W.dirname(ve._corruptedFile);ne.exists(We,function(ut){ut&&ne.writeFile(ve._corruptedFile,"corrupted","utf8",function(gt){console.error(gt)})})}}}}catch(Ue){}se.setPseudo(X.locale==="pseudo"),k=Object.create(null)}Ge();function Qe(){return X.languagePackSupport===!0&&X.cacheRoot!==void 0&&X.languagePackId!==void 0&&X.translationsConfigFile!==void 0&&X.translationsConfig!==void 0}function rt(ve){return function(je,Ke){for(var We=[],Ue=2;Ue<arguments.length;Ue++)We[Ue-2]=arguments[Ue];if(U(je)){if(je>=ve.length){console.error(`Broken localize call found. Index out of bounds. Stacktrace is
: `+new Error("").stack);return}return se.format(ve[je],We)}else{if(L(Ke))return console.warn("Message "+Ke+" didn't get externalized correctly."),se.format(Ke,We);console.error(`Broken localize call found. Stacktrace is
: `+new Error("").stack)}}}function ye(ve){var je;if(X.cacheLanguageResolution&&je)je=je;else{if(se.isPseudo||!X.language)je=".nls.json";else for(var Ke=X.language;Ke;){var We=".nls."+Ke+".json";if(ne.existsSync(ve+We)){je=We;break}else{var Ue=Ke.lastIndexOf("-");Ue>0?Ke=Ke.substring(0,Ue):(je=".nls.json",Ke=null)}}X.cacheLanguageResolution&&(je=je)}return ve+je}function _e(ve){for(var je=X.language;je;){var Ke=W.join(ve,"nls.bundle."+je+".json");if(ne.existsSync(Ke))return Ke;var We=je.lastIndexOf("-");We>0?je=je.substring(0,We):je=void 0}if(je===void 0){var Ke=W.join(ve,"nls.bundle.json");if(ne.existsSync(Ke))return Ke}}function be(ve){try{ne.mkdirSync(ve)}catch(Ke){if(Ke.code==="EEXIST")return;if(Ke.code==="ENOENT"){var je=W.dirname(ve);je!==ve&&(be(je),ne.mkdirSync(ve))}else throw Ke}}function ae(ve){var je=le(W.join(ve,"nls.metadata.json")),Ke=Object.create(null);for(var We in je){var Ue=je[We];Ke[We]=Ue.messages}return Ke}function ue(ve,je){var Ke=X.translationsConfig[ve.id];if(!!Ke){var We=le(Ke).contents,Ue=le(W.join(je,"nls.metadata.json")),ut=Object.create(null);for(var gt in Ue){var _t=Ue[gt],Ce=We[ve.outDir+"/"+gt];if(Ce){for(var Rt=[],Ct=0;Ct<_t.keys.length;Ct++){var It=_t.keys[Ct],ke=L(It)?It:It.key,Pe=Ce[ke];Pe===void 0&&(Pe=_t.messages[Ct]),Rt.push(Pe)}ut[gt]=Rt}else ut[gt]=_t.messages}return ut}}function we(ve){var je=new Date;ne.utimes(ve,je,je,function(){})}function Re(ve,je){return k[ve]=je,je}function Ee(ve,je){var Ke,We=W.join(X.cacheRoot,ve.id+"-"+ve.hash+".json"),Ue=!1,ut=!1;try{return Ke=JSON.parse(ne.readFileSync(We,{encoding:"utf8",flag:"r"})),we(We),Ke}catch(gt){if(gt.code==="ENOENT")ut=!0;else if(gt instanceof SyntaxError)console.log("Syntax error parsing message bundle: "+gt.message+"."),ne.unlink(We,function(_t){_t&&console.error("Deleting corrupted bundle "+We+" failed.")}),Ue=!0;else throw gt}if(Ke=ue(ve,je),!Ke||Ue)return Ke;if(ut)try{ne.writeFileSync(We,JSON.stringify(Ke),{encoding:"utf8",flag:"wx"})}catch(gt){if(gt.code==="EEXIST")return Ke;throw gt}return Ke}function Ie(ve){try{return ae(ve)}catch(je){console.log("Generating default bundle from meta data failed.",je);return}}function Fe(ve,je){var Ke;if(Qe())try{Ke=Ee(ve,je)}catch(Ue){console.log("Load or create bundle failed ",Ue)}if(!Ke){if(X.languagePackSupport)return Ie(je);var We=_e(je);if(We)try{return le(We)}catch(Ue){console.log("Loading in the box message bundle failed.",Ue)}Ke=Ie(je)}return Ke}function Ve(ve){for(var je,Ke=W.dirname(ve);je=W.join(Ke,"nls.metadata.header.json"),!ne.existsSync(je);){var We=W.dirname(Ke);if(We===Ke){je=void 0;break}else Ke=We}return je}function it(ve){if(!ve)return se.localize;var je=W.extname(ve);if(je&&(ve=ve.substr(0,ve.length-je.length)),X.messageFormat===se.MessageFormat.both||X.messageFormat===se.MessageFormat.bundle){var Ke=Ve(ve);if(Ke){var We=W.dirname(Ke),Ue=k[We];if(Ue===void 0)try{var ut=JSON.parse(ne.readFileSync(Ke,"utf8"));try{var gt=Fe(ut,We);Ue=Re(We,gt?{header:ut,nlsBundle:gt}:null)}catch(Ct){console.error("Failed to load nls bundle",Ct),Ue=Re(We,null)}}catch(Ct){console.error("Failed to read header file",Ct),Ue=Re(We,null)}if(Ue){var _t=ve.substr(We.length+1).replace(/\\/g,"/"),Ce=Ue.nlsBundle[_t];return Ce===void 0?(console.error("Messages for file "+ve+" not found. See console for details."),function(){return"Messages not found."}):rt(Ce)}}}if(X.messageFormat===se.MessageFormat.both||X.messageFormat===se.MessageFormat.file)try{var Rt=le(ye(ve));return Array.isArray(Rt)?rt(Rt):se.isDefined(Rt.messages)&&se.isDefined(Rt.keys)?rt(Rt.messages):(console.error("String bundle '"+ve+"' uses an unsupported format."),function(){return"File bundle has unsupported format. See console for details"})}catch(Ct){Ct.code!=="ENOENT"&&console.error("Failed to load single file bundle",Ct)}return console.error("Failed to load message bundle for file "+ve),function(){return"Failed to load message bundle. See console for details."}}F.loadMessageBundle=it;function lt(ve){return ve&&(L(ve.locale)&&(X.locale=ve.locale.toLowerCase(),X.language=X.locale,k=Object.create(null)),ve.messageFormat!==void 0&&(X.messageFormat=ve.messageFormat),ve.bundleFormat===se.BundleFormat.standalone&&X.languagePackSupport===!0&&(X.languagePackSupport=!1)),se.setPseudo(X.locale==="pseudo"),it}$=lt,re.default.install(Object.freeze({loadMessageBundle:it,config:lt}))},6822:(_,F,H)=>{"use strict";_.exports=H(8472)},2660:function(_,F){(function(H,$){$(F)})(this,function(H){"use strict";const $=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:o=>`Symbol(${o})`;function W(){}function ne(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global}const re=ne();function se(o){return typeof o=="object"&&o!==null||typeof o=="function"}const oe=W,z=Promise,U=Promise.prototype.then,L=Promise.resolve.bind(z),G=Promise.reject.bind(z);function le(o){return new z(o)}function k(o){return L(o)}function X(o){return G(o)}function Ge(o,c,f){return U.call(o,c,f)}function Qe(o,c,f){Ge(Ge(o,c,f),void 0,oe)}function rt(o,c){Qe(o,c)}function ye(o,c){Qe(o,void 0,c)}function _e(o,c,f){return Ge(o,c,f)}function be(o){Ge(o,void 0,oe)}const ae=(()=>{const o=re&&re.queueMicrotask;if(typeof o=="function")return o;const c=k(void 0);return f=>Ge(c,f)})();function ue(o,c,f){if(typeof o!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(o,c,f)}function we(o,c,f){try{return k(ue(o,c,f))}catch(u){return X(u)}}const Re=16384;class Ee{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(c){const f=this._back;let u=f;f._elements.length===Re-1&&(u={_elements:[],_next:void 0}),f._elements.push(c),u!==f&&(this._back=u,f._next=u),++this._size}shift(){const c=this._front;let f=c;const u=this._cursor;let h=u+1;const p=c._elements,g=p[u];return h===Re&&(f=c._next,h=0),--this._size,this._cursor=h,c!==f&&(this._front=f),p[u]=void 0,g}forEach(c){let f=this._cursor,u=this._front,h=u._elements;for(;(f!==h.length||u._next!==void 0)&&!(f===h.length&&(u=u._next,h=u._elements,f=0,h.length===0));)c(h[f]),++f}peek(){const c=this._front,f=this._cursor;return c._elements[f]}}function Ie(o,c){o._ownerReadableStream=c,c._reader=o,c._state==="readable"?lt(o):c._state==="closed"?je(o):ve(o,c._storedError)}function Fe(o,c){const f=o._ownerReadableStream;return Or(f,c)}function Ve(o){o._ownerReadableStream._state==="readable"?Ke(o,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):We(o,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),o._ownerReadableStream._reader=void 0,o._ownerReadableStream=void 0}function it(o){return new TypeError("Cannot "+o+" a stream using a released reader")}function lt(o){o._closedPromise=le((c,f)=>{o._closedPromise_resolve=c,o._closedPromise_reject=f})}function ve(o,c){lt(o),Ke(o,c)}function je(o){lt(o),Ue(o)}function Ke(o,c){o._closedPromise_reject!==void 0&&(be(o._closedPromise),o._closedPromise_reject(c),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0)}function We(o,c){ve(o,c)}function Ue(o){o._closedPromise_resolve!==void 0&&(o._closedPromise_resolve(void 0),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0)}const ut=$("[[AbortSteps]]"),gt=$("[[ErrorSteps]]"),_t=$("[[CancelSteps]]"),Ce=$("[[PullSteps]]"),Rt=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},Ct=Math.trunc||function(o){return o<0?Math.ceil(o):Math.floor(o)};function It(o){return typeof o=="object"||typeof o=="function"}function ke(o,c){if(o!==void 0&&!It(o))throw new TypeError(`${c} is not an object.`)}function Pe(o,c){if(typeof o!="function")throw new TypeError(`${c} is not a function.`)}function vt(o){return typeof o=="object"&&o!==null||typeof o=="function"}function Tt(o,c){if(!vt(o))throw new TypeError(`${c} is not an object.`)}function kt(o,c,f){if(o===void 0)throw new TypeError(`Parameter ${c} is required in '${f}'.`)}function Tr(o,c,f){if(o===void 0)throw new TypeError(`${c} is required in '${f}'.`)}function Yt(o){return Number(o)}function lr(o){return o===0?0:o}function Qn(o){return lr(Ct(o))}function Mr(o,c){const f=0,u=Number.MAX_SAFE_INTEGER;let h=Number(o);if(h=lr(h),!Rt(h))throw new TypeError(`${c} is not a finite number`);if(h=Qn(h),h<f||h>u)throw new TypeError(`${c} is outside the accepted range of ${f} to ${u}, inclusive`);return!Rt(h)||h===0?0:h}function _r(o,c){if(!$n(o))throw new TypeError(`${c} is not a ReadableStream.`)}function St(o){return new tt(o)}function or(o,c){o._reader._readRequests.push(c)}function Xn(o,c,f){const h=o._reader._readRequests.shift();f?h._closeSteps():h._chunkSteps(c)}function st(o){return o._reader._readRequests.length}function zt(o){const c=o._reader;return!(c===void 0||!At(c))}class tt{constructor(c){if(kt(c,1,"ReadableStreamDefaultReader"),_r(c,"First parameter"),Rn(c))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Ie(this,c),this._readRequests=new Ee}get closed(){return At(this)?this._closedPromise:X(br("closed"))}cancel(c=void 0){return At(this)?this._ownerReadableStream===void 0?X(it("cancel")):Fe(this,c):X(br("cancel"))}read(){if(!At(this))return X(br("read"));if(this._ownerReadableStream===void 0)return X(it("read from"));let c,f;const u=le((p,g)=>{c=p,f=g});return Kt(this,{_chunkSteps:p=>c({value:p,done:!1}),_closeSteps:()=>c({value:void 0,done:!0}),_errorSteps:p=>f(p)}),u}releaseLock(){if(!At(this))throw br("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Ve(this)}}}Object.defineProperties(tt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(tt.prototype,$.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function At(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_readRequests")?!1:o instanceof tt}function Kt(o,c){const f=o._ownerReadableStream;f._disturbed=!0,f._state==="closed"?c._closeSteps():f._state==="errored"?c._errorSteps(f._storedError):f._readableStreamController[Ce](c)}function br(o){return new TypeError(`ReadableStreamDefaultReader.prototype.${o} can only be used on a ReadableStreamDefaultReader`)}const ur=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class En{constructor(c,f){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=c,this._preventCancel=f}next(){const c=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?_e(this._ongoingPromise,c,c):c(),this._ongoingPromise}return(c){const f=()=>this._returnSteps(c);return this._ongoingPromise?_e(this._ongoingPromise,f,f):f()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});const c=this._reader;if(c._ownerReadableStream===void 0)return X(it("iterate"));let f,u;const h=le((g,b)=>{f=g,u=b});return Kt(c,{_chunkSteps:g=>{this._ongoingPromise=void 0,ae(()=>f({value:g,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,Ve(c),f({value:void 0,done:!0})},_errorSteps:g=>{this._ongoingPromise=void 0,this._isFinished=!0,Ve(c),u(g)}}),h}_returnSteps(c){if(this._isFinished)return Promise.resolve({value:c,done:!0});this._isFinished=!0;const f=this._reader;if(f._ownerReadableStream===void 0)return X(it("finish iterating"));if(!this._preventCancel){const u=Fe(f,c);return Ve(f),_e(u,()=>({value:c,done:!0}))}return Ve(f),k({value:c,done:!0})}}const Cn={next(){return Fs(this)?this._asyncIteratorImpl.next():X($s("next"))},return(o){return Fs(this)?this._asyncIteratorImpl.return(o):X($s("return"))}};ur!==void 0&&Object.setPrototypeOf(Cn,ur);function Ls(o,c){const f=St(o),u=new En(f,c),h=Object.create(Cn);return h._asyncIteratorImpl=u,h}function Fs(o){if(!se(o)||!Object.prototype.hasOwnProperty.call(o,"_asyncIteratorImpl"))return!1;try{return o._asyncIteratorImpl instanceof En}catch(c){return!1}}function $s(o){return new TypeError(`ReadableStreamAsyncIterator.${o} can only be used on a ReadableSteamAsyncIterator`)}const Bs=Number.isNaN||function(o){return o!==o};function Xt(o){return o.slice()}function Bo(o,c,f,u,h){new Uint8Array(o).set(new Uint8Array(f,u,h),c)}function Qr(o){return o}function Yi(o){return!1}function Hs(o,c,f){if(o.slice)return o.slice(c,f);const u=f-c,h=new ArrayBuffer(u);return Bo(h,0,o,c,u),h}function nl(o){return!(typeof o!="number"||Bs(o)||o<0)}function $a(o){const c=Hs(o.buffer,o.byteOffset,o.byteOffset+o.byteLength);return new Uint8Array(c)}function Ho(o){const c=o._queue.shift();return o._queueTotalSize-=c.size,o._queueTotalSize<0&&(o._queueTotalSize=0),c.value}function Uo(o,c,f){if(!nl(f)||f===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");o._queue.push({value:c,size:f}),o._queueTotalSize+=f}function Us(o){return o._queue.peek().value}function Nn(o){o._queue=new Ee,o._queueTotalSize=0}class Zi{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Ji(this))throw Go("view");return this._view}respond(c){if(!Ji(this))throw Go("respond");if(kt(c,1,"respond"),c=Mr(c,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");Yi(this._view.buffer),ro(this._associatedReadableByteStreamController,c)}respondWithNewView(c){if(!Ji(this))throw Go("respondWithNewView");if(kt(c,1,"respondWithNewView"),!ArrayBuffer.isView(c))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");Yi(c.buffer),Wo(this._associatedReadableByteStreamController,c)}}Object.defineProperties(Zi.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(Zi.prototype,$.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Ci{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Yn(this))throw Mn("byobRequest");return Ba(this)}get desiredSize(){if(!Yn(this))throw Mn("desiredSize");return Jn(this)}close(){if(!Yn(this))throw Mn("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");const c=this._controlledReadableByteStream._state;if(c!=="readable")throw new TypeError(`The stream (in ${c} state) is not in the readable state and cannot be closed`);eo(this)}enqueue(c){if(!Yn(this))throw Mn("enqueue");if(kt(c,1,"enqueue"),!ArrayBuffer.isView(c))throw new TypeError("chunk must be an array buffer view");if(c.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(c.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");const f=this._controlledReadableByteStream._state;if(f!=="readable")throw new TypeError(`The stream (in ${f} state) is not in the readable state and cannot be enqueued to`);to(this,c)}error(c=void 0){if(!Yn(this))throw Mn("error");Zr(this,c)}[_t](c){js(this),Nn(this);const f=this._cancelAlgorithm(c);return zo(this),f}[Ce](c){const f=this._controlledReadableByteStream;if(this._queueTotalSize>0){const h=this._queue.shift();this._queueTotalSize-=h.byteLength,Gs(this);const p=new Uint8Array(h.buffer,h.byteOffset,h.byteLength);c._chunkSteps(p);return}const u=this._autoAllocateChunkSize;if(u!==void 0){let h;try{h=new ArrayBuffer(u)}catch(g){c._errorSteps(g);return}const p={buffer:h,bufferByteLength:u,byteOffset:0,byteLength:u,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(p)}or(f,c),Xr(this)}}Object.defineProperties(Ci.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(Ci.prototype,$.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Yn(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledReadableByteStream")?!1:o instanceof Ci}function Ji(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_associatedReadableByteStreamController")?!1:o instanceof Zi}function Xr(o){if(!sl(o))return;if(o._pulling){o._pullAgain=!0;return}o._pulling=!0;const f=o._pullAlgorithm();Qe(f,()=>{o._pulling=!1,o._pullAgain&&(o._pullAgain=!1,Xr(o))},u=>{Zr(o,u)})}function js(o){jo(o),o._pendingPullIntos=new Ee}function Zn(o,c){let f=!1;o._state==="closed"&&(f=!0);const u=qs(c);c.readerType==="default"?Xn(o,u,f):ll(o,u,f)}function qs(o){const c=o.bytesFilled,f=o.elementSize;return new o.viewConstructor(o.buffer,o.byteOffset,c/f)}function Yr(o,c,f,u){o._queue.push({buffer:c,byteOffset:f,byteLength:u}),o._queueTotalSize+=u}function zs(o,c){const f=c.elementSize,u=c.bytesFilled-c.bytesFilled%f,h=Math.min(o._queueTotalSize,c.byteLength-c.bytesFilled),p=c.bytesFilled+h,g=p-p%f;let b=h,w=!1;g>u&&(b=g-c.bytesFilled,w=!0);const y=o._queue;for(;b>0;){const S=y.peek(),C=Math.min(b,S.byteLength),T=c.byteOffset+c.bytesFilled;Bo(c.buffer,T,S.buffer,S.byteOffset,C),S.byteLength===C?y.shift():(S.byteOffset+=C,S.byteLength-=C),o._queueTotalSize-=C,Ws(o,C,c),b-=C}return w}function Ws(o,c,f){f.bytesFilled+=c}function Gs(o){o._queueTotalSize===0&&o._closeRequested?(zo(o),uo(o._controlledReadableByteStream)):Xr(o)}function jo(o){o._byobRequest!==null&&(o._byobRequest._associatedReadableByteStreamController=void 0,o._byobRequest._view=null,o._byobRequest=null)}function Vs(o){for(;o._pendingPullIntos.length>0;){if(o._queueTotalSize===0)return;const c=o._pendingPullIntos.peek();zs(o,c)&&(qo(o),Zn(o._controlledReadableByteStream,c))}}function il(o,c,f){const u=o._controlledReadableByteStream;let h=1;c.constructor!==DataView&&(h=c.constructor.BYTES_PER_ELEMENT);const p=c.constructor,g=Qr(c.buffer),b={buffer:g,bufferByteLength:g.byteLength,byteOffset:c.byteOffset,byteLength:c.byteLength,bytesFilled:0,elementSize:h,viewConstructor:p,readerType:"byob"};if(o._pendingPullIntos.length>0){o._pendingPullIntos.push(b),Ys(u,f);return}if(u._state==="closed"){const w=new p(b.buffer,b.byteOffset,0);f._closeSteps(w);return}if(o._queueTotalSize>0){if(zs(o,b)){const w=qs(b);Gs(o),f._chunkSteps(w);return}if(o._closeRequested){const w=new TypeError("Insufficient bytes to fill elements in the given buffer");Zr(o,w),f._errorSteps(w);return}}o._pendingPullIntos.push(b),Ys(u,f),Xr(o)}function ol(o,c){const f=o._controlledReadableByteStream;if(Ha(f))for(;Zs(f)>0;){const u=qo(o);Zn(f,u)}}function al(o,c,f){if(Ws(o,c,f),f.bytesFilled<f.elementSize)return;qo(o);const u=f.bytesFilled%f.elementSize;if(u>0){const h=f.byteOffset+f.bytesFilled,p=Hs(f.buffer,h-u,h);Yr(o,p,0,p.byteLength)}f.bytesFilled-=u,Zn(o._controlledReadableByteStream,f),Vs(o)}function Ks(o,c){const f=o._pendingPullIntos.peek();jo(o),o._controlledReadableByteStream._state==="closed"?ol(o):al(o,c,f),Xr(o)}function qo(o){return o._pendingPullIntos.shift()}function sl(o){const c=o._controlledReadableByteStream;return c._state!=="readable"||o._closeRequested||!o._started?!1:!!(zt(c)&&st(c)>0||Ha(c)&&Zs(c)>0||Jn(o)>0)}function zo(o){o._pullAlgorithm=void 0,o._cancelAlgorithm=void 0}function eo(o){const c=o._controlledReadableByteStream;if(!(o._closeRequested||c._state!=="readable")){if(o._queueTotalSize>0){o._closeRequested=!0;return}if(o._pendingPullIntos.length>0&&o._pendingPullIntos.peek().bytesFilled>0){const u=new TypeError("Insufficient bytes to fill elements in the given buffer");throw Zr(o,u),u}zo(o),uo(c)}}function to(o,c){const f=o._controlledReadableByteStream;if(o._closeRequested||f._state!=="readable")return;const u=c.buffer,h=c.byteOffset,p=c.byteLength,g=Qr(u);if(o._pendingPullIntos.length>0){const b=o._pendingPullIntos.peek();Yi(b.buffer),b.buffer=Qr(b.buffer)}if(jo(o),zt(f))if(st(f)===0)Yr(o,g,h,p);else{const b=new Uint8Array(g,h,p);Xn(f,b,!1)}else Ha(f)?(Yr(o,g,h,p),Vs(o)):Yr(o,g,h,p);Xr(o)}function Zr(o,c){const f=o._controlledReadableByteStream;f._state==="readable"&&(js(o),Nn(o),zo(o),ia(f,c))}function Ba(o){if(o._byobRequest===null&&o._pendingPullIntos.length>0){const c=o._pendingPullIntos.peek(),f=new Uint8Array(c.buffer,c.byteOffset+c.bytesFilled,c.byteLength-c.bytesFilled),u=Object.create(Zi.prototype);Qs(u,o,f),o._byobRequest=u}return o._byobRequest}function Jn(o){const c=o._controlledReadableByteStream._state;return c==="errored"?null:c==="closed"?0:o._strategyHWM-o._queueTotalSize}function ro(o,c){const f=o._pendingPullIntos.peek();if(o._controlledReadableByteStream._state==="closed"){if(c!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(c===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(f.bytesFilled+c>f.byteLength)throw new RangeError("bytesWritten out of range")}f.buffer=Qr(f.buffer),Ks(o,c)}function Wo(o,c){const f=o._pendingPullIntos.peek();if(o._controlledReadableByteStream._state==="closed"){if(c.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(c.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(f.byteOffset+f.bytesFilled!==c.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(f.bufferByteLength!==c.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(f.bytesFilled+c.byteLength>f.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");f.buffer=Qr(c.buffer),Ks(o,c.byteLength)}function Jr(o,c,f,u,h,p,g){c._controlledReadableByteStream=o,c._pullAgain=!1,c._pulling=!1,c._byobRequest=null,c._queue=c._queueTotalSize=void 0,Nn(c),c._closeRequested=!1,c._started=!1,c._strategyHWM=p,c._pullAlgorithm=u,c._cancelAlgorithm=h,c._autoAllocateChunkSize=g,c._pendingPullIntos=new Ee,o._readableStreamController=c;const b=f();Qe(k(b),()=>{c._started=!0,Xr(c)},w=>{Zr(c,w)})}function cl(o,c,f){const u=Object.create(Ci.prototype);let h=()=>{},p=()=>k(void 0),g=()=>k(void 0);c.start!==void 0&&(h=()=>c.start(u)),c.pull!==void 0&&(p=()=>c.pull(u)),c.cancel!==void 0&&(g=w=>c.cancel(w));const b=c.autoAllocateChunkSize;if(b===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Jr(o,u,h,p,g,f,b)}function Qs(o,c,f){o._associatedReadableByteStreamController=c,o._view=f}function Go(o){return new TypeError(`ReadableStreamBYOBRequest.prototype.${o} can only be used on a ReadableStreamBYOBRequest`)}function Mn(o){return new TypeError(`ReadableByteStreamController.prototype.${o} can only be used on a ReadableByteStreamController`)}function Xs(o){return new no(o)}function Ys(o,c){o._reader._readIntoRequests.push(c)}function ll(o,c,f){const h=o._reader._readIntoRequests.shift();f?h._closeSteps(c):h._chunkSteps(c)}function Zs(o){return o._reader._readIntoRequests.length}function Ha(o){const c=o._reader;return!(c===void 0||!ei(c))}class no{constructor(c){if(kt(c,1,"ReadableStreamBYOBReader"),_r(c,"First parameter"),Rn(c))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Yn(c._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Ie(this,c),this._readIntoRequests=new Ee}get closed(){return ei(this)?this._closedPromise:X(hn("closed"))}cancel(c=void 0){return ei(this)?this._ownerReadableStream===void 0?X(it("cancel")):Fe(this,c):X(hn("cancel"))}read(c){if(!ei(this))return X(hn("read"));if(!ArrayBuffer.isView(c))return X(new TypeError("view must be an array buffer view"));if(c.byteLength===0)return X(new TypeError("view must have non-zero byteLength"));if(c.buffer.byteLength===0)return X(new TypeError("view's buffer must have non-zero byteLength"));if(Yi(c.buffer),this._ownerReadableStream===void 0)return X(it("read from"));let f,u;const h=le((g,b)=>{f=g,u=b});return Ua(this,c,{_chunkSteps:g=>f({value:g,done:!1}),_closeSteps:g=>f({value:g,done:!0}),_errorSteps:g=>u(g)}),h}releaseLock(){if(!ei(this))throw hn("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Ve(this)}}}Object.defineProperties(no.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(no.prototype,$.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function ei(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_readIntoRequests")?!1:o instanceof no}function Ua(o,c,f){const u=o._ownerReadableStream;u._disturbed=!0,u._state==="errored"?f._errorSteps(u._storedError):il(u._readableStreamController,c,f)}function hn(o){return new TypeError(`ReadableStreamBYOBReader.prototype.${o} can only be used on a ReadableStreamBYOBReader`)}function Ti(o,c){const{highWaterMark:f}=o;if(f===void 0)return c;if(Bs(f)||f<0)throw new RangeError("Invalid highWaterMark");return f}function Vo(o){const{size:c}=o;return c||(()=>1)}function xi(o,c){ke(o,c);const f=o==null?void 0:o.highWaterMark,u=o==null?void 0:o.size;return{highWaterMark:f===void 0?void 0:Yt(f),size:u===void 0?void 0:ul(u,`${c} has member 'size' that`)}}function ul(o,c){return Pe(o,c),f=>Yt(o(f))}function ti(o,c){ke(o,c);const f=o==null?void 0:o.abort,u=o==null?void 0:o.close,h=o==null?void 0:o.start,p=o==null?void 0:o.type,g=o==null?void 0:o.write;return{abort:f===void 0?void 0:ja(f,o,`${c} has member 'abort' that`),close:u===void 0?void 0:dl(u,o,`${c} has member 'close' that`),start:h===void 0?void 0:hl(h,o,`${c} has member 'start' that`),write:g===void 0?void 0:fl(g,o,`${c} has member 'write' that`),type:p}}function ja(o,c,f){return Pe(o,f),u=>we(o,c,[u])}function dl(o,c,f){return Pe(o,f),()=>we(o,c,[])}function hl(o,c,f){return Pe(o,f),u=>ue(o,c,[u])}function fl(o,c,f){return Pe(o,f),(u,h)=>we(o,c,[u,h])}function qa(o,c){if(!Ri(o))throw new TypeError(`${c} is not a WritableStream.`)}function pl(o){if(typeof o!="object"||o===null)return!1;try{return typeof o.aborted=="boolean"}catch(c){return!1}}const Ko=typeof AbortController=="function";function gl(){if(Ko)return new AbortController}class io{constructor(c={},f={}){c===void 0?c=null:Tt(c,"First parameter");const u=xi(f,"Second parameter"),h=ti(c,"First parameter");if(ec(this),h.type!==void 0)throw new RangeError("Invalid type is specified");const g=Vo(u),b=Ti(u,1);xl(this,h,b,g)}get locked(){if(!Ri(this))throw Jo("locked");return Ai(this)}abort(c=void 0){return Ri(this)?Ai(this)?X(new TypeError("Cannot abort a stream that already has a writer")):oo(this,c):X(Jo("abort"))}close(){return Ri(this)?Ai(this)?X(new TypeError("Cannot close a stream that already has a writer")):fn(this)?X(new TypeError("Cannot close an already-closing stream")):za(this):X(Jo("close"))}getWriter(){if(!Ri(this))throw Jo("getWriter");return Js(this)}}Object.defineProperties(io.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(io.prototype,$.toStringTag,{value:"WritableStream",configurable:!0});function Js(o){return new pn(o)}function ml(o,c,f,u,h=1,p=()=>1){const g=Object.create(io.prototype);ec(g);const b=Object.create(ri.prototype);return ic(g,b,o,c,f,u,h,p),g}function ec(o){o._state="writable",o._storedError=void 0,o._writer=void 0,o._writableStreamController=void 0,o._writeRequests=new Ee,o._inFlightWriteRequest=void 0,o._closeRequest=void 0,o._inFlightCloseRequest=void 0,o._pendingAbortRequest=void 0,o._backpressure=!1}function Ri(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_writableStreamController")?!1:o instanceof io}function Ai(o){return o._writer!==void 0}function oo(o,c){var f;if(o._state==="closed"||o._state==="errored")return k(void 0);o._writableStreamController._abortReason=c,(f=o._writableStreamController._abortController)===null||f===void 0||f.abort();const u=o._state;if(u==="closed"||u==="errored")return k(void 0);if(o._pendingAbortRequest!==void 0)return o._pendingAbortRequest._promise;let h=!1;u==="erroring"&&(h=!0,c=void 0);const p=le((g,b)=>{o._pendingAbortRequest={_promise:void 0,_resolve:g,_reject:b,_reason:c,_wasAlreadyErroring:h}});return o._pendingAbortRequest._promise=p,h||Wa(o,c),p}function za(o){const c=o._state;if(c==="closed"||c==="errored")return X(new TypeError(`The stream (in ${c} state) is not in the writable state and cannot be closed`));const f=le((h,p)=>{const g={_resolve:h,_reject:p};o._closeRequest=g}),u=o._writer;return u!==void 0&&o._backpressure&&c==="writable"&&rs(u),Rl(o._writableStreamController),f}function vl(o){return le((f,u)=>{const h={_resolve:f,_reject:u};o._writeRequests.push(h)})}function Qo(o,c){if(o._state==="writable"){Wa(o,c);return}Ga(o)}function Wa(o,c){const f=o._writableStreamController;o._state="erroring",o._storedError=c;const u=o._writer;u!==void 0&&Xo(u,c),!Sl(o)&&f._started&&Ga(o)}function Ga(o){o._state="errored",o._writableStreamController[gt]();const c=o._storedError;if(o._writeRequests.forEach(h=>{h._reject(c)}),o._writeRequests=new Ee,o._pendingAbortRequest===void 0){Ln(o);return}const f=o._pendingAbortRequest;if(o._pendingAbortRequest=void 0,f._wasAlreadyErroring){f._reject(c),Ln(o);return}const u=o._writableStreamController[ut](f._reason);Qe(u,()=>{f._resolve(),Ln(o)},h=>{f._reject(h),Ln(o)})}function yl(o){o._inFlightWriteRequest._resolve(void 0),o._inFlightWriteRequest=void 0}function _l(o,c){o._inFlightWriteRequest._reject(c),o._inFlightWriteRequest=void 0,Qo(o,c)}function bl(o){o._inFlightCloseRequest._resolve(void 0),o._inFlightCloseRequest=void 0,o._state==="erroring"&&(o._storedError=void 0,o._pendingAbortRequest!==void 0&&(o._pendingAbortRequest._resolve(),o._pendingAbortRequest=void 0)),o._state="closed";const f=o._writer;f!==void 0&&sc(f)}function wl(o,c){o._inFlightCloseRequest._reject(c),o._inFlightCloseRequest=void 0,o._pendingAbortRequest!==void 0&&(o._pendingAbortRequest._reject(c),o._pendingAbortRequest=void 0),Qo(o,c)}function fn(o){return!(o._closeRequest===void 0&&o._inFlightCloseRequest===void 0)}function Sl(o){return!(o._inFlightWriteRequest===void 0&&o._inFlightCloseRequest===void 0)}function El(o){o._inFlightCloseRequest=o._closeRequest,o._closeRequest=void 0}function Va(o){o._inFlightWriteRequest=o._writeRequests.shift()}function Ln(o){o._closeRequest!==void 0&&(o._closeRequest._reject(o._storedError),o._closeRequest=void 0);const c=o._writer;c!==void 0&&Za(c,o._storedError)}function Lr(o,c){const f=o._writer;f!==void 0&&c!==o._backpressure&&(c?Nl(f):rs(f)),o._backpressure=c}class pn{constructor(c){if(kt(c,1,"WritableStreamDefaultWriter"),qa(c,"First parameter"),Ai(c))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=c,c._writer=this;const f=c._state;if(f==="writable")!fn(c)&&c._backpressure?ea(this):es(this),co(this);else if(f==="erroring")Ja(this,c._storedError),co(this);else if(f==="closed")es(this),Dl(this);else{const u=c._storedError;Ja(this,u),Ya(this,u)}}get closed(){return gn(this)?this._closedPromise:X(ii("closed"))}get desiredSize(){if(!gn(this))throw ii("desiredSize");if(this._ownerWritableStream===void 0)throw so("desiredSize");return Tl(this)}get ready(){return gn(this)?this._readyPromise:X(ii("ready"))}abort(c=void 0){return gn(this)?this._ownerWritableStream===void 0?X(so("abort")):tc(this,c):X(ii("abort"))}close(){if(!gn(this))return X(ii("close"));const c=this._ownerWritableStream;return c===void 0?X(so("close")):fn(c)?X(new TypeError("Cannot close an already-closing stream")):Tn(this)}releaseLock(){if(!gn(this))throw ii("releaseLock");this._ownerWritableStream!==void 0&&Qa(this)}write(c=void 0){return gn(this)?this._ownerWritableStream===void 0?X(so("write to")):rc(this,c):X(ii("write"))}}Object.defineProperties(pn.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(pn.prototype,$.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function gn(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_ownerWritableStream")?!1:o instanceof pn}function tc(o,c){const f=o._ownerWritableStream;return oo(f,c)}function Tn(o){const c=o._ownerWritableStream;return za(c)}function Cl(o){const c=o._ownerWritableStream,f=c._state;return fn(c)||f==="closed"?k(void 0):f==="errored"?X(c._storedError):Tn(o)}function Ka(o,c){o._closedPromiseState==="pending"?Za(o,c):kl(o,c)}function Xo(o,c){o._readyPromiseState==="pending"?ts(o,c):cc(o,c)}function Tl(o){const c=o._ownerWritableStream,f=c._state;return f==="errored"||f==="erroring"?null:f==="closed"?0:oc(c._writableStreamController)}function Qa(o){const c=o._ownerWritableStream,f=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Xo(o,f),Ka(o,f),c._writer=void 0,o._ownerWritableStream=void 0}function rc(o,c){const f=o._ownerWritableStream,u=f._writableStreamController,h=Al(u,c);if(f!==o._ownerWritableStream)return X(so("write to"));const p=f._state;if(p==="errored")return X(f._storedError);if(fn(f)||p==="closed")return X(new TypeError("The stream is closing or closed and cannot be written to"));if(p==="erroring")return X(f._storedError);const g=vl(f);return Il(u,c,h),g}const nc={};class ri{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Ii(this))throw ni("abortReason");return this._abortReason}get signal(){if(!Ii(this))throw ni("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(c=void 0){if(!Ii(this))throw ni("error");this._controlledWritableStream._state==="writable"&&ac(this,c)}[ut](c){const f=this._abortAlgorithm(c);return Yo(this),f}[gt](){Nn(this)}}Object.defineProperties(ri.prototype,{error:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(ri.prototype,$.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Ii(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledWritableStream")?!1:o instanceof ri}function ic(o,c,f,u,h,p,g,b){c._controlledWritableStream=o,o._writableStreamController=c,c._queue=void 0,c._queueTotalSize=void 0,Nn(c),c._abortReason=void 0,c._abortController=gl(),c._started=!1,c._strategySizeAlgorithm=b,c._strategyHWM=g,c._writeAlgorithm=u,c._closeAlgorithm=h,c._abortAlgorithm=p;const w=Xa(c);Lr(o,w);const y=f(),S=k(y);Qe(S,()=>{c._started=!0,Zo(c)},C=>{c._started=!0,Qo(o,C)})}function xl(o,c,f,u){const h=Object.create(ri.prototype);let p=()=>{},g=()=>k(void 0),b=()=>k(void 0),w=()=>k(void 0);c.start!==void 0&&(p=()=>c.start(h)),c.write!==void 0&&(g=y=>c.write(y,h)),c.close!==void 0&&(b=()=>c.close()),c.abort!==void 0&&(w=y=>c.abort(y)),ic(o,h,p,g,b,w,f,u)}function Yo(o){o._writeAlgorithm=void 0,o._closeAlgorithm=void 0,o._abortAlgorithm=void 0,o._strategySizeAlgorithm=void 0}function Rl(o){Uo(o,nc,0),Zo(o)}function Al(o,c){try{return o._strategySizeAlgorithm(c)}catch(f){return ao(o,f),1}}function oc(o){return o._strategyHWM-o._queueTotalSize}function Il(o,c,f){try{Uo(o,c,f)}catch(h){ao(o,h);return}const u=o._controlledWritableStream;if(!fn(u)&&u._state==="writable"){const h=Xa(o);Lr(u,h)}Zo(o)}function Zo(o){const c=o._controlledWritableStream;if(!o._started||c._inFlightWriteRequest!==void 0)return;if(c._state==="erroring"){Ga(c);return}if(o._queue.length===0)return;const u=Us(o);u===nc?Pl(o):Ol(o,u)}function ao(o,c){o._controlledWritableStream._state==="writable"&&ac(o,c)}function Pl(o){const c=o._controlledWritableStream;El(c),Ho(o);const f=o._closeAlgorithm();Yo(o),Qe(f,()=>{bl(c)},u=>{wl(c,u)})}function Ol(o,c){const f=o._controlledWritableStream;Va(f);const u=o._writeAlgorithm(c);Qe(u,()=>{yl(f);const h=f._state;if(Ho(o),!fn(f)&&h==="writable"){const p=Xa(o);Lr(f,p)}Zo(o)},h=>{f._state==="writable"&&Yo(o),_l(f,h)})}function Xa(o){return oc(o)<=0}function ac(o,c){const f=o._controlledWritableStream;Yo(o),Wa(f,c)}function Jo(o){return new TypeError(`WritableStream.prototype.${o} can only be used on a WritableStream`)}function ni(o){return new TypeError(`WritableStreamDefaultController.prototype.${o} can only be used on a WritableStreamDefaultController`)}function ii(o){return new TypeError(`WritableStreamDefaultWriter.prototype.${o} can only be used on a WritableStreamDefaultWriter`)}function so(o){return new TypeError("Cannot "+o+" a stream using a released writer")}function co(o){o._closedPromise=le((c,f)=>{o._closedPromise_resolve=c,o._closedPromise_reject=f,o._closedPromiseState="pending"})}function Ya(o,c){co(o),Za(o,c)}function Dl(o){co(o),sc(o)}function Za(o,c){o._closedPromise_reject!==void 0&&(be(o._closedPromise),o._closedPromise_reject(c),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0,o._closedPromiseState="rejected")}function kl(o,c){Ya(o,c)}function sc(o){o._closedPromise_resolve!==void 0&&(o._closedPromise_resolve(void 0),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0,o._closedPromiseState="resolved")}function ea(o){o._readyPromise=le((c,f)=>{o._readyPromise_resolve=c,o._readyPromise_reject=f}),o._readyPromiseState="pending"}function Ja(o,c){ea(o),ts(o,c)}function es(o){ea(o),rs(o)}function ts(o,c){o._readyPromise_reject!==void 0&&(be(o._readyPromise),o._readyPromise_reject(c),o._readyPromise_resolve=void 0,o._readyPromise_reject=void 0,o._readyPromiseState="rejected")}function Nl(o){ea(o)}function cc(o,c){Ja(o,c)}function rs(o){o._readyPromise_resolve!==void 0&&(o._readyPromise_resolve(void 0),o._readyPromise_resolve=void 0,o._readyPromise_reject=void 0,o._readyPromiseState="fulfilled")}const lc=typeof DOMException!="undefined"?DOMException:void 0;function ns(o){if(!(typeof o=="function"||typeof o=="object"))return!1;try{return new o,!0}catch(c){return!1}}function Ml(){const o=function(f,u){this.message=f||"",this.name=u||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return o.prototype=Object.create(Error.prototype),Object.defineProperty(o.prototype,"constructor",{value:o,writable:!0,configurable:!0}),o}const Fr=ns(lc)?lc:Ml();function is(o,c,f,u,h,p){const g=St(o),b=Js(c);o._disturbed=!0;let w=!1,y=k(void 0);return le((S,C)=>{let T;if(p!==void 0){if(T=()=>{const me=new Fr("Aborted","AbortError"),Se=[];u||Se.push(()=>c._state==="writable"?oo(c,me):k(void 0)),h||Se.push(()=>o._state==="readable"?Or(o,me):k(void 0)),V(()=>Promise.all(Se.map(He=>He())),!0,me)},p.aborted){T();return}p.addEventListener("abort",T)}function A(){return le((me,Se)=>{function He(ze){ze?me():Ge(O(),He,Se)}He(!1)})}function O(){return w?k(!0):Ge(b._readyPromise,()=>le((me,Se)=>{Kt(g,{_chunkSteps:He=>{y=Ge(rc(b,He),void 0,W),me(!1)},_closeSteps:()=>me(!0),_errorSteps:Se})}))}if(q(o,g._closedPromise,me=>{u?ie(!0,me):V(()=>oo(c,me),!0,me)}),q(c,b._closedPromise,me=>{h?ie(!0,me):V(()=>Or(o,me),!0,me)}),Q(o,g._closedPromise,()=>{f?ie():V(()=>Cl(b))}),fn(c)||c._state==="closed"){const me=new TypeError("the destination writable stream closed before all data could be piped to it");h?ie(!0,me):V(()=>Or(o,me),!0,me)}be(A());function D(){const me=y;return Ge(y,()=>me!==y?D():void 0)}function q(me,Se,He){me._state==="errored"?He(me._storedError):ye(Se,He)}function Q(me,Se,He){me._state==="closed"?He():rt(Se,He)}function V(me,Se,He){if(w)return;w=!0,c._state==="writable"&&!fn(c)?rt(D(),ze):ze();function ze(){Qe(me(),()=>pe(Se,He),ot=>pe(!0,ot))}}function ie(me,Se){w||(w=!0,c._state==="writable"&&!fn(c)?rt(D(),()=>pe(me,Se)):pe(me,Se))}function pe(me,Se){Qa(b),Ve(g),p!==void 0&&p.removeEventListener("abort",T),me?C(Se):S(void 0)}})}class oi{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Pi(this))throw na("desiredSize");return as(this)}close(){if(!Pi(this))throw na("close");if(!Oi(this))throw new TypeError("The stream is not in a state that permits close");lo(this)}enqueue(c=void 0){if(!Pi(this))throw na("enqueue");if(!Oi(this))throw new TypeError("The stream is not in a state that permits enqueue");return ra(this,c)}error(c=void 0){if(!Pi(this))throw na("error");xn(this,c)}[_t](c){Nn(this);const f=this._cancelAlgorithm(c);return ta(this),f}[Ce](c){const f=this._controlledReadableStream;if(this._queue.length>0){const u=Ho(this);this._closeRequested&&this._queue.length===0?(ta(this),uo(f)):ai(this),c._chunkSteps(u)}else or(f,c),ai(this)}}Object.defineProperties(oi.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(oi.prototype,$.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Pi(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledReadableStream")?!1:o instanceof oi}function ai(o){if(!os(o))return;if(o._pulling){o._pullAgain=!0;return}o._pulling=!0;const f=o._pullAlgorithm();Qe(f,()=>{o._pulling=!1,o._pullAgain&&(o._pullAgain=!1,ai(o))},u=>{xn(o,u)})}function os(o){const c=o._controlledReadableStream;return!Oi(o)||!o._started?!1:!!(Rn(c)&&st(c)>0||as(o)>0)}function ta(o){o._pullAlgorithm=void 0,o._cancelAlgorithm=void 0,o._strategySizeAlgorithm=void 0}function lo(o){if(!Oi(o))return;const c=o._controlledReadableStream;o._closeRequested=!0,o._queue.length===0&&(ta(o),uo(c))}function ra(o,c){if(!Oi(o))return;const f=o._controlledReadableStream;if(Rn(f)&&st(f)>0)Xn(f,c,!1);else{let u;try{u=o._strategySizeAlgorithm(c)}catch(h){throw xn(o,h),h}try{Uo(o,c,u)}catch(h){throw xn(o,h),h}}ai(o)}function xn(o,c){const f=o._controlledReadableStream;f._state==="readable"&&(Nn(o),ta(o),ia(f,c))}function as(o){const c=o._controlledReadableStream._state;return c==="errored"?null:c==="closed"?0:o._strategyHWM-o._queueTotalSize}function uc(o){return!os(o)}function Oi(o){const c=o._controlledReadableStream._state;return!o._closeRequested&&c==="readable"}function dc(o,c,f,u,h,p,g){c._controlledReadableStream=o,c._queue=void 0,c._queueTotalSize=void 0,Nn(c),c._started=!1,c._closeRequested=!1,c._pullAgain=!1,c._pulling=!1,c._strategySizeAlgorithm=g,c._strategyHWM=p,c._pullAlgorithm=u,c._cancelAlgorithm=h,o._readableStreamController=c;const b=f();Qe(k(b),()=>{c._started=!0,ai(c)},w=>{xn(c,w)})}function hc(o,c,f,u){const h=Object.create(oi.prototype);let p=()=>{},g=()=>k(void 0),b=()=>k(void 0);c.start!==void 0&&(p=()=>c.start(h)),c.pull!==void 0&&(g=()=>c.pull(h)),c.cancel!==void 0&&(b=w=>c.cancel(w)),dc(o,h,p,g,b,f,u)}function na(o){return new TypeError(`ReadableStreamDefaultController.prototype.${o} can only be used on a ReadableStreamDefaultController`)}function Ll(o,c){return Yn(o._readableStreamController)?$l(o):Fl(o)}function Fl(o,c){const f=St(o);let u=!1,h=!1,p=!1,g,b,w,y,S;const C=le(q=>{S=q});function T(){return u||(u=!0,Kt(f,{_chunkSteps:Q=>{ae(()=>{u=!1;const V=Q,ie=Q;h||ra(w._readableStreamController,V),p||ra(y._readableStreamController,ie)})},_closeSteps:()=>{u=!1,h||lo(w._readableStreamController),p||lo(y._readableStreamController),(!h||!p)&&S(void 0)},_errorSteps:()=>{u=!1}})),k(void 0)}function A(q){if(h=!0,g=q,p){const Q=Xt([g,b]),V=Or(o,Q);S(V)}return C}function O(q){if(p=!0,b=q,h){const Q=Xt([g,b]),V=Or(o,Q);S(V)}return C}function D(){}return w=cs(D,T,A),y=cs(D,T,O),ye(f._closedPromise,q=>{xn(w._readableStreamController,q),xn(y._readableStreamController,q),(!h||!p)&&S(void 0)}),[w,y]}function $l(o){let c=St(o),f=!1,u=!1,h=!1,p,g,b,w,y;const S=le(ie=>{y=ie});function C(ie){ye(ie._closedPromise,pe=>{ie===c&&(Zr(b._readableStreamController,pe),Zr(w._readableStreamController,pe),(!u||!h)&&y(void 0))})}function T(){ei(c)&&(Ve(c),c=St(o),C(c)),Kt(c,{_chunkSteps:pe=>{ae(()=>{f=!1;const me=pe;let Se=pe;if(!u&&!h)try{Se=$a(pe)}catch(He){Zr(b._readableStreamController,He),Zr(w._readableStreamController,He),y(Or(o,He));return}u||to(b._readableStreamController,me),h||to(w._readableStreamController,Se)})},_closeSteps:()=>{f=!1,u||eo(b._readableStreamController),h||eo(w._readableStreamController),b._readableStreamController._pendingPullIntos.length>0&&ro(b._readableStreamController,0),w._readableStreamController._pendingPullIntos.length>0&&ro(w._readableStreamController,0),(!u||!h)&&y(void 0)},_errorSteps:()=>{f=!1}})}function A(ie,pe){At(c)&&(Ve(c),c=Xs(o),C(c));const me=pe?w:b,Se=pe?b:w;Ua(c,ie,{_chunkSteps:ze=>{ae(()=>{f=!1;const ot=pe?h:u;if(pe?u:h)ot||Wo(me._readableStreamController,ze);else{let Nt;try{Nt=$a(ze)}catch(Pt){Zr(me._readableStreamController,Pt),Zr(Se._readableStreamController,Pt),y(Or(o,Pt));return}ot||Wo(me._readableStreamController,ze),to(Se._readableStreamController,Nt)}})},_closeSteps:ze=>{f=!1;const ot=pe?h:u,mt=pe?u:h;ot||eo(me._readableStreamController),mt||eo(Se._readableStreamController),ze!==void 0&&(ot||Wo(me._readableStreamController,ze),!mt&&Se._readableStreamController._pendingPullIntos.length>0&&ro(Se._readableStreamController,0)),(!ot||!mt)&&y(void 0)},_errorSteps:()=>{f=!1}})}function O(){if(f)return k(void 0);f=!0;const ie=Ba(b._readableStreamController);return ie===null?T():A(ie._view,!1),k(void 0)}function D(){if(f)return k(void 0);f=!0;const ie=Ba(w._readableStreamController);return ie===null?T():A(ie._view,!0),k(void 0)}function q(ie){if(u=!0,p=ie,h){const pe=Xt([p,g]),me=Or(o,pe);y(me)}return S}function Q(ie){if(h=!0,g=ie,u){const pe=Xt([p,g]),me=Or(o,pe);y(me)}return S}function V(){}return b=ls(V,O,q),w=ls(V,D,Q),C(c),[b,w]}function Bl(o,c){ke(o,c);const f=o,u=f==null?void 0:f.autoAllocateChunkSize,h=f==null?void 0:f.cancel,p=f==null?void 0:f.pull,g=f==null?void 0:f.start,b=f==null?void 0:f.type;return{autoAllocateChunkSize:u===void 0?void 0:Mr(u,`${c} has member 'autoAllocateChunkSize' that`),cancel:h===void 0?void 0:Hl(h,f,`${c} has member 'cancel' that`),pull:p===void 0?void 0:Ul(p,f,`${c} has member 'pull' that`),start:g===void 0?void 0:Di(g,f,`${c} has member 'start' that`),type:b===void 0?void 0:jl(b,`${c} has member 'type' that`)}}function Hl(o,c,f){return Pe(o,f),u=>we(o,c,[u])}function Ul(o,c,f){return Pe(o,f),u=>we(o,c,[u])}function Di(o,c,f){return Pe(o,f),u=>ue(o,c,[u])}function jl(o,c){if(o=`${o}`,o!=="bytes")throw new TypeError(`${c} '${o}' is not a valid enumeration value for ReadableStreamType`);return o}function ql(o,c){ke(o,c);const f=o==null?void 0:o.mode;return{mode:f===void 0?void 0:zl(f,`${c} has member 'mode' that`)}}function zl(o,c){if(o=`${o}`,o!=="byob")throw new TypeError(`${c} '${o}' is not a valid enumeration value for ReadableStreamReaderMode`);return o}function Wl(o,c){ke(o,c);const f=o==null?void 0:o.preventCancel;return{preventCancel:Boolean(f)}}function fc(o,c){ke(o,c);const f=o==null?void 0:o.preventAbort,u=o==null?void 0:o.preventCancel,h=o==null?void 0:o.preventClose,p=o==null?void 0:o.signal;return p!==void 0&&Fn(p,`${c} has member 'signal' that`),{preventAbort:Boolean(f),preventCancel:Boolean(u),preventClose:Boolean(h),signal:p}}function Fn(o,c){if(!pl(o))throw new TypeError(`${c} is not an AbortSignal.`)}function ss(o,c){ke(o,c);const f=o==null?void 0:o.readable;Tr(f,"readable","ReadableWritablePair"),_r(f,`${c} has member 'readable' that`);const u=o==null?void 0:o.writable;return Tr(u,"writable","ReadableWritablePair"),qa(u,`${c} has member 'writable' that`),{readable:f,writable:u}}class Wt{constructor(c={},f={}){c===void 0?c=null:Tt(c,"First parameter");const u=xi(f,"Second parameter"),h=Bl(c,"First parameter");if(ki(this),h.type==="bytes"){if(u.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");const p=Ti(u,0);cl(this,h,p)}else{const p=Vo(u),g=Ti(u,1);hc(this,h,g,p)}}get locked(){if(!$n(this))throw si("locked");return Rn(this)}cancel(c=void 0){return $n(this)?Rn(this)?X(new TypeError("Cannot cancel a stream that already has a reader")):Or(this,c):X(si("cancel"))}getReader(c=void 0){if(!$n(this))throw si("getReader");return ql(c,"First parameter").mode===void 0?St(this):Xs(this)}pipeThrough(c,f={}){if(!$n(this))throw si("pipeThrough");kt(c,1,"pipeThrough");const u=ss(c,"First parameter"),h=fc(f,"Second parameter");if(Rn(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Ai(u.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");const p=is(this,u.writable,h.preventClose,h.preventAbort,h.preventCancel,h.signal);return be(p),u.readable}pipeTo(c,f={}){if(!$n(this))return X(si("pipeTo"));if(c===void 0)return X("Parameter 1 is required in 'pipeTo'.");if(!Ri(c))return X(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let u;try{u=fc(f,"Second parameter")}catch(h){return X(h)}return Rn(this)?X(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Ai(c)?X(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):is(this,c,u.preventClose,u.preventAbort,u.preventCancel,u.signal)}tee(){if(!$n(this))throw si("tee");const c=Ll(this);return Xt(c)}values(c=void 0){if(!$n(this))throw si("values");const f=Wl(c,"First parameter");return Ls(this,f.preventCancel)}}Object.defineProperties(Wt.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(Wt.prototype,$.toStringTag,{value:"ReadableStream",configurable:!0}),typeof $.asyncIterator=="symbol"&&Object.defineProperty(Wt.prototype,$.asyncIterator,{value:Wt.prototype.values,writable:!0,configurable:!0});function cs(o,c,f,u=1,h=()=>1){const p=Object.create(Wt.prototype);ki(p);const g=Object.create(oi.prototype);return dc(p,g,o,c,f,u,h),p}function ls(o,c,f){const u=Object.create(Wt.prototype);ki(u);const h=Object.create(Ci.prototype);return Jr(u,h,o,c,f,0,void 0),u}function ki(o){o._state="readable",o._reader=void 0,o._storedError=void 0,o._disturbed=!1}function $n(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_readableStreamController")?!1:o instanceof Wt}function Rn(o){return o._reader!==void 0}function Or(o,c){if(o._disturbed=!0,o._state==="closed")return k(void 0);if(o._state==="errored")return X(o._storedError);uo(o);const f=o._reader;f!==void 0&&ei(f)&&(f._readIntoRequests.forEach(h=>{h._closeSteps(void 0)}),f._readIntoRequests=new Ee);const u=o._readableStreamController[_t](c);return _e(u,W)}function uo(o){o._state="closed";const c=o._reader;c!==void 0&&(Ue(c),At(c)&&(c._readRequests.forEach(f=>{f._closeSteps()}),c._readRequests=new Ee))}function ia(o,c){o._state="errored",o._storedError=c;const f=o._reader;f!==void 0&&(Ke(f,c),At(f)?(f._readRequests.forEach(u=>{u._errorSteps(c)}),f._readRequests=new Ee):(f._readIntoRequests.forEach(u=>{u._errorSteps(c)}),f._readIntoRequests=new Ee))}function si(o){return new TypeError(`ReadableStream.prototype.${o} can only be used on a ReadableStream`)}function us(o,c){ke(o,c);const f=o==null?void 0:o.highWaterMark;return Tr(f,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Yt(f)}}const ci=o=>o.byteLength;Object.defineProperty(ci,"name",{value:"size",configurable:!0});class oa{constructor(c){kt(c,1,"ByteLengthQueuingStrategy"),c=us(c,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=c.highWaterMark}get highWaterMark(){if(!pc(this))throw aa("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!pc(this))throw aa("size");return ci}}Object.defineProperties(oa.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(oa.prototype,$.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function aa(o){return new TypeError(`ByteLengthQueuingStrategy.prototype.${o} can only be used on a ByteLengthQueuingStrategy`)}function pc(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_byteLengthQueuingStrategyHighWaterMark")?!1:o instanceof oa}const gc=()=>1;Object.defineProperty(gc,"name",{value:"size",configurable:!0});class sa{constructor(c){kt(c,1,"CountQueuingStrategy"),c=us(c,"First parameter"),this._countQueuingStrategyHighWaterMark=c.highWaterMark}get highWaterMark(){if(!vc(this))throw mc("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!vc(this))throw mc("size");return gc}}Object.defineProperties(sa.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(sa.prototype,$.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function mc(o){return new TypeError(`CountQueuingStrategy.prototype.${o} can only be used on a CountQueuingStrategy`)}function vc(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_countQueuingStrategyHighWaterMark")?!1:o instanceof sa}function yc(o,c){ke(o,c);const f=o==null?void 0:o.flush,u=o==null?void 0:o.readableType,h=o==null?void 0:o.start,p=o==null?void 0:o.transform,g=o==null?void 0:o.writableType;return{flush:f===void 0?void 0:Gl(f,o,`${c} has member 'flush' that`),readableType:u,start:h===void 0?void 0:Vl(h,o,`${c} has member 'start' that`),transform:p===void 0?void 0:id(p,o,`${c} has member 'transform' that`),writableType:g}}function Gl(o,c,f){return Pe(o,f),u=>we(o,c,[u])}function Vl(o,c,f){return Pe(o,f),u=>ue(o,c,[u])}function id(o,c,f){return Pe(o,f),(u,h)=>we(o,c,[u,h])}class ca{constructor(c={},f={},u={}){c===void 0&&(c=null);const h=xi(f,"Second parameter"),p=xi(u,"Third parameter"),g=yc(c,"First parameter");if(g.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(g.writableType!==void 0)throw new RangeError("Invalid writableType specified");const b=Ti(p,0),w=Vo(p),y=Ti(h,1),S=Vo(h);let C;const T=le(A=>{C=A});Kl(this,T,y,S,b,w),Xl(this,g),g.start!==void 0?C(g.start(this._transformStreamController)):C(void 0)}get readable(){if(!_c(this))throw x("readable");return this._readable}get writable(){if(!_c(this))throw x("writable");return this._writable}}Object.defineProperties(ca.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(ca.prototype,$.toStringTag,{value:"TransformStream",configurable:!0});function Kl(o,c,f,u,h,p){function g(){return c}function b(T){return bc(o,T)}function w(T){return Yl(o,T)}function y(){return Zl(o)}o._writable=ml(g,b,y,w,f,u);function S(){return hs(o)}function C(T){return ua(o,T),k(void 0)}o._readable=cs(g,S,C,h,p),o._backpressure=void 0,o._backpressureChangePromise=void 0,o._backpressureChangePromise_resolve=void 0,da(o,!0),o._transformStreamController=void 0}function _c(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_transformStreamController")?!1:o instanceof ca}function la(o,c){xn(o._readable._readableStreamController,c),ua(o,c)}function ua(o,c){ds(o._transformStreamController),ao(o._writable._writableStreamController,c),o._backpressure&&da(o,!1)}function da(o,c){o._backpressureChangePromise!==void 0&&o._backpressureChangePromise_resolve(),o._backpressureChangePromise=le(f=>{o._backpressureChangePromise_resolve=f}),o._backpressure=c}class ho{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!ha(this))throw s("desiredSize");const c=this._controlledTransformStream._readable._readableStreamController;return as(c)}enqueue(c=void 0){if(!ha(this))throw s("enqueue");Bn(this,c)}error(c=void 0){if(!ha(this))throw s("error");dr(this,c)}terminate(){if(!ha(this))throw s("terminate");mn(this)}}Object.defineProperties(ho.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof $.toStringTag=="symbol"&&Object.defineProperty(ho.prototype,$.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function ha(o){return!se(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledTransformStream")?!1:o instanceof ho}function Ql(o,c,f,u){c._controlledTransformStream=o,o._transformStreamController=c,c._transformAlgorithm=f,c._flushAlgorithm=u}function Xl(o,c){const f=Object.create(ho.prototype);let u=p=>{try{return Bn(f,p),k(void 0)}catch(g){return X(g)}},h=()=>k(void 0);c.transform!==void 0&&(u=p=>c.transform(p,f)),c.flush!==void 0&&(h=()=>c.flush(f)),Ql(o,f,u,h)}function ds(o){o._transformAlgorithm=void 0,o._flushAlgorithm=void 0}function Bn(o,c){const f=o._controlledTransformStream,u=f._readable._readableStreamController;if(!Oi(u))throw new TypeError("Readable side is not in a state that permits enqueue");try{ra(u,c)}catch(p){throw ua(f,p),f._readable._storedError}uc(u)!==f._backpressure&&da(f,!0)}function dr(o,c){la(o._controlledTransformStream,c)}function fa(o,c){const f=o._transformAlgorithm(c);return _e(f,void 0,u=>{throw la(o._controlledTransformStream,u),u})}function mn(o){const c=o._controlledTransformStream,f=c._readable._readableStreamController;lo(f);const u=new TypeError("TransformStream terminated");ua(c,u)}function bc(o,c){const f=o._transformStreamController;if(o._backpressure){const u=o._backpressureChangePromise;return _e(u,()=>{const h=o._writable;if(h._state==="erroring")throw h._storedError;return fa(f,c)})}return fa(f,c)}function Yl(o,c){return la(o,c),k(void 0)}function Zl(o){const c=o._readable,f=o._transformStreamController,u=f._flushAlgorithm();return ds(f),_e(u,()=>{if(c._state==="errored")throw c._storedError;lo(c._readableStreamController)},h=>{throw la(o,h),c._storedError})}function hs(o){return da(o,!1),o._backpressureChangePromise}function s(o){return new TypeError(`TransformStreamDefaultController.prototype.${o} can only be used on a TransformStreamDefaultController`)}function x(o){return new TypeError(`TransformStream.prototype.${o} can only be used on a TransformStream`)}H.ByteLengthQueuingStrategy=oa,H.CountQueuingStrategy=sa,H.ReadableByteStreamController=Ci,H.ReadableStream=Wt,H.ReadableStreamBYOBReader=no,H.ReadableStreamBYOBRequest=Zi,H.ReadableStreamDefaultController=oi,H.ReadableStreamDefaultReader=tt,H.TransformStream=ca,H.TransformStreamDefaultController=ho,H.WritableStream=io,H.WritableStreamDefaultController=ri,H.WritableStreamDefaultWriter=pn,Object.defineProperty(H,"__esModule",{value:!0})})},2479:_=>{_.exports=F;function F(H,$){if(H&&$)return F(H)($);if(typeof H!="function")throw new TypeError("need wrapper function");return Object.keys(H).forEach(function(ne){W[ne]=H[ne]}),W;function W(){for(var ne=new Array(arguments.length),re=0;re<ne.length;re++)ne[re]=arguments[re];var se=H.apply(this,ne),oe=ne[ne.length-1];return typeof se=="function"&&se!==oe&&Object.keys(oe).forEach(function(z){se[z]=oe[z]}),se}}},9166:_=>{"use strict";_.exports=require("applicationinsights-native-metrics")},9496:_=>{"use strict";_.exports=require("vscode")},9491:_=>{"use strict";_.exports=require("assert")},852:_=>{"use strict";_.exports=require("async_hooks")},4300:_=>{"use strict";_.exports=require("buffer")},2081:_=>{"use strict";_.exports=require("child_process")},6206:_=>{"use strict";_.exports=require("console")},2057:_=>{"use strict";_.exports=require("constants")},6113:_=>{"use strict";_.exports=require("crypto")},9523:_=>{"use strict";_.exports=require("dns")},2361:_=>{"use strict";_.exports=require("events")},7147:_=>{"use strict";_.exports=require("fs")},3685:_=>{"use strict";_.exports=require("http")},5687:_=>{"use strict";_.exports=require("https")},8188:_=>{"use strict";_.exports=require("module")},1808:_=>{"use strict";_.exports=require("net")},2037:_=>{"use strict";_.exports=require("os")},1017:_=>{"use strict";_.exports=require("path")},4074:_=>{"use strict";_.exports=require("perf_hooks")},2781:_=>{"use strict";_.exports=require("stream")},5356:_=>{"use strict";_.exports=require("stream/web")},9512:_=>{"use strict";_.exports=require("timers")},7310:_=>{"use strict";_.exports=require("url")},3837:_=>{"use strict";_.exports=require("util")},9796:_=>{"use strict";_.exports=require("zlib")},7135:(_,F,H)=>{const $=65536;if(!globalThis.ReadableStream)try{Object.assign(globalThis,H(5356))}catch(W){Object.assign(globalThis,H(2660))}try{const{Blob:W}=H(4300);W&&!W.prototype.stream&&(W.prototype.stream=function(re){let se=0;const oe=this;return new ReadableStream({type:"bytes",async pull(z){const L=await oe.slice(se,Math.min(oe.size,se+$)).arrayBuffer();se+=L.byteLength,z.enqueue(new Uint8Array(L)),se===oe.size&&z.close()}})})}catch(W){}}},__webpack_module_cache__={};function __webpack_require__(_){var F=__webpack_module_cache__[_];if(F!==void 0)return F.exports;var H=__webpack_module_cache__[_]={exports:{}};return __webpack_modules__[_].call(H.exports,H,H.exports,__webpack_require__),H.exports}(()=>{__webpack_require__.n=_=>{var F=_&&_.__esModule?()=>_.default:()=>_;return __webpack_require__.d(F,{a:F}),F}})(),(()=>{var _=Object.getPrototypeOf?H=>Object.getPrototypeOf(H):H=>H.__proto__,F;__webpack_require__.t=function(H,$){if($&1&&(H=this(H)),$&8||typeof H=="object"&&H&&($&4&&H.__esModule||$&16&&typeof H.then=="function"))return H;var W=Object.create(null);__webpack_require__.r(W);var ne={};F=F||[null,_({}),_([]),_(_)];for(var re=$&2&&H;typeof re=="object"&&!~F.indexOf(re);re=_(re))Object.getOwnPropertyNames(re).forEach(se=>ne[se]=()=>H[se]);return ne.default=()=>H,__webpack_require__.d(W,ne),W}})(),(()=>{__webpack_require__.d=(_,F)=>{for(var H in F)__webpack_require__.o(F,H)&&!__webpack_require__.o(_,H)&&Object.defineProperty(_,H,{enumerable:!0,get:F[H]})}})(),(()=>{__webpack_require__.o=(_,F)=>Object.prototype.hasOwnProperty.call(_,F)})(),(()=>{__webpack_require__.r=_=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})}})();var __webpack_exports__={};(()=>{var Fo,rd,Jc,el;"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{StateKeys:()=>Ns,activate:()=>TE,getOpenActionsService:()=>_h,getState:()=>ny,isInsiders:()=>oy,updateState:()=>_p});var _=__webpack_require__(9496),F=__webpack_require__(8472),H;(function(t){t.Off="off",t.Auto="auto",t.Always="always"})(H||(H={}));var $;(function(t){t.None="none",t.Latest="latest",t.Match="match",t.TipPlusLatest="tip+latest"})($||($={})),function(t){function e(r){return r===t.None||r===t.Latest||r===t.Match||r===t.TipPlusLatest?r:t.None}t.sanitize=e}($||($={}));var W;(function(t){t.Browse="browse",t.Edit="edit"})(W||(W={})),function(t){function e(n){return n===t.Browse||n===t.Edit?n:t.Edit}t.sanitize=e;function r(n){return n===t.Browse?t.Edit:t.Browse}t.toggle=r}(W||(W={}));var ne;(function(t){function e(r,n){return r.display===n.display&&r.index===n.index}t.equals=e})(ne||(ne={}));var re;(function(t){t.Branch="branch",t.RemoteBranch="remoteBranch",t.PullRequestBranch="pullRequestBranch",t.PullRequestRemoteBranch="pullRequestRemoteBranch",t.Tag="tag",t.Commit="commit"})(re||(re={}));var se;(function(t){const e=new Map([[re.Branch,$.None],[re.RemoteBranch,$.None],[re.PullRequestBranch,$.Match],[re.PullRequestRemoteBranch,$.Match],[re.Commit,$.Match],[re.Tag,$.Match]]),r=new Map([[re.Branch,W.Edit],[re.RemoteBranch,W.Edit],[re.PullRequestBranch,W.Browse],[re.PullRequestRemoteBranch,W.Browse],[re.Commit,W.Browse],[re.Tag,W.Browse]]);function n(i){var a,l;return{display:(a=r.get(i))!=null?a:W.Edit,index:(l=e.get(i))!=null?l:$.None}}t.getDefault=n})(se||(se={}));const oe=null;function z(){this.__data__=[],this.size=0}const U=z;function L(t,e){return t===e||t!==t&&e!==e}const G=L;function le(t,e){for(var r=t.length;r--;)if(G(t[r][0],e))return r;return-1}const k=le;var X=Array.prototype,Ge=X.splice;function Qe(t){var e=this.__data__,r=k(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Ge.call(e,r,1),--this.size,!0}const rt=Qe;function ye(t){var e=this.__data__,r=k(e,t);return r<0?void 0:e[r][1]}const _e=ye;function be(t){return k(this.__data__,t)>-1}const ae=be;function ue(t,e){var r=this.__data__,n=k(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}const we=ue;function Re(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Re.prototype.clear=U,Re.prototype.delete=rt,Re.prototype.get=_e,Re.prototype.has=ae,Re.prototype.set=we;const Ee=Re;function Ie(){this.__data__=new Ee,this.size=0}const Fe=Ie;function Ve(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}const it=Ve;function lt(t){return this.__data__.get(t)}const ve=lt;function je(t){return this.__data__.has(t)}const Ke=je;var We=typeof global=="object"&&global&&global.Object===Object&&global;const Ue=We;var ut=typeof self=="object"&&self&&self.Object===Object&&self,gt=Ue||ut||Function("return this")();const _t=gt;var Ce=_t.Symbol;const Rt=Ce;var Ct=Object.prototype,It=Ct.hasOwnProperty,ke=Ct.toString,Pe=Rt?Rt.toStringTag:void 0;function vt(t){var e=It.call(t,Pe),r=t[Pe];try{t[Pe]=void 0;var n=!0}catch(a){}var i=ke.call(t);return n&&(e?t[Pe]=r:delete t[Pe]),i}const Tt=vt;var kt=Object.prototype,Tr=kt.toString;function Yt(t){return Tr.call(t)}const lr=Yt;var Qn="[object Null]",Mr="[object Undefined]",_r=Rt?Rt.toStringTag:void 0;function St(t){return t==null?t===void 0?Mr:Qn:_r&&_r in Object(t)?Tt(t):lr(t)}const or=St;function Xn(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}const st=Xn;var zt="[object AsyncFunction]",tt="[object Function]",At="[object GeneratorFunction]",Kt="[object Proxy]";function br(t){if(!st(t))return!1;var e=or(t);return e==tt||e==At||e==zt||e==Kt}const ur=br;var En=_t["__core-js_shared__"];const Cn=En;var Ls=function(){var t=/[^.]+$/.exec(Cn&&Cn.keys&&Cn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Fs(t){return!!Ls&&Ls in t}const $s=Fs;var Bs=Function.prototype,Xt=Bs.toString;function Bo(t){if(t!=null){try{return Xt.call(t)}catch(e){}try{return t+""}catch(e){}}return""}const Qr=Bo;var Yi=/[\\^$.*+?()[\]{}|]/g,Hs=/^\[object .+?Constructor\]$/,nl=Function.prototype,$a=Object.prototype,Ho=nl.toString,Uo=$a.hasOwnProperty,Us=RegExp("^"+Ho.call(Uo).replace(Yi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Nn(t){if(!st(t)||$s(t))return!1;var e=ur(t)?Us:Hs;return e.test(Qr(t))}const Zi=Nn;function Ci(t,e){return t==null?void 0:t[e]}const Yn=Ci;function Ji(t,e){var r=Yn(t,e);return Zi(r)?r:void 0}const Xr=Ji;var js=Xr(_t,"Map");const Zn=js;var qs=Xr(Object,"create");const Yr=qs;function zs(){this.__data__=Yr?Yr(null):{},this.size=0}const Ws=zs;function Gs(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}const jo=Gs;var Vs="__lodash_hash_undefined__",il=Object.prototype,ol=il.hasOwnProperty;function al(t){var e=this.__data__;if(Yr){var r=e[t];return r===Vs?void 0:r}return ol.call(e,t)?e[t]:void 0}const Ks=al;var qo=Object.prototype,sl=qo.hasOwnProperty;function zo(t){var e=this.__data__;return Yr?e[t]!==void 0:sl.call(e,t)}const eo=zo;var to="__lodash_hash_undefined__";function Zr(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Yr&&e===void 0?to:e,this}const Ba=Zr;function Jn(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Jn.prototype.clear=Ws,Jn.prototype.delete=jo,Jn.prototype.get=Ks,Jn.prototype.has=eo,Jn.prototype.set=Ba;const ro=Jn;function Wo(){this.size=0,this.__data__={hash:new ro,map:new(Zn||Ee),string:new ro}}const Jr=Wo;function cl(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}const Qs=cl;function Go(t,e){var r=t.__data__;return Qs(e)?r[typeof e=="string"?"string":"hash"]:r.map}const Mn=Go;function Xs(t){var e=Mn(this,t).delete(t);return this.size-=e?1:0,e}const Ys=Xs;function ll(t){return Mn(this,t).get(t)}const Zs=ll;function Ha(t){return Mn(this,t).has(t)}const no=Ha;function ei(t,e){var r=Mn(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}const Ua=ei;function hn(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}hn.prototype.clear=Jr,hn.prototype.delete=Ys,hn.prototype.get=Zs,hn.prototype.has=no,hn.prototype.set=Ua;const Ti=hn;var Vo=200;function xi(t,e){var r=this.__data__;if(r instanceof Ee){var n=r.__data__;if(!Zn||n.length<Vo-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ti(n)}return r.set(t,e),this.size=r.size,this}const ul=xi;function ti(t){var e=this.__data__=new Ee(t);this.size=e.size}ti.prototype.clear=Fe,ti.prototype.delete=it,ti.prototype.get=ve,ti.prototype.has=Ke,ti.prototype.set=ul;const ja=ti;var dl="__lodash_hash_undefined__";function hl(t){return this.__data__.set(t,dl),this}const fl=hl;function qa(t){return this.__data__.has(t)}const pl=qa;function Ko(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Ti;++e<r;)this.add(t[e])}Ko.prototype.add=Ko.prototype.push=fl,Ko.prototype.has=pl;const gl=Ko;function io(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}const Js=io;function ml(t,e){return t.has(e)}const ec=ml;var Ri=1,Ai=2;function oo(t,e,r,n,i,a){var l=r&Ri,d=t.length,m=e.length;if(d!=m&&!(l&&m>d))return!1;var v=a.get(t),E=a.get(e);if(v&&E)return v==e&&E==t;var P=-1,R=!0,I=r&Ai?new gl:void 0;for(a.set(t,e),a.set(e,t);++P<d;){var M=t[P],N=e[P];if(n)var B=l?n(N,M,P,e,t,a):n(M,N,P,t,e,a);if(B!==void 0){if(B)continue;R=!1;break}if(I){if(!Js(e,function(j,K){if(!ec(I,K)&&(M===j||i(M,j,r,n,a)))return I.push(K)})){R=!1;break}}else if(!(M===N||i(M,N,r,n,a))){R=!1;break}}return a.delete(t),a.delete(e),R}const za=oo;var vl=_t.Uint8Array;const Qo=vl;function Wa(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}const Ga=Wa;function yl(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}const _l=yl;var bl=1,wl=2,fn="[object Boolean]",Sl="[object Date]",El="[object Error]",Va="[object Map]",Ln="[object Number]",Lr="[object RegExp]",pn="[object Set]",gn="[object String]",tc="[object Symbol]",Tn="[object ArrayBuffer]",Cl="[object DataView]",Ka=Rt?Rt.prototype:void 0,Xo=Ka?Ka.valueOf:void 0;function Tl(t,e,r,n,i,a,l){switch(r){case Cl:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Tn:return!(t.byteLength!=e.byteLength||!a(new Qo(t),new Qo(e)));case fn:case Sl:case Ln:return G(+t,+e);case El:return t.name==e.name&&t.message==e.message;case Lr:case gn:return t==e+"";case Va:var d=Ga;case pn:var m=n&bl;if(d||(d=_l),t.size!=e.size&&!m)return!1;var v=l.get(t);if(v)return v==e;n|=wl,l.set(t,e);var E=za(d(t),d(e),n,i,a,l);return l.delete(t),E;case tc:if(Xo)return Xo.call(t)==Xo.call(e)}return!1}const Qa=Tl;function rc(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}const nc=rc;var ri=Array.isArray;const Ii=ri;function ic(t,e,r){var n=e(t);return Ii(t)?n:nc(n,r(t))}const xl=ic;function Yo(t,e){for(var r=-1,n=t==null?0:t.length,i=0,a=[];++r<n;){var l=t[r];e(l,r,t)&&(a[i++]=l)}return a}const Rl=Yo;function Al(){return[]}const oc=Al;var Il=Object.prototype,Zo=Il.propertyIsEnumerable,ao=Object.getOwnPropertySymbols,Pl=ao?function(t){return t==null?[]:(t=Object(t),Rl(ao(t),function(e){return Zo.call(t,e)}))}:oc;const Ol=Pl;function Xa(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}const ac=Xa;function Jo(t){return t!=null&&typeof t=="object"}const ni=Jo;var ii="[object Arguments]";function so(t){return ni(t)&&or(t)==ii}const co=so;var Ya=Object.prototype,Dl=Ya.hasOwnProperty,Za=Ya.propertyIsEnumerable,kl=co(function(){return arguments}())?co:function(t){return ni(t)&&Dl.call(t,"callee")&&!Za.call(t,"callee")};const sc=kl;function ea(){return!1}const Ja=ea;var es=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ts=es&&typeof module=="object"&&module&&!module.nodeType&&module,Nl=ts&&ts.exports===es,cc=Nl?_t.Buffer:void 0,rs=cc?cc.isBuffer:void 0,lc=rs||Ja;const ns=lc;var Ml=9007199254740991,Fr=/^(?:0|[1-9]\d*)$/;function is(t,e){var r=typeof t;return e=e==null?Ml:e,!!e&&(r=="number"||r!="symbol"&&Fr.test(t))&&t>-1&&t%1==0&&t<e}const oi=is;var Pi=9007199254740991;function ai(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Pi}const os=ai;var ta="[object Arguments]",lo="[object Array]",ra="[object Boolean]",xn="[object Date]",as="[object Error]",uc="[object Function]",Oi="[object Map]",dc="[object Number]",hc="[object Object]",na="[object RegExp]",Ll="[object Set]",Fl="[object String]",$l="[object WeakMap]",Bl="[object ArrayBuffer]",Hl="[object DataView]",Ul="[object Float32Array]",Di="[object Float64Array]",jl="[object Int8Array]",ql="[object Int16Array]",zl="[object Int32Array]",Wl="[object Uint8Array]",fc="[object Uint8ClampedArray]",Fn="[object Uint16Array]",ss="[object Uint32Array]",Wt={};Wt[Ul]=Wt[Di]=Wt[jl]=Wt[ql]=Wt[zl]=Wt[Wl]=Wt[fc]=Wt[Fn]=Wt[ss]=!0,Wt[ta]=Wt[lo]=Wt[Bl]=Wt[ra]=Wt[Hl]=Wt[xn]=Wt[as]=Wt[uc]=Wt[Oi]=Wt[dc]=Wt[hc]=Wt[na]=Wt[Ll]=Wt[Fl]=Wt[$l]=!1;function cs(t){return ni(t)&&os(t.length)&&!!Wt[or(t)]}const ls=cs;function ki(t){return function(e){return t(e)}}const $n=ki;var Rn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Or=Rn&&typeof module=="object"&&module&&!module.nodeType&&module,uo=Or&&Or.exports===Rn,ia=uo&&Ue.process,si=function(){try{var t=Or&&Or.require&&Or.require("util").types;return t||ia&&ia.binding&&ia.binding("util")}catch(e){}}();const us=si;var ci=us&&us.isTypedArray,oa=ci?$n(ci):ls;const aa=oa;var pc=Object.prototype,gc=pc.hasOwnProperty;function sa(t,e){var r=Ii(t),n=!r&&sc(t),i=!r&&!n&&ns(t),a=!r&&!n&&!i&&aa(t),l=r||n||i||a,d=l?ac(t.length,String):[],m=d.length;for(var v in t)(e||gc.call(t,v))&&!(l&&(v=="length"||i&&(v=="offset"||v=="parent")||a&&(v=="buffer"||v=="byteLength"||v=="byteOffset")||oi(v,m)))&&d.push(v);return d}const mc=sa;var vc=Object.prototype;function yc(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||vc;return t===r}const Gl=yc;function Vl(t,e){return function(r){return t(e(r))}}var ca=Vl(Object.keys,Object);const Kl=ca;var _c=Object.prototype,la=_c.hasOwnProperty;function ua(t){if(!Gl(t))return Kl(t);var e=[];for(var r in Object(t))la.call(t,r)&&r!="constructor"&&e.push(r);return e}const da=ua;function ho(t){return t!=null&&os(t.length)&&!ur(t)}const ha=ho;function Ql(t){return ha(t)?mc(t):da(t)}const Xl=Ql;function ds(t){return xl(t,Xl,Ol)}const Bn=ds;var dr=1,fa=Object.prototype,mn=fa.hasOwnProperty;function bc(t,e,r,n,i,a){var l=r&dr,d=Bn(t),m=d.length,v=Bn(e),E=v.length;if(m!=E&&!l)return!1;for(var P=m;P--;){var R=d[P];if(!(l?R in e:mn.call(e,R)))return!1}var I=a.get(t),M=a.get(e);if(I&&M)return I==e&&M==t;var N=!0;a.set(t,e),a.set(e,t);for(var B=l;++P<m;){R=d[P];var j=t[R],K=e[R];if(n)var ee=l?n(K,j,R,e,t,a):n(j,K,R,t,e,a);if(!(ee===void 0?j===K||i(j,K,r,n,a):ee)){N=!1;break}B||(B=R=="constructor")}if(N&&!B){var te=t.constructor,fe=e.constructor;te!=fe&&"constructor"in t&&"constructor"in e&&!(typeof te=="function"&&te instanceof te&&typeof fe=="function"&&fe instanceof fe)&&(N=!1)}return a.delete(t),a.delete(e),N}const Yl=bc;var Zl=Xr(_t,"DataView");const hs=Zl;var s=Xr(_t,"Promise");const x=s;var o=Xr(_t,"Set");const c=o;var f=Xr(_t,"WeakMap");const u=f;var h="[object Map]",p="[object Object]",g="[object Promise]",b="[object Set]",w="[object WeakMap]",y="[object DataView]",S=Qr(hs),C=Qr(Zn),T=Qr(x),A=Qr(c),O=Qr(u),D=or;(hs&&D(new hs(new ArrayBuffer(1)))!=y||Zn&&D(new Zn)!=h||x&&D(x.resolve())!=g||c&&D(new c)!=b||u&&D(new u)!=w)&&(D=function(t){var e=or(t),r=e==p?t.constructor:void 0,n=r?Qr(r):"";if(n)switch(n){case S:return y;case C:return h;case T:return g;case A:return b;case O:return w}return e});const q=D;var Q=1,V="[object Arguments]",ie="[object Array]",pe="[object Object]",me=Object.prototype,Se=me.hasOwnProperty;function He(t,e,r,n,i,a){var l=Ii(t),d=Ii(e),m=l?ie:q(t),v=d?ie:q(e);m=m==V?pe:m,v=v==V?pe:v;var E=m==pe,P=v==pe,R=m==v;if(R&&ns(t)){if(!ns(e))return!1;l=!0,E=!1}if(R&&!E)return a||(a=new ja),l||aa(t)?za(t,e,r,n,i,a):Qa(t,e,m,r,n,i,a);if(!(r&Q)){var I=E&&Se.call(t,"__wrapped__"),M=P&&Se.call(e,"__wrapped__");if(I||M){var N=I?t.value():t,B=M?e.value():e;return a||(a=new ja),i(N,B,r,n,a)}}return R?(a||(a=new ja),Yl(t,e,r,n,i,a)):!1}const ze=He;function ot(t,e,r,n,i){return t===e?!0:t==null||e==null||!ni(t)&&!ni(e)?t!==t&&e!==e:ze(t,e,r,n,ot,i)}const mt=ot;function Nt(t,e){return mt(t,e)}const Pt=Nt,Zt="remoteHub",$t="modes",Xe="indexMemento";class at{constructor(){this._onDidChange=new _.EventEmitter,this._onDidChangeAny=new _.EventEmitter,this.memoryState=new Map}static configure(e){Ne.state=e.workspaceState,e.subscriptions.push(_.workspace.onDidChangeConfiguration(Ne.onConfigurationChanged,Ne))}get onDidChange(){return this._onDidChange.event}get onDidChangeAny(){return this._onDidChangeAny.event}onConfigurationChanged(e){if(!e.affectsConfiguration(Zt)){this._onDidChangeAny.fire(e);return}this._onDidChangeAny.fire(e),this._onDidChange.fire(e)}set state(e){if(this._state=e,this.modes=this._state.get($t),this.modes===void 0&&(this.modes=Object.create(null)),this.memoryState.size!==0){for(const r of this.memoryState.entries())this.modes[r[0]]=r[1];this._state.update($t,this.modes).then(()=>{this.memoryState.clear()},void 0)}this.indexMemento=this._state.get(Xe),this.indexMemento===void 0&&(this.indexMemento=Object.create(null))}get(e,r,n){return n===void 0?_.workspace.getConfiguration(e===void 0?void 0:Zt,r).get(e===void 0?Zt:e):_.workspace.getConfiguration(e===void 0?void 0:Zt,r).get(e===void 0?Zt:e,n)}getMode(e,r,n){const i=e.toString(),a=this.modes!==void 0?this.modes[i]:void 0;if(a!==void 0)return{display:W.sanitize(a.display),index:$.sanitize(a.index)};if(this.memoryState.get(i),!n)return se.getDefault(r)}setMode(e,r){return this._state===void 0||this.modes===void 0?(this.memoryState.set(e.toString(),r),Promise.resolve()):(this.modes[e.toString()]=r,this._state.update($t,this.modes))}getIndexMemento(e){if(this.indexMemento!==void 0)return this.indexMemento[e.toString()]}setIndexMemento(e,r){return this.indexMemento===void 0||this._state===void 0?Promise.resolve():(this.indexMemento[e.toString()]=r,this._state.update(Xe,this.indexMemento))}getAny(e,r,n){return n===void 0?_.workspace.getConfiguration(void 0,r).get(e):_.workspace.getConfiguration(void 0,r).get(e,n)}changed(e,r,n){var i;return(i=e==null?void 0:e.affectsConfiguration(`${Zt}.${r}`,n))!=null?i:!0}inspect(e,r){return _.workspace.getConfiguration(e===void 0?void 0:Zt,r).inspect(e===void 0?Zt:e)}inspectAny(e,r){return _.workspace.getConfiguration(void 0,r).inspect(e)}async migrate(e,r,n){const i=Ne.inspect(e);if(i===void 0)return!1;let a=!1;return i.globalValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.globalValue):i.globalValue,_.ConfigurationTarget.Global),a=!0),i.workspaceValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceValue):i.workspaceValue,_.ConfigurationTarget.Workspace),a=!0),i.workspaceFolderValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceFolderValue):i.workspaceFolderValue,_.ConfigurationTarget.WorkspaceFolder),a=!0),!a&&n.fallbackValue!==void 0&&(await this.update(r,n.fallbackValue,_.ConfigurationTarget.Global),a=!0),a}async migrateIfMissing(e,r,n){const i=Ne.inspect(e);if(i===void 0)return;const a=Ne.inspect(r);i.globalValue!==void 0&&(a===void 0||a.globalValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.globalValue):i.globalValue,_.ConfigurationTarget.Global),i.workspaceValue!==void 0&&(a===void 0||a.workspaceValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceValue):i.workspaceValue,_.ConfigurationTarget.Workspace),i.workspaceFolderValue!==void 0&&(a===void 0||a.workspaceFolderValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceFolderValue):i.workspaceFolderValue,_.ConfigurationTarget.WorkspaceFolder)}name(e){return e}update(e,r,n){return _.workspace.getConfiguration(Zt).update(e,r,n)}updateAny(e,r,n,i){return _.workspace.getConfiguration(void 0,n===_.ConfigurationTarget.Global?void 0:i).update(e,r,n)}updateEffective(e,r){const n=Ne.inspect(e);return n.workspaceFolderValue!==void 0?r===n.workspaceFolderValue?Promise.resolve(void 0):Ne.update(e,r,_.ConfigurationTarget.WorkspaceFolder):n.workspaceValue!==void 0?r===n.workspaceValue?Promise.resolve(void 0):Ne.update(e,r,_.ConfigurationTarget.Workspace):n.globalValue===r||n.globalValue===void 0&&r===n.defaultValue?Promise.resolve(void 0):Ne.update(e,Pt(r,n.defaultValue)?void 0:r,_.ConfigurationTarget.Global)}getUseNewCommitApi(){let e=this.get("experimental.useNewCommitApi");return e===null&&(e=oy()),e}}const Ne=new at,ht="";var dt;(function(t){t.Off="off",t.Error="error",t.Warn="warn",t.Info="info",t.Debug="debug"})(dt||(dt={}));var jt;(function(t){t[t.Off=0]="Off",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"})(jt||(jt={}));const wt="GitHub Repositories",er="[RemoteHub]",hr=class{static configure(t,e){this._isDebugging=t.extensionMode===_.ExtensionMode.Development,this.logLevel=e}static enabled(t){return this.level>=this.toOrderedLevel(t)}static get logLevel(){return this._logLevel}static set logLevel(t){var e,r;this._logLevel=t,this.level=this.toOrderedLevel(t),t===dt.Off?((e=this.output)==null||e.dispose(),this.output=void 0):this.output=(r=this.output)!=null?r:_.window.createOutputChannel(wt)}static toOrderedLevel(t){switch(t){case dt.Off:return 0;case dt.Error:return 1;case dt.Warn:return 2;case dt.Info:return 3;case dt.Debug:return 4}}static get isDebugging(){return this._isDebugging}static debug(t,...e){hr.isDebugging&&console.log(this.timestamp,er,t!=null?t:ht,...e),!(this.output===void 0||this.level<4)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:ht}${this.toLoggableParams(!0,e)}`)}static error(t,e,...r){if(!(this.level<1&&!hr.isDebugging)){if(e===void 0){const n=t instanceof Error?t.stack:void 0;if(n){const i=/.*\s*?at\s(.+?)\s/.exec(n);i!==null&&(e=i[1])}}hr.isDebugging&&console.error(this.timestamp,er,e!=null?e:ht,...r,t),!(this.output===void 0||this.level<1)&&this.output.appendLine(`${this.timestamp} ${e!=null?e:ht}${this.toLoggableParams(!1,r)}
${String(t)}`)}}static log(t,...e){hr.isDebugging&&console.log(this.timestamp,er,t!=null?t:ht,...e),!(this.output===void 0||this.level<3)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:ht}${this.toLoggableParams(!1,e)}`)}static warn(t,...e){hr.isDebugging&&console.warn(this.timestamp,er,t!=null?t:ht,...e),!(this.output===void 0||this.level<2)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:ht}${this.toLoggableParams(!1,e)}`)}static showOutputChannel(){var t;(t=this.output)==null||t.show()}static toLoggable(t,e){if(typeof t!="object")return String(t);if(t instanceof _.Uri)return`Uri(${t.toString(!0)})`;try{return JSON.stringify(t,e)}catch{return"<error>"}}static toLoggableName(t){var e,r,n;let i;if(typeof t=="function"){if(t.prototype===void 0||t.prototype.constructor===void 0)return t.name;i=(e=t.prototype.constructor.name)!=null?e:ht}else i=(n=(r=t.constructor)==null?void 0:r.name)!=null?n:ht;const a=i.indexOf("_");return a===-1?i:i.substr(a+1)}static get timestamp(){const t=new Date;return`[${t.toISOString().replace(/T/," ").replace(/\..+/,ht)}:${`00${t.getUTCMilliseconds()}`.slice(-3)}]`}static toLoggableParams(t,e){if(e.length===0||t&&this.level<4&&!hr.isDebugging)return ht;const r=e.map(n=>this.toLoggable(n)).join(", ");return r.length!==0?` \u2014 ${r}`:ht}};let he=hr;he.level=0,he._logLevel=dt.Off;const mr=47;function Oe(t){if(t===void 0)return;const e=t.path.endsWith("/");return!e&&!t.fragment?t.toString():t.with({path:e?t.path.slice(0,-1):t.path,fragment:""}).toString()}function fr(t){if(t===void 0)return;const e=t.path.endsWith("/");return!e&&!t.query&&!t.fragment?t.toString():t.with({path:e?t.path.slice(0,-1):t.path,query:"",fragment:""}).toString()}function Hr(t,e){return`${(e==null?void 0:e.excludeScheme)?"":`${t.scheme}-`}${t.authority}${t.path.endsWith("/")?t.path.slice(0,-1):t.path}`}function bt(t){const e=t.path;let r=0,n=-1,i=!0;for(let a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===mr){if(!i){r=a+1;break}}else n===-1&&(i=!1,n=a+1);return n===-1?"":e.slice(r,n)}function xt(t){const e=t.path;if(e.length===1)return"/";let r,n=-1,i=!0;for(let a=e.length-1;a>=1;--a)if(r=e.charCodeAt(a),r===mr){if(!i){n=a;break}}else i=!1;return n===-1?"/":e.slice(0,n)}function tr(t){const e=t.path.lastIndexOf("/");return e===-1?t.with({path:"/"}):t.with({path:t.path.substring(0,e)})}function Sr(t,e){const r=typeof e=="string"?e:e.path;return r.startsWith(t.path)?_.Uri.joinPath(t,r.substr(t.path.length)):_.Uri.joinPath(t,r)}function pa(t,e){return typeof e=="string"?(e.startsWith("/")||(e=`/${e}`),An(t,e)&&t.path.substr(e.length+(e.endsWith("/")?0:1)).split("/").length===1):An(t,e)&&t.path.substr(e.path.length+(e.path.endsWith("/")?0:1)).split("/").length===1}function An(t,e){return typeof e=="string"?(e.startsWith("/")||(e=`/${e}`),e.length===1||t.path.startsWith(e.endsWith("/")?e:`${e}/`)):e.scheme===t.scheme&&e.authority===t.authority&&(e.path.length===1||t.path.startsWith(e.path.endsWith("/")?e.path:`${e.path}/`))}function Lt(t){return t&&typeof t=="object"&&"scheme"in t}const fs=class{constructor(t){this.storageService=t,this._onDidChange=new _.EventEmitter,this.cache=new Map}get onDidChange(){return this._onDidChange.event}async delete(t){const e=Oe(t),r=this.cache.has(e);this.cache.delete(e);try{await this.storageService.delete(this.getStorageKey(e))}catch(n){throw he.error(n,`Failed to delete repository metadata for ${e}`),n}!r||setTimeout(()=>this._onDidChange.fire({uri:t}),0)}async get(t){this.assertMatchingScheme(t);const e=Oe(t),r=this.cache.get(e);if(r!==void 0)return r;let n;try{n=this.fromStorage(await this.storageService.get(this.getStorageKey(e)))}catch(i){throw he.error(i,`Failed to get repository metadata for ${e}`),i}return n?this.cache.set(e,{revision:n}):this.cache.delete(e),{revision:n}}async set(t,e,r,n){this.assertMatchingScheme(t);const i=(await this.get(t)).revision!==e?"revision":void 0,a=Oe(t);if(r!==void 0&&!this.validate(r))throw new Error(`Metadata validation failed for ${t.toString()}`);const l={revision:e,cachedMetadata:r};this.cache.set(a,l);try{await this.storageService.store(this.getStorageKey(a),this.toStorage(e))}catch(d){throw this.cache.delete(a),he.error(d,`Failed to save repository metadata for ${a}`),d}(n==null?void 0:n.silent)||setTimeout(()=>this._onDidChange.fire({uri:t,reason:i}),0)}refresh(){this.cache.clear()}validate(t){var e,r,n,i,a,l,d,m;return typeof t.version=="number"&&t.version>=fs.schemaVersion&&typeof t.timestamp=="number"&&typeof((e=t.provider)==null?void 0:e.id)=="string"&&typeof t.provider.name=="string"&&typeof t.name=="string"&&t.repo&&typeof t.user=="string"&&typeof t.accessLevel=="number"&&typeof((r=t.HEAD)==null?void 0:r.type)=="number"&&typeof((n=t.HEAD)==null?void 0:n.name)=="string"&&typeof((i=t.HEAD)==null?void 0:i.sha)=="string"&&(typeof((a=t.HEAD.detached)==null?void 0:a.name)=="string"&&typeof((l=t.HEAD.detached)==null?void 0:l.type)=="number"||typeof((d=t.HEAD.branch)==null?void 0:d.name)=="string")&&typeof((m=t.defaultBranch)==null?void 0:m.name)=="string"&&typeof t.defaultBranch.sha=="string"}assertMatchingScheme(t){if(t.scheme!==Dt.scheme)throw new Error(`Uri scheme '${t.scheme}' must match configured scheme '${Dt.scheme}'; uri=${t.toString()}`)}getStorageKey(t){return`metadata/${t}`}fromStorage(t){if(!t)return;const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&Lt(n)?_.Uri.from(n):n);return e==null?void 0:e.revision}toStorage(t){const e={schemaVersion:fs.storageSchemaVersion,revision:t};return JSON.stringify(e)}};let fo=fs;fo.schemaVersion=6,fo.storageSchemaVersion=1;var Gt;(function(t){t[t.Admin=100]="Admin",t[t.Maintain=40]="Maintain",t[t.WriteToPullRequest=31]="WriteToPullRequest",t[t.Write=30]="Write",t[t.Triage=20]="Triage",t[t.Read=10]="Read",t[t.None=0]="None"})(Gt||(Gt={}));var ct;(function(t){t[t.Branch=0]="Branch",t[t.RemoteBranch=1]="RemoteBranch",t[t.Tag=2]="Tag",t[t.Commit=3]="Commit"})(ct||(ct={}));class Ur extends Error{constructor(e,r){super(typeof e=="string"?e:e.message);this.reauthenticate=r;var n;this.original=typeof e!="string"?e:void 0,(n=Error.captureStackTrace)==null||n.call(Error,this,Ur)}}class en extends Error{constructor(e,r,n){super(e.message);this.original=e,this.name=r,this.id=n;var i;(i=Error.captureStackTrace)==null||i.call(Error,this,en)}}class Ni extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,Ni)}}class Mi extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,Mi)}}class tn extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,tn)}}class li extends Error{constructor(e){super(e);var r;(r=Error.captureStackTrace)==null||r.call(Error,this,li)}}class Hn extends Error{constructor(e,r){super(e.message);this.original=e,this.duplicate=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,Hn)}}class Li extends Error{constructor(e){super(e.message);this.original=e;var r;(r=Error.captureStackTrace)==null||r.call(Error,this,Li)}}class ui extends Error{constructor(e){super(e);var r;(r=Error.captureStackTrace)==null||r.call(Error,this,ui)}}class rn extends Error{constructor(e=!1){super(e?"Unable to sync the repository":"Unable to fetch the repository");var r;(r=Error.captureStackTrace)==null||r.call(Error,this,rn)}}class In extends Error{constructor(){super("Sync operation will result in conflicts");var e;(e=Error.captureStackTrace)==null||e.call(Error,this,In)}}class di extends Error{constructor(){super("Failed to create and push commit");var e;(e=Error.captureStackTrace)==null||e.call(Error,this,di)}}class Pn extends Error{constructor(e){var r;const n=typeof e=="string"?e:Dt.getProviderId(e);super(`No provider registered with ${n}`);this.id=n,(r=Error.captureStackTrace)==null||r.call(Error,this,Pn)}}const ps=/^[0-9a-f]{40}$/i;function Rr(t){return t!==void 0&&ps.test(t)}const hi=/^[^/](?!.*\/\.)(?!.*\.\.)(?!.*\/\/)(?!.*@\{)[^\000-\037\177 ~^:?*[\\]+[^./]$/;function nn(t){return hi.test(t)}function pr(t){return t===""||t==="~"||t==="HEAD"?t:t.endsWith("^")?`${t.substr(0,7)}^`:t.substr(0,7)}var Ye;(function(t){t[t.Branch=0]="Branch",t[t.Tag=1]="Tag",t[t.Commit=2]="Commit",t[t.PullRequest=3]="PullRequest",t[t.Tree=4]="Tree"})(Ye||(Ye={}));var Dr;(function(t){t.GitHub="github",t.AzureRepos="azurerepos"})(Dr||(Dr={}));class po{constructor(e,r,n,i,a){this.providerService=e,this.uri=r,this.id=n,this.name=i,this.provider={id:a.id,name:a.name}}get canonicalUri(){return this.providerService.getVirtualCanonicalRootUri(this.uri)}createRelativeUri(e){return this.providerService.createRelativeUri(this.uri,e)}async getMetadata(){const e=await this.providerService.getMetadata(this.uri);if(!e)throw new Error(`Unable to find metadata for ${this.uri.toString()}`);return e}async getIndexMetadata(){return this.providerService.getIndexMetadata(this.uri)}getUriMetadata(){return this.providerService.getVirtualUriMetadata(this.uri)}}var rr;(function(t){t[t.Repository=0]="Repository",t[t.PullRequest=1]="PullRequest",t[t.Branch=2]="Branch",t[t.Commit=3]="Commit",t[t.File=4]="File"})(rr||(rr={}));var Er;(function(t){t[t.Clone=-1]="Clone",t[t.Repository=0]="Repository",t[t.PullRequest=1]="PullRequest",t[t.Branch=2]="Branch",t[t.Commit=3]="Commit",t[t.Tag=4]="Tag"})(Er||(Er={}));var Un;(function(t){t[t.Open=0]="Open",t[t.Closed=1]="Closed",t[t.Merged=2]="Merged"})(Un||(Un={}));var Bt;(function(t){t[t.NotIndexed=0]="NotIndexed",t[t.Indexed=1]="Indexed",t[t.Match=2]="Match",t[t.Active=3]="Active"})(Bt||(Bt={})),function(t){function e(r){return r!==void 0&&(r===t.Indexed||r===t.Match||r===t.Active)}t.hasIndex=e}(Bt||(Bt={}));var ga;(function(t){function e(r){return r!==void 0&&r.type===3}t.isActive=e})(ga||(ga={}));var jr;(function(t){t[t.Latest=1]="Latest",t[t.SHA=2]="SHA"})(jr||(jr={}));var fi;(function(t){function e(r){const n=Dt.decodeAuthority(r).metadata;if(!(n===void 0||n.idx===void 0)){if(n.idx==="latest")return{type:1};if(Rr(n.idx))return{type:2,sha:n.idx}}}t.decode=e})(fi||(fi={}));function*vn(t,e){for(const r of t)yield*e(r)}function*Jl(t,e){for(const r of t)e(r)&&(yield r)}function*ma(t,e){for(const r of t){const n=e(r);n!=null&&(yield n)}}function va(t,e){for(const r of t)if(e(r))return r}function eu(t,e){let r="";const n=t[Symbol.iterator]();let i=n.next();if(i.done)return r;for(;;){const a=i.value.toString();if(i=n.next(),i.done){r+=a;break}r+=a,r+=e}return r}function*go(t,e){for(const r of t)yield e(r)}function mo(t,e){for(const r of t)if(e(r))return!0;return!1}function*tu(...t){for(const e of t)for(const r of e)yield r}function*ru(t){const e=new Set;for(const r of t)e.has(r)||(e.add(r),yield r)}const nu="";function gs(...t){if(t.length===1){const e=t[0];return e===void 0?nu:typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"||e instanceof Error?String(e):e instanceof _.Uri?e.toString():JSON.stringify(e)}return JSON.stringify(t)}function yn(t){return(e,r,n)=>{let i;if(typeof n.value=="function"?i=n.value:typeof n.get=="function"&&(i=n.get),i===void 0)throw new Error("Not supported");const a=`$serialize$${r}`;n.value=function(...l){const d=l.length===0?a:`${a}$${(t!=null?t:gs)(...l)}`;Object.prototype.hasOwnProperty.call(this,d)||Object.defineProperty(this,d,{configurable:!1,enumerable:!1,writable:!0,value:void 0});let m=this[d];const v=()=>i.apply(this,l);return m===void 0?m=v():m=m.then(v,v),this[d]=m,m}}}const _n=require("process");let ms=0;function Y(){return ms===Number.MAX_SAFE_INTEGER&&(ms=0),++ms}const de=class{constructor(t,e,...r){this.context=t,this.instance=`[${Y().toString().padStart(5)}] `;var n,i,a,l,d,m;let v;if(typeof(e==null?void 0:e.log)=="boolean"?v=e.log?{}:void 0:v=(n=e==null?void 0:e.log)!=null?n:{},this.logLevel=(i=e==null?void 0:e.logLevel)!=null?i:dt.Info,this.time=(0,_n.hrtime)(),v){if(!he.enabled(this.logLevel))return;r.length?Ze(this.logLevel,`${this.instance}${(a=v.prefix)!=null?a:""}${t}${(l=v.message)!=null?l:""}`,...r):Ze(this.logLevel,`${this.instance}${(d=v.prefix)!=null?d:""}${t}${(m=v.message)!=null?m:""}`)}}log(t){this.logCore(this.context,t,!1)}logStep(t,e){(!t||e)&&this.logCore(this.context,e,!1),this.step=t?{time:(0,_n.hrtime)(),label:t}:void 0}restart(t){this.logCore(this.context,t,!0),this.step=void 0,this.time=(0,_n.hrtime)()}stop(t){this.restart(t)}logCore(t,e,r){var n,i,a,l,d,m,v;if(!he.enabled(this.logLevel))return;let E="";if(this.step){const[M,N]=(0,_n.hrtime)(this.step.time),B=M*1e3+Math.floor(N/1e6);E=`${this.step.label?`${this.step.label} took `:""}${B} ms`}if(!r){Ze(this.logLevel,`${this.instance}${(n=e==null?void 0:e.prefix)!=null?n:""}${t}${(i=e==null?void 0:e.message)!=null?i:""}${E?` ${E}`:""}${(a=e==null?void 0:e.suffix)!=null?a:""}`);return}const[P,R]=(0,_n.hrtime)(this.time),I=P*1e3+Math.floor(R/1e6);Ze(I>500?dt.Warn:this.logLevel,`${this.instance}${(l=e==null?void 0:e.prefix)!=null?l:""}${t}${(d=e==null?void 0:e.message)!=null?d:""}${(m=e==null?void 0:e.took)!=null?m:" took "}${I} ms${E?` (${E})`:""}${(v=e==null?void 0:e.suffix)!=null?v:""}`)}static start(t,e,...r){var n;(n=de.watches.get(t))==null||n.log(),de.watches.set(t,new de(t,e,...r))}static log(t,e){var r;(r=de.watches.get(t))==null||r.log(e)}static stop(t,e){var r;(r=de.watches.get(t))==null||r.stop(e),de.watches.delete(t)}};let ce=de;ce.watches=new Map;function Ze(t,e,...r){switch(t){case dt.Warn:he.warn(e,...r);break;case dt.Info:he.log(e,...r);break;default:he.debug(e,...r);break}}function nt(t){return Buffer.from(t,"utf8").toString("hex")}function ft(t){return Buffer.from(t,"hex").toString("utf8")}var yt=__webpack_require__(6724),Ht=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,bn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Ut(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&Ht(e,r,i),i},sr;(function(t){t[t.Abort=0]="Abort",t[t.KeepCurrent=1]="KeepCurrent",t[t.DiscardCurrent=2]="DiscardCurrent",t[t.Merge=3]="Merge"})(sr||(sr={}));const Vt=class{constructor(t,e){this.metadataStore=t,this.telemetryService=e,this._providers=new Map,this._onDidChangeProviders=new _.EventEmitter,this._repositories=new Map,this._onDidChangeRepositories=new _.EventEmitter,this._onDidChangeRepository=new _.EventEmitter,this._onDidSyncRepository=new _.EventEmitter,this._onDidRefresh=new _.EventEmitter,this._onWillRefresh=new _.EventEmitter,this.pendingMetadataRequests=new Map,this.disposable=_.Disposable.from(_.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this),t.onDidChange(r=>this.onMetadataChanged(r)))}get onDidChangeProviders(){return this._onDidChangeProviders.event}get onDidChangeRepositories(){return this._onDidChangeRepositories.event}get onDidChangeRepository(){return this._onDidChangeRepository.event}get onDidSyncRepository(){return this._onDidSyncRepository.event}get onDidRefresh(){return this._onDidRefresh.event}get onWillRefresh(){return this._onWillRefresh.event}dispose(){this.disposable.dispose(),this._providers.clear(),this._repositories.clear()}onMetadataChanged(t){const e=this._repositories.get(Oe(t.uri));!e||(he.log(`VirtualProviderService.onMetadataChanged(${t.uri.toString()}, reason=${t.reason}): Firing onDidChangeRepository...`),this._onDidChangeRepository.fire({repository:e,reason:t.reason==="revision"?"HEAD":void 0}))}onWorkspaceFoldersChanged(t){if(t.added.length)for(const e of t.added){const r=Oe(e.uri);if(e.uri.scheme!==Vt.scheme||this._repositories.has(r))continue;const n=this.getProvider(e.uri);if(!n)continue;this._repositories.set(r,null);const{repo:i,name:a}=this.getVirtualUriMetadata(e.uri),l=new po(this,e.uri,i,a,n);this._repositories.set(r,l),this._onDidChangeRepositories.fire({added:[l],removed:[]}),this.telemetryService.sendEvent("repository.opened",{provider:n.id,repositories:this._repositories.size.toString()})}if(t.removed.length)for(const e of t.removed){const r=Oe(e.uri);if(e.uri.scheme!==Vt.scheme||!this._repositories.has(r))continue;const n=this._repositories.get(r);this._repositories.delete(r),n&&(this._onDidChangeRepositories.fire({added:[],removed:[n]}),this.telemetryService.sendEvent("repository.closed",{repositories:this._repositories.size.toString()}))}_a(Eo.HasVirtualFolders,this._repositories.size!==0),_a(Eo.VirtualFolderProviders,eu(ru(go(this.getRepositories(),e=>e.provider.id)),","))}get hasProviders(){return this._providers.size!==0}get registeredProviders(){return[...go(this._providers.values(),t=>({id:t.id,name:t.name}))]}get repositories(){return[...this.getRepositories()]}register(t,e,r,n,i){var a;if(this._providers.has(t))throw new Error(`Provider '${t}' has already been registered`);const l={id:t,name:e,provider:r,fs:n,index:i};return this._providers.set(t,l),this._onDidChangeProviders.fire({added:[l],removed:[]}),this.telemetryService.sendEvent("provider.registered",{provider:t}),this.onWorkspaceFoldersChanged({added:(a=_.workspace.workspaceFolders)!=null?a:[],removed:[]}),{dispose:()=>{this._providers.delete(t);const d=[];for(const[m,v]of[...this._repositories])(v==null?void 0:v.provider.id)===t&&(this._repositories.delete(m),d.push(v));this._onDidChangeRepositories.fire({added:[],removed:d}),this._onDidChangeProviders.fire({added:[],removed:[l]})}}}refresh(){if(this._providers.size===0)return;const t=[],e=[];for(const r of this._providers.values())t.push(...go(this.getRepositories(r.id),n=>n.uri)),r.index!==void 0&&e.push(r.index);this._onWillRefresh.fire(t),this.metadataStore.refresh(),e.forEach(r=>r.refresh(t)),this._onDidRefresh.fire(t)}getRegisteredProvider(t){const e=this.getProvider(t);return e?{id:e.id,name:e.name}:void 0}getRepository(t,e){const r=_.workspace.getWorkspaceFolder(t);if(!r||r.uri.scheme!==Vt.scheme)return;const n=this._repositories.get(Oe(r.uri));if(!(e!==void 0&&(n==null?void 0:n.provider.id)!==e))return n!=null?n:void 0}getRepositories(t){return Jl(this._repositories.values(),e=>e!==null&&(!t||e.provider.id===t))}getOpenUris(t,e){const r=new Map,n=_.workspace.textDocuments;if(n.length===0)return r;for(const i of n)i.uri.scheme===t&&e.some(a=>An(i.uri,a))&&r.set(Oe(i.uri),i.uri);return r}hasProvider(t,e){const r=typeof t=="string"?t:Vt.getProviderId(t),n=this._providers.get(r);return e!==void 0&&(n==null?void 0:n.id)!==e?!1:n!==void 0}isReadonly(t){var e;return Boolean((e=this.getProvider(t))==null?void 0:e.provider.isReadonly)}getProvider(t){const e=typeof t=="string"?t:Vt.getProviderId(t);return this._providers.get(e)}getRepositoryProvider(t){var e;const r=(e=this.getProvider(t))==null?void 0:e.provider;if(r)return r;throw new Pn(t)}getFileSystemProvider(t){var e;const r=(e=this.getProvider(t))==null?void 0:e.fs;if(r)return r;throw new Pn(t)}getRemoteWorkspaceSourceProviders(t){var e,r,n,i;return t?(i=(n=(e=this.getProvider(t))==null?void 0:(r=e.provider).getRemoteWorkspaceSourceProviders)==null?void 0:n.call(r))!=null?i:[]:[...vn(this._providers.values(),a=>{var l,d,m;return(m=(d=(l=a.provider).getRemoteWorkspaceSourceProviders)==null?void 0:d.call(l))!=null?m:[]})]}isInWorkspace(t){return this.getVirtualWorkspaceUri(t)!==void 0}getAuthentication(t){const e=this.getProvider(t);if(!e)throw new Pn(t);return e==null?void 0:e.provider.getAuthentication(t)}canOpenRemoteUrl(t,e){if(e){const r=this.getProvider(e),n=r==null?void 0:r.provider.canOpenRemoteUrl(t);return n!==void 0?{provider:r,urlType:n}:void 0}for(const r of this._providers.values()){const n=r.provider.canOpenRemoteUrl(t);if(n!==void 0)return{provider:r,urlType:n}}}async createWorkspaceForRemoteUrl(t,e,r=nr.CurrentWindow){var n;const i=this.canOpenRemoteUrl(t,e);return(n=i==null?void 0:i.provider)==null?void 0:n.provider.createWorkspaceForRemoteUrl(t,r)}createProviderUri(t,e,r){return this.getProviderUri(this.getRepositoryProvider(t).createVirtualUri(Vt.baseVirtualWorkspaceUri,e,r))}createRelativeProviderUri(t,e){return this.getProviderUri(this.createRelativeUri(t,e))}createRelativeUri(t,e){const r=this.getProviderRootUri(t);let n=`${r.path}/`;n.endsWith("/")&&(n=n.slice(0,-1));const i=r.with({path:`${r.path}/${e.startsWith("/")?e.substr(1):e}`});return t.scheme===Vt.scheme?this.getVirtualUri(i):i}createRelativeVirtualUri(t,e){return this.getVirtualUri(this.createRelativeUri(t,e))}createVirtualUri(t,e,r){return this.getRepositoryProvider(t).createVirtualUri(Vt.baseVirtualWorkspaceUri,e,r)}async getBestRemoteUri(t,e){const{provider:r,repo:n,ref:i}=this.getVirtualUriMetadata(t);if(e===Er.Repository)return this.getRemoteUri(r.id,{repo:n});if(e===Er.Clone)return this.getRemoteUri(r.id,{repo:n,clone:!0});if(e===Er.PullRequest||e===void 0&&(i==null?void 0:i.type)===Ye.PullRequest){if((i==null?void 0:i.type)===Ye.PullRequest)return this.getRemoteUri(r.id,{repo:n,pullRequest:{id:i.id}});const{pullRequest:a}=await this.getMetadata(t);if(e===Er.PullRequest&&a)return this.getRemoteUri(r.id,{repo:n,pullRequest:{id:a.id}})}if(e===Er.Branch||e===void 0&&(i==null?void 0:i.type)===Ye.Branch){if((i==null?void 0:i.type)===Ye.Branch)return this.getRemoteUri(r.id,{repo:n,branch:i.id});const{HEAD:a}=await this.getMetadata(t);if(a.type===ct.Branch||a.type===ct.RemoteBranch&&e===Er.Branch)return this.getRemoteUri(r.id,{repo:n,branch:a.branch.name})}if(e===Er.Tag||e===void 0&&(i==null?void 0:i.type)===Ye.Tag){if((i==null?void 0:i.type)===Ye.Tag)return this.getRemoteUri(r.id,{repo:n,tag:i.id});const{HEAD:a}=await this.getMetadata(t);if(a.type===ct.Tag)return this.getRemoteUri(r.id,{repo:n,tag:a.detached.name})}if(e===Er.Commit||e===void 0&&((i==null?void 0:i.type)===Ye.Commit||(i==null?void 0:i.type)===Ye.Tree&&Rr(i.id))){if((i==null?void 0:i.type)===Ye.Commit||(i==null?void 0:i.type)===Ye.Tree&&Rr(i.id))return this.getRemoteUri(r.id,{repo:n,sha:i.id});const{HEAD:a}=await this.getMetadata(t);if(e===Er.Commit||a.type===ct.Commit)return this.getRemoteUri(r.id,{repo:n,sha:a.sha})}if(e===void 0)return this.getRemoteUri(r.id,{repo:n})}getCanonicalUri(t){let{authority:e}=t;const r=e.indexOf(Vt.authoritySeparator);return r!==-1&&(e=e.substr(0,r)),t.with({authority:e})}getRemoteUri(t,e){var r,n;return(n=(r=this.getRepositoryProvider(t)).getRemoteUri)==null?void 0:n.call(r,e)}getProviderUri(t){return t.scheme!==Vt.scheme?t:t.with({scheme:Vt.getProviderId(t)})}getProviderRootUri(t){return t=this.getProviderUri(t),this.getRepositoryProvider(t).getProviderRootUri(t)}getRelativeFilePath(t,e){return e=this.getProviderUri(e!=null?e:t),this.getRepositoryProvider(e).getRelativeFilePath(t,e)}getVirtualUriMetadata(t){return this.getRepositoryProvider(t).getVirtualUriMetadata(t)}getVirtualUri(t){return t.scheme===Vt.scheme?t:t.with({scheme:Vt.scheme})}getVirtualCanonicalRootUri(t){const e=this.getVirtualUri(this.getProviderRootUri(t));let{authority:r}=e;const n=r.indexOf(Vt.authoritySeparator);return n!==-1&&(r=r.substr(0,n)),e.with({authority:r})}getVirtualRootUri(t){return this.getVirtualUri(this.getProviderRootUri(t))}getVirtualWorkspaceUri(t){var e;return(e=_.workspace.getWorkspaceFolder(this.getVirtualUri(t)))==null?void 0:e.uri}createIGitRepository(t,e,r,n){var i,a;return(a=(i=this.getRepositoryProvider(t)).createIGitRepository)==null?void 0:a.call(i,t,e,r,n)}async getCommitOperations(t,e,r){let n;return(r==null?void 0:r.staged)?(n=await e.getStagedChanges(t),n.length===0&&r.staged==="auto"&&(n=await e.getChanges(t))):n=await e.getChanges(t),n.map(a=>{const l=this.getRelativeFilePath(t,a.uri);switch(a.type){case Ot.Created:return{type:a.type,path:l,fileType:a.fileType,content:e.readFile(a.uri).then(d=>d!=null?d:new Uint8Array)};case Ot.Changed:return{type:a.type,path:l,fileType:a.fileType,content:e.readFile(a.uri).then(d=>d!=null?d:new Uint8Array)};case Ot.Deleted:return{type:a.type,path:l,fileType:a.fileType,content:void 0}}})}async getMetadata(t){return{...await this.getMetadataCore(this.getVirtualRootUri(t)),path:this.getRelativeFilePath(t,t)}}async getIndexMetadata(t){const e=this.getProvider(t);return(e==null?void 0:e.index)?e.index.getIndexMetadata(t):void 0}getModeConfig(t,e,r){return Ne.getMode(this.getVirtualRootUri(t),e,Boolean(r))}async getModeRefType(t,e){return t=this.getVirtualRootUri(t),this.getRepositoryProvider(t).getModeRefType(t,e)}getIndexProvider(t){var e;return(e=this.getProvider(t))==null?void 0:e.index}async getMetadataCore(t){const e=Oe(t);let r=this.pendingMetadataRequests.get(e);if(r)return r;let{revision:n,cachedMetadata:i}=await this.metadataStore.get(t);if(i!==void 0)return i;const a=this.getProvider(t);if(!a)throw new Pn(t);const l=fi.decode(t);(l==null?void 0:l.type)===jr.SHA&&(n=l.sha),r=a.provider.createMetadata(t,n),this.pendingMetadataRequests.set(e,r);try{const d=await r;return await this.updateMetadataCore(t,d,{silent:!0}),d}finally{this.pendingMetadataRequests.delete(e)}}async updateMetadata(t,e){const r=new ce(`VirtualProviderService.updateMetadata(${t.toString()})`,{},e.HEAD.sha);try{await this.metadataStore.set(this.getVirtualUri(t),e.HEAD.sha,e)}finally{r.stop()}}updateMetadataCore(t,e,r){return this.metadataStore.set(this.getVirtualUri(t),e.HEAD.sha,e,r)}async clone(t){const e=await this.getBestRemoteUri(t,Er.Clone);if(!e)throw new Error("No url found for clone");if(So)return void _.env.openExternal(_.Uri.parse(`${_.env.uriScheme}://vscode.git/clone?url=${encodeURIComponent(e.toString(!0))}`));try{const r=_.extensions.getExtension("vscode.git");if(r)await(r==null?void 0:r.activate()),await _.commands.executeCommand("git.clone",e.toString(!0));else throw new Error("Git extension not found")}catch(r){he.error(r,"Unable to clone repository")}}createBranch(t,e,r,n){return this.getRepositoryProvider(t).createBranch(t,e,r,n)}createCommit(t,e,r,n){return this.getRepositoryProvider(t).createCommit(t,e,r,n)}createAndPushCommit(t,e,r,n,i){return this.getRepositoryProvider(t).createAndPushCommit(t,e,r,n,i)}createPullRequest(t,e,r,n,i){return this.getRepositoryProvider(t).createPullRequest(t,e,r,n,i)}fetch(t,e){return this.getRepositoryProvider(t).fetch(t,e)}fork(t){return this.getRepositoryProvider(t).fork(t)}getBranches(t,e){return this.getRepositoryProvider(t).getBranches(t,e)}getCommit(t,e){return this.getRepositoryProvider(t).getCommit(t,e)}getCommits(t,e){var r;return(r=this.getRepositoryProvider(t))==null?void 0:r.getCommits(t,e)}compareCommits(t,e){var r;return(r=this.getRepositoryProvider(t))==null?void 0:r.compareCommits(t,e)}getFileContent(t,e,r){return this.getRepositoryProvider(t).getFileContent(t,e,r)}getFork(t){return this.getRepositoryProvider(t).getFork(t)}async getIncomingChanges(t){var e,r,n;return(n=(r=(e=this.getRepositoryProvider(t)).getIncomingChanges)==null?void 0:r.call(e,t))!=null?n:[]}getPullRequest(t,e){return this.getRepositoryProvider(t).getPullRequest(t,e)}getTags(t,e){return this.getRepositoryProvider(t).getTags(t,e)}getSnapshots(t,e){var r,n;return(n=(r=this.getIndexProvider(t))==null?void 0:r.getSnapshots(t,e))!=null?n:Promise.resolve([])}async getTarGz(t){var e,r;return(r=(e=this.getRepositoryProvider(t)).getTarGz)==null?void 0:r.call(e,t)}pushCommit(t,e,r,n){return this.getRepositoryProvider(t).pushCommit(t,e,r,n)}switchTo(t,e,r){return this.getRepositoryProvider(t).switchTo(t,e,r)}async sync(t,e,r){const n=this._repositories.get(Oe(t));n&&this._onDidSyncRepository.fire({repository:n,syncing:!0});try{const i=this.getProvider(t);if(i===void 0)throw new Pn(t);let{to:a,reason:l,...d}=r!=null?r:{};return a===void 0&&i.index&&(a=await i.index.resolveIndexRef(t,l==="user")),await i.provider.sync(t,e,{conflictResolution:0,...d,to:a})}finally{n&&this._onDidSyncRepository.fire({repository:n,syncing:!1})}}stat(t){return this.getFileSystemProvider(t).stat(t)}readDirectory(t){return this.getFileSystemProvider(t).readDirectory(t)}readFile(t){return this.getFileSystemProvider(t).readFile(t)}watch(t,e){return this.getFileSystemProvider(t).watch(t,e)}provideFileSearchResults(t,e,r){return this.getFileSystemProvider(e.folder).provideFileSearchResults(t,e,r)}provideTextSearchResults(t,e,r,n){return this.getFileSystemProvider(e.folder).provideTextSearchResults(t,e,r,n)}static decodeAuthority(t,e){const[r,n]=t.authority.split(Vt.authoritySeparator);let i;if(n)try{const a=JSON.parse(ft(n));i=e?e(a):a}catch{}return{scheme:r,metadata:i}}static encodeAuthority(t,e){const r=e?`${Vt.authoritySeparator}${nt(JSON.stringify(e))}`:"";return`${t}${r}`}static getProviderId(t){const{authority:e}=t,r=e.indexOf(Vt.authoritySeparator);return r!==-1?e.substr(0,r):e}static isCanonicalUri(t){return t.authority.indexOf(Vt.authoritySeparator)===-1}};let Dt=Vt;Dt.scheme="vscode-vfs",Dt.authoritySeparator="+",Dt.baseVirtualWorkspaceUri=_.Uri.parse(`${Vt.scheme}://`),bn([yn()],Dt.prototype,"getMetadataCore",1);function Ar(){}Ar.prototype={diff:function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n.callback;typeof n=="function"&&(i=n,n={}),this.options=n;var a=this;function l(N){return i?(setTimeout(function(){i(void 0,N)},0),!0):N}e=this.castInput(e),r=this.castInput(r),e=this.removeEmpty(this.tokenize(e)),r=this.removeEmpty(this.tokenize(r));var d=r.length,m=e.length,v=1,E=d+m,P=[{newPos:-1,components:[]}],R=this.extractCommon(P[0],r,e,0);if(P[0].newPos+1>=d&&R+1>=m)return l([{value:this.join(r),count:r.length}]);function I(){for(var N=-1*v;N<=v;N+=2){var B=void 0,j=P[N-1],K=P[N+1],ee=(K?K.newPos:0)-N;j&&(P[N-1]=void 0);var te=j&&j.newPos+1<d,fe=K&&0<=ee&&ee<m;if(!te&&!fe){P[N]=void 0;continue}if(!te||fe&&j.newPos<K.newPos?(B=od(K),a.pushComponent(B.components,void 0,!0)):(B=j,B.newPos++,a.pushComponent(B.components,!0,void 0)),ee=a.extractCommon(B,r,e,N),B.newPos+1>=d&&ee+1>=m)return l(Sh(a,B.components,r,e,a.useLongestToken));P[N]=B}v++}if(i)(function N(){setTimeout(function(){if(v>E)return i();I()||N()},0)})();else for(;v<=E;){var M=I();if(M)return M}},pushComponent:function(e,r,n){var i=e[e.length-1];i&&i.added===r&&i.removed===n?e[e.length-1]={count:i.count+1,added:r,removed:n}:e.push({count:1,added:r,removed:n})},extractCommon:function(e,r,n,i){for(var a=r.length,l=n.length,d=e.newPos,m=d-i,v=0;d+1<a&&m+1<l&&this.equals(r[d+1],n[m+1]);)d++,m++,v++;return v&&e.components.push({count:v}),e.newPos=d,m},equals:function(e,r){return this.options.comparator?this.options.comparator(e,r):e===r||this.options.ignoreCase&&e.toLowerCase()===r.toLowerCase()},removeEmpty:function(e){for(var r=[],n=0;n<e.length;n++)e[n]&&r.push(e[n]);return r},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function Sh(t,e,r,n,i){for(var a=0,l=e.length,d=0,m=0;a<l;a++){var v=e[a];if(v.removed){if(v.value=t.join(n.slice(m,m+v.count)),m+=v.count,a&&e[a-1].added){var P=e[a-1];e[a-1]=e[a],e[a]=P}}else{if(!v.added&&i){var E=r.slice(d,d+v.count);E=E.map(function(I,M){var N=n[m+M];return N.length>I.length?N:I}),v.value=t.join(E)}else v.value=t.join(r.slice(d,d+v.count));d+=v.count,v.added||(m+=v.count)}}var R=e[l-1];return l>1&&typeof R.value=="string"&&(R.added||R.removed)&&t.equals("",R.value)&&(e[l-2].value+=R.value,e.pop()),e}function od(t){return{newPos:t.newPos,components:t.components.slice(0)}}var Eh=new Ar;function Cp(t,e,r){return Eh.diff(t,e,r)}function ad(t,e){if(typeof t=="function")e.callback=t;else if(t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var sd=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,cd=/\S/,wc=new Ar;wc.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!cd.test(t)&&!cd.test(e)},wc.tokenize=function(t){for(var e=t.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),r=0;r<e.length-1;r++)!e[r+1]&&e[r+2]&&sd.test(e[r])&&sd.test(e[r+2])&&(e[r]+=e[r+2],e.splice(r+1,2),r--);return e};function Tp(t,e,r){return r=ad(r,{ignoreWhitespace:!0}),wc.diff(t,e,r)}function xp(t,e,r){return wc.diff(t,e,r)}var Sc=new Ar;Sc.tokenize=function(t){var e=[],r=t.split(/(\n|\r\n)/);r[r.length-1]||r.pop();for(var n=0;n<r.length;n++){var i=r[n];n%2&&!this.options.newlineIsToken?e[e.length-1]+=i:(this.options.ignoreWhitespace&&(i=i.trim()),e.push(i))}return e};function Ch(t,e,r){return Sc.diff(t,e,r)}function iu(t,e,r){var n=ad(r,{ignoreWhitespace:!0});return Sc.diff(t,e,n)}var Ec=new Ar;Ec.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};function Rp(t,e,r){return Ec.diff(t,e,r)}var ld=new Ar;ld.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function Th(t,e,r){return ld.diff(t,e,r)}function Cc(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cc=function(e){return typeof e}:Cc=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cc(t)}function pi(t){return xh(t)||ud(t)||Rh(t)||Ah()}function xh(t){if(Array.isArray(t))return ou(t)}function ud(t){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(t))return Array.from(t)}function Rh(t,e){if(!!t){if(typeof t=="string")return ou(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ou(t,e)}}function ou(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ah(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var au=Object.prototype.toString,ya=new Ar;ya.useLongestToken=!0,ya.tokenize=Sc.tokenize,ya.castInput=function(t){var e=this.options,r=e.undefinedReplacement,n=e.stringifyReplacer,i=n===void 0?function(a,l){return typeof l=="undefined"?r:l}:n;return typeof t=="string"?t:JSON.stringify(su(t,null,null,i),i,"  ")},ya.equals=function(t,e){return Ar.prototype.equals.call(ya,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Ap(t,e,r){return ya.diff(t,e,r)}function su(t,e,r,n,i){e=e||[],r=r||[],n&&(t=n(i,t));var a;for(a=0;a<e.length;a+=1)if(e[a]===t)return r[a];var l;if(au.call(t)==="[object Array]"){for(e.push(t),l=new Array(t.length),r.push(l),a=0;a<t.length;a+=1)l[a]=su(t[a],e,r,n,i);return e.pop(),r.pop(),l}if(t&&t.toJSON&&(t=t.toJSON()),Cc(t)==="object"&&t!==null){e.push(t),l={},r.push(l);var d=[],m;for(m in t)t.hasOwnProperty(m)&&d.push(m);for(d.sort(),a=0;a<d.length;a+=1)m=d[a],l[m]=su(t[m],e,r,n,m);e.pop(),r.pop()}else l=t;return l}var vo=new Ar;vo.tokenize=function(t){return t.slice()},vo.join=vo.removeEmpty=function(t){return t};function dd(t,e,r){return vo.diff(t,e,r)}function yo(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.split(/\r\n|[\n\v\f\r\x85]/),n=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],i=[],a=0;function l(){var v={};for(i.push(v);a<r.length;){var E=r[a];if(/^(\-\-\-|\+\+\+|@@)\s/.test(E))break;var P=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(E);P&&(v.index=P[1]),a++}for(d(v),d(v),v.hunks=[];a<r.length;){var R=r[a];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(R))break;if(/^@@/.test(R))v.hunks.push(m());else{if(R&&e.strict)throw new Error("Unknown line "+(a+1)+" "+JSON.stringify(R));a++}}}function d(v){var E=/^(---|\+\+\+)\s+(.*)$/.exec(r[a]);if(E){var P=E[1]==="---"?"old":"new",R=E[2].split("	",2),I=R[0].replace(/\\\\/g,"\\");/^".*"$/.test(I)&&(I=I.substr(1,I.length-2)),v[P+"FileName"]=I,v[P+"Header"]=(R[1]||"").trim(),a++}}function m(){var v=a,E=r[a++],P=E.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),R={oldStart:+P[1],oldLines:typeof P[2]=="undefined"?1:+P[2],newStart:+P[3],newLines:typeof P[4]=="undefined"?1:+P[4],lines:[],linedelimiters:[]};R.oldLines===0&&(R.oldStart+=1),R.newLines===0&&(R.newStart+=1);for(var I=0,M=0;a<r.length&&!(r[a].indexOf("--- ")===0&&a+2<r.length&&r[a+1].indexOf("+++ ")===0&&r[a+2].indexOf("@@")===0);a++){var N=r[a].length==0&&a!=r.length-1?" ":r[a][0];if(N==="+"||N==="-"||N===" "||N==="\\")R.lines.push(r[a]),R.linedelimiters.push(n[a]||`
`),N==="+"?I++:N==="-"?M++:N===" "&&(I++,M++);else break}if(!I&&R.newLines===1&&(R.newLines=0),!M&&R.oldLines===1&&(R.oldLines=0),e.strict){if(I!==R.newLines)throw new Error("Added line count did not match for hunk at line "+(v+1));if(M!==R.oldLines)throw new Error("Removed line count did not match for hunk at line "+(v+1))}return R}for(;a<r.length;)l();return i}function cu(t,e,r){var n=!0,i=!1,a=!1,l=1;return function d(){if(n&&!a){if(i?l++:n=!1,t+l<=r)return l;a=!0}if(!i)return a||(n=!0),e<=t-l?-l++:(i=!0,d())}}function hd(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string"&&(e=yo(e)),Array.isArray(e)){if(e.length>1)throw new Error("applyPatch only works with a single input.");e=e[0]}var n=t.split(/\r\n|[\n\v\f\r\x85]/),i=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],a=e.hunks,l=r.compareLine||function(wi,kn,Si,Ei){return kn===Ei},d=0,m=r.fuzzFactor||0,v=0,E=0,P,R;function I(wi,kn){for(var Si=0;Si<wi.lines.length;Si++){var Ei=wi.lines[Si],tl=Ei.length>0?Ei[0]:" ",bh=Ei.length>0?Ei.substr(1):Ei;if(tl===" "||tl==="-"){if(!l(kn+1,n[kn],tl,bh)&&(d++,d>m))return!1;kn++}}return!0}for(var M=0;M<a.length;M++){for(var N=a[M],B=n.length-N.oldLines,j=0,K=E+N.oldStart-1,ee=cu(K,v,B);j!==void 0;j=ee())if(I(N,K+j)){N.offset=E+=j;break}if(j===void 0)return!1;v=N.offset+N.oldStart+N.oldLines}for(var te=0,fe=0;fe<a.length;fe++){var $e=a[fe],Ae=$e.oldStart+$e.offset+te-1;te+=$e.newLines-$e.oldLines;for(var Te=0;Te<$e.lines.length;Te++){var qe=$e.lines[Te],De=qe.length>0?qe[0]:" ",Be=qe.length>0?qe.substr(1):qe,et=$e.linedelimiters[Te];if(De===" ")Ae++;else if(De==="-")n.splice(Ae,1),i.splice(Ae,1);else if(De==="+")n.splice(Ae,0,Be),i.splice(Ae,0,et),Ae++;else if(De==="\\"){var cr=$e.lines[Te-1]?$e.lines[Te-1][0]:null;cr==="+"?P=!0:cr==="-"&&(R=!0)}}}if(P)for(;!n[n.length-1];)n.pop(),i.pop();else R&&(n.push(""),i.push(`
`));for(var dn=0;dn<n.length-1;dn++)n[dn]=n[dn]+i[dn];return n.join("")}function Ih(t,e){typeof t=="string"&&(t=yo(t));var r=0;function n(){var i=t[r++];if(!i)return e.complete();e.loadFile(i,function(a,l){if(a)return e.complete(a);var d=hd(l,i,e);e.patched(i,d,function(m){if(m)return e.complete(m);n()})})}n()}function Tc(t,e,r,n,i,a,l){l||(l={}),typeof l.context=="undefined"&&(l.context=4);var d=Ch(r,n,l);d.push({value:"",lines:[]});function m(j){return j.map(function(K){return" "+K})}for(var v=[],E=0,P=0,R=[],I=1,M=1,N=function(K){var ee=d[K],te=ee.lines||ee.value.replace(/\n$/,"").split(`
`);if(ee.lines=te,ee.added||ee.removed){var fe;if(!E){var $e=d[K-1];E=I,P=M,$e&&(R=l.context>0?m($e.lines.slice(-l.context)):[],E-=R.length,P-=R.length)}(fe=R).push.apply(fe,pi(te.map(function(dn){return(ee.added?"+":"-")+dn}))),ee.added?M+=te.length:I+=te.length}else{if(E)if(te.length<=l.context*2&&K<d.length-2){var Ae;(Ae=R).push.apply(Ae,pi(m(te)))}else{var Te,qe=Math.min(te.length,l.context);(Te=R).push.apply(Te,pi(m(te.slice(0,qe))));var De={oldStart:E,oldLines:I-E+qe,newStart:P,newLines:M-P+qe,lines:R};if(K>=d.length-2&&te.length<=l.context){var Be=/\n$/.test(r),et=/\n$/.test(n),cr=te.length==0&&R.length>De.oldLines;!Be&&cr&&r.length>0&&R.splice(De.oldLines,0,"\\ No newline at end of file"),(!Be&&!cr||!et)&&R.push("\\ No newline at end of file")}v.push(De),E=0,P=0,R=[]}I+=te.length,M+=te.length}},B=0;B<d.length;B++)N(B);return{oldFileName:t,newFileName:e,oldHeader:i,newHeader:a,hunks:v}}function fd(t){var e=[];t.oldFileName==t.newFileName&&e.push("Index: "+t.oldFileName),e.push("==================================================================="),e.push("--- "+t.oldFileName+(typeof t.oldHeader=="undefined"?"":"	"+t.oldHeader)),e.push("+++ "+t.newFileName+(typeof t.newHeader=="undefined"?"":"	"+t.newHeader));for(var r=0;r<t.hunks.length;r++){var n=t.hunks[r];n.oldLines===0&&(n.oldStart-=1),n.newLines===0&&(n.newStart-=1),e.push("@@ -"+n.oldStart+","+n.oldLines+" +"+n.newStart+","+n.newLines+" @@"),e.push.apply(e,n.lines)}return e.join(`
`)+`
`}function _o(t,e,r,n,i,a,l){return fd(Tc(t,e,r,n,i,a,l))}function bo(t,e,r,n,i,a){return _o(t,t,e,r,n,i,a)}function Ph(t,e){return t.length!==e.length?!1:xc(t,e)}function xc(t,e){if(e.length>t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Oh(t){var e=wo(t.lines),r=e.oldLines,n=e.newLines;r!==void 0?t.oldLines=r:delete t.oldLines,n!==void 0?t.newLines=n:delete t.newLines}function Dh(t,e,r){t=pd(t,r),e=pd(e,r);var n={};(t.index||e.index)&&(n.index=t.index||e.index),(t.newFileName||e.newFileName)&&(gd(t)?gd(e)?(n.oldFileName=vs(n,t.oldFileName,e.oldFileName),n.newFileName=vs(n,t.newFileName,e.newFileName),n.oldHeader=vs(n,t.oldHeader,e.oldHeader),n.newHeader=vs(n,t.newHeader,e.newHeader)):(n.oldFileName=t.oldFileName,n.newFileName=t.newFileName,n.oldHeader=t.oldHeader,n.newHeader=t.newHeader):(n.oldFileName=e.oldFileName||t.oldFileName,n.newFileName=e.newFileName||t.newFileName,n.oldHeader=e.oldHeader||t.oldHeader,n.newHeader=e.newHeader||t.newHeader)),n.hunks=[];for(var i=0,a=0,l=0,d=0;i<t.hunks.length||a<e.hunks.length;){var m=t.hunks[i]||{oldStart:1/0},v=e.hunks[a]||{oldStart:1/0};if(md(m,v))n.hunks.push(Z(m,l)),i++,d+=m.newLines-m.oldLines;else if(md(v,m))n.hunks.push(Z(v,d)),a++,l+=v.newLines-v.oldLines;else{var E={oldStart:Math.min(m.oldStart,v.oldStart),oldLines:0,newStart:Math.min(m.newStart+l,v.oldStart+d),newLines:0,lines:[]};ge(E,m.oldStart,m.lines,v.oldStart,v.lines),a++,i++,n.hunks.push(E)}}return n}function pd(t,e){if(typeof t=="string"){if(/^@@/m.test(t)||/^Index:/m.test(t))return yo(t)[0];if(!e)throw new Error("Must provide a base reference or pass in a patch");return Tc(void 0,void 0,e,t)}return t}function gd(t){return t.newFileName&&t.newFileName!==t.oldFileName}function vs(t,e,r){return e===r?e:(t.conflict=!0,{mine:e,theirs:r})}function md(t,e){return t.oldStart<e.oldStart&&t.oldStart+t.oldLines<e.oldStart}function Z(t,e){return{oldStart:t.oldStart,oldLines:t.oldLines,newStart:t.newStart+e,newLines:t.newLines,lines:t.lines}}function ge(t,e,r,n,i){var a={offset:e,lines:r,index:0},l={offset:n,lines:i,index:0};for(ar(t,a,l),ar(t,l,a);a.index<a.lines.length&&l.index<l.lines.length;){var d=a.lines[a.index],m=l.lines[l.index];if((d[0]==="-"||d[0]==="+")&&(m[0]==="-"||m[0]==="+"))xe(t,a,l);else if(d[0]==="+"&&m[0]===" "){var v;(v=t.lines).push.apply(v,pi(Mt(a)))}else if(m[0]==="+"&&d[0]===" "){var E;(E=t.lines).push.apply(E,pi(Mt(l)))}else d[0]==="-"&&m[0]===" "?pt(t,a,l):m[0]==="-"&&d[0]===" "?pt(t,l,a,!0):d===m?(t.lines.push(d),a.index++,l.index++):qt(t,Mt(a),Mt(l))}gr(t,a),gr(t,l),Oh(t)}function xe(t,e,r){var n=Mt(e),i=Mt(r);if(ln(n)&&ln(i)){if(xc(n,i)&&on(r,n,n.length-i.length)){var a;(a=t.lines).push.apply(a,pi(n));return}else if(xc(i,n)&&on(e,i,i.length-n.length)){var l;(l=t.lines).push.apply(l,pi(i));return}}else if(Ph(n,i)){var d;(d=t.lines).push.apply(d,pi(n));return}qt(t,n,i)}function pt(t,e,r,n){var i=Mt(e),a=vr(r,i);if(a.merged){var l;(l=t.lines).push.apply(l,pi(a.merged))}else qt(t,n?a:i,n?i:a)}function qt(t,e,r){t.conflict=!0,t.lines.push({conflict:!0,mine:e,theirs:r})}function ar(t,e,r){for(;e.offset<r.offset&&e.index<e.lines.length;){var n=e.lines[e.index++];t.lines.push(n),e.offset++}}function gr(t,e){for(;e.index<e.lines.length;){var r=e.lines[e.index++];t.lines.push(r)}}function Mt(t){for(var e=[],r=t.lines[t.index][0];t.index<t.lines.length;){var n=t.lines[t.index];if(r==="-"&&n[0]==="+"&&(r="+"),r===n[0])e.push(n),t.index++;else break}return e}function vr(t,e){for(var r=[],n=[],i=0,a=!1,l=!1;i<e.length&&t.index<t.lines.length;){var d=t.lines[t.index],m=e[i];if(m[0]==="+")break;if(a=a||d[0]!==" ",n.push(m),i++,d[0]==="+")for(l=!0;d[0]==="+";)r.push(d),d=t.lines[++t.index];m.substr(1)===d.substr(1)?(r.push(d),t.index++):l=!0}if((e[i]||"")[0]==="+"&&a&&(l=!0),l)return r;for(;i<e.length;)n.push(e[i++]);return{merged:n,changes:r}}function ln(t){return t.reduce(function(e,r){return e&&r[0]==="-"},!0)}function on(t,e,r){for(var n=0;n<r;n++){var i=e[e.length-r+n].substr(1);if(t.lines[t.index+n]!==" "+i)return!1}return t.index+=r,!0}function wo(t){var e=0,r=0;return t.forEach(function(n){if(typeof n!="string"){var i=wo(n.mine),a=wo(n.theirs);e!==void 0&&(i.oldLines===a.oldLines?e+=i.oldLines:e=void 0),r!==void 0&&(i.newLines===a.newLines?r+=i.newLines:r=void 0)}else r!==void 0&&(n[0]==="+"||n[0]===" ")&&r++,e!==void 0&&(n[0]==="-"||n[0]===" ")&&e++}),{oldLines:e,newLines:r}}function vd(t){for(var e=[],r,n,i=0;i<t.length;i++)r=t[i],r.added?n=1:r.removed?n=-1:n=0,e.push([n,r.value]);return e}function yd(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];n.added?e.push("<ins>"):n.removed&&e.push("<del>"),e.push(_d(n.value)),n.added?e.push("</ins>"):n.removed&&e.push("</del>")}return e.join("")}function _d(t){var e=t;return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e}function kh(t,e){let r={};for(let a=0;a<e.length;a++){const l=e[a];r[l]?r[l].push(a):r[l]=[a]}let i=[{buffer1index:-1,buffer2index:-1,chain:null}];for(let a=0;a<t.length;a++){const l=t[a],d=r[l]||[];let m=0,v=i[0];for(let E=0;E<d.length;E++){const P=d[E];let R;for(R=m;R<i.length&&!(i[R].buffer2index<P&&(R===i.length-1||i[R+1].buffer2index>P));R++);if(R<i.length){const I={buffer1index:a,buffer2index:P,chain:i[R]};if(m===i.length?i.push(v):i[m]=v,m=R+1,v=I,m===i.length)break}}i[m]=v}return i[i.length-1]}function my(t,e){const r=kh(t,e);let n=[],i=t.length,a=e.length,l={common:[]};function d(){l.common.length&&(l.common.reverse(),n.push(l),l={common:[]})}for(let m=r;m!==null;m=m.chain){let v={buffer1:[],buffer2:[]};for(;--i>m.buffer1index;)v.buffer1.push(t[i]);for(;--a>m.buffer2index;)v.buffer2.push(e[a]);(v.buffer1.length||v.buffer2.length)&&(d(),v.buffer1.reverse(),v.buffer2.reverse(),n.push(v)),i>=0&&l.common.push(t[i])}return d(),n.reverse(),n}function Ip(t,e){const r=kh(t,e);let n=[],i=t.length,a=e.length;for(let l=r;l!==null;l=l.chain){const d=i-l.buffer1index-1,m=a-l.buffer2index-1;i=l.buffer1index,a=l.buffer2index,(d||m)&&n.push({buffer1:[i+1,d],buffer1Content:t.slice(i+1,i+1+d),buffer2:[a+1,m],buffer2Content:e.slice(a+1,a+1+m)})}return n.reverse(),n}function $E(t,e){const r=kh(t,e);let n=[],i=t.length,a=e.length;function l(d,m,v){let E=[];for(let P=0;P<v;P++)E.push(d[m+P]);return{offset:m,length:v,chunk:E}}for(let d=r;d!==null;d=d.chain){const m=i-d.buffer1index-1,v=a-d.buffer2index-1;i=d.buffer1index,a=d.buffer2index,(m||v)&&n.push({buffer1:l(t,d.buffer1index+1,m),buffer2:l(e,d.buffer2index+1,v)})}return n.reverse(),n}function vy(t,e,r){let n=[];function i(m,v){n.push({ab:v,oStart:m.buffer1[0],oLength:m.buffer1[1],abStart:m.buffer2[0],abLength:m.buffer2[1]})}Ip(e,t).forEach(m=>i(m,"a")),Ip(e,r).forEach(m=>i(m,"b")),n.sort((m,v)=>m.oStart-v.oStart);let a=[],l=0;function d(m){m>l&&(a.push({stable:!0,buffer:"o",bufferStart:l,bufferLength:m-l,bufferContent:e.slice(l,m)}),l=m)}for(;n.length;){let m=n.shift(),v=m.oStart,E=m.oStart+m.oLength,P=[m];for(d(v);n.length;){const R=n[0],I=R.oStart;if(I>E)break;E=Math.max(E,I+R.oLength),P.push(n.shift())}if(P.length===1){if(m.abLength>0){const R=m.ab==="a"?t:r;a.push({stable:!0,buffer:m.ab,bufferStart:m.abStart,bufferLength:m.abLength,bufferContent:R.slice(m.abStart,m.abStart+m.abLength)})}}else{let R={a:[t.length,-1,e.length,-1],b:[r.length,-1,e.length,-1]};for(;P.length;){m=P.shift();const K=m.oStart,ee=K+m.oLength,te=m.abStart,fe=te+m.abLength;let $e=R[m.ab];$e[0]=Math.min(te,$e[0]),$e[1]=Math.max(fe,$e[1]),$e[2]=Math.min(K,$e[2]),$e[3]=Math.max(ee,$e[3])}const I=R.a[0]+(v-R.a[2]),M=R.a[1]+(E-R.a[3]),N=R.b[0]+(v-R.b[2]),B=R.b[1]+(E-R.b[3]);let j={stable:!1,aStart:I,aLength:M-I,aContent:t.slice(I,M),oStart:v,oLength:E-v,oContent:e.slice(v,E),bStart:N,bLength:B-N,bContent:r.slice(N,B)};a.push(j)}l=E}return d(e.length),a}function Nh(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},n);const a=typeof t=="string",l=typeof e=="string",d=typeof r=="string";a&&(t=t.split(n.stringSeparator)),l&&(e=e.split(n.stringSeparator)),d&&(r=r.split(n.stringSeparator));let m=[];const v=vy(t,e,r);let E=[];function P(){E.length&&m.push({ok:E}),E=[]}function R(I,M){if(I.length!==M.length)return!1;for(let N=0;N<I.length;N++)if(I[N]!==M[N])return!1;return!0}return v.forEach(I=>{I.stable?E.push(...I.bufferContent):n.excludeFalseConflicts&&R(I.aContent,I.bContent)?E.push(...I.aContent):(P(),m.push({conflict:{a:I.aContent,aIndex:I.aStart,o:I.oContent,oIndex:I.oStart,b:I.bContent,bIndex:I.bStart}}))}),P(),m}function BE(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/,label:{}},n);const a=Nh(t,e,r,n);let l=!1,d=[];return a.forEach(m=>{m.ok?d=d.concat(m.ok):m.conflict&&(l=!0,d.push(`<<<<<<<${n.label.a?` ${n.label.a}`:""}`),d=d.concat(m.conflict.a),d.push(`|||||||${n.label.o?` ${n.label.o}`:""}`),d=d.concat(m.conflict.o),d.push("======="),d=d.concat(m.conflict.b),d.push(`>>>>>>>${n.label.b?` ${n.label.b}`:""}`))}),{conflict:l,result:d}}function yy(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},n);const a=Nh(t,e,r,n);let l=!1,d=[];for(let m=0;m<a.length;m++){const v=a[m];v.ok?d=d.concat(v.ok):(l=!0,d=d.concat([`
<<<<<<<<<
`],v.conflict.a,[`
=========
`],v.conflict.b,[`
>>>>>>>>>
`]))}return{conflict:l,result:d}}function HE(t,e,r,n){n=Object.assign({excludeFalseConflicts:!1,stringSeparator:/\s+/},n);const a=Nh(t,e,r,n);let l=!1,d=[];for(let m=0;m<a.length;m++){const v=a[m];if(v.ok)d=d.concat(v.ok);else{const E=my(v.conflict.a,v.conflict.b);for(let P=0;P<E.length;P++){let R=E[P];R.common?d=d.concat(R.common):(l=!0,d=d.concat([`
<<<<<<<<<
`],R.buffer1,[`
=========
`],R.buffer2,[`
>>>>>>>>>
`]))}}}return{conflict:l,result:d}}function UE(t,e){let r=[],n=0;function i(a){for(;n<a;)r.push(t[n]),n++}for(let a=0;a<e.length;a++){let l=e[a];i(l.buffer1.offset);for(let d=0;d<l.buffer2.chunk.length;d++)r.push(l.buffer2.chunk[d]);n+=l.buffer1.length}return i(t.length),r}function jE(t){return t.map(e=>({buffer1:{offset:e.buffer1.offset,length:e.buffer1.length},buffer2:{chunk:e.buffer2.chunk}}))}function qE(t){return t.map(e=>({buffer1:e.buffer2,buffer2:e.buffer1}))}function Pp(t,e,r){return hd(t,e,r)}function _y(t,e){const r=[];for(const n of yo(t,e))r.push({...n,oldFileName:n.newFileName,oldHeader:n.newHeader,newFileName:n.oldFileName,newHeader:n.oldHeader,hunks:n.hunks.map(i=>({...i,oldLines:i.newLines,oldStart:i.newStart,newLines:i.oldLines,newStart:i.oldStart,lines:i.lines.map(a=>a[0]==="-"?`+${a.slice(1)}`:a[0]==="+"?`-${a.slice(1)}`:a)}))}),r.push(n);return r}function Op(t,e,r){let n=`
`;const i=t.match(/(?:\r?\n)/g);if(i!==null&&i.length!==0){const m=i.filter(v=>v===`\r
`).length;n=m>i.length-m?`\r
`:`
`}const a=yy(t,e,r,{excludeFalseConflicts:!0,stringSeparator:/\r?\n/}),l=a.result;let d=!1;if(a.conflict){let m;const v=[];let E=0;for(const I of l)I===`
<<<<<<<<<
`?m={start:E,separator:E,end:E}:I===`
=========
`?m.separator=E:I===`
>>>>>>>>>
`&&(m.end=E,v.push(m)),E++;let P=0,R=0;for(const I of v)l.splice(I.start-P,1),P++,R=I.end-I.separator+1,l.splice(I.separator-P,R),P+=R;v.length&&(d=!0)}return{conflicts:d,mergedContent:l.join(n)}}function by(t){return t!==void 0&&typeof t.then=="function"}const wy="";function Sy(...t){if(t.length===1){const e=t[0];return e===void 0?wy:typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"||e instanceof Error?String(e):e instanceof _.Uri?e.toString():JSON.stringify(e)}return JSON.stringify(t)}function qr(t){return(e,r,n)=>{let i;if(typeof n.value=="function"?i=n.value:typeof n.get=="function"&&(i=n.get),i===void 0)throw new Error("Not supported");const a=`$gate$${r}`;n.value=function(...l){const d=l.length===0?a:`${a}$${(t!=null?t:Sy)(...l)}`;Object.prototype.hasOwnProperty.call(this,d)||Object.defineProperty(this,d,{configurable:!1,enumerable:!1,writable:!0,value:void 0});let m=this[d];if(m===void 0){let v;try{if(v=i.apply(this,l),v==null||!by(v))return v;this[d]=m=v.then(E=>(this[d]=void 0,E)).catch(E=>{throw this[d]=void 0,E})}catch(E){throw this[d]=void 0,E}}return m}}}let Mh=0;function Ey(){return Mh===Number.MAX_SAFE_INTEGER&&(Mh=0),String(++Mh)}class Cy{constructor(){this.id=Ey()}async synchronize(e){let r;const n=this.promise;this.promise=new Promise(i=>r=i),await n;try{return await e()}finally{r()}}}class bd{constructor(e){this.lock=new Cy,this.readers=new Set,this.counter=0,this._id=e!=null?e:this.lock.id}get id(){return this._id}getNextCounter(){return this.counter===Number.MAX_SAFE_INTEGER&&(this.counter=0),++this.counter}async synchronizeRead(e,r){let n;const i=new ce(`Reader(${this.getNextCounter()}|${this.id})`,{log:{prefix:"(A) ",message:r?` \u2022 ${r}`:""},logLevel:dt.Debug});let a;await this.lock.synchronize(async()=>{this.writer&&await this.writer,a=new Promise(l=>n=l),this.readers.add(a)}),i.restart({prefix:"(L) ",suffix:r?` \u2022 ${r}`:"",took:" waited for "});try{return await e()}finally{i.stop({prefix:"(U) ",suffix:r?` \u2022 ${r}`:"",took:" locked for "}),a!==void 0&&this.readers.delete(a),n()}}async synchronizeWrite(e,r){let n;const i=new ce(`Writer(${this.getNextCounter()}|${this.id})`,{log:{prefix:"(A) ",message:r?` \u2022 ${r}`:""},logLevel:dt.Debug});await this.lock.synchronize(async()=>{if(this.writer&&await this.writer,this.readers.size){const a=[...this.readers];this.readers.clear(),await Promise.all(a)}this.writer=new Promise(a=>n=a)}),i.restart({prefix:"(L) ",suffix:r?` \u2022 ${r}`:"",took:" waited for "});try{return await e()}finally{i.stop({prefix:"(U) ",suffix:r?` \u2022 ${r}`:"",took:" locked for "}),n(),this.writer=void 0}}}class Ty{constructor(){this.locks=new Map}async synchronizeRead(e,r,n){let i=this.locks.get(e);return i===void 0&&(i=new bd(String(e)),this.locks.set(e,i)),i.synchronizeRead(r,n)}async synchronizeWrite(e,r,n){let i=this.locks.get(e);return i===void 0&&(i=new bd(String(e)),this.locks.set(e,i)),i.synchronizeWrite(r,n)}}async function lu(t){return(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,6113,23))).createHash("sha1").update(t).digest("base64")}var xy=Object.defineProperty,Ry=Object.getOwnPropertyDescriptor,Ay=(t,e,r,n)=>{for(var i=n>1?void 0:n?Ry(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&xy(e,r,i),i};const jn=(0,F.loadMessageBundle)(),Iy=_.FileSystemError.FileNotFound().code,Dp=`===================================================================
`,Fi=new TextDecoder,Py=new TextEncoder;var Ot;(function(t){t[t.Changed=1]="Changed",t[t.Created=2]="Created",t[t.Deleted=3]="Deleted"})(Ot||(Ot={}));function Oy(t){return t&&"type"in t&&"uri"in t&&"uri"in t&&"fileType"in t&&"revision"in t&&"timestamp"in t}function uu(t,e,r){return{type:t.type,rootUri:e,uri:r!=null?r:t.uri}}const Rc=class{constructor(t,e,r,n,i,a){this.providerService=t,this.storageService=e,this.fileStorageService=r,this.telemetryService=n,this.workspaceId=i,this._onDidChange=new _.EventEmitter,this.cache=new Map,this.lock=new Ty,this.scopedStores=new Map,a===void 0&&(Rc._instance=this,this.disposable=_.Disposable.from(this.providerService.onDidRefresh(()=>this.cache.clear())))}static get instance(){return this._instance}get onDidChange(){return this._onDidChange.event}dispose(){var t;(t=this.disposable)==null||t.dispose()}async exportDebugInfo(t){var e;async function r(n){const i=await _.workspace.openTextDocument({language:"json",content:`ChangeStore Operations for ${n.toString(!0)}

${this.toStorage(await this.getWorkingOperations(n))}`});return void _.window.showTextDocument(i)}if(t===void 0)for(const n of(e=_.workspace.workspaceFolders)!=null?e:[])await r.call(this,n.uri);else return r.call(this,t)}async getWorkspaceProvidersWithChanges(){var t,e;const r=new Map;for(const n of(t=_.workspace.workspaceFolders)!=null?t:[])if(n.uri.scheme===Dt.scheme&&await this.hasChanges(n.uri)){const i=(e=this.providerService.getRepository(n.uri))==null?void 0:e.provider;if(!i)continue;r.set(i.id,i)}return[...r.values()]}async getWorkspacesWithChanges(){var t;const e=new ce("ChangeStore.getWorkspacesWithChanges()");try{const r=[];for(const n of(t=_.workspace.workspaceFolders)!=null?t:[])n.uri.scheme===Dt.scheme&&await this.hasChanges(n.uri)&&r.push(n.uri);return r.length>0?r:void 0}finally{e.stop()}}async acceptAll(t,e){const r=`ChangeStore.acceptAll(${t.toString()}, ${e==null?void 0:e.staged})`;he.log(r);const n=[];await this.lock.synchronizeWrite(Oe(t),async()=>{const i=await this.getWorkingOperations(t),a=[];let l=[];const d=(e==null?void 0:e.staged)&&!(e.staged==="auto"&&!i.some(m=>m.staged));for(const m of i){if(d&&!m.staged){l.push(m);continue}m.fileType===_.FileType.File&&await this.discardWorkingContent(t,m.uri);let v;if(m.type===2&&m.fileType===_.FileType.Directory&&(i.some(E=>pa(E.uri,m.uri))||(v={type:3,rootUri:t,uri:m.uri})),n.push(v!=null?v:uu(m,t)),m.type===2){let E=m.uri;for(;;){const{parent:P}=this.findParent(E,i,R=>R.type===2);if(P){a.push(P),E=P.uri;continue}break}}}l.length>0&&a.length>0&&(l=l.filter(m=>a.includes(m)?(n.push(uu(m,t)),!1):!0)),await this.saveWorkingOperations(t,l)},r),n.length!==0&&this._onDidChange.fire(n)}async discard(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.discard(${t.toString()})`;he.log(r);const n=[];await this.lock.synchronizeWrite(Oe(e),async()=>this.discardCore(e,t,n),r),n.length!==0&&this._onDidChange.fire(n)}async discardCore(t,e,r){he.debug(`ChangeStore.discardCore(${e.toString()})`);const n=await this.getWorkingOperations(t);if(n.length===0)return;const i=fr(e),a=n.findIndex(m=>fr(m.uri)===i);if(a===-1)return;const[l]=n.splice(a,1);let d;switch(l.type){case 2:d=3;break;case 3:d=2;break;default:d=l.type;break}if(r.push({type:d,rootUri:t,uri:e}),l.type===2){let m=l.uri;for(;;){const{parent:v,parentIndex:E}=this.findNewParentWithOnlyChild(m,n);if(v){n.splice(E,1),r.push({type:3,rootUri:t,uri:v.uri}),m=v.uri;continue}break}}await this.saveWorkingOperations(t,n),l.fileType===_.FileType.File&&await this.discardWorkingContent(t,e)}async discardAll(t,e){const r=this.getUriScope(t);if(r)return this.getScopedChangeStore(r).discardAll(t,e);const n=`ChangeStore.discardAll(${t.toString()}, ${e==null?void 0:e.staged})`;he.log(n);const i=[];await this.lock.synchronizeWrite(Oe(t),async()=>{const a=await this.getWorkingOperations(t),l=[];let d=[];const m=(e==null?void 0:e.staged)&&!(e.staged==="auto"&&!a.some(v=>v.staged));for(const v of a){if(m&&!v.staged){d.push(v);continue}v.fileType===_.FileType.File&&await this.discardWorkingContent(t,v.uri);let E;switch(v.type){case 2:E=3;break;case 3:E=2;break;default:E=v.type;break}if(i.push({type:E,rootUri:t,uri:v.uri}),v.type===2){let P=v.uri;for(;;){const{parent:R}=this.findNewParentWithOnlyChild(P,a);if(R){l.push(R),P=R.uri;continue}break}}}d.length>0&&l.length>0&&(d=d.filter(v=>l.includes(v)?(i.push({type:3,rootUri:t,uri:v.uri}),!1):!0)),await this.saveWorkingOperations(t,d)},n),i.length!==0&&this._onDidChange.fire(i)}async stage(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.stage(${t.toString()})`;he.log(r);const n=[];await this.lock.synchronizeWrite(Oe(e),async()=>{const{operation:i,index:a}=await this.getWorkingOperation(t,e);i!==void 0&&await this.spliceOperation(t,a,{...i,staged:!0,timestamp:Date.now()},n)},r),n.length!==0&&this._onDidChange.fire(n)}async stageAll(t){const e=`ChangeStore.stageAll(${t.toString()})`;he.log(e);const r=[];await this.lock.synchronizeWrite(Oe(t),async()=>{const n=(await this.getWorkingOperations(t)).map(i=>({...i,staged:!0,timestamp:Date.now()}));n.length!==0&&(await this.saveWorkingOperations(t,n),r.push(...n.map(i=>uu(i,t))))},e),r.length!==0&&this._onDidChange.fire(r)}async unstage(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.unstage(${t.toString()})`;he.log(r);const n=[];await this.lock.synchronizeWrite(Oe(e),async()=>{const{operation:i,index:a}=await this.getWorkingOperation(t,e);i!==void 0&&await this.spliceOperation(t,a,{...i,staged:!1,timestamp:Date.now()},n)},r),n.length!==0&&this._onDidChange.fire(n)}async unstageAll(t){const e=`ChangeStore.unstageAll(${t.toString()})`;he.log(e);const r=[];await this.lock.synchronizeWrite(Oe(t),async()=>{const n=(await this.getWorkingOperations(t)).map(i=>({...i,staged:!1,timestamp:Date.now()}));n.length!==0&&(await this.saveWorkingOperations(t,n),r.push(...n.map(i=>uu(i,t))))},e),r.length!==0&&this._onDidChange.fire(r)}async hasChanges(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).hasChanges(t);const r=Oe(t),n=this.cache.get(r);return n!==void 0?n.length!==0:this.lock.synchronizeRead(r,async()=>(await this.getWorkingOperations(t)).length!==0,`ChangeStore.hasChanges(${t.toString()})`)}maybeHasChanges(t,e){const r=this.getUriScope(t);if(r)return this.getScopedChangeStore(r).maybeHasChanges(t,e);const n=this.cache.get(Oe(t));if(n===void 0)return;if(n.length===0)return!1;if(e===void 0)return!0;const i=fr(e);return n.some(a=>fr(a.uri)===i)}async hasMergeConflicts(t){return this.lock.synchronizeRead(Oe(t),async()=>(await this.getWorkingOperations(t)).some(e=>e.conflicts!==void 0),`ChangeStore.hasMergeConflicts(${t.toString()})`)}async hasStagedChanges(t){return this.lock.synchronizeRead(Oe(t),async()=>(await this.getWorkingOperations(t)).some(e=>e.staged&&e.conflicts===void 0),`ChangeStore.hasStagedChanges(${t.toString()})`)}async hasWorkingChanges(t){return this.lock.synchronizeRead(Oe(t),async()=>(await this.getWorkingOperations(t)).some(e=>!e.staged&&e.conflicts===void 0),`ChangeStore.hasWorkingChanges(${t.toString()})`)}async getChange(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).getChange(t);const r=this.providerService.getVirtualRootUri(t);if(r!==void 0)return this.lock.synchronizeRead(Oe(r),async()=>{const{operation:n}=await this.getWorkingOperation(t,r);return n},`ChangeStore.getChange(${t.toString()})`)}async getChanges(t,e){const r=this.getUriScope(t);return r?this.getScopedChangeStore(r).getChanges(t,e):this.lock.synchronizeRead(Oe(t),async()=>{let n=await this.getWorkingOperations(t);if((e==null?void 0:e.excludeConflicts)||(e==null?void 0:e.predicate)){const{excludeConflicts:i,predicate:a}=e;n=n.filter(l=>{var d;return(!i||l.conflicts===void 0)&&((d=a==null?void 0:a(l))!=null?d:!0)})}return n},`ChangeStore.getChanges(${t.toString()})`)}async getGroupedChanges(t,e){const r=this.getUriScope(t);return r?this.getScopedChangeStore(r).getGroupedChanges(t,e):this.lock.synchronizeRead(Oe(t),async()=>{var n,i;const a=await this.getWorkingOperations(t),l={conflicts:[],staged:[],working:[]};for(const d of a)!((i=(n=e==null?void 0:e.predicate)==null?void 0:n.call(e,d))!=null?i:!0)||(d.conflicts?l.conflicts.push(d):d.staged?l.staged.push(d):l.working.push(d));return l},`ChangeStore.getChangesByType(${t.toString()})`)}async getContent(t){const e=this.providerService.getVirtualRootUri(t);if(e===void 0)throw new Error(`Unable to find content for ${t.toString()}; Repository not found`);const r=Oe(e),n=this.cache.get(r);if((n==null?void 0:n.length)===0)throw new Error(`Unable to find content for ${t.toString()}`);return this.lock.synchronizeRead(r,async()=>{const i=Fi.decode(await this.getWorkingContent(e,t));if(i!==void 0)return i;throw new Error(`Unable to find content for ${t.toString()}`)},`ChangeStore.getContent(${t.toString()}}`)}async getMergeConflicts(t,e){return this.lock.synchronizeRead(Oe(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,a;return n.conflicts!==void 0&&((a=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?a:!0)}),`ChangeStore.getMergeConflicts(${t.toString()})`)}async getStagedChanges(t,e){return this.lock.synchronizeRead(Oe(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,a;return n.staged&&n.conflicts===void 0&&((a=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?a:!0)}),`ChangeStore.getStagedChanges(${t.toString()})`)}async getWorkingChanges(t,e){return this.lock.synchronizeRead(Oe(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,a;return!n.staged&&n.conflicts===void 0&&((a=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?a:!0)}),`ChangeStore.getWorkingChanges(${t.toString()})`)}async applyChangeset(t,e,r,n){var i;let a;Oy(r)?a=r:n=n!=null?n:r,he.log(`ChangeStore.applyChangeset${t.toString()}`,e.workspaceId,e.uri,a==null?void 0:a.uri,n==null?void 0:n.save);const l=this.getScopedChangeStore(e.workspaceId),d=(i=e.patch)!=null?i:await l.createPatch(e.uri,a==null?void 0:a.uri);await this.applyPatchCore(t,d,{...n,getIncomingContent:async m=>{const v=this.getScopedUri(this.providerService.createRelativeVirtualUri(e.uri,m),e.workspaceId);return Fi.decode(await _.workspace.fs.readFile(v))},merge:async(m,v,E)=>{try{const P=this.providerService.getProviderUri(m),R=Fi.decode(await _.workspace.fs.readFile(P)),I=this.getScopedUri(this.providerService.createRelativeVirtualUri(e.uri,v),e.workspaceId),M=Fi.decode(await _.workspace.fs.readFile(I));return{...Op(E,R,M),baseUri:P,incomingUri:I}}catch(P){throw new Error(`Unable to apply patch to ${v}: ${String(P)}`)}}})}async applyPatch(t,e,r){if(he.log(`ChangeStore.applyPatch(${t.toString()})`,r==null?void 0:r.save),!e.startsWith("diff --"))throw new Error("Invalid patch");return this.applyPatchCore(t,e,r)}async applyPatchCore(t,e,r={}){const n=`ChangeStore.applyPatchCore(${t.toString()})`;he.debug(n,r==null?void 0:r.save);const i=new _.WorkspaceEdit,a=[],l=new Map;async function d(R){var I;const M=Oe(R),N=_.workspace.textDocuments.find(B=>Oe(B.uri)===M);return(I=N==null?void 0:N.getText())!=null?I:Fi.decode(await _.workspace.fs.readFile(R))}async function m(R){try{const I=await _.workspace.fs.stat(R);return Boolean(I)}catch{return!1}}async function v(R,I,M){let N=Pp("",M,{fuzzFactor:0});if(N===!1){if(!r.getIncomingContent)throw new Error(`Unable to apply patch to ${I}`);N=await r.getIncomingContent(I)}i.createFile(R,{overwrite:!0}),i.replace(R,new _.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),N)}async function E(R,I,M,N){const B=await d(R);let j=Pp(B,M,{fuzzFactor:1});if(j===!1){if(r.merge===void 0)throw new Error(`Unable to apply patch to ${I}; Resulted in conflicts`);const K={title:jn("apply patch failed prompt confirm","Merge")},ee={title:jn("apply patch failed prompt cancel","Skip File"),isCloseAffordance:!0};if(await _.window.showWarningMessage(jn("apply patch failed prompt",`Unable to apply changes to '{0}'.

Do you want to retry by merging the files?`,I),{modal:!0,useCustom:!0},K,ee)!==K)return;const fe=await r.merge(R,I,B);j=fe.mergedContent,fe.conflicts&&l.set(Oe(R),{type:N,baseUri:fe.baseUri,incomingUri:fe.incomingUri})}i.replace(R,new _.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),j)}const P=(r==null?void 0:r.reverse)?_y(e,{}):yo(e,{});for(const R of P)if(R.oldFileName==="/dev/null"){if(!R.newFileName)continue;const I=R.newFileName.startsWith("b/")?R.newFileName.substr(2):R.newFileName,M=this.providerService.createRelativeVirtualUri(t,I);a.push(Oe(M)),!await m(M)?await v(M,I,R):await E(M,I,R,2)}else if(R.newFileName==="/dev/null"){if(!R.oldFileName)continue;const I=R.oldFileName.startsWith("a/")?R.oldFileName.substr(2):R.oldFileName,M=this.providerService.createRelativeVirtualUri(t,I);await m(M)&&i.deleteFile(M)}else if(R.oldFileName===R.newFileName){if(!R.newFileName)continue;const I=this.providerService.createRelativeVirtualUri(t,R.newFileName);a.push(Oe(I)),!await m(I)?await v(I,R.newFileName,R):await E(I,R.newFileName,R,1)}else throw new Error(`Unable to apply patch to ${R.oldFileName}; Renames aren't currently supported`);if(await _.workspace.applyEdit(i),r.save&&a.length)for(const R of a){const I=_.workspace.textDocuments.find(M=>Oe(M.uri)===R);await(I==null?void 0:I.save())}l.size&&setTimeout(async()=>{const R=[];await this.lock.synchronizeWrite(Oe(t),async()=>{const I=await this.getWorkingOperations(t);if(I.length===0)return;let M=-1;for(const N of I){M++;const B=l.get(Oe(N.uri));B!==void 0&&await this.spliceOperation(N.uri,M,{...N,conflicts:{baseUri:B.baseUri,incomingUri:B.incomingUri,status:[N.type,B.type]},timestamp:Date.now()},R)}},n),R.length!==0&&this._onDidChange.fire(R)},0)}async createChangeset(t){he.log(`ChangeStore.createChangeset${t.toString()})`);const e=await this.createPatch(t);return e?{workspaceId:this.workspaceId,uri:t,patch:e}:void 0}async createPatch(t,e,r){if(he.log(`ChangeStore.createPatch${t.toString()})`,e),e===void 0){let a=await this.getWorkingOperations(t);if((r==null?void 0:r.staged)&&(a=a.filter(d=>d.staged)),a.length===0)return"";const l=[];for(const d of a){const m=await this.createPatchCore(t,d);l.push(m)}return l.join("")}const{operation:n}=await this.getWorkingOperation(e,t);if(n===void 0)throw new Error(`Unable to create patch for ${e.toString()}`);return(r==null?void 0:r.staged)&&n.staged?"":await this.createPatchCore(t,n)}async createPatchCore(t,e){const r=this.providerService.getRelativeFilePath(t,e.uri),n=`diff --git a/${r} b/${r}`;if(e.type===2){let m=await this.getContent(e.uri),v;!m.endsWith(`
`)&&!m.endsWith(`\r
`)?v=`
\\ No newline at end of file`:v="";let E=0;return m=m.replace(/\r?\n/g,P=>(E++,`${P}+`)),`${n}
new file mode 100644
--- /dev/null
+++ b/${r}
@@ -0,0 +1,${E} @@
+${m}${v}`}if(e.type===3){let m=Fi.decode(await _.workspace.fs.readFile(this.providerService.getProviderUri(e.uri))),v=0;return m=m.replace(/\r?\n/g,E=>(v++,`${E}-`)),`${n}
deleted file mode 100644
--- a/${r}
+++ /dev/null
@@ -1,${v} +0,0 @@
-${m}`}const i=await this.getContent(e.uri),a=Fi.decode(await _.workspace.fs.readFile(this.providerService.getProviderUri(e.uri))),l=bo(r,a,i),d=l.indexOf(Dp);return`${n}
${l.substr(d+Dp.length)}`}async keep(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return;const n=`ChangeStore.keep(${t.toString()})`;he.log(n,e);const i=[];await this.lock.synchronizeWrite(Oe(r),async()=>{const{operation:a,index:l}=await this.getWorkingOperation(t,r);if(a===void 0)return;if(e===void 0&&a.conflicts){const[,m]=a.conflicts.status;switch(m){case 1:switch(a.type){case 1:case 2:case 3:await this.spliceOperation(t,l,{...a,conflicts:void 0,timestamp:Date.now()},i);break}break;case 2:switch(a.type){case 1:case 3:await this.spliceOperation(t,l,{...a,conflicts:void 0,timestamp:Date.now()},i);break;case 2:await this.spliceOperation(t,l,{...a,type:1,size:a.size,hash:a.hash,originalHash:a.originalHash,conflicts:void 0,timestamp:Date.now()},i);break}break;case 3:switch(a.type){case 3:await this.discardCore(r,t,i);break;case 1:await this.spliceOperation(t,l,{...a,type:2,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);break;case 2:await this.spliceOperation(t,l,{...a,conflicts:void 0,timestamp:Date.now()},i);break}break}return}if(e===void 0)return;switch(e.type){case 1:switch(a.type){case 3:await this.spliceOperation(t,l,{...a,type:3,size:void 0,hash:void 0,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);return;case 2:break;case 1:break}break;case 2:switch(a.type){case 1:case 3:return;case 2:break}break;case 3:switch(a.type){case 3:return this.discardCore(r,t,i);case 1:await this.spliceOperation(t,l,{...a,type:2,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);return;case 2:return}}const d=e!==void 0?await _.workspace.fs.readFile(e.providerUri):void 0;await this.spliceOperation(t,l,{...a,type:1,originalHash:d!==void 0?await lu(d):a.originalHash,conflicts:void 0,timestamp:Date.now()},i)},n),i.length!==0&&this._onDidChange.fire(i)}async merge(t,e,r){const n=this.providerService.getVirtualWorkspaceUri(t);if(n===void 0)return;const i=`ChangeStore.merge(${t.toString()})`;he.log(i,e,r);const a=[];await this.lock.synchronizeWrite(Oe(n),async()=>{const{operation:l,index:d}=await this.getWorkingOperation(t,n);if(l===void 0)return;switch(e.type){case 1:switch(l.type){case 3:return void this.spliceOperation(t,d,{...l,type:3,size:void 0,hash:void 0,originalHash:void 0,conflicts:{baseUri:r.providerUri,incomingUri:e.providerUri,status:[l.type,e.type]},timestamp:Date.now()},a);case 2:break;case 1:break}break;case 2:switch(l.type){case 3:case 1:return;case 2:break}break;case 3:switch(l.type){case 3:return this.discardCore(n,t,a);case 1:return void this.spliceOperation(t,d,{...l,type:2,originalHash:void 0,conflicts:{baseUri:void 0,incomingUri:e.providerUri,status:[l.type,e.type]},timestamp:Date.now()},a);case 2:return}}const m=await this.getWorkingContent(n,t),v=await _.workspace.fs.readFile(r.providerUri),E=await _.workspace.fs.readFile(e.providerUri),P=Op(Fi.decode(m),Fi.decode(v),Fi.decode(E));await this.writeFileCore(n,t,a,Py.encode(P.mergedContent),E!=null?E:new Uint8Array(0),P.conflicts?{baseUri:r.providerUri,incomingUri:e.providerUri,status:[l.type,e.type]}:void 0)},i),a.length!==0&&this._onDidChange.fire(a)}async resolveDiffCommand(t,e,r,n){let i;const a=this.providerService.getVirtualRootUri(t);return a!==void 0&&({operation:i}=await this.getWorkingOperation(t,a)),(i==null?void 0:i.type)===3?this.resolveOpenCommand(e):((i==null?void 0:i.type)===2&&(e=e.with({query:"~"})),{command:"vscode.diff",title:"Open Changes",arguments:[e,t,r,n]})}resolveOpenCommand(t,e){return{command:"vscode.open",title:"Open File",arguments:[t,e]}}getScopedUri(t,e){const r=typeof e=="string"?e:e.workspaceId;return r===this.workspaceId?t:t.with({fragment:r})}getUriScope(t){return t.fragment||void 0}getScopedChangeStore(t){const e=typeof t=="string"?t:t.workspaceId;he.log(`ChangeStore.getScopedChangeStore(${e})`);let r=this.scopedStores.get(e);return r===void 0&&(r=e===this.workspaceId?new Rc.ScopedChangeStore(this,e,this.workspaceId):new Rc.ScopedChangeStore(new Rc(this.providerService,this.storageService.with(e),this.fileStorageService.with(e),this.telemetryService,this.workspaceId,e),e,this.workspaceId),this.scopedStores.set(e,r)),r}async stat(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).stat(t);const r=this.providerService.getVirtualRootUri(t);if(r===void 0)return;const n=Oe(r),i=this.cache.get(n);if((i==null?void 0:i.length)!==0)return this.lock.synchronizeRead(n,async()=>{var a;const{operation:l}=await this.getWorkingOperation(t,r);if(l!==void 0){if(l.type===3)throw _.FileSystemError.FileNotFound(`The ${l.fileType===_.FileType.Directory?"folder":"file"} has been deleted.`);return{type:l.fileType,size:(a=l.size)!=null?a:0,ctime:0,mtime:l.timestamp}}},`ChangeStore.stat(${t.toString()}`)}async readFile(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).readFile(t);const r=new ce(`ChangeStore.readFile(${t.toString()})`);try{const n=this.providerService.getVirtualRootUri(t);if(n===void 0)return;const i=Oe(n),a=this.cache.get(i);return(a==null?void 0:a.length)===0?void 0:await this.lock.synchronizeRead(i,()=>{const l=this.cache.get(i);if((l==null?void 0:l.length)===0){r.log({message:": Not found; no operations"});return}return this.getWorkingContent(n,t)},r.context)}finally{r.stop()}}async createDirectory(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new ce(`ChangeStore.createDirectory(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(Oe(e),async()=>{const{operation:i,index:a}=await this.getWorkingOperation(t,e),l=await this.providerService.getMetadata(t);await this.spliceOperation(t,a,i===void 0?{type:2,uri:t,fileType:_.FileType.Directory,revision:l.HEAD.sha,timestamp:Date.now(),size:0,hash:"",originalHash:void 0}:{...i,timestamp:Date.now()},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async deleteDirectory(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new ce(`ChangeStore.deleteDirectory(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(Oe(e),async()=>{const{operation:i,index:a}=await this.getWorkingOperation(t,e);if((i==null?void 0:i.type)===2)return this.discardCore(e,t,n);const l=await this.providerService.getMetadata(t);await this.spliceOperation(t,a,{type:3,uri:t,fileType:_.FileType.Directory,revision:l.HEAD.sha,timestamp:Date.now(),size:void 0,hash:void 0,originalHash:void 0},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async updateDirectoryEntries(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return e;const n=new ce(`ChangeStore.updateDirectoryEntries(${t.toString()})`,{},e.length);try{const i=Oe(r),a=this.cache.get(i);return(a==null?void 0:a.length)===0?e:await this.lock.synchronizeRead(i,async()=>{const{path:l}=Sr(r,t),d=await this.getWorkingOperations(r);for(const m of d)switch(m.type){case 1:break;case 2:{if(pa(m.uri,l)){const v=this.providerService.getRelativeFilePath(t,m.uri);e.push([v,m.fileType])}break}case 3:{if(pa(m.uri,l)){const v=this.providerService.getRelativeFilePath(t,m.uri),E=e.findIndex(([P])=>P===v);E!==-1&&e.splice(E,1)}break}}return e},n.context)}finally{n.stop()}}async writeFile(t,e,r,n){const i=this.providerService.getVirtualWorkspaceUri(t);if(i===void 0)return;const a=new ce(`ChangeStore.writeFile(${t.toString()})`,{},e.length,n);try{const l=[];if(await this.lock.synchronizeWrite(Oe(i),async()=>this.writeFileCore(i,t,l,e,r,n),a.context),l.length===0)return;this._onDidChange.fire(l)}finally{a.stop()}}async writeFileCore(t,e,r,n,i,a){const l=new ce(`ChangeStore.writeFileCore(${e.toString()})`,{},n.length,a);try{const[{operation:d,index:m},v,E]=await Promise.all([this.getWorkingOperation(e,t),lu(n),lu(i)]);if(v===E&&(d==null?void 0:d.type)===1)return this.discardCore(t,e,r);if(v===(d==null?void 0:d.hash)&&E===(d==null?void 0:d.originalHash))return;const[{HEAD:P}]=await Promise.all([this.providerService.getMetadata(e),this.saveWorkingContent(t,e,n)]);await this.spliceOperation(e,m,d===void 0?{type:1,uri:e,fileType:_.FileType.File,revision:P.sha,timestamp:Date.now(),size:n.byteLength,hash:v,originalHash:E,conflicts:a,staged:!1}:{...d,revision:P.sha,timestamp:Date.now(),size:n.byteLength,hash:v,originalHash:E,conflicts:a,staged:!1},r)}finally{l.stop()}}async createFile(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return;const n=new ce(`ChangeStore.createFile(${t.toString()})`,{},e.length);try{const i=[];if(await this.lock.synchronizeWrite(Oe(r),async()=>{const[{operation:a,index:l},d,m]=await Promise.all([this.getWorkingOperation(t,r),lu(e),this.providerService.getMetadata(t),this.saveWorkingContent(r,t,e)]);await this.spliceOperation(t,l,a===void 0?{type:2,uri:t,fileType:_.FileType.File,revision:m.HEAD.sha,timestamp:Date.now(),size:e.byteLength,hash:d,originalHash:d}:{...a,type:2,revision:m.HEAD.sha,timestamp:Date.now(),size:e.byteLength,hash:d},i)},n.context),i.length===0)return;this._onDidChange.fire(i)}finally{n.stop()}}async deleteFile(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new ce(`ChangeStore.deleteFile(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(Oe(e),async()=>{const{operation:i,index:a}=await this.getWorkingOperation(t,e);if((i==null?void 0:i.type)===2)return this.discardCore(e,t,n);const[l]=await Promise.all([this.providerService.getMetadata(t),this.discardWorkingContent(e,t)]);await this.spliceOperation(t,a,{type:3,uri:t,fileType:_.FileType.File,revision:l.HEAD.sha,timestamp:Date.now(),size:void 0,hash:void 0,originalHash:void 0},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}findParent(t,e,r){const n=tr(t),{operation:i,index:a}=this.findWorkingOperation(n,e);return i!==void 0&&r(i,e)?{parent:i,parentIndex:a}:{parent:void 0,parentIndex:-1}}findNewParentWithOnlyChild(t,e){const r=fr(t);return this.findParent(t,e,(n,i)=>n.type===2&&!i.some(a=>pa(a.uri,n.uri)&&fr(a.uri)!==r))}async getWorkingOperation(t,e){return this.findWorkingOperation(t,await this.getWorkingOperations(e))}findWorkingOperation(t,e){if(e.length===0)return{operation:void 0,index:-1};const r=fr(t);let n=-1;const i=e.find((a,l)=>fr(a.uri)!==r?!1:(n=l,!0));return i===void 0?{operation:void 0,index:-1}:{operation:i,index:n}}async getWorkingOperations(t){const e=Oe(t);let r=this.cache.get(e);return r===void 0&&(r=this.fromStorage(await this.storageService.get(this.getOperationsStorageKey(e))),this.cache.set(e,r)),r}async saveWorkingOperations(t,e){he.debug(`ChangeStore.saveWorkingOperations(${t.toString()})`,e.length);const r=Oe(t);this.cache.set(r,e);try{await this.storageService.store(this.getOperationsStorageKey(r),this.toStorage(e))}catch(n){throw this.cache.delete(r),he.error(n,`Failed to save repository changes for ${r}`),n}}getOperationsStorageKey(t){return`operations/${t}`}async getWorkingContent(t,e){try{return await this.fileStorageService.get(this.getFileStorageKey(t,e))}catch(r){throw he.error(r),this.telemetryService.sendException(r),r}}async discardWorkingContent(t,e){he.debug(`ChangeStore.discardWorkingContent(${e.toString()})`);try{return await this.fileStorageService.delete(this.getFileStorageKey(t,e))}catch(r){if(r instanceof _.FileSystemError&&r.code===Iy)return;throw he.error(r),this.telemetryService.sendException(r),r}}async saveWorkingContent(t,e,r){he.debug(`ChangeStore.saveWorkingContent(${e.toString()})`,r.length);try{return await this.fileStorageService.store(this.getFileStorageKey(t,e),r)}catch(n){throw he.error(n),this.telemetryService.sendException(n),n}}getFileStorageKey(t,e){return`changestore/${Hr(e)}`}async spliceOperation(t,e,r,n){const i=this.providerService.getVirtualWorkspaceUri(t);if(i===void 0)return;const a=await this.getWorkingOperations(i);e!==-1?a.splice(e,1,r):a.push(r),await this.saveWorkingOperations(i,a),n.push(uu(r,i,t))}fromStorage(t){if(!t)return[];try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&Lt(n)?typeof n=="string"?_.Uri.parse(n):_.Uri.from(n):n);return Array.isArray(e)?e:e.operations}catch(e){throw he.error(e,"Failed to deserialize ChangeStore operations"),e}}toStorage(t){const e={schemaVersion:Rc.operationsStorageSchemaVersion,operations:t};return JSON.stringify(e)}};let du=Rc;du.operationsStorageSchemaVersion=1,du.ScopedChangeStore=class{constructor(t,e,r){this.changeStore=t,this.scope=e,this.workspaceId=r}createPatch(t,e,r){return this.changeStore.createPatch(this.stripUriScope(t),this.stripUriScope(e),r)}discardAll(t,e){return this.changeStore.discardAll(this.stripUriScope(t),e)}getChange(t){return this.changeStore.getChange(this.stripUriScope(t))}getChanges(t,e){return this.changeStore.getChanges(this.stripUriScope(t),e)}async getGroupedChanges(t,e){return this.changeStore.getGroupedChanges(this.stripUriScope(t),e)}hasChanges(t){return this.changeStore.hasChanges(this.stripUriScope(t))}maybeHasChanges(t,e){return this.changeStore.maybeHasChanges(this.stripUriScope(t),this.stripUriScope(e))}async stat(t){const r=this.changeStore.getUriScope(t)!==this.workspaceId,n=await this.changeStore.stat(this.stripUriScope(t));return n!==void 0&&r&&(n.permissions=_.FilePermission.Readonly),n}readFile(t){return this.changeStore.readFile(this.stripUriScope(t))}resolveDiffCommand(t,e,r,n){return this.changeStore.resolveDiffCommand(this.changeStore.getScopedUri(t,this.scope),this.changeStore.getScopedUri(e,this.scope),r,n)}stripUriScope(t){return t===void 0||!t.fragment?t:t.with({fragment:""})}},Ay([qr()],du.prototype,"getWorkingOperations",1);function kp(t){switch(t){case 1:return jn("change type changed","Modified");case 2:return jn("change type created","Added");case 3:return jn("change type deleted","Deleted")}}function Dy(t){const[e,r]=t;switch(e){case 1:switch(r){case 1:case 2:return jn("conflict status changed both","Modified by Both");case 3:return jn("conflict status deleted them","Deleted by Incoming")}break;case 2:switch(r){case 1:case 2:return jn("conflict status created both","Added by Both");case 3:return jn("conflict status deleted them","Deleted by Incoming")}break;case 3:switch(r){case 1:case 2:return jn("conflict status deleted us","Deleted by Current");case 3:return jn("conflict status deleted both","Deleted by Both")}break}}var ky=__webpack_require__(8361),Ny=__webpack_require__.n(ky);const Lh=class{constructor(t){this.sharedProperties={},Lh._instance=this,this.reporter=new(Ny())(t.extension.id,t.extension.packageJSON.version,Lh.aiKey,!0)}static get instance(){return this._instance}dispose(){this.reporter.dispose()}sendEvent(t,e,r){this.reporter.sendTelemetryEvent(t,{...this.sharedProperties,...e},r)}sendErrorEvent(t,e,r){this.reporter.sendTelemetryErrorEvent(t,{...this.sharedProperties,...e},r)}sendException(t,e,r){this.reporter.sendTelemetryException(t,{...this.sharedProperties,...e},r)}setSharedProperty(t,e){this.sharedProperties[t]=e}};let hu=Lh;hu.aiKey="AIF-d9b70cd4-b9f9-4d70-929b-a071c400b217";function My(t,e){if(t===e)return-1;let r=0;for(;t[r]===e[r];)r++;return r}const wd=(0,F.loadMessageBundle)();let So;var Fh;(function(t){function e(r){const n=$y(r);return So=_.env.uiKind===_.UIKind.Web,he.warn(`Running on the ${So?"web":"desktop"}${r.extensionRuntime!==_.ExtensionRuntime.Node?" in a webworker":""}; workspaceId=${n}; storageUri=${r.globalStorageUri.toString(!0)}`),n}t.configure=e})(Fh||(Fh={}));function Ly(){var t,e;return(e=(t=_.workspace.workspaceFolders)==null?void 0:t.every(r=>r.uri.scheme===Dt.scheme))!=null?e:!1}var nr;(function(t){t.CurrentWindow="currentWindow",t.NewWindow="newWindow",t.AddToWorkspace="addToWorkspace"})(nr||(nr={}));const Fy=/\/workspaceStorage\/(?<id>[^/]+)/i;function $y(t){var e;if(t.storageUri===void 0)return"";const r=Fy.exec(t.storageUri.path);let n;if((e=r==null?void 0:r.groups)==null?void 0:e.id)n=r.groups.id;else{n=t.storageUri.path;const i=My(t.globalStorageUri.path,n),a=`/${t.extension.id}`;n.endsWith(a)?n=n.slice(i,-a.length):n=n.substr(i)}return/-[0-9]$/.test(n)?n.slice(0,-2):n}async function qn(t,e){var r,n,i,a,l;if(hu.instance.sendEvent("openWorkspace",{location:t.location}),t.location===nr.AddToWorkspace){const m=(n=(r=_.workspace.workspaceFolders)==null?void 0:r.length)!=null?n:0;return void _.workspace.updateWorkspaceFolders(m,0,{uri:t.uri,name:t.name})}if(t.location===nr.CurrentWindow&&!(e==null?void 0:e.skipChangesPrompt)){const m=await du.instance.getWorkspaceProvidersWithChanges();if(m.length){const v={title:wd("continue","Continue")},E={title:wd("cancel","Cancel"),isCloseAffordance:!0};if(await _.window.showWarningMessage(So?wd("open folder uncommitted changes web",`You have uncommitted changes.

If you want to see your changes on {0} or from other browsers or machines, commit them before leaving this workspace. Otherwise, you can re-open this workspace anytime and pick up right where you left off.

Do you want to continue opening a new workspace?`,m.map(R=>R.name).join(", ")):wd("open folder uncommitted changes",`You have uncommitted changes.

If you want to see your changes on {0} or from other machines, commit them before leaving this workspace. Otherwise, you can re-open this workspace anytime and pick up right where you left off.

Do you want to continue opening a new workspace?`,m.map(R=>R.name).join(", ")),{modal:!0,useCustom:!0},v,E)!==v){hu.instance.sendEvent("openWorkspace.abort",{reason:"abandoned uncommitted changes prompt"});return}}}const d=_.env.remoteName?!0:void 0;return t.filesToOpen&&(t.location===nr.CurrentWindow&&d===void 0&&((i=_.workspace.workspaceFolders)==null?void 0:i.length)===1&&_.workspace.workspaceFolders[0].uri.toString()===t.uri.toString()?await((a=_h())==null?void 0:a.openPendingFiles(t.uri,t.filesToOpen)):await((l=_h())==null?void 0:l.setPendingFilesToOpen(t.uri,t.filesToOpen))),hu.instance.sendEvent("openWorkspace.success",{location:t.location,forceLocalWindow:String(d)}),void _.commands.executeCommand("vscode.openFolder",t.uri,{forceNewWindow:t.location===nr.NewWindow,forceLocalWindow:d})}var Eo;(function(t){t.HasVirtualFolders="remoteHub:hasVirtualFolders",t.HasSearchIndexes="remoteHub:hasSearchIndexes",t.EnabledSomeSearchIndexes="remoteHub:enabledSomeSearchIndexes",t.EnabledAllSearchIndexes="remoteHub:enabledAllSearchIndexes",t.VirtualFolderProviders="remoteHub:virtualFolderProviders",t.HasPullRequestExtension="remoteHub:hasPullRequestExtension",t.HasWriteableScmProvider="remoteHub:hasWriteableScmProvider"})(Eo||(Eo={}));const Np=new Map;function Ac(t){return t==="isWeb"?So:t==="remoteName"?_.env.remoteName:t==="virtualWorkspace"?Ly():t.startsWith("config.")?Ne.getAny(t.substr(7)):Np.get(t)}function Ic(t){return t==="isWeb"||t==="remoteName"||t==="virtualWorkspace"||t.startsWith("config.")||t.startsWith("remoteHub:")||t.startsWith("continueOn:")}async function _a(t,e){Np.set(t,e),!t.startsWith("continueOn:")&&await _.commands.executeCommand("setContext",t,e)}class By{constructor(e){this.menuItem=e}get label(){return`${this.menuItem.icon?`${this.menuItem.icon} `:""}${this.menuItem.title}`}get description(){return this.menuItem.extension.builtin?"Built-in":this.menuItem.extension.name||this.menuItem.extension.id}async execute(e){return void await _.commands.executeCommand(this.menuItem.command,e)}}var $h;(function(t){async function e(r,n,i){const a=Hy(r).map(m=>new By(m)),l=_.window.createQuickPick(),d=[];try{return await new Promise(v=>{d.push(l.onDidHide(()=>v(void 0)),l.onDidAccept(()=>{if(l.activeItems.length!==0){const[E]=l.activeItems;v(E)}})),l.title=i,l.placeholder=n,l.items=a,l.show()})}finally{l.dispose(),d.forEach(m=>void m.dispose())}}t.show=e})($h||($h={}));function Hy(t){var e,r,n,i,a;const l=new Map,[,d]=t.split(".");for(const v of _.extensions.all){const{name:E,displayName:P,contributes:R}=v.packageJSON;if(!R)continue;const I=(r=(e=R.virtualWorkspaces)==null?void 0:e.menus)==null?void 0:r.continueOn;if(I==null?void 0:I.length){const M=new Map(((n=R.commands)!=null?n:[]).map(N=>[N.command,N]));for(const N of I){if(!N.command)continue;if(l.has(N.command)){he.warn(`Duplicate 'continueOn' menu command: ${N.command}`);continue}const B=M.get(N.command);if(!B){he.warn(`Unable to find 'continueOn' menu command: ${N.command}`);continue}if(!Uy(N.when))continue;const j=(a=(i=N.group)==null?void 0:i.lastIndexOf("@"))!=null?a:-1;l.set(N.command,{extension:{id:E,name:P,builtin:E===d},command:B.command,title:B.title,icon:typeof B.icon=="string"?B.icon:void 0,group:j>0?N.group.substr(0,j):N.group,order:j>0?Number(N.group.substr(j+1)):0,category:B.category})}}}function m(v,E){const P=v.group,R=E.group;if(P!==R){if(!P)return 1;if(!R||P==="navigation")return-1;if(R==="navigation")return 1;const I=P.localeCompare(R);if(I!==0)return I}return v.order<E.order?-1:v.order>E.order?1:v.title.localeCompare(E.title)}return[...l.values()].sort(m)}function Uy(t){return t?t.split("&&").every(e=>{const r=/^(?:(!)?(\S+)|(\S+)\s?(==|!=|=~)\s?(\S+))$/.exec(e.trim());if(!r)return!0;const[,n,i,a,l,d]=r;if(i){if(i==="false")return!1;if(!Ic(i))return!0;const m=Ac(i);return n?!m:m}if(a&&l&&d)switch(l){case"==":return!Ic(a)||!Ic(d)||Ac(a)==Ac(d);case"!=":return!Ic(a)||!Ic(d)||Ac(a)!=Ac(d);case"=~":{if(!Ic(a))return!0;const m=Ac(a);try{return new RegExp(d.slice(1,-1)).test(String(m!=null?m:""))}catch{return!1}}}return!0}):!0}class Bh{constructor(e){this.defaultDelay=e}dispose(){this.cancelTimeout()}debounce(e,r=this.defaultDelay){return this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((n,i)=>{this.resolver=n,this.rejecter=i}).then(()=>{if(this.completionPromise=void 0,this.resolver=void 0,this.task){const n=this.task;return this.task=void 0,n()}})),this.timeout=setTimeout(()=>{var n;this.timeout=void 0,(n=this.resolver)==null||n.call(this,void 0)},r),this.completionPromise}cancel(){var e;this.cancelTimeout(),this.completionPromise&&((e=this.rejecter)==null||e.call(this,new Error("Canceled")),this.completionPromise=void 0)}cancelTimeout(){this.timeout!==void 0&&(clearTimeout(this.timeout),this.timeout=void 0)}}const ba=(0,F.loadMessageBundle)(),Hh=Symbol("QuickPickGoBack");var Uh;(function(t){async function e(r,n,i,a,l,d){const m=r.getRemoteWorkspaceSourceProviders();let v=[];m.length===0?v=[]:v=m.map(N=>new Mp(N));const E=await n.getRemoteWorkspaceSourceProvider("github");if(E){const N=await E.provideSources();v.push(...N.map(B=>({label:`${B.icon?`${B.icon} `:""}${B.name}`,description:B.description,detail:B.detail,url:B.url,workspace:B.url?void 0:B.workspace,buttons:[gi.OpenInNewWindow]})))}let P=await _.env.clipboard.readText();r.canOpenRemoteUrl(P)||(P="");const R=_.window.createQuickPick(),I=[];let M=i;try{for(;;){const N=await new Promise(B=>{I.push(R.onDidHide(()=>B(void 0)),R.onDidChangeValue(j=>{j=j.trim(),j.length===0?(R.ignoreFocusOut=!1,R.items=v):(R.ignoreFocusOut=!0,R.activeItems.length===0||R.activeItems[0]instanceof fu?R.items=[new fu(r,j),...v]:R.items=v)}),R.onDidAccept(()=>{if(R.activeItems.length!==0){const[j]=R.activeItems;(!(j instanceof fu)||j.validate())&&B(j)}}),R.onDidChangeActive(()=>{if(M!==void 0||!(d==null?void 0:d.allowAddToWorkspace))return;const[j]=R.activeItems;let K=!0;if(j===void 0?K=Boolean(R.value):K=j instanceof fu,K){if(R.buttons.length===1)return;R.buttons=[gi.AddToWorkspace]}else{if(R.buttons.length===0)return;R.buttons=[]}}),R.onDidTriggerButton(j=>{if(j===gi.AddToWorkspace){const[K]=R.activeItems;if(!(K instanceof fu))return;K.validate()&&(M=nr.AddToWorkspace,B(K))}}),R.onDidTriggerItemButton(j=>{switch(j.button){case gi.OpenInNewWindow:M=nr.NewWindow,B(j.item);break;default:break}})),R.title=l,R.placeholder=a,R.matchOnDescription=!0,R.items=v,R.sortByLabel=!1,R.value=P,R.show(),P&&R._onDidChangeValueEmitter.fire(R.value)});if(N instanceof Mp){const B=await N.show(M,N.placeholder,l,d);if(B===Hh)continue;return B}return[N,M]}}finally{R.dispose(),I.forEach(N=>void N.dispose())}}t.show=e})(Uh||(Uh={}));class Mp{constructor(e){this.provider=e}get label(){return`${this.provider.icon?`${this.provider.icon} `:""}${this.provider.label}`}get placeholder(){return this.provider.placeholder}async show(e,r,n,i){const a=_.window.createQuickPick(),l=new Bh(500),d=[l];async function m(M,N,B){return(await M.provideSources(N,B)).map(K=>({label:`${K.icon?`${K.icon} `:""}${K.name}`,description:K.description,detail:K.detail,url:K.url,workspace:K.workspace,buttons:[gi.OpenInNewWindow]}))}const v=m(this.provider,void 0,{sort:"updated"});let E=e,P,R=!1;async function I(M){P=void 0;const N=a.activeItems;a.items=M!=null?M:await v,R&&N.length!==0&&(a.activeItems=a.items.filter(B=>N.some(j=>j.url===B.url))),a.busy=!1}try{const M=await new Promise(N=>{d.push(a.onDidHide(()=>N(void 0)),a.onDidChangeValue(B=>{R=!1,B=B.trim(),a.busy=!0;const j=l.debounce(B?()=>m(this.provider,B,{sort:"stars"}):()=>v);P===void 0&&(P=j.then(async K=>I(K)))}),a.onDidAccept(()=>{if(a.activeItems.length!==0){const[B]=a.activeItems;N(B)}}),a.onDidChangeActive(()=>{if(R=a.activeItems.length!==0,E!==void 0||!(i==null?void 0:i.allowAddToWorkspace))return;const[B]=a.activeItems;if(B===void 0){if(a.buttons.length===1)return;a.buttons=[_.QuickInputButtons.Back]}else{if(a.buttons.length===2)return;a.buttons=[_.QuickInputButtons.Back,gi.AddToWorkspace]}}),a.onDidTriggerButton(B=>{if(B===_.QuickInputButtons.Back){N(Hh);return}if(B===gi.AddToWorkspace){const[j]=a.activeItems;if(j===void 0)return;E=nr.AddToWorkspace,N(j)}}),a.onDidTriggerItemButton(B=>{switch(B.button){case gi.OpenInNewWindow:E=nr.NewWindow,N(B.item);break;default:break}})),a.title=n,a.placeholder=r,a.matchOnDetail=!0,a.ignoreFocusOut=!0,a.sortByLabel=!1,a.buttons=[_.QuickInputButtons.Back],a.busy=!0,a.show(),P=l.debounce(async()=>v,0).then(B=>I(B))});return M===Hh?M:[M,E]}finally{a.dispose(),d.forEach(M=>void M.dispose())}}}class fu{constructor(e,r){this.url=r,this.alwaysShow=!0,this.canOpenResult=e.canOpenRemoteUrl(r,"github")}get buttons(){return[gi.OpenInNewWindow]}get label(){if(this.canOpenResult){const{provider:e,urlType:r}=this.canOpenResult;switch(r){case rr.Branch:return ba("remote url picker open branch","Open Branch from {0} Repository",e.name);case rr.Commit:return ba("remote url picker open commit","Open Commit from {0} Repository",e.name);case rr.File:return ba("remote url picker open file","Open File from {0} Repository",e.name);case rr.PullRequest:return ba("remote url picker open pull request","Open Pull Request from {0} Repository",e.name);default:return ba("remote url picker open repository","Open {0} Repository",e.name)}}return ba("remote url picker open unknown","Enter a Remote Url")}get description(){return this.url}validate(){return this.canOpenResult!==void 0}}var gi;(function(t){t.AddToWorkspace={iconPath:new _.ThemeIcon("plus"),tooltip:ba("remote url picker button add to workspace","Add to Workspace")},t.OpenInNewWindow={iconPath:new _.ThemeIcon("empty-window"),tooltip:ba("remote picker open in new window","Open in New Window")}})(gi||(gi={}));var jy=Object.defineProperty,qy=Object.getOwnPropertyDescriptor,Co=(t,e,r,n)=>{for(var i=n>1?void 0:n?qy(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&jy(e,r,i),i};const Cr=(0,F.loadMessageBundle)();class $i{showGitHubStatus500Message(){return _.window.showErrorMessage(Cr("github 500 error notification","GitHub failed to respond and might be experiencing issues. Visit the [GitHub status page](https://githubstatus.com) for more information."),Cr("ok","OK")),Promise.resolve()}async showStatus401Message(e){if(!e)return void _.window.showErrorMessage(Cr("401 error notification","The provided credentials are either invalid or expired."),Cr("ok","OK"));const r=Cr("401 error notification confirm","Reauthenticate");await _.window.showErrorMessage(Cr("401 error notification with reauth","The provided credentials are either invalid or expired. Would you like to reauthenticate?"),r)===r&&e()}async showStatus403Message(e){if(!e)return void _.window.showErrorMessage(Cr("403 error notification","The provided credentials do not have the required access."),Cr("ok","OK"));const r=Cr("403 error notification confirm","Reauthenticate");await _.window.showErrorMessage(Cr("403 error notification with reauth","The provided credentials do not have the required access. Would you like to reauthenticate to grant additional access?"),r)===r&&e()}async showRepositoryEmptyMessage(e){const r=Cr("repository empty open","Open Repository");await _.window.showErrorMessage(Cr("repository empty","Repository '{0}' is empty and cannot be opened. Would you like to open another repository?",e),r)===r&&_.commands.executeCommand("remoteHub.openRepository")}async showPullRequestNotFoundMessage(e,r){const n=Cr("pull request not found open","Open Pull Request");await _.window.showErrorMessage(Cr("pull request not found","Unable to find pull request {1} on repository '{0}'. Would you like to open another pull request?",e,r),n)===n&&_.commands.executeCommand("remoteHub.openRepository")}async showPullRequestHeadNotFoundMessage(e,r){const n=Cr("pull request head not found ok","OK");await _.window.showWarningMessage(Cr("pull request head not found","Unable to find the source branch for pull request {1} on repository '{0}'.",e,r),n)}async showRepositoryForbiddenMessage(e){const r=Cr("repository forbidden open","Open Repository");await _.window.showErrorMessage(Cr("repository forbidden","You don't have access to repository '{0}'. Would you like to open another repository?",e),r)===r&&_.commands.executeCommand("remoteHub.openRepository")}async showRepositoryNotFoundMessage(e){const r=Cr("repository not found confirm","Open Repository");await _.window.showErrorMessage(Cr("repository not found","Unable to find repository '{0}'. Would you like to open another repository?",e),r)===r&&_.commands.executeCommand("remoteHub.openRepository")}async showUnableToOpenRepositoryMessage(e){const r=Cr("unable to open repo confirm","Open Repository");await _.window.showErrorMessage(Cr("unable to open repo","Unable to open repository. {0}. Would you like to open another repository?",String(e)),r)===r&&_.commands.executeCommand("remoteHub.openRepository")}}Co([qr(()=>"")],$i.prototype,"showGitHubStatus500Message",1),Co([qr(()=>"")],$i.prototype,"showStatus401Message",1),Co([qr(()=>"")],$i.prototype,"showStatus403Message",1),Co([qr()],$i.prototype,"showRepositoryEmptyMessage",1),Co([qr()],$i.prototype,"showPullRequestNotFoundMessage",1),Co([qr()],$i.prototype,"showPullRequestHeadNotFoundMessage",1),Co([qr()],$i.prototype,"showRepositoryForbiddenMessage",1),Co([qr()],$i.prototype,"showRepositoryNotFoundMessage",1),Co([qr()],$i.prototype,"showUnableToOpenRepositoryMessage",1);const an=new $i,zr=(0,F.loadMessageBundle)();function zy(t,e,r,n,i){async function a(d){const[m,v]=await Uh.show(t,r,d,zr("open repo placeholder","Enter a remote url, or select a remote provider"),d===nr.AddToWorkspace?zr("open repo title add to workspace","Add Remote Repository to Workspace"):zr("open repo title current window","Open Remote Repository"),{allowAddToWorkspace:!1});if(!m){i.sendEvent("openRepository.abort",{reason:"abandoned"});return}try{let E;if(m.workspace)E=m.workspace,E.location=v!=null?v:E.location;else if(E=await t.createWorkspaceForRemoteUrl(m.url,void 0,v!=null?v:d),!E){i.sendEvent("openRepository.abort",{reason:"aborted invalid url"});return}await qn(E)}catch(E){if(i.sendException(E),E instanceof Ur){const{reauthenticate:P}=E;an.showStatus401Message(()=>P());return}if(E instanceof Mi){an.showRepositoryNotFoundMessage(E.name);return}if(E instanceof Ni){an.showRepositoryForbiddenMessage(E.name);return}if(E instanceof tn){an.showRepositoryEmptyMessage(E.name);return}if(E instanceof en){an.showPullRequestNotFoundMessage(E.name,E.id);return}he.error(E)}}async function l(d,m,v){if(v==null?void 0:v.workspaceFolder){const P=t.getRepository(v.workspaceFolder,m);if(P!==void 0)return P}const E=m?t.repositories.filter(P=>P.provider.id===m):t.repositories;if(E.length!==0){if(E.length>1){const P=await _.window.showQuickPick(E.map(R=>({label:R.name,description:R.provider.name,repository:R})),{placeHolder:d});return P?P.repository:void 0}return E[0]}}return[_.commands.registerCommand("remoteHub.openRepository",()=>(i.sendEvent("command.openRepository"),a())),_.commands.registerCommand("remoteHub.continueOn.openRepository",()=>(i.sendEvent("command.continueOn.openRepository"),a())),_.commands.registerCommand("remoteHub.addRepositoryToWorkspace",()=>{i.sendEvent("command.continueOn.openRepository")}),_.commands.registerCommand("remoteHub.continueOn.addRepositoryToWorkspace",()=>{i.sendEvent("command.continueOn.openRepository")}),_.commands.registerCommand("remoteHub.continueOn",async()=>{const d=await l(zr("continue on choose repository placeholder","Choose which repository to continue working on elsewhere"));if(d===void 0)return;i.sendEvent("command.continueOn");const m=await $h.show(n,zr("continue on placeholder","Choose how you would like to continue working"),zr("continue on title","Continue '{0}' on",d.name));if(!m){i.sendEvent("command.continueOn.abort",{reason:"abandoned"});return}if(await e.hasChanges(d.uri)){const P={title:zr("continue","Continue")},R={title:zr("cancel","Cancel"),isCloseAffordance:!0};if(await _.window.showWarningMessage(zr("continue on uncommitted changes",`You have uncommitted changes.

Unless you commit those changes, you won't be able see them from elsewhere.`),{modal:!0,useCustom:!0},P,R)!==P){i.sendEvent("command.continueOn.abort",{reason:"abandoned uncommitted changes prompt"});return}}const v=t.getRemoteUri(d.provider.id,{repo:d.id}),{HEAD:E}=await d.getMetadata();await m.execute({provider:d.provider,workspaceFolder:d.uri,name:d.name,url:v==null?void 0:v.toString(!0),ref:E.name})}),_.commands.registerCommand("remoteHub.openOnDesktop",async d=>{if(!So)return;const m=await l(zr("continue on desktop choose repository placeholder","Choose which repository to open on the desktop"),void 0,d);if(m===void 0)return;const v=await t.getBestRemoteUri(m.uri);v!==void 0&&(i.sendEvent("command.openOnDesktop"),_.env.openExternal(_.Uri.parse(`${_.env.uriScheme}://${n}/open?url=${encodeURIComponent(v.toString(!0))}`)))}),_.commands.registerCommand("remoteHub.openOnWeb",async d=>{if(So)return;const m=await l(zr("continue on web choose repository placeholder","Choose which repository to open on the web"),void 0,d);if(m===void 0)return;const v=await t.getBestRemoteUri(m.uri);v!==void 0&&(i.sendEvent("command.openOnWeb"),_.env.openExternal(v))}),_.commands.registerCommand("remoteHub.goToRepository",async()=>{i.sendEvent("command.goToRepository");const d=await l(zr("open on remote choose repository placeholder","Choose which repository to open on the remote"));if(!d)return;const m={provider:d.provider,repo:d.id};return _.commands.executeCommand("remoteHub.openOnRemote",m)}),_.commands.registerCommand("remoteHub.openOnRemote",async d=>{i.sendEvent("command.openOnRemote");const{provider:m,...v}=d,E=t.getRemoteUri(m.id,v);if(E){await _.env.openExternal(E);return}_.window.showErrorMessage(zr("open on remote command provider not supported","Unable to open the resource on {0}",d.provider.name))}),_.commands.registerCommand("remoteHub.clone",async d=>{const m=await l(zr("clone placeholder","Choose which repository to clone"),void 0,d);if(m!==void 0){if(i.sendEvent("command.clone"),d===void 0&&await e.hasChanges(m.uri)){const v={title:zr("continue","Continue")},E={title:zr("cancel","Cancel"),isCloseAffordance:!0};if(await _.window.showWarningMessage(zr("clone uncommitted changes",`You have uncommitted changes.

Unless you commit those changes, you won't be able see them in your local clone.`),{modal:!0,useCustom:!0},v,E)!==v){i.sendEvent("command.clone.abort",{reason:"abandoned uncommitted changes prompt"});return}}await t.clone(m.uri)}}),_.commands.registerCommand("remoteHub.refresh",()=>void t.refresh()),_.commands.registerCommand("remoteHub.enableDebugLogging",()=>Ne.updateEffective("logLevel",dt.Debug)),_.commands.registerCommand("remoteHub.disableDebugLogging",()=>Ne.updateEffective("logLevel",dt.Warn)),_.commands.registerCommand("remoteHub.exportDebugInfo",async()=>{await r.exportDebugInfo(),await e.exportDebugInfo()}),_.commands.registerCommand("remoteHub.setContext",async(d,m)=>{if(!d.startsWith("continueOn:"))throw new Error("Key must start with 'continueOn:'");await _a(d,m)})]}function mi(t){return t}async function jh(t,e){return _.commands.executeCommand(t,e)}class Wy{constructor(){this._timeout=0,this._disposable=Ne.onDidChange(this.onConfigurationChanged,this),this.maybeQueueFetch()}dispose(){this._disposable.dispose(),this._timeout&&clearTimeout(this._timeout)}get config(){var e;if(this._config===void 0){const r=Ne.get("autoFetch");this._config={enabled:(e=r.enabled)!=null?e:!0,interval:r.interval*1e3}}return this._config}onConfigurationChanged(e){!Ne.changed(e,"autoFetch")||(this._config=void 0,this.maybeQueueFetch())}async fetchAll(){try{await jh("remoteHub.fetchAll",{automated:!0})}catch(e){he.error(e,"Autofetch failed")}this.maybeQueueFetch()}maybeQueueFetch(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),!!this.config.enabled&&(this._timeout=setTimeout(()=>this.fetchAll(),this.config.interval))}}var Gy=__webpack_require__(4300),Lp=__webpack_require__(6113),Vy=__webpack_require__.n(Lp);const Sd=new Uint8Array(256);let Ed=Sd.length;function Ky(){return Ed>Sd.length-16&&(Vy().randomFillSync(Sd),Ed=0),Sd.slice(Ed,Ed+=16)}const Qy=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Xy(t){return typeof t=="string"&&Qy.test(t)}const Yy=Xy,Wr=[];for(let t=0;t<256;++t)Wr.push((t+256).toString(16).substr(1));function Zy(t,e=0){const r=(Wr[t[e+0]]+Wr[t[e+1]]+Wr[t[e+2]]+Wr[t[e+3]]+"-"+Wr[t[e+4]]+Wr[t[e+5]]+"-"+Wr[t[e+6]]+Wr[t[e+7]]+"-"+Wr[t[e+8]]+Wr[t[e+9]]+"-"+Wr[t[e+10]]+Wr[t[e+11]]+Wr[t[e+12]]+Wr[t[e+13]]+Wr[t[e+14]]+Wr[t[e+15]]).toLowerCase();if(!Yy(r))throw TypeError("Stringified UUID is invalid");return r}const Jy=Zy;function e0(t,e,r){t=t||{};const n=t.random||(t.rng||Ky)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let i=0;i<16;++i)e[r+i]=n[i];return e}return Jy(n)}const t0=e0;var ys=__webpack_require__(3685),Fp=__webpack_require__(5687),On=__webpack_require__(9796),ir=__webpack_require__(2781),r0=__webpack_require__(5175),Cd=__webpack_require__(3837),zE=__webpack_require__(7135);const $p=65536;async function*qh(t,e=!0){for(let r of t)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(e){let n=r.byteOffset,i=r.byteOffset+r.byteLength;for(;n!==i;){const a=Math.min(i-n,$p),l=r.buffer.slice(n,n+a);n+=l.byteLength,yield new Uint8Array(l)}}else yield r;else{let n=0;for(;n!==r.size;){const a=await r.slice(n,Math.min(r.size,n+$p)).arrayBuffer();n+=a.byteLength,yield new Uint8Array(a)}}}const Bp=(el=class{constructor(e=[],r={}){wh(this,Fo,[]);wh(this,rd,"");wh(this,Jc,0);let n=0;const i=e.map(l=>{let d;return ArrayBuffer.isView(l)?d=new Uint8Array(l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)):l instanceof ArrayBuffer?d=new Uint8Array(l.slice(0)):l instanceof el?d=l:d=new TextEncoder().encode(l),n+=ArrayBuffer.isView(d)?d.byteLength:d.size,d}),a=r.type===void 0?"":String(r.type);rl(this,rd,/[^\u0020-\u007E]/.test(a)?"":a),rl(this,Jc,n),rl(this,Fo,i)}get size(){return Ms(this,Jc)}get type(){return Ms(this,rd)}async text(){const e=new TextDecoder;let r="";for await(let n of qh(Ms(this,Fo),!1))r+=e.decode(n,{stream:!0});return r+=e.decode(),r}async arrayBuffer(){const e=new Uint8Array(this.size);let r=0;for await(const n of qh(Ms(this,Fo),!1))e.set(n,r),r+=n.length;return e.buffer}stream(){const e=qh(Ms(this,Fo),!0);return new ReadableStream({type:"bytes",async pull(r){const n=await e.next();n.done?r.close():r.enqueue(n.value)}})}slice(e=0,r=this.size,n=""){const{size:i}=this;let a=e<0?Math.max(i+e,0):Math.min(e,i),l=r<0?Math.max(i+r,0):Math.min(r,i);const d=Math.max(l-a,0),m=Ms(this,Fo),v=[];let E=0;for(const R of m){if(E>=d)break;const I=ArrayBuffer.isView(R)?R.byteLength:R.size;if(a&&I<=a)a-=I,l-=I;else{let M;ArrayBuffer.isView(R)?(M=R.subarray(a,Math.min(I,l)),E+=M.byteLength):(M=R.slice(a,Math.min(I,l)),E+=M.size),v.push(M),a=0}}const P=new el([],{type:String(n).toLowerCase()});return rl(P,Jc,d),rl(P,Fo,v),P}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}},Fo=new WeakMap,rd=new WeakMap,Jc=new WeakMap,el);Object.defineProperties(Bp.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});const n0=Bp;class Td extends Error{constructor(e,r){super(e);Error.captureStackTrace(this,this.constructor),this.type=r}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class To extends Td{constructor(e,r,n){super(e,r);n&&(this.code=this.errno=n.code,this.erroredSysCall=n.syscall)}}const pu=Symbol.toStringTag,Hp=t=>typeof t=="object"&&typeof t.append=="function"&&typeof t.delete=="function"&&typeof t.get=="function"&&typeof t.getAll=="function"&&typeof t.has=="function"&&typeof t.set=="function"&&typeof t.sort=="function"&&t[pu]==="URLSearchParams",wa=t=>typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.constructor=="function"&&/^(Blob|File)$/.test(t[pu]);function zh(t){return typeof t=="object"&&typeof t.append=="function"&&typeof t.set=="function"&&typeof t.get=="function"&&typeof t.getAll=="function"&&typeof t.delete=="function"&&typeof t.keys=="function"&&typeof t.values=="function"&&typeof t.entries=="function"&&typeof t.constructor=="function"&&t[pu]==="FormData"}const i0=t=>typeof t=="object"&&(t[pu]==="AbortSignal"||t[pu]==="EventTarget"),Pc=`\r
`,Wh="-".repeat(2),o0=Buffer.byteLength(Pc),Up=t=>`${Wh}${t}${Wh}${Pc.repeat(2)}`;function jp(t,e,r){let n="";return n+=`${Wh}${t}${Pc}`,n+=`Content-Disposition: form-data; name="${e}"`,wa(r)&&(n+=`; filename="${r.name}"${Pc}`,n+=`Content-Type: ${r.type||"application/octet-stream"}`),`${n}${Pc.repeat(2)}`}const a0=()=>(0,Lp.randomBytes)(8).toString("hex");async function*s0(t,e){for(const[r,n]of t)yield jp(e,r,n),wa(n)?yield*n.stream():yield n,yield Pc;yield Up(e)}function c0(t,e){let r=0;for(const[n,i]of t)r+=Buffer.byteLength(jp(e,n,i)),r+=wa(i)?i.size:Buffer.byteLength(String(i)),r+=o0;return r+=Buffer.byteLength(Up(e)),r}const Dn=Symbol("Body internals");class Gh{constructor(e,{size:r=0}={}){let n=null;e===null?e=null:Hp(e)?e=Buffer.from(e.toString()):wa(e)||Buffer.isBuffer(e)||(Cd.types.isAnyArrayBuffer(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof ir||(zh(e)?(n=`NodeFetchFormDataBoundary${a0()}`,e=ir.Readable.from(s0(e,n))):e=Buffer.from(String(e)))),this[Dn]={body:e,boundary:n,disturbed:!1,error:null},this.size=r,e instanceof ir&&e.on("error",i=>{const a=i instanceof Td?i:new To(`Invalid response body while trying to fetch ${this.url}: ${i.message}`,"system",i);this[Dn].error=a})}get body(){return this[Dn].body}get bodyUsed(){return this[Dn].disturbed}async arrayBuffer(){const{buffer:e,byteOffset:r,byteLength:n}=await xd(this);return e.slice(r,r+n)}async blob(){const e=this.headers&&this.headers.get("content-type")||this[Dn].body&&this[Dn].body.type||"",r=await this.buffer();return new n0([r],{type:e})}async json(){const e=await xd(this);return JSON.parse(e.toString())}async text(){return(await xd(this)).toString()}buffer(){return xd(this)}}Object.defineProperties(Gh.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}});async function xd(t){if(t[Dn].disturbed)throw new TypeError(`body used already for: ${t.url}`);if(t[Dn].disturbed=!0,t[Dn].error)throw t[Dn].error;let{body:e}=t;if(e===null)return Buffer.alloc(0);if(wa(e)&&(e=ir.Readable.from(e.stream())),Buffer.isBuffer(e))return e;if(!(e instanceof ir))return Buffer.alloc(0);const r=[];let n=0;try{for await(const i of e){if(t.size>0&&n+i.length>t.size){const a=new To(`content size at ${t.url} over limit: ${t.size}`,"max-size");throw e.destroy(a),a}n+=i.length,r.push(i)}}catch(i){throw i instanceof Td?i:new To(`Invalid response body while trying to fetch ${t.url}: ${i.message}`,"system",i)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return r.every(i=>typeof i=="string")?Buffer.from(r.join("")):Buffer.concat(r,n)}catch(i){throw new To(`Could not create Buffer from response body for ${t.url}: ${i.message}`,"system",i)}else throw new To(`Premature close of server response while trying to fetch ${t.url}`)}const qp=(t,e)=>{let r,n,{body:i}=t;if(t.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof ir&&typeof i.getBoundary!="function"&&(r=new ir.PassThrough({highWaterMark:e}),n=new ir.PassThrough({highWaterMark:e}),i.pipe(r),i.pipe(n),t[Dn].body=r,i=n),i},zp=(t,e)=>t===null?null:typeof t=="string"?"text/plain;charset=UTF-8":Hp(t)?"application/x-www-form-urlencoded;charset=UTF-8":wa(t)?t.type||null:Buffer.isBuffer(t)||Cd.types.isAnyArrayBuffer(t)||ArrayBuffer.isView(t)?null:t&&typeof t.getBoundary=="function"?`multipart/form-data;boundary=${t.getBoundary()}`:zh(t)?`multipart/form-data; boundary=${e[Dn].boundary}`:t instanceof ir?null:"text/plain;charset=UTF-8",l0=t=>{const{body:e}=t;return e===null?0:wa(e)?e.size:Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"?e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null:zh(e)?c0(t[Dn].boundary):null},u0=(t,{body:e})=>{e===null?t.end():wa(e)?ir.Readable.from(e.stream()).pipe(t):Buffer.isBuffer(e)?(t.write(e),t.end()):e.pipe(t)},Rd=typeof ys.validateHeaderName=="function"?ys.validateHeaderName:t=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(t)){const e=new TypeError(`Header name must be a valid HTTP token [${t}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},Vh=typeof ys.validateHeaderValue=="function"?ys.validateHeaderValue:(t,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){const r=new TypeError(`Invalid character in header content ["${t}"]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_CHAR"}),r}};class Sa extends URLSearchParams{constructor(e){let r=[];if(e instanceof Sa){const n=e.raw();for(const[i,a]of Object.entries(n))r.push(...a.map(l=>[i,l]))}else if(e!=null)if(typeof e=="object"&&!Cd.types.isBoxedPrimitive(e)){const n=e[Symbol.iterator];if(n==null)r.push(...Object.entries(e));else{if(typeof n!="function")throw new TypeError("Header pairs must be iterable");r=[...e].map(i=>{if(typeof i!="object"||Cd.types.isBoxedPrimitive(i))throw new TypeError("Each header pair must be an iterable object");return[...i]}).map(i=>{if(i.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...i]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");r=r.length>0?r.map(([n,i])=>(Rd(n),Vh(n,String(i)),[String(n).toLowerCase(),String(i)])):void 0;super(r);return new Proxy(this,{get(n,i,a){switch(i){case"append":case"set":return(l,d)=>(Rd(l),Vh(l,String(d)),URLSearchParams.prototype[i].call(n,String(l).toLowerCase(),String(d)));case"delete":case"has":case"getAll":return l=>(Rd(l),URLSearchParams.prototype[i].call(n,String(l).toLowerCase()));case"keys":return()=>(n.sort(),new Set(URLSearchParams.prototype.keys.call(n)).keys());default:return Reflect.get(n,i,a)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){const r=this.getAll(e);if(r.length===0)return null;let n=r.join(", ");return/^content-encoding$/i.test(e)&&(n=n.toLowerCase()),n}forEach(e,r=void 0){for(const n of this.keys())Reflect.apply(e,r,[this.get(n),n,this])}*values(){for(const e of this.keys())yield this.get(e)}*entries(){for(const e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,r)=>(e[r]=this.getAll(r),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,r)=>{const n=this.getAll(r);return r==="host"?e[r]=n[0]:e[r]=n.length>1?n:n[0],e},{})}}Object.defineProperties(Sa.prototype,["get","entries","forEach","values"].reduce((t,e)=>(t[e]={enumerable:!0},t),{}));function d0(t=[]){return new Sa(t.reduce((e,r,n,i)=>(n%2==0&&e.push(i.slice(n,n+2)),e),[]).filter(([e,r])=>{try{return Rd(e),Vh(e,String(r)),!0}catch{return!1}}))}const h0=new Set([301,302,303,307,308]),Wp=t=>h0.has(t),vi=Symbol("Response internals");class yi extends Gh{constructor(e=null,r={}){super(e,r);const n=r.status!=null?r.status:200,i=new Sa(r.headers);if(e!==null&&!i.has("Content-Type")){const a=zp(e);a&&i.append("Content-Type",a)}this[vi]={type:"default",url:r.url,status:n,statusText:r.statusText||"",headers:i,counter:r.counter,highWaterMark:r.highWaterMark}}get type(){return this[vi].type}get url(){return this[vi].url||""}get status(){return this[vi].status}get ok(){return this[vi].status>=200&&this[vi].status<300}get redirected(){return this[vi].counter>0}get statusText(){return this[vi].statusText}get headers(){return this[vi].headers}get highWaterMark(){return this[vi].highWaterMark}clone(){return new yi(qp(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size})}static redirect(e,r=302){if(!Wp(r))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new yi(null,{headers:{location:new URL(e).toString()},status:r})}static error(){const e=new yi(null,{status:0,statusText:""});return e[vi].type="error",e}get[Symbol.toStringTag](){return"Response"}}Object.defineProperties(yi.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var Ad=__webpack_require__(7310);const f0=t=>{if(t.search)return t.search;const e=t.href.length-1,r=t.hash||(t.href[e]==="#"?"#":"");return t.href[e-r.length]==="?"?"?":""},xo=Symbol("Request internals"),Id=t=>typeof t=="object"&&typeof t[xo]=="object";class gu extends Gh{constructor(e,r={}){let n;Id(e)?n=new URL(e.url):(n=new URL(e),e={});let i=r.method||e.method||"GET";if(i=i.toUpperCase(),(r.body!=null||Id(e))&&e.body!==null&&(i==="GET"||i==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");const a=r.body?r.body:Id(e)&&e.body!==null?qp(e):null;super(a,{size:r.size||e.size||0});const l=new Sa(r.headers||e.headers||{});if(a!==null&&!l.has("Content-Type")){const m=zp(a,this);m&&l.append("Content-Type",m)}let d=Id(e)?e.signal:null;if("signal"in r&&(d=r.signal),d!=null&&!i0(d))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");this[xo]={method:i,redirect:r.redirect||e.redirect||"follow",headers:l,parsedURL:n,signal:d},this.follow=r.follow===void 0?e.follow===void 0?20:e.follow:r.follow,this.compress=r.compress===void 0?e.compress===void 0?!0:e.compress:r.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent,this.highWaterMark=r.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=r.insecureHTTPParser||e.insecureHTTPParser||!1}get method(){return this[xo].method}get url(){return(0,Ad.format)(this[xo].parsedURL)}get headers(){return this[xo].headers}get redirect(){return this[xo].redirect}get signal(){return this[xo].signal}clone(){return new gu(this)}get[Symbol.toStringTag](){return"Request"}}Object.defineProperties(gu.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});const p0=t=>{const{parsedURL:e}=t[xo],r=new Sa(t[xo].headers);r.has("Accept")||r.set("Accept","*/*");let n=null;if(t.body===null&&/^(post|put)$/i.test(t.method)&&(n="0"),t.body!==null){const d=l0(t);typeof d=="number"&&!Number.isNaN(d)&&(n=String(d))}n&&r.set("Content-Length",n),r.has("User-Agent")||r.set("User-Agent","node-fetch"),t.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate,br");let{agent:i}=t;typeof i=="function"&&(i=i(e)),!r.has("Connection")&&!i&&r.set("Connection","close");const a=f0(e);return{path:e.pathname+a,pathname:e.pathname,hostname:e.hostname,protocol:e.protocol,port:e.port,hash:e.hash,search:e.search,query:e.query,href:e.href,method:t.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:t.insecureHTTPParser,agent:i}};class g0 extends Td{constructor(e,r="aborted"){super(e,r)}}const m0=new Set(["data:","http:","https:"]);async function Gp(t,e){return new Promise((r,n)=>{const i=new gu(t,e),a=p0(i);if(!m0.has(a.protocol))throw new TypeError(`node-fetch cannot load ${t}. URL scheme "${a.protocol.replace(/:$/,"")}" is not supported.`);if(a.protocol==="data:"){const I=r0(i.url),M=new yi(I,{headers:{"Content-Type":I.typeFull}});r(M);return}const l=(a.protocol==="https:"?Fp:ys).request,{signal:d}=i;let m=null;const v=()=>{const I=new g0("The operation was aborted.");n(I),i.body&&i.body instanceof ir.Readable&&i.body.destroy(I),!(!m||!m.body)&&m.body.emit("error",I)};if(d&&d.aborted){v();return}const E=()=>{v(),R()},P=l(a);d&&d.addEventListener("abort",E);const R=()=>{P.abort(),d&&d.removeEventListener("abort",E)};P.on("error",I=>{n(new To(`request to ${i.url} failed, reason: ${I.message}`,"system",I)),R()}),v0(P,I=>{m.body.destroy(I)}),process.version<"v14"&&P.on("socket",I=>{let M;I.prependListener("end",()=>{M=I._eventsCount}),I.prependListener("close",N=>{if(m&&M<I._eventsCount&&!N){const B=new Error("Premature close");B.code="ERR_STREAM_PREMATURE_CLOSE",m.body.emit("error",B)}})}),P.on("response",I=>{P.setTimeout(0);const M=d0(I.rawHeaders);if(Wp(I.statusCode)){const ee=M.get("Location"),te=ee===null?null:new URL(ee,i.url);switch(i.redirect){case"error":n(new To(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),R();return;case"manual":te!==null&&M.set("Location",te);break;case"follow":{if(te===null)break;if(i.counter>=i.follow){n(new To(`maximum redirect reached at: ${i.url}`,"max-redirect")),R();return}const fe={headers:new Sa(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:i.body,signal:i.signal,size:i.size};if(I.statusCode!==303&&i.body&&e.body instanceof ir.Readable){n(new To("Cannot follow redirect with body being a readable stream","unsupported-redirect")),R();return}(I.statusCode===303||(I.statusCode===301||I.statusCode===302)&&i.method==="POST")&&(fe.method="GET",fe.body=void 0,fe.headers.delete("content-length")),r(Gp(new gu(te,fe))),R();return}default:return n(new TypeError(`Redirect option '${i.redirect}' is not a valid value of RequestRedirect`))}}d&&I.once("end",()=>{d.removeEventListener("abort",E)});let N=(0,ir.pipeline)(I,new ir.PassThrough,n);process.version<"v12.10"&&I.on("aborted",E);const B={url:i.url,status:I.statusCode,statusText:I.statusMessage,headers:M,size:i.size,counter:i.counter,highWaterMark:i.highWaterMark},j=M.get("Content-Encoding");if(!i.compress||i.method==="HEAD"||j===null||I.statusCode===204||I.statusCode===304){m=new yi(N,B),r(m);return}const K={flush:On.Z_SYNC_FLUSH,finishFlush:On.Z_SYNC_FLUSH};if(j==="gzip"||j==="x-gzip"){N=(0,ir.pipeline)(N,On.createGunzip(K),n),m=new yi(N,B),r(m);return}if(j==="deflate"||j==="x-deflate"){(0,ir.pipeline)(I,new ir.PassThrough,n).once("data",te=>{N=(te[0]&15)==8?(0,ir.pipeline)(N,On.createInflate(),n):(0,ir.pipeline)(N,On.createInflateRaw(),n),m=new yi(N,B),r(m)});return}if(j==="br"){N=(0,ir.pipeline)(N,On.createBrotliDecompress(),n),m=new yi(N,B),r(m);return}m=new yi(N,B),r(m)}),u0(P,i)})}function v0(t,e){const r=Buffer.from(`0\r
\r
`);let n=!1,i=!1,a;t.on("response",l=>{const{headers:d}=l;n=d["transfer-encoding"]==="chunked"&&!d["content-length"]}),t.on("socket",l=>{const d=()=>{if(n&&!i){const m=new Error("Premature close");m.code="ERR_STREAM_PREMATURE_CLOSE",e(m)}};l.prependListener("close",d),t.on("abort",()=>{l.removeListener("close",d)}),l.on("data",m=>{i=Buffer.compare(m.slice(-5),r)===0,!i&&a&&(i=Buffer.compare(a.slice(-3),r.slice(0,3))===0&&Buffer.compare(m.slice(-2),r.slice(3))===0),a=m})})}const zn=Gp,y0=F.loadMessageBundle(),_0="https://app.vssps.visualstudio.com/oauth2",Vp="https://prod.richnav.vsengsaas.visualstudio.com/api/v0.1/azDOAuth",b0="1BACBD12-21C6-46ED-899C-1FC50517FBAA",Pd=["vso.code"];function w0(t){return(t.query.includes("&")?t.query:decodeURIComponent(t.query)).split("&").reduce((r,n)=>{const i=n.split("=");return r[i[0]]=i[1],r},{})}const Ea=new _.EventEmitter,Kp=new _.EventEmitter,Od="Network failure",mu="AzDO";class S0{constructor(e){this._tokens=[],this._refreshTimeouts=new Map,this._disposables=[],this._pendingStates=new Map,this._codeExchangePromises=new Map,this.secretStorage=e.secrets,this.extensionId=e.extension.id}async initialize(){const e=await this.secretStorage.get(mu);if(e)try{const n=this.parseStoredData(e).map(async i=>{var a;if(!i.refreshToken)return Promise.resolve();try{await this.refreshToken(i.refreshToken,i.scope,i.id)}catch(l){l.message===Od?await this.handleRefreshNetworkError(i.id,i.refreshToken,i.scope)||(this._tokens.push({accessToken:void 0,refreshToken:i.refreshToken,account:{label:(a=i.account.label)!=null?a:i.account.displayName,id:i.account.id},scope:i.scope,sessionId:i.id}),this.pollForReconnect(i.id,i.refreshToken,i.scope)):await this.removeSession(i.id)}});await Promise.all(n)}catch(r){he.log("Failed to initialize stored data"),await this.clearSessions()}this._disposables.push(this.secretStorage.onDidChange(()=>this.checkForUpdates))}parseStoredData(e){return JSON.parse(e)}async storeTokenData(){const e=this._tokens.map(r=>({id:r.sessionId,refreshToken:r.refreshToken,scope:r.scope,account:r.account}));await this.secretStorage.store(mu,JSON.stringify(e))}async checkForUpdates(){const e=[];let r=[];const n=await this.secretStorage.get(mu);if(n)try{const i=this.parseStoredData(n);let a=i.map(async l=>{if(!this._tokens.some(m=>m.scope===l.scope&&m.sessionId===l.id)&&l.refreshToken)try{const m=await this.refreshToken(l.refreshToken,l.scope,l.id);e.push(this.convertToSessionSync(m))}catch(m){m.message===Od||await this.removeSession(l.id)}});a=a.concat(this._tokens.map(async l=>{i.some(m=>l.scope===m.scope&&l.sessionId===m.id)||(await this.removeSession(l.sessionId),r.push(this.convertToSessionSync(l)))})),await Promise.all(a)}catch(i){he.error(i),r=this._tokens.map(this.convertToSessionSync),this.clearSessions()}else this._tokens.length&&(r=this._tokens.map(this.convertToSessionSync),he.log("No stored keychain data, clearing local data"),this._tokens=[],this._refreshTimeouts.forEach(i=>{clearTimeout(i)}),this._refreshTimeouts.clear());(e.length||r.length)&&Ea.fire({added:e,removed:r,changed:[]})}convertToSessionSync(e){return{id:e.sessionId,accessToken:e.accessToken,account:e.account,scopes:e.scope.split(" ")}}async convertToSession(e){const r=await this.resolveAccessToken(e);return{id:e.sessionId,accessToken:r,account:e.account,scopes:e.scope.split(" ")}}async resolveAccessToken(e){if(e.accessToken&&(!e.expiresAt||e.expiresAt>Date.now()))return e.expiresAt?he.log(`Token available from cache, expires in ${e.expiresAt-Date.now()} milliseconds`):he.log("Token available from cache"),Promise.resolve(e.accessToken);try{he.log("Token expired or unavailable, trying refresh");const r=await this.refreshToken(e.refreshToken,e.scope,e.sessionId);if(r.accessToken)return r.accessToken;throw new Error("No access token returned.")}catch(r){throw new Error("Unavailable due to network problems")}}getTokenClaims(e){try{return JSON.parse(Gy.Buffer.from(e.split(".")[1],"base64").toString())}catch(r){throw he.error(r),new Error("Unable to read token claims")}}get sessions(){return Promise.all(this._tokens.map(e=>this.convertToSession(e)))}async getSessions(e){if(!e)return this.sessions;const r=e.sort().join(" "),n=this._tokens.filter(i=>i.scope===r);return Promise.all(n.map(i=>this.convertToSession(i)))}createSession(e){return he.log("Logging in..."),this.loginWithoutLocalServer(e)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}async loginWithoutLocalServer(e){var r;const i=(await _.env.asExternalUri(_.Uri.parse(`${_.env.uriScheme}://${this.extensionId}/login`))).toString(),a=_.Uri.parse(`${_0}/authorize?client_id=${b0}&response_type=Assertion&state=${encodeURIComponent(i)}&scope=${encodeURIComponent(Pd.join(" "))}&redirect_uri=${encodeURIComponent(Vp)}`),l=new Promise((v,E)=>{const P=setTimeout(()=>{clearTimeout(P),E("Login timed out.")},1e3*60*5)}),d=(r=this._pendingStates.get(e))!=null?r:[];this._pendingStates.set(e,[...d,i]);let m=this._codeExchangePromises.get(e);return m||(m=this.handleCodeResponse(e),this._codeExchangePromises.set(e,m)),_.env.openExternal(a),Promise.race([m,l]).finally(()=>{this._pendingStates.delete(e),this._codeExchangePromises.delete(e)})}async handleCodeResponse(e){let r;return new Promise((n,i)=>{r=Kp.event(async a=>{try{he.log(`Received Uri: ${a.toString()}`);const l=w0(a);if(!l.accessInfo)throw new Error(`No access info found in query: ${JSON.stringify(l)}`);const d=JSON.parse(l.accessInfo),m=await this.getTokenFromResponse(d,e);this.setToken(m,e);const v=await this.convertToSession(m);n(v)}catch(l){he.error(l),i(l)}})}).then(n=>(r.dispose(),n)).catch(n=>{throw r.dispose(),n})}setToken(e,r){const n=this._tokens.findIndex(i=>i.sessionId===e.sessionId);return n>-1?this._tokens.splice(n,1,e):this._tokens.push(e),this.clearSessionTimeout(e.sessionId),e.expiresIn&&this._refreshTimeouts.set(e.sessionId,setTimeout(async()=>{try{const i=await this.refreshToken(e.refreshToken,r,e.sessionId);Ea.fire({added:[],removed:[],changed:[this.convertToSessionSync(i)]})}catch(i){i.message===Od?await this.handleRefreshNetworkError(e.sessionId,e.refreshToken,r)||this.pollForReconnect(e.sessionId,e.refreshToken,e.scope):(await this.removeSession(e.sessionId),Ea.fire({added:[],removed:[this.convertToSessionSync(e)],changed:[]}))}},1e3*(e.expiresIn-30))),this.storeTokenData()}async getTokenFromResponse(e,r,n){var i;const a=this.getTokenClaims(e.accessToken),l=await zn("https://app.vssps.visualstudio.com/_apis/profile/profiles/me?api-version=6.0",{headers:{Authorization:`Bearer ${e.accessToken}`,"Content-Type":"application/json"}});let d;if(l.ok)d=(await l.json()).displayName;else{const m=await l.text();he.error(m),d="User"}return{expiresIn:e.expiresIn,expiresAt:e.expiresIn?Date.now()+e.expiresIn*1e3:void 0,accessToken:e.accessToken,refreshToken:e.refreshToken,scope:r,sessionId:n!=null?n:`${a.nameid}/${t0()}`,account:{label:d,id:`${a.nameid}/${(i=a.aui)!=null?i:""}`}}}async refreshToken(e,r,n){he.log("Refreshing token...");let i;try{const a=`${Vp}/refresh?refreshToken=${e}&isFromRemoteHub=true`;i=await zn(a)}catch(a){throw he.error("Refreshing token failed"),new Error(Od)}try{if(i.ok){const a=await i.json(),l=await this.getTokenFromResponse({accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token},r,n);return this.setToken(l,r),he.log("Token refresh success"),l}throw new Error("Bad request.")}catch(a){throw await _.window.showErrorMessage(y0("signOut","You have been signed out because reading stored authentication information failed.")),he.error(`Refreshing token failed: ${i.statusText}`),new Error("Refreshing token failed")}}clearSessionTimeout(e){const r=this._refreshTimeouts.get(e);r&&(clearTimeout(r),this._refreshTimeouts.delete(e))}removeInMemorySessionData(e){const r=this._tokens.findIndex(i=>i.sessionId===e);let n;return r>-1&&(n=this._tokens[r],this._tokens.splice(r,1)),this.clearSessionTimeout(e),n}pollForReconnect(e,r,n){this.clearSessionTimeout(e),this._refreshTimeouts.set(e,setTimeout(async()=>{try{const i=await this.refreshToken(r,n,e);Ea.fire({added:[],removed:[],changed:[this.convertToSessionSync(i)]})}catch(i){this.pollForReconnect(e,r,n)}},1e3*60*30))}handleRefreshNetworkError(e,r,n,i=1){return new Promise((a,l)=>{if(i===3)return he.error("Token refresh failed after 3 attempts"),a(!1);const d=5*i*i;this.clearSessionTimeout(e),this._refreshTimeouts.set(e,setTimeout(async()=>{try{const m=await this.refreshToken(r,n,e);return Ea.fire({added:[],removed:[],changed:[this.convertToSessionSync(m)]}),a(!0)}catch(m){return a(await this.handleRefreshNetworkError(e,r,n,i+1))}},1e3*d))})}async removeSession(e){he.log(`Logging out of session '${e}'`);const r=this.removeInMemorySessionData(e);let n;return r&&(n=this.convertToSessionSync(r)),this._tokens.length===0?await this.secretStorage.delete(mu):this.storeTokenData(),n}async clearSessions(){he.log("Logging out of all sessions"),this._tokens=[],await this.secretStorage.delete(mu),this._refreshTimeouts.forEach(e=>{clearTimeout(e)}),this._refreshTimeouts.clear()}}const Qp=class{constructor(t){this.onDidChangeSessions=Ea.event,this.loginService=new S0(t),this.initializePromise=this.loginService.initialize(),this.disposable=_.authentication.registerAuthenticationProvider(Qp.id,"Azure Repos",this)}dispose(){this.disposable.dispose()}async getSessions(t){return await this.initializePromise,this.loginService.getSessions(t)}async createSession(t){await this.initializePromise;const e=await this.loginService.createSession(t.sort().join(" "));return Ea.fire({added:[e],removed:[],changed:[]}),e}async removeSession(t){await this.initializePromise;const e=await this.loginService.removeSession(t);e&&Ea.fire({added:[],removed:[e],changed:[]})}};let _s=Qp;_s.id="azurerepos";var Oc=__webpack_require__(7360),Kh=__webpack_require__(850);function Qh(t,e,r){if(!(e==null?void 0:e.length)&&!(r==null?void 0:r.length))return new Set(t);let n;if(e==null?void 0:e.length){const i=new Set([...e,...e.map(l=>`${l}/**`)]),a=Kh(t,[...i],{dot:!0,nocase:!0});n=new Set(a)}if(r==null?void 0:r.length){const i=new Set([...r,...r.map(a=>`${a}/**`)]);if(n===void 0){const a=Kh.not(t,[...i],{dot:!0,nocase:!0});n=new Set(a)}else Kh(t,[...i],{dot:!0,nocase:!0}).forEach(n.delete,n)}return n}var E0=Object.defineProperty,C0=Object.getOwnPropertyDescriptor,Xh=(t,e,r,n)=>{for(var i=n>1?void 0:n?C0(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&E0(e,r,i),i};const T0=(0,F.loadMessageBundle)(),x0=_.FileSystemError.FileNotFound().code,R0=/(\/|\\)/g;class Dd{constructor(e,r,n){this.providerService=e,this.azdo=r,this.changeStore=n,this._onDidChangeFile=new _.EventEmitter,this.contentCache=new Map,this.fileSearchCache=new Map,this.pendingUriRequests=new Map,this.pendingUriRequestsEventDelay=10,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.pathTypeMap={},this.disposable=_.Disposable.from(_.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0,isReadonly:!0}),_.workspace.registerFileSearchProvider(this.scheme,this),_.workspace.registerTextSearchProvider(this.scheme,this),_.workspace.onDidCloseTextDocument(i=>this.onTextDocumentClosed(i.uri)),e.onDidChangeRepository(i=>{i.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([i.repository.uri])}),e.onDidRefresh(i=>this.onRefreshOrRepositoryChanged(i)))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return this.azdo.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){if(e=e.filter(r=>Dt.getProviderId(r)===this.scheme).map(r=>this.providerService.getProviderUri(r)),e.length!==0){he.log(`AzDOFS.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.fileSearchCache.clear();for(const[r,n]of[...this.pendingUriRequests])e.some(i=>An(n.uri,i))&&(this.pendingUriRequests.delete(r),n.outdated=!0);for(const[r,{uri:n}]of[...this.contentCache])e.some(i=>An(n,i))&&this.contentCache.delete(r);this.updateOpenOrWatchedUris(e)}}onTextDocumentClosed(e){e.scheme===this.scheme&&this.contentCache.delete(Oe(e))}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,a]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(l=>An(a,l))&&(this.implicitlyWatchedUris.delete(i),r.set(i,a));he.debug(`AzDOFS.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(Oe(i),i);const n=[...r.values()].map(i=>({type:_.FileChangeType.Changed,uri:i}));setTimeout(()=>{he.debug(`AzDOFS.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=Oe(e);return this.watchedUris.set(n,e),{dispose:()=>{this.watchedUris.delete(n)}}}async stat(e){const r=Oe(e);this.implicitlyWatchedUris.set(r,e);const n={uri:e,outdated:!1};try{this.pendingUriRequests.set(`stat:${r}`,n);const i=await this.providerService.getMetadata(e),a=_.FilePermission.Readonly;if(!i.path)return{type:_.FileType.Directory,mtime:0,ctime:0,size:0,permissions:a};if(i.path in this.pathTypeMap||await this.updateWorkspaceItemMap(i,e.path,!0),i.path in this.pathTypeMap)return this.pathTypeMap[i.path]===_.FileType.Directory?{type:_.FileType.Directory,mtime:0,ctime:0,size:0,permissions:a}:{type:_.FileType.File,mtime:0,ctime:0,size:0,permissions:a};if(this.implicitlyWatchedUris.delete(r),e.query!=="~")throw _.FileSystemError.FileNotFound(e);return{type:_.FileType.File,size:0,ctime:0,mtime:Date.now(),permissions:_.FilePermission.Readonly}}finally{this.pendingUriRequests.delete(`stat:${r}`),(n==null?void 0:n.outdated)&&setTimeout(()=>{he.log(`AzDOFS.stat(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:_.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}async updateWorkspaceItemMap(e,r,n){const i=new Array,a=await this.azdo.getRepoItems(e,r);for(const l of a){const d=l.path.substring(1);if(d!==e.path||n){const m=l.isFolder===!0?_.FileType.Directory:_.FileType.File;this.pathTypeMap[d]=m,i.push([d,m])}}return i}async readDirectory(e){this.implicitlyWatchedUris.set(Oe(e),e);const r=this.providerService.getVirtualRootUri(e),n=await this.providerService.getMetadata(e);return(await this.updateWorkspaceItemMap(n,e.path,!1)).map(a=>[this.providerService.getRelativeFilePath(e,Sr(r,a[0])),a[1]])}createDirectory(e){throw _.FileSystemError.NoPermissions()}async readFile(e){var r;const n=Oe(e);this.implicitlyWatchedUris.set(n,e);let i=this.contentCache.get(n);if(i!==void 0)return i.content;const a={uri:e,outdated:!1};try{return this.pendingUriRequests.set(n,a),i={content:this.azdo.getFileContent(e),uri:e},this.contentCache.set(n,i),await i.content}catch(l){if(this.implicitlyWatchedUris.delete(n),i!==void 0&&i.content===((r=this.contentCache.get(n))==null?void 0:r.content)&&this.contentCache.delete(n),e.query==="~"&&l instanceof _.FileSystemError&&l.code===x0)return new Uint8Array(0);throw l}finally{this.pendingUriRequests.delete(n),(a==null?void 0:a.outdated)&&setTimeout(()=>{he.log(`AzDOFS.readFile(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:_.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}writeFile(e,r,n){throw _.FileSystemError.NoPermissions()}delete(e,r){throw _.FileSystemError.NoPermissions()}rename(e,r,n){throw _.FileSystemError.NoPermissions()}copy(e,r,n){throw _.FileSystemError.NoPermissions()}async provideFileSearchResults(e,{folder:r,maxResults:n,includes:i,excludes:a},l){const d=`${Oe(r)}|${JSON.stringify({includes:i,excludes:a})}`;let m=this.fileSearchCache.get(d);if(m===void 0){let E=await this.azdo.getRepoFileNames(r);if(E.length===0||l.isCancellationRequested)return[];((i==null?void 0:i.length)||(a==null?void 0:a.length))&&(E=[...Qh(E,i,a)]),m=E.map(P=>Oc.prepareSlow(P)),this.fileSearchCache.set(d,m)}let v;return e.pattern===""?v=m.map(E=>_.Uri.joinPath(r,E.target)):(v=Oc.go(e.pattern.replace(R0,"/"),m,{allowTypo:!0,limit:n}).map(E=>_.Uri.joinPath(r,E.target)),Oc.cleanup()),n!==void 0&&n!==0&&n<v.length&&(v=v.slice(0,n)),v}async provideTextSearchResults(e,r,n,i){const a=[];(e.isCaseSensitive||e.isRegExp||e.isWordMatch)&&a.push({text:T0("azdo flags not supported","Search flags are not supported."),type:_.TextSearchCompleteMessageType.Warning});const l=await this.azdo.searchCodeQuery(e.pattern,r.folder,{maxResults:r.maxResults,context:{before:r.beforeContext,after:r.afterContext}});if(l.warnings&&l.warnings.forEach(m=>{a.push({text:m,type:_.TextSearchCompleteMessageType.Warning})}),l===void 0)return{limitHit:!0,message:a};let d;for(const m of l.matches)d=_.Uri.joinPath(r.folder,m.path),n.report({uri:d,ranges:m.ranges,preview:{text:m.preview,matches:m.matches}});return{limitHit:!1,message:a}}}Xh([yn()],Dd.prototype,"stat",1),Xh([yn()],Dd.prototype,"readDirectory",1),Xh([yn()],Dd.prototype,"readFile",1);var Xp;(function(t){t[t.Force=0]="Force",t[t.ForceWithLease=1]="ForceWithLease"})(Xp||(Xp={}));var Bi;(function(t){t[t.Head=0]="Head",t[t.RemoteHead=1]="RemoteHead",t[t.Tag=2]="Tag"})(Bi||(Bi={}));var vu;(function(t){t[t.INDEX_MODIFIED=0]="INDEX_MODIFIED",t[t.INDEX_ADDED=1]="INDEX_ADDED",t[t.INDEX_DELETED=2]="INDEX_DELETED",t[t.INDEX_RENAMED=3]="INDEX_RENAMED",t[t.INDEX_COPIED=4]="INDEX_COPIED",t[t.MODIFIED=5]="MODIFIED",t[t.DELETED=6]="DELETED",t[t.UNTRACKED=7]="UNTRACKED",t[t.IGNORED=8]="IGNORED",t[t.INTENT_TO_ADD=9]="INTENT_TO_ADD",t[t.ADDED_BY_US=10]="ADDED_BY_US",t[t.ADDED_BY_THEM=11]="ADDED_BY_THEM",t[t.DELETED_BY_US=12]="DELETED_BY_US",t[t.DELETED_BY_THEM=13]="DELETED_BY_THEM",t[t.BOTH_ADDED=14]="BOTH_ADDED",t[t.BOTH_DELETED=15]="BOTH_DELETED",t[t.BOTH_MODIFIED=16]="BOTH_MODIFIED"})(vu||(vu={}));var Yp;(function(t){t.BadConfigFile="BadConfigFile",t.AuthenticationFailed="AuthenticationFailed",t.NoUserNameConfigured="NoUserNameConfigured",t.NoUserEmailConfigured="NoUserEmailConfigured",t.NoRemoteRepositorySpecified="NoRemoteRepositorySpecified",t.NotAGitRepository="NotAGitRepository",t.NotAtRepositoryRoot="NotAtRepositoryRoot",t.Conflict="Conflict",t.StashConflict="StashConflict",t.UnmergedChanges="UnmergedChanges",t.PushRejected="PushRejected",t.RemoteConnectionError="RemoteConnectionError",t.DirtyWorkTree="DirtyWorkTree",t.CantOpenResource="CantOpenResource",t.GitNotFound="GitNotFound",t.CantCreatePipe="CantCreatePipe",t.PermissionDenied="PermissionDenied",t.CantAccessRemote="CantAccessRemote",t.RepositoryNotFound="RepositoryNotFound",t.RepositoryIsLocked="RepositoryIsLocked",t.BranchNotFullyMerged="BranchNotFullyMerged",t.NoRemoteReference="NoRemoteReference",t.InvalidBranchName="InvalidBranchName",t.BranchAlreadyExists="BranchAlreadyExists",t.NoLocalChanges="NoLocalChanges",t.NoStashFound="NoStashFound",t.LocalChangesOverwritten="LocalChangesOverwritten",t.NoUpstreamBranch="NoUpstreamBranch",t.IsInSubmodule="IsInSubmodule",t.WrongCase="WrongCase",t.CantLockRef="CantLockRef",t.CantRebaseMultipleBranches="CantRebaseMultipleBranches",t.PatchDoesNotApply="PatchDoesNotApply",t.NoPathFound="NoPathFound",t.UnknownPath="UnknownPath"})(Yp||(Yp={}));function A0(t){return Buffer.from(t,"base64")}function kd(t){return Buffer.from(t).toString("base64")}var I0=Object.defineProperty,P0=Object.getOwnPropertyDescriptor,O0=(t,e,r,n)=>{for(var i=n>1?void 0:n?P0(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&I0(e,r,i),i};const GE=(0,F.loadMessageBundle)(),Zp=/^https:\/\/(?<organization>[^.]+)\.visualstudio\.com(?:\/defaultcollection)?\/(?<project>[^/]+)(?:\/_git)?\/(?<repo>[^/?#]+)(?:\/commit\/(?<commit>[0-9a-f]{40})|\/pullrequest\/(?<pull>\d+))?(?:\/)?(?:\?(?<query>[^#]+))?(?:#(?<fragment>.*))?$/i,Jp=/^https:\/\/dev\.azure\.com(?:\/defaultcollection)?\/(?<organization>[^/]+)\/(?<project>[^/]+)(?:\/_git)?\/(?<repo>[^/?#]+)(?:\/commit\/(?<commit>[0-9a-f]{40})|\/pullrequest\/(?<pull>\d+))?(?:\/)?(?:\?(?<query>[^#]+))?(?:#(?<fragment>.*))?$/i,eg=1,tg=Object.freeze({id:Dr.AzureRepos,name:"Azure Repos"});function Ca(t){const{scheme:e,metadata:r}=Dt.decodeAuthority(t),[,n,i,a,...l]=t.path.split("/");return{scheme:e,provider:tg,name:`${n}/${i}/${a}`,repo:{organization:n,project:i,name:a},path:l.join("/")||"",ref:r==null?void 0:r.ref,idx:r==null?void 0:r.idx}}function D0(t,e){const{repo:r}=e!=null?e:Ca(t);return t.with({path:`/${r.organization}/${r.project}/${r.name}`,query:"",fragment:""})}function Yh(t,e,r){const{repo:{organization:n,name:i}}=t instanceof _.Uri?Ca(t):t;return _.Uri.parse(`azurerepos://${Dt.encodeAuthority("azurerepos",{v:eg,ref:{type:Ye.Commit,id:e}})}/${n}/${i}/${r}`)}class rg{constructor(e){this.providerService=e}get isReadonly(){return!0}get scheme(){return"azurerepos"}dispose(){}async ensureAuthenticated(e=!1){const r=new ce("AzDO.ensureAuthenticated");try{if(this._session===void 0){async function n(){try{return await _.authentication.getSession(_s.id,Pd,{createIfNone:!0,forceNewSession:e})}catch{try{const a=await _.authentication.getSession(_s.id,Pd,{createIfNone:!1});if(a!==void 0)return a}catch{}return new Promise(a=>{async function l(){const m=await _.authentication.getSession(_s.id,Pd,{createIfNone:!0});m!==void 0&&a(m)}const d=_.authentication.onDidChangeSessions(async m=>{m.provider.id===_s.id&&(d.dispose(),await l())})})}}this._session=await n();const i=_.authentication.onDidChangeSessions(a=>{if(this._session===void 0){i.dispose();return}a.provider.id===_s.id&&(this.clearAuthenticationSession(),i.dispose())})}return this._session}finally{r.stop()}}async getAuthentication(e){const r=await this.ensureAuthenticated();return{provider:tg,session:r,getRichNavigationHeaders:()=>({"X-Git-AzureDevOps":`Basic ${this.getBase64AuthenticationSessionToken(r)}`})}}getBase64AuthenticationSessionToken(e){if(this._sessionTokenBase64===void 0){if(e===void 0)return this.ensureAuthenticated().then(r=>(this._sessionTokenBase64=kd(`PAT:${r.accessToken}`),this._sessionTokenBase64));this._sessionTokenBase64=kd(`PAT:${e.accessToken}`)}return this._sessionTokenBase64}clearAuthenticationSession(){this._session=void 0,this._sessionTokenBase64=void 0}async reauthenticate(){this.clearAuthenticationSession(),await this.ensureAuthenticated(!0)}async sendGetRequest(e,r,n,i){const l=`${n?`https://dev.azure.com/${e}/${n}/_apis/`:`https://dev.azure.com/${e}/_apis/`}${r}${i?`?${i}&`:"?"}api-version=5.1`;try{const d=await this.getBase64AuthenticationSessionToken();if(!d)throw new Ur("Unauthenticated",()=>this.reauthenticate());const m=await zn(l,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${d}`}});if(m.status===401)throw new Ur("Unauthenticated",()=>this.reauthenticate());if(m.status===404)return;const v=await m.json();return v!=null?v:void 0}catch(d){throw he.error(d),d instanceof Ur&&an.showStatus401Message(d.reauthenticate),d}}async sendPostRequest(e,r){try{const n=await this.getBase64AuthenticationSessionToken();if(!n)throw new Ur("Unauthenticated",()=>this.reauthenticate());const i=await zn(e,{method:"POST",body:r,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${n}`}});if(i.status===401)throw new Ur("Unauthenticated",()=>this.reauthenticate());const a=await i.json();return a!=null?a:void 0}catch(n){throw he.error(n),n instanceof Ur&&an.showStatus401Message(n.reauthenticate),n}}canOpenRemoteUrl(e){var r;const n=(r=Zp.exec(e))!=null?r:Jp.exec(e);if((n==null?void 0:n.groups)===void 0)return;const{commit:i}=n.groups;return i?rr.Commit:rr.Repository}async createWorkspaceForRemoteUrl(e,r=nr.CurrentWindow){var n;const i=(n=Zp.exec(e))!=null?n:Jp.exec(e);if((i==null?void 0:i.groups)===void 0)return;const{organization:a,project:l,repo:d,commit:m}=i.groups;let v;m&&(v={type:Ye.Commit,id:m});const E=this.providerService.createVirtualUri(Dr.AzureRepos,{repo:{organization:a,project:l,name:d},ref:v});return{name:(await this.providerService.getMetadata(E)).name,uri:E,location:r}}createVirtualUri(e,{repo:r,ref:n,idx:i},a){if((n==null?void 0:n.type)===Ye.Tree)throw new Error(`Invalid ref type '${n.type}'`);const l=n!==void 0||i!==void 0?{v:eg}:void 0;return l&&(n&&(l.ref={type:n.type,id:n.id}),i&&(l.idx=i)),e.with({authority:Dt.encodeAuthority("azurerepos",l),path:`/${r.organization}/${r.project}/${r.name}${(a==null?void 0:a.startsWith("/"))?a:`/${a!=null?a:""}`}`})}getRemoteUri(e){const r=`https://dev.azure.com/${e.repo.organization}/${e.repo.project}/_git/${e.repo.name}`;return e.sha?_.Uri.parse(`${r}/commit/${e.sha}`):e.clone?_.Uri.parse(`https://${e.repo.organization}@dev.azure.com/${e.repo.organization}/${e.repo.project}/_git/${e.repo.name}`):_.Uri.parse(r)}getProviderRootUri(e){return D0(e)}getRelativeFilePath(e,r){const{path:n}=Ca(e),{path:i}=Ca(Sr(e,r));return n.length!==0&&i!==n&&i.startsWith(n)?i.slice(n.length+1):i}getVirtualUriMetadata(e){const{provider:r,name:n,repo:i,ref:a}=Ca(e);return{provider:r,name:n,repo:i,ref:a}}async validateBranchOrTagCasing(e,r,n,i){const a=`git/repositories/${n}/refs`,l="includeLinks=true",d=await this.sendGetRequest(e,a,r,l);if((d==null?void 0:d.value)===void 0){he.warn("Could not get branches, might be incorrect auth token");return}const m=d.value;if(m.length===0)return i?{type:Ye.Branch,id:i}:void 0;const v=`refs/heads/${i.toLowerCase()}`,E=`refs/tags/${i.toLowerCase()}`;for(const P of m){const R=P.name;if(R.toLowerCase()==v)return{type:Ye.Branch,id:R.substr(11)};if(R.toLowerCase()==E)return{type:Ye.Tag,id:R.substr(10)}}}async getModeRefType(e,r){const{HEAD:n,pullRequest:i}=await(r!=null?r:this.getMetadata(e));switch(n.type){case ct.Branch:return i!==void 0?re.PullRequestBranch:re.Branch;case ct.RemoteBranch:return i!==void 0?re.PullRequestRemoteBranch:re.RemoteBranch;case ct.Tag:return re.Tag;case ct.Commit:return re.Commit}}async createMetadata(e,r){var n,i,a,l;const d=new ce(`AzDO.createMetadata(${e.toString()}, ${r})`);let m;try{let{provider:v,name:E,repo:{organization:P,project:R,name:I},ref:M}=Ca(e);if(!M||M.type===Ye.Commit&&/HEAD/i.test(M.id))M={type:Ye.Commit,id:"HEAD"};else if((M.type===Ye.Branch||M.type===Ye.Tag)&&(M=await this.validateBranchOrTagCasing(P,R,I,M.id),M===void 0))throw new Error(`Cannot get metadata for Uri(${e.toString(!0)}); Unable to find the specified branch or tag`);const N=await this.getRepositoryInfo(P,R,I,M);if(N===void 0)throw m=" \u2022 Aborted; Unable to get repository info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let B;if(r)B=r;else if(M.type===Ye.Commit)B=M.id;else if(B=(i=(n=N.ref)==null?void 0:n.sha)!=null?i:N.defaultBranch.sha,B===void 0)throw m=" \u2022 Aborted; Unable to get repository revision",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let j;((a=N.ref)==null?void 0:a.prefix)==="refs/heads/"?j={type:ct.Branch,name:N.ref.name,sha:B,branch:{name:N.ref.name,sha:N.ref.sha}}:((l=N.ref)==null?void 0:l.prefix)==="refs/tags/"?j={type:ct.Tag,name:N.ref.name,sha:B,detached:{type:ct.Tag,name:N.ref.name}}:j={type:ct.Commit,name:pr(B),sha:B,detached:{type:ct.Commit,name:pr(B)}};const K={version:fo.schemaVersion,timestamp:Date.now(),provider:v,name:E,repo:N.repo,user:N.user,accessLevel:N.accessLevel,HEAD:j,defaultBranch:N.defaultBranch,pullRequest:N.pullRequest};return m=` \u2022 HEAD=${j.sha}`,K}finally{d.stop(m?{suffix:m}:void 0)}}getMetadata(e){return this.providerService.getMetadata(e)}getRemoteWorkspaceSourceProviders(){return[]}async createBranch(e,r,n,i){throw new Error("Branch creation is currently not supported")}async createCommit(e,r,n,i){throw new Error("Commit creation is currently not supported")}async createAndPushCommit(e,r,n,i,a){throw new Error("Commit creation is currently not supported")}async createPullRequest(e,r,n,i,a){throw new Error("PR creation is currently not supported")}async fetch(e,r){const{fetched:n,metadata:i}=await this.fetchCore(e,!1,r);n&&await this.providerService.updateMetadata(e,i)}async fetchCore(e,r,n){var i,a,l,d;const{force:m,to:v}={...n,force:r||(n==null?void 0:n.force)},E=new ce(`AzDO.fetch(${e.toString()}, force=${m}, to=${v})`);let P;try{const R=await this.getMetadata(e);if(R.HEAD.detached)return P=" \u2022 Skipped; detached HEAD",{fetched:!1,metadata:R};if(R.HEAD.type===ct.RemoteBranch)return P=" \u2022 Skipped; remote branch",{fetched:!1,metadata:R};const I=await this.getBranchTips(e);if(!I)throw P=" \u2022 Unable to fetch branch tips",new rn(r);if(!m&&!v&&((i=I.defaultBranch)==null?void 0:i.sha)!==void 0&&I.defaultBranch.sha===R.defaultBranch.sha&&((a=I.branch)==null?void 0:a.sha)!==void 0&&I.branch.sha===R.HEAD.branch.sha)return P=" \u2022 No changes detected",{fetched:!1,metadata:R};let M;if(((l=I.defaultBranch)==null?void 0:l.sha)!==void 0&&I.defaultBranch.sha!==R.defaultBranch.sha&&(M={defaultBranch:{...R.defaultBranch,sha:I.defaultBranch.sha}}),((d=I.branch)==null?void 0:d.sha)===void 0){if(P=" \u2022 Unable to find branch tip",m)throw new rn(r);return M!==void 0?{fetched:!0,metadata:{...R,...M}}:{fetched:!1,metadata:R}}return I.branch.sha!==R.HEAD.branch.sha&&(M={...M,HEAD:{...R.HEAD,branch:{...R.HEAD.branch,sha:I.branch.sha},detached:void 0}}),I.branch.sha===R.HEAD.sha?(P=" \u2022 Up to date",R.state!==void 0||M!==void 0?{fetched:!0,metadata:{...R,...M,state:void 0}}:{fetched:!1,metadata:R}):M!==void 0?{fetched:!0,metadata:{...R,...M}}:{fetched:!1,metadata:R}}finally{E.stop(P?{suffix:P}:void 0)}}async fork(e){throw new Error("Forks are currently not supported")}async getBranches(e,r){var n;try{const{repo:{organization:i,project:a,name:l}}=Ca(e),d=`git/repositories/${l}/refs`,m="includeLinks=true",v=await this.sendGetRequest(i,d,a,m),E=(n=v==null?void 0:v.value)!=null?n:[];if(E.length===0)return{branches:[]};const P=[];for(const R of E)!R.name.startsWith("refs/heads/")||P.push({type:Bi.Head,name:R.name.substr(11),commit:R.objectId,commitUrl:R.url});return{branches:P}}catch(i){return{branches:[]}}}async getCommit(e,r){try{const{repo:{organization:n,project:i,name:a}}=await this.getMetadata(e),l=`git/repositories/${a}/commits/${r}`,d=await this.sendGetRequest(n,l,i);return d===void 0?void 0:{hash:d.commitId,message:d.comment,parents:d.parents,authorDate:new Date(d.author.date),authorEmail:d.author.email,authorName:d.author.name,commitDate:new Date(d.committer.date)}}catch(n){return}}async getCommits(e,r){try{const{repo:{organization:n,project:i,name:a}}=await this.getMetadata(e),l=`git/repositories/${a}/commits`;let d=`searchCriteria.itemVersion.version=${r==null?void 0:r.ref}&searchCriteria.itemVersion.versionType=commit`;(r==null?void 0:r.path)&&(d+=`&searchCriteria.itemPath=${r.path}`);const m=await this.sendGetRequest(n,l,i,d);if((m==null?void 0:m.value)===void 0)return;const v=m.value,E=[];for(const P of v)E.push({hash:P.commitId,message:P.comment,parents:[],authorDate:new Date(P.author.date),authorEmail:P.author.email,authorName:P.author.name,commitDate:new Date(P.committer.date)});return{commits:E}}catch(n){return}}async getFileContent(e,r,n){try{const{HEAD:i,repo:{organization:a,project:l,id:d},path:m}=await this.providerService.getMetadata(e);n=n!=null?n:m;const v=`git/repositories/${d}/items`;let E="";n&&(E+=`path=${n}&includeContent=true`),r?E+=`&versionDescriptor.version=${r}&versionDescriptor.versionType=commit`:i.type===ct.Branch?E+=`&versionDescriptor.version=${i.branch.name}&versionDescriptor.versionType=branch`:i.type===ct.Tag&&(E+=`&versionDescriptor.version=${i.name}&versionDescriptor.versionType=tag`);const P=await this.sendGetRequest(a,v,l,E);if(P==null?void 0:P.content)return new TextEncoder().encode(P.content);throw _.FileSystemError.FileNotFound(e)}catch(i){throw he.logLevel===dt.Debug&&he.error(i),i}}async getFork(e){throw new Error("Forks are currently not supported")}async getIncomingChanges(e){var r,n;return(n=(r=(await this.getMetadata(e)).state)==null?void 0:r.incomingChanges)!=null?n:[]}async compareCommits(e,r){throw new Error("Comparing commits is currently not supported")}async getObjectDetails(e,r,n){throw new Error("Not able to get object detail")}async getPullRequest(e,r){throw new Error("PRs are currently not supported")}async getRepoItems(e,r){const n=`git/repositories/${e.repo.name}/items`,[,,,,...i]=r.split("/");let a=`scopePath=${i.join("/")}&recursionLevel=1&includeContentMetadata=true`;e.HEAD.type===ct.Commit?a+=`&versionDescriptor.version=${e.HEAD.sha}&versionDescriptor.versionType=commit`:e.HEAD.type===ct.Branch?a+=`&versionDescriptor.version=${e.HEAD.branch.name}&versionDescriptor.versionType=branch`:e.HEAD.type===ct.Tag&&(a+=`&versionDescriptor.version=${e.HEAD.name}&versionDescriptor.versionType=tag`);const l=await this.sendGetRequest(e.repo.organization,n,e.repo.project,a);return l&&Array.isArray(l==null?void 0:l.value)?l==null?void 0:l.value:(he.debug(`AzDOProvider.getRepoItems returned ${l===void 0?"empty":"invalid"} result ${l==null?void 0:l.value} for path ${r}`),[])}async getRepoFileNames(e){return[]}async getTags(e,r){var n;try{const{repo:{organization:i,project:a,name:l}}=Ca(e),d=`git/repositories/${l}/refs`,m="includeLinks=true",v=await this.sendGetRequest(i,d,a,m),E=(n=v==null?void 0:v.value)!=null?n:[];if(E.length===0)return{tags:[]};const P=[];for(const R of E)!R.name.startsWith("refs/tags/")||P.push({type:Bi.Tag,name:R.name.substr(10),commit:R.objectId,commitUrl:R.url});return{tags:P}}catch(i){return{tags:[]}}}async getTarGz(e,r){throw new Error("Getting zip is currently not supported")}async pushCommit(e,r,n,i){throw new Error("Commit pushing is not currently supported")}async getItems(e){const r=await this.sendGetRequest(e,"projects");if(!r){he.warn("do something here");return}return r}async getProjects(e){const r=await this.getItems(e),n=[];return r==null||r.value.map(i=>n.push({label:i.name,description:i.description})),_.window.showQuickPick(n,{placeholder:"Select a Azure DevOps project",title:"Select a Azure DevOps project",ignoreFocusOut:!0})}async searchRepositoriesQuery(e,r){try{const n=await _.window.showInputBox({placeHolder:"Enter an Azure DevOps Organization",ignoreFocusOut:!0});if(!n)return[];const i=await this.getProjects(n),a=await this.sendGetRequest(n,"git/repositories",i.label);return a==null?void 0:a.value.map(l=>({name:l.name,description:void 0,url:l.webUrl,fork:void 0,stars:0}))}catch(n){throw he.error(n),n}}async searchCodeQuery(e,r,n){var i;const{repo:{organization:a,project:l,name:d},HEAD:m,defaultBranch:v}=await this.getMetadata(r),E=`https://almsearch.dev.azure.com/${a}/${l}/_apis/search/codesearchresults?api-version=6.1-preview.1`,P=m.branch?m.branch.name:v.name,R={searchText:e,$skip:0,$top:1e3,filters:{Project:[l],Repository:[d],Path:["/"],Branch:[P]},$orderBy:[{field:"filename",sortOrder:"ASC"}],includeSnippet:!0},I=await this.sendPostRequest(E,JSON.stringify(R)),M=new _.Range(0,0,0,0),N=[];let B;for(const j of(i=I==null?void 0:I.results)!=null?i:[])for(const K of j.matches.content){B={path:j.path,ranges:[],preview:"",matches:[]};const ee=Math.max(0,K.line-1),te=K.charOffset,fe=te+K.length;B.preview=K.codeSnippet?K.codeSnippet:`CharOffset: ${K.charOffset}, Type: ${K.type}`,B.ranges.push(new _.Range(ee,te,ee,fe)),B.matches.push(M),N.push(B)}return{matches:N,limitHit:!1}}async switchTo(e,r,n){const{name:i,repo:a,HEAD:{branch:l}}=await this.getMetadata(e);let d;if(!(r!==void 0&&(typeof r=="string"?r.startsWith("refs/heads/")?d={type:Ye.Branch,id:r.substr(11)}:r.startsWith("refs/tags/")?d={type:Ye.Tag,id:r.substr(10)}:d={type:Ye.Branch,id:r}:d={...r,type:r.type===Ye.Tree?Ye.Branch:r.type},(l==null?void 0:l.name)===d.id)))return{name:i,uri:this.providerService.createVirtualUri(e,{repo:a,ref:d}),location:(n==null?void 0:n.openInNewWindow)?nr.NewWindow:nr.CurrentWindow}}async sync(e,r,n){var i,a,l,d,m,v;const E=new ce(`AzDO.sync(${e.toString()}, resolution=${n.conflictResolution}, to=${n.to})`);let P;try{const{metadata:R}=await this.fetchCore(e,!0,{to:n.to});if(R.HEAD.detached){P=" \u2022 Skipped; detached HEAD";return}if(((a=(i=R==null?void 0:R.state)==null?void 0:i.behind)!=null?a:0)>0&&await r.hasChanges(e)){E.logStep("Fetching upstream changes");const I=[],M=(d=(l=R.state)==null?void 0:l.incomingChanges)!=null?d:[];if(M.length>0){const N=await r.getChanges(e);for(const B of N){const j=this.providerService.getRelativeFilePath(e,B.uri),K=M.find(ee=>ee.uri.path===B.uri.path);if(K!==void 0){I.push({path:j,current:B,incomingType:K.type});break}}}if(I.length>0)switch(n.conflictResolution){case sr.KeepCurrent:E.logStep("Syncing (keep) upstream changes",{message:`: ${I.length} conflicts; \u2022`,suffix:" \u2022 Syncing (keep) upstream changes..."});for(const N of I)await r.keep(N.current.uri,{type:N.incomingType,providerUri:Yh(R,R.HEAD.branch.sha,N.path)});break;case sr.DiscardCurrent:E.logStep("Syncing (discard) upstream changes",{message:`: ${I.length} conflicts; \u2022`,suffix:" \u2022 Syncing (discard) upstream changes..."});for(const N of I)await r.discard(N.current.uri);break;case sr.Merge:E.logStep("Syncing (merge) upstream changes",{message:`: ${I.length} conflicts; \u2022`,suffix:" \u2022 Syncing (merge) upstream changes..."});for(const N of I)await r.merge(N.current.uri,{type:N.incomingType,providerUri:Yh(R,R.HEAD.branch.sha,N.path)},{providerUri:Yh(R,R.HEAD.sha,N.path)});break;case sr.Abort:default:throw E.logStep("Syncing (abort) upstream changes",{message:`: ${I.length} conflicts; \u2022`,suffix:" \u2022 Syncing (abort) upstream changes..."}),await this.providerService.updateMetadata(e,R),new In}}P=` \u2022 to=${(m=n.to)!=null?m:R.HEAD.branch.sha}`,await this.fastForwardTo(e,(v=n.to)!=null?v:R.HEAD.branch.sha,R)}finally{E.stop(P?{suffix:P}:void 0)}}async fastForwardTo(e,r,n){if(n.HEAD.detached)throw new li("Unable to fast-forward; no current branch");n.HEAD.sha===r&&n.state===void 0||(he.log(`Fast forward to ${r}; rootUri=${e.toString()}`),await this.providerService.updateMetadata(e,{...n,HEAD:{...n.HEAD,detached:void 0,sha:r},state:void 0,timestamp:Date.now()}),r!==n.HEAD.branch.sha&&await this.fetchCore(e,!1,{to:r}))}async getBranchTips(e,r){try{const{repo:{organization:n,project:i,name:a},HEAD:{branch:l}}=await this.getMetadata(e);r===void 0?r=l?`heads/${l.name}`:"":r.startsWith("refs/")&&(r=r.slice(5));const d=`git/repositories/${a}/refs`,m=`includeLinks=true&filter=${r}`,v=await this.sendGetRequest(n,d,i,m),E=v==null?void 0:v.value;if(E===[])return;const P={target:{oid:E[0].objectId}},R=`git/repositories/${a}`,I=await this.sendGetRequest(n,R,i);let M=I==null?void 0:I.defaultBranch;M.startsWith("refs/")&&(M=M.slice(5));const N=`git/repositories/${a}/refs`,B=`includeLinks=true&filter=${M}`,j=await this.sendGetRequest(n,N,i,B),K=j==null?void 0:j.value;if(K===[])return;const ee={target:{oid:K[0].objectId}};if(!ee&&!P)return;const te=ee?{sha:ee.target.oid}:void 0,fe=P?{sha:P.target.oid}:void 0;return{defaultBranch:te,branch:fe}}catch(n){return}}async getRepositoryId(e,r,n){const i=`git/repositories/${n}`,a=await this.sendGetRequest(e,i,r);if(a){if(a.id)return a.id;throw new Error("Sign in page was returned for repoId. Check the token sent")}throw new Error("Can't get Repo Id")}async getRepositoryInfo(e,r,n,i){const a=await this.getRepositoryId(e,r,n),l=`git/repositories/${a}`,d=await this.sendGetRequest(e,l,r);if(!d)return;d.defaultBranch.startsWith("refs/heads/")&&(d.defaultBranch=d.defaultBranch.substr(11));const m=`git/repositories/${n}/stats/branches`,v=`name=${d.defaultBranch}`,E=await this.sendGetRequest(e,m,r,v);if(!E)return;let P=null;Rr(i.id)&&(P=i.id);const R={user:"jepetty",repo:{organization:e,project:r,name:n,id:a},accessLevel:Gt.Read,defaultBranch:{name:E.name,sha:P||E.commit.commitId}};if(i.type===Ye.Branch){const I=`git/repositories/${n}/stats/branches`,M=`name=${i.id}`,N=await this.sendGetRequest(e,I,r,M);if(N)return{...R,ref:{name:N.name,sha:N.commit.commitId,prefix:"refs/heads/"}}}else if(i.type===Ye.Tag){const I=`git/repositories/${a}/items`,M=`versionDescriptor.version=${i.id}&versionDescriptor.versionType=tag`,N=await this.sendGetRequest(e,I,r,M);if(N&&N.value.length===1)return{...R,ref:{name:i.id,sha:N.value[0].commitId,prefix:"refs/tags/"}}}else{if(i.type===Ye.Commit)return i.id==="HEAD"&&(i.id=d.defaultBranch),{...R,ref:{name:i.id,sha:E.commit.commitId,prefix:"refs/heads/"}};throw new Error("Not supported yet :(")}}}O0([qr()],rg.prototype,"ensureAuthenticated",1);class k0{constructor(e,r){this.providerService=e,this.changeStore=r,this.providers=[],this.handledRepositories=new Set,this.services=new Map,this.disposable=_.Disposable.from(e.onDidChangeRepositories(n=>{for(const i of n.added)this.repositoryOpened(i);for(const i of n.removed)this.repositoryClosed(i)}));for(const n of this.providerService.repositories)this.repositoryOpened(n)}dispose(){this.disposable.dispose()}register(e){const r=this.providers.length;return this.providers.push(e),{dispose:()=>this.providers.splice(r,1)}}async repositoryOpened(e){const r=Oe(e.uri);if(!this.handledRepositories.has(r)){this.handledRepositories.add(r);for(const n of this.providers){const i=await n.createNavigationService(this.providerService,e,this.changeStore);if(i!==void 0){const a=i();this.services.set(r,{service:a});break}}}}repositoryClosed(e){const r=Oe(e.uri);this.handledRepositories.delete(r);const n=this.services.get(r);n!==void 0&&(n.service.dispose(),this.services.delete(Oe(e.uri)))}}/*! (c) Andrea Giammarchi - ISC */var Nd={};try{(function(t,e){if(new t("q=%2B").get("q")!==e||new t({q:e}).get("q")!==e||new t([["q",e]]).get("q")!==e||new t(`q=
`).toString()!=="q=%0A"||new t({q:" &"}).toString()!=="q=+%26"||new t({q:"%zx"}).toString()!=="q=%25zx")throw t;Nd.URLSearchParams=t})(URLSearchParams,"+")}catch(t){(function(e,r,n){"use strict";var i=e.create,a=e.defineProperty,l=/[!'\(\)~]|%20|%00/g,d=/%(?![0-9a-fA-F]{2})/g,m=/\+/g,v={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},E={append:function(K,ee){M(this._ungap,K,ee)},delete:function(K){delete this._ungap[K]},get:function(K){return this.has(K)?this._ungap[K][0]:null},getAll:function(K){return this.has(K)?this._ungap[K].slice(0):[]},has:function(K){return K in this._ungap},set:function(K,ee){this._ungap[K]=[r(ee)]},forEach:function(K,ee){var te=this;for(var fe in te._ungap)te._ungap[fe].forEach($e,fe);function $e(Ae){K.call(ee,Ae,r(fe),te)}},toJSON:function(){return{}},toString:function(){var K=[];for(var ee in this._ungap)for(var te=B(ee),fe=0,$e=this._ungap[ee];fe<$e.length;fe++)K.push(te+"="+B($e[fe]));return K.join("&")}};for(var P in E)a(R.prototype,P,{configurable:!0,writable:!0,value:E[P]});Nd.URLSearchParams=R;function R(K){var ee=i(null);switch(a(this,"_ungap",{value:ee}),!0){case!K:break;case typeof K=="string":K.charAt(0)==="?"&&(K=K.slice(1));for(var te=K.split("&"),fe=0,$e=te.length;fe<$e;fe++){var Ae=te[fe],Te=Ae.indexOf("=");-1<Te?M(ee,N(Ae.slice(0,Te)),N(Ae.slice(Te+1))):Ae.length&&M(ee,N(Ae),"")}break;case n(K):for(var fe=0,$e=K.length;fe<$e;fe++){var Ae=K[fe];M(ee,Ae[0],Ae[1])}break;case"forEach"in K:K.forEach(I,ee);break;default:for(var qe in K)M(ee,qe,K[qe])}}function I(K,ee){M(this,ee,K)}function M(K,ee,te){var fe=n(te)?te.join(","):te;ee in K?K[ee].push(fe):K[ee]=[fe]}function N(K){return decodeURIComponent(K.replace(d,"%25").replace(m," "))}function B(K){return encodeURIComponent(K).replace(l,j)}function j(K){return v[K]}})(Object,String,Array.isArray)}(function(t){var e=!1;try{e=!!Symbol.iterator}catch(n){}"forEach"in t||(t.forEach=function(i,a){var l=this,d=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach(function(m){!m.length||m in d||(d[m]=l.getAll(m)).forEach(function(v){i.call(a,v,m,l)})})}),"keys"in t||(t.keys=function(){return r(this,function(i,a){this.push(a)})}),"values"in t||(t.values=function(){return r(this,function(i,a){this.push(i)})}),"entries"in t||(t.entries=function(){return r(this,function(i,a){this.push([a,i])})}),e&&!(Symbol.iterator in t)&&(t[Symbol.iterator]=t.entries),"sort"in t||(t.sort=function(){for(var i=this.entries(),a=i.next(),l=a.done,d=[],m=Object.create(null),v,E,P;!l;)P=a.value,E=P[0],d.push(E),E in m||(m[E]=[]),m[E].push(P[1]),a=i.next(),l=a.done;for(d.sort(),v=0;v<d.length;v++)this.delete(d[v]);for(v=0;v<d.length;v++)E=d[v],this.append(E,m[E].shift())});function r(n,i){var a=[];return n.forEach(i,a),e?a[Symbol.iterator]():{next:function(){var l=a.shift();return{done:l===void 0,value:l}}}}(function(n){var i=n.defineProperty,a=n.getOwnPropertyDescriptor,l=function(P){function R(N,B){t.append.call(this,N,B),N=this.toString(),P.set.call(this._usp,N?"?"+N:"")}function I(N){t.delete.call(this,N),N=this.toString(),P.set.call(this._usp,N?"?"+N:"")}function M(N,B){t.set.call(this,N,B),N=this.toString(),P.set.call(this._usp,N?"?"+N:"")}return function(N,B){return N.append=R,N.delete=I,N.set=M,i(N,"_usp",{configurable:!0,writable:!0,value:B})}},d=function(P){return function(R,I){return i(R,"_searchParams",{configurable:!0,writable:!0,value:P(I,R)}),I}},m=function(P){var R=P.append;P.append=t.append,URLSearchParams.call(P,P._usp.search.slice(1)),P.append=R},v=function(P,R){if(!(P instanceof R))throw new TypeError("'searchParams' accessed on an object that does not implement interface "+R.name)},E=function(P){var R=P.prototype,I=a(R,"searchParams"),M=a(R,"href"),N=a(R,"search"),B;!I&&N&&N.set&&(B=d(l(N)),n.defineProperties(R,{href:{get:function(){return M.get.call(this)},set:function(j){var K=this._searchParams;M.set.call(this,j),K&&m(K)}},search:{get:function(){return N.get.call(this)},set:function(j){var K=this._searchParams;N.set.call(this,j),K&&m(K)}},searchParams:{get:function(){return v(this,P),this._searchParams||B(this,new URLSearchParams(this.search.slice(1)))},set:function(j){v(this,P),B(this,j)}}}))};try{E(HTMLAnchorElement),/^function|object$/.test(typeof URL)&&URL.prototype&&E(URL)}catch(P){}})(Object)})(Nd.URLSearchParams.prototype,Object);const ng=Nd.URLSearchParams;var N0=__webpack_require__(6822);const Et=(0,F.loadMessageBundle)(),Zh=60,Jh=Zh*60,yu=Jh*24,ig=yu*7,og=yu*30,ag=yu*365;function _u(t,e){typeof t!="number"&&(t=t.getTime());const r=Math.round((new Date().getTime()-t)/1e3);if(r<-30)return Et("date.fromNow.in","in {0}",_u(new Date().getTime()+r*1e3,{ago:!1,short:e==null?void 0:e.short}));if(r<30)return(e==null?void 0:e.ago)?(e==null?void 0:e.short)?Et("date.fromNow.seconds.short.ago","secs ago"):Et("date.fromNow.seconds.ago","A few seconds ago"):(e==null?void 0:e.short)?Et("date.fromNow.now.short","now"):Et("date.fromNow.now","Just now");let n;return r<Zh?(n=r,(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Et("date.fromNow.seconds.singular.short.ago","{0} sec ago",n):Et("date.fromNow.seconds.singular.ago","{0} second ago",n):(e==null?void 0:e.short)?Et("date.fromNow.seconds.plural.short.ago","{0} secs ago",n):Et("date.fromNow.seconds.plural.ago","{0} seconds ago",n):n===1?(e==null?void 0:e.short)?Et("date.fromNow.seconds.singular.short","{0} sec",n):Et("date.fromNow.seconds.singular","{0} second",n):(e==null?void 0:e.short)?Et("date.fromNow.seconds.plural.short","{0} secs",n):Et("date.fromNow.seconds.plural","{0} seconds",n)):r<Jh?(n=Math.floor(r/Zh),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Et("date.fromNow.minutes.singular.short.ago","{0} min ago",n):Et("date.fromNow.minutes.singular.ago","{0} minute ago",n):(e==null?void 0:e.short)?Et("date.fromNow.minutes.plural.short.ago","{0} mins ago",n):Et("date.fromNow.minutes.plural.ago","{0} minutes ago",n):n===1?(e==null?void 0:e.short)?Et("date.fromNow.minutes.singular.short","{0} min",n):Et("date.fromNow.minutes.singular","{0} minute",n):(e==null?void 0:e.short)?Et("date.fromNow.minutes.plural.short","{0} mins",n):Et("date.fromNow.minutes.plural","{0} minutes",n)):r<yu?(n=Math.floor(r/Jh),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Et("date.fromNow.hours.singular.short.ago","{0} hr ago",n):Et("date.fromNow.hours.singular.ago","{0} hour ago",n):(e==null?void 0:e.short)?Et("date.fromNow.hours.plural.short.ago","{0} hrs ago",n):Et("date.fromNow.hours.plural.ago","{0} hours ago",n):n===1?(e==null?void 0:e.short)?Et("date.fromNow.hours.singular.short","{0} hr",n):Et("date.fromNow.hours.singular","{0} hour",n):(e==null?void 0:e.short)?Et("date.fromNow.hours.plural.short","{0} hrs",n):Et("date.fromNow.hours.plural","{0} hours",n)):r<ig?(n=Math.floor(r/yu),(e==null?void 0:e.ago)?n===1?Et("date.fromNow.days.singular.ago","{0} day ago",n):Et("date.fromNow.days.plural.ago","{0} days ago",n):n===1?Et("date.fromNow.days.singular","{0} day",n):Et("date.fromNow.days.plural","{0} days",n)):r<og?(n=Math.floor(r/ig),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Et("date.fromNow.weeks.singular.short.ago","{0} wk ago",n):Et("date.fromNow.weeks.singular.ago","{0} week ago",n):(e==null?void 0:e.short)?Et("date.fromNow.weeks.plural.short.ago","{0} wks ago",n):Et("date.fromNow.weeks.plural.ago","{0} weeks ago",n):n===1?(e==null?void 0:e.short)?Et("date.fromNow.weeks.singular.short","{0} wk",n):Et("date.fromNow.weeks.singular","{0} week",n):(e==null?void 0:e.short)?Et("date.fromNow.weeks.plural.short","{0} wks",n):Et("date.fromNow.weeks.plural","{0} weeks",n)):r<ag?(n=Math.floor(r/og),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Et("date.fromNow.months.singular.short.ago","{0} mo ago",n):Et("date.fromNow.months.singular.ago","{0} month ago",n):(e==null?void 0:e.short)?Et("date.fromNow.months.plural.short.ago","{0} mos ago",n):Et("date.fromNow.months.plural.ago","{0} months ago",n):n===1?(e==null?void 0:e.short)?Et("date.fromNow.months.singular.short","{0} mo",n):Et("date.fromNow.months.singular","{0} month",n):(e==null?void 0:e.short)?Et("date.fromNow.months.plural.short","{0} mos",n):Et("date.fromNow.months.plural","{0} months",n)):(n=Math.floor(r/ag),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Et("date.fromNow.years.singular.short.ago","{0} yr ago",n):Et("date.fromNow.years.singular.ago","{0} year ago",n):(e==null?void 0:e.short)?Et("date.fromNow.years.plural.short.ago","{0} yrs ago",n):Et("date.fromNow.years.plural.ago","{0} years ago",n):n===1?(e==null?void 0:e.short)?Et("date.fromNow.years.singular.short","{0} yr",n):Et("date.fromNow.years.singular","{0} year",n):(e==null?void 0:e.short)?Et("date.fromNow.years.plural.short","{0} yrs",n):Et("date.fromNow.years.plural","{0} years",n))}var sg,sn;(function(t){t.None=0,t.First=1,t.AsOld=t.First,t.Last=2,t.AsNew=t.Last})(sn||(sn={}));class M0{constructor(){this[sg]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return(e=this._head)==null?void 0:e.value}get last(){var e;return(e=this._tail)==null?void 0:e.value}has(e){return this._map.has(e)}get(e,r=sn.None){const n=this._map.get(e);if(!!n)return r!==sn.None&&this.touch(n,r),n.value}set(e,r,n=sn.None){let i=this._map.get(e);if(i)i.value=r,n!==sn.None&&this.touch(i,n);else{switch(i={key:e,value:r,next:void 0,previous:void 0},n){case sn.None:this.addItemLast(i);break;case sn.First:this.addItemFirst(i);break;case sn.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return Boolean(this.remove(e))}remove(e){const r=this._map.get(e);if(!!r)return this._map.delete(e),this.removeItem(r),this._size--,r.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,r){const n=this._state;let i=this._head;for(;i;){if(r?e.bind(r)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:r.key,done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}values(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:r.value,done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}entries(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:[r.key,r.value],done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}[(sg=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let r=this._head,n=this.size;for(;r&&n>e;)this._map.delete(r.key),r=r.next,n--;this._head=r,this._size=n,r&&(r.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const r=e.next,n=e.previous;if(!r||!n)throw new Error("Invalid list");r.previous=n,n.next=r}e.next=void 0,e.previous=void 0,this._state++}touch(e,r){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(r!==sn.First&&r!==sn.Last)){if(r===sn.First){if(e===this._head)return;const n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(r===sn.Last){if(e===this._tail)return;const n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){const e=[];return this.forEach((r,n)=>{e.push([n,r])}),e}fromJSON(e){this.clear();for(const[r,n]of e)this.set(r,n)}}class Ta extends M0{constructor(e,r=1){super();this._limit=e,this._ratio=Math.min(Math.max(0,r),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,r=sn.AsNew){return super.get(e,r)}peek(e){return super.get(e,sn.None)}set(e,r){return super.set(e,r,sn.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}function L0(t,e,r){return new bs(new ug(t),new ug(e)).ComputeDiff(r).changes}class xa{constructor(e,r,n,i){this.originalStart=e,this.originalLength=r,this.modifiedStart=n,this.modifiedLength=i}getOriginalEnd(){return this.originalStart+this.originalLength}getModifiedEnd(){return this.modifiedStart+this.modifiedLength}}var cg;(function(t){t[t.MAX_SAFE_SMALL_INTEGER=1073741824]="MAX_SAFE_SMALL_INTEGER",t[t.MIN_SAFE_SMALL_INTEGER=-1073741824]="MIN_SAFE_SMALL_INTEGER",t[t.MAX_UINT_8=255]="MAX_UINT_8",t[t.MAX_UINT_16=65535]="MAX_UINT_16",t[t.MAX_UINT_32=4294967295]="MAX_UINT_32",t[t.UNICODE_SUPPLEMENTARY_PLANE_BEGIN=65536]="UNICODE_SUPPLEMENTARY_PLANE_BEGIN"})(cg||(cg={}));function lg(t,e){return(e<<5)-e+t|0}function F0(t,e){e=lg(149417,e);for(let r=0,n=t.length;r<n;r++)e=lg(t.charCodeAt(r),e);return e}class ug{constructor(e){this.source=e}getElements(){const e=this.source,r=new Int32Array(e.length);for(let n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return r}}class Dc{static Assert(e,r){if(!e)throw new Error(r)}}class kc{static Copy(e,r,n,i,a){for(let l=0;l<a;l++)n[i+l]=e[r+l]}static Copy2(e,r,n,i,a){for(let l=0;l<a;l++)n[i+l]=e[r+l]}}var dg;(function(t){t[t.MaxDifferencesHistory=1447]="MaxDifferencesHistory"})(dg||(dg={}));class hg{constructor(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}MarkNextChange(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new xa(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824}AddOriginalElement(e,r){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,r),this.m_originalCount++}AddModifiedElement(e,r){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,r),this.m_modifiedCount++}getChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes}getReverseChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes}}class bs{constructor(e,r,n=null){this.ContinueProcessingPredicate=n,this._originalSequence=e,this._modifiedSequence=r;const[i,a,l]=bs._getElements(e),[d,m,v]=bs._getElements(r);this._hasStrings=l&&v,this._originalStringElements=i,this._originalElementsOrHash=a,this._modifiedStringElements=d,this._modifiedElementsOrHash=m,this.m_forwardHistory=[],this.m_reverseHistory=[]}static _isStringArray(e){return e.length>0&&typeof e[0]=="string"}static _getElements(e){const r=e.getElements();if(bs._isStringArray(r)){const n=new Int32Array(r.length);for(let i=0,a=r.length;i<a;i++)n[i]=F0(r[i],0);return[r,n,!0]}return r instanceof Int32Array?[[],r,!1]:[[],new Int32Array(r),!1]}ElementsAreEqual(e,r){return this._originalElementsOrHash[e]!==this._modifiedElementsOrHash[r]?!1:this._hasStrings?this._originalStringElements[e]===this._modifiedStringElements[r]:!0}ElementsAreStrictEqual(e,r){if(!this.ElementsAreEqual(e,r))return!1;const n=bs._getStrictElement(this._originalSequence,e),i=bs._getStrictElement(this._modifiedSequence,r);return n===i}static _getStrictElement(e,r){return typeof e.getStrictElement=="function"?e.getStrictElement(r):null}OriginalElementsAreEqual(e,r){return this._originalElementsOrHash[e]!==this._originalElementsOrHash[r]?!1:this._hasStrings?this._originalStringElements[e]===this._originalStringElements[r]:!0}ModifiedElementsAreEqual(e,r){return this._modifiedElementsOrHash[e]!==this._modifiedElementsOrHash[r]?!1:this._hasStrings?this._modifiedStringElements[e]===this._modifiedStringElements[r]:!0}ComputeDiff(e){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1,e)}_ComputeDiff(e,r,n,i,a){const l=[!1];let d=this.ComputeDiffRecursive(e,r,n,i,l);return a&&(d=this.PrettifyChanges(d)),{quitEarly:l[0],changes:d}}ComputeDiffRecursive(e,r,n,i,a){for(a[0]=!1;e<=r&&n<=i&&this.ElementsAreEqual(e,n);)e++,n++;for(;r>=e&&i>=n&&this.ElementsAreEqual(r,i);)r--,i--;if(e>r||n>i){let P;return n<=i?(Dc.Assert(e===r+1,"originalStart should only be one more than originalEnd"),P=[new xa(e,0,n,i-n+1)]):e<=r?(Dc.Assert(n===i+1,"modifiedStart should only be one more than modifiedEnd"),P=[new xa(e,r-e+1,n,0)]):(Dc.Assert(e===r+1,"originalStart should only be one more than originalEnd"),Dc.Assert(n===i+1,"modifiedStart should only be one more than modifiedEnd"),P=[]),P}const l=[0],d=[0],m=this.ComputeRecursionPoint(e,r,n,i,l,d,a),v=l[0],E=d[0];if(m!==null)return m;if(!a[0]){const P=this.ComputeDiffRecursive(e,v,n,E,a);let R=[];return a[0]?R=[new xa(v+1,r-(v+1)+1,E+1,i-(E+1)+1)]:R=this.ComputeDiffRecursive(v+1,r,E+1,i,a),this.ConcatenateChanges(P,R)}return[new xa(e,r-e+1,n,i-n+1)]}WALKTRACE(e,r,n,i,a,l,d,m,v,E,P,R,I,M,N,B,j,K){let ee=null,te=null,fe=new hg,$e=r,Ae=n,Te=I[0]-B[0]-i,qe=-1073741824,De=this.m_forwardHistory.length-1;do{const Be=Te+e;Be===$e||Be<Ae&&v[Be-1]<v[Be+1]?(P=v[Be+1],M=P-Te-i,P<qe&&fe.MarkNextChange(),qe=P,fe.AddModifiedElement(P+1,M),Te=Be+1-e):(P=v[Be-1]+1,M=P-Te-i,P<qe&&fe.MarkNextChange(),qe=P-1,fe.AddOriginalElement(P,M+1),Te=Be-1-e),De>=0&&(v=this.m_forwardHistory[De],e=v[0],$e=1,Ae=v.length-1)}while(--De>=-1);if(ee=fe.getReverseChanges(),K[0]){let Be=I[0]+1,et=B[0]+1;if(ee!==null&&ee.length>0){const cr=ee[ee.length-1];Be=Math.max(Be,cr.getOriginalEnd()),et=Math.max(et,cr.getModifiedEnd())}te=[new xa(Be,R-Be+1,et,N-et+1)]}else{fe=new hg,$e=l,Ae=d,Te=I[0]-B[0]-m,qe=1073741824,De=j?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{const Be=Te+a;Be===$e||Be<Ae&&E[Be-1]>=E[Be+1]?(P=E[Be+1]-1,M=P-Te-m,P>qe&&fe.MarkNextChange(),qe=P+1,fe.AddOriginalElement(P+1,M+1),Te=Be+1-a):(P=E[Be-1],M=P-Te-m,P>qe&&fe.MarkNextChange(),qe=P,fe.AddModifiedElement(P+1,M+1),Te=Be-1-a),De>=0&&(E=this.m_reverseHistory[De],a=E[0],$e=1,Ae=E.length-1)}while(--De>=-1);te=fe.getChanges()}return this.ConcatenateChanges(ee,te)}ComputeRecursionPoint(e,r,n,i,a,l,d){let m=0,v=0,E=0,P=0,R=0,I=0;e--,n--,a[0]=0,l[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];const M=r-e+(i-n),N=M+1,B=new Int32Array(N),j=new Int32Array(N),K=i-n,ee=r-e,te=e-n,fe=r-i,Ae=(ee-K)%2==0;B[K]=e,j[ee]=r,d[0]=!1;for(let Te=1;Te<=M/2+1;Te++){let qe=0,De=0;E=this.ClipDiagonalBound(K-Te,Te,K,N),P=this.ClipDiagonalBound(K+Te,Te,K,N);for(let et=E;et<=P;et+=2){et===E||et<P&&B[et-1]<B[et+1]?m=B[et+1]:m=B[et-1]+1,v=m-(et-K)-te;const cr=m;for(;m<r&&v<i&&this.ElementsAreEqual(m+1,v+1);)m++,v++;if(B[et]=m,m+v>qe+De&&(qe=m,De=v),!Ae&&Math.abs(et-ee)<=Te-1&&m>=j[et])return a[0]=m,l[0]=v,cr<=j[et]&&1447>0&&Te<=1447+1?this.WALKTRACE(K,E,P,te,ee,R,I,fe,B,j,m,r,a,v,i,l,Ae,d):null}const Be=(qe-e+(De-n)-Te)/2;if(this.ContinueProcessingPredicate!==null&&!this.ContinueProcessingPredicate(qe,Be))return d[0]=!0,a[0]=qe,l[0]=De,Be>0&&1447>0&&Te<=1447+1?this.WALKTRACE(K,E,P,te,ee,R,I,fe,B,j,m,r,a,v,i,l,Ae,d):(e++,n++,[new xa(e,r-e+1,n,i-n+1)]);R=this.ClipDiagonalBound(ee-Te,Te,ee,N),I=this.ClipDiagonalBound(ee+Te,Te,ee,N);for(let et=R;et<=I;et+=2){et===R||et<I&&j[et-1]>=j[et+1]?m=j[et+1]-1:m=j[et-1],v=m-(et-ee)-fe;const cr=m;for(;m>e&&v>n&&this.ElementsAreEqual(m,v);)m--,v--;if(j[et]=m,Ae&&Math.abs(et-K)<=Te&&m<=B[et])return a[0]=m,l[0]=v,cr>=B[et]&&1447>0&&Te<=1447+1?this.WALKTRACE(K,E,P,te,ee,R,I,fe,B,j,m,r,a,v,i,l,Ae,d):null}if(Te<=1447){let et=new Int32Array(P-E+2);et[0]=K-E+1,kc.Copy2(B,E,et,1,P-E+1),this.m_forwardHistory.push(et),et=new Int32Array(I-R+2),et[0]=ee-R+1,kc.Copy2(j,R,et,1,I-R+1),this.m_reverseHistory.push(et)}}return this.WALKTRACE(K,E,P,te,ee,R,I,fe,B,j,m,r,a,v,i,l,Ae,d)}PrettifyChanges(e){for(let r=0;r<e.length;r++){const n=e[r],i=r<e.length-1?e[r+1].originalStart:this._originalElementsOrHash.length,a=r<e.length-1?e[r+1].modifiedStart:this._modifiedElementsOrHash.length,l=n.originalLength>0,d=n.modifiedLength>0;for(;n.originalStart+n.originalLength<i&&n.modifiedStart+n.modifiedLength<a&&(!l||this.OriginalElementsAreEqual(n.originalStart,n.originalStart+n.originalLength))&&(!d||this.ModifiedElementsAreEqual(n.modifiedStart,n.modifiedStart+n.modifiedLength));){const v=this.ElementsAreStrictEqual(n.originalStart,n.modifiedStart);if(this.ElementsAreStrictEqual(n.originalStart+n.originalLength,n.modifiedStart+n.modifiedLength)&&!v)break;n.originalStart++,n.modifiedStart++}let m=[null];if(r<e.length-1&&this.ChangesOverlap(e[r],e[r+1],m)){e[r]=m[0],e.splice(r+1,1),r--;continue}}for(let r=e.length-1;r>=0;r--){const n=e[r];let i=0,a=0;if(r>0){const P=e[r-1];i=P.originalStart+P.originalLength,a=P.modifiedStart+P.modifiedLength}const l=n.originalLength>0,d=n.modifiedLength>0;let m=0,v=this._boundaryScore(n.originalStart,n.originalLength,n.modifiedStart,n.modifiedLength);for(let P=1;;P++){const R=n.originalStart-P,I=n.modifiedStart-P;if(R<i||I<a||l&&!this.OriginalElementsAreEqual(R,R+n.originalLength)||d&&!this.ModifiedElementsAreEqual(I,I+n.modifiedLength))break;const N=(R===i&&I===a?5:0)+this._boundaryScore(R,n.originalLength,I,n.modifiedLength);N>v&&(v=N,m=P)}n.originalStart-=m,n.modifiedStart-=m;const E=[null];if(r>0&&this.ChangesOverlap(e[r-1],e[r],E)){e[r-1]=E[0],e.splice(r,1),r++;continue}}if(this._hasStrings)for(let r=1,n=e.length;r<n;r++){const i=e[r-1],a=e[r],l=a.originalStart-i.originalStart-i.originalLength,d=i.originalStart,m=a.originalStart+a.originalLength,v=m-d,E=i.modifiedStart,P=a.modifiedStart+a.modifiedLength,R=P-E;if(l<5&&v<20&&R<20){const I=this._findBetterContiguousSequence(d,v,E,R,l);if(I){const[M,N]=I;(M!==i.originalStart+i.originalLength||N!==i.modifiedStart+i.modifiedLength)&&(i.originalLength=M-i.originalStart,i.modifiedLength=N-i.modifiedStart,a.originalStart=M+l,a.modifiedStart=N+l,a.originalLength=m-a.originalStart,a.modifiedLength=P-a.modifiedStart)}}}return e}_findBetterContiguousSequence(e,r,n,i,a){if(r<a||i<a)return null;const l=e+r-a+1,d=n+i-a+1;let m=0,v=0,E=0;for(let P=e;P<l;P++)for(let R=n;R<d;R++){const I=this._contiguousSequenceScore(P,R,a);I>0&&I>m&&(m=I,v=P,E=R)}return m>0?[v,E]:null}_contiguousSequenceScore(e,r,n){let i=0;for(let a=0;a<n;a++){if(!this.ElementsAreEqual(e+a,r+a))return 0;i+=this._originalStringElements[e+a].length}return i}_OriginalIsBoundary(e){return e<=0||e>=this._originalElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._originalStringElements[e])}_OriginalRegionIsBoundary(e,r){if(this._OriginalIsBoundary(e)||this._OriginalIsBoundary(e-1))return!0;if(r>0){const n=e+r;if(this._OriginalIsBoundary(n-1)||this._OriginalIsBoundary(n))return!0}return!1}_ModifiedIsBoundary(e){return e<=0||e>=this._modifiedElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._modifiedStringElements[e])}_ModifiedRegionIsBoundary(e,r){if(this._ModifiedIsBoundary(e)||this._ModifiedIsBoundary(e-1))return!0;if(r>0){const n=e+r;if(this._ModifiedIsBoundary(n-1)||this._ModifiedIsBoundary(n))return!0}return!1}_boundaryScore(e,r,n,i){const a=this._OriginalRegionIsBoundary(e,r)?1:0,l=this._ModifiedRegionIsBoundary(n,i)?1:0;return a+l}ConcatenateChanges(e,r){let n=[];if(e.length===0||r.length===0)return r.length>0?r:e;if(this.ChangesOverlap(e[e.length-1],r[0],n)){const i=new Array(e.length+r.length-1);return kc.Copy(e,0,i,0,e.length-1),i[e.length-1]=n[0],kc.Copy(r,1,i,e.length,r.length-1),i}else{const i=new Array(e.length+r.length);return kc.Copy(e,0,i,0,e.length),kc.Copy(r,0,i,e.length,r.length),i}}ChangesOverlap(e,r,n){if(Dc.Assert(e.originalStart<=r.originalStart,"Left change is not less than or equal to right change"),Dc.Assert(e.modifiedStart<=r.modifiedStart,"Left change is not less than or equal to right change"),e.originalStart+e.originalLength>=r.originalStart||e.modifiedStart+e.modifiedLength>=r.modifiedStart){const i=e.originalStart;let a=e.originalLength;const l=e.modifiedStart;let d=e.modifiedLength;return e.originalStart+e.originalLength>=r.originalStart&&(a=r.originalStart+r.originalLength-e.originalStart),e.modifiedStart+e.modifiedLength>=r.modifiedStart&&(d=r.modifiedStart+r.modifiedLength-e.modifiedStart),n[0]=new xa(i,a,l,d),!0}else return n[0]=null,!1}ClipDiagonalBound(e,r,n,i){if(e>=0&&e<i)return e;const a=n,l=i-n-1,d=r%2==0;if(e<0){const m=a%2==0;return d===m?0:1}else{const m=l%2==0;return d===m?i-1:i-2}}}var ef;(function(t){function e(n,i){return n instanceof bu?i:new _.Position(i.line,i.character)}t.makePosition=e;function r(n,i){return n instanceof bu?i:new _.Range(i.start.line,i.start.character,i.end.line,i.end.character)}t.makeRange=r})(ef||(ef={}));var fg;(function(t){t[t.index2code=1]="index2code",t[t.code2Index=2]="code2Index"})(fg||(fg={}));const pg=class{constructor(t,e,r,n){this.diffCache=new Ta(32),this.indexDocumentCache=new Ta(32),this.codeDocumentCache=new Ta(32),this.providerService=t,this.rootUri=e,this.index=r,this.code=n,this.changes=this.computeChanges()}async computeChanges(){if(this.index===this.code)return new Map;const t=await this.providerService.compareCommits(this.rootUri,{base:this.index,compare:this.code});return t===void 0?new Map:new Map(t.map(e=>[e.uri.toString(),e.type]))}async needsMapping(t){const e=t.uri;if(!e.toString().startsWith(this.rootUri.toString()))return!1;if((await this.changes).get(e.toString())!==void 0)return!0;const i=await this.getIndexDocument(e);return i===void 0?!0:this.getDiff(1,i,t).length!==0}async mapPositionFromCodeToIndex(t,e){const r=t.uri;if(!r.toString().startsWith(this.rootUri.toString()))return;const i=(await this.changes).get(r.toString());if(i===Ot.Created||i===Ot.Deleted)return;const a=await this.getIndexDocument(r);if(a===void 0)return;const l=this.getDiff(2,a,t);if(l.length===0)return e;const d=t.offsetAt(new _.Position(e.line,e.character));let m=d;for(const R of l){if(R.modifiedStart<=d&&d<R.modifiedStart+R.modifiedLength)return;if(m<R.modifiedStart)break;m=m-(R.modifiedLength-R.originalLength)}const v=a.positionAt(m),E=this.getWordAtOffset(a.lineAt(v.line).text,v.character),P=this.getWordAtOffset(t.lineAt(e.line).text,e.character);if(!(E===void 0||P===void 0||E!==P))return new _.Position(v.line,v.character)}async mapRangeFromIndexToCode(t,e){const r=t instanceof _.Uri?t:t.uri;if(!r.toString().startsWith(this.rootUri.toString()))return;const i=(await this.changes).get(r.toString());if(i===Ot.Created||i===Ot.Deleted)return;const[a,l]=await Promise.all([this.getIndexDocument(r),this.getCodeDocument(t)]);if(a===void 0||l===void 0)return;const d=this.getDiff(1,a,l);if(d.length===0)return e;const m=a.offsetAt(e.start);let v=m;const E=a.offsetAt(e.end);let P=E;for(const B of d){if(P<B.originalStart)break;const j=B.modifiedLength-B.originalLength;if(B.originalStart<=m){if(m<B.originalStart+B.originalLength)return;v+=j}else if(E<B.originalStart+B.originalLength)return;if(B.originalStart<=E){if(E<B.originalStart+B.originalLength)return;P+=j}}const R=l.positionAt(v),I=l.positionAt(P),M=a.getText(e),N=l.getText(ef.makeRange(l,{start:R,end:I}));if(M===N)return new _.Range(R.line,R.character,I.line,I.character)}async getIndexDocument(t){return this.getDocument(this.indexDocumentCache,t,this.index)}async getCodeDocument(t){return t instanceof _.Uri?this.getDocument(this.codeDocumentCache,t,this.code):t}async getDocument(t,e,r){let n=t.get(e.toString());if(n!==null)return n!==void 0||(n=this._getDocument(e,r),t.set(e.toString(),n),n.then(i=>{i===void 0&&t.set(e.toString(),null)},void 0)),n}async _getDocument(t,e){const r=t.toString().substr(this.rootUri.toString().length);return this.providerService.getFileContent(this.rootUri,e,r).then(n=>new bu(t,Number.MAX_VALUE,pg.textDecoder.decode(n)),()=>{})}getDiff(t,e,r){if(e.uri.toString()!==r.uri.toString())throw new Error(`Original (${e.uri.toString()}) and modified (${r.uri.toString()}) are pointing to a different document`);const n=`${t}${e.uri.toString()}`;let i=this.diffCache.get(n);return i!==void 0&&i.original===e.version&&i.modified===r.version||(i={original:e.version,modified:r.version,changes:L0(e.getText(),r.getText(),!0)},this.diffCache.set(n,i)),i.changes}getWordAtOffset(t,e){let r="findStart",n=0,i=t.length,a=0;for(;a<t.length&&r!=="endFound";){switch(a===e&&(r="findEnd"),t[a]){case" ":case"	":case"(":case")":case"[":case"]":case"{":case"}":case"'":case'"':case"`":switch(r){case"findStart":n=a+1;break;case"findEnd":i=a,r="endFound";break}break}a++}return r==="endFound"?t.substring(n,i):void 0}};let gg=pg;gg.textDecoder=new TextDecoder("utf8");var mg;(function(t){t[t.LineFeed=10]="LineFeed",t[t.CarriageReturn=13]="CarriageReturn"})(mg||(mg={}));class bu{static computeLineOffsets(e,r,n=0){const i=r?[n]:[];for(let a=0;a<e.length;a++){const l=e.charCodeAt(a);(l===13||l===10)&&(l===13&&a+1<e.length&&e.charCodeAt(a+1)===10&&a++,i.push(n+a+1))}return i}constructor(e,r,n){this._content=n,this.uri=e,this.version=r,this._lineOffsets=void 0}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=bu.computeLineOffsets(this._content,!0)),this._lineOffsets}getText(e){if(e){const r=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(r,n)}return this._content}lineAt(e){const r=this.getLineOffsets();if(e>=r.length)return{lineNumber:e,text:""};const n=r[e],i=r[e+1];if(i===void 0)return{lineNumber:e,text:this._content.substring(n)};const a=this._content.substring(n,i);let l=a.length-1;for(;l>=0&&(a[l]===`
`||a[l]==="\r");)l--;return{lineNumber:e,text:a.substr(0,l+1)}}positionAt(e){e=Math.max(Math.min(e,this._content.length),0);const r=this.getLineOffsets();let n=0,i=r.length;if(i===0)return{line:0,character:e};for(;n<i;){const l=Math.floor((n+i)/2);r[l]>e?i=l:n=l+1}const a=n-1;return{line:a,character:e-r[a]}}offsetAt(e){const r=this.getLineOffsets();if(e.line>=r.length)return this._content.length;if(e.line<0)return 0;const n=r[e.line],i=e.line+1<r.length?r[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)}get lineCount(){return this.getLineOffsets().length}}var vg;(function(t){t.MIN_VALUE=-2147483648,t.MAX_VALUE=2147483647})(vg||(vg={}));var Md;(function(t){t.MIN_VALUE=0,t.MAX_VALUE=2147483647})(Md||(Md={}));var Hi;(function(t){function e(n,i){return n===Number.MAX_VALUE&&(n=Md.MAX_VALUE),i===Number.MAX_VALUE&&(i=Md.MAX_VALUE),{line:n,character:i}}t.create=e;function r(n){var i=n;return Me.objectLiteral(i)&&Me.uinteger(i.line)&&Me.uinteger(i.character)}t.is=r})(Hi||(Hi={}));var Gr;(function(t){function e(n,i,a,l){if(Me.uinteger(n)&&Me.uinteger(i)&&Me.uinteger(a)&&Me.uinteger(l))return{start:Hi.create(n,i),end:Hi.create(a,l)};if(Hi.is(n)&&Hi.is(i))return{start:n,end:i};throw new Error("Range#create called with invalid arguments["+n+", "+i+", "+a+", "+l+"]")}t.create=e;function r(n){var i=n;return Me.objectLiteral(i)&&Hi.is(i.start)&&Hi.is(i.end)}t.is=r})(Gr||(Gr={}));var tf;(function(t){function e(n,i){return{uri:n,range:i}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Gr.is(i.range)&&(Me.string(i.uri)||Me.undefined(i.uri))}t.is=r})(tf||(tf={}));var Ld;(function(t){function e(n,i,a,l){return{targetUri:n,targetRange:i,targetSelectionRange:a,originSelectionRange:l}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Gr.is(i.targetRange)&&Me.string(i.targetUri)&&(Gr.is(i.targetSelectionRange)||Me.undefined(i.targetSelectionRange))&&(Gr.is(i.originSelectionRange)||Me.undefined(i.originSelectionRange))}t.is=r})(Ld||(Ld={}));var rf;(function(t){function e(n,i,a,l){return{red:n,green:i,blue:a,alpha:l}}t.create=e;function r(n){var i=n;return Me.numberRange(i.red,0,1)&&Me.numberRange(i.green,0,1)&&Me.numberRange(i.blue,0,1)&&Me.numberRange(i.alpha,0,1)}t.is=r})(rf||(rf={}));var yg;(function(t){function e(n,i){return{range:n,color:i}}t.create=e;function r(n){var i=n;return Gr.is(i.range)&&rf.is(i.color)}t.is=r})(yg||(yg={}));var _g;(function(t){function e(n,i,a){return{label:n,textEdit:i,additionalTextEdits:a}}t.create=e;function r(n){var i=n;return Me.string(i.label)&&(Me.undefined(i.textEdit)||Ra.is(i))&&(Me.undefined(i.additionalTextEdits)||Me.typedArray(i.additionalTextEdits,Ra.is))}t.is=r})(_g||(_g={}));var wu;(function(t){t.Comment="comment",t.Imports="imports",t.Region="region"})(wu||(wu={}));var bg;(function(t){function e(n,i,a,l,d){var m={startLine:n,endLine:i};return Me.defined(a)&&(m.startCharacter=a),Me.defined(l)&&(m.endCharacter=l),Me.defined(d)&&(m.kind=d),m}t.create=e;function r(n){var i=n;return Me.uinteger(i.startLine)&&Me.uinteger(i.startLine)&&(Me.undefined(i.startCharacter)||Me.uinteger(i.startCharacter))&&(Me.undefined(i.endCharacter)||Me.uinteger(i.endCharacter))&&(Me.undefined(i.kind)||Me.string(i.kind))}t.is=r})(bg||(bg={}));var nf;(function(t){function e(n,i){return{location:n,message:i}}t.create=e;function r(n){var i=n;return Me.defined(i)&&tf.is(i.location)&&Me.string(i.message)}t.is=r})(nf||(nf={}));var Nc;(function(t){t.Error=1,t.Warning=2,t.Information=3,t.Hint=4})(Nc||(Nc={}));var Fd;(function(t){t.Unnecessary=1,t.Deprecated=2})(Fd||(Fd={}));var of;(function(t){function e(r){var n=r;return n!=null&&Me.string(n.href)}t.is=e})(of||(of={}));var $d;(function(t){function e(n,i,a,l,d,m){var v={range:n,message:i};return Me.defined(a)&&(v.severity=a),Me.defined(l)&&(v.code=l),Me.defined(d)&&(v.source=d),Me.defined(m)&&(v.relatedInformation=m),v}t.create=e;function r(n){var i,a=n;return Me.defined(a)&&Gr.is(a.range)&&Me.string(a.message)&&(Me.number(a.severity)||Me.undefined(a.severity))&&(Me.integer(a.code)||Me.string(a.code)||Me.undefined(a.code))&&(Me.undefined(a.codeDescription)||Me.string((i=a.codeDescription)===null||i===void 0?void 0:i.href))&&(Me.string(a.source)||Me.undefined(a.source))&&(Me.undefined(a.relatedInformation)||Me.typedArray(a.relatedInformation,nf.is))}t.is=r})($d||($d={}));var Su;(function(t){function e(n,i){for(var a=[],l=2;l<arguments.length;l++)a[l-2]=arguments[l];var d={title:n,command:i};return Me.defined(a)&&a.length>0&&(d.arguments=a),d}t.create=e;function r(n){var i=n;return Me.defined(i)&&Me.string(i.title)&&Me.string(i.command)}t.is=r})(Su||(Su={}));var Ra;(function(t){function e(a,l){return{range:a,newText:l}}t.replace=e;function r(a,l){return{range:{start:a,end:a},newText:l}}t.insert=r;function n(a){return{range:a,newText:""}}t.del=n;function i(a){var l=a;return Me.objectLiteral(l)&&Me.string(l.newText)&&Gr.is(l.range)}t.is=i})(Ra||(Ra={}));var Mc;(function(t){function e(n,i,a){var l={label:n};return i!==void 0&&(l.needsConfirmation=i),a!==void 0&&(l.description=a),l}t.create=e;function r(n){var i=n;return i!==void 0&&Me.objectLiteral(i)&&Me.string(i.label)&&(Me.boolean(i.needsConfirmation)||i.needsConfirmation===void 0)&&(Me.string(i.description)||i.description===void 0)}t.is=r})(Mc||(Mc={}));var cn;(function(t){function e(r){var n=r;return typeof n=="string"}t.is=e})(cn||(cn={}));var Aa;(function(t){function e(a,l,d){return{range:a,newText:l,annotationId:d}}t.replace=e;function r(a,l,d){return{range:{start:a,end:a},newText:l,annotationId:d}}t.insert=r;function n(a,l){return{range:a,newText:"",annotationId:l}}t.del=n;function i(a){var l=a;return Ra.is(l)&&(Mc.is(l.annotationId)||cn.is(l.annotationId))}t.is=i})(Aa||(Aa={}));var Eu;(function(t){function e(n,i){return{textDocument:n,edits:i}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Hd.is(i.textDocument)&&Array.isArray(i.edits)}t.is=r})(Eu||(Eu={}));var Lc;(function(t){function e(n,i,a){var l={kind:"create",uri:n};return i!==void 0&&(i.overwrite!==void 0||i.ignoreIfExists!==void 0)&&(l.options=i),a!==void 0&&(l.annotationId=a),l}t.create=e;function r(n){var i=n;return i&&i.kind==="create"&&Me.string(i.uri)&&(i.options===void 0||(i.options.overwrite===void 0||Me.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||Me.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||cn.is(i.annotationId))}t.is=r})(Lc||(Lc={}));var Fc;(function(t){function e(n,i,a,l){var d={kind:"rename",oldUri:n,newUri:i};return a!==void 0&&(a.overwrite!==void 0||a.ignoreIfExists!==void 0)&&(d.options=a),l!==void 0&&(d.annotationId=l),d}t.create=e;function r(n){var i=n;return i&&i.kind==="rename"&&Me.string(i.oldUri)&&Me.string(i.newUri)&&(i.options===void 0||(i.options.overwrite===void 0||Me.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||Me.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||cn.is(i.annotationId))}t.is=r})(Fc||(Fc={}));var $c;(function(t){function e(n,i,a){var l={kind:"delete",uri:n};return i!==void 0&&(i.recursive!==void 0||i.ignoreIfNotExists!==void 0)&&(l.options=i),a!==void 0&&(l.annotationId=a),l}t.create=e;function r(n){var i=n;return i&&i.kind==="delete"&&Me.string(i.uri)&&(i.options===void 0||(i.options.recursive===void 0||Me.boolean(i.options.recursive))&&(i.options.ignoreIfNotExists===void 0||Me.boolean(i.options.ignoreIfNotExists)))&&(i.annotationId===void 0||cn.is(i.annotationId))}t.is=r})($c||($c={}));var af;(function(t){function e(r){var n=r;return n&&(n.changes!==void 0||n.documentChanges!==void 0)&&(n.documentChanges===void 0||n.documentChanges.every(function(i){return Me.string(i.kind)?Lc.is(i)||Fc.is(i)||$c.is(i):Eu.is(i)}))}t.is=e})(af||(af={}));var Bd=function(){function t(e,r){this.edits=e,this.changeAnnotations=r}return t.prototype.insert=function(e,r,n){var i,a;if(n===void 0?i=Ra.insert(e,r):cn.is(n)?(a=n,i=Aa.insert(e,r,n)):(this.assertChangeAnnotations(this.changeAnnotations),a=this.changeAnnotations.manage(n),i=Aa.insert(e,r,a)),this.edits.push(i),a!==void 0)return a},t.prototype.replace=function(e,r,n){var i,a;if(n===void 0?i=Ra.replace(e,r):cn.is(n)?(a=n,i=Aa.replace(e,r,n)):(this.assertChangeAnnotations(this.changeAnnotations),a=this.changeAnnotations.manage(n),i=Aa.replace(e,r,a)),this.edits.push(i),a!==void 0)return a},t.prototype.delete=function(e,r){var n,i;if(r===void 0?n=Ra.del(e):cn.is(r)?(i=r,n=Aa.del(e,r)):(this.assertChangeAnnotations(this.changeAnnotations),i=this.changeAnnotations.manage(r),n=Aa.del(e,i)),this.edits.push(n),i!==void 0)return i},t.prototype.add=function(e){this.edits.push(e)},t.prototype.all=function(){return this.edits},t.prototype.clear=function(){this.edits.splice(0,this.edits.length)},t.prototype.assertChangeAnnotations=function(e){if(e===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},t}(),wg=function(){function t(e){this._annotations=e===void 0?Object.create(null):e,this._counter=0,this._size=0}return t.prototype.all=function(){return this._annotations},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.manage=function(e,r){var n;if(cn.is(e)?n=e:(n=this.nextId(),r=e),this._annotations[n]!==void 0)throw new Error("Id "+n+" is already in use.");if(r===void 0)throw new Error("No annotation provided for id "+n);return this._annotations[n]=r,this._size++,n},t.prototype.nextId=function(){return this._counter++,this._counter.toString()},t}(),VE=function(){function t(e){var r=this;this._textEditChanges=Object.create(null),e!==void 0?(this._workspaceEdit=e,e.documentChanges?(this._changeAnnotations=new wg(e.changeAnnotations),e.changeAnnotations=this._changeAnnotations.all(),e.documentChanges.forEach(function(n){if(Eu.is(n)){var i=new Bd(n.edits,r._changeAnnotations);r._textEditChanges[n.textDocument.uri]=i}})):e.changes&&Object.keys(e.changes).forEach(function(n){var i=new Bd(e.changes[n]);r._textEditChanges[n]=i})):this._workspaceEdit={}}return Object.defineProperty(t.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),t.prototype.getTextEditChange=function(e){if(Hd.is(e)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var r={uri:e.uri,version:e.version},n=this._textEditChanges[r.uri];if(!n){var i=[],a={textDocument:r,edits:i};this._workspaceEdit.documentChanges.push(a),n=new Bd(i,this._changeAnnotations),this._textEditChanges[r.uri]=n}return n}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var n=this._textEditChanges[e];if(!n){var i=[];this._workspaceEdit.changes[e]=i,n=new Bd(i),this._textEditChanges[e]=n}return n}},t.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new wg,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},t.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},t.prototype.createFile=function(e,r,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var i;Mc.is(r)||cn.is(r)?i=r:n=r;var a,l;if(i===void 0?a=Lc.create(e,n):(l=cn.is(i)?i:this._changeAnnotations.manage(i),a=Lc.create(e,n,l)),this._workspaceEdit.documentChanges.push(a),l!==void 0)return l},t.prototype.renameFile=function(e,r,n,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var a;Mc.is(n)||cn.is(n)?a=n:i=n;var l,d;if(a===void 0?l=Fc.create(e,r,i):(d=cn.is(a)?a:this._changeAnnotations.manage(a),l=Fc.create(e,r,i,d)),this._workspaceEdit.documentChanges.push(l),d!==void 0)return d},t.prototype.deleteFile=function(e,r,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var i;Mc.is(r)||cn.is(r)?i=r:n=r;var a,l;if(i===void 0?a=$c.create(e,n):(l=cn.is(i)?i:this._changeAnnotations.manage(i),a=$c.create(e,n,l)),this._workspaceEdit.documentChanges.push(a),l!==void 0)return l},t}(),Sg;(function(t){function e(n){return{uri:n}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Me.string(i.uri)}t.is=r})(Sg||(Sg={}));var Eg;(function(t){function e(n,i){return{uri:n,version:i}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Me.string(i.uri)&&Me.integer(i.version)}t.is=r})(Eg||(Eg={}));var Hd;(function(t){function e(n,i){return{uri:n,version:i}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Me.string(i.uri)&&(i.version===null||Me.integer(i.version))}t.is=r})(Hd||(Hd={}));var Cg;(function(t){function e(n,i,a,l){return{uri:n,languageId:i,version:a,text:l}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Me.string(i.uri)&&Me.string(i.languageId)&&Me.integer(i.version)&&Me.string(i.text)}t.is=r})(Cg||(Cg={}));var Ro;(function(t){t.PlainText="plaintext",t.Markdown="markdown"})(Ro||(Ro={})),function(t){function e(r){var n=r;return n===t.PlainText||n===t.Markdown}t.is=e}(Ro||(Ro={}));var sf;(function(t){function e(r){var n=r;return Me.objectLiteral(r)&&Ro.is(n.kind)&&Me.string(n.value)}t.is=e})(sf||(sf={}));var Tg;(function(t){t.Text=1,t.Method=2,t.Function=3,t.Constructor=4,t.Field=5,t.Variable=6,t.Class=7,t.Interface=8,t.Module=9,t.Property=10,t.Unit=11,t.Value=12,t.Enum=13,t.Keyword=14,t.Snippet=15,t.Color=16,t.File=17,t.Reference=18,t.Folder=19,t.EnumMember=20,t.Constant=21,t.Struct=22,t.Event=23,t.Operator=24,t.TypeParameter=25})(Tg||(Tg={}));var xg;(function(t){t.PlainText=1,t.Snippet=2})(xg||(xg={}));var Rg;(function(t){t.Deprecated=1})(Rg||(Rg={}));var Ag;(function(t){function e(n,i,a){return{newText:n,insert:i,replace:a}}t.create=e;function r(n){var i=n;return i&&Me.string(i.newText)&&Gr.is(i.insert)&&Gr.is(i.replace)}t.is=r})(Ag||(Ag={}));var Ig;(function(t){t.asIs=1,t.adjustIndentation=2})(Ig||(Ig={}));var Pg;(function(t){function e(r){return{label:r}}t.create=e})(Pg||(Pg={}));var Og;(function(t){function e(r,n){return{items:r||[],isIncomplete:!!n}}t.create=e})(Og||(Og={}));var Ud;(function(t){function e(n){return n.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}t.fromPlainText=e;function r(n){var i=n;return Me.string(i)||Me.objectLiteral(i)&&Me.string(i.language)&&Me.string(i.value)}t.is=r})(Ud||(Ud={}));var Dg;(function(t){function e(r){var n=r;return!!n&&Me.objectLiteral(n)&&(sf.is(n.contents)||Ud.is(n.contents)||Me.typedArray(n.contents,Ud.is))&&(r.range===void 0||Gr.is(r.range))}t.is=e})(Dg||(Dg={}));var kg;(function(t){function e(r,n){return n?{label:r,documentation:n}:{label:r}}t.create=e})(kg||(kg={}));var Ng;(function(t){function e(r,n){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];var l={label:r};return Me.defined(n)&&(l.documentation=n),Me.defined(i)?l.parameters=i:l.parameters=[],l}t.create=e})(Ng||(Ng={}));var Cu;(function(t){t.Text=1,t.Read=2,t.Write=3})(Cu||(Cu={}));var Mg;(function(t){function e(r,n){var i={range:r};return Me.number(n)&&(i.kind=n),i}t.create=e})(Mg||(Mg={}));var cf;(function(t){t.File=1,t.Module=2,t.Namespace=3,t.Package=4,t.Class=5,t.Method=6,t.Property=7,t.Field=8,t.Constructor=9,t.Enum=10,t.Interface=11,t.Function=12,t.Variable=13,t.Constant=14,t.String=15,t.Number=16,t.Boolean=17,t.Array=18,t.Object=19,t.Key=20,t.Null=21,t.EnumMember=22,t.Struct=23,t.Event=24,t.Operator=25,t.TypeParameter=26})(cf||(cf={}));var lf;(function(t){t.Deprecated=1})(lf||(lf={}));var Lg;(function(t){function e(r,n,i,a,l){var d={name:r,kind:n,location:{uri:a,range:i}};return l&&(d.containerName=l),d}t.create=e})(Lg||(Lg={}));var Fg;(function(t){function e(n,i,a,l,d,m){var v={name:n,detail:i,kind:a,range:l,selectionRange:d};return m!==void 0&&(v.children=m),v}t.create=e;function r(n){var i=n;return i&&Me.string(i.name)&&Me.number(i.kind)&&Gr.is(i.range)&&Gr.is(i.selectionRange)&&(i.detail===void 0||Me.string(i.detail))&&(i.deprecated===void 0||Me.boolean(i.deprecated))&&(i.children===void 0||Array.isArray(i.children))&&(i.tags===void 0||Array.isArray(i.tags))}t.is=r})(Fg||(Fg={}));var Ui;(function(t){t.Empty="",t.QuickFix="quickfix",t.Refactor="refactor",t.RefactorExtract="refactor.extract",t.RefactorInline="refactor.inline",t.RefactorRewrite="refactor.rewrite",t.Source="source",t.SourceOrganizeImports="source.organizeImports",t.SourceFixAll="source.fixAll"})(Ui||(Ui={}));var $g;(function(t){function e(n,i){var a={diagnostics:n};return i!=null&&(a.only=i),a}t.create=e;function r(n){var i=n;return Me.defined(i)&&Me.typedArray(i.diagnostics,$d.is)&&(i.only===void 0||Me.typedArray(i.only,Me.string))}t.is=r})($g||($g={}));var Bg;(function(t){function e(n,i,a){var l={title:n},d=!0;return typeof i=="string"?(d=!1,l.kind=i):Su.is(i)?l.command=i:l.edit=i,d&&a!==void 0&&(l.kind=a),l}t.create=e;function r(n){var i=n;return i&&Me.string(i.title)&&(i.diagnostics===void 0||Me.typedArray(i.diagnostics,$d.is))&&(i.kind===void 0||Me.string(i.kind))&&(i.edit!==void 0||i.command!==void 0)&&(i.command===void 0||Su.is(i.command))&&(i.isPreferred===void 0||Me.boolean(i.isPreferred))&&(i.edit===void 0||af.is(i.edit))}t.is=r})(Bg||(Bg={}));var Hg;(function(t){function e(n,i){var a={range:n};return Me.defined(i)&&(a.data=i),a}t.create=e;function r(n){var i=n;return Me.defined(i)&&Gr.is(i.range)&&(Me.undefined(i.command)||Su.is(i.command))}t.is=r})(Hg||(Hg={}));var Ug;(function(t){function e(n,i){return{tabSize:n,insertSpaces:i}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Me.uinteger(i.tabSize)&&Me.boolean(i.insertSpaces)}t.is=r})(Ug||(Ug={}));var jg;(function(t){function e(n,i,a){return{range:n,target:i,data:a}}t.create=e;function r(n){var i=n;return Me.defined(i)&&Gr.is(i.range)&&(Me.undefined(i.target)||Me.string(i.target))}t.is=r})(jg||(jg={}));var qg;(function(t){function e(n,i){return{range:n,parent:i}}t.create=e;function r(n){var i=n;return i!==void 0&&Gr.is(i.range)&&(i.parent===void 0||t.is(i.parent))}t.is=r})(qg||(qg={}));var KE=null,zg;(function(t){function e(a,l,d,m){return new $0(a,l,d,m)}t.create=e;function r(a){var l=a;return!!(Me.defined(l)&&Me.string(l.uri)&&(Me.undefined(l.languageId)||Me.string(l.languageId))&&Me.uinteger(l.lineCount)&&Me.func(l.getText)&&Me.func(l.positionAt)&&Me.func(l.offsetAt))}t.is=r;function n(a,l){for(var d=a.getText(),m=i(l,function(M,N){var B=M.range.start.line-N.range.start.line;return B===0?M.range.start.character-N.range.start.character:B}),v=d.length,E=m.length-1;E>=0;E--){var P=m[E],R=a.offsetAt(P.range.start),I=a.offsetAt(P.range.end);if(I<=v)d=d.substring(0,R)+P.newText+d.substring(I,d.length);else throw new Error("Overlapping edit");v=R}return d}t.applyEdits=n;function i(a,l){if(a.length<=1)return a;var d=a.length/2|0,m=a.slice(0,d),v=a.slice(d);i(m,l),i(v,l);for(var E=0,P=0,R=0;E<m.length&&P<v.length;){var I=l(m[E],v[P]);I<=0?a[R++]=m[E++]:a[R++]=v[P++]}for(;E<m.length;)a[R++]=m[E++];for(;P<v.length;)a[R++]=v[P++];return a}})(zg||(zg={}));var $0=function(){function t(e,r,n,i){this._uri=e,this._languageId=r,this._version=n,this._content=i,this._lineOffsets=void 0}return Object.defineProperty(t.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),t.prototype.getText=function(e){if(e){var r=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(r,n)}return this._content},t.prototype.update=function(e,r){this._content=e.text,this._version=r,this._lineOffsets=void 0},t.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var e=[],r=this._content,n=!0,i=0;i<r.length;i++){n&&(e.push(i),n=!1);var a=r.charAt(i);n=a==="\r"||a===`
`,a==="\r"&&i+1<r.length&&r.charAt(i+1)===`
`&&i++}n&&r.length>0&&e.push(r.length),this._lineOffsets=e}return this._lineOffsets},t.prototype.positionAt=function(e){e=Math.max(Math.min(e,this._content.length),0);var r=this.getLineOffsets(),n=0,i=r.length;if(i===0)return Hi.create(0,e);for(;n<i;){var a=Math.floor((n+i)/2);r[a]>e?i=a:n=a+1}var l=n-1;return Hi.create(l,e-r[l])},t.prototype.offsetAt=function(e){var r=this.getLineOffsets();if(e.line>=r.length)return this._content.length;if(e.line<0)return 0;var n=r[e.line],i=e.line+1<r.length?r[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)},Object.defineProperty(t.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),t}(),Me;(function(t){var e=Object.prototype.toString;function r(I){return typeof I!="undefined"}t.defined=r;function n(I){return typeof I=="undefined"}t.undefined=n;function i(I){return I===!0||I===!1}t.boolean=i;function a(I){return e.call(I)==="[object String]"}t.string=a;function l(I){return e.call(I)==="[object Number]"}t.number=l;function d(I,M,N){return e.call(I)==="[object Number]"&&M<=I&&I<=N}t.numberRange=d;function m(I){return e.call(I)==="[object Number]"&&-2147483648<=I&&I<=2147483647}t.integer=m;function v(I){return e.call(I)==="[object Number]"&&0<=I&&I<=2147483647}t.uinteger=v;function E(I){return e.call(I)==="[object Function]"}t.func=E;function P(I){return I!==null&&typeof I=="object"}t.objectLiteral=P;function R(I,M){return Array.isArray(I)&&I.every(M)}t.typedArray=R})(Me||(Me={}));var Tu;(function(t){function e(n){return typeof n=="string"||n instanceof String}t.string=e;function r(n){return typeof n=="number"||n instanceof Number}t.number=r})(Tu||(Tu={}));var uf;(function(t){function e(r){const n=r;return n!=null&&(Tu.number(n.value)||Tu.string(n.value))&&Tu.string(n.target)}t.is=e})(uf||(uf={}));class B0 extends _.Diagnostic{constructor(e,r,n,i){super(e,r,n);this.data=i,this.hasDiagnosticCode=!1}}var ji;(function(t){const e=Object.prototype.toString;function r(E){return typeof E!="undefined"}t.defined=r;function n(E){return E===!0||E===!1}t.boolean=n;function i(E){return e.call(E)==="[object String]"}t.string=i;function a(E){return e.call(E)==="[object Number]"}t.number=a;function l(E){return E!==null&&typeof E=="object"}t.objectLiteral=l;function d(E){return Array.isArray(E)}t.array=d;function m(E){return d(E)&&E.every(P=>i(P))}t.stringArray=m;function v(E,P){return Array.isArray(E)&&E.every(P)}t.typedArray=v})(ji||(ji={}));var jd;(function(t){function e(r){const n=r;return n&&ji.string(n.language)&&ji.string(n.value)}t.is=e})(jd||(jd={}));function H0(t){const e=J=>_.Uri.parse(J),r=t!=null?t:e;function n(J){return r(J)}function i(J){return J.map(a)}function a(J){const Je=new B0(P(J.range),J.message,I(J.severity),J.data);return J.code!==void 0&&(of.is(J.codeDescription)?Je.code={value:J.code,target:n(J.codeDescription.href)}:uf.is(J.code)?(Je.hasDiagnosticCode=!0,Je.code={value:J.code.value,target:n(J.code.target)}):Je.code=J.code),J.source&&(Je.source=J.source),J.relatedInformation&&(Je.relatedInformation=l(J.relatedInformation)),Array.isArray(J.tags)&&(Je.tags=m(J.tags)),Je}function l(J){return J.map(d)}function d(J){return new _.DiagnosticRelatedInformation(Te(J.location),J.message)}function m(J){if(!J)return;const Je=[];for(const Ft of J){const Kr=v(Ft);Kr!==void 0&&Je.push(Kr)}return Je.length>0?Je:void 0}function v(J){switch(J){case Fd.Unnecessary:return _.DiagnosticTag.Unnecessary;case Fd.Deprecated:return _.DiagnosticTag.Deprecated;default:return}}function E(J){if(!!J)return new _.Position(J.line,J.character)}function P(J){if(!!J)return new _.Range(E(J.start),E(J.end))}function R(J){return J.map(Je=>P(Je))}function I(J){if(J==null)return _.DiagnosticSeverity.Error;switch(J){case Nc.Error:return _.DiagnosticSeverity.Error;case Nc.Warning:return _.DiagnosticSeverity.Warning;case Nc.Information:return _.DiagnosticSeverity.Information;case Nc.Hint:return _.DiagnosticSeverity.Hint}return _.DiagnosticSeverity.Error}function M(J){if(ji.string(J))return new _.MarkdownString(J);if(jd.is(J))return new _.MarkdownString().appendCodeblock(J.value,J.language);if(Array.isArray(J)){const Ft=[];for(const Kr of J){const nd=new _.MarkdownString;jd.is(Kr)?nd.appendCodeblock(Kr.value,Kr.language):nd.appendMarkdown(Kr),Ft.push(nd)}return Ft}let Je;switch(J.kind){case Ro.Markdown:return new _.MarkdownString(J.value);case Ro.PlainText:return Je=new _.MarkdownString,Je.appendText(J.value),Je;default:return Je=new _.MarkdownString,Je.appendText(`Unsupported Markup content received. Kind is: ${J.kind}`),Je}}function N(J){if(ji.string(J))return J;switch(J.kind){case Ro.Markdown:return new _.MarkdownString(J.value);case Ro.PlainText:return J.value;default:return`Unsupported Markup content received. Kind is: ${J.kind}`}}function B(J){if(!!J)return new _.Hover(M(J.contents),P(J.range))}function j(J){if(!!J)return new _.TextEdit(P(J.range),J.newText)}function K(J){if(!!J)return J.map(j)}function ee(J){if(!J)return;const Je=new _.SignatureHelp;return ji.number(J.activeSignature)?Je.activeSignature=J.activeSignature:Je.activeSignature=0,ji.number(J.activeParameter)?Je.activeParameter=J.activeParameter:Je.activeParameter=0,J.signatures&&(Je.signatures=te(J.signatures)),Je}function te(J){return J.map(fe)}function fe(J){const Je=new _.SignatureInformation(J.label);return J.documentation!==void 0&&(Je.documentation=N(J.documentation)),J.parameters!==void 0&&(Je.parameters=$e(J.parameters)),J.activeParameter!==void 0&&(Je.activeParameter=J.activeParameter),Je}function $e(J){return J.map(Ae)}function Ae(J){const Je=new _.ParameterInformation(J.label);return J.documentation&&(Je.documentation=N(J.documentation)),Je}function Te(J){if(!!J)return new _.Location(r(J.uri),P(J.range))}function qe(J){if(!!J)return et(J)}function De(J){if(!!J)return et(J)}function Be(J){if(!J)return;const Je={targetUri:r(J.targetUri),targetRange:P(J.targetSelectionRange),originSelectionRange:P(J.originSelectionRange),targetSelectionRange:P(J.targetSelectionRange)};if(!Je.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return Je}function et(J){if(!!J)return ji.array(J)?J.length===0?[]:Ld.is(J[0])?J.map(Kr=>Be(Kr)):J.map(Ft=>Te(Ft)):Ld.is(J)?[Be(J)]:Te(J)}function cr(J){if(!!J)return J.map(Je=>Te(Je))}function dn(J){if(!!J)return J.map(wi)}function wi(J){const Je=new _.DocumentHighlight(P(J.range));return ji.number(J.kind)&&(Je.kind=kn(J.kind)),Je}function kn(J){switch(J){case Cu.Text:return _.DocumentHighlightKind.Text;case Cu.Read:return _.DocumentHighlightKind.Read;case Cu.Write:return _.DocumentHighlightKind.Write}return _.DocumentHighlightKind.Text}function Si(J,Je){if(!!J)return J.map(Ft=>sy(Ft,Je))}function Ei(J){return J<=cf.TypeParameter?J-1:_.SymbolKind.Property}function tl(J){switch(J){case lf.Deprecated:return _.SymbolTag.Deprecated;default:return}}function bh(J){if(J==null)return;const Je=[];for(const Ft of J){const Kr=tl(Ft);Kr!==void 0&&Je.push(Kr)}return Je.length===0?void 0:Je}function sy(J,Je){const Ft=new _.SymbolInformation(J.name,Ei(J.kind),P(J.location.range),J.location.uri?r(J.location.uri):Je);return cy(Ft,J),J.containerName&&(Ft.containerName=J.containerName),Ft}function PE(J){if(J!=null)return J.map(bp)}function bp(J){var Je;const Ft=new _.DocumentSymbol(J.name,(Je=J.detail)!=null?Je:"",Ei(J.kind),P(J.range),P(J.selectionRange));if(cy(Ft,J),J.children!==void 0&&J.children.length>0){const Kr=[];for(const nd of J.children)Kr.push(bp(nd));Ft.children=Kr}return Ft}function cy(J,Je){J.tags=bh(Je.tags),Je.deprecated&&(J.tags?J.tags.includes(_.SymbolTag.Deprecated)||(J.tags=J.tags.concat(_.SymbolTag.Deprecated)):J.tags=[_.SymbolTag.Deprecated])}function wp(J){const Je={title:J.title,command:J.command};return J.arguments&&(Je.arguments=J.arguments),Je}function OE(J){if(!!J)return J.map(wp)}const $o=new Map;$o.set(Ui.Empty,_.CodeActionKind.Empty),$o.set(Ui.QuickFix,_.CodeActionKind.QuickFix),$o.set(Ui.Refactor,_.CodeActionKind.Refactor),$o.set(Ui.RefactorExtract,_.CodeActionKind.RefactorExtract),$o.set(Ui.RefactorInline,_.CodeActionKind.RefactorInline),$o.set(Ui.RefactorRewrite,_.CodeActionKind.RefactorRewrite),$o.set(Ui.Source,_.CodeActionKind.Source),$o.set(Ui.SourceOrganizeImports,_.CodeActionKind.SourceOrganizeImports);function Sp(J){if(J==null)return;let Je=$o.get(J);if(Je)return Je;const Ft=J.split(".");Je=_.CodeActionKind.Empty;for(const Kr of Ft)Je=Je.append(Kr);return Je}function DE(J){if(J!=null)return J.map(Je=>Sp(Je))}function kE(J){if(J==null)return;const Je=new _.CodeAction(J.title);return J.kind!==void 0&&(Je.kind=Sp(J.kind)),J.diagnostics&&(Je.diagnostics=i(J.diagnostics)),J.edit&&(Je.edit=ly(J.edit)),J.command&&(Je.command=wp(J.command)),J.isPreferred!==void 0&&(Je.isPreferred=J.isPreferred),Je}function ly(J){if(!J)return;const Je=new _.WorkspaceEdit;return J.documentChanges?J.documentChanges.forEach(Ft=>{if(Lc.is(Ft))Je.createFile(r(Ft.uri),Ft.options);else if(Fc.is(Ft))Je.renameFile(r(Ft.oldUri),r(Ft.newUri),Ft.options);else if($c.is(Ft))Je.deleteFile(r(Ft.uri),Ft.options);else if(Eu.is(Ft))Je.set(r(Ft.textDocument.uri),K(Ft.edits));else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(Ft,void 0,4)}`)}):J.changes&&Object.keys(J.changes).forEach(Ft=>{Je.set(r(Ft),K(J.changes[Ft]))}),Je}function uy(J){return new _.Color(J.red,J.green,J.blue,J.alpha)}function dy(J){return new _.ColorInformation(P(J.range),uy(J.color))}function NE(J){if(Array.isArray(J))return J.map(dy)}function hy(J){const Je=new _.ColorPresentation(J.label);return Je.additionalTextEdits=K(J.additionalTextEdits),J.textEdit&&(Je.textEdit=j(J.textEdit)),Je}function ME(J){if(Array.isArray(J))return J.map(hy)}function fy(J){if(J)switch(J){case wu.Comment:return _.FoldingRangeKind.Comment;case wu.Imports:return _.FoldingRangeKind.Imports;case wu.Region:return _.FoldingRangeKind.Region}}function py(J){return new _.FoldingRange(J.startLine,J.endLine,fy(J.kind))}function LE(J){if(Array.isArray(J))return J.map(py)}function Ep(J){return new _.SelectionRange(P(J.range),J.parent?Ep(J.parent):void 0)}function FE(J){if(!Array.isArray(J))return[];const Je=[];for(const Ft of J)Je.push(Ep(Ft));return Je}return{asUri:n,asDiagnostics:i,asDiagnostic:a,asRange:P,asRanges:R,asPosition:E,asDiagnosticSeverity:I,asDiagnosticTag:v,asHover:B,asTextEdit:j,asTextEdits:K,asSignatureHelp:ee,asSignatureInformations:te,asSignatureInformation:fe,asParameterInformations:$e,asParameterInformation:Ae,asDeclarationResult:qe,asDefinitionResult:De,asLocation:Te,asReferences:cr,asDocumentHighlights:dn,asDocumentHighlight:wi,asDocumentHighlightKind:kn,asSymbolKind:Ei,asSymbolTag:tl,asSymbolTags:bh,asSymbolInformations:Si,asSymbolInformation:sy,asDocumentSymbols:PE,asDocumentSymbol:bp,asCommand:wp,asCommands:OE,asCodeAction:kE,asCodeActionKind:Sp,asCodeActionKinds:DE,asWorkspaceEdit:ly,asFoldingRangeKind:fy,asFoldingRange:py,asFoldingRanges:LE,asColor:uy,asColorInformation:dy,asColorInformations:NE,asColorPresentation:hy,asColorPresentations:ME,asSelectionRange:Ep,asSelectionRanges:FE}}const Ir=(0,N0.loadMessageBundle)();var qi;(function(t){function e(n,i){const{provider:a,repo:l}=i instanceof _.Uri?n.getVirtualUriMetadata(i):i;return n.getRemoteUri(a.id,{repo:l})}t.externalUri=e;function r(n,i){const{provider:a,repo:l}=i instanceof _.Uri?n.getVirtualUriMetadata(i):i;return n.getRemoteUri(a.id,{repo:l})}t.externalIndexUri=r})(qi||(qi={}));var Ao;(function(t){function e(i){if(i.HEAD.type===ct.Branch||i.HEAD.type===ct.RemoteBranch)return i.HEAD.name}t.getBranchName=e;function r(i){if(i.HEAD.type===ct.Branch)return i.HEAD.name}t.getIndexBranchName=r;async function n(i,a,l=kr.timeout){const d=await i.getMetadata(a),m=qi.externalIndexUri(i,d),v=t.getIndexBranchName(d);if(!(m===void 0||v===void 0))return kr.getIndexedTip(i.getAuthentication(a),m,v,l)}t.getIndexedTip=n})(Ao||(Ao={}));var xu;(function(t){const e=new Ta(1024);function r(l,d,m){let v=e.get(m);return v!==void 0||(v=l.getCommit(d,m),e.set(m,v)),v}t.get=r;async function n(l,d,m){const v=[];for(const P of m)v.push(r(l,d,P));const E=[];for(const P of await Promise.all(v))P!==void 0&&E.push(P);return E}t.all=n;function i(l,d){const m=l.commitDate,v=d.commitDate;return m===void 0&&v===void 0?0:m===void 0?1:v===void 0?-1:m<v?1:m>v?-1:0}t.sort=i;function a(l){const d=l.authorName!==void 0?`  \u2022  ${l.authorName}`:"",m=l.commitDate!==void 0?`  \u2022  ${_u(l.commitDate,{ago:!0})}`:"",v=l.branchName!==void 0?` - ${l.branchName}`:"",E=l.tags!==void 0?typeof l.tags=="string"?`  \u2022  ${l.tags}`:`  \u2022  ${l.tags.join(" ")}`:"";return{author:d,date:m,branch:v,tag:E}}t.getCommitInfo=a})(xu||(xu={}));var Wg;(function(t){t[t.Unknown=0]="Unknown",t[t.New=1]="New",t[t.Failed=2]="Failed",t[t.Partial=3]="Partial",t[t.InProgress=4]="InProgress",t[t.Complete=5]="Complete",t[t.PartialIndex=6]="PartialIndex",t[t.CompleteIndex=7]="CompleteIndex"})(Wg||(Wg={}));var qd;(function(t){function e(n){return{workspaceId:n.WorkspaceId,snapshotId:n.SnapshotId,state:n.State,commitId:n.commitId.toLowerCase(),branchName:r(n.BranchName),creationDate:new Date(n._ts*1e3)}}t.asWorkspaceSnapshot=e;function r(n){if(n!==null)return n.startsWith("refs/heads/")?n.substr(11):n}})(qd||(qd={}));var kr;(function(t){t.timeout=5*60*1e3;const e=new Ta(32),r=new Ta(32);async function n(P,R,I,M=t.timeout){const N=await i(P,R,I,M);if(!(N===void 0||N.length===0))return N[0]}t.getIndexedTip=n;async function i(P,R,I,M=t.timeout){const N=l(R,I);let B=e.get(N);if(B===void 0||B!==void 0&&Date.now()-B.time>M){const j=Wn.getAllWorkspaceSnapshots(P,R,d(I));B={time:Date.now(),promise:j,snapshots:void 0},e.set(N,B)}if(B.snapshots!==null){if(B.snapshots===void 0){let j=await B.promise;if(j===void 0){B.snapshots=null;return}j.sort((K,ee)=>ee.creationDate.getTime()-K.creationDate.getTime()),j=j.filter(K=>K.state===5),B.snapshots=j}return B.snapshots}}t.all=i;async function a(P,R,I,M,N=t.timeout){const B=R.toString();let j=r.get(B);if(j===null)return;if(j!==void 0)return j;const K=l(R,M),ee=e.get(K);if(ee!==void 0&&Date.now()-ee.time<=N){if(ee.snapshots===null)return;const te=ee.snapshots!==void 0?ee.snapshots:await i(P,R,M);if(te!==void 0){for(const fe of te)if(fe.commitId===I)return fe}return}if(j=await Wn.getWorkspaceSnapshot(P,I),j===void 0){r.set(B,null);return}return r.set(B,j),j}t.single=a;function l(P,R){return R!==void 0?`${R}\\${P.toString()}`:P.toString()}function d(P){return P===void 0||P.startsWith("refs/heads/")?P:`refs/heads/${P}`}async function m(P,R,I,M=t.timeout){return await a(P,R,I,void 0,M)!==void 0}t.exists=m;async function v(P,R,I,M=t.timeout){return await i(P,R,I,M)!==void 0}t.branch=v;async function E(P,R,I){const M=new Map(I.map(j=>[j.commitId,j])),N=await xu.all(P,R.uri,I.map(j=>j.commitId));if(N.length===0)return;const B=[];for(const j of N){const K=M.get(j.hash);K!==void 0&&B.push({...K,commit:j})}if(B.length!==0)return B}t.resolve=E})(kr||(kr={}));var zi;(function(t){function e(r=!1){return{hoverProvider:r,declarationProvider:r,definitionProvider:r,typeDefinitionProvider:r,referencesProvider:r,documentSymbolProvider:r,foldingRangeProvider:r,diagnosticProvider:r}}t.create=e})(zi||(zi={}));var Wn;(function(t){const e="v0.1",r="https://prod.richnav.vsengsaas.visualstudio.com/api";async function n(j,K,ee){const te=await zn(K,{method:"POST",body:JSON.stringify(ee),headers:{"Content-Type":"application/json",...(await j).getRichNavigationHeaders()}});if(!!te.ok)return te.json()}async function i(j,K,ee){const te=await zn(K,{method:"POST",body:ee,headers:(await j).getRichNavigationHeaders()});if(!!te.ok)return await te.json()}function a(j,K){return`${r}/${e}/HttpLanguageService/${j}/${K}`}async function l(j,K){const ee=await zn(`${r}/${e}/WorkspaceSnapshot?commitId=${K}`,{headers:(await j).getRichNavigationHeaders()});if(ee.ok){const te=await ee.json();return{workspaceId:te.workspaceId,snapshotId:te.snapshotId,state:te.state,commitId:K.toLowerCase(),branchName:void 0,creationDate:new Date}}}t.getWorkspaceSnapshot=l;async function d(j,K,ee){const te=new ng;te.append("uriString",K.toString(!0)),ee!==void 0&&te.append("branchName",ee);try{const fe=await i(j,`${r}/${e}/WorkspaceSnapshot/all`,te);return fe===void 0?void 0:fe.map(qd.asWorkspaceSnapshot)}catch(fe){he.error(fe);return}}t.getAllWorkspaceSnapshots=d;async function m(j,K,ee){const te=new ng;te.append("uriString",K.toString(!0)),ee!==void 0&&te.append("branchName",ee);try{const fe=await i(j,`${r}/${e}/WorkspaceSnapshot/latest`,te);return fe===void 0?void 0:qd.asWorkspaceSnapshot(fe)}catch(fe){he.error(fe);return}}t.getLatestWorkspaceSnapshot=m;async function v(j,K,ee){try{return n(j,a(K,"textDocument/capabilities"),ee)}catch(te){he.error(te);return}}t.capabilities=v;async function E(j,K,ee){try{return n(j,a(K,"textDocument/hover"),ee)}catch(te){he.error(te);return}}t.provideHover=E;async function P(j,K,ee){try{return n(j,a(K,"textDocument/definition"),ee)}catch(te){he.error(te);return}}t.provideDefinition=P;async function R(j,K,ee){try{return n(j,a(K,"textDocument/declaration"),ee)}catch(te){he.error(te);return}}t.provideDeclaration=R;async function I(j,K,ee){try{return n(j,a(K,"textDocument/typeDefinition"),ee)}catch(te){he.error(te);return}}t.provideTypeDefinition=I;async function M(j,K,ee){try{return n(j,a(K,"textDocument/references"),ee)}catch(te){he.error(te);return}}t.provideReferences=M;async function N(j,K,ee){try{return n(j,a(K,"textDocument/foldingRange"),ee)}catch(te){he.error(te);return}}t.providerFoldingRanges=N;async function B(j,K,ee){const te=_.Uri.from({scheme:"https",authority:"prod.richnav.vsengsaas.visualstudio.com",path:`/api/${e}/Workspace/${j}/${K}/assets/designtime`,query:`id=${ee}`});try{const fe=await zn(te.toString().replace("?id%3D","?id="),{method:"GET",headers:{accept:"text/plain"}});return fe.ok?fe.text():void 0}catch(fe){he.error(fe);return}}t.getDesignTimeFileContent=B})(Wn||(Wn={}));class U0{constructor(e){this.providerService=e,this.metadata=new Map,this.providerService.onDidChangeRepositories(r=>{for(const n of r.added){const i=n.uri,a=Ne.getIndexMemento(i);if(a!==void 0){const l=qi.externalIndexUri(this.providerService,i);l!==void 0&&(typeof a.branchName=="string"?kr.all(this.providerService.getAuthentication(i),l,a.branchName).catch(void 0):typeof a.ref=="string"&&Rr(a.ref)&&kr.single(this.providerService.getAuthentication(i),l,a.ref).catch(void 0))}this.providerService.getMetadata(i).then(l=>{const d={},m=Ao.getIndexBranchName(l);m!==void 0?d.branchName=m:d.ref=l.HEAD.sha,Ne.setIndexMemento(i,d).then(void 0,void 0)},void 0)}}),this.providerService.onDidChangeRepository(r=>{const n=r.repository.uri,i=Oe(n);this.metadata.delete(i),this.getIndexMetadata(n).catch(void 0)})}async resolveIndexRef(e,r){const n=await this.providerService.getModeRefType(e),i=fi.decode(e);if(i!==void 0){if(i.type===jr.Latest)return n===re.Branch?this.getIndexedTip(e,r?0:kr.timeout):void 0;if(i.type===jr.SHA){const l=qi.externalIndexUri(this.providerService,e);return l===void 0?void 0:await kr.exists(this.providerService.getAuthentication(e),l,i.sha,r?0:kr.timeout)?i.sha:void 0}}if(this.providerService.getModeConfig(e,n).index===$.Latest)return this.getIndexedTip(e,r?0:kr.timeout)}refresh(e){for(const r of e)this.metadata.delete(r.toString())}getIndexMetadata(e){const r=this.providerService.getVirtualRootUri(e),n=Oe(r);let i=this.metadata.get(n);return i!==void 0||(i=this.createIndexMetadata(e),this.metadata.set(n,i)),i}async getIndexedTip(e,r=kr.timeout){const n=await Ao.getIndexedTip(this.providerService,e,r);return n!==void 0?n.commitId:void 0}async createIndexMetadata(e){const r=new ce(`RichNavIndexProvider.createIndexMetadata(${e.toString()})`);try{const n=qi.externalIndexUri(this.providerService,e);if(n===void 0)return;r.logStep("Getting metadata");const i=this.providerService.getMetadata(e),a=this.providerService.getModeRefType(e,i),l=await i;r.logStep("Getting snapshot",{suffix:" \u2022 Getting snapshot..."});const d=this.providerService.getAuthentication(e),m=Ao.getIndexBranchName(l),v=await kr.single(d,n,l.HEAD.sha,m);if(l.HEAD.type===ct.Branch||l.HEAD.type===ct.RemoteBranch){const I=fi.decode(e);if(I!==void 0)return r.logStep("Handle legacy encoding",{suffix:" \u2022 Handle legacy encoding..."}),v===void 0?I.type===jr.Latest?(r.logStep("Getting branch snapshot",{suffix:" \u2022 Getting branch snapshot..."}),await kr.branch(d,n,l.HEAD.name)?{type:Bt.Indexed}:{type:Bt.NotIndexed}):{type:Bt.NotIndexed}:I.type===jr.Latest||I.type===jr.SHA?{type:Bt.Active,sha:Promise.resolve(v.commitId),branch:{name:v.branchName}}:{type:Bt.Match,sha:Promise.resolve(v.commitId),branch:{name:v.branchName}}}r.logStep("Getting mode config",{suffix:" \u2022 Getting mode config..."});const P=this.providerService.getModeConfig(e,await a),R=this.providerService.getVirtualUriMetadata(e);if((P.index===$.Latest||P.index===$.Match)&&v!==void 0)return{type:Bt.Active,sha:Promise.resolve(v.commitId),branch:{name:v.branchName}};if(P.index===$.TipPlusLatest&&R.provider.id===Dr.GitHub){if(v!==void 0&&v.commitId===l.HEAD.sha)return{type:Bt.Active,sha:Promise.resolve(v.commitId),branch:{name:v.branchName}};if(l.HEAD.type===ct.Branch&&m!==void 0){r.logStep("Getting closest index",{suffix:" \u2022 Getting closest index..."});const I=await kr.all(d,n,m);if(I!==void 0&&I.length>0)return{type:Bt.Active,sha:this.computeClosestIndex(e,l.HEAD.sha,I),branch:{name:m}}}}if(v!==void 0)return{type:Bt.Indexed};if(l.HEAD.type===ct.Branch){const I=Ao.getIndexBranchName(l);if(r.logStep("Getting branch snapshot",{suffix:" \u2022 Getting branch snapshot..."}),I!==void 0&&await kr.branch(d,n,I))return{type:Bt.Indexed}}return{type:Bt.NotIndexed}}finally{r.stop()}}async computeClosestIndex(e,r,n){if(n.length===0)throw new Error("At least on snapshot should exist");const i=new Set(n.map(E=>E.commitId)),a=await this.providerService.getCommits(e,{ref:r,limit:100});if(a===void 0)return;let l;for(const E of a.commits)if(E.hash===r){l=E;break}if(l===void 0)return;const d=new Map(a.commits.map(E=>[E.hash,E])),m=[l];let v;for(;m.length>0;){for(v=m.shift();v!==void 0&&!i.has(v.hash);)if(v.parents.length>0){for(let E=1;E<v.parents.length;E++){const P=d.get(v.parents[E]);P!==void 0&&m.push(P)}v=d.get(v.parents[0])}if(v!==void 0)break}return v!==void 0?v.hash:void 0}async getSnapshots(e,r){const n=qi.externalIndexUri(this.providerService,e);if(n===void 0)return[];const i=await kr.all(this.providerService.getAuthentication(e),n);if(i===void 0)return[];const a=[];for(const l of i)l.branchName!==void 0&&a.push({workspaceId:l.workspaceId,snapshotId:l.snapshotId,hash:l.commitId,branch:{name:l.branchName}});return a}async getStatusBarContributions(e){const r=await this.providerService.getMetadata(e),[n,i]=await Promise.all([this.getIndexMetadata(e),this.providerService.getModeRefType(e,r)]),a=this.providerService.getModeConfig(e,i);if(n===void 0)return[];const{HEAD:l}=r,d=[];if(n!==void 0){let m;const v=[`${pr(l.sha)}`];if(n.type===Bt.Active){const E=await n.sha;a.index===$.Latest||a.index===$.Match?(m=a.display===W.Browse?"$(layers-active)\u2009\u2009$(lock)":"$(layers-active)",v.push(Ir("statusbar.active",`The commit is indexed and rich code navigation features are enabled.
The files in the workspace are readonly.`))):a.index===$.TipPlusLatest&&(m="$(layers-dot)",E!==r.HEAD.sha?v.push(Ir("statusbar.tipPlusLatest","The commit is not indexed. Rich code navigation features are enabled using a former indexed commit which might lead to fuzzy results.")):v.push(Ir("statusbar.tipPlusLatest","The commit is indexed. Rich code navigation features are enabled. Files in the workspace can be modified which might lead to fuzzy results.")))}else n.type===Bt.Match?(m="$(layers)",v.push(Ir("statusbar.match",`The commit you are on is indexed, but rich navigation is not enabled.
Click the status bar item to enable it.`))):n.type===Bt.Indexed&&(m="$(layers)",v.push(Ir("statusbar.indexed",`The branch you are on is indexed, but rich navigation is not enabled.
Click the status bar item to enable it.`)));m&&d.push(mi({command:"remoteHub.indexMode.select",title:m,tooltip:v.join(`
`),arguments:[{uri:e}]}))}return d}}var ws;(function(t){let e;function r(){return e=_.window.createStatusBarItem(_.StatusBarAlignment.Right),e.text="$(compass)",e.command="remoteHub.indexMode.select",e.hide(),[e,_.window.onDidChangeActiveTextEditor(()=>{m()}),_.commands.registerCommand("remoteHub.indexMode.select",E=>{v(E).catch(P=>he.log("Selecting index mode failed.",P))})]}t.create=r;const n=new Map;function i(E){n.set(E.key(),E)}t.addService=i;function a(E){n.delete(E.key())}t.removeService=a;function l(E){return n.get(Oe(E))}async function d(E){for(const P of n.values())if(await P.handles(E))return P}async function m(){try{let E=function(M){const N=M.lastIndexOf("/");return N<=0?M:M.substr(N+1)};const P=_.window.activeTextEditor;if(P===void 0){e.hide();return}const R=await d(P.document);if(R===void 0){e.hide();return}const I=await R.isDocumentIndexed(P.document);I===zd.Indexed?(e.text="$(compass)",e.tooltip=new _.MarkdownString(Ir("isIndexed","The source file '{0}' is indexed and provides rich code navigation features like Go to Declaration and Find all References.",E(P.document.uri.path))),e.show()):I===zd.IndexMapped?(e.text="$(compass-dot)",e.tooltip=new _.MarkdownString(Ir("isIndexed","The source file '{0}' provides rich code navigation features using an earlier indexed commit. Navigation results might be fuzzy.",E(P.document.uri.path))),e.show()):e.hide()}catch(E){e.hide()}}t.updateStatusBarItem=m;async function v(E){const P=E.uri,R=l(P);if(R===void 0)return;const[I,M,N,B]=await Promise.all([R.getBranchName(),R.getMetadata(),R.getIndexMetadata(),R.getModeRefType(P)]);if(N===void 0||!Bt.hasIndex(N.type))return;let j,K=!1;const ee=fi.decode(P);(ee==null?void 0:ee.type)===jr.Latest||(ee==null?void 0:ee.type)===jr.SHA?(K=!0,j={display:W.Browse,index:ee.type===jr.Latest?$.Latest:$.Match}):j=R.getModeConfig(P,B);const te=Ir("current item","{0} current","$(check)"),fe={kind:"disable",label:Ir("RichNavStatus.disable.label","Disable"),description:j.index===$.None?`  \u2022  ${te}`:void 0,detail:Ir("RichNavStatus.disable.detail","Disable rich navigation. Files will be writable.")},$e=R.getUriMetadata();let Ae,Te;if(B===re.PullRequestBranch||B===re.PullRequestRemoteBranch||B===re.Commit||B===re.Tag){const qe={kind:"match",label:Ir("RichNavStatus.match.label","Current indexed commit - readonly"),description:j.index===$.Match&&j.display===W.Browse?`  \u2022  ${te}`:void 0,detail:Ir("RichNavStatus.match.detail","Enable rich navigation only if the current commit is indexed. Files will be read-only.")},De={kind:"match+writeable",label:Ir("RichNavStatus.matchWritable.label","Current indexed commit - writable"),description:j.index===$.Match&&j.display===W.Edit?`  \u2022  ${te}`:void 0,detail:Ir("RichNavStatus.match.detail","Enable rich navigation only if the current commit is indexed. Files will be writable.")};let Be=$e.provider.id===Dr.GitHub;Be&&(Be=M.HEAD.type===ct.RemoteBranch?M.HEAD.branch.remote.accessLevel>=Gt.Write:!0);const et=Be?[qe,De,fe]:[qe,fe];Te=await _.window.showQuickPick(et,{placeHolder:"Pick a rich navigation mode"})}else if(B===re.Branch||B===re.RemoteBranch){const qe={kind:"latest",label:Ir("RichNavStatus.latestIndexed.label","Latest indexed commit"),description:j.index===$.Latest?`  \u2022  ${te}`:void 0,detail:Ir("RichNavStatus.latestIndexed.detail","Enable rich navigation on the latest indexed commit. Files will be read-only.")},De={kind:"tip+latest",label:Ir("RichNavStatus.matchLatestIndexed.label","Current commit & latest index"),description:j.index===$.TipPlusLatest?`  \u2022  ${te}`:void 0,detail:Ir("RichNavStatus.matchLatestIndexed.detail","Enable rich navigation on the current commit using the latest index. Files will be writeable.")},Be=$e.provider.id===Dr.GitHub?[qe,De,fe]:[qe,fe];Te=await _.window.showQuickPick(Be,{placeHolder:Ir("RichNavStatus.placeHolder","Pick a rich navigation mode for branch {0}",I)})}if(Te!==void 0&&(Te.kind==="disable"?Ae={display:W.Edit,index:$.None}:Te.kind==="match"?Ae={display:W.Browse,index:$.Match}:Te.kind==="match+writeable"?Ae={display:W.Edit,index:$.Match}:Te.kind==="tip+latest"?Ae={display:W.Edit,index:$.TipPlusLatest}:Te.kind==="latest"&&(Ae={display:W.Browse,index:$.Latest}),Ae!==void 0&&!ne.equals(j,Ae))){if(await R.hasChanges()&&Ae.display===W.Browse){await _.window.showInformationMessage("The repository has outgoing changes. Commit them first before switching to browse mode.",{modal:!0,useCustom:!0});return}if(Ae.index===$.Latest){const qe=await R.getIndexedTip();if(qe===void 0)return;await R.sync(qe.hash)}else Ae.index===$.TipPlusLatest&&await R.sync();if(await Ne.setMode(P,Ae),K){const qe=await R.getNonIndexedWorkspaceDescriptor();qe!==void 0&&qn(qe)}else R.refresh()}}})(ws||(ws={}));class Gg{static createStatus(){return ws.create()}async createNavigationService(e,r,n){const i=await e.getIndexMetadata(r.uri);if(!(i===void 0||i.type===Bt.NotIndexed))return()=>new hf(e,r,n)}}var Ru;(function(t){const e=new RegExp("^vsck:\\/\\/([a-fA-F0-9]+)\\/(latest|[a-fA-F0-9]{15})\\/designtime\\/([a-fA-F0-9]+)(\\/?.*)$");function r(i){const a=e.exec(i);if(a===null||a.length!==5)return;const l={v:1,w:a[1],s:a[2],a:a[3]};return _.Uri.from({scheme:Io.scheme,authority:nt(JSON.stringify(l)),path:a[4]})}t.toVSCode=r;function n(i){if(i.scheme!==Io.scheme)return;let a;try{return a=JSON.parse(ft(i.authority)),a===void 0?void 0:{workspaceId:a.w,snapshotId:a.s,assetId:`${a.a}${i.path}`}}catch{return}}t.toRichNavComponents=n})(Ru||(Ru={}));const df=class{constructor(){this._onDidChangeFile=new _.EventEmitter,this.cache=new Ta(64),this.textEncoder=new TextEncoder}get onDidChangeFile(){return this._onDidChangeFile.event}watch(t,e){return df.emptyDisposable}async stat(t){const e=await this.getFile(t);if(e===void 0)throw _.FileSystemError.FileNotFound();return{type:_.FileType.File,mtime:e.time,ctime:e.time,size:e.content.length,permissions:_.FilePermission.Readonly}}readDirectory(t){return[]}createDirectory(t){throw _.FileSystemError.NoPermissions()}async readFile(t){const e=await this.getFile(t);if(e===void 0)throw _.FileSystemError.FileNotFound();return e.content}writeFile(t,e,r){throw _.FileSystemError.NoPermissions()}delete(t,e){throw _.FileSystemError.NoPermissions()}rename(t,e,r){throw _.FileSystemError.NoPermissions()}async getFile(t){let e=this.cache.get(t.toString());if(e!==void 0)return e;if(t.scheme!==df.scheme)return;const r=Ru.toRichNavComponents(t);if(r===void 0)return;const n=await Wn.getDesignTimeFileContent(r.workspaceId,r.snapshotId,r.assetId);if(n!==void 0)return e={content:this.textEncoder.encode(n),time:Date.now()},this.cache.set(t.toString(),e),e}};let Io=df;Io.scheme="vsck-fs",Io.emptyDisposable={dispose:()=>{}};var zd;(function(t){t[t.NotIndexed=0]="NotIndexed",t[t.IndexMapped=1]="IndexMapped",t[t.Indexed=2]="Indexed"})(zd||(zd={}));const Wi=class{static registerCapability(t,e,r){var n;const i=this.disabledCapabilities.get(t);if(i==null?void 0:i[e])return!1;const a=this.localCapabilities.get(t);return(a==null?void 0:a[e])?!1:(n=r[e])!=null?n:!1}constructor(t,e,r){this.providerService=t,this.repository=e,this.changeStore=r,this.repositoryRoot=`${e.uri.toString()}/`;const n=(i=!1)=>{const a=this.repository.uri;i||(this.metadata=this.providerService.getMetadata(a),this.indexMetadata=this.providerService.getIndexMetadata(a)),Promise.all([this.metadata,this.indexMetadata,this.providerService.getModeRefType(a,this.metadata)]).then(async l=>{const[d,m,v]=this.currentlyResolved,[E,P,R]=l,I=this.providerService.getModeConfig(a,R);if(d!==void 0&&m!==void 0&&v!==void 0&&d.HEAD.sha===E.HEAD.sha&&P!==void 0&&m.type===P.type&&v.index===I.index&&v.display===I.display){const M=(m==null?void 0:m.type)===Bt.Active?await m.sha:void 0,N=(P==null?void 0:P.type)===Bt.Active?await P.sha:void 0;if(M===N)return}this.currentlyResolved=[E,P,I];for(const M of this.registeredFeatures.values())M.dispose();if(this.registeredFeatures.clear(),this.pendingCapabilitiesRequests.clear(),this.currentListeners!==void 0&&this.currentListeners.dispose(),this.workspaceSnapshot=void 0,this.mapper=void 0,ga.isActive(P)){const M=qi.externalIndexUri(this.providerService,E),N=await P.sha;if(M!==void 0&&N!==void 0){const B=await kr.single(this.providerService.getAuthentication(a),M,N,Ao.getIndexBranchName(E));B!==void 0&&(this.workspaceSnapshot=B,this.currentListeners=this.installListeners(),((I==null?void 0:I.display)===W.Edit||E.HEAD.sha!==N)&&(this.mapper=new gg(this.providerService,a,N,E.HEAD.sha)))}}await ws.updateStatusBarItem()}).then(void 0,void 0)};this.metadata=this.providerService.getMetadata(this.repository.uri),this.indexMetadata=this.providerService.getIndexMetadata(this.repository.uri),this.currentlyResolved=[void 0,void 0,void 0],this.registeredFeatures=new Map,this.pendingCapabilitiesRequests=new Map,this.capabilitiesCache=new Ta(2048),this.knownDesignTimeFiles=new Set,this.providerService.onDidChangeRepository(i=>{Oe(i.repository.uri)===Oe(this.repository.uri)&&n()}),this.providerService.onDidRefresh(i=>{for(const a of i)if(Oe(a)===Oe(this.repository.uri)){n();break}}),n(!0),ws.addService(this),this.indexMetadata.then(async i=>{const a=this.repository.uri;let l=!1;const d=fi.decode(this.repository.uri);if(d!==void 0&&i!==void 0&&(d.type===jr.Latest&&i.type!==Bt.Active||d.type===jr.SHA&&(i.type!==Bt.Active||await i.sha!==d.sha))&&(l=!0),!l){const m=this.providerService.getModeConfig(a,await this.providerService.getModeRefType(a,this.metadata),!0);m!==void 0&&m.display===W.Browse&&i!==void 0&&m.index!==$.None&&i.type!==Bt.Active?l=!0:(i==null?void 0:i.type)===Bt.Active&&await i.sha===void 0&&((m==null?void 0:m.display)===W.Browse,l=!0)}l&&_.window.showWarningMessage(Ir("RichNavService.latest.notIndexed","The repository got opened in rich code navigation mode but no corresponding index is available. Rich code navigation features are disabled.")).then(void 0,void 0)},void 0),Wi.fileSystemProvider===void 0&&(Wi.fileSystemProvider=new Io,_.workspace.registerFileSystemProvider(Io.scheme,Wi.fileSystemProvider))}key(){return Oe(this.repository.uri)}dispose(){for(const t of this.registeredFeatures.values())t.dispose();this.registeredFeatures.clear(),ws.removeService(this)}handles(t){return t.uri.scheme!==Dt.scheme?Promise.resolve(!1):Promise.resolve(t.uri.toString().startsWith(this.repositoryRoot))}async getBranchName(){return Ao.getBranchName(await this.metadata)}async getMetadata(){return this.metadata}async getIndexMetadata(){return this.indexMetadata}getUriMetadata(){return this.providerService.getVirtualUriMetadata(this.repository.uri)}getModeConfig(t,e){return this.providerService.getModeConfig(t,e)}getModeRefType(t){return this.providerService.getModeRefType(t)}refresh(){return this.providerService.refresh()}async getNonIndexedWorkspaceDescriptor(){const{name:t,repo:e}=await this.metadata,{ref:r}=this.providerService.getVirtualUriMetadata(this.repository.uri);return{name:t,uri:this.providerService.createVirtualUri(this.repository.uri,{repo:e,ref:r}),location:nr.CurrentWindow}}async isDocumentIndexed(t){await this.metadata;const e=await this.indexMetadata;if(e===void 0||e.type===Bt.NotIndexed||this.workspaceSnapshot===void 0)return 0;const r=this.pendingCapabilitiesRequests.get(t.uri.toString());return r!==void 0&&await r,this.registeredFeatures.has(t.uri.toString())?this.mapper===void 0?2:await this.mapper.needsMapping(t)?1:2:0}async getIndexedTip(){const t=await this.metadata,e=qi.externalIndexUri(this.providerService,t),r=Ao.getIndexBranchName(t);if(e===void 0||r===void 0)return;const n=await kr.getIndexedTip(this.providerService.getAuthentication(this.repository.uri),e,r);if(n===void 0)return;const i=await xu.get(this.providerService,this.repository.uri,n.commitId);if(i!==void 0)return{...i,branchName:r}}hasChanges(){return this.changeStore.hasChanges(this.repository.uri)}sync(t){return this.providerService.sync(this.repository.uri,this.changeStore,{to:t,reason:"user"})}async getCommit(t){const e=await this.metadata,r=qi.externalIndexUri(this.providerService,e);if(r===void 0)return;const[n,i]=await Promise.all([xu.get(this.providerService,this.repository.uri,t),kr.single(this.providerService.getAuthentication(this.repository.uri),r,t)]);if(!(n===void 0||i===void 0))return{...n,branchName:i.branchName}}installListeners(){const t=[],e=async r=>{const n=r.uri.scheme;if(Dt.scheme!==n&&Io.scheme!==n)return;const i=r.uri.toString();if(n===Dt.scheme&&!i.startsWith(this.repositoryRoot)||n===Io.scheme&&!this.knownDesignTimeFiles.has(i)||this.pendingCapabilitiesRequests.has(i))return;const a=this.workspaceSnapshot!==void 0?this.workspaceSnapshot.commitId:void 0;if(a===void 0)return;let l=this.capabilitiesCache.get(i);if(l!==null){if(l===void 0){const d=this.capabilities(r.uri);this.pendingCapabilitiesRequests.set(i,d),l=await d,this.pendingCapabilitiesRequests.delete(i),this.capabilitiesCache.set(i,l===void 0?null:l)}l===void 0||!_.workspace.textDocuments.some(d=>d===r)||this.registerProviders(r,l,a)}};return t.push(_.workspace.onDidOpenTextDocument(e)),_.workspace.textDocuments.forEach(e),t.push(_.workspace.onDidCloseTextDocument(r=>{const n=r.uri.toString(),i=this.registeredFeatures.get(n);i!==void 0&&(this.registeredFeatures.delete(r.uri.toString()),i.dispose()),this.pendingCapabilitiesRequests.delete(n)})),_.Disposable.from(...t)}registerProviders(t,e,r){if(this.workspaceSnapshot===void 0)return;const n=this.workspaceSnapshot,i=t.languageId,l=[{scheme:this.repository.uri.scheme,pattern:t.uri.fsPath,language:t.languageId,exclusive:!0}],d=[],m=new Promise((I,M)=>{const N=`vsck://${n.workspaceId}/${n.snapshotId}/source/`;this.metadata.then(B=>{I(H0(j=>{const K=_.Uri.parse(j);if(B===void 0)return K;try{if(j.startsWith(N))return this.repository.createRelativeUri(j.substr(N.length));const ee=Ru.toVSCode(j);return ee!==void 0?(this.knownDesignTimeFiles.add(ee.toString()),ee):K}catch(ee){return K}}))},M)}),v=new RegExp(`^vsck:\\/\\/${n.workspaceId}\\/(?:latest|[a-fA-F0-9]{15})\\/designtime\\/(?:[a-fA-F0-9]+)(\\/?.*)$`);function E(I){const M=v.exec(I);return M===null||M.length===2}function P(I){if(I==null)return I;if(Array.isArray(I)){if(I.length===0)return[];const M=I[0];return typeof M.uri=="string"?I.filter(j=>E(j.uri)):typeof M.targetUri=="string"?I.filter(j=>E(j.targetUri)):[]}return v.exec(I.uri)===null?I:void 0}async function R(I,M,N){var B,j,K;if(N==null||I===void 0)return N;const ee=new Map(_.workspace.textDocuments.map(fe=>[fe.uri.toString(!0),fe]));if(Array.isArray(N)){const fe=[],$e=[];if(N.length===0)return[];for(const Ae of N){const Te=Ae;if(Te.uri instanceof _.Uri){const qe=await I.mapRangeFromIndexToCode((B=ee.get(Te.uri.toString()))!=null?B:Te.uri,Te.range);qe!==void 0&&fe.push(new _.Location(Te.uri,qe))}else{const qe=Ae,De=(j=ee.get(qe.targetUri.toString()))!=null?j:qe.targetUri,Be=qe.originSelectionRange?await I.mapRangeFromIndexToCode(M,qe.originSelectionRange):void 0;if(Be!==void 0||qe.originSelectionRange===void 0){const et=await I.mapRangeFromIndexToCode(De,qe.targetRange);if(et!==void 0){const cr=qe.targetSelectionRange?await I.mapRangeFromIndexToCode(De,qe.targetSelectionRange):void 0;(cr!==void 0||qe.targetSelectionRange===void 0)&&$e.push({targetUri:qe.targetUri,targetRange:et,targetSelectionRange:cr,originSelectionRange:Be})}}}}return fe.length>0?fe:$e}const te=await I.mapRangeFromIndexToCode((K=ee.get(N.uri.toString()))!=null?K:N.uri,N.range);if(te!==void 0)return new _.Location(N.uri,te)}Wi.registerCapability(i,"hoverProvider",e)&&d.push(_.languages.registerHoverProvider(l,{provideHover:async(I,M)=>{const N=await this.createTextDocumentPositionParams(I,M);if(N!==void 0)return(await m).asHover(await Wn.provideHover(this.providerService.getAuthentication(I.uri),r,N))}})),Wi.registerCapability(i,"definitionProvider",e)&&d.push(_.languages.registerDefinitionProvider(l,{provideDefinition:async(I,M)=>{const N=await this.createTextDocumentPositionParams(I,M);if(N!==void 0)return R(this.mapper,I,(await m).asDefinitionResult(P(await Wn.provideDefinition(this.providerService.getAuthentication(I.uri),r,N))))}})),Wi.registerCapability(i,"declarationProvider",e)&&d.push(_.languages.registerDeclarationProvider(l,{provideDeclaration:async(I,M)=>{const N=await this.createTextDocumentPositionParams(I,M);if(N!==void 0)return R(this.mapper,I,(await m).asDeclarationResult(P(await Wn.provideDeclaration(this.providerService.getAuthentication(I.uri),r,N))))}})),Wi.registerCapability(i,"typeDefinitionProvider",e)&&d.push(_.languages.registerTypeDefinitionProvider(l,{provideTypeDefinition:async(I,M)=>{const N=await this.createTextDocumentPositionParams(I,M);if(N!==void 0)return R(this.mapper,I,(await m).asDefinitionResult(P(await Wn.provideTypeDefinition(this.providerService.getAuthentication(I.uri),r,N))))}})),Wi.registerCapability(i,"referencesProvider",e)&&d.push(_.languages.registerReferenceProvider(l,{provideReferences:async(I,M,N)=>{const B=this.mapper!==void 0?await this.mapper.mapPositionFromCodeToIndex(I,M):M;if(B===void 0)return;const j={position:{line:B.line,character:B.character},textDocument:{uri:this.createRichNavDocumentUri(I.uri).toString(!0)},context:{includeDeclaration:N.includeDeclaration}};return R(this.mapper,I,(await m).asReferences(P(await Wn.provideReferences(this.providerService.getAuthentication(I.uri),r,j))))}})),Wi.registerCapability(i,"foldingRangeProvider",e)&&d.push(_.languages.registerFoldingRangeProvider(l,{provideFoldingRanges:async I=>{if(!(this.mapper!==void 0&&await this.mapper.needsMapping(I)))return(await m).asFoldingRanges(await Wn.providerFoldingRanges(this.providerService.getAuthentication(I.uri),r,this.createTextDocumentParams(I.uri)))}})),this.registeredFeatures.set(t.uri.toString(),_.Disposable.from(...d)),ws.updateStatusBarItem()}async capabilities(t){var e;const r=this.workspaceSnapshot!==void 0?this.workspaceSnapshot.commitId:void 0;if(r!==void 0)return(e=await Wn.capabilities(this.providerService.getAuthentication(t),r,this.createTextDocumentParams(t)))!=null?e:void 0}createTextDocumentParams(t){return{textDocument:{uri:this.createRichNavDocumentUri(t).toString(!0)}}}async createTextDocumentPositionParams(t,e){const r=this.mapper!==void 0?await this.mapper.mapPositionFromCodeToIndex(t,e):e;if(r!==void 0)return{position:{line:r.line,character:r.character},textDocument:{uri:this.createRichNavDocumentUri(t.uri).toString(!0)}}}createRichNavDocumentUri(t){if(t.scheme===Io.scheme){const n=Ru.toRichNavComponents(t);return n===void 0?t:_.Uri.file(n.assetId)}const e=this.repository.uri.toString(!0),r=t.toString(!0);return _.Uri.file(r.substr(e.length))}};let hf=Wi;hf.localCapabilities=new Map([["javascript",Object.assign(zi.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["javascriptreact",Object.assign(zi.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["typescript",Object.assign(zi.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["typescriptreact",Object.assign(zi.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})]]),hf.disabledCapabilities=new Map([["javascript",Object.assign(zi.create(),{declarationProvider:!0})],["javascriptreact",Object.assign(zi.create(),{declarationProvider:!0})],["typescript",Object.assign(zi.create(),{declarationProvider:!0})],["typescriptreact",Object.assign(zi.create(),{declarationProvider:!0})]]);class j0{constructor(e){this.providerService=e}async getMetadata(e){const r=this.providerService.getVirtualUriMetadata(e);if(r===void 0)return;const{provider:n,repo:i}=r;return{provider:{id:n.id,name:n.name},repo:i,getRevision:async()=>{const{HEAD:a}=await this.providerService.getMetadata(e);return{type:a.type,name:a.name,revision:a.sha}}}}getProvider(e){return this.providerService.getRegisteredProvider(e)}getProviderUri(e){return this.providerService.getProviderUri(e)}getProviderRootUri(e){return this.providerService.getProviderRootUri(e)}isProviderUri(e,r){return e.scheme!==Dt.scheme&&this.providerService.hasProvider(e,r)}getVirtualUri(e){return this.providerService.getVirtualUri(e)}getVirtualWorkspaceUri(e){return this.providerService.getVirtualWorkspaceUri(e)}}var q0=Object.defineProperty,z0=Object.getOwnPropertyDescriptor,ff=(t,e,r,n)=>{for(var i=n>1?void 0:n?z0(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&q0(e,r,i),i};const pf=_.FileSystemError.FileNotFound().code;class Wd{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChangeFile=new _.EventEmitter,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.disposable=_.Disposable.from(_.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0}),_.workspace.registerFileSearchProvider(this.scheme,this),_.workspace.registerTextSearchProvider(this.scheme,this),e.onDidChangeRepository(n=>{n.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([n.repository.uri])}),e.onDidRefresh(n=>this.onRefreshOrRepositoryChanged(n)),r.onDidChange(n=>{const i=n.map(a=>{switch(a.type){case Ot.Created:return{type:_.FileChangeType.Created,uri:a.uri};case Ot.Changed:return{type:_.FileChangeType.Changed,uri:a.uri};case Ot.Deleted:return{type:_.FileChangeType.Deleted,uri:a.uri}}});setTimeout(()=>this._onDidChangeFile.fire(i),0)}))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return Dt.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){e=e.filter(r=>r.scheme===this.scheme),e.length!==0&&(he.log(`fs.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.updateOpenOrWatchedUris(e))}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,a]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(l=>An(a,l))&&(this.implicitlyWatchedUris.delete(i),r.set(i,a));he.debug(`fs.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(Oe(i),i);const n=[...r.values()].map(i=>({type:_.FileChangeType.Changed,uri:i}));setTimeout(()=>{he.debug(`fs.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=Oe(e);this.watchedUris.set(n,e);const i=this.providerService.watch(this.providerService.getProviderUri(e),r);return{dispose:()=>{this.watchedUris.delete(n),i.dispose()}}}async stat(e){const r=new ce(`fs.stat(${e.toString()})`);let n;try{if(this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e),e)!==!1){if(r.logStep("ChangeStore query"),n=await this.changeStore.stat(e),n!==void 0)return n;r.logStep("Provider query",{message:": Not found \u2022",suffix:" \u2022 Querying provider..."})}else r.logStep("Provider query"),this.implicitlyWatchedUris.set(Oe(e),e);return n=await this.providerService.stat(this.providerService.getProviderUri(e)),n}finally{n===void 0&&this.implicitlyWatchedUris.delete(Oe(e)),r.stop()}}async readDirectory(e){const r=new ce(`fs.readDirectory(${e.toString()})`);this.implicitlyWatchedUris.set(Oe(e),e);try{r.logStep("Provider query");let n=await this.providerService.readDirectory(this.providerService.getProviderUri(e));return this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e))!==!1&&(r.logStep("Applying changes",{suffix:" \u2022 Applying changes..."}),n=await this.changeStore.updateDirectoryEntries(e,n)),n}finally{r.stop()}}async createDirectory(e){const r=new ce(`fs.createDirectory(${e.toString()})`);try{await this.changeStore.createDirectory(e)}catch(n){throw he.error(n,r.context),n}finally{r.stop()}}async readFile(e){const r=new ce(`fs.readFile(${e.toString()})`),n=Oe(e);let i;try{if(this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e),e)!==!1){r.logStep("ChangeStore query");const a=await this.changeStore.readFile(e);if(a!==void 0)return a;r.logStep("Provider query",{message:": Not found \u2022",suffix:" \u2022 Querying provider..."})}else r.logStep("Provider query"),this.implicitlyWatchedUris.set(n,e);return i=await this.providerService.readFile(this.providerService.getProviderUri(e)),i}finally{i===void 0&&this.implicitlyWatchedUris.delete(n),r.stop()}}async writeFile(e,r,n){const i=new ce(`fs.writeFile(${e.toString()})`,{},r.length,n);try{let a;try{if(a=await this.stat(e),!n.overwrite)throw _.FileSystemError.FileExists()}catch(l){if(l instanceof _.FileSystemError&&l.code===pf){if(!n.create)throw _.FileSystemError.FileNotFound(e)}else throw l}try{if(a===void 0)await this.changeStore.createFile(e,r);else{i.logStep("Provider original query");let l;try{l=await this.providerService.readFile(this.providerService.getProviderUri(e))}catch(d){if(d instanceof _.FileSystemError&&d.code===pf)l=new Uint8Array;else throw d}i.logStep("Writing file",{suffix:" \u2022 Writing file to Change Store..."}),await this.changeStore.writeFile(e,r,l)}}catch(l){throw he.error(l,i.context),l}}finally{i.stop()}}async delete(e,r){const n=new ce(`fs.delete(${e.toString()})`,{},r);try{switch((await this.stat(e)).type){case _.FileType.File:await this.changeStore.deleteFile(e);break;case _.FileType.Directory:{await this.deleteDirectory(e,r);break}default:throw _.FileSystemError.NoPermissions()}}catch(i){throw he.error(i,n.context),i}finally{n.stop()}}async deleteDirectory(e,r){const n=new ce(`fs.deleteDirectory(${e.toString()})`,{},r);try{const i=await this.readDirectory(e);if(i.length!==0){if(!r.recursive&&i.some(([,a])=>a===_.FileType.Directory))throw _.FileSystemError.NoPermissions();for(const[a,l]of i)l===_.FileType.Directory?await this.deleteDirectory(_.Uri.joinPath(e,a),r):await this.changeStore.deleteFile(_.Uri.joinPath(e,a))}await this.changeStore.deleteDirectory(e)}catch(i){throw he.error(i,n.context),i}finally{n.stop()}}async rename(e,r,n){const i=new ce(`fs.rename(${e.toString()} -> ${r.toString()})`,{},n);try{switch((await this.stat(e)).type){case _.FileType.File:{const l=await this.readFile(e);await this.writeFile(r,l,{create:!0,overwrite:n.overwrite}),await this.delete(e,{recursive:!1});break}case _.FileType.Directory:{await this.renameDirectory(e,r,n);break}default:throw _.FileSystemError.NoPermissions()}}catch(a){throw he.error(a,i.context),a}finally{i.stop()}}async renameDirectory(e,r,n){const i=new ce(`fs.renameDirectory(${e.toString()} -> ${r.toString()})`,{},n);try{await this.copyDirectory(e,r,n),await this.delete(e,{recursive:!0})}catch(a){throw he.error(a,i.context),a}finally{i.stop()}}async copy(e,r,n){const i=new ce(`fs.copy(${e.toString()} -> ${r.toString()})`,{},n);try{switch((await this.stat(e)).type){case _.FileType.File:{const l=await this.readFile(e);await this.writeFile(r,l,{create:!0,overwrite:n.overwrite});break}case _.FileType.Directory:{await this.copyDirectory(e,r,n);break}default:throw _.FileSystemError.NoPermissions()}}catch(a){throw he.error(a,i.context),a}finally{i.stop()}}async copyDirectory(e,r,n){const i=new ce(`fs.copyDirectory(${e.toString()} -> ${r.toString()})`,{},n);try{if(await this.exists(r))throw _.FileSystemError.FileExists();try{await this.createDirectory(r);const a=await this.readDirectory(e);for(const[l,d]of a)d===_.FileType.Directory?await this.copyDirectory(_.Uri.joinPath(e,l),_.Uri.joinPath(r,l),n):await this.copy(_.Uri.joinPath(e,l),_.Uri.joinPath(r,l),n)}catch(a){throw he.error(a,i.context),a}}finally{i.stop()}}async exists(e){try{return await this.stat(e),!0}catch(r){if(r instanceof _.FileSystemError&&r.code===pf)return!1;throw r}}async provideFileSearchResults(e,r,n){var i;const a=new ce(`fs.provideFileSearchResults(${e.pattern}, ${r.folder.toString()})`,{logLevel:dt.Debug});let l;try{return l=await this.providerService.provideFileSearchResults(e,{...r,folder:this.providerService.getProviderUri(r.folder)},n),l==null?void 0:l.map(d=>this.providerService.getVirtualUri(d))}catch(d){throw he.error(d,a.context),d}finally{a.stop({suffix:` \u2022 ${(i=l==null?void 0:l.length)!=null?i:0} results found`})}}provideTextSearchResults(e,r,n,i){return this.providerService.provideTextSearchResults(e,{...r,folder:this.providerService.getProviderUri(r.folder)},{report:a=>n.report({...a,uri:this.providerService.getVirtualUri(a.uri)})},i)}}ff([yn()],Wd.prototype,"stat",1),ff([yn()],Wd.prototype,"readDirectory",1),ff([yn()],Wd.prototype,"readFile",1);function W0(t){return t.replace(/[-\\{}*+?|^$.[\]()#]/g,"\\$&")}function G0(t,e,r={}){if(!t)throw new Error("Cannot create regex from empty string");e||(t=W0(t)),r.wholeWord&&(/\B/.test(t.charAt(0))||(t=`\\b${t}`),/\B/.test(t.charAt(t.length-1))||(t=`${t}\\b`));let n="gmu";return r.matchCase||(n+="i"),new RegExp(t,n)}let Vg,Kg,gf;const V0=(t,e,r,n)=>{const i=`${e.join("--")};;;;${r.join("--")}`,a=t.map(d=>d.path).join("::");if(Vg===a&&i==Kg&&gf)return gf;const l=Qh((n?t.filter(d=>d.size<n):t).map(d=>d.path),e,r);return Vg=a,Kg=i,gf=l,l},K0=(t,e,r,n)=>{var i;const a=[];let l;if(typeof t=="string")l=t;else{const E=t;if(E[0]==255&&E[1]==254)l=new TextDecoder("utf-16le").decode(E);else if(E[0]==254&&E[1]==255)l=new TextDecoder("utf-16be").decode(E);else if(l=new TextDecoder("utf8").decode(E),l.slice(0,1e3).includes("\uFFFD")&&E.includes(0))return[]}const d=[];let m=null,v=n.remainingResultQuota;for(;v>=0&&(m=r.exec(l));)d.push({matchStartIndex:m.index,matchedText:m[0]}),v--;if(d.length){const E=new Set,P=new Set,R=[],I=K=>l.slice(R[K].start,R[K].end);let M=0,N=null;const B=/\r?\n/g;for(;N=B.exec(l);)R.push({start:M,end:N.index}),M=N.index+N[0].length;M<l.length&&R.push({start:M,end:l.length});let j=0;for(const{matchStartIndex:K,matchedText:ee}of d){if(v<0)break;for(;Boolean(R[j+1])&&K>R[j].end;)j++;let te=j;for(;Boolean(R[te+1])&&K+ee.length>R[te].end;)te++;if(n.beforeContext)for(let De=Math.max(0,j-n.beforeContext);De<j;De++)E.add(De);let fe="",$e=0;for(let De=j;De<=te;De++){let Be=I(De);((i=n.previewOptions)==null?void 0:i.charsPerLine)&&Be.length>n.previewOptions.charsPerLine&&($e=Math.max(K-R[j].start-20,0),Be=Be.substr($e,n.previewOptions.charsPerLine)),fe+=`${Be}
`,P.add(De)}const Ae=new _.Range(j,K-R[j].start,te,K+ee.length-R[te].start),Te=new _.Range(0,K-R[j].start-$e,te-j,K+ee.length-R[te].start-(te===j?$e:0)),qe={uri:_.Uri.file(e),ranges:Ae,preview:{text:fe,matches:Te}};if(a.push(qe),n.afterContext)for(let De=te+1;De<=Math.min(te+n.afterContext,R.length-1);De++)E.add(De)}for(const K of E)P.has(K)||a.push({uri:_.Uri.file(e),text:I(K),lineNumber:K+1})}return a};var Q0=__webpack_require__(5790);/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */const X0=4,Qg=0,Xg=1,Y0=2;function Bc(t){let e=t.length;for(;--e>=0;)t[e]=0}const Z0=0,Yg=1,J0=2,e_=3,t_=258,mf=29,Au=256,Iu=Au+1+mf,Hc=30,vf=19,Zg=2*Iu+1,Ss=15,yf=16,r_=7,_f=256,Jg=16,em=17,tm=18,bf=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Gd=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),n_=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),rm=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i_=512,Po=new Array((Iu+2)*2);Bc(Po);const Pu=new Array(Hc*2);Bc(Pu);const Ou=new Array(i_);Bc(Ou);const Du=new Array(t_-e_+1);Bc(Du);const wf=new Array(mf);Bc(wf);const Vd=new Array(Hc);Bc(Vd);function Sf(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let nm,im,om;function Ef(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const am=t=>t<256?Ou[t]:Ou[256+(t>>>7)],ku=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},wn=(t,e,r)=>{t.bi_valid>yf-r?(t.bi_buf|=e<<t.bi_valid&65535,ku(t,t.bi_buf),t.bi_buf=e>>yf-t.bi_valid,t.bi_valid+=r-yf):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},Gi=(t,e,r)=>{wn(t,r[e*2],r[e*2+1])},sm=(t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},o_=t=>{t.bi_valid===16?(ku(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},a_=(t,e)=>{const r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,m=e.stat_desc.max_length;let v,E,P,R,I,M,N=0;for(R=0;R<=Ss;R++)t.bl_count[R]=0;for(r[t.heap[t.heap_max]*2+1]=0,v=t.heap_max+1;v<Zg;v++)E=t.heap[v],R=r[r[E*2+1]*2+1]+1,R>m&&(R=m,N++),r[E*2+1]=R,!(E>n)&&(t.bl_count[R]++,I=0,E>=d&&(I=l[E-d]),M=r[E*2],t.opt_len+=M*(R+I),a&&(t.static_len+=M*(i[E*2+1]+I)));if(N!==0){do{for(R=m-1;t.bl_count[R]===0;)R--;t.bl_count[R]--,t.bl_count[R+1]+=2,t.bl_count[m]--,N-=2}while(N>0);for(R=m;R!==0;R--)for(E=t.bl_count[R];E!==0;)P=t.heap[--v],!(P>n)&&(r[P*2+1]!==R&&(t.opt_len+=(R-r[P*2+1])*r[P*2],r[P*2+1]=R),E--)}},cm=(t,e,r)=>{const n=new Array(Ss+1);let i=0,a,l;for(a=1;a<=Ss;a++)n[a]=i=i+r[a-1]<<1;for(l=0;l<=e;l++){let d=t[l*2+1];d!==0&&(t[l*2]=sm(n[d]++,d))}},s_=()=>{let t,e,r,n,i;const a=new Array(Ss+1);for(r=0,n=0;n<mf-1;n++)for(wf[n]=r,t=0;t<1<<bf[n];t++)Du[r++]=n;for(Du[r-1]=n,i=0,n=0;n<16;n++)for(Vd[n]=i,t=0;t<1<<Gd[n];t++)Ou[i++]=n;for(i>>=7;n<Hc;n++)for(Vd[n]=i<<7,t=0;t<1<<Gd[n]-7;t++)Ou[256+i++]=n;for(e=0;e<=Ss;e++)a[e]=0;for(t=0;t<=143;)Po[t*2+1]=8,t++,a[8]++;for(;t<=255;)Po[t*2+1]=9,t++,a[9]++;for(;t<=279;)Po[t*2+1]=7,t++,a[7]++;for(;t<=287;)Po[t*2+1]=8,t++,a[8]++;for(cm(Po,Iu+1,a),t=0;t<Hc;t++)Pu[t*2+1]=5,Pu[t*2]=sm(t,5);nm=new Sf(Po,bf,Au+1,Iu,Ss),im=new Sf(Pu,Gd,0,Hc,Ss),om=new Sf(new Array(0),n_,0,vf,r_)},lm=t=>{let e;for(e=0;e<Iu;e++)t.dyn_ltree[e*2]=0;for(e=0;e<Hc;e++)t.dyn_dtree[e*2]=0;for(e=0;e<vf;e++)t.bl_tree[e*2]=0;t.dyn_ltree[_f*2]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},um=t=>{t.bi_valid>8?ku(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},c_=(t,e,r,n)=>{um(t),n&&(ku(t,r),ku(t,~r)),t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},dm=(t,e,r,n)=>{const i=e*2,a=r*2;return t[i]<t[a]||t[i]===t[a]&&n[e]<=n[r]},Cf=(t,e,r)=>{const n=t.heap[r];let i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&dm(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!dm(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},hm=(t,e,r)=>{let n,i,a=0,l,d;if(t.last_lit!==0)do n=t.pending_buf[t.d_buf+a*2]<<8|t.pending_buf[t.d_buf+a*2+1],i=t.pending_buf[t.l_buf+a],a++,n===0?Gi(t,i,e):(l=Du[i],Gi(t,l+Au+1,e),d=bf[l],d!==0&&(i-=wf[l],wn(t,i,d)),n--,l=am(n),Gi(t,l,r),d=Gd[l],d!==0&&(n-=Vd[l],wn(t,n,d)));while(a<t.last_lit);Gi(t,_f,e)},Tf=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,a=e.stat_desc.elems;let l,d,m=-1,v;for(t.heap_len=0,t.heap_max=Zg,l=0;l<a;l++)r[l*2]!==0?(t.heap[++t.heap_len]=m=l,t.depth[l]=0):r[l*2+1]=0;for(;t.heap_len<2;)v=t.heap[++t.heap_len]=m<2?++m:0,r[v*2]=1,t.depth[v]=0,t.opt_len--,i&&(t.static_len-=n[v*2+1]);for(e.max_code=m,l=t.heap_len>>1;l>=1;l--)Cf(t,r,l);v=a;do l=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Cf(t,r,1),d=t.heap[1],t.heap[--t.heap_max]=l,t.heap[--t.heap_max]=d,r[v*2]=r[l*2]+r[d*2],t.depth[v]=(t.depth[l]>=t.depth[d]?t.depth[l]:t.depth[d])+1,r[l*2+1]=r[d*2+1]=v,t.heap[1]=v++,Cf(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],a_(t,e),cm(r,m,t.bl_count)},fm=(t,e,r)=>{let n,i=-1,a,l=e[0*2+1],d=0,m=7,v=4;for(l===0&&(m=138,v=3),e[(r+1)*2+1]=65535,n=0;n<=r;n++)a=l,l=e[(n+1)*2+1],!(++d<m&&a===l)&&(d<v?t.bl_tree[a*2]+=d:a!==0?(a!==i&&t.bl_tree[a*2]++,t.bl_tree[Jg*2]++):d<=10?t.bl_tree[em*2]++:t.bl_tree[tm*2]++,d=0,i=a,l===0?(m=138,v=3):a===l?(m=6,v=3):(m=7,v=4))},pm=(t,e,r)=>{let n,i=-1,a,l=e[0*2+1],d=0,m=7,v=4;for(l===0&&(m=138,v=3),n=0;n<=r;n++)if(a=l,l=e[(n+1)*2+1],!(++d<m&&a===l)){if(d<v)do Gi(t,a,t.bl_tree);while(--d!=0);else a!==0?(a!==i&&(Gi(t,a,t.bl_tree),d--),Gi(t,Jg,t.bl_tree),wn(t,d-3,2)):d<=10?(Gi(t,em,t.bl_tree),wn(t,d-3,3)):(Gi(t,tm,t.bl_tree),wn(t,d-11,7));d=0,i=a,l===0?(m=138,v=3):a===l?(m=6,v=3):(m=7,v=4)}},l_=t=>{let e;for(fm(t,t.dyn_ltree,t.l_desc.max_code),fm(t,t.dyn_dtree,t.d_desc.max_code),Tf(t,t.bl_desc),e=vf-1;e>=3&&t.bl_tree[rm[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},u_=(t,e,r,n)=>{let i;for(wn(t,e-257,5),wn(t,r-1,5),wn(t,n-4,4),i=0;i<n;i++)wn(t,t.bl_tree[rm[i]*2+1],3);pm(t,t.dyn_ltree,e-1),pm(t,t.dyn_dtree,r-1)},d_=t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return Qg;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Xg;for(r=32;r<Au;r++)if(t.dyn_ltree[r*2]!==0)return Xg;return Qg};let gm=!1;const h_=t=>{gm||(s_(),gm=!0),t.l_desc=new Ef(t.dyn_ltree,nm),t.d_desc=new Ef(t.dyn_dtree,im),t.bl_desc=new Ef(t.bl_tree,om),t.bi_buf=0,t.bi_valid=0,lm(t)},mm=(t,e,r,n)=>{wn(t,(Z0<<1)+(n?1:0),3),c_(t,e,r,!0)},f_=t=>{wn(t,Yg<<1,3),Gi(t,_f,Po),o_(t)},p_=(t,e,r,n)=>{let i,a,l=0;t.level>0?(t.strm.data_type===Y0&&(t.strm.data_type=d_(t)),Tf(t,t.l_desc),Tf(t,t.d_desc),l=l_(t),i=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=i&&(i=a)):i=a=r+5,r+4<=i&&e!==-1?mm(t,e,r,n):t.strategy===X0||a===i?(wn(t,(Yg<<1)+(n?1:0),3),hm(t,Po,Pu)):(wn(t,(J0<<1)+(n?1:0),3),u_(t,t.l_desc.max_code+1,t.d_desc.max_code+1,l+1),hm(t,t.dyn_ltree,t.dyn_dtree)),lm(t),n&&um(t)},g_=(t,e,r)=>(t.pending_buf[t.d_buf+t.last_lit*2]=e>>>8&255,t.pending_buf[t.d_buf+t.last_lit*2+1]=e&255,t.pending_buf[t.l_buf+t.last_lit]=r&255,t.last_lit++,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(Du[r]+Au+1)*2]++,t.dyn_dtree[am(e)*2]++),t.last_lit===t.lit_bufsize-1);var m_=h_,v_=mm,y_=p_,__=g_,b_=f_,w_={_tr_init:m_,_tr_stored_block:v_,_tr_flush_block:y_,_tr_tally:__,_tr_align:b_},Nu=(t,e,r,n)=>{let i=t&65535|0,a=t>>>16&65535|0,l=0;for(;r!==0;){l=r>2e3?2e3:r,r-=l;do i=i+e[n++]|0,a=a+i|0;while(--l);i%=65521,a%=65521}return i|a<<16|0};const S_=()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},E_=new Uint32Array(S_());var $r=(t,e,r,n)=>{const i=E_,a=n+r;t^=-1;for(let l=n;l<a;l++)t=t>>>8^i[(t^e[l])&255];return t^-1},Es={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Cs={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:C_,_tr_stored_block:T_,_tr_flush_block:x_,_tr_tally:Ia,_tr_align:R_}=w_,{Z_NO_FLUSH:Ts,Z_PARTIAL_FLUSH:A_,Z_FULL_FLUSH:I_,Z_FINISH:Pa,Z_BLOCK:vm,Z_OK:Vi,Z_STREAM_END:ym,Z_STREAM_ERROR:Gn,Z_DATA_ERROR:P_,Z_BUF_ERROR:xf,Z_DEFAULT_COMPRESSION:O_,Z_FILTERED:D_,Z_HUFFMAN_ONLY:Kd,Z_RLE:k_,Z_FIXED:N_,Z_DEFAULT_STRATEGY:M_,Z_UNKNOWN:L_,Z_DEFLATED:Qd}=Cs,F_=9,$_=15,B_=8,H_=29,Rf=256+1+H_,U_=30,j_=19,q_=2*Rf+1,z_=15,Qt=3,Oa=258,_i=Oa+Qt+1,W_=32,Xd=42,Af=69,Yd=73,Zd=91,Jd=103,xs=113,Mu=666,Nr=1,Lu=2,Rs=3,Uc=4,G_=3,Da=(t,e)=>(t.msg=Es[e],e),_m=t=>(t<<1)-(t>4?9:0),ka=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let Na=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const Ma=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},Vr=(t,e)=>{x_(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Ma(t.strm)},Jt=(t,e)=>{t.pending_buf[t.pending++]=e},Fu=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},V_=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),t.state.wrap===1?t.adler=Nu(t.adler,e,i,r):t.state.wrap===2&&(t.adler=$r(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},bm=(t,e)=>{let r=t.max_chain_length,n=t.strstart,i,a,l=t.prev_length,d=t.nice_match;const m=t.strstart>t.w_size-_i?t.strstart-(t.w_size-_i):0,v=t.window,E=t.w_mask,P=t.prev,R=t.strstart+Oa;let I=v[n+l-1],M=v[n+l];t.prev_length>=t.good_match&&(r>>=2),d>t.lookahead&&(d=t.lookahead);do if(i=e,!(v[i+l]!==M||v[i+l-1]!==I||v[i]!==v[n]||v[++i]!==v[n+1])){n+=2,i++;do;while(v[++n]===v[++i]&&v[++n]===v[++i]&&v[++n]===v[++i]&&v[++n]===v[++i]&&v[++n]===v[++i]&&v[++n]===v[++i]&&v[++n]===v[++i]&&v[++n]===v[++i]&&n<R);if(a=Oa-(R-n),n=R-Oa,a>l){if(t.match_start=e,l=a,a>=d)break;I=v[n+l-1],M=v[n+l]}}while((e=P[e&E])>m&&--r!=0);return l<=t.lookahead?l:t.lookahead},As=t=>{const e=t.w_size;let r,n,i,a,l;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-_i)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,n=t.hash_size,r=n;do i=t.head[--r],t.head[r]=i>=e?i-e:0;while(--n);n=e,r=n;do i=t.prev[--r],t.prev[r]=i>=e?i-e:0;while(--n);a+=e}if(t.strm.avail_in===0)break;if(n=V_(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=n,t.lookahead+t.insert>=Qt)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=Na(t,t.ins_h,t.window[l+1]);t.insert&&(t.ins_h=Na(t,t.ins_h,t.window[l+Qt-1]),t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<Qt)););}while(t.lookahead<_i&&t.strm.avail_in!==0)},K_=(t,e)=>{let r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(As(t),t.lookahead===0&&e===Ts)return Nr;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;const n=t.block_start+r;if((t.strstart===0||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,Vr(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-_i&&(Vr(t,!1),t.strm.avail_out===0))return Nr}return t.insert=0,e===Pa?(Vr(t,!0),t.strm.avail_out===0?Rs:Uc):(t.strstart>t.block_start&&(Vr(t,!1),t.strm.avail_out===0),Nr)},If=(t,e)=>{let r,n;for(;;){if(t.lookahead<_i){if(As(t),t.lookahead<_i&&e===Ts)return Nr;if(t.lookahead===0)break}if(r=0,t.lookahead>=Qt&&(t.ins_h=Na(t,t.ins_h,t.window[t.strstart+Qt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-_i&&(t.match_length=bm(t,r)),t.match_length>=Qt)if(n=Ia(t,t.strstart-t.match_start,t.match_length-Qt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Qt){t.match_length--;do t.strstart++,t.ins_h=Na(t,t.ins_h,t.window[t.strstart+Qt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Na(t,t.ins_h,t.window[t.strstart+1]);else n=Ia(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Vr(t,!1),t.strm.avail_out===0))return Nr}return t.insert=t.strstart<Qt-1?t.strstart:Qt-1,e===Pa?(Vr(t,!0),t.strm.avail_out===0?Rs:Uc):t.last_lit&&(Vr(t,!1),t.strm.avail_out===0)?Nr:Lu},jc=(t,e)=>{let r,n,i;for(;;){if(t.lookahead<_i){if(As(t),t.lookahead<_i&&e===Ts)return Nr;if(t.lookahead===0)break}if(r=0,t.lookahead>=Qt&&(t.ins_h=Na(t,t.ins_h,t.window[t.strstart+Qt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Qt-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-_i&&(t.match_length=bm(t,r),t.match_length<=5&&(t.strategy===D_||t.match_length===Qt&&t.strstart-t.match_start>4096)&&(t.match_length=Qt-1)),t.prev_length>=Qt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Qt,n=Ia(t,t.strstart-1-t.prev_match,t.prev_length-Qt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Na(t,t.ins_h,t.window[t.strstart+Qt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=Qt-1,t.strstart++,n&&(Vr(t,!1),t.strm.avail_out===0))return Nr}else if(t.match_available){if(n=Ia(t,0,t.window[t.strstart-1]),n&&Vr(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Nr}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=Ia(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Qt-1?t.strstart:Qt-1,e===Pa?(Vr(t,!0),t.strm.avail_out===0?Rs:Uc):t.last_lit&&(Vr(t,!1),t.strm.avail_out===0)?Nr:Lu},Q_=(t,e)=>{let r,n,i,a;const l=t.window;for(;;){if(t.lookahead<=Oa){if(As(t),t.lookahead<=Oa&&e===Ts)return Nr;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Qt&&t.strstart>0&&(i=t.strstart-1,n=l[i],n===l[++i]&&n===l[++i]&&n===l[++i])){a=t.strstart+Oa;do;while(n===l[++i]&&n===l[++i]&&n===l[++i]&&n===l[++i]&&n===l[++i]&&n===l[++i]&&n===l[++i]&&n===l[++i]&&i<a);t.match_length=Oa-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Qt?(r=Ia(t,1,t.match_length-Qt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=Ia(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(Vr(t,!1),t.strm.avail_out===0))return Nr}return t.insert=0,e===Pa?(Vr(t,!0),t.strm.avail_out===0?Rs:Uc):t.last_lit&&(Vr(t,!1),t.strm.avail_out===0)?Nr:Lu},X_=(t,e)=>{let r;for(;;){if(t.lookahead===0&&(As(t),t.lookahead===0)){if(e===Ts)return Nr;break}if(t.match_length=0,r=Ia(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(Vr(t,!1),t.strm.avail_out===0))return Nr}return t.insert=0,e===Pa?(Vr(t,!0),t.strm.avail_out===0?Rs:Uc):t.last_lit&&(Vr(t,!1),t.strm.avail_out===0)?Nr:Lu};function Ki(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}const $u=[new Ki(0,0,0,0,K_),new Ki(4,4,8,4,If),new Ki(4,5,16,8,If),new Ki(4,6,32,32,If),new Ki(4,4,16,16,jc),new Ki(8,16,32,32,jc),new Ki(8,16,128,128,jc),new Ki(8,32,128,256,jc),new Ki(32,128,258,1024,jc),new Ki(32,258,258,4096,jc)],Y_=t=>{t.window_size=2*t.w_size,ka(t.head),t.max_lazy_match=$u[t.level].max_lazy,t.good_match=$u[t.level].good_length,t.nice_match=$u[t.level].nice_length,t.max_chain_length=$u[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Qt-1,t.match_available=0,t.ins_h=0};function Z_(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Qd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(q_*2),this.dyn_dtree=new Uint16Array((2*U_+1)*2),this.bl_tree=new Uint16Array((2*j_+1)*2),ka(this.dyn_ltree),ka(this.dyn_dtree),ka(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(z_+1),this.heap=new Uint16Array(2*Rf+1),ka(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Rf+1),ka(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const wm=t=>{if(!t||!t.state)return Da(t,Gn);t.total_in=t.total_out=0,t.data_type=L_;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Xd:xs,t.adler=e.wrap===2?0:1,e.last_flush=Ts,C_(e),Vi},Sm=t=>{const e=wm(t);return e===Vi&&Y_(t.state),e},J_=(t,e)=>!t||!t.state||t.state.wrap!==2?Gn:(t.state.gzhead=e,Vi),Em=(t,e,r,n,i,a)=>{if(!t)return Gn;let l=1;if(e===O_&&(e=6),n<0?(l=0,n=-n):n>15&&(l=2,n-=16),i<1||i>F_||r!==Qd||n<8||n>15||e<0||e>9||a<0||a>N_)return Da(t,Gn);n===8&&(n=9);const d=new Z_;return t.state=d,d.strm=t,d.wrap=l,d.gzhead=null,d.w_bits=n,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=i+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+Qt-1)/Qt),d.window=new Uint8Array(d.w_size*2),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<i+6,d.pending_buf_size=d.lit_bufsize*4,d.pending_buf=new Uint8Array(d.pending_buf_size),d.d_buf=1*d.lit_bufsize,d.l_buf=(1+2)*d.lit_bufsize,d.level=e,d.strategy=a,d.method=r,Sm(t)},eb=(t,e)=>Em(t,e,Qd,$_,B_,M_),tb=(t,e)=>{let r,n;if(!t||!t.state||e>vm||e<0)return t?Da(t,Gn):Gn;const i=t.state;if(!t.output||!t.input&&t.avail_in!==0||i.status===Mu&&e!==Pa)return Da(t,t.avail_out===0?xf:Gn);i.strm=t;const a=i.last_flush;if(i.last_flush=e,i.status===Xd)if(i.wrap===2)t.adler=0,Jt(i,31),Jt(i,139),Jt(i,8),i.gzhead?(Jt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Jt(i,i.gzhead.time&255),Jt(i,i.gzhead.time>>8&255),Jt(i,i.gzhead.time>>16&255),Jt(i,i.gzhead.time>>24&255),Jt(i,i.level===9?2:i.strategy>=Kd||i.level<2?4:0),Jt(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(Jt(i,i.gzhead.extra.length&255),Jt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=$r(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=Af):(Jt(i,0),Jt(i,0),Jt(i,0),Jt(i,0),Jt(i,0),Jt(i,i.level===9?2:i.strategy>=Kd||i.level<2?4:0),Jt(i,G_),i.status=xs);else{let l=Qd+(i.w_bits-8<<4)<<8,d=-1;i.strategy>=Kd||i.level<2?d=0:i.level<6?d=1:i.level===6?d=2:d=3,l|=d<<6,i.strstart!==0&&(l|=W_),l+=31-l%31,i.status=xs,Fu(i,l),i.strstart!==0&&(Fu(i,t.adler>>>16),Fu(i,t.adler&65535)),t.adler=1}if(i.status===Af)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=$r(t.adler,i.pending_buf,i.pending-r,r)),Ma(t),r=i.pending,i.pending===i.pending_buf_size));)Jt(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(t.adler=$r(t.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Yd)}else i.status=Yd;if(i.status===Yd)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=$r(t.adler,i.pending_buf,i.pending-r,r)),Ma(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,Jt(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(t.adler=$r(t.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.gzindex=0,i.status=Zd)}else i.status=Zd;if(i.status===Zd)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=$r(t.adler,i.pending_buf,i.pending-r,r)),Ma(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,Jt(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(t.adler=$r(t.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.status=Jd)}else i.status=Jd;if(i.status===Jd&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Ma(t),i.pending+2<=i.pending_buf_size&&(Jt(i,t.adler&255),Jt(i,t.adler>>8&255),t.adler=0,i.status=xs)):i.status=xs),i.pending!==0){if(Ma(t),t.avail_out===0)return i.last_flush=-1,Vi}else if(t.avail_in===0&&_m(e)<=_m(a)&&e!==Pa)return Da(t,xf);if(i.status===Mu&&t.avail_in!==0)return Da(t,xf);if(t.avail_in!==0||i.lookahead!==0||e!==Ts&&i.status!==Mu){let l=i.strategy===Kd?X_(i,e):i.strategy===k_?Q_(i,e):$u[i.level].func(i,e);if((l===Rs||l===Uc)&&(i.status=Mu),l===Nr||l===Rs)return t.avail_out===0&&(i.last_flush=-1),Vi;if(l===Lu&&(e===A_?R_(i):e!==vm&&(T_(i,0,0,!1),e===I_&&(ka(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Ma(t),t.avail_out===0))return i.last_flush=-1,Vi}return e!==Pa?Vi:i.wrap<=0?ym:(i.wrap===2?(Jt(i,t.adler&255),Jt(i,t.adler>>8&255),Jt(i,t.adler>>16&255),Jt(i,t.adler>>24&255),Jt(i,t.total_in&255),Jt(i,t.total_in>>8&255),Jt(i,t.total_in>>16&255),Jt(i,t.total_in>>24&255)):(Fu(i,t.adler>>>16),Fu(i,t.adler&65535)),Ma(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Vi:ym)},rb=t=>{if(!t||!t.state)return Gn;const e=t.state.status;return e!==Xd&&e!==Af&&e!==Yd&&e!==Zd&&e!==Jd&&e!==xs&&e!==Mu?Da(t,Gn):(t.state=null,e===xs?Da(t,P_):Vi)},nb=(t,e)=>{let r=e.length;if(!t||!t.state)return Gn;const n=t.state,i=n.wrap;if(i===2||i===1&&n.status!==Xd||n.lookahead)return Gn;if(i===1&&(t.adler=Nu(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){i===0&&(ka(n.head),n.strstart=0,n.block_start=0,n.insert=0);let m=new Uint8Array(n.w_size);m.set(e.subarray(r-n.w_size,r),0),e=m,r=n.w_size}const a=t.avail_in,l=t.next_in,d=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,As(n);n.lookahead>=Qt;){let m=n.strstart,v=n.lookahead-(Qt-1);do n.ins_h=Na(n,n.ins_h,n.window[m+Qt-1]),n.prev[m&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=m,m++;while(--v);n.strstart=m,n.lookahead=Qt-1,As(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Qt-1,n.match_available=0,t.next_in=l,t.input=d,t.avail_in=a,n.wrap=i,Vi};var ib=eb,ob=Em,ab=Sm,sb=wm,cb=J_,lb=tb,ub=rb,db=nb,hb="pako deflate (from Nodeca project)",Bu={deflateInit:ib,deflateInit2:ob,deflateReset:ab,deflateResetKeep:sb,deflateSetHeader:cb,deflate:lb,deflateEnd:ub,deflateSetDictionary:db,deflateInfo:hb};const fb=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var pb=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(!!r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)fb(r,n)&&(t[n]=r[n])}}return t},gb=t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const r=new Uint8Array(e);for(let n=0,i=0,a=t.length;n<a;n++){let l=t[n];r.set(l,i),i+=l.length}return r},eh={assign:pb,flattenChunks:gb};let Cm=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Cm=!1}const Hu=new Uint8Array(256);for(let t=0;t<256;t++)Hu[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Hu[254]=Hu[254]=1;var mb=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,i,a,l=t.length,d=0;for(i=0;i<l;i++)r=t.charCodeAt(i),(r&64512)==55296&&i+1<l&&(n=t.charCodeAt(i+1),(n&64512)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),d+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(d),a=0,i=0;a<d;i++)r=t.charCodeAt(i),(r&64512)==55296&&i+1<l&&(n=t.charCodeAt(i+1),(n&64512)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|r&63):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|r&63):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|r&63);return e};const vb=(t,e)=>{if(e<65534&&t.subarray&&Cm)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r};var yb=(t,e)=>{const r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,i;const a=new Array(r*2);for(i=0,n=0;n<r;){let l=t[n++];if(l<128){a[i++]=l;continue}let d=Hu[l];if(d>4){a[i++]=65533,n+=d-1;continue}for(l&=d===2?31:d===3?15:7;d>1&&n<r;)l=l<<6|t[n++]&63,d--;if(d>1){a[i++]=65533;continue}l<65536?a[i++]=l:(l-=65536,a[i++]=55296|l>>10&1023,a[i++]=56320|l&1023)}return vb(a,i)},_b=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)==128;)r--;return r<0||r===0?e:r+Hu[t[r]]>e?r:e},Uu={string2buf:mb,buf2string:yb,utf8border:_b};function bb(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Tm=bb;const xm=Object.prototype.toString,{Z_NO_FLUSH:wb,Z_SYNC_FLUSH:Sb,Z_FULL_FLUSH:Eb,Z_FINISH:Cb,Z_OK:th,Z_STREAM_END:Tb,Z_DEFAULT_COMPRESSION:xb,Z_DEFAULT_STRATEGY:Rb,Z_DEFLATED:Ab}=Cs;function ju(t){this.options=eh.assign({level:xb,method:Ab,chunkSize:16384,windowBits:15,memLevel:8,strategy:Rb},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tm,this.strm.avail_out=0;let r=Bu.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==th)throw new Error(Es[r]);if(e.header&&Bu.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=Uu.string2buf(e.dictionary):xm.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,r=Bu.deflateSetDictionary(this.strm,n),r!==th)throw new Error(Es[r]);this._dict_set=!0}}ju.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let i,a;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?Cb:wb,typeof t=="string"?r.input=Uu.string2buf(t):xm.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(a===Sb||a===Eb)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(i=Bu.deflate(r,a),i===Tb)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Bu.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===th;if(r.avail_out===0){this.onData(r.output);continue}if(a>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0},ju.prototype.onData=function(t){this.chunks.push(t)},ju.prototype.onEnd=function(t){t===th&&(this.result=eh.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Pf(t,e){const r=new ju(e);if(r.push(t,!0),r.err)throw r.msg||Es[r.err];return r.result}function Ib(t,e){return e=e||{},e.raw=!0,Pf(t,e)}function Pb(t,e){return e=e||{},e.gzip=!0,Pf(t,e)}var Ob=ju,Db=Pf,kb=Ib,Nb=Pb,Mb=Cs,Lb={Deflate:Ob,deflate:Db,deflateRaw:kb,gzip:Nb,constants:Mb};const rh=30,Fb=12;var $b=function(e,r){let n,i,a,l,d,m,v,E,P,R,I,M,N,B,j,K,ee,te,fe,$e,Ae,Te,qe,De;const Be=e.state;n=e.next_in,qe=e.input,i=n+(e.avail_in-5),a=e.next_out,De=e.output,l=a-(r-e.avail_out),d=a+(e.avail_out-257),m=Be.dmax,v=Be.wsize,E=Be.whave,P=Be.wnext,R=Be.window,I=Be.hold,M=Be.bits,N=Be.lencode,B=Be.distcode,j=(1<<Be.lenbits)-1,K=(1<<Be.distbits)-1;e:do{M<15&&(I+=qe[n++]<<M,M+=8,I+=qe[n++]<<M,M+=8),ee=N[I&j];t:for(;;){if(te=ee>>>24,I>>>=te,M-=te,te=ee>>>16&255,te===0)De[a++]=ee&65535;else if(te&16){fe=ee&65535,te&=15,te&&(M<te&&(I+=qe[n++]<<M,M+=8),fe+=I&(1<<te)-1,I>>>=te,M-=te),M<15&&(I+=qe[n++]<<M,M+=8,I+=qe[n++]<<M,M+=8),ee=B[I&K];r:for(;;){if(te=ee>>>24,I>>>=te,M-=te,te=ee>>>16&255,te&16){if($e=ee&65535,te&=15,M<te&&(I+=qe[n++]<<M,M+=8,M<te&&(I+=qe[n++]<<M,M+=8)),$e+=I&(1<<te)-1,$e>m){e.msg="invalid distance too far back",Be.mode=rh;break e}if(I>>>=te,M-=te,te=a-l,$e>te){if(te=$e-te,te>E&&Be.sane){e.msg="invalid distance too far back",Be.mode=rh;break e}if(Ae=0,Te=R,P===0){if(Ae+=v-te,te<fe){fe-=te;do De[a++]=R[Ae++];while(--te);Ae=a-$e,Te=De}}else if(P<te){if(Ae+=v+P-te,te-=P,te<fe){fe-=te;do De[a++]=R[Ae++];while(--te);if(Ae=0,P<fe){te=P,fe-=te;do De[a++]=R[Ae++];while(--te);Ae=a-$e,Te=De}}}else if(Ae+=P-te,te<fe){fe-=te;do De[a++]=R[Ae++];while(--te);Ae=a-$e,Te=De}for(;fe>2;)De[a++]=Te[Ae++],De[a++]=Te[Ae++],De[a++]=Te[Ae++],fe-=3;fe&&(De[a++]=Te[Ae++],fe>1&&(De[a++]=Te[Ae++]))}else{Ae=a-$e;do De[a++]=De[Ae++],De[a++]=De[Ae++],De[a++]=De[Ae++],fe-=3;while(fe>2);fe&&(De[a++]=De[Ae++],fe>1&&(De[a++]=De[Ae++]))}}else if((te&64)==0){ee=B[(ee&65535)+(I&(1<<te)-1)];continue r}else{e.msg="invalid distance code",Be.mode=rh;break e}break}}else if((te&64)==0){ee=N[(ee&65535)+(I&(1<<te)-1)];continue t}else if(te&32){Be.mode=Fb;break e}else{e.msg="invalid literal/length code",Be.mode=rh;break e}break}}while(n<i&&a<d);fe=M>>3,n-=fe,M-=fe<<3,I&=(1<<M)-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=a<d?257+(d-a):257-(a-d),Be.hold=I,Be.bits=M};const qc=15,Rm=852,Am=592,Im=0,Of=1,Pm=2,Bb=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Hb=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ub=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),jb=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var qu=(t,e,r,n,i,a,l,d)=>{const m=d.bits;let v=0,E=0,P=0,R=0,I=0,M=0,N=0,B=0,j=0,K=0,ee,te,fe,$e,Ae,Te=null,qe=0,De;const Be=new Uint16Array(qc+1),et=new Uint16Array(qc+1);let cr=null,dn=0,wi,kn,Si;for(v=0;v<=qc;v++)Be[v]=0;for(E=0;E<n;E++)Be[e[r+E]]++;for(I=m,R=qc;R>=1&&Be[R]===0;R--);if(I>R&&(I=R),R===0)return i[a++]=1<<24|64<<16|0,i[a++]=1<<24|64<<16|0,d.bits=1,0;for(P=1;P<R&&Be[P]===0;P++);for(I<P&&(I=P),B=1,v=1;v<=qc;v++)if(B<<=1,B-=Be[v],B<0)return-1;if(B>0&&(t===Im||R!==1))return-1;for(et[1]=0,v=1;v<qc;v++)et[v+1]=et[v]+Be[v];for(E=0;E<n;E++)e[r+E]!==0&&(l[et[e[r+E]]++]=E);if(t===Im?(Te=cr=l,De=19):t===Of?(Te=Bb,qe-=257,cr=Hb,dn-=257,De=256):(Te=Ub,cr=jb,De=-1),K=0,E=0,v=P,Ae=a,M=I,N=0,fe=-1,j=1<<I,$e=j-1,t===Of&&j>Rm||t===Pm&&j>Am)return 1;for(;;){wi=v-N,l[E]<De?(kn=0,Si=l[E]):l[E]>De?(kn=cr[dn+l[E]],Si=Te[qe+l[E]]):(kn=32+64,Si=0),ee=1<<v-N,te=1<<M,P=te;do te-=ee,i[Ae+(K>>N)+te]=wi<<24|kn<<16|Si|0;while(te!==0);for(ee=1<<v-1;K&ee;)ee>>=1;if(ee!==0?(K&=ee-1,K+=ee):K=0,E++,--Be[v]==0){if(v===R)break;v=e[r+l[E]]}if(v>I&&(K&$e)!==fe){for(N===0&&(N=I),Ae+=P,M=v-N,B=1<<M;M+N<R&&(B-=Be[M+N],!(B<=0));)M++,B<<=1;if(j+=1<<M,t===Of&&j>Rm||t===Pm&&j>Am)return 1;fe=K&$e,i[fe]=I<<24|M<<16|Ae-a|0}}return K!==0&&(i[Ae+K]=v-N<<24|64<<16|0),d.bits=I,0};const qb=0,Om=1,Dm=2,{Z_FINISH:km,Z_BLOCK:zb,Z_TREES:nh,Z_OK:Is,Z_STREAM_END:Wb,Z_NEED_DICT:Gb,Z_STREAM_ERROR:Vn,Z_DATA_ERROR:Nm,Z_MEM_ERROR:Mm,Z_BUF_ERROR:Vb,Z_DEFLATED:Lm}=Cs,Fm=1,$m=2,Bm=3,Hm=4,Um=5,jm=6,qm=7,zm=8,Wm=9,Gm=10,ih=11,Oo=12,Df=13,Vm=14,kf=15,Km=16,Qm=17,Xm=18,Ym=19,oh=20,ah=21,Zm=22,Jm=23,ev=24,tv=25,rv=26,Nf=27,nv=28,iv=29,wr=30,ov=31,Kb=32,Qb=852,Xb=592,Yb=15,av=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function Zb(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const sv=t=>{if(!t||!t.state)return Vn;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Fm,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Qb),e.distcode=e.distdyn=new Int32Array(Xb),e.sane=1,e.back=-1,Is},cv=t=>{if(!t||!t.state)return Vn;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,sv(t)},lv=(t,e)=>{let r;if(!t||!t.state)return Vn;const n=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?Vn:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,cv(t))},uv=(t,e)=>{if(!t)return Vn;const r=new Zb;t.state=r,r.window=null;const n=lv(t,e);return n!==Is&&(t.state=null),n},Jb=t=>uv(t,Yb);let dv=!0,Mf,Lf;const ew=t=>{if(dv){Mf=new Int32Array(512),Lf=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(qu(Om,t.lens,0,288,Mf,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;qu(Dm,t.lens,0,32,Lf,0,t.work,{bits:5}),dv=!1}t.lencode=Mf,t.lenbits=9,t.distcode=Lf,t.distbits=5},hv=(t,e,r,n)=>{let i;const a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(e.subarray(r-a.wsize,r),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>n&&(i=n),a.window.set(e.subarray(r-n,r-n+i),a.wnext),n-=i,n?(a.window.set(e.subarray(r-n,r),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},tw=(t,e)=>{let r,n,i,a,l,d,m,v,E,P,R,I,M,N,B=0,j,K,ee,te,fe,$e,Ae,Te;const qe=new Uint8Array(4);let De,Be;const et=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return Vn;r=t.state,r.mode===Oo&&(r.mode=Df),l=t.next_out,i=t.output,m=t.avail_out,a=t.next_in,n=t.input,d=t.avail_in,v=r.hold,E=r.bits,P=d,R=m,Te=Is;e:for(;;)switch(r.mode){case Fm:if(r.wrap===0){r.mode=Df;break}for(;E<16;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if(r.wrap&2&&v===35615){r.check=0,qe[0]=v&255,qe[1]=v>>>8&255,r.check=$r(r.check,qe,2,0),v=0,E=0,r.mode=$m;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((v&255)<<8)+(v>>8))%31){t.msg="incorrect header check",r.mode=wr;break}if((v&15)!==Lm){t.msg="unknown compression method",r.mode=wr;break}if(v>>>=4,E-=4,Ae=(v&15)+8,r.wbits===0)r.wbits=Ae;else if(Ae>r.wbits){t.msg="invalid window size",r.mode=wr;break}r.dmax=1<<r.wbits,t.adler=r.check=1,r.mode=v&512?Gm:Oo,v=0,E=0;break;case $m:for(;E<16;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if(r.flags=v,(r.flags&255)!==Lm){t.msg="unknown compression method",r.mode=wr;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=wr;break}r.head&&(r.head.text=v>>8&1),r.flags&512&&(qe[0]=v&255,qe[1]=v>>>8&255,r.check=$r(r.check,qe,2,0)),v=0,E=0,r.mode=Bm;case Bm:for(;E<32;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}r.head&&(r.head.time=v),r.flags&512&&(qe[0]=v&255,qe[1]=v>>>8&255,qe[2]=v>>>16&255,qe[3]=v>>>24&255,r.check=$r(r.check,qe,4,0)),v=0,E=0,r.mode=Hm;case Hm:for(;E<16;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}r.head&&(r.head.xflags=v&255,r.head.os=v>>8),r.flags&512&&(qe[0]=v&255,qe[1]=v>>>8&255,r.check=$r(r.check,qe,2,0)),v=0,E=0,r.mode=Um;case Um:if(r.flags&1024){for(;E<16;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}r.length=v,r.head&&(r.head.extra_len=v),r.flags&512&&(qe[0]=v&255,qe[1]=v>>>8&255,r.check=$r(r.check,qe,2,0)),v=0,E=0}else r.head&&(r.head.extra=null);r.mode=jm;case jm:if(r.flags&1024&&(I=r.length,I>d&&(I=d),I&&(r.head&&(Ae=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(a,a+I),Ae)),r.flags&512&&(r.check=$r(r.check,n,I,a)),d-=I,a+=I,r.length-=I),r.length))break e;r.length=0,r.mode=qm;case qm:if(r.flags&2048){if(d===0)break e;I=0;do Ae=n[a+I++],r.head&&Ae&&r.length<65536&&(r.head.name+=String.fromCharCode(Ae));while(Ae&&I<d);if(r.flags&512&&(r.check=$r(r.check,n,I,a)),d-=I,a+=I,Ae)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=zm;case zm:if(r.flags&4096){if(d===0)break e;I=0;do Ae=n[a+I++],r.head&&Ae&&r.length<65536&&(r.head.comment+=String.fromCharCode(Ae));while(Ae&&I<d);if(r.flags&512&&(r.check=$r(r.check,n,I,a)),d-=I,a+=I,Ae)break e}else r.head&&(r.head.comment=null);r.mode=Wm;case Wm:if(r.flags&512){for(;E<16;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if(v!==(r.check&65535)){t.msg="header crc mismatch",r.mode=wr;break}v=0,E=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=Oo;break;case Gm:for(;E<32;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}t.adler=r.check=av(v),v=0,E=0,r.mode=ih;case ih:if(r.havedict===0)return t.next_out=l,t.avail_out=m,t.next_in=a,t.avail_in=d,r.hold=v,r.bits=E,Gb;t.adler=r.check=1,r.mode=Oo;case Oo:if(e===zb||e===nh)break e;case Df:if(r.last){v>>>=E&7,E-=E&7,r.mode=Nf;break}for(;E<3;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}switch(r.last=v&1,v>>>=1,E-=1,v&3){case 0:r.mode=Vm;break;case 1:if(ew(r),r.mode=oh,e===nh){v>>>=2,E-=2;break e}break;case 2:r.mode=Qm;break;case 3:t.msg="invalid block type",r.mode=wr}v>>>=2,E-=2;break;case Vm:for(v>>>=E&7,E-=E&7;E<32;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if((v&65535)!=(v>>>16^65535)){t.msg="invalid stored block lengths",r.mode=wr;break}if(r.length=v&65535,v=0,E=0,r.mode=kf,e===nh)break e;case kf:r.mode=Km;case Km:if(I=r.length,I){if(I>d&&(I=d),I>m&&(I=m),I===0)break e;i.set(n.subarray(a,a+I),l),d-=I,a+=I,m-=I,l+=I,r.length-=I;break}r.mode=Oo;break;case Qm:for(;E<14;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if(r.nlen=(v&31)+257,v>>>=5,E-=5,r.ndist=(v&31)+1,v>>>=5,E-=5,r.ncode=(v&15)+4,v>>>=4,E-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=wr;break}r.have=0,r.mode=Xm;case Xm:for(;r.have<r.ncode;){for(;E<3;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}r.lens[et[r.have++]]=v&7,v>>>=3,E-=3}for(;r.have<19;)r.lens[et[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,De={bits:r.lenbits},Te=qu(qb,r.lens,0,19,r.lencode,0,r.work,De),r.lenbits=De.bits,Te){t.msg="invalid code lengths set",r.mode=wr;break}r.have=0,r.mode=Ym;case Ym:for(;r.have<r.nlen+r.ndist;){for(;B=r.lencode[v&(1<<r.lenbits)-1],j=B>>>24,K=B>>>16&255,ee=B&65535,!(j<=E);){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if(ee<16)v>>>=j,E-=j,r.lens[r.have++]=ee;else{if(ee===16){for(Be=j+2;E<Be;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if(v>>>=j,E-=j,r.have===0){t.msg="invalid bit length repeat",r.mode=wr;break}Ae=r.lens[r.have-1],I=3+(v&3),v>>>=2,E-=2}else if(ee===17){for(Be=j+3;E<Be;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}v>>>=j,E-=j,Ae=0,I=3+(v&7),v>>>=3,E-=3}else{for(Be=j+7;E<Be;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}v>>>=j,E-=j,Ae=0,I=11+(v&127),v>>>=7,E-=7}if(r.have+I>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=wr;break}for(;I--;)r.lens[r.have++]=Ae}}if(r.mode===wr)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=wr;break}if(r.lenbits=9,De={bits:r.lenbits},Te=qu(Om,r.lens,0,r.nlen,r.lencode,0,r.work,De),r.lenbits=De.bits,Te){t.msg="invalid literal/lengths set",r.mode=wr;break}if(r.distbits=6,r.distcode=r.distdyn,De={bits:r.distbits},Te=qu(Dm,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,De),r.distbits=De.bits,Te){t.msg="invalid distances set",r.mode=wr;break}if(r.mode=oh,e===nh)break e;case oh:r.mode=ah;case ah:if(d>=6&&m>=258){t.next_out=l,t.avail_out=m,t.next_in=a,t.avail_in=d,r.hold=v,r.bits=E,$b(t,R),l=t.next_out,i=t.output,m=t.avail_out,a=t.next_in,n=t.input,d=t.avail_in,v=r.hold,E=r.bits,r.mode===Oo&&(r.back=-1);break}for(r.back=0;B=r.lencode[v&(1<<r.lenbits)-1],j=B>>>24,K=B>>>16&255,ee=B&65535,!(j<=E);){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if(K&&(K&240)==0){for(te=j,fe=K,$e=ee;B=r.lencode[$e+((v&(1<<te+fe)-1)>>te)],j=B>>>24,K=B>>>16&255,ee=B&65535,!(te+j<=E);){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}v>>>=te,E-=te,r.back+=te}if(v>>>=j,E-=j,r.back+=j,r.length=ee,K===0){r.mode=rv;break}if(K&32){r.back=-1,r.mode=Oo;break}if(K&64){t.msg="invalid literal/length code",r.mode=wr;break}r.extra=K&15,r.mode=Zm;case Zm:if(r.extra){for(Be=r.extra;E<Be;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}r.length+=v&(1<<r.extra)-1,v>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=Jm;case Jm:for(;B=r.distcode[v&(1<<r.distbits)-1],j=B>>>24,K=B>>>16&255,ee=B&65535,!(j<=E);){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if((K&240)==0){for(te=j,fe=K,$e=ee;B=r.distcode[$e+((v&(1<<te+fe)-1)>>te)],j=B>>>24,K=B>>>16&255,ee=B&65535,!(te+j<=E);){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}v>>>=te,E-=te,r.back+=te}if(v>>>=j,E-=j,r.back+=j,K&64){t.msg="invalid distance code",r.mode=wr;break}r.offset=ee,r.extra=K&15,r.mode=ev;case ev:if(r.extra){for(Be=r.extra;E<Be;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}r.offset+=v&(1<<r.extra)-1,v>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=wr;break}r.mode=tv;case tv:if(m===0)break e;if(I=R-m,r.offset>I){if(I=r.offset-I,I>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=wr;break}I>r.wnext?(I-=r.wnext,M=r.wsize-I):M=r.wnext-I,I>r.length&&(I=r.length),N=r.window}else N=i,M=l-r.offset,I=r.length;I>m&&(I=m),m-=I,r.length-=I;do i[l++]=N[M++];while(--I);r.length===0&&(r.mode=ah);break;case rv:if(m===0)break e;i[l++]=r.length,m--,r.mode=ah;break;case Nf:if(r.wrap){for(;E<32;){if(d===0)break e;d--,v|=n[a++]<<E,E+=8}if(R-=m,t.total_out+=R,r.total+=R,R&&(t.adler=r.check=r.flags?$r(r.check,i,R,l-R):Nu(r.check,i,R,l-R)),R=m,(r.flags?v:av(v))!==r.check){t.msg="incorrect data check",r.mode=wr;break}v=0,E=0}r.mode=nv;case nv:if(r.wrap&&r.flags){for(;E<32;){if(d===0)break e;d--,v+=n[a++]<<E,E+=8}if(v!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=wr;break}v=0,E=0}r.mode=iv;case iv:Te=Wb;break e;case wr:Te=Nm;break e;case ov:return Mm;case Kb:default:return Vn}return t.next_out=l,t.avail_out=m,t.next_in=a,t.avail_in=d,r.hold=v,r.bits=E,(r.wsize||R!==t.avail_out&&r.mode<wr&&(r.mode<Nf||e!==km))&&hv(t,t.output,t.next_out,R-t.avail_out),P-=t.avail_in,R-=t.avail_out,t.total_in+=P,t.total_out+=R,r.total+=R,r.wrap&&R&&(t.adler=r.check=r.flags?$r(r.check,i,R,t.next_out-R):Nu(r.check,i,R,t.next_out-R)),t.data_type=r.bits+(r.last?64:0)+(r.mode===Oo?128:0)+(r.mode===oh||r.mode===kf?256:0),(P===0&&R===0||e===km)&&Te===Is&&(Te=Vb),Te},rw=t=>{if(!t||!t.state)return Vn;let e=t.state;return e.window&&(e.window=null),t.state=null,Is},nw=(t,e)=>{if(!t||!t.state)return Vn;const r=t.state;return(r.wrap&2)==0?Vn:(r.head=e,e.done=!1,Is)},iw=(t,e)=>{const r=e.length;let n,i,a;return!t||!t.state||(n=t.state,n.wrap!==0&&n.mode!==ih)?Vn:n.mode===ih&&(i=1,i=Nu(i,e,r,0),i!==n.check)?Nm:(a=hv(t,e,r,r),a?(n.mode=ov,Mm):(n.havedict=1,Is))};var ow=cv,aw=lv,sw=sv,cw=Jb,lw=uv,uw=tw,dw=rw,hw=nw,fw=iw,pw="pako inflate (from Nodeca project)",Do={inflateReset:ow,inflateReset2:aw,inflateResetKeep:sw,inflateInit:cw,inflateInit2:lw,inflate:uw,inflateEnd:dw,inflateGetHeader:hw,inflateSetDictionary:fw,inflateInfo:pw};function gw(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var mw=gw;const fv=Object.prototype.toString,{Z_NO_FLUSH:vw,Z_FINISH:yw,Z_OK:zu,Z_STREAM_END:Ff,Z_NEED_DICT:$f,Z_STREAM_ERROR:_w,Z_DATA_ERROR:pv,Z_MEM_ERROR:bw}=Cs;function Wu(t){this.options=eh.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tm,this.strm.avail_out=0;let r=Do.inflateInit2(this.strm,e.windowBits);if(r!==zu)throw new Error(Es[r]);if(this.header=new mw,Do.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Uu.string2buf(e.dictionary):fv.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=Do.inflateSetDictionary(this.strm,e.dictionary),r!==zu)))throw new Error(Es[r])}Wu.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let a,l,d;if(this.ended)return!1;for(e===~~e?l=e:l=e===!0?yw:vw,fv.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),a=Do.inflate(r,l),a===$f&&i&&(a=Do.inflateSetDictionary(r,i),a===zu?a=Do.inflate(r,l):a===pv&&(a=$f));r.avail_in>0&&a===Ff&&r.state.wrap>0&&t[r.next_in]!==0;)Do.inflateReset(r),a=Do.inflate(r,l);switch(a){case _w:case pv:case $f:case bw:return this.onEnd(a),this.ended=!0,!1}if(d=r.avail_out,r.next_out&&(r.avail_out===0||a===Ff))if(this.options.to==="string"){let m=Uu.utf8border(r.output,r.next_out),v=r.next_out-m,E=Uu.buf2string(r.output,m);r.next_out=v,r.avail_out=n-v,v&&r.output.set(r.output.subarray(m,m+v),0),this.onData(E)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(a===zu&&d===0)){if(a===Ff)return a=Do.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},Wu.prototype.onData=function(t){this.chunks.push(t)},Wu.prototype.onEnd=function(t){t===zu&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=eh.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Bf(t,e){const r=new Wu(e);if(r.push(t),r.err)throw r.msg||Es[r.err];return r.result}function ww(t,e){return e=e||{},e.raw=!0,Bf(t,e)}var Sw=Wu,Ew=Bf,Cw=ww,Tw=Bf,xw=Cs,Rw={Inflate:Sw,inflate:Ew,inflateRaw:Cw,ungzip:Tw,constants:xw};const{Deflate:Aw,deflate:Iw,deflateRaw:Pw,gzip:Ow}=Lb,{Inflate:Dw,inflate:kw,inflateRaw:Nw,ungzip:Mw}=Rw;var Lw=Aw,Fw=Iw,$w=Pw,Bw=Ow,Hw=Dw,Uw=kw,jw=Nw,gv=Mw,qw=Cs,tC={Deflate:Lw,deflate:Fw,deflateRaw:$w,gzip:Bw,Inflate:Hw,inflate:Uw,inflateRaw:jw,ungzip:gv,constants:qw};const Ps=(0,F.loadMessageBundle)(),sh=new TextDecoder,ch=new TextEncoder;class zw{constructor(e,r=0){this.retainFor=r;try{this.weakRef=new WeakRef(e)}catch{}this.retain(e)}retain(e){this.retainTimeout&&clearTimeout(this.retainTimeout),this.strongRef=e,this.retainTimeout=setTimeout(()=>{this.strongRef=void 0,this.retainTimeout=void 0},this.retainFor)}deref(){var e,r;const n=(r=this.strongRef)!=null?r:(e=this.weakRef)==null?void 0:e.deref();return n&&this.retain(n),n}}class Ww{constructor(e,r){this.root=e,this.providerService=r,this._onDidChangeIndexingEnablement=new _.EventEmitter,this._onDidDownloadTar=new _.EventEmitter,this.ongoingRequests=new Map,this.usageFile=_.Uri.joinPath(this.root,"usageHistory.json"),this.indexingAllowanceFile=_.Uri.joinPath(this.root,"indexAllowances.json"),this._disposable=_.Disposable.from(...this.registerCommands()),this.updateContext()}get onDidChangeIndexingEnablement(){return this._onDidChangeIndexingEnablement.event}get onDidDownloadTar(){return this._onDidDownloadTar.event}async updateContext(){await _a(Eo.HasSearchIndexes,(await this.listTars()).length>0);const e=this.providerService.repositories.map(i=>i.name),r=await this.getIndexingEnabledRepos(),n=r.has("*")||e.every(i=>r.has(i));await _a(Eo.EnabledSomeSearchIndexes,r.size>0),await _a(Eo.EnabledAllSearchIndexes,n)}dispose(){this._disposable.dispose()}registerCommands(){return[_.commands.registerCommand("remoteHub.configureIndexingAllowedRepos",async()=>{await this.configureIndexingAllowedRepos()}),_.commands.registerCommand("remoteHub.enableIndexing",async()=>{const e={title:Ps("search download prompt enable","Enable")},r={title:Ps("search download prompt enable always","Always Enable")},n={title:Ps("search download prompt configure","Configure")},i={title:Ps("search download prompt cancel","Cancel"),isCloseAffordance:!0},a=await _.window.showInformationMessage(Ps("search download prompt",`Indexing creates a copy of this repository in your browser's storage in order to provide enhanced text searches.

Without indexing, searches will use GitHub's text search, which is imprecise.

Do you want to enable creating local indexes for this repository on this browser? You should only enable indexing on machines you trust.`),{modal:!0,useCustom:!0},e,r,n,i);if(a===n&&await _.commands.executeCommand("workbench.action.openSettings","remoteHub.search.download"),a===e)return await this.markIndexingEnabledForRepos(...this.providerService.repositories.map(l=>l.name)),{triggerSearch:!0};if(a===r)return await this.markIndexingEnabledForRepos("*"),{triggerSearch:!0}}),_.commands.registerCommand("remoteHub.deleteLocalRepositoryData",async()=>{const e=i=>{const a=[{power:9,name:"GB"},{power:6,name:"MB"},{power:3,name:"kB"},{power:0,name:"B"}];for(const l of a)if(i>10**l.power)return`${Math.round(i/10**l.power)} ${l.name}`;return"Unknown size"},r=await this.listTars();if(r.length===0){await _.window.showInformationMessage("No Search Indexes Found");return}const n=_.window.createQuickPick();n.canSelectMany=!0,n.items=r.map(({name:i,size:a,path:l})=>({label:i,path:l,description:a?e(a):void 0})),n.show(),n.onDidAccept(async()=>{n.hide();for(const{label:i,path:a}of n.selectedItems){const l=_.workspace.fs.delete(a),d=_.window.setStatusBarMessage(`$(loading) Deleting ${i}`,l);await l,d.dispose()}this.updateContext()}),n.onDidHide(()=>n.dispose())}),_.commands.registerCommand("remoteHub.deleteAllLocalRepositoryData",()=>_.window.withProgress({location:_.ProgressLocation.Notification,title:"Deleting Search Indexes..."},async()=>{await Promise.all([_.workspace.fs.delete(this.root,{recursive:!0})]),this.updateContext()}))]}getTarFromMemory(e){var r;if(e===this.lastReadKey){const n=(r=this.lastReadValue)==null?void 0:r.deref();if(n)return n;he.log("Weakref deallocated.")}}async getTarFromDisk(e){try{const r=await _.workspace.fs.readFile(e);return!r||!r.length?void 0:r}catch(r){if(r.code!=="FileNotFound")throw r;return}}async getTarFromNetwork(e){if(!await this.isIndexingEnabledForRepo(e))throw Error("Unable to search without indexing allowed");const r=await this.providerService.getTarGz(e);if(r===void 0)throw Error("Unable to search without an index");return this.updateContext(),r}async getTar(e,r){r===void 0&&({HEAD:{sha:r}}=await this.providerService.getMetadata(e)),e=this.providerService.getCanonicalUri(e);const n=this.getTarStorageUri(e,r),i=n.toString();try{let a=this.ongoingRequests.get(i);return a===void 0&&(a=this.getTarCore(e,r,n),this.ongoingRequests.set(i,a)),await a}finally{this.ongoingRequests.delete(i)}}async getCachedTar(e,r){return e=this.providerService.getCanonicalUri(e),this.getTarCore(e,r,this.getTarStorageUri(e,r),{skipDownload:!0})}async getTarCore(e,r,n,i){var a;const l=`${Hr(e,{excludeScheme:!0})}/${r}`,d=new ce(`TarPit.getTar(${l})`),m=n.toString(),v=Date.now();let E,P;try{if(d.logStep("Getting .tar from memory",{suffix:" \u2022 Getting .tar from memory..."}),P=this.getTarFromMemory(m),P)return E=" \u2022 Got .tar from memory",P;d.logStep("Getting .tar from disk",{message:": Not found \u2022",suffix:" \u2022 Getting .tar from disk..."});let R=!1,I=await this.getTarFromDisk(n);if(I==null?void 0:I.length)E=" \u2022 Got .tar from disk";else{if(i==null?void 0:i.skipDownload){E=" \u2022 Skipped download";return}d.logStep("Getting .tar from network",{message:": Not found \u2022",suffix:" \u2022 Getting .tar from network..."}),I=await this.getTarFromNetwork(e),R=!0,E=" \u2022 Got .tar from network",_.workspace.fs.writeFile(n,I).then(()=>he.debug(`Sucessfully wrote tarball to disk in ${Date.now()-v}ms`),B=>he.error(B,`Error writing tarball to disk in ${Date.now()-v}ms`))}if(!(I==null?void 0:I.length))throw new Error("Internal Error: Invalid search index. Try deleting repository data and running search again: `GitHub Repositories: Delete Local Repository Data...`");d.logStep("Unzipping .tar",{suffix:" \u2022 Unzipping .tar..."});const M=gv(I);d.logStep("Parsing .tar",{suffix:" \u2022 Parsing .tar..."}),P=(0,Q0.t9)(M),d.logStep("Fixing up .tar entries",{suffix:" \u2022 Fixing up .tar entries..."});const N=[];for(const B of P.entries)((a=B.header.typeFlag)==null?void 0:a.name)==="Normal"&&(B.header.fullFileName=B.header.fullFileName.replace(/^[^/]+\/?/,""),N.push(B));return P.entries=N,this.lastReadValue=new zw(P,Date.now()-v),this.lastReadKey=m,R&&setTimeout(()=>this._onDidDownloadTar.fire({rootUri:e,sha:r}),0),P}catch(R){throw E=` \u2022 Failed; ${String(R)}`,R}finally{P&&(this.markCacheEntryUsed(`${l}`).catch(R=>he.log(`Error marking entry used: ${R}`)),this.cleanUpCache().catch(R=>he.log(`Error cleaning cache: ${R}`))),d.stop(E?{suffix:E}:void 0)}}getTarStorageUri(e,r){return _.Uri.joinPath(this.root,"tars",Hr(e,{excludeScheme:!0}),r)}async readDir(e){try{return(await _.workspace.fs.readDirectory(e)).map(r=>_.Uri.joinPath(e,r[0]))}catch{return[]}}async isIndexingEnabledForRepo(e){const r=await this.getIndexingEnabledRepos();if(r.has("*"))return!0;const{name:n}=this.providerService.getVirtualUriMetadata(e);return n?r.has(n):!1}async configureIndexingAllowedRepos(){const e=[...(await this.getIndexingEnabledRepos()).values()],r=await _.window.showQuickPick(e.map(n=>({picked:!0,description:n==="*"?Ps("all","All Repositories"):"",label:n})),{canPickMany:!0,title:Ps("select repos where indexing is allowed","Select repositories that should be indexed")});r&&await this.resetIndexingAllowedRepos(r.map(n=>n.label))}async getIndexingEnabledRepos(){let e;try{e=JSON.parse(sh.decode(await _.workspace.fs.readFile(this.indexingAllowanceFile)))}catch(r){r instanceof _.FileSystemError&&r.code!==_.FileSystemError.FileNotFound().code&&he.error(r,"Error reading index allowance data."),e=[]}return new Set(e)}async listTars(){const e=await this.readDir(_.Uri.joinPath(this.root,"tars")).catch(()=>[]),r=(await Promise.all(e.map(a=>this.readDir(a)))).flat(),n=(await Promise.all(r.map(a=>this.readDir(a)))).flat(),i=(await Promise.all(n.map(a=>this.readDir(a)))).flat();return Promise.all(i.map(async a=>({name:a.path.replace(/^.*\/tars\//,""),path:a,size:(await _.workspace.fs.stat(a)).size})))}async resetIndexingAllowedRepos(e){await _.workspace.fs.writeFile(this.indexingAllowanceFile,ch.encode(JSON.stringify(e))),await this.updateContext(),setTimeout(()=>this._onDidChangeIndexingEnablement.fire(),0)}async markIndexingEnabledForRepos(...e){let r;try{r=JSON.parse(sh.decode(await _.workspace.fs.readFile(this.indexingAllowanceFile)))}catch(n){n instanceof _.FileSystemError&&n.code!==_.FileSystemError.FileNotFound().code&&he.error(n,"Error reading index allowance data."),r=[]}for(const n of e)r.includes(n)||r.push(n);await _.workspace.fs.writeFile(this.indexingAllowanceFile,ch.encode(JSON.stringify(r))),await this.updateContext(),setTimeout(()=>this._onDidChangeIndexingEnablement.fire(),0)}async markCacheEntryUsed(e){let r;try{r=JSON.parse(sh.decode(await _.workspace.fs.readFile(this.usageFile)))}catch(n){n instanceof _.FileSystemError&&n.code!==_.FileSystemError.FileNotFound().code&&he.error(n,"Error reading usage data."),r={}}r[e]=Number(Date.now()),await _.workspace.fs.writeFile(this.usageFile,ch.encode(JSON.stringify(r)))}async cleanUpCache(){var e,r;he.log("Cleaning up search cache...");const n=await this.listTars();let i;try{i=JSON.parse(sh.decode(await _.workspace.fs.readFile(this.usageFile)))}catch(P){P instanceof _.FileSystemError&&P.code!==_.FileSystemError.FileNotFound().code&&he.error(P,"Error reading usage data. All existing indexes will be discarded."),i={}}const a=[];n.forEach(P=>{var R;const I=/^([^/]*\/[^/]*)\//.exec(P.name);if(!I)throw Error("Unexpected repo entry");const M=I[1],N=(R=i[P.name])!=null?R:0;a.push({...P,lastUsed:N,repo:M})}),a.sort((P,R)=>R.lastUsed-P.lastUsed);let l=0;const d=[],m=new Map,v=((e=Ne.get("search.download.sizeLimit"))!=null?e:100)*1024*1024,E=(r=Ne.get("search.download.repoLimit"))!=null?r:4;a.forEach(P=>{var R,I;(P.lastUsed===0||l>v||((R=m.get(P.repo))!=null?R:0)>E)&&d.push(P),l+=P.size,m.set(P.repo,((I=m.get(P.repo))!=null?I:0)+1)}),await Promise.all(d.map(async P=>{try{await _.workspace.fs.delete(P.path,{recursive:!0}),delete i[P.name],he.log(`Deleted cache entry for ${P.name}`)}catch(R){he.log(`Deleting cache entry for ${P.name} failed; ${String(R)}`)}})),await _.workspace.fs.writeFile(this.usageFile,ch.encode(JSON.stringify(i))),await this.updateContext()}}const Gw=(0,F.loadMessageBundle)();async function Vw(t,e,r,n,i,a,l){return Hf("provideTextSearchResults",async()=>{const d=G0(n.pattern,Boolean(n.isRegExp),{matchCase:n.isCaseSensitive,wholeWord:n.isWordMatch,multiline:n.isMultiline,global:!0}),m=await Hf("fetch tarball",async()=>{let B;const j=r.getTar(i.folder).then(K=>(B=K,B));return Promise.race([j,(async()=>(await new Promise(K=>setTimeout(K,2e3)),B||_.window.withProgress({location:_.ProgressLocation.Notification,title:Gw("fetching index","Fetching search index...")},()=>j)))()])});if(l.isCancellationRequested)return{limitHit:!1};const{maxResults:v,maxFileSize:E,includes:P,excludes:R}=i,I=await Kw(i.folder,t,m,e);if(l.isCancellationRequested)return{limitHit:!0};let M=v;const N=V0(I,P,R,E);return Hf("searchFiles",async()=>{var B,j;let K=0;for(const ee of I){if(!N.has(ee.path))continue;const te=K0(ee.contents,ee.path,d,{beforeContext:(B=i.beforeContext)!=null?B:0,afterContext:(j=i.afterContext)!=null?j:0,previewOptions:i.previewOptions,remainingResultQuota:M});for(const fe of te)a.report({...fe,uri:_.Uri.joinPath(i.folder,fe.uri.path)});if(M-=te.length,M<=0)return{limitHit:!0};if(K++,K%1e4==0&&(await new Promise(fe=>setTimeout(fe,0)),l.isCancellationRequested))return{limitHit:!1}}return{limitHit:!1}})})}async function Kw(t,e,r,n){const i=r.entries,a=e.getVirtualRootUri(t),l=await n.getChanges(a,{predicate:P=>P.fileType===_.FileType.File});if(l.length===0)return i.map(P=>({contents:P.dataAsBytes,path:P.header.fullFileName,size:P.dataAsBytes.byteLength}));const d=await Promise.all(ma(l,P=>{if(P.type===Ot.Created)return n.getContent(P.uri).then(R=>({path:e.getRelativeFilePath(a,P.uri),size:R.length,contents:R}))})),m=await Promise.all(ma(l,P=>{if(P.type===Ot.Changed)return n.getContent(P.uri).then(R=>({path:e.getRelativeFilePath(a,P.uri),size:R.length,contents:R}))})),v=new Set(tu(go(m,P=>P.path),ma(l,P=>{if(P.type===Ot.Deleted)return e.getRelativeFilePath(a,P.uri)})));return[...ma(i,P=>{if(!v.has(P.header.fullFileName))return{contents:P.dataAsBytes,path:P.header.fullFileName,size:P.dataAsBytes.byteLength}}),...d,...m]}function rC(t,e){const r=Date.now(),n=e();return Logger.log(`${t} time: ${Date.now()-r}`),n}async function Hf(t,e){const r=Date.now(),n=await e();return he.log(`${t} time: ${Date.now()-r}`),n}var Qw=Object.defineProperty,Xw=Object.getOwnPropertyDescriptor,Uf=(t,e,r,n)=>{for(var i=n>1?void 0:n?Xw(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&Qw(e,r,i),i};const jf=(0,F.loadMessageBundle)(),Yw=_.FileSystemError.FileNotFound().code,Zw=/(\/|\\)/g,mv=".vscode/.github-pull-request.rec";class lh{constructor(e,r,n,i){this.providerService=e,this.github=r,this.changeStore=n,this.tarPit=i,this._onDidChangeFile=new _.EventEmitter,this.fileSearchCache=new Map,this.pendingUriRequests=new Map,this.pendingUriRequestsEventDelay=10,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.disposable=_.Disposable.from(_.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0,isReadonly:!0}),_.workspace.registerFileSearchProvider(this.scheme,this),_.workspace.registerTextSearchProvider(this.scheme,this),e.onDidChangeRepository(a=>{a.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([a.repository.uri])}),e.onDidRefresh(a=>this.onRefreshOrRepositoryChanged(a)))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return this.github.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){if(e=e.filter(r=>Dt.getProviderId(r)===this.scheme).map(r=>this.providerService.getProviderUri(r)),e.length!==0){he.log(`GitHubFS.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.fileSearchCache.clear();for(const[r,n]of[...this.pendingUriRequests])e.some(i=>An(n.uri,i))&&(this.pendingUriRequests.delete(r),n.outdated=!0);this.updateOpenOrWatchedUris(e)}}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,a]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(l=>An(a,l))&&(this.implicitlyWatchedUris.delete(i),r.set(i,a));he.debug(`GitHubFS.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(Oe(i),i);const n=[...r.values()].map(i=>({type:_.FileChangeType.Changed,uri:i}));setTimeout(()=>{he.debug(`GitHubFS.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=Oe(e);return this.watchedUris.set(n,e),{dispose:()=>{this.watchedUris.delete(n)}}}async stat(e){var r,n;const i=Oe(e);this.implicitlyWatchedUris.set(i,e);const a=this.providerService.getRelativeFilePath(e),l={uri:e,outdated:!1};try{this.pendingUriRequests.set(`stat:${i}`,l);const d=await this.github.getFileTree(e),m=await d.get(a);if(m==null?void 0:m.stat)return m==null?void 0:m.stat;if(this.implicitlyWatchedUris.delete(i),e.query==="~")return{type:_.FileType.File,size:0,ctime:0,mtime:(r=d.timestamp)!=null?r:Date.now(),permissions:_.FilePermission.Readonly};if(a===mv){const{ref:v}=this.providerService.getVirtualUriMetadata(e);if((v==null?void 0:v.type)===Ye.PullRequest)return{type:_.FileType.File,size:0,ctime:0,mtime:(n=d.timestamp)!=null?n:Date.now(),permissions:_.FilePermission.Readonly}}throw _.FileSystemError.FileNotFound(e)}finally{this.pendingUriRequests.delete(`stat:${i}`),(l==null?void 0:l.outdated)&&setTimeout(()=>{he.log(`GitHubFS.stat(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:_.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}async readDirectory(e,r){this.implicitlyWatchedUris.set(Oe(e),e);const n=await this.github.getFileTree(e),i=this.providerService.getRelativeFilePath(e),a=(await n.getChildren(i,r)).map(([l,{stat:{type:d}}])=>[l,d]);return i===""&&ce.stop("Time to root directory"),a}createDirectory(e){throw _.FileSystemError.NoPermissions()}async readFile(e){const r=Oe(e);this.implicitlyWatchedUris.set(r,e);const n={uri:e,outdated:!1};try{return this.pendingUriRequests.set(r,n),await this.github.getFileContent(e)}catch(i){if(this.implicitlyWatchedUris.delete(r),i instanceof _.FileSystemError&&i.code===Yw){if(e.query==="~")return new Uint8Array(0);if(this.providerService.getRelativeFilePath(e)===mv){const{ref:l}=this.providerService.getVirtualUriMetadata(e);if((l==null?void 0:l.type)===Ye.PullRequest)return new Uint8Array(0)}}throw i}finally{this.pendingUriRequests.delete(r),(n==null?void 0:n.outdated)&&setTimeout(()=>{he.log(`GitHubFS.readFile(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:_.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}writeFile(e,r,n){throw _.FileSystemError.NoPermissions()}delete(e,r){throw _.FileSystemError.NoPermissions()}rename(e,r,n){throw _.FileSystemError.NoPermissions()}copy(e,r,n){throw _.FileSystemError.NoPermissions()}async provideFileSearchResults(e,{folder:r,maxResults:n,includes:i,excludes:a},l){const d=`${Oe(r)}|${JSON.stringify({includes:i,excludes:a})}`;let m=this.fileSearchCache.get(d);if(m===void 0){const E=this.providerService.getRelativeFilePath(r);let P;await this.github.hasFileTree(r)&&(P=await this.github.getFileTree(r));let R;if(P===void 0||P.loading||!P.hasEntireTree?R=await this.github.getFileList(r,E):R=(await P.getChildren(E,{filter:_.FileType.File,recursive:!0})).map(([I])=>I),R.length===0||l.isCancellationRequested)return[];((i==null?void 0:i.length)||(a==null?void 0:a.length))&&(R=[...Qh(R,i,a)]),m=R.map(I=>Oc.prepareSlow(I)),this.fileSearchCache.set(d,m)}let v;return e.pattern===""?v=m.map(E=>_.Uri.joinPath(r,E.target)):(v=Oc.go(e.pattern.replace(Zw,"/"),m,{allowTypo:!0,limit:n}).map(E=>_.Uri.joinPath(r,E.target)),Oc.cleanup()),n!==void 0&&n!==0&&n<v.length&&(v=v.slice(0,n)),v}async provideTextSearchResults(e,r,n,i){const a=[];if(await this.tarPit.isIndexingEnabledForRepo(r.folder))try{return Vw(this.providerService,this.changeStore,this.tarPit,e,r,n,i)}catch{a.push({text:jf("index error","Error searching index, falling back to GitHub search. Try [deleting this repo's data]({0}) or [deleting all local data]({1}) to rebuild the index.","command:remoteHub.deleteLocalRepositoryData","command:remoteHub.deleteAllLocalRepositoryData"),type:_.TextSearchCompleteMessageType.Warning})}e.isCaseSensitive||e.isRegExp||e.isWordMatch?a.push({text:jf("flags not supported","Search flags are not supported by GitHub search. [Enable indexing]({0}) for full search features and exact text searches.","command:remoteHub.enableIndexing"),type:_.TextSearchCompleteMessageType.Warning,trusted:!0}):a.push({text:jf("enable index","Currently using GitHub text search. [Enable indexing]({0}) for exact text searches.","command:remoteHub.enableIndexing"),type:_.TextSearchCompleteMessageType.Information,trusted:!0});const l=await this.github.searchCodeQuery(e.pattern,r.folder,{maxResults:r.maxResults,context:{before:r.beforeContext,after:r.afterContext}});if(l.warnings&&l.warnings.forEach(m=>{a.push({text:m,trusted:!0,type:_.TextSearchCompleteMessageType.Warning})}),l===void 0)return{limitHit:!0,message:a};let d;for(const m of l.matches)d=_.Uri.joinPath(r.folder,m.path),n.report({uri:d,ranges:m.ranges,preview:{text:m.preview,matches:m.matches}});return{limitHit:!1,message:a}}}Uf([yn()],lh.prototype,"stat",1),Uf([yn()],lh.prototype,"readDirectory",1),Uf([yn()],lh.prototype,"readFile",1);var Jw=__webpack_require__(1017);function uh(){return typeof navigator=="object"&&"userAgent"in navigator?navigator.userAgent:typeof process=="object"&&"version"in process?`Node.js/${process.version.substr(1)} (${process.platform}; ${process.arch})`:"<environment undetectable>"}var eS=__webpack_require__(5186);/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function vv(t){return Object.prototype.toString.call(t)==="[object Object]"}function yv(t){var e,r;return vv(t)===!1?!1:(e=t.constructor,e===void 0?!0:(r=e.prototype,!(vv(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)))}function tS(t){return t?Object.keys(t).reduce((e,r)=>(e[r.toLowerCase()]=t[r],e),{}):{}}function _v(t,e){const r=Object.assign({},t);return Object.keys(e).forEach(n=>{yv(e[n])?n in t?r[n]=_v(t[n],e[n]):Object.assign(r,{[n]:e[n]}):Object.assign(r,{[n]:e[n]})}),r}function bv(t){for(const e in t)t[e]===void 0&&delete t[e];return t}function qf(t,e,r){if(typeof e=="string"){let[i,a]=e.split(" ");r=Object.assign(a?{method:i,url:a}:{url:i},r)}else r=Object.assign({},e);r.headers=tS(r.headers),bv(r),bv(r.headers);const n=_v(t||{},r);return t&&t.mediaType.previews.length&&(n.mediaType.previews=t.mediaType.previews.filter(i=>!n.mediaType.previews.includes(i)).concat(n.mediaType.previews)),n.mediaType.previews=n.mediaType.previews.map(i=>i.replace(/-preview/,"")),n}function rS(t,e){const r=/\?/.test(t)?"&":"?",n=Object.keys(e);return n.length===0?t:t+r+n.map(i=>i==="q"?"q="+e.q.split("+").map(encodeURIComponent).join("+"):`${i}=${encodeURIComponent(e[i])}`).join("&")}const nS=/\{[^}]+\}/g;function iS(t){return t.replace(/^\W+|\W+$/g,"").split(/,/)}function oS(t){const e=t.match(nS);return e?e.map(iS).reduce((r,n)=>r.concat(n),[]):[]}function wv(t,e){return Object.keys(t).filter(r=>!e.includes(r)).reduce((r,n)=>(r[n]=t[n],r),{})}function Sv(t){return t.split(/(%[0-9A-Fa-f]{2})/g).map(function(e){return/%[0-9A-Fa-f]/.test(e)||(e=encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]")),e}).join("")}function zc(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function Gu(t,e,r){return e=t==="+"||t==="#"?Sv(e):zc(e),r?zc(r)+"="+e:e}function Wc(t){return t!=null}function zf(t){return t===";"||t==="&"||t==="?"}function aS(t,e,r,n){var i=t[r],a=[];if(Wc(i)&&i!=="")if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")i=i.toString(),n&&n!=="*"&&(i=i.substring(0,parseInt(n,10))),a.push(Gu(e,i,zf(e)?r:""));else if(n==="*")Array.isArray(i)?i.filter(Wc).forEach(function(l){a.push(Gu(e,l,zf(e)?r:""))}):Object.keys(i).forEach(function(l){Wc(i[l])&&a.push(Gu(e,i[l],l))});else{const l=[];Array.isArray(i)?i.filter(Wc).forEach(function(d){l.push(Gu(e,d))}):Object.keys(i).forEach(function(d){Wc(i[d])&&(l.push(zc(d)),l.push(Gu(e,i[d].toString())))}),zf(e)?a.push(zc(r)+"="+l.join(",")):l.length!==0&&a.push(l.join(","))}else e===";"?Wc(i)&&a.push(zc(r)):i===""&&(e==="&"||e==="?")?a.push(zc(r)+"="):i===""&&a.push("");return a}function sS(t){return{expand:cS.bind(null,t)}}function cS(t,e){var r=["+","#",".","/",";","?","&"];return t.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(n,i,a){if(i){let d="";const m=[];if(r.indexOf(i.charAt(0))!==-1&&(d=i.charAt(0),i=i.substr(1)),i.split(/,/g).forEach(function(v){var E=/([^:\*]*)(?::(\d+)|(\*))?/.exec(v);m.push(aS(e,d,E[1],E[2]||E[3]))}),d&&d!=="+"){var l=",";return d==="?"?l="&":d!=="#"&&(l=d),(m.length!==0?d:"")+m.join(l)}else return m.join(",")}else return Sv(a)})}function Ev(t){let e=t.method.toUpperCase(),r=(t.url||"/").replace(/:([a-z]\w+)/g,"{$1}"),n=Object.assign({},t.headers),i,a=wv(t,["method","baseUrl","url","headers","request","mediaType"]);const l=oS(r);r=sS(r).expand(a),/^http/.test(r)||(r=t.baseUrl+r);const d=Object.keys(t).filter(E=>l.includes(E)).concat("baseUrl"),m=wv(a,d);if(!/application\/octet-stream/i.test(n.accept)&&(t.mediaType.format&&(n.accept=n.accept.split(/,/).map(E=>E.replace(/application\/vnd(\.\w+)(\.v3)?(\.\w+)?(\+json)?$/,`application/vnd$1$2.${t.mediaType.format}`)).join(",")),t.mediaType.previews.length)){const E=n.accept.match(/[\w-]+(?=-preview)/g)||[];n.accept=E.concat(t.mediaType.previews).map(P=>{const R=t.mediaType.format?`.${t.mediaType.format}`:"+json";return`application/vnd.github.${P}-preview${R}`}).join(",")}return["GET","HEAD"].includes(e)?r=rS(r,m):"data"in m?i=m.data:Object.keys(m).length?i=m:n["content-length"]=0,!n["content-type"]&&typeof i!="undefined"&&(n["content-type"]="application/json; charset=utf-8"),["PATCH","PUT"].includes(e)&&typeof i=="undefined"&&(i=""),Object.assign({method:e,url:r,headers:n},typeof i!="undefined"?{body:i}:null,t.request?{request:t.request}:null)}function lS(t,e,r){return Ev(qf(t,e,r))}function Cv(t,e){const r=qf(t,e),n=lS.bind(null,r);return Object.assign(n,{DEFAULTS:r,defaults:Cv.bind(null,r),merge:qf.bind(null,r),parse:Ev})}const uS=`octokit-endpoint.js/6.0.12 ${uh()}`,dS=Cv(null,{method:"GET",baseUrl:"https://api.github.com",headers:{accept:"application/vnd.github.v3+json","user-agent":uS},mediaType:{format:"",previews:[]}}),hS=ir.Readable,ko=Symbol("buffer"),Wf=Symbol("type");class Gc{constructor(){this[Wf]="";const e=arguments[0],r=arguments[1],n=[];let i=0;if(e){const l=e,d=Number(l.length);for(let m=0;m<d;m++){const v=l[m];let E;v instanceof Buffer?E=v:ArrayBuffer.isView(v)?E=Buffer.from(v.buffer,v.byteOffset,v.byteLength):v instanceof ArrayBuffer?E=Buffer.from(v):v instanceof Gc?E=v[ko]:E=Buffer.from(typeof v=="string"?v:String(v)),i+=E.length,n.push(E)}}this[ko]=Buffer.concat(n);let a=r&&r.type!==void 0&&String(r.type).toLowerCase();a&&!/[^\u0020-\u007E]/.test(a)&&(this[Wf]=a)}get size(){return this[ko].length}get type(){return this[Wf]}text(){return Promise.resolve(this[ko].toString())}arrayBuffer(){const e=this[ko],r=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(r)}stream(){const e=new hS;return e._read=function(){},e.push(this[ko]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,r=arguments[0],n=arguments[1];let i,a;r===void 0?i=0:r<0?i=Math.max(e+r,0):i=Math.min(r,e),n===void 0?a=e:n<0?a=Math.max(e+n,0):a=Math.min(n,e);const l=Math.max(a-i,0),m=this[ko].slice(i,i+l),v=new Gc([],{type:arguments[2]});return v[ko]=m,v}}Object.defineProperties(Gc.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(Gc.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0});function un(t,e,r){Error.call(this,t),this.message=t,this.type=e,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}un.prototype=Object.create(Error.prototype),un.prototype.constructor=un,un.prototype.name="FetchError";let Gf;try{Gf=require("encoding").convert}catch(t){}const No=Symbol("Body internals"),Tv=ir.PassThrough;function Br(t){var e=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.size;let i=n===void 0?0:n;var a=r.timeout;let l=a===void 0?0:a;t==null?t=null:xv(t)?t=Buffer.from(t.toString()):Vu(t)||Buffer.isBuffer(t)||(Object.prototype.toString.call(t)==="[object ArrayBuffer]"?t=Buffer.from(t):ArrayBuffer.isView(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof ir||(t=Buffer.from(String(t)))),this[No]={body:t,disturbed:!1,error:null},this.size=i,this.timeout=l,t instanceof ir&&t.on("error",function(d){const m=d.name==="AbortError"?d:new un(`Invalid response body while trying to fetch ${e.url}: ${d.message}`,"system",d);e[No].error=m})}Br.prototype={get body(){return this[No].body},get bodyUsed(){return this[No].disturbed},arrayBuffer(){return Vc.call(this).then(function(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)})},blob(){let t=this.headers&&this.headers.get("content-type")||"";return Vc.call(this).then(function(e){return Object.assign(new Gc([],{type:t.toLowerCase()}),{[ko]:e})})},json(){var t=this;return Vc.call(this).then(function(e){try{return JSON.parse(e.toString())}catch(r){return Br.Promise.reject(new un(`invalid json response body at ${t.url} reason: ${r.message}`,"invalid-json"))}})},text(){return Vc.call(this).then(function(t){return t.toString()})},buffer(){return Vc.call(this)},textConverted(){var t=this;return Vc.call(this).then(function(e){return fS(e,t.headers)})}},Object.defineProperties(Br.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),Br.mixIn=function(t){for(const e of Object.getOwnPropertyNames(Br.prototype))if(!(e in t)){const r=Object.getOwnPropertyDescriptor(Br.prototype,e);Object.defineProperty(t,e,r)}};function Vc(){var t=this;if(this[No].disturbed)return Br.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[No].disturbed=!0,this[No].error)return Br.Promise.reject(this[No].error);let e=this.body;if(e===null)return Br.Promise.resolve(Buffer.alloc(0));if(Vu(e)&&(e=e.stream()),Buffer.isBuffer(e))return Br.Promise.resolve(e);if(!(e instanceof ir))return Br.Promise.resolve(Buffer.alloc(0));let r=[],n=0,i=!1;return new Br.Promise(function(a,l){let d;t.timeout&&(d=setTimeout(function(){i=!0,l(new un(`Response timeout while trying to fetch ${t.url} (over ${t.timeout}ms)`,"body-timeout"))},t.timeout)),e.on("error",function(m){m.name==="AbortError"?(i=!0,l(m)):l(new un(`Invalid response body while trying to fetch ${t.url}: ${m.message}`,"system",m))}),e.on("data",function(m){if(!(i||m===null)){if(t.size&&n+m.length>t.size){i=!0,l(new un(`content size at ${t.url} over limit: ${t.size}`,"max-size"));return}n+=m.length,r.push(m)}}),e.on("end",function(){if(!i){clearTimeout(d);try{a(Buffer.concat(r,n))}catch(m){l(new un(`Could not create Buffer from response body for ${t.url}: ${m.message}`,"system",m))}}})})}function fS(t,e){if(typeof Gf!="function")throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=e.get("content-type");let n="utf-8",i,a;return r&&(i=/charset=([^;]*)/i.exec(r)),a=t.slice(0,1024).toString(),!i&&a&&(i=/<meta.+?charset=(['"])(.+?)\1/i.exec(a)),!i&&a&&(i=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(a),i||(i=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(a),i&&i.pop()),i&&(i=/charset=(.*)/i.exec(i.pop()))),!i&&a&&(i=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(a)),i&&(n=i.pop(),(n==="gb2312"||n==="gbk")&&(n="gb18030")),Gf(t,"UTF-8",n).toString()}function xv(t){return typeof t!="object"||typeof t.append!="function"||typeof t.delete!="function"||typeof t.get!="function"||typeof t.getAll!="function"||typeof t.has!="function"||typeof t.set!="function"?!1:t.constructor.name==="URLSearchParams"||Object.prototype.toString.call(t)==="[object URLSearchParams]"||typeof t.sort=="function"}function Vu(t){return typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.constructor=="function"&&typeof t.constructor.name=="string"&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag])}function Rv(t){let e,r,n=t.body;if(t.bodyUsed)throw new Error("cannot clone body after it is used");return n instanceof ir&&typeof n.getBoundary!="function"&&(e=new Tv,r=new Tv,n.pipe(e),n.pipe(r),t[No].body=e,n=r),n}function Av(t){return t===null?null:typeof t=="string"?"text/plain;charset=UTF-8":xv(t)?"application/x-www-form-urlencoded;charset=UTF-8":Vu(t)?t.type||null:Buffer.isBuffer(t)||Object.prototype.toString.call(t)==="[object ArrayBuffer]"||ArrayBuffer.isView(t)?null:typeof t.getBoundary=="function"?`multipart/form-data;boundary=${t.getBoundary()}`:t instanceof ir?null:"text/plain;charset=UTF-8"}function Iv(t){const e=t.body;return e===null?0:Vu(e)?e.size:Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&(e._lengthRetrievers&&e._lengthRetrievers.length==0||e.hasKnownLength&&e.hasKnownLength())?e.getLengthSync():null}function pS(t,e){const r=e.body;r===null?t.end():Vu(r)?r.stream().pipe(t):Buffer.isBuffer(r)?(t.write(r),t.end()):r.pipe(t)}Br.Promise=global.Promise;const Pv=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,Vf=/[^\t\x20-\x7e\x80-\xff]/;function Ku(t){if(t=`${t}`,Pv.test(t)||t==="")throw new TypeError(`${t} is not a legal HTTP header name`)}function Ov(t){if(t=`${t}`,Vf.test(t))throw new TypeError(`${t} is not a legal HTTP header value`)}function Kc(t,e){e=e.toLowerCase();for(const r in t)if(r.toLowerCase()===e)return r}const xr=Symbol("map");class bi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;if(this[xr]=Object.create(null),e instanceof bi){const r=e.raw(),n=Object.keys(r);for(const i of n)for(const a of r[i])this.append(i,a);return}if(e!=null)if(typeof e=="object"){const r=e[Symbol.iterator];if(r!=null){if(typeof r!="function")throw new TypeError("Header pairs must be iterable");const n=[];for(const i of e){if(typeof i!="object"||typeof i[Symbol.iterator]!="function")throw new TypeError("Each header pair must be iterable");n.push(Array.from(i))}for(const i of n){if(i.length!==2)throw new TypeError("Each header pair must be a name/value tuple");this.append(i[0],i[1])}}else for(const n of Object.keys(e)){const i=e[n];this.append(n,i)}}else throw new TypeError("Provided initializer must be an object")}get(e){e=`${e}`,Ku(e);const r=Kc(this[xr],e);return r===void 0?null:this[xr][r].join(", ")}forEach(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,n=Kf(this),i=0;for(;i<n.length;){var a=n[i];const l=a[0],d=a[1];e.call(r,d,l,this),n=Kf(this),i++}}set(e,r){e=`${e}`,r=`${r}`,Ku(e),Ov(r);const n=Kc(this[xr],e);this[xr][n!==void 0?n:e]=[r]}append(e,r){e=`${e}`,r=`${r}`,Ku(e),Ov(r);const n=Kc(this[xr],e);n!==void 0?this[xr][n].push(r):this[xr][e]=[r]}has(e){return e=`${e}`,Ku(e),Kc(this[xr],e)!==void 0}delete(e){e=`${e}`,Ku(e);const r=Kc(this[xr],e);r!==void 0&&delete this[xr][r]}raw(){return this[xr]}keys(){return Xf(this,"key")}values(){return Xf(this,"value")}[Symbol.iterator](){return Xf(this,"key+value")}}bi.prototype.entries=bi.prototype[Symbol.iterator],Object.defineProperty(bi.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(bi.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});function Kf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"key+value";return Object.keys(t[xr]).sort().map(e==="key"?function(n){return n.toLowerCase()}:e==="value"?function(n){return t[xr][n].join(", ")}:function(n){return[n.toLowerCase(),t[xr][n].join(", ")]})}const Qf=Symbol("internal");function Xf(t,e){const r=Object.create(Yf);return r[Qf]={target:t,kind:e,index:0},r}const Yf=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==Yf)throw new TypeError("Value of `this` is not a HeadersIterator");var t=this[Qf];const e=t.target,r=t.kind,n=t.index,i=Kf(e,r),a=i.length;return n>=a?{value:void 0,done:!0}:(this[Qf].index=n+1,{value:i[n],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(Yf,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});function gS(t){const e=Object.assign({__proto__:null},t[xr]),r=Kc(t[xr],"Host");return r!==void 0&&(e[r]=e[r][0]),e}function mS(t){const e=new bi;for(const r of Object.keys(t))if(!Pv.test(r))if(Array.isArray(t[r]))for(const n of t[r])Vf.test(n)||(e[xr][r]===void 0?e[xr][r]=[n]:e[xr][r].push(n));else Vf.test(t[r])||(e[xr][r]=[t[r]]);return e}const La=Symbol("Response internals"),vS=ys.STATUS_CODES;class Qi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Br.call(this,e,r);const n=r.status||200,i=new bi(r.headers);if(e!=null&&!i.has("Content-Type")){const a=Av(e);a&&i.append("Content-Type",a)}this[La]={url:r.url,status:n,statusText:r.statusText||vS[n],headers:i,counter:r.counter}}get url(){return this[La].url||""}get status(){return this[La].status}get ok(){return this[La].status>=200&&this[La].status<300}get redirected(){return this[La].counter>0}get statusText(){return this[La].statusText}get headers(){return this[La].headers}clone(){return new Qi(Rv(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}Br.mixIn(Qi.prototype),Object.defineProperties(Qi.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(Qi.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const Mo=Symbol("Request internals"),Zf=Ad.parse,yS=Ad.format,_S="destroy"in ir.Readable.prototype;function dh(t){return typeof t=="object"&&typeof t[Mo]=="object"}function bS(t){const e=t&&typeof t=="object"&&Object.getPrototypeOf(t);return!!(e&&e.constructor.name==="AbortSignal")}class Os{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n;dh(e)?n=Zf(e.url):(e&&e.href?n=Zf(e.href):n=Zf(`${e}`),e={});let i=r.method||e.method||"GET";if(i=i.toUpperCase(),(r.body!=null||dh(e)&&e.body!==null)&&(i==="GET"||i==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let a=r.body!=null?r.body:dh(e)&&e.body!==null?Rv(e):null;Br.call(this,a,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});const l=new bi(r.headers||e.headers||{});if(a!=null&&!l.has("Content-Type")){const m=Av(a);m&&l.append("Content-Type",m)}let d=dh(e)?e.signal:null;if("signal"in r&&(d=r.signal),d!=null&&!bS(d))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[Mo]={method:i,redirect:r.redirect||e.redirect||"follow",headers:l,parsedURL:n,signal:d},this.follow=r.follow!==void 0?r.follow:e.follow!==void 0?e.follow:20,this.compress=r.compress!==void 0?r.compress:e.compress!==void 0?e.compress:!0,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[Mo].method}get url(){return yS(this[Mo].parsedURL)}get headers(){return this[Mo].headers}get redirect(){return this[Mo].redirect}get signal(){return this[Mo].signal}clone(){return new Os(this)}}Br.mixIn(Os.prototype),Object.defineProperty(Os.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Os.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});function wS(t){const e=t[Mo].parsedURL,r=new bi(t[Mo].headers);if(r.has("Accept")||r.set("Accept","*/*"),!e.protocol||!e.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(e.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(t.signal&&t.body instanceof ir.Readable&&!_S)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let n=null;if(t.body==null&&/^(POST|PUT)$/i.test(t.method)&&(n="0"),t.body!=null){const a=Iv(t);typeof a=="number"&&(n=String(a))}n&&r.set("Content-Length",n),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),t.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let i=t.agent;return typeof i=="function"&&(i=i(e)),!r.has("Connection")&&!i&&r.set("Connection","close"),Object.assign({},e,{method:t.method,headers:gS(r),agent:i})}function Qu(t){Error.call(this,t),this.type="aborted",this.message=t,Error.captureStackTrace(this,this.constructor)}Qu.prototype=Object.create(Error.prototype),Qu.prototype.constructor=Qu,Qu.prototype.name="AbortError";const Dv=ir.PassThrough,SS=Ad.resolve;function Fa(t,e){if(!Fa.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return Br.Promise=Fa.Promise,new Fa.Promise(function(r,n){const i=new Os(t,e),a=wS(i),l=(a.protocol==="https:"?Fp:ys).request,d=i.signal;let m=null;const v=function(){let N=new Qu("The user aborted a request.");n(N),i.body&&i.body instanceof ir.Readable&&i.body.destroy(N),!(!m||!m.body)&&m.body.emit("error",N)};if(d&&d.aborted){v();return}const E=function(){v(),I()},P=l(a);let R;d&&d.addEventListener("abort",E);function I(){P.abort(),d&&d.removeEventListener("abort",E),clearTimeout(R)}i.timeout&&P.once("socket",function(M){R=setTimeout(function(){n(new un(`network timeout at: ${i.url}`,"request-timeout")),I()},i.timeout)}),P.on("error",function(M){n(new un(`request to ${i.url} failed, reason: ${M.message}`,"system",M)),I()}),P.on("response",function(M){clearTimeout(R);const N=mS(M.headers);if(Fa.isRedirect(M.statusCode)){const te=N.get("Location"),fe=te===null?null:SS(i.url,te);switch(i.redirect){case"error":n(new un(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),I();return;case"manual":if(fe!==null)try{N.set("Location",fe)}catch(Ae){n(Ae)}break;case"follow":if(fe===null)break;if(i.counter>=i.follow){n(new un(`maximum redirect reached at: ${i.url}`,"max-redirect")),I();return}const $e={headers:new bi(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:i.body,signal:i.signal,timeout:i.timeout,size:i.size};if(M.statusCode!==303&&i.body&&Iv(i)===null){n(new un("Cannot follow redirect with body being a readable stream","unsupported-redirect")),I();return}(M.statusCode===303||(M.statusCode===301||M.statusCode===302)&&i.method==="POST")&&($e.method="GET",$e.body=void 0,$e.headers.delete("content-length")),r(Fa(new Os(fe,$e))),I();return}}M.once("end",function(){d&&d.removeEventListener("abort",E)});let B=M.pipe(new Dv);const j={url:i.url,status:M.statusCode,statusText:M.statusMessage,headers:N,size:i.size,timeout:i.timeout,counter:i.counter},K=N.get("Content-Encoding");if(!i.compress||i.method==="HEAD"||K===null||M.statusCode===204||M.statusCode===304){m=new Qi(B,j),r(m);return}const ee={flush:On.Z_SYNC_FLUSH,finishFlush:On.Z_SYNC_FLUSH};if(K=="gzip"||K=="x-gzip"){B=B.pipe(On.createGunzip(ee)),m=new Qi(B,j),r(m);return}if(K=="deflate"||K=="x-deflate"){M.pipe(new Dv).once("data",function(fe){(fe[0]&15)==8?B=B.pipe(On.createInflate()):B=B.pipe(On.createInflateRaw()),m=new Qi(B,j),r(m)});return}if(K=="br"&&typeof On.createBrotliDecompress=="function"){B=B.pipe(On.createBrotliDecompress()),m=new Qi(B,j),r(m);return}m=new Qi(B,j),r(m)}),pS(P,i)})}Fa.isRedirect=function(t){return t===301||t===302||t===303||t===307||t===308},Fa.Promise=global.Promise;const ES=Fa;class kv extends Error{constructor(e){super(e);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="Deprecation"}}var CS=__webpack_require__(447),Nv=__webpack_require__.n(CS);const TS=Nv()(t=>console.warn(t)),xS=Nv()(t=>console.warn(t));class Xi extends Error{constructor(e,r,n){super(e);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="HttpError",this.status=r;let i;"headers"in n&&typeof n.headers!="undefined"&&(i=n.headers),"response"in n&&(this.response=n.response,i=n.response.headers);const a=Object.assign({},n.request);n.request.headers.authorization&&(a.headers=Object.assign({},n.request.headers,{authorization:n.request.headers.authorization.replace(/ .*$/," [REDACTED]")})),a.url=a.url.replace(/\bclient_secret=\w+/g,"client_secret=[REDACTED]").replace(/\baccess_token=\w+/g,"access_token=[REDACTED]"),this.request=a,Object.defineProperty(this,"code",{get(){return TS(new kv("[@octokit/request-error] `error.code` is deprecated, use `error.status`.")),r}}),Object.defineProperty(this,"headers",{get(){return xS(new kv("[@octokit/request-error] `error.headers` is deprecated, use `error.response.headers`.")),i||{}}})}}const RS="5.6.1";function AS(t){return t.arrayBuffer()}function Mv(t){const e=t.request&&t.request.log?t.request.log:console;(yv(t.body)||Array.isArray(t.body))&&(t.body=JSON.stringify(t.body));let r={},n,i;return(t.request&&t.request.fetch||ES)(t.url,Object.assign({method:t.method,body:t.body,headers:t.headers,redirect:t.redirect},t.request)).then(async l=>{i=l.url,n=l.status;for(const d of l.headers)r[d[0]]=d[1];if("deprecation"in r){const d=r.link&&r.link.match(/<([^>]+)>; rel="deprecation"/),m=d&&d.pop();e.warn(`[@octokit/request] "${t.method} ${t.url}" is deprecated. It is scheduled to be removed on ${r.sunset}${m?`. See ${m}`:""}`)}if(!(n===204||n===205)){if(t.method==="HEAD"){if(n<400)return;throw new Xi(l.statusText,n,{response:{url:i,status:n,headers:r,data:void 0},request:t})}if(n===304)throw new Xi("Not modified",n,{response:{url:i,status:n,headers:r,data:await Jf(l)},request:t});if(n>=400){const d=await Jf(l);throw new Xi(IS(d),n,{response:{url:i,status:n,headers:r,data:d},request:t})}return Jf(l)}}).then(l=>({status:n,url:i,headers:r,data:l})).catch(l=>{throw l instanceof Xi?l:new Xi(l.message,500,{request:t})})}async function Jf(t){const e=t.headers.get("content-type");return/application\/json/.test(e)?t.json():!e||/^text\/|charset=utf-8$/.test(e)?t.text():AS(t)}function IS(t){return typeof t=="string"?t:"message"in t?Array.isArray(t.errors)?`${t.message}: ${t.errors.map(JSON.stringify).join(", ")}`:t.message:`Unknown error: ${JSON.stringify(t)}`}function ep(t,e){const r=t.defaults(e);return Object.assign(function(i,a){const l=r.merge(i,a);if(!l.request||!l.request.hook)return Mv(r.parse(l));const d=(m,v)=>Mv(r.parse(r.merge(m,v)));return Object.assign(d,{endpoint:r,defaults:ep.bind(null,r)}),l.request.hook(d,l)},{endpoint:r,defaults:ep.bind(null,r)})}const hh=ep(dS,{headers:{"user-agent":`octokit-request.js/${RS} ${uh()}`}}),PS="4.8.0";function OS(t){return`Request failed due to following response errors:
`+t.errors.map(e=>` - ${e.message}`).join(`
`)}class Xu extends Error{constructor(e,r,n){super(OS(n));this.request=e,this.headers=r,this.response=n,this.name="GraphqlResponseError",this.errors=n.errors,this.data=n.data,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}const DS=["method","baseUrl","url","headers","request","query","mediaType"],kS=["query","method","url"],Lv=/\/api\/v3\/?$/;function NS(t,e,r){if(r){if(typeof e=="string"&&"query"in r)return Promise.reject(new Error('[@octokit/graphql] "query" cannot be used as variable name'));for(const l in r)if(!!kS.includes(l))return Promise.reject(new Error(`[@octokit/graphql] "${l}" cannot be used as variable name`))}const n=typeof e=="string"?Object.assign({query:e},r):e,i=Object.keys(n).reduce((l,d)=>DS.includes(d)?(l[d]=n[d],l):(l.variables||(l.variables={}),l.variables[d]=n[d],l),{}),a=n.baseUrl||t.endpoint.DEFAULTS.baseUrl;return Lv.test(a)&&(i.url=a.replace(Lv,"/api/graphql")),t(i).then(l=>{if(l.data.errors){const d={};for(const m of Object.keys(l.headers))d[m]=l.headers[m];throw new Xu(i,d,l.data)}return l.data.data})}function tp(t,e){const r=t.defaults(e);return Object.assign((i,a)=>NS(r,i,a),{defaults:tp.bind(null,r),endpoint:hh.endpoint})}const oC=tp(hh,{headers:{"user-agent":`octokit-graphql.js/${PS} ${uh()}`},method:"POST",url:"/graphql"});function MS(t){return tp(t,{method:"POST",url:"/graphql"})}const LS=/^v1\./,FS=/^ghs_/,$S=/^ghu_/;async function BS(t){const e=t.split(/\./).length===3,r=LS.test(t)||FS.test(t),n=$S.test(t);return{type:"token",token:t,tokenType:e?"app":r?"installation":n?"user-to-server":"oauth"}}function HS(t){return t.split(/\./).length===3?`bearer ${t}`:`token ${t}`}async function US(t,e,r,n){const i=e.endpoint.merge(r,n);return i.headers.authorization=HS(t),e(i)}const jS=function(e){if(!e)throw new Error("[@octokit/auth-token] No token passed to createTokenAuth");if(typeof e!="string")throw new Error("[@octokit/auth-token] Token passed to createTokenAuth is not a string");return e=e.replace(/^(token|bearer) +/i,""),Object.assign(BS.bind(null,e),{hook:US.bind(null,e)})},Fv="3.5.1";class fh{constructor(e={}){const r=new eS.Collection,n={baseUrl:hh.endpoint.DEFAULTS.baseUrl,headers:{},request:Object.assign({},e.request,{hook:r.bind(null,"request")}),mediaType:{previews:[],format:""}};if(n.headers["user-agent"]=[e.userAgent,`octokit-core.js/${Fv} ${uh()}`].filter(Boolean).join(" "),e.baseUrl&&(n.baseUrl=e.baseUrl),e.previews&&(n.mediaType.previews=e.previews),e.timeZone&&(n.headers["time-zone"]=e.timeZone),this.request=hh.defaults(n),this.graphql=MS(this.request).defaults(n),this.log=Object.assign({debug:()=>{},info:()=>{},warn:console.warn.bind(console),error:console.error.bind(console)},e.log),this.hook=r,e.authStrategy){const{authStrategy:a,...l}=e,d=a(Object.assign({request:this.request,log:this.log,octokit:this,octokitOptions:l},e.auth));r.wrap("request",d.hook),this.auth=d}else if(!e.auth)this.auth=async()=>({type:"unauthenticated"});else{const a=jS(e.auth);r.wrap("request",a.hook),this.auth=a}this.constructor.plugins.forEach(a=>{Object.assign(this,a(this,e))})}static defaults(e){return class extends this{constructor(...n){const i=n[0]||{};if(typeof e=="function"){super(e(i));return}super(Object.assign({},e,i,i.userAgent&&e.userAgent?{userAgent:`${i.userAgent} ${e.userAgent}`}:null))}}}static plugin(...e){var r;const n=this.plugins;return r=class extends this{},r.plugins=n.concat(e.filter(a=>!n.includes(a))),r}}fh.VERSION=Fv,fh.plugins=[];function qS(t,e){return t.reduce((n,i)=>{const a=e(i),l=n.get(a);return l===void 0?n.set(a,[i]):l.push(i),n},new Map)}function zS(t){let e=0;for(const r of t){if(r===0)return!0;if(e++,e>8e3)break}return!1}function rp(t,e,r=n=>n){return[...t.reduce((i,a)=>{const l=e(a),d=i.get(l);if(d===void 0)i.set(l,a);else{const m=r(d,a);m!==void 0&&i.set(l,m)}return i},new Map).values()]}function np(t){const e="$memoize$";return function(...r){return this.hasOwnProperty(e)||Object.defineProperty(this,e,{configurable:!1,enumerable:!1,writable:!1,value:t.apply(this,r)}),this[e]}}class $v{constructor(e,r){this.path=e,this.relativePath=r}}class WS{constructor(){this.root=new $v("","")}get(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;for(const i of e.split("/")){const a=(r=n.children)==null?void 0:r.get(i);if(a===void 0)return;n=a}return n.path===e?n.data:void 0}getChildren(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;if(e)for(const i of e.split("/")){const a=(r=n.children)==null?void 0:r.get(i);if(a===void 0)return[];n=a}return n.children===void 0?[]:[...n.children.values()].map(i=>[i.relativePath,i.data])}getDescendants(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;const i=[];if(e)for(const a of e.split("/")){const l=(r=n.children)==null?void 0:r.get(a);if(l===void 0)return i;n=l}if(n.children!==void 0){let a=function(l,d,m){for(const v of l.values()){const E=`${d?`${d}/`:""}${v.relativePath}`;v.data&&m.push([E,v.data]),v.children!==void 0&&a(v.children,E,m)}};a(n.children,"",i)}return i}has(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;for(const i of e.split("/")){const a=(r=n.children)==null?void 0:r.get(i);if(a===void 0)return!1;n=a}return n.path===e}set(e,r){var n;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let i=this.root,a="";for(const l of e.split("/")){let d=(n=i.children)==null?void 0:n.get(l);a=`${a?`${a}/`:""}${l}`,d===void 0&&(i.children===void 0&&(i.children=new Map),d=new $v(a,l),i.children.set(l,d)),i=d}i.data=r}}class Bv{constructor(e,r,n,i,a){if(this.rootUri=e,this.sha=r,this.timestamp=n,this.provider=i,this.trie=new WS,this._hasEntireTree=!1,this._isContentCached=!1,i===void 0)return;const l=[i];i.onDidTriggerContentCaching!==void 0&&i.tryCachingContent!==void 0&&l.push(i.onDidTriggerContentCaching(d=>{(!d||Oe(d.rootUri)===Oe(this.rootUri)&&d.sha===this.sha)&&!this.loading&&this.hasEntireTree&&!this.isContentCached&&i.tryCachingContent(this.trie.get.bind(this.trie)).then(m=>this._isContentCached=m,()=>this._isContentCached=!0)})),this._loading=this.load(a==null?void 0:a.path,a==null?void 0:a.recursive).then(d=>{var m;return this._hasEntireTree=(m=d==null?void 0:d.recursive)!=null?m:!1,this._hasEntireTree&&setTimeout(()=>{var v;return void((v=i.tryCachingContent)==null?void 0:v.call(i,this.trie.get.bind(this.trie)).then(E=>this._isContentCached=E,()=>this._isContentCached=!0))},0),this._loading=void 0,this.preloading=void 0,this.treeSha=d==null?void 0:d.sha,this.treeSha}),(a==null?void 0:a.preload)&&(this.preloading=new Map([["",this.load("")],[".vscode",this.load(".vscode")]])),this.disposable=_.Disposable.from(...l)}get hasEntireTree(){return this._hasEntireTree}get isContentCached(){return this._isContentCached}get loading(){return this._loading!==void 0}get permissions(){var e;return(e=this.provider)==null?void 0:e.permissions}dispose(){var e;(e=this.disposable)==null||e.dispose()}async get(e){var r;if(e==="")return{mode:"040000",sha:this.treeSha,stat:{type:_.FileType.Directory,size:0,ctime:0,mtime:(r=this.timestamp)!=null?r:Date.now(),permissions:await this.permissions},getContent:void 0};let n=this.trie.get(e);return n!==void 0||(await this.ensureLoaded(e),n=this.trie.get(e)),n}async getChildren(e,r){await this.ensureLoaded(e,!0);const n=(r==null?void 0:r.recursive)?this.trie.getDescendants(e):this.trie.getChildren(e);return(r==null?void 0:r.filter)===void 0?n:n.filter(([,i])=>i.stat.type===r.filter)}async getTreeSha(){return await this.waitUntilLoaded(),this.treeSha}async waitUntilLoaded(){this._loading!==void 0&&await this._loading}async ensureLoaded(e,r=!1){if(this._loading!==void 0){let i;if(this.preloading!==void 0)if(r)i=this.preloading.get(e);else{const a=va(this.preloading,([l])=>e.startsWith(l)&&e.lastIndexOf("/")===(l?l.length:-1));i=a==null?void 0:a[1]}await(i!=null?i:this._loading)}if(this.hasEntireTree||e==="")return;let n=this.trie.get(e);if(n)return r&&(n==null?void 0:n.loadChildren)?n.loadChildren():void 0;if(await this.ensureLoaded(e.substr(0,e.lastIndexOf("/")),!0),n=this.trie.get(e),r&&(n==null?void 0:n.loadChildren))return n.loadChildren()}async load(e,r=!1){var n;if(((n=this.provider)==null?void 0:n.getTree)===void 0)return;const i=new ce(`FileTree.load(${this.sha}:${e})`);let a;try{i.logStep("Tree query");const l=await this.provider.getTree(e,r);if(l===void 0)return;if(l.truncated){he.warn(`Loading file tree for path=${e} was truncated`),i.logStep("Fixing directories",{message:`: Tree=${l.sha};`,suffix:" \u2022 Fixing directories..."});for(const[m,v]of this.trie.getDescendants(""))v.stat.type===_.FileType.Directory&&(v.loadChildren=np(()=>this.load(m).then(()=>v.loadChildren=void 0)));return a=` \u2022 Tree=${l.sha} \u2022 Truncated`,{sha:l.sha,recursive:!1}}let d;this.permissions!==void 0&&(i.logStep("Permissions query",{message:`: Tree=${l.sha};`,suffix:" \u2022 Waiting for permissions..."}),d=await this.permissions),i.logStep("Filling trie",{suffix:" \u2022 Filling trie..."});for(let{path:m,item:v}of l.tree)if(m!==void 0){switch(m=e?`${e}/${m}`:m,v.stat.permissions=d,v.stat.type){case _.FileType.File:v.getContent=np(()=>this.provider.getContent(v));break;case _.FileType.Directory:r||(v.loadChildren=np(()=>this.load(m).then(()=>v.loadChildren=void 0)));break}this.trie.set(m,v)}return a=` \u2022 Tree=${l.sha}`,{sha:l.sha,recursive:r}}catch(l){a=`\u2022 Loading for path=${e} failed; ${String(l)}`;return}finally{i.stop(a?{suffix:a}:void 0)}}}var GS=__webpack_require__(7769);const VS="github-pr-owner-number";function KS(t){return`branch.${t}.${VS}`}const QS=(0,F.loadMessageBundle)(),Hv=new TextDecoder;class XS{constructor(e,r,n,i,a,l){this.providerService=e,this.rootUri=r,this.sourceControl=n,this.metadata=i,this.changeStore=a,this.github=l,this._onDidChangeSelection=new _.EventEmitter,this._onDidChangeState=new _.EventEmitter,this._objects=new Map,this.disposable=_.Disposable.from(this.sourceControl.onDidChangeSelection(()=>this._onDidChangeSelection.fire()),this.providerService.onDidRefresh(v=>{const E=Oe(this.rootUri);!v.some(P=>Oe(P)===E)||this.updateState(this.metadata)}),this.providerService.onDidChangeRepository(async({repository:v})=>{Oe(this.rootUri)===Oe(v.uri)&&this.updateState(await v.getMetadata())}),this.changeStore.onDidChange(()=>this.updateState(this.metadata)),this._onDidChangeSelection,this._onDidChangeState),this._inputBox={get value(){return n.inputBox.value},set value(v){n.inputBox.value=v}},this._ui={get selected(){return n.selected},onDidChange:this._onDidChangeSelection.event};const{repo:{owner:d,name:m}}=i;this.remote={name:"origin",fetchUrl:`https://github.com/${d}/${m}.git`,isReadOnly:i.accessLevel<Gt.Write},this.remotes=[this.remote],this._state={HEAD:this.getHEADFromMetadata(i),mergeChanges:[],indexChanges:[],workingTreeChanges:[],onDidChange:this._onDidChangeState.event,rebaseCommit:void 0,refs:[],remotes:this.remotes,submodules:[]},this.updateState(i)}dispose(){this.disposable.dispose()}get inputBox(){return this._inputBox}get state(){return this._state}get ui(){return this._ui}getHEADFromMetadata(e){switch(e.HEAD.type){case ct.Branch:return{type:Bi.Head,commit:e.HEAD.sha,name:e.HEAD.branch.name,upstream:{name:e.HEAD.branch.name,remote:this.remote.name}};case ct.RemoteBranch:{const r=e.HEAD.branch.remote.repo.owner,n=e.HEAD.branch.remote.accessLevel<Gt.Write,i=this.remotes.findIndex(a=>a.name===r);return this.remotes.splice(i===-1?this.remotes.length:i,i===-1?0:1,{name:r,fetchUrl:`https://github.com/${e.HEAD.branch.remote.repo.owner}/${e.HEAD.branch.remote.repo.name}.git`,pushUrl:n?void 0:`https://github.com/${e.HEAD.branch.remote.repo.owner}/${e.HEAD.branch.remote.repo.name}.git`,isReadOnly:n}),{type:Bi.RemoteHead,commit:e.HEAD.sha,name:e.HEAD.branch.name,upstream:{name:e.HEAD.branch.name,remote:e.HEAD.branch.remote.repo.owner}}}case ct.Tag:return{type:Bi.Tag,name:e.HEAD.detached.name,commit:e.HEAD.sha};case ct.Commit:return{type:Bi.Head,commit:e.HEAD.sha}}}async updateState(e){this.metadata=e;const r=await this.changeStore.getGroupedChanges(this.rootUri,{predicate:d=>d.fileType===_.FileType.File}),n=r.conflicts.map(d=>({uri:d.uri,status:ip(d.type),originalUri:d.uri,renameUri:d.uri})),i=r.staged.map(d=>({uri:d.uri,status:ip(d.type),originalUri:d.uri,renameUri:d.uri})),a=r.working.map(d=>({uri:d.uri,status:ip(d.type),originalUri:d.uri,renameUri:d.uri})),l=Ne.get("staging.enabled");this._state={...this._state,HEAD:this.getHEADFromMetadata(e),mergeChanges:n,indexChanges:l?i:[],workingTreeChanges:l?a:[...i,...a]},this._onDidChangeState.fire()}getConfigs(){return Promise.resolve([])}getConfig(e){return this.metadata.HEAD.branch&&this.metadata.pullRequest&&e===KS(this.metadata.HEAD.branch.name)?Promise.resolve(`${this.metadata.repo.owner}#${this.metadata.repo.name}#${this.metadata.pullRequest.id}`):Promise.resolve("")}setConfig(e,r){return Promise.resolve("")}getGlobalConfig(e){throw new Error("Method not implemented.")}async getObjectDetails(e,r){const n=new ce(`IGit.getObjectDetails(${e}, ${r})`);try{return await this.github.getObjectDetails(this.rootUri,e,this.pathToRelativePath(r))}finally{n.stop()}}async detectObjectType(e){var r;const n=new ce(`IGit.detectObjectType(${e})`);try{const i=await this.github.getBlobContent(this.metadata.repo,e);if(!zS(i))return{mimetype:"text/plain"};const l=await(0,GS.fromBuffer)(i);return{mimetype:(r=l==null?void 0:l.mime)!=null?r:"application/octet-stream"}}finally{n.stop()}}async buffer(e,r){const n=new ce(`IGit.buffer(${e}, ${r})`);try{return await this.github.getFileContent(this.rootUri,e,this.pathToRelativePath(r))}finally{n.stop()}}async show(e,r){const n=new ce(`IGit.show(${e}, ${r})`);try{const i=await this.github.getFileContent(this.rootUri,e,this.pathToRelativePath(r));return Hv.decode(i)}finally{n.stop()}}async getCommit(e){const r=new ce(`IGit.getCommit(${e})`);try{const n=await this.github.getCommit(this.rootUri,e);if(n===void 0)throw new Error(`Unable to find commit for ref "${e}"`);return n}finally{r.stop()}}clean(e){return this._objects.clear(),Promise.resolve()}async apply(e,r){const n=new ce(`IGit.apply(reverse=${r})`);try{return await this.changeStore.applyPatch(this.rootUri,e,r?{reverse:!0}:void 0)}finally{n.stop()}}async diff(e){const r=new ce(`IGit.diff(${e})`);try{return await this.changeStore.createPatch(this.rootUri,void 0,e?{staged:!0}:void 0)}finally{r.stop()}}diffWithHEAD(e){return e?this.diffBetween("","HEAD",e):this.diffBetween("","HEAD")}diffWith(e,r){return r?this.diffBetween("",e,r):this.diffBetween("",e)}diffIndexWithHEAD(e){return e?this.diffBetween("~","HEAD",e):this.diffBetween("~","HEAD")}diffIndexWith(e,r){return r?this.diffBetween("~",e,r):this.diffBetween("~",e)}async diffBetween(e,r,n){if(!n)throw new Error("Method not implemented.");const i=new ce(`IGit.diffBetween(${e}, ${r}, ${n})`);try{const[a,l]=await Promise.all([this.getContent(e,n),this.getContent(r,n)]);return bo(n,a,l)}finally{i.stop()}}async diffBlobs(e,r){const n=new ce(`IGit.diffBlobs(${e}, ${r})`);try{const i=await this.getBlobContent(e),a=await this.getBlobContent(r),l=bo("untitled",i,a);return Promise.resolve(l)}finally{n.stop()}}async getBlobContent(e){const r=new ce(`IGit.getBlobContent(${e})`);try{const n=this._objects.get(e);if(n)return this._objects.delete(e),n;const{repo:i}=this.providerService.getVirtualUriMetadata(this.rootUri),a=await this.github.getBlobContent(i,e);return Hv.decode(a)}finally{r.stop()}}async getContent(e,r){const n=new ce(`IGit.getContent(${e}, ${r})`);try{const i=this.pathToRelativeUri(r);if(e===""||e==="~"){const a=await this.changeStore.getChange(i);if(a!==void 0&&(e===""||a.staged))return this.changeStore.getContent(i);e="HEAD"}return await this.show(e==="HEAD"?this.metadata.HEAD.sha:e,r)}finally{n.stop()}}async hashObject(e){const r=new ce("IGit.hashObject");try{const n=nt(await lu(e));return this._objects.set(n,e),n}finally{r.stop()}}async createBranch(e,r,n){const i=new ce(`IGit.createBranch(${e}, ${r}, ${n})`);try{n||(n=this.metadata.HEAD.sha);const a=await this.github.createBranch(this.rootUri,e,n);r&&await this.checkout(a)}finally{i.stop()}}deleteBranch(e,r){throw new Error("Method not implemented.")}async getBranch(e){const r=new ce(`IGit.getBranch(${e})`);try{const{branches:n}=await this.github.getBranches(this.rootUri,{query:e,limit:1}),[i]=n;if(i===void 0)throw new Error(`Unable to find branch named "${e}"`);return{type:i.type,name:i.name,commit:i.commit,remote:this.remote.name,upstream:{name:i.name,remote:i.commitUrl}}}finally{r.stop()}}async getBranches(e){var r,n;const i=(n=(r=e.contains)!=null?r:e.pattern)!=null?n:"",a=new ce(`IGit.getBranches(${i})`);try{const{branches:l}=await this.github.getBranches(this.rootUri,{query:i,limit:e.count});if(l.length===0)throw new Error(`Unable to find branches for "${i}"`);return l.map(d=>({type:d.type,name:d.name,commit:d.commit}))}finally{a.stop()}}setBranchUpstream(e,r){throw new Error("Method not implemented.")}getMergeBase(e,r){throw new Error("Method not implemented.")}async status(){}async checkout(e){const r=new ce(`IGit.checkout(${e})`);try{if(await this.github.repositoryObjectExists(this.rootUri,e)){const i=await this.github.switchTo(this.rootUri,e,{openInNewWindow:!1});throw i!==void 0&&await qn(i),new Error("User aborted")}const n=/pr\/(?<remote>.+)\/(?<num>\d+)/.exec(e);if(n==null?void 0:n.groups){const{num:i}=n.groups,{provider:a,repo:l}=this.providerService.getVirtualUriMetadata(this.rootUri),d=this.providerService.getRemoteUri(a.id,{repo:l,pullRequest:{id:i}});if(d!==void 0){const m=await this.providerService.createWorkspaceForRemoteUrl(d.toString());m!==void 0&&await qn(m)}}throw new Error("User aborted")}finally{r.stop()}}addRemote(e,r){var n;let i;const a=this.remotes.findIndex(l=>l.name===e);return a!==-1&&([i]=this.remotes.splice(a,1)),this.remotes.push({name:e,fetchUrl:r,isReadOnly:(n=i==null?void 0:i.isReadOnly)!=null?n:!1}),Promise.resolve()}removeRemote(e){const r=this.remotes.findIndex(n=>n.name===e);return r!==-1&&this.remotes.splice(r,1),Promise.resolve()}renameRemote(e,r){const n=this.remotes.findIndex(a=>a.name===e);if(n===-1)return Promise.resolve();const[i]=this.remotes.splice(n,1);return this.remotes.push({...i,name:r}),Promise.resolve()}async fetch(e,r,n){const i=new ce("IGit.fetch");try{return this.github.fetch(this.rootUri)}finally{i.stop()}}async pull(e){const r=new ce("IGit.pull");try{return this.github.sync(this.rootUri,this.changeStore,{conflictResolution:sr.Merge})}finally{r.stop()}}push(e,r,n){return Promise.resolve()}blame(e){throw new Error("Method not implemented.")}async log(e){if((e==null?void 0:e.maxEntries)!==1||(e==null?void 0:e.path)!==void 0)throw new Error("The specified log options are not yet supported.");return[await this.getCommit(this.metadata.HEAD.sha)]}async commit(e,r){const n=new ce("IGit.commit");try{if((r==null?void 0:r.amend)!==void 0||(r==null?void 0:r.empty)!==void 0||(r==null?void 0:r.signCommit)!==void 0||(r==null?void 0:r.signoff)!==void 0)throw new Error("The specified commit options are not yet supported.");const i=(await this.providerService.getCommitOperations(this.rootUri,this.changeStore,{staged:(r==null?void 0:r.all)===!1})).filter(a=>a.fileType===_.FileType.File);if(!i.length){_.window.showInformationMessage(QS("no changes to commit","There are no changes to commit."));return}if(Ne.getUseNewCommitApi())await this.github.createAndPushCommit(this.rootUri,e,i,void 0);else{const a=await this.github.createCommit(this.rootUri,e,i);await this.github.pushCommit(this.rootUri,a)}}finally{n.stop()}}pathToRelativePath(e){return this.providerService.getRelativeFilePath(this.rootUri,this.pathToRelativeUri(e))}pathToRelativeUri(e){return Sr(this.rootUri,JS(e))}}const YS=/^\/?([a-zA-Z])(?::\/)(.*)$/,ZS=/\\/g;function JS(t){t=_.Uri.file(t).fsPath.replace(ZS,"/");const e=YS.exec(t);return e!==null&&([,,t]=e),t.startsWith("/")?t:`/${t}`}function ip(t){switch(t){case Ot.Changed:return vu.MODIFIED;case Ot.Created:return vu.INTENT_TO_ADD;case Ot.Deleted:return vu.DELETED}}var eE=Object.defineProperty,tE=Object.getOwnPropertyDescriptor,Uv=(t,e,r,n)=>{for(var i=n>1?void 0:n?tE(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&eE(e,r,i),i};const Yu=(0,F.loadMessageBundle)(),jv=/^(?:https:\/\/)?github\.(?:com|dev)\/(?<owner>[^/]+)\/(?<repo>[^/?#]+)(?:|\.git|\/tree\/(?<tree>[^?#]+)|\/blob\/(?<blob>[^?#]+)|\/commit\/(?<commit>[0-9a-f]{40})|\/pull\/(?<pull>[0-9]+))?(?<extra>[^?#]*)(?:\?(?<query>[^#]*))?(?:#(?<fragment>.*))?$/i,qv=/(?<remoteOwner>[^/:]+)\/?(?<remoteRepo>[^/:]+)?:(?<remoteRef>.*)/,op=["repo","workflow"],ph=1,zv=Object.freeze({id:Dr.GitHub,name:"GitHub"});function Qc(t){const{scheme:e,metadata:r}=Dt.decodeAuthority(t,l=>{if(l.v!==void 0)return l;if(typeof l.pr=="string")return{v:ph,ref:{type:Ye.PullRequest,id:l.pr},idx:l.idx};if(typeof l.ref=="string")return{v:ph,ref:{type:Ye.Tree,id:l.ref},idx:l.idx}}),[,n,i,...a]=t.path.split("/");return{scheme:e,provider:zv,name:`${n}/${i}`,repo:{owner:n,name:i},path:a.join("/")||"",ref:r==null?void 0:r.ref,idx:r==null?void 0:r.idx}}function rE(t,e){const{repo:r}=e!=null?e:Qc(t);return t.with({path:`/${r.owner}/${r.name}`,query:"",fragment:""})}function ap(t,e,r){const{repo:{owner:n,name:i}}=t instanceof _.Uri?Qc(t):t;return _.Uri.parse(`github://${Dt.encodeAuthority("github",{v:ph,ref:{type:Ye.Commit,id:e}})}/${n}/${i}/${r}`)}class sp{constructor(e,r){this.providerService=e,this.tarPit=r,this.fileTreeCache=new Map,this.disposable=_.Disposable.from(e.onDidChangeRepository(n=>{n.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([n.repository.uri])}),e.onDidRefresh(n=>this.onRefreshOrRepositoryChanged(n)))}get isReadonly(){return!1}get scheme(){return"github"}dispose(){this.disposable.dispose()}onRefreshOrRepositoryChanged(e){e=e.filter(r=>Dt.getProviderId(r)===this.scheme),e.length!==0&&(this.fileTreeCache.forEach(r=>r.dispose()),this.fileTreeCache.clear())}async ensureAuthenticated(e=!1){const r=new ce("GitHub.ensureAuthenticated");try{if(this._session===void 0){async function n(){try{return await _.authentication.getSession("github",op,{createIfNone:!0,forceNewSession:e})}catch{try{const a=await _.authentication.getSession("github",op,{createIfNone:!1});if(a!==void 0)return a}catch{}return new Promise(a=>{async function l(){const m=await _.authentication.getSession("github",op,{createIfNone:!0});m!==void 0&&a(m)}const d=_.authentication.onDidChangeSessions(async m=>{m.provider.id==="github"&&(d.dispose(),await l())})})}}this._session=await n();const i=_.authentication.onDidChangeSessions(a=>{if(this._session===void 0){i.dispose();return}a.provider.id==="github"&&(this.clearAuthenticationSession(),i.dispose())})}return this._session}finally{r.stop()}}async getAuthentication(e){const r=await this.ensureAuthenticated();return{provider:zv,session:r,getRichNavigationHeaders:()=>({"X-Git-GitHub":`Bearer ${r.accessToken}`})}}clearAuthenticationSession(){this._session=void 0,this._octokit=void 0,this._octokitDefaults=void 0}async reauthenticate(){this.clearAuthenticationSession(),await this.ensureAuthenticated(!0)}async octokit(e){if(this._octokitDefaults===void 0){const n=await this.ensureAuthenticated();if(So){async function i(a,l){if(l.headers!==void 0){const{"user-agent":d,...m}=l.headers;d&&(l.headers=m)}return zn(a,l)}this._octokitDefaults=fh.defaults({auth:`token ${n.accessToken}`,request:{fetch:i}})}else this._octokitDefaults=fh.defaults({auth:`token ${n.accessToken}`})}const r=new this._octokitDefaults(e);return(he.logLevel===dt.Debug||he.isDebugging)&&r.hook.wrap("request",async(n,i)=>{var a;const l=new ce(`[GITHUB] ${i.method} ${i.url}`,{log:!1});try{return await n(i)}finally{let d;try{if(typeof i.query=="string"){const m=/(^[^({\n]+)/.exec(i.query);d=` ${(a=m==null?void 0:m[1].trim())!=null?a:i.query}`}}catch{}l.stop({message:d})}}),r}async graphql(e,r){this._octokit===void 0&&(this._octokit=await this.octokit());try{return await this._octokit.graphql(e,r)}catch(n){throw this.handleRequestErrors(n),n}}async request(e,r){this._octokit===void 0&&(this._octokit=await this.octokit());try{return await this._octokit.request(e,r)}catch(n){throw this.handleRequestErrors(n),n}}handleRequestErrors(e){var r,n;if(e instanceof Xi)switch(e.status){case 500:return e.response&&an.showGitHubStatus500Message(),!0;case 401:return an.showStatus401Message(()=>void this.reauthenticate()),!0;case 403:return an.showStatus403Message(()=>void this.reauthenticate()),!0}else if(e instanceof Xu&&((n=(r=e.errors)==null?void 0:r[0])==null?void 0:n.type)==="FORBIDDEN")return an.showStatus403Message(()=>void this.reauthenticate()),!0;return!1}createIGitRepository(e,r,n,i){return new XS(this.providerService,e,r,n,i,this)}async createMetadata(e,r){var n,i,a,l,d,m;const v=new ce(`GitHub.createMetadata(${e.toString()}, ${r})`);let E;try{let{provider:P,name:R,repo:{owner:I,name:M},ref:N}=Qc(e);(!N||N.type===Ye.Commit&&/HEAD/i.test(N.id))&&(N={type:Ye.Commit,id:"HEAD"});const B=this.providerService.isInWorkspace(e);let j,K;Ne.get("experimental.prefetch")&&B&&(r?j=r:(N.type===Ye.Commit||N.type===Ye.Tree)&&(j=N.id),j&&(v.log({suffix:` \u2022 Prefetching tree for ${j}...`}),this.getFileTree(e,void 0,{cache:!0,recursive:!0,prefetched:{metadata:new Promise(Ae=>K=Ae),repo:{owner:I,name:M},HEAD:{sha:j},timestamp:Date.now()}})));const ee=await this.getRepositoryInfo(I,M,B,N.type===Ye.PullRequest?{pr:Number(N.id)}:{ref:N.id});if(ee===void 0)throw E=" \u2022 Aborted; Unable to get repository info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let te;if(r)te=r;else if(N.type===Ye.Commit||N.type===Ye.Tree&&ee.ref===void 0)te=N.id;else if(te=(i=(n=ee.ref)==null?void 0:n.sha)!=null?i:ee.defaultBranch.sha,te===void 0)throw E=" \u2022 Aborted; Unable to get repository revision",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository revision`);let fe;if(((a=ee.ref)==null?void 0:a.prefix)==="refs/heads/")fe={type:ct.Branch,name:ee.ref.name,sha:te,branch:{name:ee.ref.name,sha:ee.ref.sha}};else if(((l=ee.ref)==null?void 0:l.prefix)==="refs/remotes/"){if(!ee.ref.remote)throw E=" \u2022 Aborted; Unable to get remote info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get remote info`);fe={type:ct.RemoteBranch,name:`${ee.ref.remote.repo.owner}${ee.ref.remote.repo.name!==M?`/${ee.ref.remote.repo.name}`:""}:${ee.ref.name}`,sha:te,branch:{name:ee.ref.name,sha:ee.ref.sha,remote:ee.ref.remote}}}else((d=ee.ref)==null?void 0:d.prefix)==="refs/tags/"?fe={type:ct.Tag,name:ee.ref.name,sha:te,detached:{type:ct.Tag,name:ee.ref.name}}:fe={type:ct.Commit,name:pr(te),sha:te,detached:{type:ct.Commit,name:pr(te)}};if(j!==void 0&&j!==fe.sha){const Ae=this.asFileTreeKey(e,j),Te=this.fileTreeCache.get(Ae);Te&&!Rr(j)&&fe.sha===((m=fe.branch)==null?void 0:m.sha)?(v.log({suffix:` \u2022 Updating prefetched tree for ${j}, since HEAD was resolved; HEAD=${fe.sha}`}),this.fileTreeCache.set(this.asFileTreeKey(e,fe.sha),Te),this.fileTreeCache.delete(Ae)):(v.log({suffix:` \u2022 Removing prefetched tree for ${j}, since the HEAD changed; HEAD=${fe.sha}`}),this.fileTreeCache.delete(Ae),Te==null||Te.dispose())}const $e={version:fo.schemaVersion,timestamp:Date.now(),provider:P,name:R,repo:ee.repo,user:ee.user,accessLevel:ee.accessLevel,HEAD:fe,defaultBranch:ee.defaultBranch,pullRequest:ee.pullRequest};return E=` \u2022 HEAD=${fe.sha}`,K==null||K($e),$e}finally{v.stop(E?{suffix:E}:void 0)}}getMetadata(e){return this.providerService.getMetadata(e)}getRemoteWorkspaceSourceProviders(){return[{name:"GitHub",icon:"$(github)",label:Yu("open repo from","Open Repository from {0}","GitHub"),placeholder:Yu("pick repo","Choose a repository"),provideSources:async(e,r)=>{e=e!=null?e:"";let n;const i=e==null?void 0:e.indexOf("/");return i!==-1&&(n=e.substring(0,i),e=e.substr(i+1)),(await this.searchRepositoriesQuery(e,{...r,user:n})).map(l=>({name:l.repoWithOwner,icon:"$(repo)",description:`${l.fork?`$(repo-forked) ${l.fork}`:""}${l.stars>0?`${l.fork?" \u2022 ":""}$(star-full) ${l.stars}`:""}`,detail:l.description,url:l.url}))}},{name:"GitHub",icon:"$(github)",label:Yu("open pr from","Open Pull Request from {0}","GitHub"),placeholder:Yu("pick pr","Choose a pull request"),provideSources:async(e,r)=>{e=e!=null?e:"";let n;const i=e==null?void 0:e.indexOf("/");return i!==-1&&(n=e.substring(0,i),e=e.substr(i+1)),(await this.searchPullRequestsQuery(e,{user:n})).map(l=>({name:l.title,icon:"$(git-pull-request)",description:l.reasons.length!==0?l.reasons.sort().join(", "):void 0,detail:`${l.repoWithOwner} #${l.number}`,url:l.url}))}}]}canOpenRemoteUrl(e){const r=jv.exec(e);if((r==null?void 0:r.groups)===void 0)return;const{blob:n,commit:i,pull:a,tree:l}=r.groups;return a?rr.PullRequest:i?rr.Commit:l?rr.Branch:n?rr.File:rr.Repository}async createWorkspaceForRemoteUrl(e,r=nr.CurrentWindow){const n=jv.exec(e);if((n==null?void 0:n.groups)===void 0)return;let{owner:i,repo:a,blob:l,commit:d,pull:m,tree:v,fragment:E}=n.groups;const P=await this.validateOwnerAndRepoAndSplitRefFromPath(i,a,v!=null?v:l);if(P===void 0)return;let R,I;if({owner:i,repo:a,ref:I,path:R}=P,v||l){if(R&&E&&l){const B=/L(?<start>\d+)(?:-L(?<end>\d+))?/.exec(E);if(B==null?void 0:B.groups){const{start:j,end:K}=B.groups;R+=`:${j}${K!==void 0?`-${K}`:""}`}}}else d?I={type:Ye.Commit,id:d}:m&&(I={type:Ye.PullRequest,id:m});const M=this.providerService.createVirtualUri(Dr.GitHub,{repo:{owner:i,name:a},ref:I});return{name:(await this.getMetadata(M)).name,uri:M,location:r,filesToOpen:R?[R]:void 0}}createVirtualUri(e,{repo:r,ref:n,idx:i},a){const l=n!==void 0||i!==void 0?{v:ph}:void 0;return l&&(n&&(l.ref={...n,type:n.type===Ye.Branch||n.type===Ye.Tag?Ye.Tree:n.type}),i&&(l.idx=i)),e.with({authority:Dt.encodeAuthority("github",l),path:`/${r.owner}/${r.name}${(a==null?void 0:a.startsWith("/"))?a:a?`/${a}`:""}`})}getRemoteUri(e){const r=`https://github.com/${e.repo.owner}/${e.repo.name}`;return e.pullRequest?_.Uri.parse(`${r}/pull/${e.pullRequest.id}`):e.sha?_.Uri.parse(`${r}/commit/${e.sha}`):e.branch?_.Uri.parse(`${r}/tree/${e.branch}`):e.tag?_.Uri.parse(`${r}/tree/${e.tag}`):e.clone?_.Uri.parse(`${r}.git`):_.Uri.parse(r)}getProviderRootUri(e){return rE(e)}getRelativeFilePath(e,r){const{path:n}=Qc(e),{path:i}=Qc(Sr(e,r));return n.length!==0&&i!==n&&i.startsWith(n)?i.slice(n.length+1):i}getVirtualUriMetadata(e){const{provider:r,name:n,repo:i,ref:a}=Qc(e);return{provider:r,name:n,repo:i,ref:a}}async getModeRefType(e,r){const{HEAD:n,pullRequest:i}=await(r!=null?r:this.getMetadata(e));switch(n.type){case ct.Branch:return i!==void 0?re.PullRequestBranch:re.Branch;case ct.RemoteBranch:return i!==void 0?re.PullRequestRemoteBranch:re.RemoteBranch;case ct.Tag:return re.Tag;case ct.Commit:return re.Commit}}async createBranch(e,r,n,i){try{const{repo:{owner:a,name:l}}=i!=null?i:await this.getMetadata(e);return r.startsWith("refs/heads/")||(r=`refs/heads/${r}`),(await this.request("POST /repos/{owner}/{repo}/git/refs",{owner:a,repo:l,ref:r,sha:n})).data.ref.substr(11)}catch(a){throw a instanceof Xi&&a.status===422?a.message==="Reference already exists"?new Hn(a,!0):new Hn(a,!1):(he.error(a),a)}}async createAndPushCommit(e,r,n,i,a){var l;const d=new ce(`GitHub.createAndPushCommit(${e.toString()}${a?`, fork=${a.repo.owner}/${a.repo.name}`:""})`);if(n=n.filter(v=>v.fileType===_.FileType.File),n.length===0)throw d.stop({message:"Aborted; No changes to commit"}),new ui("No changes to commit");let m;try{const v=await this.getMetadata(e);let E;if(i!==void 0)E=i;else{if(v.HEAD.detached&&!v.HEAD.branch)throw new li("Unable to commit; no current branch");E=v.HEAD.branch.name}let P;if(a)P=`${a.repo.owner}/${a.repo.name}`;else if(v.HEAD.type===ct.RemoteBranch&&v.HEAD.branch.remote.accessLevel>=Gt.Write){const{owner:j,name:K}=v.HEAD.branch.remote.repo;P=`${j}/${K}`}else P=`${v.repo.owner}/${v.repo.name}`;const R=[],I=[];for(const j of n)switch(j.type){case Ot.Created:case Ot.Changed:R.push({path:j.path,contents:kd(await j.content)});break;case Ot.Deleted:I.push({path:j.path});break}const M={branch:{branchName:E,repositoryNameWithOwner:P},message:{headline:r},fileChanges:{additions:R,deletions:I},expectedHeadOid:v.HEAD.sha},N=`mutation($commitInput: CreateCommitOnBranchInput!) {
	createCommitOnBranch(input: $commitInput) {
		commit {
			oid
		}
		ref {
			name
		}
	}
}`,B=await this.graphql(N,{commitInput:M});if(m=B==null?void 0:B.createCommitOnBranch.commit.oid,!m)throw new di;return i===void 0&&!v.HEAD.detached&&m!==void 0&&await this.fastForwardTo(e,m,v),m}catch(v){if(v instanceof Xu){const E=(l=v.errors)==null?void 0:l[0];if((E==null?void 0:E.type)==="STALE_DATA"&&E.message.includes("Pull and try again"))throw new Li(v)}throw he.error(v),v}finally{d.stop(m?{message:`: Created and pushed commit ${m}`}:void 0)}}async createCommit(e,r,n,i){const a=new ce(`GitHub.createCommit(${e.toString()}${i?`, fork=${i.repo.owner}/${i.repo.name}`:""})`);if(n=n.filter(d=>d.fileType===_.FileType.File),n.length===0)throw a.stop({message:"Aborted; No changes to commit"}),new ui("No changes to commit");let l;try{const d=await this.getMetadata(e);let m,v,E;i?({repo:{owner:m,name:v}}=i,E=await this.getFileTree(this.createVirtualUri(e,i),d.HEAD.sha)):d.HEAD.type===ct.RemoteBranch&&d.HEAD.branch.remote.accessLevel>=Gt.Write?({owner:m,name:v}=d.HEAD.branch.remote.accessLevel===Gt.WriteToPullRequest?d.repo:d.HEAD.branch.remote.repo,E=await this.getFileTree(this.createVirtualUri(e,{repo:d.HEAD.branch.remote.repo}),d.HEAD.sha)):({repo:{owner:m,name:v}}=d,E=await this.getFileTree(e,d.HEAD.sha));const P=await E.getTreeSha();if(!Rr(P))throw new Error(`Unable to create commit based on tree sha ${P}`);a.logStep("Creating Blobs",{message:`: Committing ${n.length} changes onto commit ${d.HEAD.sha} based on tree ${P}`,suffix:" \u2022 Creating blobs..."});const R=[];async function I(j){var K;try{const ee=await this.request("POST /repos/{owner}/{repo}/git/blobs",{owner:m,repo:v,encoding:"base64",content:kd(await j.content),mediaType:{format:"raw"}});let te;if(j.type===Ot.Changed){const fe=await E.get(j.path);te=(K=fe==null?void 0:fe.mode)!=null?K:"100644"}else te="100644";R.push({path:j.path,mode:te,type:"blob",sha:ee.data.sha})}catch(ee){throw he.error(ee,`Failed to create blob for ${j.path}`),ee}}const M=[];for(const j of n)switch(j.type){case Ot.Created:case Ot.Changed:{M.push(I.call(this,j));break}case Ot.Deleted:{R.push({path:j.path,mode:"100644",type:"blob",sha:null});break}}await Promise.all(M),a.logStep("Creating tree",{message:`: Created ${M.length} blobs;`,suffix:` \u2022 Creating tree based on ${P}...`});const N=await this.request("POST /repos/{owner}/{repo}/git/trees",{owner:m,repo:v,base_tree:P,tree:R});return a.logStep("Creating commit",{message:`: Created tree ${N.data.sha};`,suffix:" \u2022 Creating commit..."}),l=(await this.request("POST /repos/{owner}/{repo}/git/commits",{owner:m,repo:v,message:r,tree:N.data.sha,parents:[d.HEAD.sha]})).data.sha,l}catch(d){throw he.error(d),d}finally{a.stop(l?{message:`: Created commit ${l}`}:void 0)}}async createPullRequest(e,r,n,i,a){var l,d,m;const v=new ce(`GitHub.createPullRequest(${e.toString()}, ${r}${a?`, fork=${a.repo.owner}/${a.repo.name}`:""})`);try{const{repo:{owner:E,name:P},HEAD:{branch:R},defaultBranch:I}=await this.getMetadata(e),M=await this.request("POST /repos/{owner}/{repo}/pulls",{owner:E,repo:P,base:`refs/heads/${(l=R==null?void 0:R.name)!=null?l:I.name}`,head:a?`${a.repo.owner}:${r}`:r,title:n,draft:(d=i==null?void 0:i.draft)!=null?d:!1,maintainer_can_modify:(m=i==null?void 0:i.canMaintainerModify)!=null?m:!0});return{id:M.data.number.toString(),uri:_.Uri.parse(M.data.html_url)}}catch(E){throw he.error(E),E}finally{v.stop()}}async fetch(e,r){const{fetched:n,metadata:i}=await this.fetchCore(e,!1,r);n&&await this.providerService.updateMetadata(e,i)}async fetchCore(e,r,n){var i,a,l,d,m,v,E,P,R;const{force:I,to:M}={...n,force:r||(n==null?void 0:n.force)},N=new ce(`GitHub.fetch(${e.toString()}, force=${I}, to=${M})`);let B;try{const j=await this.getMetadata(e);if(j.HEAD.detached)return B=" \u2022 Skipped; detached HEAD",{fetched:!1,metadata:j};const K=await this.getBranchTips(e);if(!K)throw B=" \u2022 Unable to fetch branch tips",new rn(r);if(!I&&!M&&((i=K.defaultBranch)==null?void 0:i.sha)!==void 0&&K.defaultBranch.sha===j.defaultBranch.sha&&((a=K.branch)==null?void 0:a.sha)!==void 0&&K.branch.sha===j.HEAD.branch.sha&&(j.HEAD.sha===j.HEAD.branch.sha||j.state!==void 0))return B=" \u2022 No changes detected",{fetched:!1,metadata:j};let ee;if(((l=K.defaultBranch)==null?void 0:l.sha)!==void 0&&K.defaultBranch.sha!==j.defaultBranch.sha&&(ee={defaultBranch:{...j.defaultBranch,sha:K.defaultBranch.sha}}),((d=K.branch)==null?void 0:d.sha)===void 0){if(B=" \u2022 Unable to find branch tip",I)throw new rn(r);return ee!==void 0?{fetched:!0,metadata:{...j,...ee}}:{fetched:!1,metadata:j}}if(K.branch.sha!==j.HEAD.branch.sha&&(ee={...ee,HEAD:{...j.HEAD,branch:{...j.HEAD.branch,sha:K.branch.sha},detached:void 0}}),K.branch.sha===((m=n==null?void 0:n.to)!=null?m:j.HEAD.sha))return B=" \u2022 Up to date",j.state!==void 0||ee!==void 0?{fetched:!0,metadata:{...j,...ee,state:void 0}}:{fetched:!1,metadata:j};N.logStep("Fetching upstream changes");try{const te=await this.getAheadBehindState(e,j,{base:(v=n==null?void 0:n.to)!=null?v:j.HEAD.sha,head:(R=(P=(E=ee==null?void 0:ee.HEAD)==null?void 0:E.branch)==null?void 0:P.sha)!=null?R:j.HEAD.branch.sha});return B=` \u2022 Changes detected; ${te==null?void 0:te.behind} commits behind`,{fetched:!0,metadata:{...j,...ee,state:te?{ahead:te.ahead,behind:te.behind,incomingChanges:te.incomingChanges}:void 0}}}catch(te){if(B=` \u2022 Failed fetching upstream changes; ${String(te)}`,I)throw new rn(r);return ee!==void 0?{fetched:!0,metadata:{...j,...ee}}:{fetched:!1,metadata:j}}}finally{N.stop(B?{suffix:B}:void 0)}}async fork(e){try{const{repo:{owner:r,name:n}}=await this.getMetadata(e),i=await this.request("POST /repos/{owner}/{repo}/forks",{owner:r,repo:n});let a;for(;;){try{if(a=await this.getRepositoryInfo(i.data.owner.login,i.data.name,!1),a!==void 0)break}catch{}await new Promise(l=>setTimeout(l,250))}return{name:`${i.data.owner.login}/${i.data.name}`,repo:{owner:i.data.owner.login,name:i.data.name},url:i.data.url}}catch(r){throw he.error(r),r}}async getBranches(e,r){var n,i,a;try{const{repo:{owner:l,name:d}}=await this.getMetadata(e),m=`query getBranches(
	$owner: String!
	$repo: String!
	$branchQuery: String!
	$cursor: String
	$limit: Int = 100
) {
	repository(owner: $owner, name: $repo) {
		refs(query: $branchQuery, refPrefix: "refs/heads/", first: $limit, after: $cursor) {
			pageInfo {
				endCursor
				hasNextPage
			}
			nodes {
				name
				target {
					oid
				}
			}
		}
	}
}`,v=await this.graphql(m,{owner:l,repo:d,branchQuery:(n=r==null?void 0:r.query)!=null?n:"",cursor:r==null?void 0:r.cursor,limit:Math.min(100,(i=r==null?void 0:r.limit)!=null?i:100)});if(v===void 0)return{branches:[]};const E=(a=v.repository)==null?void 0:a.refs;if(E===void 0)return{branches:[]};const P=E.nodes.map(R=>({type:Bi.Head,name:R.name,commit:R.target.oid,commitUrl:R.target.commitUrl}));return{paging:{cursor:E.pageInfo.endCursor,more:E.pageInfo.hasNextPage},branches:P}}catch(l){return{branches:[]}}}async getCommit(e,r){var n;try{const{HEAD:i,repo:{owner:a,name:l}}=await this.getMetadata(e),d=`query getCommit(
	$owner: String!
	$repo: String!
	$ref: GitObjectID!
) {
	repository(name: $repo owner: $owner) {
		object(oid: $ref) {
			...on Commit {
				oid
				message
				parents(first: 100) {
					nodes {
						oid
					}
				}
				author {
					date
					email
					name
				}
				committer {
					date
				}
			}
		}
	}
}`;r.toUpperCase()==="HEAD"&&(r=i.sha);const m=await this.graphql(d,{owner:a,repo:l,ref:r});if(m===void 0)return;const v=(n=m.repository)==null?void 0:n.object;return v===void 0?void 0:{hash:v.oid,message:v.message,parents:v.parents.nodes.map(E=>E.oid),authorDate:new Date(v.author.date),authorEmail:v.author.email,authorName:v.author.name,commitDate:new Date(v.committer.date)}}catch(i){return}}async getCommits(e,r){var n,i,a;try{const{HEAD:l,repo:{owner:d,name:m}}=await this.getMetadata(e),v=`query getCommits(
	$owner: String!
	$repo: String!
	$ref: GitObjectID!
	$path: String
	$cursor: String
	$limit: Int = 100
) {
	repository(name: $repo, owner: $owner) {
		object(oid: $ref) {
			... on Commit {
				history(first: $limit, path: $path, after: $cursor) {
					pageInfo {
						endCursor
						hasNextPage
					}
					nodes {
						... on Commit {
							...commit
						}
					}
				}
			}
		}
	}
}

fragment commit on Commit {
	oid
	message
	parents(first: 100) {
		nodes {
			oid
		}
	}
	author {
		date
		email
		name
	}
	committer {
		date
	}
}
`;let E=r==null?void 0:r.ref;(E==null?void 0:E.toUpperCase())==="HEAD"&&(E=l.sha);const P=await this.graphql(v,{owner:d,repo:m,ref:E,cursor:r==null?void 0:r.cursor,path:r==null?void 0:r.path,limit:Math.min(100,(n=r==null?void 0:r.limit)!=null?n:100)});if(P===void 0)return;const R=(a=(i=P.repository)==null?void 0:i.object)==null?void 0:a.history;if(R===void 0)return;const I=R.nodes.map(M=>({hash:M.oid,message:M.message,parents:M.parents.nodes.map(N=>N.oid),authorDate:new Date(M.author.date),authorEmail:M.author.email,authorName:M.author.name,commitDate:new Date(M.committer.date)}));return{paging:{cursor:R.pageInfo.endCursor,more:R.pageInfo.hasNextPage},commits:I}}catch(l){return}}async getBlobContent(e,r){try{const n=await this.request("GET /repos/{owner}/{repo}/git/blobs/{file_sha}",{owner:e.owner,repo:e.name,file_sha:r});return A0(n.data.content)}catch(n){throw he.logLevel===dt.Debug&&he.error(n),n}}async getFileContent(e,r,n){try{let i;if(r&&n&&!this.hasFileTree(e,r)){const a=this.providerService.getProviderRootUri(e);n.startsWith("/")&&(n=n.slice(1));let l=(0,Jw.dirname)(n);(l==="."||l==="/")&&(l=""),i=await(await this.getFileTree(a,r,{path:l,cache:!1,recursive:!1})).get(n)}else{const[a,{path:l}]=await Promise.all([this.getFileTree(e,r),n?{path:void 0}:this.providerService.getMetadata(e)]);i=await a.get(n!=null?n:l)}if((i==null?void 0:i.sha)===void 0)throw _.FileSystemError.FileNotFound(e);return await i.getContent()}catch(i){throw he.logLevel===dt.Debug&&he.error(i),i}}async getFileList(e,r,n){const i=new ce(`GitHub.getFileList(${e.toString()}${n?`, ${n}`:""})`);try{const{repo:{owner:a,name:l},HEAD:{sha:d}}=await this.getMetadata(e),m=await this.request("GET /repos/{owner}/{repo}/git/tree-file-list/{treeish}",{owner:a,repo:l,treeish:`${n!=null?n:d}${r?`:${r}`:""}`});return m.status!==200?[]:m.data}catch(a){return he.error(a),[]}finally{i.stop()}}hasFileTree(e,r){return r?this.fileTreeCache.has(this.asFileTreeKey(e,r)):this.getMetadata(e).then(n=>this.fileTreeCache.has(this.asFileTreeKey(e,n.HEAD.sha)))}async getFileTree(e,r,n){var i,a,l,d,m;const v=this.providerService.isInWorkspace(e);let E=(i=n==null?void 0:n.cache)!=null?i:v,P,R,I;if(E||!r){const j=(l=(a=n==null?void 0:n.prefetched)==null?void 0:a.metadata)!=null?l:this.getMetadata(e);P=v?this.getFileTreePermissions(e,j):void 0;let K;({repo:R,HEAD:{sha:K},timestamp:I}=(d=n==null?void 0:n.prefetched)!=null?d:await j),r&&K!==r?(E=!1,I=Date.now()):r=K}else({repo:R}=(m=n==null?void 0:n.prefetched)!=null?m:this.providerService.getVirtualUriMetadata(e)),I=Date.now();const M=this.asFileTreeKey(e,r),N=this.providerService.getProviderRootUri(e),B=new ce(`GitHub.getFileTree(${M}): ${e.toString()}`,{log:!1,logLevel:dt.Debug});try{let j=function(){var ee;const te=new ce(`GitHub.createFileTree(${M})`);let fe,$e;E&&v&&(fe=new _.EventEmitter,$e=_.Disposable.from(this.tarPit.onDidChangeIndexingEnablement(()=>fe.fire()),this.tarPit.onDidDownloadTar(Te=>fe.fire({rootUri:this.providerService.getProviderRootUri(Te.rootUri),sha:Te.sha}))));const Ae={dispose:()=>$e==null?void 0:$e.dispose(),permissions:P,getContent:Te=>this.getBlobContent(R,Te.sha),getTree:async(Te,qe)=>{try{const De=await this.request("GET /repos/{owner}/{repo}/git/trees/{tree_sha}",{owner:R.owner,repo:R.name,recursive:qe?"1":void 0,tree_sha:`${r}${Te?`:${Te}`:""}`});return De.data.truncated?{sha:De.data.sha,truncated:!0}:{sha:De.data.sha,truncated:!1,tree:go(De.data.tree,Be=>{var et;return{path:Be.path,item:{mode:Be.mode,sha:Be.sha,stat:{type:iE(Be.type),size:(et=Be.size)!=null?et:0,ctime:0,mtime:I,permissions:void 0}}}})}}catch(De){if(De instanceof Xi&&De.status===404)return;throw De}},onDidTriggerContentCaching:fe==null?void 0:fe.event,tryCachingContent:E&&v?async Te=>{const qe=Ne.get("experimental.fs.useTars");if(qe!=="always"&&qe!=="ifAvailable")return!1;const De=new ce(`FileTree.loadAllContent(${r})`);let Be;try{let et;if(qe==="ifAvailable"){if(De.logStep("Tar cache query"),et=await this.tarPit.getCachedTar(N,r),et===void 0)return Be=" \u2022 No cached Tar",!1}else De.logStep("Tar query"),et=await this.tarPit.getTar(N,r);De.logStep("Updating content",{suffix:" \u2022 Updating content..."});for(const cr of et.entries){const dn=Te(cr.header.fullFileName);if(dn===void 0)continue;const wi=cr.dataAsBytes;dn.getContent=()=>wi}return!0}catch(et){return Be=` \u2022 Failed ${String(et)}`,!1}finally{De.stop(Be?{suffix:Be}:void 0)}}:void 0};try{return new Bv(N,r,I,Ae,{path:n==null?void 0:n.path,recursive:(ee=n==null?void 0:n.recursive)!=null?ee:E,preload:E||(n==null?void 0:n.recursive)})}catch(Te){return he.error(Te),new Bv(N,r,I,void 0)}finally{te.stop()}},K=this.fileTreeCache.get(M);return K!==void 0||(K=j.call(this),E&&this.fileTreeCache.set(M,K)),K}finally{B.stop()}}async getFileTreePermissions(e,r){if(this.providerService.getModeConfig(e,await this.getModeRefType(e,r)).display===W.Edit)return;const i=await this.providerService.getIndexMetadata(e);return ga.isActive(i)?_.FilePermission.Readonly:void 0}async getFork(e){var r,n,i;try{const{repo:{owner:a,name:l}}=await this.getMetadata(e),d=`query getFork(
	$owner: String!
	$repo: String!
) {
	repository(owner: $owner, name: $repo) {
		forks(affiliations: OWNER, first: 1) {
			nodes {
				owner {
					login
				}
				name
				url
			}
		}
	}
}`,m=await this.graphql(d,{owner:a,repo:l});if(m===void 0)return;const[v]=(i=(n=(r=m.repository)==null?void 0:r.forks)==null?void 0:n.nodes)!=null?i:[];return v===void 0?void 0:{name:`${v.owner.login}/${v.name}`,repo:{owner:v.owner.login,name:v.name},url:v.url}}catch(a){return}}async getIncomingChanges(e){var r,n;return(n=(r=(await this.getMetadata(e)).state)==null?void 0:r.incomingChanges)!=null?n:[]}async compareCommits(e,r){const n=await this.getMetadata(e),i=await this.getAheadBehindState(e,n,{base:r.base,head:r.compare});return i==null?void 0:i.incomingChanges}async getAheadBehindState(e,r,n){var i,a,l,d,m;const{base:v,head:E}={base:r.HEAD.sha,head:(i=r.HEAD.branch)==null?void 0:i.sha,...n},P=new ce(`GitHub.getAheadBehindState(${e.toString()}, base=${v}, head=${E})`);let R,I;try{if(!E){R=` \u2022 Skipped; Unsupported HEAD type (${r.HEAD.type})`;return}const M=await this.request("GET /repos/{owner}/{repo}/compare/{base}...{head}",{owner:r.repo.owner,repo:r.repo.name,base:v,head:E}),N=[];for(const B of(a=M.data.files)!=null?a:[])switch(B.status){case"added":case"copied":N.push({uri:_.Uri.joinPath(e,B.filename),type:Ot.Created});break;case"removed":N.push({uri:_.Uri.joinPath(e,B.filename),type:Ot.Deleted});break;case"modified":N.push({uri:_.Uri.joinPath(e,B.filename),type:Ot.Changed});break;case"renamed":N.push({uri:_.Uri.joinPath(e,B.filename),type:Ot.Created}),N.push({uri:_.Uri.joinPath(e,B.previous_filename),type:Ot.Deleted});break;default:he.warn(`GitHub.getAheadBehindState(${e.toString()}, base=${v}, head=${E}): Unknown file status encountered '${B.status}'`);break}return I={ahead:(l=M.data.behind_by)!=null?l:0,behind:(d=M.data.ahead_by)!=null?d:0,incomingChanges:N},I}catch(M){throw R=` \u2022 Failed; ${String(M)}`,he.error(M),M}finally{P.stop({suffix:R!=null?R:` \u2022 ${(m=I==null?void 0:I.behind)!=null?m:0} commits behind`})}}async getObjectDetails(e,r,n){var i;try{const a=await this.getFileTree(e,r);n?n=this.providerService.getRelativeFilePath(e,this.providerService.createRelativeUri(e,n)):{path:n}=await this.providerService.getMetadata(e);const l=await a.get(n);if((l==null?void 0:l.mode)===void 0||(l==null?void 0:l.sha)===void 0)throw new Error(`Cannot get details of ${n} in ${r}`);return{mode:l.mode,object:l.sha,size:(i=l.stat.size)!=null?i:0}}catch(a){throw he.error(a),a}}async getPullRequest(e,r){const{repo:{owner:n,name:i}}=await this.getMetadata(e);return this.getPullRequestCore(n,i,r)}async getPullRequestCore(e,r,n){var i,a,l,d,m,v,E;try{const P=`query getPullRequest(
	$owner: String!
	$repo: String!
	$pr: Int!
) {
	repository(name: $repo, owner: $owner) {
		pullRequest(number: $pr) {
			author {
				login
				avatarUrl
				url
			}
			permalink
			number
			title
			state
			updatedAt
			closedAt
			mergedAt
			repository {
				name
				owner {
					login
				}
			}
			baseRef {
				name
			}
			baseRefName
			baseRefOid
			baseRepository {
				name
				owner {
					login
				}
			}
			headRef {
				name
			}
			headRefName
			headRefOid
			headRepository {
				name
				owner {
					login
				}
			}
			headRepositoryOwner {
				login
			}
		}
	}
}`,R=await this.graphql(P,{owner:e,repo:r,number:Number(n)}),I=(i=R==null?void 0:R.repository)==null?void 0:i.pullRequest;return I?{author:{name:I.author.login,avatarUrl:I.author.avatarUrl,url:I.author.url},closedAt:I.closedAt?new Date(I.closedAt):void 0,mergedAt:I.mergedAt?new Date(I.mergedAt):void 0,id:I.number.toString(),repo:{name:I.repository.name,owner:I.repository.owner.login},state:cp(I.state),title:I.title,updatedAt:new Date(I.updatedAt),url:I.permalink,refs:{base:{owner:I.baseRepository.owner.login,repo:I.baseRepository.name,branch:I.baseRefName,sha:I.baseRefOid,exists:I.baseRef!=null},head:{owner:(m=(d=(a=I.headRepository)==null?void 0:a.owner.login)!=null?d:(l=I.headRepositoryOwner)==null?void 0:l.login)!=null?m:"<unknown>",repo:(E=(v=I.headRepository)==null?void 0:v.name)!=null?E:I.baseRepository.name,branch:I.headRefName,sha:I.headRefOid,exists:I.headRef!=null}}}:void 0}catch(P){he.error(P);return}}async getPullRequestForBranch(e,r,n){var i,a,l,d,m;try{const{repo:{owner:v,name:E}}=await this.getMetadata(e),P=`query getPullRequestForBranch(
	$owner: String!
	$repo: String!
	$branch: String!
	$maxCount: Int!
	$states: [PullRequestState!]
) {
	repository(name: $repo, owner: $owner) {
		refs(query: $branch, refPrefix: "refs/heads/", first: 1) {
			nodes {
				associatedPullRequests(first: $maxCount, orderBy: {field: UPDATED_AT, direction: DESC}, states: $states) {
					nodes {
						author {
							login
							avatarUrl
							url
						}
						permalink
						number
						title
						state
						updatedAt
						closedAt
						mergedAt
						repository {
							isFork
							name
							owner {
								login
							}
						}
					}
				}
			}
		}
	}
}`,R=await this.graphql(P,{owner:v,repo:E,branch:r,maxCount:(i=n==null?void 0:n.maxCount)!=null?i:1,states:nE(n==null?void 0:n.include)}),I=(m=(d=(l=(a=R==null?void 0:R.repository)==null?void 0:a.refs.nodes[0])==null?void 0:l.associatedPullRequests)==null?void 0:d.nodes)==null?void 0:m.filter(N=>!N.repository.isFork||N.repository.owner.login===v);if(I==null||I.length===0)return;I.length>1&&I.sort((N,B)=>(N.repository.owner.login===v?-1:1)-(B.repository.owner.login===v?-1:1)||(N.state==="OPEN"?-1:1)-(B.state==="OPEN"?-1:1)||new Date(B.updatedAt).getTime()-new Date(N.updatedAt).getTime());const[M]=I;return{author:{name:M.author.login,avatarUrl:M.author.avatarUrl,url:M.author.url},closedAt:M.closedAt?new Date(M.closedAt):void 0,mergedAt:M.mergedAt?new Date(M.mergedAt):void 0,id:M.number.toString(),repo:{name:M.repository.name,owner:M.repository.owner.login},state:cp(M.state),title:M.title,updatedAt:new Date(M.updatedAt),url:M.permalink}}catch(v){he.error(v);return}}async getTags(e,r){var n,i,a;try{const{repo:{owner:l,name:d}}=await this.getMetadata(e),m=`query getTags(
	$owner: String!
	$repo: String!
	$tagQuery: String!
	$cursor: String
	$limit: Int = 100
) {
	repository(owner: $owner, name: $repo) {
		refs(query: $tagQuery, refPrefix: "refs/tags/", first: $limit, after: $cursor, orderBy: { field: TAG_COMMIT_DATE, direction: DESC }) {
			pageInfo {
				endCursor
				hasNextPage
			}
			nodes {
				name
				target {
					oid
				}
			}
		}
	}
}`,v=await this.graphql(m,{owner:l,repo:d,tagQuery:(n=r==null?void 0:r.query)!=null?n:"",cursor:r==null?void 0:r.cursor,limit:Math.min(100,(i=r==null?void 0:r.limit)!=null?i:100)});if(v===void 0)return{tags:[]};const E=(a=v.repository)==null?void 0:a.refs;if(E===void 0)return{tags:[]};const P=E.nodes.map(R=>({type:Bi.Tag,name:R.name,commit:R.target.oid,commitUrl:R.target.commitUrl}));return{paging:{cursor:E.pageInfo.endCursor,more:E.pageInfo.hasNextPage},tags:P}}catch(l){return{tags:[]}}}async getTarGz(e){var r;const{repo:{owner:n,name:i},HEAD:{sha:a}}=await this.getMetadata(e),l=await this.ensureAuthenticated();try{if(So){const v=Ne.get("search.download.corsProxy")||void 0;if(typeof v=="string")throw Error("Error: using outdated `search.download.corsProxy` setting. Please update to new object based configuration.");const E=(r=v==null?void 0:v["github.com"])!=null?r:"vscode.dev";if(E){const P=`https://${E}/indexes/github2/${n}/${i}/${a}`,I=await(await zn(P,{headers:{"x-proxy-authorization":`Bearer ${l.accessToken}`},credentials:"include"})).text(),M=await zn(I);return new Uint8Array(await M.arrayBuffer())}}const d=`https://api.github.com/repos/${n}/${i}/tarball/${a}`,m=await zn(d,{headers:{Authorization:`Bearer ${l.accessToken}`}});return new Uint8Array(await m.arrayBuffer())}catch(d){throw he.error(d),d}}async pushCommit(e,r,n,i){const a=new ce(`GitHub.pushCommit(${e.toString()}, sha=${r}${n?`, ref=${n}`:""}${i?`, fork=${i.repo.owner}/${i.repo.name}`:""})`);let l;try{const d=await this.getMetadata(e);let m,v;if(i?{repo:{owner:m,name:v}}=i:d.HEAD.type===ct.RemoteBranch&&d.HEAD.branch.remote.accessLevel>=Gt.Write?{owner:m,name:v}=d.HEAD.branch.remote.repo:{repo:{owner:m,name:v}}=d,n===void 0&&d.HEAD.detached)throw new li("Unable to commit; no current branch");(n==null?void 0:n.startsWith("refs/heads/"))&&(n=n.substr(11));const E=await this.request("PATCH /repos/{owner}/{repo}/git/refs/{ref}",{owner:m,repo:v,ref:`heads/${n!=null?n:d.HEAD.branch.name}`,sha:r});return n===void 0&&!d.HEAD.detached&&await this.fastForwardTo(e,r,d),l=E.data.ref,l}catch(d){throw d instanceof Xi&&d.status===422&&d.message.includes("Update is not a fast forward")?new Li(d):(he.error(d),d)}finally{a.stop(l?{message:`: Pushed commit to ${l}`}:void 0)}}async queryRepositoryObject(e,r,n,i){var a,l;try{const{repo:{owner:d,name:m},HEAD:{sha:v},path:E}=await this.providerService.getMetadata(e),P=`query ${r}(
	$owner: String!
	$repo: String!
	$expression: String
) {
	repository(owner: $owner, name: $repo) {
		object(expression: $expression) {
			${n}
		}
	}
}`,R=await this.graphql(P,{owner:d,repo:m,expression:i!=null?i:`${v}:${E}`});return(l=(a=R==null?void 0:R.repository)==null?void 0:a.object)!=null?l:void 0}catch(d){he.error(d);return}}async repositoryObjectExists(e,r){return await this.queryRepositoryObject(e,"exists","			__typename",r)!==void 0}async searchPullRequestsQuery(e,r){try{let n=function(d,m){return{number:d.number,title:d.title,repoWithOwner:d.repository.nameWithOwner,reasons:m?[m]:[],url:d.url}};const i=`query searchPullRequests(
	$authored: String!
	$assigned: String!
	$reviewRequested: String!
	$mentioned: String!
) {
	viewer {
		repositories(first: 100, orderBy: { field: STARGAZERS, direction: DESC }) {
			nodes {
				pullRequests(first: 100, states: OPEN, orderBy: { field: UPDATED_AT, direction: DESC }) {
					nodes {
						number
						title
						url
						repository {
							nameWithOwner
						}
					}
				}
			}
		}
	}
	authored: search(first: 100, query: $authored, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	assigned: search(first: 100, query: $assigned, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	reviewRequested: search(first: 100, query: $reviewRequested, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	mentioned: search(first: 100, query: $mentioned, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
}`;e=e.trim(),(r==null?void 0:r.user)&&(e+=` user:${r.user}`);const a=await this.graphql(i,{authored:(e?`${e} is:pr is:open archived:false author:@me`:"is:pr is:open archived:false author:@me").trim(),assigned:(e?`${e} is:pr is:open archived:false assignee:@me`:"is:pr is:open archived:false assignee:@me").trim(),reviewRequested:(e?`${e} is:pr is:open archived:false review-requested:@me`:"is:pr is:open archived:false review-requested:@me").trim(),mentioned:(e?`${e} is:pr is:open archived:false mentions:@me`:"is:pr is:open archived:false mentions:@me").trim()});return a===void 0?[]:rp([...a.assigned.nodes.map(d=>n(d,"assigned")),...a.reviewRequested.nodes.map(d=>n(d,"review requested")),...a.mentioned.nodes.map(d=>n(d,"mentioned")),...a.authored.nodes.map(d=>n(d,"authored")),...vn(a.viewer.repositories.nodes,d=>d.pullRequests.nodes.map(m=>n(m)))],d=>d.url,(d,m)=>(m.reasons.length!==0&&d.reasons.push(...m.reasons),d))}catch(n){return[]}}async searchRepositoriesQuery(e,r){try{const n=`query searchRepositories(
	$search: String!
) {
	viewer {
		repositories(first: 100, orderBy: { field: UPDATED_AT, direction: DESC }) {
			nodes {
				nameWithOwner
				description
				url
				parent {
					nameWithOwner
				}
				stargazerCount
			}
		}
	}
	search(first: 100, query: $search, type: REPOSITORY) {
		nodes {
			...on Repository {
				nameWithOwner
				description
				url
				parent {
					nameWithOwner
				}
				stargazerCount
			}
		}
	}
}`;(r==null?void 0:r.user)&&(e+=` user:${r.user}`),(r==null?void 0:r.sort)&&(e+=` sort:${r.sort}`),e+=" fork:true";const i=await this.graphql(n,{search:e.trim()});return i===void 0?[]:rp((r==null?void 0:r.user)?[...i.search.nodes,...i.viewer.repositories.nodes]:[...i.viewer.repositories.nodes,...i.search.nodes],l=>l.url).map(l=>{var d,m,v;return{repoWithOwner:l.nameWithOwner,description:(d=l.description)!=null?d:void 0,url:l.url,fork:(v=(m=l.parent)==null?void 0:m.nameWithOwner)!=null?v:void 0,stars:l.stargazerCount}})}catch(n){return[]}}async searchCodeQuery(e,r,n){var i,a,l;const{repo:{owner:d,name:m},HEAD:v,defaultBranch:E}=await this.getMetadata(r),P=[];((i=v.branch)==null?void 0:i.name)!==E.name&&P.push(Yu("Cant search branch","Unable to search {0} without index, falling back to {1}.",(l=(a=v.branch)==null?void 0:a.name)!=null?l:v.detached.name,E.name));try{const I=await(await this.octokit({request:{headers:{authorization:`Bearer ${(await this.ensureAuthenticated()).accessToken}`,accept:"application/vnd.github.v3.text-match+json"}}})).request("GET /search/code",{q:`${e} repo:${d}/${m}`}),M=new _.Range(0,0,0,0),N=[];let B=0,j;for(const K of I.data.items)for(const ee of K.text_matches){if(B++,n.maxResults!==void 0&&B>n.maxResults)return{matches:N,limitHit:!0};j={path:K.path,ranges:[],preview:ee.fragment,matches:[]};for(const te of ee.matches){let fe=0,$e=0,Ae=0;for(let Te=0;Te<te.indices[1];Te++)Te===te.indices[0]&&($e=Ae),ee.fragment[Te]===`
`?(fe++,Ae=0):Ae++;j.ranges.push(M),j.matches.push(new _.Range(fe,$e,fe,Ae))}N.push(j)}return{matches:N,limitHit:!1,warnings:P}}catch(R){return{matches:[],limitHit:!0}}}async switchTo(e,r,n){const{name:i,repo:a,HEAD:{branch:l}}=await this.getMetadata(e);let d;if(!(r!==void 0&&(typeof r=="string"?(r==null?void 0:r.startsWith("refs/heads/"))?(d={type:Ye.Tree,id:r.substr(11)},r=r.substr(11)):(r==null?void 0:r.startsWith("refs/tags/"))?d={type:Ye.Tree,id:r.substr(10)}:d={type:Ye.Tree,id:r}:d={...r,type:r.type===Ye.Branch||r.type===Ye.Tag?Ye.Tree:r.type},(l==null?void 0:l.name)===d.id)))return{name:i,uri:this.providerService.createVirtualUri(e,{repo:a,ref:d}),location:(n==null?void 0:n.openInNewWindow)?nr.NewWindow:nr.CurrentWindow}}async sync(e,r,n){var i,a,l,d,m,v;const E=new ce(`GitHub.sync(${e.toString()}, resolution=${n.conflictResolution}, to=${n.to})`);let P;try{const{metadata:R}=await this.fetchCore(e,!0,{to:n.to});if(R.HEAD.detached){P=" \u2022 Skipped; detached HEAD";return}if(((a=(i=R==null?void 0:R.state)==null?void 0:i.behind)!=null?a:0)>0&&await r.hasChanges(e)){E.logStep("Fetching upstream changes");const I=[],M=(d=(l=R.state)==null?void 0:l.incomingChanges)!=null?d:[];if(M.length>0){const N=await r.getChanges(e);for(const B of N){const j=this.providerService.getRelativeFilePath(e,B.uri),K=M.find(ee=>ee.uri.path===j);if(K!==void 0){I.push({path:j,current:B,incomingType:K.type});break}}}if(I.length>0)switch(n.conflictResolution){case sr.KeepCurrent:E.logStep("Syncing (keep) upstream changes",{message:`: ${I.length} conflicts; \u2022`,suffix:" \u2022 Syncing (keep) upstream changes..."});for(const N of I)await r.keep(N.current.uri,{type:N.incomingType,providerUri:ap(R,R.HEAD.branch.sha,N.path)});break;case sr.DiscardCurrent:E.logStep("Syncing (discard) upstream changes",{message:`: ${I.length} conflicts; \u2022`,suffix:" \u2022 Syncing (discard) upstream changes..."});for(const N of I)await r.discard(N.current.uri);break;case sr.Merge:E.logStep("Syncing (merge) upstream changes",{message:`: ${I.length} conflicts; \u2022`,suffix:" \u2022 Syncing (merge) upstream changes..."});for(const N of I)await r.merge(N.current.uri,{type:N.incomingType,providerUri:ap(R,R.HEAD.branch.sha,N.path)},{providerUri:ap(R,R.HEAD.sha,N.path)});break;case sr.Abort:default:throw E.logStep("Syncing (abort) upstream changes",{message:`: ${I.length} conflicts; \u2022`,suffix:" \u2022 Syncing (abort) upstream changes..."}),await this.providerService.updateMetadata(e,R),new In}}P=` \u2022 to=${(m=n.to)!=null?m:R.HEAD.branch.sha}`,await this.fastForwardTo(e,(v=n.to)!=null?v:R.HEAD.branch.sha,R)}finally{E.stop(P?{suffix:P}:void 0)}}async fastForwardTo(e,r,n){if(n.HEAD.detached)throw new li("Unable to fast-forward; no current branch");if(n.HEAD.sha===r&&n.state===void 0)return;const i=this.asFileTreeKey(e,n.HEAD.sha),a=this.fileTreeCache.get(i);this.fileTreeCache.delete(i),a==null||a.dispose(),he.log(`Fast forward to ${r}; rootUri=${e.toString()}`),await this.providerService.updateMetadata(e,{...n,HEAD:{...n.HEAD,detached:void 0,sha:r},state:r!==n.HEAD.branch.sha?n.state:void 0,timestamp:Date.now()}),r!==n.HEAD.branch.sha&&n.state===void 0&&await this.fetchCore(e,!1,{to:r})}async getBranchTips(e,r){try{const{repo:{owner:n,name:i},HEAD:a}=await this.getMetadata(e);r===void 0&&(a.type===ct.RemoteBranch?r=`${a.branch.remote.repo.owner}/${a.branch.remote.repo.name}:refs/heads/${a.branch.name}`:r=a.branch?`refs/heads/${a.branch.name}`:"");const l=qv.exec(r);if(l==null?void 0:l.groups)return this.getRemoteBranchTips(n,i,r);const d=`query getBranchTips(
	$owner: String!
	$repo: String!
	$ref: String!
) {
	repository(owner: $owner, name: $repo) {
		defaultBranchRef {
			target {
				oid
			}
		}
		ref(qualifiedName: $ref) {
			target {
				oid
			}
		}
	}
}`,m=await this.graphql(d,{owner:n,repo:i,ref:r});if((m==null?void 0:m.repository)==null)return;const{defaultBranchRef:v,ref:E}=m.repository;return!v&&!E?void 0:{defaultBranch:v?{sha:v.target.oid}:void 0,branch:E?{sha:E.target.oid}:void 0}}catch(n){return}}async getRemoteBranchTips(e,r,n){try{const i=qv.exec(n);if((i==null?void 0:i.groups)==null)return;let{remoteOwner:a,remoteRepo:l,remoteRef:d}=i.groups;l||(l=r);const m=`query getRemoteBranchTips(
	$owner: String!
	$repo: String!
	$remoteOwner: String!
	$remoteRepo: String!
	$remoteRef: String!
) {
	repository(owner: $owner, name: $repo) {
		defaultBranchRef {
			target {
				oid
			}
		}
	}
	remote: repository(owner: $remoteOwner, name: $remoteRepo) {
		ref(qualifiedName: $remoteRef) {
			target {
				oid
			}
		}
	}
}`,v=await this.graphql(m,{owner:e,repo:r,remoteOwner:a,remoteRepo:l,remoteRef:d});if((v==null?void 0:v.repository)==null||(v==null?void 0:v.remote)==null)return;const{repository:{defaultBranchRef:E},remote:{ref:P}}=v;return!E&&!P?void 0:{defaultBranch:E?{sha:E.target.oid}:void 0,branch:P?{sha:P.target.oid}:void 0}}catch(i){return}}async getRepositoryInfo(e,r,n,i){var a,l,d,m,v,E,P,R,I,M,N,B,j,K,ee,te;try{const fe=`number
title
state
maintainerCanModify
baseRef { name }
baseRefName
baseRefOid
baseRepository {
	name
	owner { login }
	defaultBranchRef {
		name
		target { oid }
	}
	viewerPermission
}
headRef { name }
headRefName
headRefOid
headRepository {
	name
	owner { login }
	defaultBranchRef {
		name
		target { oid }
	}
	viewerPermission
}
mergeCommit { oid }
`,$e=`query getRepository(
	$owner: String!
	$repo: String!
	$ref: String = ""
	$has_pr: Boolean!
	$pr: Int = 0
) {
	viewer { login }
	repository(owner: $owner, name: $repo) {
		name
		owner { login }
		defaultBranchRef {
			name
			target { oid }
		}
		ref(qualifiedName: $ref) {
			name
			prefix
			target { oid }
		}
		viewerPermission
		pullRequest(number: $pr) @include(if: $has_pr) {
			${fe}
		}
	}
}`;let Ae,Te;try{const et=await this.graphql($e,{owner:e,repo:r,ref:(i==null?void 0:i.ref)!=="HEAD"?i==null?void 0:i.ref:void 0,has_pr:Boolean(i==null?void 0:i.pr),pr:(a=i==null?void 0:i.pr)!=null?a:0});if((et==null?void 0:et.repository)==null)return;({repository:Te,viewer:{login:Ae}}=et)}catch(et){if((i==null?void 0:i.pr)&&et instanceof Xu&&((d=(l=et.errors)==null?void 0:l[0])==null?void 0:d.type)==="NOT_FOUND"&&((m=et.errors[0])==null?void 0:m.message.includes("Could not resolve to a PullRequest"))){({repository:Te,viewer:{login:Ae}}=et.data);try{const cr=await this.graphql(`query getPullRequestFromParentRepository(
	$owner: String!
	$repo: String!
	$pr: Int!
) {
	repository(owner: $owner, name: $repo) {
		parent {
			pullRequest(number: $pr) {
				${fe}
			}
		}
	}
}`,{owner:e,repo:r,pr:i==null?void 0:i.pr});if(((E=(v=cr==null?void 0:cr.repository)==null?void 0:v.parent)==null?void 0:E.pullRequest)==null)throw et;Te.pullRequest=cr.repository.parent.pullRequest}catch{throw et}}else throw et}const qe=(P=Te.defaultBranchRef)!=null?P:void 0;if((qe==null?void 0:qe.name)==null)return;const De=Te.pullRequest;let Be;if(Te==null?void 0:Te.ref)Be={prefix:Te.ref.prefix,name:Te.ref.name,sha:Te.ref.target.oid};else if(De==null?void 0:De.headRef){let et=lp(De.headRepository.viewerPermission);et<Gt.Write&&De.maintainerCanModify&&lp(Te.viewerPermission)>=Gt.Write&&(et=Gt.WriteToPullRequest),Be=De.headRepository.owner.login===e?{prefix:"refs/heads/",name:De==null?void 0:De.headRef.name,sha:(I=(R=De.mergeCommit)==null?void 0:R.oid)!=null?I:De==null?void 0:De.headRefOid}:{prefix:"refs/remotes/",name:De==null?void 0:De.headRef.name,sha:(N=(M=De.mergeCommit)==null?void 0:M.oid)!=null?N:De==null?void 0:De.headRefOid,remote:{name:`${De.headRepository.owner.login}/${De.headRepository.name}`,accessLevel:et,repo:{owner:De.headRepository.owner.login,name:De.headRepository.name}}}}else(De==null?void 0:De.baseRef)?(Be={prefix:"refs/heads/",name:De==null?void 0:De.baseRef.name,sha:(j=(B=De.mergeCommit)==null?void 0:B.oid)!=null?j:De==null?void 0:De.baseRefOid},n&&(he.log("Did not find a headRef for PR, falling back to baseRef",De.baseRef),an.showPullRequestHeadNotFoundMessage(`${e}/${r}`,`#${i==null?void 0:i.pr}`))):(i==null?void 0:i.ref)==="HEAD"&&(Be={prefix:"refs/heads/",name:qe.name,sha:qe.target.oid});return{user:Ae,repo:{owner:Te.owner.login,name:Te.name},accessLevel:lp(Te.viewerPermission),ref:Be,defaultBranch:{name:qe.name,sha:qe.target.oid},pullRequest:De?{id:De.number.toString(),state:cp(De.state),title:De.title}:void 0}}catch(fe){if(fe instanceof Xu)switch((ee=(K=fe.errors)==null?void 0:K[0])==null?void 0:ee.type){case"NOT_FOUND":{if((i==null?void 0:i.pr)&&((te=fe.errors[0])==null?void 0:te.message.includes("Could not resolve to a PullRequest"))){const Ae=new en(fe,`${e}/${r}`,`#${i==null?void 0:i.pr}`);throw n&&an.showPullRequestNotFoundMessage(Ae.name,Ae.id),Ae}const $e=new Mi(fe,`${e}/${r}`);throw n&&an.showRepositoryNotFoundMessage($e.name),$e}case"FORBIDDEN":{const $e=new Ni(fe,`${e}/${r}`);throw n&&an.showRepositoryForbiddenMessage($e.name),$e}}he.error(fe,`Failed to get repository info for '${e}/${r}'`),!this.handleRequestErrors(fe)&&n&&an.showUnableToOpenRepositoryMessage(fe);return}}async validateOwnerAndRepoAndSplitRefFromPath(e,r,n){try{const i=await this.request(`GET /repos/{owner}/{repo}/git/extract-ref/${n!=null?n:"HEAD"}`,{owner:e,repo:r});return[e,r]=i.data.name_with_owner.split("/"),n?{owner:e,repo:r,ref:{type:Ye.Tree,id:i.data.ref},path:i.data.path}:{owner:e,repo:r}}catch(i){if(i instanceof Xi)switch(i.status){case 401:throw new Ur(i,()=>void this.reauthenticate());case 403:throw new Ni(i,`${e}/${r}`);case 404:throw new Mi(i,`${e}/${r}`);case 409:throw new tn(i,`${e}/${r}`)}return}}asFileTreeKey(e,r){return`${fr(this.providerService.getProviderRootUri(e))}:${r}`}}Uv([qr()],sp.prototype,"ensureAuthenticated",1),Uv([qr()],sp.prototype,"octokit",1);function cp(t){switch(t){case"OPEN":return Un.Open;case"CLOSED":return Un.Closed;case"MERGED":return Un.Merged}}function nE(t){if(t!==void 0)return t.map(e=>{switch(e){case Un.Open:return"OPEN";case Un.Closed:return"CLOSED";case Un.Merged:return"MERGED"}})}var Ds;(function(t){t.ADMIN="ADMIN",t.MAINTAIN="MAINTAIN",t.WRITE="WRITE",t.TRIAGE="TRIAGE",t.READ="READ",t.NONE="NONE"})(Ds||(Ds={}));function lp(t){switch(t){case Ds.ADMIN:return Gt.Admin;case Ds.MAINTAIN:return Gt.Maintain;case Ds.WRITE:return Gt.Write;case Ds.TRIAGE:return Gt.Triage;case Ds.READ:return Gt.Read;default:return Gt.None}}function iE(t){switch(t&&(t=t.toLocaleLowerCase()),t){case"blob":return _.FileType.File;case"tree":return _.FileType.Directory;default:return _.FileType.Unknown}}const Wv=class{constructor(t,e,r){this.providerService=t,this.storageService=e,this.changeStore=r,this.lock=new bd("PendingRepositoryOpenActions"),this.disposable=_.Disposable.from(t.onDidChangeRepositories(n=>n.added.length&&this.onRepositoriesOpened(n.added)))}dispose(){this.disposable.dispose()}async onRepositoriesOpened(t){for(const e of t){const r=await this.getAndDelete(e);(r==null?void 0:r.applyChangeset)&&await this.applyPendingChangeset(e,r.applyChangeset),(r==null?void 0:r.filesToOpen)&&this.openPendingFiles(e.uri,r.filesToOpen),this.fetchOrSync(e)}}async fetchOrSync(t){await this.changeStore.hasChanges(t.uri)?await this.providerService.fetch(t.uri):await this.providerService.sync(t.uri,this.changeStore,{reason:"invoked"})}async get(t){return this.lock.synchronizeRead(()=>this.getCore(t.uri),"PendingRepositoryOpenActions.get")}async getAndDelete(t){he.debug(`RepositoryOpenActionsService.getAndDelete(${t.uri.toString()})`);try{return await this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t.uri);if(r!==void 0)return await this.storeCore(t.uri,void 0),r},"PendingRepositoryOpenActions.getAndDelete")}catch(e){he.error(e,`Failed to get pending actions for ${t.uri.toString()}`);return}}async openPendingFiles(t,e){if(e.length!==0){he.log(`RepositoryOpenActionsService.openPendingFiles(${t.toString()})`,e.join(","));for(let r of e){const n=/:(?<start>\d+)(?:-(?<end>\d+))?$/.exec(r);let i,a;(n==null?void 0:n.groups)!==void 0&&(i=Number(n.groups.start),isNaN(i)&&(i=void 0),a=Number(n.groups.end),isNaN(a)&&(a=void 0),r=r.substring(0,n.index));const l=_.Uri.joinPath(t,r);let d;try{d=await _.workspace.fs.stat(l)}catch{}if((d==null?void 0:d.type)===_.FileType.Directory)_.commands.executeCommand("revealInExplorer",l);else{let m;i!==void 0&&(m={selection:new _.Range(Number(i)-1,0,a!=null?a:i,0)}),_.commands.executeCommand("vscode.open",l,m)}}}}setChangesetToApply(t,e){return he.log(`RepositoryOpenActionsService.setChangesetToApply(${t.toString()})`),this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t);await this.storeCore(t,{...r,applyChangeset:e})},"PendingRepositoryOpenActions.setChangesetToApply")}setPendingFilesToOpen(t,e){return he.log(`RepositoryOpenActionsService.setPendingFilesToOpen(${t.toString()})`,e.length),this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t);await this.storeCore(t,{...r,filesToOpen:e})},"PendingRepositoryOpenActions.setPendingFilesToOpen")}async applyPendingChangeset(t,e){he.log(`RepositoryOpenActionsService.applyPendingChangeset(${t.uri.toString()})`);try{await this.changeStore.applyChangeset(t.uri,e,{save:!0})}catch(r){he.error(r,`Failed to apply pending changeset for ${t.uri.toString()}`)}}async getCore(t){return this.fromStorage(await this.storageService.get(this.getStorageKey(t)))}storeCore(t,e){return e===void 0||e.applyChangeset===void 0&&(e.filesToOpen===void 0||e.filesToOpen.length===0)?this.storageService.delete(this.getStorageKey(t)):this.storageService.store(this.getStorageKey(t),this.toStorage(e))}getStorageKey(t){return`actions/${Oe(t)}`}fromStorage(t){if(!!t)try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&Lt(n)?_.Uri.from(n):n);return{filesToOpen:e.filesToOpen,applyChangeset:e.applyChangeset}}catch(e){return he.error(e,"Failed to deserialize pending repository actions"),{}}}toStorage(t){const e={schemaVersion:Wv.storageSchemaVersion,...t};return JSON.stringify(e)}};let Gv=Wv;Gv.storageSchemaVersion=1;const Kn=(0,F.loadMessageBundle)();class oE{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChangeFileDecorations=new _.EventEmitter,this._decorations=new Map,this.disposable=_.Disposable.from(_.window.registerFileDecorationProvider(this),e.onDidChangeRepository(this.onRefresh,this),e.onDidRefresh(this.onRefresh,this),r.onDidChange(this.onUrisChanged,this))}get onDidChangeFileDecorations(){return this._onDidChangeFileDecorations.event}dispose(){this.disposable.dispose(),this._decorations.clear()}onRefresh(){this._decorations.clear(),setTimeout(()=>this._onDidChangeFileDecorations.fire(void 0),0)}onUrisChanged(e){const r=e.map(({uri:n})=>(this._decorations.delete(Oe(n)),n));setTimeout(()=>this._onDidChangeFileDecorations.fire(r),0)}async provideFileDecoration(e,r){if(e.scheme!==Dt.scheme)return;const n=Oe(e);let i=this._decorations.get(n);if(i!==void 0)return i!=null?i:void 0;const a=await this.providerService.getIncomingChanges(this.providerService.getVirtualRootUri(e));let l;a.length>0&&(l=a.find(m=>Oe(m.uri)===n));const d=await this.changeStore.getChange(e);if(d===void 0){if(l!==void 0)switch(l.type){case Ot.Created:i={badge:"\u2193A",color:new _.ThemeColor("remoteHub.decorations.incomingAddedForegroundColor"),tooltip:Kn("decoration tooltip incoming change added","Pending Incoming Changes (Added)")};break;case Ot.Deleted:i={badge:"\u2193D",color:new _.ThemeColor("remoteHub.decorations.incomingDeletedForegroundColor"),tooltip:Kn("decoration tooltip incoming change deleted","Pending Incoming Changes (Deleted)")};break;case Ot.Changed:i={badge:"\u2193M",color:new _.ThemeColor("remoteHub.decorations.incomingModifiedForegroundColor"),tooltip:Kn("decoration tooltip incoming change modified","Pending Incoming Changes (Modified)")};break;default:i={badge:"\u2193~",color:new _.ThemeColor("remoteHub.decorations.incomingModifiedForegroundColor"),tooltip:Kn("decoration tooltip incoming change","Pending Incoming Changes")};break}return this._decorations.set(n,i!=null?i:null),i}if(d.conflicts)i={badge:"\u26A0",color:new _.ThemeColor("remoteHub.decorations.conflictForegroundColor"),tooltip:Kn("decoration tooltip conflicts","Merge Conflicts ({0})",Dy(d.conflicts.status))};else if(l!==void 0)switch(l.type){case Ot.Created:i={badge:"\u26A0",color:new _.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:Kn("decoration tooltip possible conflict added","Possible Merge Conflicts (Added)")};break;case Ot.Deleted:i={badge:"\u26A0",color:new _.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:Kn("decoration tooltip possible conflict deleted","Possible Merge Conflicts (Deleted)")};break;case Ot.Changed:i={badge:"\u26A0",color:new _.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:Kn("decoration tooltip possible conflict","Possible Merge Conflicts")};break;default:i={badge:"\u26A0",color:new _.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:Kn("decoration tooltip possible conflict","Possible Merge Conflicts")}}else switch(d.type){case Ot.Created:i={badge:"A",color:new _.ThemeColor("remoteHub.decorations.addedForegroundColor"),tooltip:Kn("decoration tooltip added","Added")};break;case Ot.Changed:i={badge:"M",color:new _.ThemeColor("remoteHub.decorations.modifiedForegroundColor"),tooltip:Kn("decoration tooltip modified","Modified")};break;case Ot.Deleted:i={badge:"D",color:new _.ThemeColor("remoteHub.decorations.deletedForegroundColor"),tooltip:Kn("decoration tooltip deleted","Deleted")};break}return this._decorations.set(n,i!=null?i:null),i}}class ks{constructor(e){this.command=e}get label(){return this.command.title}async execute(){var e;return void await _.commands.executeCommand(this.command.command,...(e=this.command.arguments)!=null?e:[])}}var gh;(function(t){async function e(r,n,i,a,l,d){let m;Array.isArray(l)?m=l:d===void 0&&(m=[],d=l);const v=_.window.createQuickPick(),E=new Bh(500),P=[E],{defaultBranch:R,HEAD:I}=await r.getMetadata(n);async function M(ee){var te;const[fe,$e,Ae]=await Promise.all([r.getBranches(n,{query:ee,limit:100}),r.getTags(n,{query:ee,limit:100}),r.getSnapshots(n)]),Te=new Set,qe=new Set;for(const Be of Ae)Te.add(Be.hash),qe.add(Be.branch.name);const De=((d==null?void 0:d.filterBranches)?fe.branches.filter(d==null?void 0:d.filterBranches):fe.branches).filter(Be=>Be.name!==R.name);return[...m,...((te=I.branch)==null?void 0:te.name)!==R.name?[{label:`$(git-branch) ${R.name} (default)`,description:`\u2022$(git-commit) ${pr(R.sha)}${qe.has(R.name)||Te.has(R.sha)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,alwaysShow:!0,type:Ye.Branch,name:void 0,sha:R.sha}]:[],...De.map(Be=>({label:`$(git-branch) ${Be.name}`,description:`\u2022$(git-commit) ${pr(Be.commit)}${qe.has(Be.name)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,type:Ye.Branch,name:Be.name,sha:Be.commit})),...$e.tags.map(Be=>({label:`$(tag) ${Be.name}`,description:`\u2022$(git-commit) ${pr(Be.commit)}${Te.has(Be.commit)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,type:Ye.Tag,name:Be.name,sha:Be.commit}))]}const N=M(void 0);let B,j=!1;async function K(ee){B=void 0;const te=v.activeItems;v.items=ee!=null?ee:await N,j&&te.length!==0&&(v.activeItems=v.items.filter(fe=>te.some($e=>$e.label===fe.label))),v.busy=!1}try{return await new Promise(te=>{var fe;P.push(v.onDidHide(()=>te(void 0)),v.onDidChangeValue($e=>{if(j=!1,$e=$e.trim(),(d==null?void 0:d.allowResetToSha)&&I.branch&&Rr($e)){K([{label:`Reset $(git-branch) ${I.branch.name} to $(git-commit) ${$e}`,name:I.branch.name,sha:$e,type:Ye.Branch}]);return}v.busy=!0;const Ae=E.debounce($e?()=>M($e):()=>N);B===void 0&&(B=Ae.then(async Te=>K(Te)))}),v.onDidAccept(()=>{if(v.activeItems.length!==0){const[$e]=v.activeItems;te($e)}})),v.title=a,v.placeholder=i,v.matchOnDescription=!0,v.ignoreFocusOut=(fe=d==null?void 0:d.ignoreFocusOut)!=null?fe:!0,v.busy=!0,v.show(),B=E.debounce(async()=>N,0).then($e=>K($e))})}finally{v.dispose(),P.forEach(ee=>void ee.dispose())}}t.show=e})(gh||(gh={}));function up(t,e){switch(t){case ct.Branch:case ct.RemoteBranch:return e?"$(git-pull-request)":"$(git-branch)";case ct.Tag:return"$(tag)";case ct.Commit:return"$(git-commit)"}}function aE(t){switch(t){case Bt.Active:return"$(layers-active)";case Bt.Match:return"$(layers-dot)";case Bt.Indexed:return"$(layers)"}}function sE(t,e){switch(t){case ct.Branch:case ct.RemoteBranch:return e?new _.ThemeIcon("git-pull-request"):new _.ThemeIcon("git-branch");case ct.Tag:return new _.ThemeIcon("tag");case ct.Commit:return new _.ThemeIcon("git-commit")}}const Le=(0,F.loadMessageBundle)(),cE=new TextDecoder;class lE{constructor(e,r,n,i){this.providerService=e,this.changeStore=r,this.openActionsService=n,this.telemetryService=i,this._onDidCloseRepository=new _.EventEmitter,this._onDidOpenRepository=new _.EventEmitter,this._onDidChangeState=new _.EventEmitter,this._scmProviders=[],this._state="uninitialized",this.disposable=_.Disposable.from(Ne.onDidChange(this.onConfigurationChanged,this),this.providerService.onDidChangeRepositories(this.onRepositoriesChanged,this),this.providerService.onDidChangeRepository(async({repository:l})=>{const d=this.getScmProvider(this.providerService.getVirtualUri(l.uri));d!==void 0&&await this.updateStatusBarCommands(d,void 0)}),this.providerService.onDidSyncRepository(async({repository:l,syncing:d})=>{const m=this.getScmProvider(this.providerService.getVirtualUri(l.uri));m!==void 0&&await this.updateStatusBarCommands(m,{syncing:d})}),this.providerService.onDidRefresh(l=>{for(const d of l)this.update(d)}),this.changeStore.onDidChange(l=>this.update(l[0].rootUri)),...this.registerCommands());const a=this.providerService.repositories;this.onRepositoriesChanged({added:a,removed:[]})}get onDidCloseRepository(){return this._onDidCloseRepository.event}get onDidOpenRepository(){return this._onDidOpenRepository.event}get onDidChangeState(){return this._onDidChangeState.event}get repositories(){return this._scmProviders.map(e=>e.repository).filter(e=>Boolean(e))}dispose(){var e;(e=this.disposable)==null||e.dispose()}get staging(){return this._staging===void 0&&(this._staging=Ne.get("staging")),this._staging}get state(){return this._state}refresh(){for(const e of this._scmProviders)this.update(e.sourceControl.rootUri)}onConfigurationChanged(e){Ne.changed(e,"staging")&&(this._staging=void 0,Ne.changed(e,"staging.enabled")&&this.refresh()),Ne.changed(e,"commitDirectlyWarning")&&this.refresh()}async onRepositoriesChanged(e){if(e.added.length)for(const r of e.added){const n=await this.update(r.uri);(n==null?void 0:n.repository)&&this._onDidOpenRepository.fire(n.repository)}if(e.removed.length)for(const r of e.removed){const n=this._scmProviders.findIndex(i=>Oe(i.sourceControl.rootUri)===Oe(r.uri));if(n!==-1){const i=this._scmProviders[n];i.repository&&this._onDidCloseRepository.fire(i.repository),i.sourceControl.dispose(),this._scmProviders.splice(n,1)}}this._state!=="initialized"&&(this._state="initialized",this._onDidChangeState.fire(this._state)),_a(Eo.HasWriteableScmProvider,this._scmProviders.some(r=>!r.isReadonly))}registerCommands(){return[_.commands.registerCommand("remoteHub.createPullRequest",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.createPullRequest"),void this.createPullRequest(e)}),_.commands.registerCommand("remoteHub.createDraftPullRequest",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.createDraftPullRequest"),void this.createPullRequest(e,{draft:!0})}),_.commands.registerCommand("remoteHub.commit",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.commit"),void this.commitChanges(e)}),_.commands.registerCommand("remoteHub.discardAllChanges",async e=>{if(Vv(e)){const a=e.resourceStates.filter(Zu);if(a.length!==0){if(await hp(a))for(const l of a)await this.changeStore.discard(l.resourceUri);else this.telemetryService.sendEvent("command.discardAllChanges.abort",{reason:"aborted"});return}}const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)===void 0)return;this.telemetryService.sendEvent("command.discardAllChanges");const n=await this.changeStore.getChanges(r.rootUri);await hp(n)?await this.changeStore.discardAll(r.rootUri):this.telemetryService.sendEvent("command.discardAllChanges.abort",{reason:"aborted"})}),_.commands.registerCommand("remoteHub.discardChanges",async e=>{!Zu(e)||(this.telemetryService.sendEvent("command.discardChanges"),await hp([e])?await this.changeStore.discard(e.resourceUri):this.telemetryService.sendEvent("command.discardChanges.abort",{reason:"aborted"}))}),_.commands.registerCommand("remoteHub.stageAllChanges",async e=>{const r=this.getSourceControlFrom(e);(r==null?void 0:r.rootUri)!==void 0&&(this.telemetryService.sendEvent("command.stageAllChanges"),await this.changeStore.stageAll(r.rootUri))}),_.commands.registerCommand("remoteHub.stageChanges",e=>{if(!!Zu(e))return this.telemetryService.sendEvent("command.stageChanges"),void this.changeStore.stage(e.resourceUri)}),_.commands.registerCommand("remoteHub.unstageAllChanges",e=>{const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)!==void 0)return this.telemetryService.sendEvent("command.unstageAllChanges"),void this.changeStore.unstageAll(r.rootUri)}),_.commands.registerCommand("remoteHub.unstageChanges",e=>{if(!!Zu(e))return this.telemetryService.sendEvent("command.unstageChanges"),void this.changeStore.unstage(e.resourceUri)}),_.commands.registerCommand("remoteHub.keepChanges",e=>{if(!!Zu(e))return this.telemetryService.sendEvent("command.keepChanges"),void this.changeStore.keep(e.resourceUri)}),_.commands.registerCommand("remoteHub.openChanges",e=>{var r;const{command:n}=e;if(!!n)return this.telemetryService.sendEvent("command.openChanges"),void _.commands.executeCommand(n.command,...(r=n.arguments)!=null?r:[])}),_.commands.registerCommand("remoteHub.openFile",e=>{var r;if(dp(e)){const i=this.changeStore.resolveOpenCommand(e.resourceUri,{preserveFocus:!1,preview:!1,viewColumn:_.ViewColumn.Active});return this.telemetryService.sendEvent("command.openFile"),void _.commands.executeCommand(i.command,...(r=i.arguments)!=null?r:[])}const n=_.window.activeTextEditor;if(!!n)return this.telemetryService.sendEvent("command.openFile"),void _.window.showTextDocument(n.document)}),_.commands.registerCommand("remoteHub.createBranch",async e=>{await jh("remoteHub.createBranchFrom",{...e,fromSha:"HEAD"})}),_.commands.registerCommand("remoteHub.createBranchFrom",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await Ju(this._scmProviders,Le("choose repo for create branch placeholder","Choose which repository to create a new branch on"),Le("choose repo for create branch title","Create Branch"));if(n===void 0)return;this.telemetryService.sendEvent("command.createBranchFrom");const i=await this.providerService.getMetadata(n);if(i.accessLevel<Gt.Write){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"no permissions"}),_.window.showErrorMessage(Le("no permissions to create branch ","You don't have access to create branches on this repository."));return}let a;if(e==null?void 0:e.fromSha)a=e.fromSha,a==="HEAD"&&(a=i.HEAD.sha);else{const R=await gh.show(this.providerService,n,Le("choose branch for create placeholder","Choose which branch to create the new branch from"),Le("choose branch for create title","Create Branch \u2022 {0}",i.name));if(!R){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"abandoned branch picker"});return}a=R.sha}let l;try{l=await _.window.withProgress({location:_.ProgressLocation.SourceControl},()=>mh(this.providerService,n,a,Le("create branch","Please provide a new branch name"),Le("create branch placeholder","New branch name"),Le("create branch title","Create Branch \u2022 {0}",i.name)))}catch(R){he.error(R),_.window.showErrorMessage(Le("unable to create branch","Unable to create the new branch."));return}if(!l){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"abandoned branch name prompt"});return}const d=await this.providerService.switchTo(n,{type:Ye.Branch,id:l});if(!d)return;const m=await this.changeStore.createChangeset(n);m&&await this.openActionsService.setChangesetToApply(d.uri,m);const v=Le("switch to branch prompt open","Switch to Branch"),E=Le("switch to branch prompt open in new window","Open in New Window"),P=await _.window.showInformationMessage(Le("switch to branch prompt",`Created new branch '{0}'.

Any uncommitted changes will be applied to the new branch.

Do you want to switch to the new branch?`,l),{modal:!0,useCustom:!0},v,E);!P||(d.location=P===E?nr.NewWindow:nr.CurrentWindow,await qn(d,{skipChangesPrompt:!0}))}),_.commands.registerCommand("remoteHub.applyPatch",async e=>{if(e=this.getSourceControlFrom(e),(e==null?void 0:e.rootUri)===void 0)return;this.telemetryService.sendEvent("command.applyPatch");let r;const n=_.window.activeTextEditor;if((n==null?void 0:n.document.languageId)!=="diff"){const i=await _.window.showOpenDialog({openLabel:Le("open patch","Open Patch"),title:Le("open patch","Open Patch"),canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Diff:["diff"],Patch:["*","patch"]}});if(i===void 0||i.length===0)return;r=cE.decode(await _.workspace.fs.readFile(i[0]))}else r=n.document.getText();try{await this.changeStore.applyPatch(e.rootUri,r)}catch{_.window.showErrorMessage(Le("invalid patch file","Invalid patch file"))}}),_.commands.registerCommand("remoteHub.exportPatch",async e=>{const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)===void 0)return;let n;dp(e)&&(n=e.resourceUri),this.telemetryService.sendEvent("command.exportPatch");const i=await this.changeStore.createPatch(r.rootUri,n),a=await _.workspace.openTextDocument({language:"diff",content:i});await _.window.showTextDocument(a)}),_.commands.registerCommand("remoteHub.switchToBranch",async e=>{var r,n;const i=(r=e==null?void 0:e.uri)!=null?r:await Ju(this._scmProviders,Le("choose repo for switch branch placeholder","Choose which repository to switch branches on"),Le("choose repo for switch branch title","Switch to Branch or Tag"));if(i===void 0)return;this.telemetryService.sendEvent("command.switchToBranch");const a=[],l=await this.providerService.getMetadata(i);if(e==null?void 0:e.commands)switch(l.accessLevel>=Gt.Write&&a.push(new ks(mi({command:"remoteHub.createBranch",title:Le("create branch command","$(add) Create New Branch..."),arguments:[{uri:i}]})),new ks(mi({command:"remoteHub.createBranchFrom",title:Le("create branch from command","$(add) Create New Branch from..."),arguments:[{uri:i}]}))),l.HEAD.type){case ct.Branch:a.push(new ks(mi({command:"remoteHub.openOnRemote",title:Le("open branch on remote command","$(globe) Open Branch on {0}...",l.provider.name),arguments:[{provider:l.provider,repo:l.repo,branch:l.HEAD.branch.name}]})));break;case ct.RemoteBranch:a.push(new ks(mi({command:"remoteHub.openOnRemote",title:Le("open remote branch on remote command","$(globe) Open Remote Branch on {0}...",l.provider.name),arguments:[{provider:l.provider,repo:l.HEAD.branch.remote.repo,branch:l.HEAD.branch.name}]})));break;case ct.Tag:a.push(new ks(mi({command:"remoteHub.openOnRemote",title:Le("open tag on remote command","$(globe) Open Tag on {0}...",l.provider.name),arguments:[{provider:l.provider,repo:l.repo,branch:l.HEAD.detached.name}]})));break;case ct.Commit:a.push(new ks(mi({command:"remoteHub.openOnRemote",title:Le("open commit on remote command","$(globe) Open Commit on {0}...",l.provider.name),arguments:[{provider:l.provider,repo:l.repo,sha:l.HEAD.sha}]})));break}const d=(n=l.HEAD.branch)==null?void 0:n.name,m=Boolean(d&&!await this.changeStore.hasChanges(i)),v=await gh.show(this.providerService,i,Le("choose switch branch placeholder","Choose which branch to switch to"),Le("choose switch branch title","Switch to Branch or Tag \u2022 {0}",l.name),a,{allowResetToSha:m,filterBranches:d?E=>E.name!==d:void 0,ignoreFocusOut:!1});if(!v){this.telemetryService.sendEvent("command.switchToBranch.abort",{reason:"abandoned branch picker"});return}return v instanceof ks?void v.execute():m&&v.type===Ye.Branch&&v.name===d&&v.sha?_.window.withProgress({location:_.ProgressLocation.SourceControl},async()=>{try{await this.providerService.sync(i,this.changeStore,{to:v.sha})}catch(E){he.error(E),_.window.showErrorMessage(Le("reset failed","Unable to reset the repository to commit '{0}'.",pr(v.sha)))}}):void _.window.withProgress({location:_.ProgressLocation.SourceControl},async()=>{const E=await this.providerService.switchTo(i,v.name?{type:v.type,id:v.name}:void 0);if(E!==void 0)return qn(E)})}),_.commands.registerCommand("remoteHub.fetch",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await Ju(this._scmProviders,Le("choose repo for fetch placeholder","Choose which repository to fetch"),Le("choose repo for fetch title","Fetch Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.fetch");try{await _.window.withProgress({location:_.ProgressLocation.SourceControl},()=>this.providerService.fetch(n,{force:!0}))}catch(i){_.window.showErrorMessage(Le("fetch failed","Unable to fetch repository"))}}}),_.commands.registerCommand("remoteHub.fetchAll",async e=>{const r=this.providerService.repositories;if(r.length===0)return;(e==null?void 0:e.automated)||this.telemetryService.sendEvent("command.fetchAll"),(await _.window.withProgress({location:_.ProgressLocation.SourceControl},async()=>{const i=[];for(const a of r)try{await this.providerService.fetch(a.uri)}catch(l){i.push(l)}return i})).length&&!(e==null?void 0:e.automated)&&_.window.showErrorMessage(r.length?Le("fetch all failed","Unable to fetch repositories"):Le("fetch failed","Unable to fetch repository"))}),_.commands.registerCommand("remoteHub.pull",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await Ju(this._scmProviders,Le("choose repo for pull placeholder","Choose which repository to pull"),Le("choose repo for pull title","Pull Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.pull");try{await this.sync(n,{pull:!0})}catch{}}}),_.commands.registerCommand("remoteHub.sync",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await Ju(this._scmProviders,Le("choose repo for sync placeholder","Choose which repository to sync"),Le("choose repo for sync title","Synchronize Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.sync");try{await this.sync(n)}catch{}}}),_.commands.registerCommand("remoteHub.disableCommitDirectlyWarning",()=>{this.telemetryService.sendEvent("command.disableCommitDirectlyWarning"),Ne.updateEffective("commitDirectlyWarning",H.Off)})]}async sync(e,{pull:r,...n}={pull:!1}){this.telemetryService.sendEvent("sync");try{await _.window.withProgress({location:_.ProgressLocation.SourceControl},()=>this.providerService.sync(e,this.changeStore,n))}catch(i){if(i instanceof In){const a={title:Le("sync confirm","Continue")},l={title:Le("sync cancel","Cancel"),isCloseAffordance:!0};await _.window.showWarningMessage(r?Le("sync pull",`Pulling in changes may cause conflicts with your uncommitted changes as one of more of those files has changed since you started editing.

Do you want to continue pulling in changes.`):Le("sync",`Syncing changes may cause conflicts with your uncommitted changes as one of more of those files has changed since you started editing.

Do you want to continue syncing changes?`),{modal:!0,useCustom:!0},a,l)===a?await _.window.withProgress({location:_.ProgressLocation.SourceControl},()=>this.providerService.sync(e,this.changeStore,{conflictResolution:sr.Merge})):this.telemetryService.sendEvent("sync.abort",{reason:"abandoned"})}else throw he.error(i),this.telemetryService.sendException(i),_.window.showErrorMessage(Le("sync failed","Unable to sync the repository.")),i}}async commitChanges(e){try{await _.window.withProgress({location:_.ProgressLocation.SourceControl},()=>this.commitChangesCore(e))}catch(r){if(r instanceof ui){_.window.showInformationMessage(Le("no changes to commit","There are no changes to commit."));return}he.error(r),_.window.showErrorMessage(Le("commit unable","Unable to commit.")),this.telemetryService.sendException(r)}}async commitChangesCore(e){const r=e.rootUri;this.telemetryService.sendEvent("commit",{staging:String(this.staging.enabled)});const n=new ce(`VirtualSourceControl.commitChanges(${r.toString()})`);let i;try{const a=await this.providerService.getMetadata(r);let l,d;const m=this.staging.enabled?this.staging.smart?"auto":!0:!1;for(;;){const E=e.inputBox.value;if(await this.changeStore.hasMergeConflicts(r)){e.inputBox.showValidationMessage(Le("commit resolve conflicts","You must resolve any pending conflicts before committing."),_.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("commit.abort",{reason:"aborted conflicts"}),i=": Aborted; Unresolved conflicts";return}const P=await this.providerService.getCommitOperations(r,this.changeStore,{staged:m});if(P.length===0){e.inputBox.showValidationMessage(this.staging.enabled?Le("commit no staged changes","There are no staged changes to commit."):Le("commit no changes","There are no changes to commit."),_.SourceControlInputBoxValidationType.Information),this.telemetryService.sendEvent("commit.abort",{reason:this.staging.enabled?"aborted no staged changes":"aborted no changes"}),i=`: Aborted; No ${this.staging.enabled?"staged ":""}changes`;return}if(!E){e.inputBox.showValidationMessage(Le("specify commit message","You must specify a commit message before committing."),_.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("commit.abort",{reason:"aborted no message"}),i=": Aborted; No message";return}let R,I;if(a.HEAD.type===ct.RemoteBranch?(I=a.HEAD.branch.remote.accessLevel<Gt.Write,R=I&&a.accessLevel<Gt.Write):(R=a.accessLevel<Gt.Write,I=R),d===void 0&&R&&(d=await this.providerService.getFork(r),d===void 0)){const M={title:Le("fork confirm","Fork Repository")},N={title:Le("cancel","Cancel"),isCloseAffordance:!0};if(await _.window.showInformationMessage(Le("fork","You\u2019re trying to make changes in a project you don\u2019t have write access to. Do you want to create a fork of this project to commit your proposed changes to?"),{modal:!0,useCustom:!0},M,N)!==M){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned fork prompt"}),i=": Aborted; Abandoned fork prompt";return}if(d=await _.window.withProgress({location:_.ProgressLocation.Notification,title:Le("fork progress","Forking {0}...",a.name)},()=>this.providerService.fork(r)),d===void 0){_.window.showErrorMessage(Le("unable to fork","Unable to fork repository.")),this.telemetryService.sendEvent("commit.abort",{reason:"aborted fork failed"}),i=": Aborted; Fork failed";return}}if(d||I){if(d===void 0){const N={title:Le("remote branch create branch prompt confirm","Commit to New Branch")},B={title:Le("cancel","Cancel"),isCloseAffordance:!0};if(await _.window.showErrorMessage(Le("remote branch create branch prompt",`You\u2019re trying to make changes to a branch you don\u2019t have write access to.

Do you want to commit your changes to a new branch?`),{modal:!0,useCustom:!0},N,B)!==N){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned remote branch prompt"}),i=": Aborted; Abandoned commit to new branch prompt";return}}let M=0;try{const N=await this.providerService.getBranches(d?this.providerService.createVirtualUri(r,d):r,{query:"patch-"});for(const B of N.branches){const j=/^patch-(?<num>\d+)$/.exec(B.name);if(j==null?void 0:j.groups){const K=Number(j.groups.num);K>M&&(M=K)}}}catch{}if(l=await mh(this.providerService,r,a.HEAD.sha,Le("create new branch prompt","Create a new branch to commit your changes to"),Le("create new branch placeholder","New branch name"),Le("create new branch title","Commit \u2022 Create Branch \u2022 {0}",d?d.name:a.name),d,`patch-${M+1}`),!l){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned create branch prompt"}),i=": Aborted; Abandoned create branch prompt";return}}try{if(Ne.getUseNewCommitApi())await this.providerService.createAndPushCommit(r,E,P,l,d);else{n.logStep("Creating commit");const M=await this.providerService.createCommit(r,E,P,d);n.logStep("Pushing",{message:`: Created commit ${M}`,suffix:" \u2022 Pushing..."}),await this.providerService.pushCommit(r,M,l,d)}}catch(M){if(M instanceof li){const N={title:Le("detached head prompt confirm","Commit to New Branch")},B={title:Le("cancel","Cancel"),isCloseAffordance:!0};if(await _.window.showErrorMessage(Le("detached head prompt",`Unable to commit your changes because you are not currently on a branch.

Do you want to commit your changes to a new branch?`),{modal:!0},N,B)!==N){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned detached head prompt"}),i=": Aborted; Abandoned commit to new branch prompt (detached head)";return}if(l=await mh(this.providerService,r,a.HEAD.sha,Le("create new branch prompt","Create a new branch to commit your changes to"),Le("create new branch placeholder","New branch name"),Le("create new branch title","Commit \u2022 Create Branch \u2022 {0}",d?d.name:a.name),d),!l){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned detached head create branch prompt"}),i=": Aborted; Abandoned create branch prompt (detached head)";return}continue}else if(M instanceof Li){const N={title:Le("push conflicts prompt pull","Pull")},B={title:Le("push conflicts prompt sync","Sync (Pull & Push)")},j={title:Le("cancel","Cancel"),isCloseAffordance:!0},K=await _.window.showErrorMessage(Le("push conflicts prompt",`Changes have been committed since you started editing, so you must merge those changes before you can commit.

Do you want to pull or sync (pull and automatically push) your changes?`),{modal:!0},N,B,j);if(K!==N&&K!==B){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned conflicts prompt"}),i=": Aborted; Abandoned merge changes prompt";return}if(await this.sync(r,{pull:K===N,conflictResolution:sr.Merge}),K===N){i=': Aborted; Chose "pull" from merge changes prompt';return}continue}else throw he.error(M),i=`: Aborted; ${String(M)}`,M}break}if(e.inputBox.value="",d?await this.changeStore.discardAll(r,{staged:m}):await this.changeStore.acceptAll(r,{staged:m}),_p(Ns.HasCommitted,!0),!d&&!l)return;async function v(){if(d){const I={title:Le("commit to fork confirm","Switch to Fork")},M={title:Le("cancel","Cancel"),isCloseAffordance:!0},N=await _.window.showInformationMessage(Le("commit to fork","Committed changes to your fork of {0}. Do you want to switch to your fork to continue making changes?",a.name),{modal:!0,useCustom:!0},I,M);if(this.telemetryService.sendEvent("commit.switchToFork",{confirm:String(N===I)}),N===I){let B;l!==void 0?B={type:Ye.Branch,id:l}:a.HEAD.branch!==void 0&&(B={type:Ye.Branch,id:a.HEAD.branch.name}),qn({name:d.name,uri:this.providerService.createVirtualUri(r,{repo:d.repo,ref:B}),location:nr.CurrentWindow})}return}const E={title:Le("commit to new branch confirm","Switch to Branch")},P={title:Le("cancel","Cancel"),isCloseAffordance:!0},R=await _.window.showInformationMessage(Le("commit to new branch","Committed changes to new branch '{0}'. Do you want to switch to the new branch to continue making changes?",l),{modal:!0,useCustom:!0},E,P);this.telemetryService.sendEvent("commit.switchToBranch",{confirm:String(R===E)}),R===E&&qn({name:a.name,uri:this.providerService.createVirtualUri(r,{repo:a.repo,ref:l?{type:Ye.Branch,id:l}:void 0}),location:nr.CurrentWindow})}v.call(this)}finally{n.stop(i?{message:i}:void 0)}}async createPullRequest(e,r){try{await _.window.withProgress({location:_.ProgressLocation.SourceControl},()=>this.createPullRequestCore(e,r))}catch(n){if(n instanceof ui){_.window.showInformationMessage(Le("no changes to commit","There are no changes to commit."));return}if(n instanceof di){_.window.showErrorMessage(Le("commit unable","Unable to commit."));return}he.error(n),_.window.showErrorMessage(Le("unable to open pr","Unable to open a pull request.")),this.telemetryService.sendException(n)}}async createPullRequestCore(e,r){var n,i;const a=e.rootUri,l=(n=r==null?void 0:r.draft)!=null?n:!1;this.telemetryService.sendEvent("createPullRequest",{draft:String(l),staging:String(this.staging.enabled)});const d=new ce(`VirtualSourceControl.createPullRequest(${a.toString()})`);let m;try{let v=function(){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned branch prompt"}),m=": Aborted; Abandoned commit to new branch prompt"},E;const P=this.staging.enabled?this.staging.smart?"auto":!0:!1;if(!(r==null?void 0:r.sha)){if(await this.changeStore.hasMergeConflicts(a)){e.inputBox.showValidationMessage(Le("commit resolve conflicts","You must resolve any pending conflicts before committing."),_.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted conflicts"}),m=": Aborted; Unresolved conflicts";return}if(E=await this.providerService.getCommitOperations(a,this.changeStore,{staged:this.staging.enabled?this.staging.smart?"auto":!0:!1}),E.length===0){e.inputBox.showValidationMessage(this.staging.enabled?Le("commit no staged changes","There are no staged changes to commit."):Le("commit no changes","There are no changes to commit."),_.SourceControlInputBoxValidationType.Information),this.telemetryService.sendEvent("createPullRequest.abort",{reason:this.staging.enabled?"aborted no staged changes":"aborted no changes"}),m=`: Aborted; No ${this.staging.enabled?"staged ":""}changes`;return}}const R=e.inputBox.value;if(!R){e.inputBox.showValidationMessage(Le("specify commit message","You must specify a commit message before committing."),_.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted no message"}),m=": Aborted; No message";return}const I=await this.providerService.getMetadata(a);let M,N;I.HEAD.type===ct.RemoteBranch?(N=I.HEAD.branch.remote.accessLevel<Gt.Write,M=N&&I.accessLevel<Gt.Write):(M=I.accessLevel<Gt.Write,N=M);let B=r==null?void 0:r.fork;if(B===void 0&&M&&(B=await this.providerService.getFork(a),B===void 0)){const $e={title:Le("fork confirm","Fork Repository")},Ae={title:Le("cancel","Cancel"),isCloseAffordance:!0};if(await _.window.showInformationMessage(Le("fork",`You\u2019re trying to make changes in a project you don\u2019t have write access to.

Do you want to create a fork of this project to commit your proposed changes to?`),{modal:!0,useCustom:!0},$e,Ae)!==$e){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned fork prompt"}),m=": Aborted; Abandoned fork prompt";return}if(B=await _.window.withProgress({location:_.ProgressLocation.Notification,title:Le("fork progress","Forking {0}...",I.name)},()=>this.providerService.fork(a)),B===void 0){_.window.showErrorMessage(Le("unable to fork","Unable to fork repository.")),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted fork failed"}),m=": Aborted; Fork failed";return}}const j=await _.window.showInputBox({ignoreFocusOut:!0,placeHolder:Le("create pr placeholder","Pull request title"),prompt:Le("create pr prompt","Enter a title for the new pull request"),title:Le("create pr title","New Pull Request"),value:R});if(!j){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned title prompt"}),m=": Aborted; Abandoned title prompt";return}async function K($e){let Ae=0;try{const Te=await this.providerService.getBranches(B?this.providerService.createVirtualUri(a,B):a,{query:"patch-"});for(const qe of Te.branches){const De=/^patch-(?<num>\d+)$/.exec(qe.name);if(De==null?void 0:De.groups){const Be=Number(De.groups.num);Be>Ae&&(Ae=Be)}}}catch{}return mh(this.providerService,a,$e,Le("create pr branch prompt","Create a new branch for this pull request"),Le("create pr branch placeholder","New branch name"),Le("create pr branch title","New Pull Request \u2022 Create Branch \u2022 {0}",B?B.name:I.name),B,`patch-${Ae+1}`)}let ee;if(Ne.getUseNewCommitApi()){if(ee=await K.call(this,I.HEAD.sha),!ee){v.call(this);return}(E==null?void 0:E.length)&&await this.providerService.createAndPushCommit(a,R,E,ee,B)}else{let $e;if((E==null?void 0:E.length)?($e=await this.providerService.createCommit(a,R,E,B),d.log({message:`: Created commit ${$e}`})):($e=(i=r==null?void 0:r.sha)!=null?i:I.HEAD.sha,d.log({message:`: Using commit ${$e}`})),ee=await K.call(this,$e),!ee){v.call(this);return}}const te=await this.providerService.createPullRequest(a,ee,j,{draft:l},B);e.inputBox.value="",(E==null?void 0:E.length)&&(B?await this.changeStore.discardAll(a,{staged:P}):await this.changeStore.acceptAll(a,{staged:P}));async function fe(){const $e={title:Le("created pr notification confirm","Switch to Pull Request")},Ae={title:Le("cancel","Cancel"),isCloseAffordance:!0},Te=await _.window.showInformationMessage(Le("created pr notification",'Created [Pull Request #{0}]({1} "Open Pull Request #{0} on {2}") for {3}. Do you want to switch to the new pull request?',te.id,te.uri.toString(!0),I.provider.name,I.name),{modal:!0,useCustom:!0},$e,Ae);this.telemetryService.sendEvent("createPullRequest.switchToPullRequest",{confirm:String(Te===$e)}),Te===$e&&qn({name:I.name,uri:this.providerService.createVirtualUri(a,{repo:I.repo,ref:{type:Ye.PullRequest,id:te.id}}),location:nr.CurrentWindow})}fe.call(this)}finally{d.stop(m?{message:m}:void 0)}}async update(e){const r=_.workspace.getWorkspaceFolder(e);if(r===void 0)return;const n=await this.createOrUpdateScmProvider(e,r.name),i=await this.changeStore.getGroupedChanges(e,{predicate:m=>m.fileType===_.FileType.File}),a=await Promise.all(i.conflicts.map(async m=>({type:m.type,resourceUri:m.uri,command:await this.changeStore.resolveDiffCommand(m.uri,m.conflicts.incomingUri,Le("diff title with conflicts","{0} (Incoming Changes \u2194 Current Changes)",bt(m.uri)))}))),l=await Promise.all(i.staged.map(async m=>({type:m.type,resourceUri:m.uri,command:await this.changeStore.resolveDiffCommand(m.uri,this.providerService.getProviderUri(m.uri),Le("diff title index","{0} (Index)",bt(m.uri)))}))),d=await Promise.all(i.working.map(async m=>({type:m.type,resourceUri:m.uri,decorations:{strikeThrough:m.type===Ot.Deleted},command:await this.changeStore.resolveDiffCommand(m.uri,this.providerService.getProviderUri(m.uri),Le("diff title working","{0} (Working Tree)",bt(m.uri)))})));return this.ensureMergeConflictsGroup(n).resourceStates=a,this.ensureStagedChangesGroup(n).resourceStates=this.staging.enabled?l:[],this.ensureWorkingChangesGroup(n).resourceStates=this.staging.enabled?d:[...l,...d],n}async createOrUpdateScmProvider(e,r){const n=await this.providerService.getMetadata(e),i=this.providerService.isReadonly(e);let a;const l=n.HEAD.branch?n.HEAD.name:void 0;let d=this.getScmProvider(e);if(d===void 0){r=n.name,a=_.scm.createSourceControl(`remoteHub:${n.provider.id}`,r,e),a.quickDiffProvider={provideOriginalResource:v=>this.providerService.getProviderUri(v)};const m=this.providerService.createIGitRepository(e,a,n,this.changeStore);d={id:n.provider.id,name:n.provider.name,sourceControl:a,groups:[],repository:m,isReadonly:i},this.ensureMergeConflictsGroup(d),this.ensureStagedChangesGroup(d),this.ensureWorkingChangesGroup(d),this._scmProviders.push(d)}else a=d.sourceControl;return n.accessLevel>=Gt.Write?(a.acceptInputCommand={command:"remoteHub.commit",title:Le("scm input accept command title commit","Commit"),arguments:[a]},l?a.inputBox.placeholder=Le("scm input placeholder commit","Message (Ctrl+Enter to commit directly to '{0}' on {1})",l,n.provider.name):a.inputBox.placeholder=Le("scm input placeholder commit","Message (Ctrl+Enter to commit directly to {0})",n.provider.name),Ne.get("commitDirectlyWarning")===H.Off?a.inputBox.validateInput=void 0:a.inputBox.validateInput=m=>{if(Ne.get("commitDirectlyWarning")===H.Auto&&ny(Ns.HasCommitted))return;const v=new _.MarkdownString(l?Le("scm input validation commit branch directly","Your changes will be committed directly to the '{0}' branch on {1}.",l,n.provider.name):Le("scm input validation commit directly","Your changes will be committed directly to {0}.",n.provider.name));return v.isTrusted=!0,v.appendMarkdown(`&nbsp; [${Le("scm input validation action","Don't show again")}](command:remoteHub.disableCommitDirectlyWarning '${Le("scm input validation action tip","Hide")}')`),{message:v,type:_.SourceControlInputBoxValidationType.Information}}):i?(a.acceptInputCommand=void 0,a.inputBox.placeholder=Le("scm input readonly placeholder","Committing is not available for readonly repositories.")):(a.acceptInputCommand={command:"remoteHub.createPullRequest",title:Le("scm input accept command title pr","Create a Pull Request"),arguments:[a]},a.inputBox.placeholder=Le("scm input placeholder pr","Message (Ctrl+Enter to create a pull request for '{0}'",r)),await this.updateStatusBarCommands(d,{syncing:!1},n),d}async updateStatusBarCommands(e,r,n){var i,a,l;const d=e.sourceControl.rootUri;n=n!=null?n:await this.providerService.getMetadata(d);const{HEAD:m}=n,v=await this.providerService.getIndexMetadata(d),E=(v==null?void 0:v.type)===Bt.Active,P=(v==null?void 0:v.type)===Bt.Active,R=Bt.hasIndex(v==null?void 0:v.type),I=await this.changeStore.hasChanges(d),M=up(m.type),N=[];if(N.push(mi({command:"remoteHub.switchToBranch",title:`${M} ${m.name}${I?"*":""}`,tooltip:`${pr(m.sha)}`,arguments:[{uri:d,commands:!0}]})),m.detached||((r==null?void 0:r.syncing)?N.push(mi({command:"",title:"$(sync~spin)",tooltip:Le("sync command syncing","Syncing Changes..."),arguments:[]})):N.push(mi({command:"remoteHub.sync",title:`$(sync)${((a=(i=n.state)==null?void 0:i.behind)!=null?a:0)>0?` ${(l=n.state)==null?void 0:l.behind}\u2193`:""}`,tooltip:E||P?Le("sync index","Sync to latest indexed commit"):Le("sync command","Sync (Pull & Push)"),arguments:[{uri:d}]}))),n.pullRequest&&N.push(mi({command:"remoteHub.openOnRemote",title:`$(git-pull-request) ${n.pullRequest.id}`,tooltip:Le("scm statusbar command open pr",`Open Pull Request #{0} on {1}

{2}`,n.pullRequest.id,n.provider.name,n.pullRequest.title),arguments:[{provider:n.provider,repo:n.repo,pullRequest:{id:n.pullRequest.id}}]})),R){const B=this.providerService.getIndexProvider(d);B&&N.push(...await B.getStatusBarContributions(d))}e.sourceControl.statusBarCommands=N}ensureMergeConflictsGroup(e){const r="conflicts";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,Le("scm group conflicts","Merge Conflicts")),n.hideWhenEmpty=!0,e.groups.push(n)),n}ensureStagedChangesGroup(e){const r="staged";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,Le("scm group staged","Staged Changes")),n.hideWhenEmpty=!0,e.groups.push(n)),n}ensureWorkingChangesGroup(e){const r="changes";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,Le("scm group changes","Changes")),e.groups.push(n)),n}getScmProvider(e){const r=Oe(e);return this._scmProviders.find(n=>Oe(n.sourceControl.rootUri)===r)}getSourceControlFrom(e){if(e===void 0){if(this._scmProviders.length!==1)return;e=this._scmProviders[0].sourceControl}let r;if(uE(e))r=e;else if(Vv(e)){const n=e,i=this._scmProviders.find(a=>a.groups.includes(n));r=i==null?void 0:i.sourceControl}else if(dp(e)){const n=e,i=this._scmProviders.find(a=>a.groups.some(l=>l.resourceStates.includes(n)));r=i==null?void 0:i.sourceControl}else{if(this._scmProviders.length!==1)return;r=this._scmProviders[0].sourceControl}return r}}function uE(t){return"rootUri"in t&&"inputBox"in t}function Vv(t){return t!==void 0&&"id"in t&&"label"in t&&"resourceStates"in t&&Array.isArray(t.resourceStates)}function dp(t){return t!==void 0&&"resourceUri"in t&&t.resourceUri instanceof _.Uri}function Zu(t){return"type"in t}async function hp(t){var e,r,n;if(t.length===0)return!0;let i,a=Le("discard","Discard Changes");if(t.length===1){const d=t[0];d.type===Ot.Created?(i=Le("confirm delete",`Are you sure you want to DELETE {0}?
This is IRREVERSIBLE!
This file will be FOREVER LOST.`,bt((e=d.resourceUri)!=null?e:d.uri)),a=Le("delete file","Delete file")):d.type===Ot.Deleted?(a=Le("restore file","Restore file"),i=Le("confirm restore","Are you sure you want to restore {0}?",bt((r=d.resourceUri)!=null?r:d.uri))):i=Le("confirm discard","Are you sure you want to discard changes in {0}?",bt((n=d.resourceUri)!=null?n:d.uri))}else t.every(d=>d.type===Ot.Created)?i=Le("confirm delete multiple",`Are you sure you want to DELETE {0} files?
This is IRREVERSIBLE!
These files will be FOREVER LOST.`,t.length):t.every(d=>d.type===Ot.Deleted)?(a=Le("restore files","Restore files"),i=Le("confirm restore multiple","Are you sure you want to restore {0} files?",t.length)):i=Le("confirm discard multiple","Are you sure you want to discard changes in {0} files?",t.length);return await _.window.showWarningMessage(i,{modal:!0,useCustom:!0},a)===a}async function Ju(t,e,r){if(t.length===0)return;if(t.length===1)return t[0].sourceControl.rootUri;const n=await _.window.showQuickPick(t.map(({sourceControl:i})=>({label:i.label,uri:i.rootUri})),{placeHolder:e,title:r});if(!!n)return n.uri}async function mh(t,e,r,n,i,a,l,d){const m=new Set;let v;const E=_.window.createInputBox();E.ignoreFocusOut=!0;try{return await new Promise((P,R)=>{v=_.Disposable.from(E.onDidHide(()=>P(void 0)),E.onDidChangeValue(I=>{if(I=I.trim(),!I){E.validationMessage=Le("scm create branch prompt validation missing name","Please enter a valid branch name");return}if(m.has(I)){E.validationMessage=Le("scm create branch prompt validation already exists","Branch '{0}' already exists",I);return}if(!nn(I)){E.validationMessage=Le("scm create branch prompt validation invalid name","'{0}' isn't a valid branch name",I);return}E.validationMessage=void 0}),E.onDidAccept(async()=>{const I=E.value;try{E.enabled=!1,E.busy=!0;const M=await t.createBranch(e,I,r,l);P(M)}catch(M){if(M instanceof Hn){E.enabled=!0,E.busy=!1,E.validationMessage=M.duplicate?Le("scm create branch prompt validation already exists","Branch '{0}' already exists",I):Le("scm create branch prompt validation invalid","Invalid branch name '{0}'",I),m.add(I);return}R(M)}})),E.prompt=n,E.placeholder=i,E.title=a,d&&(E.value=d),E.show()})}finally{E.dispose(),v==null||v.dispose()}}class fp{constructor(e,r){this.memento=e,this.scope=r,this._onDidChange=new _.EventEmitter}get onDidChange(){return this._onDidChange.event}async get(e){const r=this.getScoped(e),n=new ce(`MementoStorage.get(${e}): scopedKey=${r}`,{logLevel:dt.Debug});try{return await Promise.resolve(this.memento.get(r))}finally{n.stop()}}async getKeys(e){const r=this.getScoped(e),n=new ce(`MementoStorage.getKeys(${e}): scopedPrefix=${r}`,{logLevel:dt.Debug});try{let i=this.getKeysCore(e);if(this.scope!==void 0){const a=this.scope.length+1;i=i.map(l=>l.substr(a))}return await Promise.resolve(i)}finally{n.stop()}}getKeysCore(e){let r=this.memento.keys();return e&&(r=r.filter(n=>n.startsWith(e))),r}async store(e,r){const n=this.getScoped(e),i=new ce(`MementoStorage.store(${e}): scopedKey=${n}`,{logLevel:dt.Debug});try{return await this.storeCore(e,n,r)}finally{i.stop()}}async storeCore(e,r,n){await this.memento.update(r,n),this._onDidChange.fire({key:e})}async delete(e){const r=this.getScoped(e),n=new ce(`MementoStorage.delete(${e}): scopedKey=${r}`,{logLevel:dt.Debug});try{return await this.storeCore(e,r,void 0)}finally{n.stop()}}async deleteKeys(e){const r=this.getScoped(e),n=new ce(`MementoStorage.deleteKeys(${e}): scopedPrefix=${r}`,{logLevel:dt.Debug});try{const i=[],a=this.scope!==void 0?this.scope.length+1:0,l=this.getKeysCore(r);for(const d of l){const m=a!==0?d.substr(a):d;he.debug(`MementoStorage.deleteKeys(${e}): Deleting key=${m}, scopedKey=${d}`);try{await this.storeCore(m,d,void 0)}catch(v){he.debug(`MementoStorage.deleteKeys(${e}): Failed to delete key=${m}, scopedKey=${d}`),i.push(m)}}if(i.length)throw new Error(`Failed to delete keys: ${i.join(", ")}`)}finally{n.stop()}}with(e){return new fp(this.memento,e)}getScoped(e){return`${this.scope!==void 0?`${this.scope}/`:""}${e!=null?e:""}`}}class pp{constructor(e,r){this.storageUri=e,this.scope=r,this._onDidChange=new _.EventEmitter}get onDidChange(){return this._onDidChange.event}async get(e){const r=this.getScoped(e),n=new ce(`ExtFileStorageService.get(${e}): scopedKey=${r}`,{logLevel:dt.Debug});try{return await _.workspace.fs.readFile(_.Uri.joinPath(this.storageUri,r))}catch(i){return}finally{n.stop()}}async store(e,r){const n=this.getScoped(e),i=new ce(`ExtFileStorageService.store(${e}): scopedKey=${n}`,{logLevel:dt.Debug});try{return await this.storeCore(e,n,r)}finally{i.stop()}}async storeCore(e,r,n){await _.workspace.fs.writeFile(_.Uri.joinPath(this.storageUri,r),n),this._onDidChange.fire({key:e})}async delete(e){const r=this.getScoped(e),n=new ce(`ExtFileStorageService.delete(${e}): scopedKey=${r}`,{logLevel:dt.Debug});try{return await _.workspace.fs.delete(_.Uri.joinPath(this.storageUri,r))}finally{n.stop()}}with(e){return new pp(this.storageUri,e)}getScoped(e){return`${this.scope!==void 0?`${this.scope}/`:""}${e}`}}const yr=(0,F.loadMessageBundle)();class Lo extends _.TimelineItem{static is(e){return e instanceof Lo}constructor(e,r,n,i,{dateType:a,showAuthor:l,dateFormatter:d}){var m;const v=n.message.indexOf(`
`),E=v!==-1?`${n.message.substring(0,v)} \u2026`:n.message,P=a==="authored"?n.authorDate:n.commitDate;super(E,(m=P==null?void 0:P.getTime())!=null?m:0);this.id=n.hash,this.contextValue=`vscode-vfs:${r}:file:commit`,this.command=i,l&&(this.description=n.authorName),this.detail=yr("timeline item detail",`{0} ({1}) \u2014 {2}
{3}

{4}`,n.authorName,n.authorEmail,pr(n.hash),d.format(P),n.message),this.iconPath=new _.ThemeIcon("git-commit"),this.rootUri=e,this.providerId=r,this.hash=n.hash,this.parents=n.parents,this.message=n.message}}class Xc extends _.TimelineItem{static is(e){return e instanceof Xc}constructor(e,r,n,i,a,{dateFormatter:l,staged:d}){const m=d?yr("timeline staged changes","Staged Changes"):yr("timeline uncommitted changes","Uncommitted Changes");super(m,n.timestamp);this.id=d?"index":"working",this.contextValue=`vscode-vfs:${r}:file:${this.id}`,this.command=a,this.iconPath=new _.ThemeIcon("git-commit"),d?this.detail=yr("timeline index detail",`{0}  \u2014 {1}
{2}

{3}`,yr("timeline you","You"),yr("timeline index","Index"),l.format(new Date(n.timestamp)),kp(n.type)):this.detail=yr("timeline working detail",`{0}  \u2014 {1}
{2}

{3}`,yr("timeline you","You"),yr("timeline working","Working Tree"),l.format(new Date(n.timestamp)),kp(n.type)),this.rootUri=e,this.providerId=r,this.hash=d?"~":"",this.parents=i,this.message=m}}class dE{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChange=new _.EventEmitter,this.id="github-file-history",this.label=yr("timeline.source","GitHub File History"),this.debouncer=new Bh(500),this.disposable=_.Disposable.from(this.debouncer,e.onDidChangeProviders(this.onProvidersChanged,this),e.onDidChangeRepositories(this.onRepositoriesChanged,this),e.onDidChangeRepository(this.onRepositoryChanged,this),e.onDidRefresh(this.onRefresh,this),r.onDidChange(this.onUrisChanged,this),Ne.onDidChangeAny(this.onConfigurationChanged,this),...this.registerCommands()),e.hasProviders&&this.ensureProviderRegistration()}get onDidChange(){return this._onDidChange.event}dispose(){var e;(e=this.providerDisposable)==null||e.dispose(),this.disposable.dispose()}onConfigurationChanged(e){(e.affectsConfiguration("git.timeline.date")||e.affectsConfiguration("git.timeline.showAuthor"))&&this.fireChanged()}onProvidersChanged(e){this.ensureProviderRegistration(),this.fireChanged()}onRefresh(e){if(this.rootUri===void 0)return;const r=Oe(this.rootUri);!e.some(n=>Oe(n)===r)||this.fireChanged()}onRepositoriesChanged(e){if(this.rootUri===void 0)return;const r=Oe(this.rootUri);(e.added.some(n=>Oe(n.uri)===r)||e.removed.some(n=>Oe(n.uri)===r))&&this.fireChanged()}onRepositoryChanged(e){this.rootUri===void 0||Oe(this.rootUri)!==Oe(e.repository.uri)||this.fireChanged()}onUrisChanged(e){if(this.rootUri===void 0)return;const r=Oe(this.rootUri);e.some(n=>Oe(n.rootUri)===r)&&this.fireChanged()}async provideTimeline(e,r,n){var i;try{this.rootUri=this.providerService.getVirtualRootUri(e);for(const M of this.providerService.repositories)if(M.uri.path===this.rootUri.path){this.rootUri=M.uri;break}const a=this.providerService.getRelativeFilePath(this.rootUri,e),l=await this.providerService.getMetadata(this.rootUri);if(!l||n.isCancellationRequested)return{items:[]};const d=await this.providerService.getCommits(this.rootUri,{ref:l.HEAD.sha,path:a||void 0,cursor:r.cursor,limit:typeof r.limit=="number"?r.limit:void 0});if(d===void 0||d.commits.length===0||n.isCancellationRequested)return{items:[]};const m=((i=d.paging)==null?void 0:i.more)?{cursor:d.paging.cursor}:void 0,v=new Intl.DateTimeFormat(_.env.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}),E=Ne.getAny("git.timeline.date",void 0,"committed"),P=Ne.getAny("git.timeline.showAuthor",void 0,!0),R=d.commits.map(M=>new Lo(this.rootUri,l.provider.id,M,this.resolveDiffCommand(M,l,e,a),{dateType:E,showAuthor:P,dateFormatter:v})),I=r.cursor===void 0?await this.changeStore.getChange(e):void 0;if(I){const M=Boolean(I.staged&&Ne.get("staging.enabled")),N=new Xc(this.rootUri,l.provider.id,I,[d.commits[0].hash],await this.changeStore.resolveDiffCommand(I.uri,this.providerService.getProviderUri(I.uri),M?yr("diff title index","{0} (Index)",bt(I.uri)):yr("diff title working","{0} (Working Tree)",bt(I.uri))),{dateFormatter:v,staged:M});R.splice(0,0,N)}return{items:R,paging:m}}catch(a){return he.error(a),{items:[]}}}ensureProviderRegistration(){this.providerDisposable===void 0&&(this.providerDisposable=_.workspace.registerTimelineProvider([Dt.scheme,...this.providerService.registeredProviders.map(e=>e.id)],this))}fireChanged(){this.debouncer.debounce(()=>this._onDidChange.fire(void 0))}registerCommands(){let e;return[_.commands.registerCommand("remoteHub.timeline.copyCommitId",(r,n,i)=>{!Lo.is(r)||_.env.clipboard.writeText(r.hash)}),_.commands.registerCommand("remoteHub.timeline.copyCommitMessage",(r,n,i)=>{!Lo.is(r)||_.env.clipboard.writeText(r.message)}),_.commands.registerCommand("remoteHub.timeline.openDiff",async(r,n,i)=>{var a;!Lo.is(r)&&!Xc.is(r)||r.command!==void 0&&await _.commands.executeCommand(r.command.command,...(a=r.command.arguments)!=null?a:[])}),_.commands.registerCommand("remoteHub.timeline.openOnGitHub",async(r,n,i)=>{if(!Lo.is(r))return;const a=await this.providerService.getMetadata(r.rootUri);await jh("remoteHub.openOnRemote",{provider:a.provider,repo:a.repo,sha:r.hash})}),_.commands.registerCommand("remoteHub.timeline.selectForCompare",async(r,n,i)=>{!n||!Lo.is(r)&&!Xc.is(r)||(e={uri:n,left:r},await _.commands.executeCommand("setContext","remoteHub.timeline.selectedForCompare",!0))}),_.commands.registerCommand("remoteHub.timeline.compareWithSelected",async(r,n,i)=>{if(!n||!e||!Lo.is(r)&&!Xc.is(r)||Oe(n)!==Oe(e.uri))return;const{left:a}=e,l=this.providerService.getRelativeFilePath(r.rootUri,n),d=await this.providerService.getMetadata(r.rootUri),m=bt(n),v=a.parents[0];let E;v===void 0?E=yr("timeline diff title ref","{0} ({1})",m,pr(r.hash)):a.hash===""?E=yr("timeline diff title working","{0} (Working Tree)",m):a.hash==="~"?E=yr("timeline diff title index","{0} (Index)",m):E=yr("timeline diff title ref","{0} ({1})",m,pr(a.hash));let P=a.hash===""||a.hash==="~"?n:this.providerService.createProviderUri(n,{repo:d.repo,ref:{type:Ye.Commit,id:v!=null?v:"0000000000000000000000000000000000000000"}},l);v===void 0&&(P=P.with({query:"~"}));const R=r.parents[0];let I;R===void 0?I=yr("timeline diff title ref","{0} ({1})",m,pr(r.hash)):R==="~"&&r.hash===""?I=yr("timeline diff title working","{0} (Working Tree)",m):r.hash==="~"?I=yr("timeline diff title index","{0} (Index)",m):I=yr("timeline diff title ref","{0} ({1})",m,pr(r.hash));const M=yr("timeline diff title","{0} \u27F7 {1}",E,I),N=r.hash===""||r.hash==="~"?n:this.providerService.createProviderUri(n,{repo:d.repo,ref:{type:Ye.Commit,id:r.hash}},l);await _.commands.executeCommand("vscode.diff",P,N,M)})]}resolveDiffCommand(e,r,n,i,a){const l=bt(n),d=e.parents[0];let m;d===void 0?m=yr("timeline diff title ref","{0} ({1})",l,pr(e.hash)):e.hash===""?m=yr("timeline diff title working","{0} (Working Tree)",l):e.hash==="~"?m=yr("timeline diff title index","{0} (Index)",l):m=yr("timeline diff title refs","{0} ({1}) \u27F7  {0} ({2})",l,pr(d),pr(e.hash));let v=this.providerService.createProviderUri(n,{repo:r.repo,ref:{type:Ye.Commit,id:d!=null?d:"0000000000000000000000000000000000000000"}},i);d===void 0&&(v=v.with({query:"~"}));const E=e.hash===""||e.hash==="~"?n:this.providerService.createProviderUri(n,{repo:r.repo,ref:{type:Ye.Commit,id:e.hash}},i);return{command:"vscode.diff",title:"Open Comparison",arguments:[v,E,m,a]}}}class hE{constructor(e,r){this.providerService=e,this.telemetryService=r,this.disposable=_.window.registerUriHandler(this)}dispose(){this.disposable.dispose()}async handleUri(e){var r;const n=new ce(`RemoteUriHandler.handleUri(${e.path}, ${e.toString()})`);try{switch(e.path){case"/open":{this.telemetryService.sendEvent("handleUri.open");let i,a;for(const d of e.query.split("&")){const[m,v]=d.split("=");switch(m){case"url":i=decodeURIComponent(v);break;case"location":a=v===nr.CurrentWindow?nr.CurrentWindow:nr.NewWindow;break}}if(!i){n.log({message:": Unable to find url parameter"}),this.telemetryService.sendEvent("handleUri.open.abort",{reason:"aborted url not found"});return}i=i.trim(),a=a!=null?a:nr.NewWindow;const l=await this.providerService.createWorkspaceForRemoteUrl(i,void 0,a);if(!l){n.log({message:`: Unable to open workspace for ${i}`}),this.telemetryService.sendEvent("handleUri.open.abort",{reason:"aborted invalid url"});return}n.log({message:`: Opening ${i} in ${a}`}),qn(l);break}case"/open-files":{let i;for(const l of e.query.split("&")){const[d,m]=l.split("=");if(d==="url"){i=decodeURIComponent(m);break}}if(!i){n.log({message:": Unable to find url parameter"});return}i=i.trim();const a=await this.providerService.createWorkspaceForRemoteUrl(i);if(!a){n.log({message:`: Unable to open files/folders for ${i}`});return}a.filesToOpen?(n.log({message:`: Opening files/folders for ${i}`}),await((r=_h())==null?void 0:r.openPendingFiles(a.uri,a.filesToOpen))):n.log({message:`: No files/folders found to open for ${i}`});break}case"/login":{Kp.fire(e);break}default:{n.log({message:`: Unknown Uri ${e.toString()}`});break}}}finally{n.stop()}}}const Sn=(0,F.loadMessageBundle)(),ed=class{constructor(t,e,r,n){this.providerService=t,this.storageService=e,this.changeStore=r,this.workspaceId=n,this._onDidChange=new _.EventEmitter,this.cache=new Map,this.lock=new bd("WorkspaceRepositories"),this.disposable=_.Disposable.from(this.providerService.onDidChangeRepositories(this.onRepositoriesChanged,this),this.providerService.onDidChangeRepository(this.onRepositoryChanged,this),this.changeStore.onDidChange(this.onChangeStoreChanged,this))}get onDidChange(){return this._onDidChange.event}dispose(){this.disposable.dispose()}async exportDebugInfo(){const t=await _.workspace.openTextDocument({language:"json",content:`Remote Repositories

${this.toStorage(await this.getCore())}`});return void _.window.showTextDocument(t)}onChangeStoreChanged(t){const e=rp(t.map(r=>r.rootUri),r=>Oe(r)).map(r=>this.providerService.getRepository(r)).filter(r=>Boolean(r));this.addOrUpdate(e)}onRepositoriesChanged(t){this.addOrUpdate(t.added)}onRepositoryChanged(t){this.addOrUpdate([t.repository])}async get(t){let e=await this.lock.synchronizeRead(async()=>{let r=this.cache.get("workspaceRepositories");return r===void 0&&(r=[...(await this.getCore()).values()].sort((n,i)=>i.timestamp-n.timestamp),this.cache.set("workspaceRepositories",r)),r},"WorkspaceRepositories.get");if(t){const r=Oe(t);e=e.filter(n=>Oe(n.canonicalUri)===r)}return e}async getCore(){return this.fromStorage(await this.storageService.get(ed.storageKey))}async getByCanonicalUri(){let t=this.cache.get("groupedWorkspaceRepositories");return t===void 0&&(t=qS(await this.get(),e=>Oe(e.canonicalUri)),this.cache.set("groupedWorkspaceRepositories",t)),t}async getRecents(t=10){return(await this.get()).slice(0,t)}async getRemoteWorkspaceSourceProvider(t){const e=await this.getRecents();if(e.length!==0)return{name:"Recents",label:"Open Recent Repository",icon:"$(history)",placeholder:Sn("pick","Choose a recent repository"),provideSources:function(r,n){return e.filter(i=>i.provider.id===t).map(i=>({name:i.name,icon:"$(repo)",description:_u(i.timestamp,{ago:!0}),detail:`${i.provider.name}${i.pullRequest?`\xA0\xA0\u2022\xA0\xA0$(git-pull-request) Pull Request #${i.pullRequest.id}`:""}${Dt.isCanonicalUri(i.uri)?"":`\xA0\xA0\u2022\xA0\xA0${up(i.ref.type)} ${i.ref.name}`}\xA0\xA0\u2022\xA0\xA0${Qv(i.changes)}${i.idx?`\xA0\xA0\u2022\xA0\xA0${aE(i.idx.type)}`:""}`,workspace:{uri:i.uri,name:i.name,location:nr.CurrentWindow}}))}}}refresh(){this.cache.clear()}async remove(t){await this.lock.synchronizeWrite(async()=>{const e=await this.getCore(),r=`${t.workspaceId}/${Oe(t.uri)}`,n=e.get(r);if(n===void 0)return;const i=this.changeStore.getScopedChangeStore(n),a=await i.getChanges(n.uri);if(a.length!==0){const l={title:Sn("remove remote repo prompt confirm","Yes")},d={title:Sn("remove remote repo prompt cancel","No"),isCloseAffordance:!0};if(await _.window.showWarningMessage(a.length===1?Sn("remove remote repo prompt file changed",`This repository contains 1 file with uncommitted changes.

Removing it will cause those changes to be FOREVER LOST.
This is IRREVERSIBLE!

Are you sure you still want to remove it?`):Sn("remove remote repo prompt files changes",`This repository contains {0} files with uncommitted changes.

Removing it will cause those changes to be FOREVER LOST.
This is IRREVERSIBLE!

Are you sure you still want to remove it?`,a.length),{modal:!0,useCustom:!0},l,d)!==l)return;await i.discardAll(n.uri)}this.cache.clear(),e.delete(r);try{await this.storageService.store(ed.storageKey,this.toStorage(e))}catch(l){throw he.error(l,"Failed to save workspace repositories"),l}},"WorkspaceRepositories.remove"),this._onDidChange.fire()}async addOrUpdate(t){await this.lock.synchronizeWrite(async()=>{this.cache.clear();const e=await this.getCore();for(const r of t){const[{HEAD:n,pullRequest:i},a]=await Promise.all([r.getMetadata(),r.getIndexMetadata()]),l=await this.changeStore.getChanges(r.uri);e.set(`${this.workspaceId}/${Oe(r.uri)}`,{workspaceId:this.workspaceId,uri:r.uri,canonicalUri:r.canonicalUri,name:r.name,provider:r.provider,ref:{type:n.type,name:n.name},idx:(a==null?void 0:a.type)&&Bt.hasIndex(a.type)?{type:a.type}:void 0,pullRequest:i?{id:i.id}:void 0,changes:pE(l),timestamp:Date.now()})}try{await this.storageService.store(ed.storageKey,this.toStorage(e))}catch(r){throw he.error(r,"Failed to save workspace repositories"),r}},"WorkspaceRepositories.addOrUpdate"),this._onDidChange.fire()}fromStorage(t){if(!t)return new Map;try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&Lt(n)?_.Uri.from(n):n);return new Map(e.workspaceRepositories)}catch(e){return he.error(e,"Failed to deserialize workspace repositories"),new Map}}toStorage(t){const e={schemaVersion:ed.storageSchemaVersion,workspaceRepositories:[...t]};return JSON.stringify(e)}};let gp=ed;gp.storageKey="workspaceRepositories",gp.storageSchemaVersion=1;function Kv(t){return t!==void 0&&(t.added!==0||t.changed!==0||t.deleted!==0)}function fE(t){return Kv(t.changes)}function pE(t){let e=0,r=0,n=0;for(const i of t)switch(i.type){case Ot.Created:e++;break;case Ot.Changed:r++;break;case Ot.Deleted:n++;break}return e||r||n?{added:e,changed:r,deleted:n,timestamp:Date.now()}:void 0}function Qv(t,{compact:e=!0,preamble:r,separator:n=", ",short:i=!1,single:a=!1}={}){if(!Kv(t))return Sn("no changes","No changes");const{added:l,changed:d,deleted:m}=t;if(a){const E=l+d+m;return E===1?Sn("summary change","{0} change",E):Sn("changes changes","{0} changes",E)}let v=`${r!=null?r:""}`;return(l||!e)&&(v+=i?`+${l}`:l===1?Sn("file added","{0} file added",l):Sn("files added","{0} files added",l),(d||m||!e)&&(v+=n)),(d||!e)&&(v+=i?`~${d}`:d===1?Sn("file changed","{0} file changed",d):Sn("files changed","{0} files changed",d),(m||!e)&&(v+=n)),(m||!e)&&(v+=i?`-${m}`:m===1?Sn("file deleted","{0} file deleted",m):Sn("files deleted","{0} files deleted",m)),v}var gE=Object.defineProperty,mE=Object.getOwnPropertyDescriptor,vE=(t,e,r,n)=>{for(var i=n>1?void 0:n?mE(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&gE(e,r,i),i},Yc;(function(t){t.Change="remoteHub:viewItem:change",t.WorkspaceRepository="remoteHub:viewItem:workspaceRepository",t.WorkspaceRepositories="remoteHub:viewItem:workspaceRepositories",t.Message="remoteHub:viewItem:message"})(Yc||(Yc={}));const Xv=class{constructor(t,e){this.view=t,this.parent=e,this.splatted=!1}static is(t){return t instanceof Xv}get id(){}toString(){return`${he.toLoggableName(this)}${this.id!==void 0?`(${this.id})`:""}`}getParent(){var t,e;return((t=this.parent)==null?void 0:t.splatted)?(e=this.parent)==null?void 0:e.getParent():this.parent}triggerChange(t=!1,e=!1,r){return this.splatted&&this.parent!==void 0&&this.parent!==r?this.parent.triggerChange(t,e):this.view.refreshNode(this,t,e)}};let Zc=Xv;vE([qr((t=!1,e=!1,r)=>JSON.stringify([t,e,r==null?void 0:r.toString()]))],Zc.prototype,"triggerChange",1);class yE{constructor(e,r,n,i){this.id=e,this.name=r,this.providerService=n,this.telemetryService=i,this._onDidChangeTreeData=new _.EventEmitter,this.disposables=[];const a=!1;if(he.isDebugging&&a){const l=this.getTreeItem;this.getTreeItem=async function(d){var m;const v=await l.apply(this,[d]),E=d.getParent();return v.tooltip===void 0&&(v.tooltip=new _.MarkdownString(v.label!==void 0&&typeof v.label!="string"?v.label.label:(m=v.label)!=null?m:"")),typeof v.tooltip=="string"?v.tooltip=`${v.tooltip}

---
context: ${v.contextValue}
node: ${d.toString()}${E!==void 0?`
parent: ${E.toString()}`:""}`:v.tooltip.appendMarkdown(`

---

context: \`${v.contextValue}\`\\
node: \`${d.toString()}\`${E!==void 0?`\\
parent: \`${E.toString()}\``:""}`),v}}this.disposables.push(...this.registerCommands()),this.initialize({showCollapseAll:this.showCollapseAll}),setTimeout(()=>this.onConfigurationChanged(),0)}get onDidChangeTreeData(){return this._onDidChangeTreeData.event}get showCollapseAll(){return!0}filterConfigurationChanged(e){return!!Ne.changed(e,`views.${this.configKey}`)}dispose(){_.Disposable.from(...this.disposables).dispose()}get title(){return this._title}set title(e){this._title=e,this.tree!==void 0&&(this.tree.title=e)}get description(){return this._description}set description(e){this._description=e,this.tree!==void 0&&(this.tree.description=e)}get message(){return this._message}set message(e){this._message=e,this.tree!==void 0&&(this.tree.message=e)}getQualifiedCommand(e){return`${this.id}.${e}`}onConfigurationChanged(e){e!==void 0&&this.root!==void 0&&this.refresh(!0)}initialize(e={}){this.tree=_.window.createTreeView(this.id,{...e,treeDataProvider:this}),this.disposables.push(Ne.onDidChange(r=>{!this.filterConfigurationChanged(r)||(this._config=void 0,this.onConfigurationChanged(r))},this),this.tree),this._title=this.tree.title}ensureRoot(e=!1){return(this.root===void 0||e)&&(this.telemetryService.sendEvent("view.open",{view:this.id}),this.root=this.getRoot()),this.root}getChildren(e){return e!==void 0?e.getChildren():this.ensureRoot().getChildren()}getParent(e){return e.getParent()}getTreeItem(e){return e.getTreeItem()}get selection(){return this.tree===void 0||this.root===void 0?[]:this.tree.selection}get visible(){return this.tree!==void 0?this.tree.visible:!1}async refresh(e=!1){var r,n;await((n=(r=this.root)==null?void 0:r.refresh)==null?void 0:n.call(r,e)),this.triggerNodeChange()}async refreshNode(e,r=!1,n=!1){var i;const a=await((i=e.refresh)==null?void 0:i.call(e,r));!n&&a===!0||this.triggerNodeChange(e)}async reveal(e,r){if(this.tree!==void 0)try{await this.tree.reveal(e,r)}catch(n){he.error(n)}}async show(){try{await _.commands.executeCommand(`${this.id}.focus`)}catch(e){he.error(e)}}triggerNodeChange(e){this._onDidChangeTreeData.fire(e!==void 0&&e!==this.root?e:void 0)}get config(){return this._config===void 0&&(this._config=Ne.get("views")[this.configKey]),this._config}}class _E extends Zc{constructor(e,r,n,i,a,l,d){super(e,r);this._message=n,this._description=i,this._tooltip=a,this._iconPath=l,this._contextValue=d}getChildren(){return[]}getTreeItem(){var e;const r=new _.TreeItem(this._message,_.TreeItemCollapsibleState.None);return r.contextValue=(e=this._contextValue)!=null?e:Yc.Message,r.description=this._description,r.tooltip=this._tooltip,r.iconPath=this._iconPath,r}}var bE=Object.defineProperty,wE=Object.getOwnPropertyDescriptor,mp=(t,e,r,n)=>{for(var i=n>1?void 0:n?wE(e,r):e,a=t.length-1,l;a>=0;a--)(l=t[a])&&(i=(n?l(e,r,i):l(i))||i);return n&&i&&bE(e,r,i),i};const Pr=(0,F.loadMessageBundle)(),Yv=class extends Zc{constructor(t,e,r,n,i,a,l){super(t,e);this.changeStore=r,this.canonical=n,this.workspaceRepository=i,this.operation=a,this.canApplyChanges=l}static getId(t,e,r){return`${td.getId(t,e)}:${this.key}(${r.uri.toString()})`}get id(){return Yv.getId(this.canonical.uri,this.workspaceRepository,this.operation)}getChildren(){return[]}async getTreeItem(){const t=this.view.providerService.getRelativeFilePath(this.workspaceRepository.uri,this.operation.uri),e=new _.TreeItem(t,_.TreeItemCollapsibleState.None);return e.id=this.id,e.contextValue=`${Yc.Change}${this.canApplyChanges?"+apply":""}`,e.resourceUri=this.view.changeStore.getScopedUri(this.operation.uri,this.workspaceRepository),e.command=await this.getDiffCommand(t,!0),e}async getDiffCommand(t,e=!1){if(e||this._command===void 0){const r=Boolean(this.operation.staged&&Ne.get("staging.enabled"));if(this.workspaceRepository.workspaceId===this.view.workspaceId){const n=this.view.providerService.getProviderUri(this.operation.uri);this._command=await this.changeStore.resolveDiffCommand(this.operation.uri,n,r?Pr("diff title index","{0} (Index)",bt(this.operation.uri),this.workspaceRepository.ref.name):Pr("diff title working","{0} (Working Tree)",bt(this.operation.uri),this.workspaceRepository.ref.name))}else{const{repo:n}=this.view.providerService.getVirtualUriMetadata(this.workspaceRepository.uri),i=this.view.providerService.createProviderUri(this.operation.uri,{repo:n,ref:{type:Ye.Commit,id:this.operation.revision}},t);this._command=await this.changeStore.resolveDiffCommand(this.operation.uri,i,r?Pr("diff title changeset index","{0} (Index of {1})",bt(this.operation.uri),this.workspaceRepository.ref.name):Pr("diff title changeset working","{0} (Working Tree of {1})",bt(this.operation.uri),this.workspaceRepository.ref.name))}}return this._command}async openChanges(){var t;const e=await this.getDiffCommand(this.view.providerService.getRelativeFilePath(this.workspaceRepository.uri,this.operation.uri));await _.commands.executeCommand(e.command,...(t=e.arguments)!=null?t:[])}async openFile(){const t=this.view.changeStore.getScopedUri(this.operation.uri,this.workspaceRepository.workspaceId);await _.window.showTextDocument(t)}async applyChanges(){const t=await this.view.getRepositoryToApplyChangesetTo(this.workspaceRepository);if(t!==void 0)try{await this.view.changeStore.applyChangeset(t.uri,this.workspaceRepository,this.operation)}catch(e){_.window.showErrorMessage(String(e))}}};let Zv=Yv;Zv.key=":changes";const Jv=class extends Zc{constructor(t,e,r,n,i){super(t,e);this.canonical=r,this.workspaceRepository=n,this.root=i}static getId(t,e){return`${vh.getId(t)}:${this.key}(${e.workspaceId}/${e.uri.toString()})`}get id(){return Jv.getId(this.canonical.uri,this.workspaceRepository)}get name(){return this.workspaceRepository.name}get uri(){return this.workspaceRepository.uri}canApplyChanges(){if(!this.canonical.hasActive||_.workspace.getWorkspaceFolder(this.workspaceRepository.uri)!==void 0)return!1;const{changes:e}=this.workspaceRepository;return e!==void 0&&(e.added!==0||e.changed!==0||e.deleted!==0)}async getChildren(){if(this._children===void 0){const t=this.view.changeStore.getScopedChangeStore(this.workspaceRepository),e=await t.getChanges(this.workspaceRepository.uri);this._children=e.map(r=>new Zv(this.view,this,t,this.canonical,this.workspaceRepository,r,this.canApplyChanges()))}return this._children}getTreeItem(){const t=this.workspaceRepository.workspaceId===this.view.workspaceId,e=fE(this.workspaceRepository),r=Dt.isCanonicalUri(this.workspaceRepository.uri)?Pr("repositories view repository default ref","{0} (default)",this.workspaceRepository.ref.name):this.workspaceRepository.ref.name,n=new _.TreeItem(this.root?this.canonical.name:r,e?_.TreeItemCollapsibleState.Collapsed:_.TreeItemCollapsibleState.None);return n.id=this.id,n.contextValue=`${Yc.WorkspaceRepository}${t?"+active":""}${this.canApplyChanges()?"+apply":""}`,n.description=`${this.root?`${this.workspaceRepository.ref.name}\xA0\xA0\u2022\xA0\xA0`:""}${_u(this.workspaceRepository.timestamp,{ago:!0})}`,n.iconPath=t?new _.ThemeIcon("check"):this.root?ry(this.canonical.provider.id):sE(this.workspaceRepository.ref.type,this.workspaceRepository.pullRequest),n.tooltip=new _.MarkdownString(void 0,!0).appendMarkdown(Pr("repositories view repository tooltip",`{0}{1}\\
{2} {3} {4}{5}\\
Last accessed {6}

{7}
`,this.canonical.name,this.workspaceRepository.pullRequest?Pr("pull request",`\\
Pull request {0} #{1}`,"$(git-pull-request)",this.workspaceRepository.pullRequest.id):"",EE(this.workspaceRepository.ref.type),up(this.workspaceRepository.ref.type),r,t?` \u2014 _${Pr("repositories view repository tooltip active","Active")}_ `:"",_u(this.workspaceRepository.timestamp,{ago:!0}),Qv(this.workspaceRepository.changes,{preamble:`${Pr("repositories view has changes","Has Uncommitted Changes")}\\
`}))),e&&(n.resourceUri=_.Uri.parse("remotehub-view://wsrepo/changes")),n}refresh(t=!1){t&&(this._children=void 0)}async applyAllChanges(){const t=await this.view.getRepositoryToApplyChangesetTo(this.workspaceRepository);if(t!==void 0)try{await this.view.changeStore.applyChangeset(t.uri,this.workspaceRepository)}catch(e){_.window.showErrorMessage(String(e))}}remove(){return this.view.workspaceRepositories.remove(this.workspaceRepository)}};let td=Jv;td.key=":wsrepo",mp([qr()],td.prototype,"refresh",1);const ey=class extends Zc{constructor(t,e,r,n){super(t,e);this.canonical=r,this.workspaceRepositories=n}static getId(t){return`remoteHub${this.key}(${t.toString()})`}get id(){return ey.getId(this.canonical.uri)}get name(){return this.canonical.name}get uri(){return this.canonical.uri}getChildren(){if(this.children===void 0){const t=this.workspaceRepositories;if(t.length===0)return this.view.message=void 0,[new _E(this.view,this,Pr("repositories view message empty","No GitHub repositories could be found."))];this.view.message=void 0,this.children=t.map(e=>new td(this.view,this,this.canonical,e,!1))}return this.children}getTreeItem(){const t=this.workspaceRepositories.some(r=>r.workspaceId===this.view.workspaceId),e=new _.TreeItem(this.canonical.name,t?_.TreeItemCollapsibleState.Expanded:_.TreeItemCollapsibleState.Collapsed);return e.contextValue=Yc.WorkspaceRepositories,e.iconPath=ry(this.canonical.provider.id),e}refresh(t=!1){t&&(this.children=void 0)}};let vh=ey;vh.key=":wsrepos",mp([qr()],vh.prototype,"refresh",1);class ty extends Zc{constructor(e){super(e);this.splatted=!0}async getChildren(){if(this.children===void 0){const e=await this.view.workspaceRepositories.getByCanonicalUri();if(e.size===0)return this.view.message=Pr("repositories view message empty","No GitHub repositories could be found."),[];this.view.message=void 0;const r=[];for(const[n,i]of e){const a=_.Uri.parse(n);try{const{name:l,provider:d}=this.view.providerService.getVirtualUriMetadata(a),m={uri:a,name:l,provider:d,hasActive:i.some(v=>v.workspaceId===this.view.workspaceId)};i.length===1?r.push(new td(this.view,this,m,i[0],!0)):r.push(new vh(this.view,this,m,i))}catch(l){if(l instanceof Pn)continue;he.error(l)}}this.children=r}return this.children}getTreeItem(){return new _.TreeItem("Repositories",_.TreeItemCollapsibleState.Expanded)}refresh(e=!1){e&&(this.children=void 0)}}mp([qr()],ty.prototype,"refresh",1);class SE extends yE{constructor(e,r,n,i,a){super("remoteHub.views.workspaceRepositories",Pr("remote view title","GitHub Repositories"),e,a);this.workspaceRepositories=r,this.changeStore=n,this.workspaceId=i,this.configKey="workspaceRepositories",this.disposables.push(this.workspaceRepositories.onDidChange(this.onRepositoriesChanged,this),_.window.registerFileDecorationProvider({provideFileDecoration:(l,d)=>{if(!(l.scheme!=="remotehub-view"||l.authority!=="wsrepo"||!l.path.includes("/changes")))return{badge:"\u25CF",color:new _.ThemeColor("remoteHub.decorations.workspaceRepositoriesView.hasUncommittedChangesForegroundColor"),tooltip:Pr("repositories view decoration has changes","Has Uncommitted Changes")}}}))}getRoot(){return new ty(this)}onRepositoriesChanged(){this.refresh(!0)}registerCommands(){return[_.commands.registerCommand(this.getQualifiedCommand("refresh"),()=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.refresh"),this.workspaceRepositories.refresh(),void this.refresh(!0)),this),_.commands.registerCommand(this.getQualifiedCommand("open"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.open"),qn({name:e.name,uri:e.uri,location:nr.CurrentWindow})),this),_.commands.registerCommand(this.getQualifiedCommand("openInNewWindow"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openInNewWindow"),qn({name:e.name,uri:e.uri,location:nr.NewWindow})),this),_.commands.registerCommand(this.getQualifiedCommand("applyAllChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.applyAllChanges"),e.applyAllChanges()),this),_.commands.registerCommand(this.getQualifiedCommand("remove"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.remove"),e.remove()),this),_.commands.registerCommand(this.getQualifiedCommand("openChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openChanges"),e.openChanges()),this),_.commands.registerCommand(this.getQualifiedCommand("openFile"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openFile"),e.openFile()),this),_.commands.registerCommand(this.getQualifiedCommand("applyChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.applyChanges"),e.applyChanges()),this)]}async getRepositoryToApplyChangesetTo(e){const r=Oe(this.providerService.getVirtualCanonicalRootUri(e.uri)),n=this.providerService.repositories.filter(a=>Oe(a.canonicalUri)===r);return await CE(n,Pr("apply changeset pick repository placeholder","Choose a repository to apply the changeset to"))}}function EE(t,e){switch(t){case ct.Branch:return e?Pr("type pr branch","Pull Request #{0}",e.id):Pr("type branch","Branch");case ct.RemoteBranch:return e?Pr("type pr remote branch","Pull Request #{0}",e.id):Pr("type remote branch","Remote Branch");case ct.Tag:return Pr("type tag","Tag");case ct.Commit:return Pr("type commit","Commit")}}function ry(t){switch(t){case Dr.GitHub:return new _.ThemeIcon("github");case Dr.AzureRepos:return new _.ThemeIcon("azure");default:return new _.ThemeIcon("vm")}}async function CE(t,e){if(t.length!==0){if(t.length>1){const r=await _.window.showQuickPick(t.map(n=>({label:n.name,description:n.provider.name,repository:n})),{placeHolder:e});return r?r.repository:void 0}return t[0]}}const vp=(0,F.loadMessageBundle)();let yh;function _h(){return yh}var Ns;(function(t){t.HasCommitted="has:committed",t.Version="version"})(Ns||(Ns={}));let yp;function ny(t){return yp.globalState.get(t)}async function _p(t,e){return yp.globalState.update(t,e)}let iy=!1;function oy(){return iy}async function TE(t){yp=t,at.configure(t),he.configure(t,Ne.get("logLevel")),ce.start("Time to root directory",{log:!1});const e=t.extension.packageJSON.displayName;if(t.extension.id==="GitHub.remotehub-insiders"){iy=!0;const a=_.extensions.getExtension("GitHub.remotehub");if(a!==void 0){const l=a.packageJSON.displayName;he.warn(`${e} was NOT activated because ${l} is also enabled`),setTimeout(()=>void _.window.showErrorMessage(vp("more than one version enabled warning","{0} cannot be used while {1} is also enabled. Please ensure that only one version is enabled.",e,l),vp("ok","OK")),0);return}}const r=Fh.configure(t),n=new hu(t),i=t.extension.packageJSON.version;await _p(Ns.Version,i),await t.workspaceState.update(Ns.Version,i);try{const a=new fp(t.globalState),l=a.with(r),d=new pp(t.globalStorageUri,r),m=new fo(l),v=new Dt(m,n),E=new du(v,l,d,n,r);E.getWorkspacesWithChanges(),yh=new Gv(v,a,E);const P=new lE(v,E,yh,n),R=new Ww(t.globalStorageUri,v),I=new j0(v),M=new gp(v,a,E,r);return t.subscriptions.push(Ne.onDidChange(N=>{!Ne.changed(N,"logLevel")||(he.logLevel=Ne.get("logLevel"))}),v.onDidChangeRepositories(async N=>{for(const B of N.added)try{const j=await B.getMetadata(),{HEAD:K,defaultBranch:ee,name:te,provider:fe,pullRequest:$e}=j,Ae=K.name.replace(/\//g,"\u2009\u2215\u2009");let Te=" ";if($e!==void 0)Te=` ($(git-pull-request) ${$e.id}) `;else if(K.type===ct.Tag)Te=` ($(tag) ${Ae}) `;else if(K.type===ct.Commit)Te=` ($(git-commit) ${Ae}) `;else if(K.type===ct.Branch||K.type===ct.RemoteBranch){const De=K.branch.name.replace(/\//g,"\u2009\u2215\u2009"),Be=K.branch.name===ee.name,et=await B.getIndexMetadata();Be?(et==null?void 0:et.type)===Bt.Active&&(Te=" ($(layers-active)) "):(et==null?void 0:et.type)===Bt.Active?Te=vp("indexed tip with branch"," ({0} - {1}) ",De,"$(layers-active)"):Te=` (${De})`}const qe={uri:B.uri,type:"folder",label:`${te}${Te}[${fe.name}]`};_.commands.executeCommand("_workbench.addToRecentlyOpened",qe)}catch(j){he.error(j,"Failed to add repository to recently opened")}}),new oE(v,E),new Wy,new Wd(v,E),new dE(v,E),new hE(v,n),...zy(v,E,M,t.extension.id,n),...IE(v,E),...xE(v,E,P,R,t),new SE(v,M,E,r,n),R,M,P,yh,E,v,n),n.sendEvent("activate"),Promise.resolve(I)}catch(a){throw he.error(a),a}}function xE(t,e,r,n,i){const a=ay()?new U0(t):void 0;return[RE(t,e,a,r,n),...Ne.get("azureRepos.enabled")?[new _s(i),AE(t,e,a)]:[]]}function RE(t,e,r,n,i){const a=new sp(t,i),l=new lh(t,a,e,i);async function d(){var v;try{let E=(v=_.extensions.getExtension("GitHub.vscode-pull-request-github"))!=null?v:_.extensions.getExtension("GitHub.vscode-pull-request-github-insiders");E||(he.log("[ GHPR] Not currently installed or enabled; waiting..."),await new Promise(B=>{const j=_.extensions.onDidChange(()=>{var K;E=(K=_.extensions.getExtension("GitHub.vscode-pull-request-github"))!=null?K:_.extensions.getExtension("GitHub.vscode-pull-request-github-insiders"),E&&(j.dispose(),B())})})),he.log("[ GHPR] Registering..."),_a(Eo.HasPullRequestExtension,!0);const P=await E.activate();if(!P)throw new Error("Unable to get registration api");const R=P.registerGitProvider(n),I=t.onDidChangeRepositories(B=>M(B));async function M(B){const j=B.added.filter(K=>K.provider.id===Dr.GitHub);if(j.length!==0){he.log("[ GHPR] Checking for opened PRs...");for(const K of j){const ee=await t.getBestRemoteUri(K.uri,Er.PullRequest);if(!!ee){I.dispose(),he.log("[ GHPR] Opened PR found; preloading"),_.commands.executeCommand("github.api.preloadPullRequest",ee.toString());return}}he.log("[ GHPR] No opened PRs found")}}he.log("[ GHPR] Registration complete");const N=t.repositories;return N.length&&M({added:N,removed:[]}),_.Disposable.from(R,I)}catch(E){return he.error(E,"[ GHPR] Registration failed;"),{dispose:()=>{}}}}const m=d();return _.Disposable.from(t.register(Dr.GitHub,"GitHub",a,l,r),a,l,{dispose:async()=>{var v;return void((v=await m)==null?void 0:v.dispose())}})}function AE(t,e,r){const n=new rg(t),i=new Dd(t,n,e);return _.Disposable.from(t.register(Dr.AzureRepos,"Azure Repos",n,i,r),n,i)}function IE(t,e){if(!ay())return[];const r=new k0(t,e);return[r,r.register(new Gg),...Gg.createStatus()]}function ay(){return _.env.uiKind===_.UIKind.Desktop||Ne.get("richNavigation.enabled")===!0}})(),module.exports=__webpack_exports__})();
