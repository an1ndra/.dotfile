(()=>{var __webpack_modules__={879:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.ByteStream=void 0;class B{constructor(N){this.bytes=N,this.byteIndexCurrent=0}hasMoreBytes(){return this.byteIndexCurrent<this.bytes.length}readBytes(N){const $=this.byteIndexCurrent;return this.byteIndexCurrent+=N,this.bytes.slice($,this.byteIndexCurrent)}readByte(){let N=this.bytes[this.byteIndexCurrent];return this.byteIndexCurrent++,N}readString(N){let $="";for(let q=0;q<N;q++){const W=this.readByte();W!=0&&($+=String.fromCharCode(W))}return $}}C.ByteStream=B},7106:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.ChunkSize=C.HeaderSizeInBytes=C.FileNameMaxLength=void 0,C.FileNameMaxLength=99,C.HeaderSizeInBytes=500,C.ChunkSize=512},5759:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TarFile=void 0;const T=B(879),N=B(7106),$=B(4108),q=B(3335);class W{constructor(m){this.entries=m}static fromBytes(m){const E=new T.ByteStream(m),R=[],x=N.ChunkSize;let k=0;for(;E.hasMoreBytes()==!0;){const F=E.readBytes(x);let Q=!0;for(let he=0;he<F.length;he++)if(F[he]!=0){Q=!1;break}if(Q==!0){if(k++,k==2)break}else{k=0;const he=$.TarFileEntry.fromBytes(F,E);R.push(he)}}let H=new W(R);return H.consolidateLongPathEntries(),H}consolidateLongPathEntries(){var m;const E=q.TarFileTypeFlag.Instances().LongFilePath.name,R=this.entries;for(let x=0;x<R.length;x++){const k=R[x];if(((m=k.header.typeFlag)===null||m===void 0?void 0:m.name)==E){const H=R[x+1];H.header.fileName=k.dataAsBytes.reduce((F,Q)=>F+=String.fromCharCode(Q),""),H.header.fileName=H.header.fileName.replace(/\0/g,""),R.splice(x,1),x--}}}}C.TarFile=W},4108:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TarFileEntry=void 0;const T=B(7106),N=B(2895);class ${constructor(W,P){this.header=W,this.dataAsBytes=P}static fromBytes(W,P){const m=T.ChunkSize,E=N.TarFileEntryHeader.fromBytes(W),R=E.fileSizeInBytes,k=Math.ceil(R/m)*m,H=P.readBytes(k).slice(0,R);return new $(E,H)}}C.TarFileEntry=$},2895:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TarFileEntryHeader=void 0;const T=B(879),N=B(3335);class ${constructor(W,P,m,E,R,x,k,H,F,Q,he,_e,j,K,X,L){this.fileName=W,this.fileMode=P,this.userIDOfOwner=m,this.userIDOfGroup=E,this.fileSizeInBytes=R,this.timeModifiedInUnixFormat=x,this.checksum=k,this.typeFlag=H,this.nameOfLinkedFile=F,this.uStarIndicator=Q,this.uStarVersion=he,this.userNameOfOwner=_e,this.groupNameOfOwner=j,this.deviceNumberMajor=K,this.deviceNumberMinor=X,this.filenamePrefix=L,this.fullFileName=L.length?L.endsWith("/")?L+W:L+"/"+W:W}static fromBytes(W){const P=new T.ByteStream(W),m=P.readString(100).trim(),E=P.readString(8),R=P.readString(8),x=P.readString(8),k=P.readString(12),H=P.readBytes(12),F=P.readString(8),Q=P.readString(1),he=P.readString(100),_e=P.readString(6),j=P.readString(2),K=P.readString(32),X=P.readString(32),L=P.readString(8),z=P.readString(8),ee=P.readString(155),se=P.readBytes(12),ie=parseInt(k.trim(),8),ce=parseInt(F,8),ge=N.TarFileTypeFlag.Instances()._All,Ae="_"+Q,Be=ge[Ae];return new $(m,E,R,x,ie,H,ce,Be,he,_e,j,K,X,L,z,ee)}}C.TarFileEntryHeader=$},3335:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TarFileTypeFlag=void 0;class B{constructor($,q){this.value=$,this.id="_"+this.value,this.name=q}static Instances(){return B._instances==null&&(B._instances=new T),B._instances}}C.TarFileTypeFlag=B;class T{constructor(){this.Normal=new B("0","Normal"),this.HardLink=new B("1","Hard Link"),this.SymbolicLink=new B("2","Symbolic Link"),this.CharacterSpecial=new B("3","Character Special"),this.BlockSpecial=new B("4","Block Special"),this.Directory=new B("5","Directory"),this.FIFO=new B("6","FIFO"),this.ContiguousFile=new B("7","Contiguous File"),this.LongFilePath=new B("L","././@LongLink"),this._All=[this.Normal,this.HardLink,this.SymbolicLink,this.CharacterSpecial,this.BlockSpecial,this.Directory,this.FIFO,this.ContiguousFile,this.LongFilePath];for(let $=0;$<this._All.length;$++){const q=this._All[$];this._All[q.id]=q}}}},5790:(d,C,B)=>{"use strict";var T;T={value:!0},C.t9=T=T=T=void 0;const N=B(5759);T={enumerable:!0,get:function(){return N.TarFile}};const $=B(4108);T={enumerable:!0,get:function(){return $.TarFileEntry}};const q=B(2895);T={enumerable:!0,get:function(){return q.TarFileEntryHeader}},C.t9=W=>N.TarFile.fromBytes(W)},3672:(d,C)=>{"use strict";var B=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof T!="undefined")return T;throw new Error("unable to locate global object")},T=B();d.exports=C=T.fetch,T.fetch&&(C.default=T.fetch.bind(T)),C.Headers=T.Headers,C.Request=T.Request,C.Response=T.Response},9742:(d,C)=>{"use strict";C.byteLength=m,C.toByteArray=R,C.fromByteArray=H;for(var B=[],T=[],N=typeof Uint8Array!="undefined"?Uint8Array:Array,$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q=0,W=$.length;q<W;++q)B[q]=$[q],T[$.charCodeAt(q)]=q;T["-".charCodeAt(0)]=62,T["_".charCodeAt(0)]=63;function P(F){var Q=F.length;if(Q%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var he=F.indexOf("=");he===-1&&(he=Q);var _e=he===Q?0:4-he%4;return[he,_e]}function m(F){var Q=P(F),he=Q[0],_e=Q[1];return(he+_e)*3/4-_e}function E(F,Q,he){return(Q+he)*3/4-he}function R(F){var Q,he=P(F),_e=he[0],j=he[1],K=new N(E(F,_e,j)),X=0,L=j>0?_e-4:_e,z;for(z=0;z<L;z+=4)Q=T[F.charCodeAt(z)]<<18|T[F.charCodeAt(z+1)]<<12|T[F.charCodeAt(z+2)]<<6|T[F.charCodeAt(z+3)],K[X++]=Q>>16&255,K[X++]=Q>>8&255,K[X++]=Q&255;return j===2&&(Q=T[F.charCodeAt(z)]<<2|T[F.charCodeAt(z+1)]>>4,K[X++]=Q&255),j===1&&(Q=T[F.charCodeAt(z)]<<10|T[F.charCodeAt(z+1)]<<4|T[F.charCodeAt(z+2)]>>2,K[X++]=Q>>8&255,K[X++]=Q&255),K}function x(F){return B[F>>18&63]+B[F>>12&63]+B[F>>6&63]+B[F&63]}function k(F,Q,he){for(var _e,j=[],K=Q;K<he;K+=3)_e=(F[K]<<16&16711680)+(F[K+1]<<8&65280)+(F[K+2]&255),j.push(x(_e));return j.join("")}function H(F){for(var Q,he=F.length,_e=he%3,j=[],K=16383,X=0,L=he-_e;X<L;X+=K)j.push(k(F,X,X+K>L?L:X+K));return _e===1?(Q=F[he-1],j.push(B[Q>>2]+B[Q<<4&63]+"==")):_e===2&&(Q=(F[he-2]<<8)+F[he-1],j.push(B[Q>>10]+B[Q>>4&63]+B[Q<<2&63]+"=")),j.join("")}},5186:(d,C,B)=>{var T=B(3698),N=B(2505),$=B(6417),q=Function.bind,W=q.bind(q);function P(k,H,F){var Q=W($,null).apply(null,F?[H,F]:[H]);k.api={remove:Q},k.remove=Q,["before","error","after","wrap"].forEach(function(he){var _e=F?[H,he,F]:[H,he];k[he]=k.api[he]=W(N,null).apply(null,_e)})}function m(){var k="h",H={registry:{}},F=T.bind(null,H,k);return P(F,H,k),F}function E(){var k={registry:{}},H=T.bind(null,k);return P(H,k),H}var R=!1;function x(){return R||(console.warn('[before-after-hook]: "Hook()" repurposing warning, use "Hook.Collection()". Read more: https://git.io/upgrade-before-after-hook-to-1.4'),R=!0),E()}x.Singular=m.bind(),x.Collection=E.bind(),d.exports=x,d.exports.Hook=x,d.exports.Singular=x.Singular,d.exports.Collection=x.Collection},2505:d=>{d.exports=C;function C(B,T,N,$){var q=$;B.registry[N]||(B.registry[N]=[]),T==="before"&&($=function(W,P){return Promise.resolve().then(q.bind(null,P)).then(W.bind(null,P))}),T==="after"&&($=function(W,P){var m;return Promise.resolve().then(W.bind(null,P)).then(function(E){return m=E,q(m,P)}).then(function(){return m})}),T==="error"&&($=function(W,P){return Promise.resolve().then(W.bind(null,P)).catch(function(m){return q(m,P)})}),B.registry[N].push({hook:$,orig:q})}},3698:d=>{d.exports=C;function C(B,T,N,$){if(typeof N!="function")throw new Error("method for before hook must be a function");return $||($={}),Array.isArray(T)?T.reverse().reduce(function(q,W){return C.bind(null,B,W,q,$)},N)():Promise.resolve().then(function(){return B.registry[T]?B.registry[T].reduce(function(q,W){return W.hook.bind(null,q,$)},N)():N($)})}},6417:d=>{d.exports=C;function C(B,T,N){if(!!B.registry[T]){var $=B.registry[T].map(function(q){return q.orig}).indexOf(N);$!==-1&&B.registry[T].splice($,1)}}},6744:(d,C,B)=>{"use strict";const T=B(3349),N=B(7529),$=B(8050),q=B(4339),W=(P,m={})=>{let E=[];if(Array.isArray(P))for(let R of P){let x=W.create(R,m);Array.isArray(x)?E.push(...x):E.push(x)}else E=[].concat(W.create(P,m));return m&&m.expand===!0&&m.nodupes===!0&&(E=[...new Set(E)]),E};W.parse=(P,m={})=>q(P,m),W.stringify=(P,m={})=>T(typeof P=="string"?W.parse(P,m):P,m),W.compile=(P,m={})=>(typeof P=="string"&&(P=W.parse(P,m)),N(P,m)),W.expand=(P,m={})=>{typeof P=="string"&&(P=W.parse(P,m));let E=$(P,m);return m.noempty===!0&&(E=E.filter(Boolean)),m.nodupes===!0&&(E=[...new Set(E)]),E},W.create=(P,m={})=>P===""||P.length<3?[P]:m.expand!==!0?W.compile(P,m):W.expand(P,m),d.exports=W},7529:(d,C,B)=>{"use strict";const T=B(2664),N=B(3083),$=(q,W={})=>{let P=(m,E={})=>{let R=N.isInvalidBrace(E),x=m.invalid===!0&&W.escapeInvalid===!0,k=R===!0||x===!0,H=W.escapeInvalid===!0?"\\":"",F="";if(m.isOpen===!0||m.isClose===!0)return H+m.value;if(m.type==="open")return k?H+m.value:"(";if(m.type==="close")return k?H+m.value:")";if(m.type==="comma")return m.prev.type==="comma"?"":k?m.value:"|";if(m.value)return m.value;if(m.nodes&&m.ranges>0){let Q=N.reduce(m.nodes),he=T(...Q,{...W,wrap:!1,toRegex:!0});if(he.length!==0)return Q.length>1&&he.length>1?`(${he})`:he}if(m.nodes)for(let Q of m.nodes)F+=P(Q,m);return F};return P(q)};d.exports=$},6611:d=>{"use strict";d.exports={MAX_LENGTH:1024*64,CHAR_0:"0",CHAR_9:"9",CHAR_UPPERCASE_A:"A",CHAR_LOWERCASE_A:"a",CHAR_UPPERCASE_Z:"Z",CHAR_LOWERCASE_Z:"z",CHAR_LEFT_PARENTHESES:"(",CHAR_RIGHT_PARENTHESES:")",CHAR_ASTERISK:"*",CHAR_AMPERSAND:"&",CHAR_AT:"@",CHAR_BACKSLASH:"\\",CHAR_BACKTICK:"`",CHAR_CARRIAGE_RETURN:"\r",CHAR_CIRCUMFLEX_ACCENT:"^",CHAR_COLON:":",CHAR_COMMA:",",CHAR_DOLLAR:"$",CHAR_DOT:".",CHAR_DOUBLE_QUOTE:'"',CHAR_EQUAL:"=",CHAR_EXCLAMATION_MARK:"!",CHAR_FORM_FEED:"\f",CHAR_FORWARD_SLASH:"/",CHAR_HASH:"#",CHAR_HYPHEN_MINUS:"-",CHAR_LEFT_ANGLE_BRACKET:"<",CHAR_LEFT_CURLY_BRACE:"{",CHAR_LEFT_SQUARE_BRACKET:"[",CHAR_LINE_FEED:`
`,CHAR_NO_BREAK_SPACE:"\xA0",CHAR_PERCENT:"%",CHAR_PLUS:"+",CHAR_QUESTION_MARK:"?",CHAR_RIGHT_ANGLE_BRACKET:">",CHAR_RIGHT_CURLY_BRACE:"}",CHAR_RIGHT_SQUARE_BRACKET:"]",CHAR_SEMICOLON:";",CHAR_SINGLE_QUOTE:"'",CHAR_SPACE:" ",CHAR_TAB:"	",CHAR_UNDERSCORE:"_",CHAR_VERTICAL_LINE:"|",CHAR_ZERO_WIDTH_NOBREAK_SPACE:"\uFEFF"}},8050:(d,C,B)=>{"use strict";const T=B(2664),N=B(3349),$=B(3083),q=(P="",m="",E=!1)=>{let R=[];if(P=[].concat(P),m=[].concat(m),!m.length)return P;if(!P.length)return E?$.flatten(m).map(x=>`{${x}}`):m;for(let x of P)if(Array.isArray(x))for(let k of x)R.push(q(k,m,E));else for(let k of m)E===!0&&typeof k=="string"&&(k=`{${k}}`),R.push(Array.isArray(k)?q(x,k,E):x+k);return $.flatten(R)},W=(P,m={})=>{let E=m.rangeLimit===void 0?1e3:m.rangeLimit,R=(x,k={})=>{x.queue=[];let H=k,F=k.queue;for(;H.type!=="brace"&&H.type!=="root"&&H.parent;)H=H.parent,F=H.queue;if(x.invalid||x.dollar){F.push(q(F.pop(),N(x,m)));return}if(x.type==="brace"&&x.invalid!==!0&&x.nodes.length===2){F.push(q(F.pop(),["{}"]));return}if(x.nodes&&x.ranges>0){let j=$.reduce(x.nodes);if($.exceedsLimit(...j,m.step,E))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let K=T(...j,m);K.length===0&&(K=N(x,m)),F.push(q(F.pop(),K)),x.nodes=[];return}let Q=$.encloseBrace(x),he=x.queue,_e=x;for(;_e.type!=="brace"&&_e.type!=="root"&&_e.parent;)_e=_e.parent,he=_e.queue;for(let j=0;j<x.nodes.length;j++){let K=x.nodes[j];if(K.type==="comma"&&x.type==="brace"){j===1&&he.push(""),he.push("");continue}if(K.type==="close"){F.push(q(F.pop(),he,Q));continue}if(K.value&&K.type!=="open"){he.push(q(he.pop(),K.value));continue}K.nodes&&R(K,x)}return he};return $.flatten(R(P))};d.exports=W},4339:(d,C,B)=>{"use strict";const T=B(3349),{MAX_LENGTH:N,CHAR_BACKSLASH:$,CHAR_BACKTICK:q,CHAR_COMMA:W,CHAR_DOT:P,CHAR_LEFT_PARENTHESES:m,CHAR_RIGHT_PARENTHESES:E,CHAR_LEFT_CURLY_BRACE:R,CHAR_RIGHT_CURLY_BRACE:x,CHAR_LEFT_SQUARE_BRACKET:k,CHAR_RIGHT_SQUARE_BRACKET:H,CHAR_DOUBLE_QUOTE:F,CHAR_SINGLE_QUOTE:Q,CHAR_NO_BREAK_SPACE:he,CHAR_ZERO_WIDTH_NOBREAK_SPACE:_e}=B(6611),j=(K,X={})=>{if(typeof K!="string")throw new TypeError("Expected a string");let L=X||{},z=typeof L.maxLength=="number"?Math.min(N,L.maxLength):N;if(K.length>z)throw new SyntaxError(`Input length (${K.length}), exceeds max characters (${z})`);let ee={type:"root",input:K,nodes:[]},se=[ee],ie=ee,ce=ee,ge=0,Ae=K.length,Be=0,He=0,be,Ye={};const ot=()=>K[Be++],We=De=>{if(De.type==="text"&&ce.type==="dot"&&(ce.type="text"),ce&&ce.type==="text"&&De.type==="text"){ce.value+=De.value;return}return ie.nodes.push(De),De.parent=ie,De.prev=ce,ce=De,De};for(We({type:"bos"});Be<Ae;)if(ie=se[se.length-1],be=ot(),!(be===_e||be===he)){if(be===$){We({type:"text",value:(X.keepEscaping?be:"")+ot()});continue}if(be===H){We({type:"text",value:"\\"+be});continue}if(be===k){ge++;let De=!0,Ge;for(;Be<Ae&&(Ge=ot());){if(be+=Ge,Ge===k){ge++;continue}if(Ge===$){be+=ot();continue}if(Ge===H&&(ge--,ge===0))break}We({type:"text",value:be});continue}if(be===m){ie=We({type:"paren",nodes:[]}),se.push(ie),We({type:"text",value:be});continue}if(be===E){if(ie.type!=="paren"){We({type:"text",value:be});continue}ie=se.pop(),We({type:"text",value:be}),ie=se[se.length-1];continue}if(be===F||be===Q||be===q){let De=be,Ge;for(X.keepQuotes!==!0&&(be="");Be<Ae&&(Ge=ot());){if(Ge===$){be+=Ge+ot();continue}if(Ge===De){X.keepQuotes===!0&&(be+=Ge);break}be+=Ge}We({type:"text",value:be});continue}if(be===R){He++;let De=ce.value&&ce.value.slice(-1)==="$"||ie.dollar===!0;ie=We({type:"brace",open:!0,close:!1,dollar:De,depth:He,commas:0,ranges:0,nodes:[]}),se.push(ie),We({type:"open",value:be});continue}if(be===x){if(ie.type!=="brace"){We({type:"text",value:be});continue}let De="close";ie=se.pop(),ie.close=!0,We({type:De,value:be}),He--,ie=se[se.length-1];continue}if(be===W&&He>0){if(ie.ranges>0){ie.ranges=0;let De=ie.nodes.shift();ie.nodes=[De,{type:"text",value:T(ie)}]}We({type:"comma",value:be}),ie.commas++;continue}if(be===P&&He>0&&ie.commas===0){let De=ie.nodes;if(He===0||De.length===0){We({type:"text",value:be});continue}if(ce.type==="dot"){if(ie.range=[],ce.value+=be,ce.type="range",ie.nodes.length!==3&&ie.nodes.length!==5){ie.invalid=!0,ie.ranges=0,ce.type="text";continue}ie.ranges++,ie.args=[];continue}if(ce.type==="range"){De.pop();let Ge=De[De.length-1];Ge.value+=ce.value+be,ce=Ge,ie.ranges--;continue}We({type:"dot",value:be});continue}We({type:"text",value:be})}do if(ie=se.pop(),ie.type!=="root"){ie.nodes.forEach(at=>{at.nodes||(at.type==="open"&&(at.isOpen=!0),at.type==="close"&&(at.isClose=!0),at.nodes||(at.type="text"),at.invalid=!0)});let De=se[se.length-1],Ge=De.nodes.indexOf(ie);De.nodes.splice(Ge,1,...ie.nodes)}while(se.length>0);return We({type:"eos"}),ee};d.exports=j},3349:(d,C,B)=>{"use strict";const T=B(3083);d.exports=(N,$={})=>{let q=(W,P={})=>{let m=$.escapeInvalid&&T.isInvalidBrace(P),E=W.invalid===!0&&$.escapeInvalid===!0,R="";if(W.value)return(m||E)&&T.isOpenOrClose(W)?"\\"+W.value:W.value;if(W.value)return W.value;if(W.nodes)for(let x of W.nodes)R+=q(x);return R};return q(N)}},3083:(d,C)=>{"use strict";C.isInteger=B=>typeof B=="number"?Number.isInteger(B):typeof B=="string"&&B.trim()!==""?Number.isInteger(Number(B)):!1,C.find=(B,T)=>B.nodes.find(N=>N.type===T),C.exceedsLimit=(B,T,N=1,$)=>$===!1||!C.isInteger(B)||!C.isInteger(T)?!1:(Number(T)-Number(B))/Number(N)>=$,C.escapeNode=(B,T=0,N)=>{let $=B.nodes[T];!$||(N&&$.type===N||$.type==="open"||$.type==="close")&&$.escaped!==!0&&($.value="\\"+$.value,$.escaped=!0)},C.encloseBrace=B=>B.type!=="brace"?!1:B.commas>>0+B.ranges>>0==0?(B.invalid=!0,!0):!1,C.isInvalidBrace=B=>B.type!=="brace"?!1:B.invalid===!0||B.dollar?!0:B.commas>>0+B.ranges>>0==0||B.open!==!0||B.close!==!0?(B.invalid=!0,!0):!1,C.isOpenOrClose=B=>B.type==="open"||B.type==="close"?!0:B.open===!0||B.close===!0,C.reduce=B=>B.reduce((T,N)=>(N.type==="text"&&T.push(N.value),N.type==="range"&&(N.type="text"),T),[]),C.flatten=(...B)=>{const T=[],N=$=>{for(let q=0;q<$.length;q++){let W=$[q];Array.isArray(W)?N(W,T):W!==void 0&&T.push(W)}return T};return N(B),T}},8764:(d,C,B)=>{"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const T=B(9742),N=B(645),$=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;C.Buffer=m,C.SlowBuffer=K,C.INSPECT_MAX_BYTES=50;const q=2147483647;C.kMaxLength=q,m.TYPED_ARRAY_SUPPORT=W(),!m.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function W(){try{const A=new Uint8Array(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,Uint8Array.prototype),Object.setPrototypeOf(A,g),A.foo()===42}catch(A){return!1}}Object.defineProperty(m.prototype,"parent",{enumerable:!0,get:function(){if(!!m.isBuffer(this))return this.buffer}}),Object.defineProperty(m.prototype,"offset",{enumerable:!0,get:function(){if(!!m.isBuffer(this))return this.byteOffset}});function P(A){if(A>q)throw new RangeError('The value "'+A+'" is invalid for option "size"');const g=new Uint8Array(A);return Object.setPrototypeOf(g,m.prototype),g}function m(A,g,v){if(typeof A=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return k(A)}return E(A,g,v)}m.poolSize=8192;function E(A,g,v){if(typeof A=="string")return H(A,g);if(ArrayBuffer.isView(A))return Q(A);if(A==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(Ee(A,ArrayBuffer)||A&&Ee(A.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(Ee(A,SharedArrayBuffer)||A&&Ee(A.buffer,SharedArrayBuffer)))return he(A,g,v);if(typeof A=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=A.valueOf&&A.valueOf();if(M!=null&&M!==A)return m.from(M,g,v);const V=_e(A);if(V)return V;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof A[Symbol.toPrimitive]=="function")return m.from(A[Symbol.toPrimitive]("string"),g,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}m.from=function(A,g,v){return E(A,g,v)},Object.setPrototypeOf(m.prototype,Uint8Array.prototype),Object.setPrototypeOf(m,Uint8Array);function R(A){if(typeof A!="number")throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function x(A,g,v){return R(A),A<=0?P(A):g!==void 0?typeof v=="string"?P(A).fill(g,v):P(A).fill(g):P(A)}m.alloc=function(A,g,v){return x(A,g,v)};function k(A){return R(A),P(A<0?0:j(A)|0)}m.allocUnsafe=function(A){return k(A)},m.allocUnsafeSlow=function(A){return k(A)};function H(A,g){if((typeof g!="string"||g==="")&&(g="utf8"),!m.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const v=X(A,g)|0;let M=P(v);const V=M.write(A,g);return V!==v&&(M=M.slice(0,V)),M}function F(A){const g=A.length<0?0:j(A.length)|0,v=P(g);for(let M=0;M<g;M+=1)v[M]=A[M]&255;return v}function Q(A){if(Ee(A,Uint8Array)){const g=new Uint8Array(A);return he(g.buffer,g.byteOffset,g.byteLength)}return F(A)}function he(A,g,v){if(g<0||A.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<g+(v||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&v===void 0?M=new Uint8Array(A):v===void 0?M=new Uint8Array(A,g):M=new Uint8Array(A,g,v),Object.setPrototypeOf(M,m.prototype),M}function _e(A){if(m.isBuffer(A)){const g=j(A.length)|0,v=P(g);return v.length===0||A.copy(v,0,0,g),v}if(A.length!==void 0)return typeof A.length!="number"||it(A.length)?P(0):F(A);if(A.type==="Buffer"&&Array.isArray(A.data))return F(A.data)}function j(A){if(A>=q)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+q.toString(16)+" bytes");return A|0}function K(A){return+A!=A&&(A=0),m.alloc(+A)}m.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==m.prototype},m.compare=function(g,v){if(Ee(g,Uint8Array)&&(g=m.from(g,g.offset,g.byteLength)),Ee(v,Uint8Array)&&(v=m.from(v,v.offset,v.byteLength)),!m.isBuffer(g)||!m.isBuffer(v))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===v)return 0;let M=g.length,V=v.length;for(let oe=0,me=Math.min(M,V);oe<me;++oe)if(g[oe]!==v[oe]){M=g[oe],V=v[oe];break}return M<V?-1:V<M?1:0},m.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},m.concat=function(g,v){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return m.alloc(0);let M;if(v===void 0)for(v=0,M=0;M<g.length;++M)v+=g[M].length;const V=m.allocUnsafe(v);let oe=0;for(M=0;M<g.length;++M){let me=g[M];if(Ee(me,Uint8Array))oe+me.length>V.length?(m.isBuffer(me)||(me=m.from(me)),me.copy(V,oe)):Uint8Array.prototype.set.call(V,me,oe);else if(m.isBuffer(me))me.copy(V,oe);else throw new TypeError('"list" argument must be an Array of Buffers');oe+=me.length}return V};function X(A,g){if(m.isBuffer(A))return A.length;if(ArrayBuffer.isView(A)||Ee(A,ArrayBuffer))return A.byteLength;if(typeof A!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);const v=A.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&v===0)return 0;let V=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return Xe(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v*2;case"hex":return v>>>1;case"base64":return Me(A).length;default:if(V)return M?-1:Xe(A).length;g=(""+g).toLowerCase(),V=!0}}m.byteLength=X;function L(A,g,v){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((v===void 0||v>this.length)&&(v=this.length),v<=0)||(v>>>=0,g>>>=0,v<=g))return"";for(A||(A="utf8");;)switch(A){case"hex":return Ge(this,g,v);case"utf8":case"utf-8":return be(this,g,v);case"ascii":return We(this,g,v);case"latin1":case"binary":return De(this,g,v);case"base64":return He(this,g,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return at(this,g,v);default:if(M)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),M=!0}}m.prototype._isBuffer=!0;function z(A,g,v){const M=A[g];A[g]=A[v],A[v]=M}m.prototype.swap16=function(){const g=this.length;if(g%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let v=0;v<g;v+=2)z(this,v,v+1);return this},m.prototype.swap32=function(){const g=this.length;if(g%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let v=0;v<g;v+=4)z(this,v,v+3),z(this,v+1,v+2);return this},m.prototype.swap64=function(){const g=this.length;if(g%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let v=0;v<g;v+=8)z(this,v,v+7),z(this,v+1,v+6),z(this,v+2,v+5),z(this,v+3,v+4);return this},m.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?be(this,0,g):L.apply(this,arguments)},m.prototype.toLocaleString=m.prototype.toString,m.prototype.equals=function(g){if(!m.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:m.compare(this,g)===0},m.prototype.inspect=function(){let g="";const v=C.INSPECT_MAX_BYTES;return g=this.toString("hex",0,v).replace(/(.{2})/g,"$1 ").trim(),this.length>v&&(g+=" ... "),"<Buffer "+g+">"},$&&(m.prototype[$]=m.prototype.inspect),m.prototype.compare=function(g,v,M,V,oe){if(Ee(g,Uint8Array)&&(g=m.from(g,g.offset,g.byteLength)),!m.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(v===void 0&&(v=0),M===void 0&&(M=g?g.length:0),V===void 0&&(V=0),oe===void 0&&(oe=this.length),v<0||M>g.length||V<0||oe>this.length)throw new RangeError("out of range index");if(V>=oe&&v>=M)return 0;if(V>=oe)return-1;if(v>=M)return 1;if(v>>>=0,M>>>=0,V>>>=0,oe>>>=0,this===g)return 0;let me=oe-V,ft=M-v;const Dt=Math.min(me,ft),qt=this.slice(V,oe),Xt=g.slice(v,M);for(let Ft=0;Ft<Dt;++Ft)if(qt[Ft]!==Xt[Ft]){me=qt[Ft],ft=Xt[Ft];break}return me<ft?-1:ft<me?1:0};function ee(A,g,v,M,V){if(A.length===0)return-1;if(typeof v=="string"?(M=v,v=0):v>2147483647?v=2147483647:v<-2147483648&&(v=-2147483648),v=+v,it(v)&&(v=V?0:A.length-1),v<0&&(v=A.length+v),v>=A.length){if(V)return-1;v=A.length-1}else if(v<0)if(V)v=0;else return-1;if(typeof g=="string"&&(g=m.from(g,M)),m.isBuffer(g))return g.length===0?-1:se(A,g,v,M,V);if(typeof g=="number")return g=g&255,typeof Uint8Array.prototype.indexOf=="function"?V?Uint8Array.prototype.indexOf.call(A,g,v):Uint8Array.prototype.lastIndexOf.call(A,g,v):se(A,[g],v,M,V);throw new TypeError("val must be string, number or Buffer")}function se(A,g,v,M,V){let oe=1,me=A.length,ft=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(A.length<2||g.length<2)return-1;oe=2,me/=2,ft/=2,v/=2}function Dt(Xt,Ft){return oe===1?Xt[Ft]:Xt.readUInt16BE(Ft*oe)}let qt;if(V){let Xt=-1;for(qt=v;qt<me;qt++)if(Dt(A,qt)===Dt(g,Xt===-1?0:qt-Xt)){if(Xt===-1&&(Xt=qt),qt-Xt+1===ft)return Xt*oe}else Xt!==-1&&(qt-=qt-Xt),Xt=-1}else for(v+ft>me&&(v=me-ft),qt=v;qt>=0;qt--){let Xt=!0;for(let Ft=0;Ft<ft;Ft++)if(Dt(A,qt+Ft)!==Dt(g,Ft)){Xt=!1;break}if(Xt)return qt}return-1}m.prototype.includes=function(g,v,M){return this.indexOf(g,v,M)!==-1},m.prototype.indexOf=function(g,v,M){return ee(this,g,v,M,!0)},m.prototype.lastIndexOf=function(g,v,M){return ee(this,g,v,M,!1)};function ie(A,g,v,M){v=Number(v)||0;const V=A.length-v;M?(M=Number(M),M>V&&(M=V)):M=V;const oe=g.length;M>oe/2&&(M=oe/2);let me;for(me=0;me<M;++me){const ft=parseInt(g.substr(me*2,2),16);if(it(ft))return me;A[v+me]=ft}return me}function ce(A,g,v,M){return mt(Xe(g,A.length-v),A,v,M)}function ge(A,g,v,M){return mt(Ot(g),A,v,M)}function Ae(A,g,v,M){return mt(Me(g),A,v,M)}function Be(A,g,v,M){return mt(Vi(g,A.length-v),A,v,M)}m.prototype.write=function(g,v,M,V){if(v===void 0)V="utf8",M=this.length,v=0;else if(M===void 0&&typeof v=="string")V=v,M=this.length,v=0;else if(isFinite(v))v=v>>>0,isFinite(M)?(M=M>>>0,V===void 0&&(V="utf8")):(V=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const oe=this.length-v;if((M===void 0||M>oe)&&(M=oe),g.length>0&&(M<0||v<0)||v>this.length)throw new RangeError("Attempt to write outside buffer bounds");V||(V="utf8");let me=!1;for(;;)switch(V){case"hex":return ie(this,g,v,M);case"utf8":case"utf-8":return ce(this,g,v,M);case"ascii":case"latin1":case"binary":return ge(this,g,v,M);case"base64":return Ae(this,g,v,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Be(this,g,v,M);default:if(me)throw new TypeError("Unknown encoding: "+V);V=(""+V).toLowerCase(),me=!0}},m.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function He(A,g,v){return g===0&&v===A.length?T.fromByteArray(A):T.fromByteArray(A.slice(g,v))}function be(A,g,v){v=Math.min(A.length,v);const M=[];let V=g;for(;V<v;){const oe=A[V];let me=null,ft=oe>239?4:oe>223?3:oe>191?2:1;if(V+ft<=v){let Dt,qt,Xt,Ft;switch(ft){case 1:oe<128&&(me=oe);break;case 2:Dt=A[V+1],(Dt&192)==128&&(Ft=(oe&31)<<6|Dt&63,Ft>127&&(me=Ft));break;case 3:Dt=A[V+1],qt=A[V+2],(Dt&192)==128&&(qt&192)==128&&(Ft=(oe&15)<<12|(Dt&63)<<6|qt&63,Ft>2047&&(Ft<55296||Ft>57343)&&(me=Ft));break;case 4:Dt=A[V+1],qt=A[V+2],Xt=A[V+3],(Dt&192)==128&&(qt&192)==128&&(Xt&192)==128&&(Ft=(oe&15)<<18|(Dt&63)<<12|(qt&63)<<6|Xt&63,Ft>65535&&Ft<1114112&&(me=Ft))}}me===null?(me=65533,ft=1):me>65535&&(me-=65536,M.push(me>>>10&1023|55296),me=56320|me&1023),M.push(me),V+=ft}return ot(M)}const Ye=4096;function ot(A){const g=A.length;if(g<=Ye)return String.fromCharCode.apply(String,A);let v="",M=0;for(;M<g;)v+=String.fromCharCode.apply(String,A.slice(M,M+=Ye));return v}function We(A,g,v){let M="";v=Math.min(A.length,v);for(let V=g;V<v;++V)M+=String.fromCharCode(A[V]&127);return M}function De(A,g,v){let M="";v=Math.min(A.length,v);for(let V=g;V<v;++V)M+=String.fromCharCode(A[V]);return M}function Ge(A,g,v){const M=A.length;(!g||g<0)&&(g=0),(!v||v<0||v>M)&&(v=M);let V="";for(let oe=g;oe<v;++oe)V+=jt[A[oe]];return V}function at(A,g,v){const M=A.slice(g,v);let V="";for(let oe=0;oe<M.length-1;oe+=2)V+=String.fromCharCode(M[oe]+M[oe+1]*256);return V}m.prototype.slice=function(g,v){const M=this.length;g=~~g,v=v===void 0?M:~~v,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),v<0?(v+=M,v<0&&(v=0)):v>M&&(v=M),v<g&&(v=g);const V=this.subarray(g,v);return Object.setPrototypeOf(V,m.prototype),V};function je(A,g,v){if(A%1!=0||A<0)throw new RangeError("offset is not uint");if(A+g>v)throw new RangeError("Trying to access beyond buffer length")}m.prototype.readUintLE=m.prototype.readUIntLE=function(g,v,M){g=g>>>0,v=v>>>0,M||je(g,v,this.length);let V=this[g],oe=1,me=0;for(;++me<v&&(oe*=256);)V+=this[g+me]*oe;return V},m.prototype.readUintBE=m.prototype.readUIntBE=function(g,v,M){g=g>>>0,v=v>>>0,M||je(g,v,this.length);let V=this[g+--v],oe=1;for(;v>0&&(oe*=256);)V+=this[g+--v]*oe;return V},m.prototype.readUint8=m.prototype.readUInt8=function(g,v){return g=g>>>0,v||je(g,1,this.length),this[g]},m.prototype.readUint16LE=m.prototype.readUInt16LE=function(g,v){return g=g>>>0,v||je(g,2,this.length),this[g]|this[g+1]<<8},m.prototype.readUint16BE=m.prototype.readUInt16BE=function(g,v){return g=g>>>0,v||je(g,2,this.length),this[g]<<8|this[g+1]},m.prototype.readUint32LE=m.prototype.readUInt32LE=function(g,v){return g=g>>>0,v||je(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},m.prototype.readUint32BE=m.prototype.readUInt32BE=function(g,v){return g=g>>>0,v||je(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},m.prototype.readBigUInt64LE=Ht(function(g){g=g>>>0,It(g,"offset");const v=this[g],M=this[g+7];(v===void 0||M===void 0)&&zr(g,this.length-8);const V=v+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,oe=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(V)+(BigInt(oe)<<BigInt(32))}),m.prototype.readBigUInt64BE=Ht(function(g){g=g>>>0,It(g,"offset");const v=this[g],M=this[g+7];(v===void 0||M===void 0)&&zr(g,this.length-8);const V=v*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],oe=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(V)<<BigInt(32))+BigInt(oe)}),m.prototype.readIntLE=function(g,v,M){g=g>>>0,v=v>>>0,M||je(g,v,this.length);let V=this[g],oe=1,me=0;for(;++me<v&&(oe*=256);)V+=this[g+me]*oe;return oe*=128,V>=oe&&(V-=Math.pow(2,8*v)),V},m.prototype.readIntBE=function(g,v,M){g=g>>>0,v=v>>>0,M||je(g,v,this.length);let V=v,oe=1,me=this[g+--V];for(;V>0&&(oe*=256);)me+=this[g+--V]*oe;return oe*=128,me>=oe&&(me-=Math.pow(2,8*v)),me},m.prototype.readInt8=function(g,v){return g=g>>>0,v||je(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},m.prototype.readInt16LE=function(g,v){g=g>>>0,v||je(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},m.prototype.readInt16BE=function(g,v){g=g>>>0,v||je(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},m.prototype.readInt32LE=function(g,v){return g=g>>>0,v||je(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},m.prototype.readInt32BE=function(g,v){return g=g>>>0,v||je(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},m.prototype.readBigInt64LE=Ht(function(g){g=g>>>0,It(g,"offset");const v=this[g],M=this[g+7];(v===void 0||M===void 0)&&zr(g,this.length-8);const V=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(V)<<BigInt(32))+BigInt(v+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),m.prototype.readBigInt64BE=Ht(function(g){g=g>>>0,It(g,"offset");const v=this[g],M=this[g+7];(v===void 0||M===void 0)&&zr(g,this.length-8);const V=(v<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(V)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),m.prototype.readFloatLE=function(g,v){return g=g>>>0,v||je(g,4,this.length),N.read(this,g,!0,23,4)},m.prototype.readFloatBE=function(g,v){return g=g>>>0,v||je(g,4,this.length),N.read(this,g,!1,23,4)},m.prototype.readDoubleLE=function(g,v){return g=g>>>0,v||je(g,8,this.length),N.read(this,g,!0,52,8)},m.prototype.readDoubleBE=function(g,v){return g=g>>>0,v||je(g,8,this.length),N.read(this,g,!1,52,8)};function Y(A,g,v,M,V,oe){if(!m.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>V||g<oe)throw new RangeError('"value" argument is out of bounds');if(v+M>A.length)throw new RangeError("Index out of range")}m.prototype.writeUintLE=m.prototype.writeUIntLE=function(g,v,M,V){if(g=+g,v=v>>>0,M=M>>>0,!V){const ft=Math.pow(2,8*M)-1;Y(this,g,v,M,ft,0)}let oe=1,me=0;for(this[v]=g&255;++me<M&&(oe*=256);)this[v+me]=g/oe&255;return v+M},m.prototype.writeUintBE=m.prototype.writeUIntBE=function(g,v,M,V){if(g=+g,v=v>>>0,M=M>>>0,!V){const ft=Math.pow(2,8*M)-1;Y(this,g,v,M,ft,0)}let oe=M-1,me=1;for(this[v+oe]=g&255;--oe>=0&&(me*=256);)this[v+oe]=g/me&255;return v+M},m.prototype.writeUint8=m.prototype.writeUInt8=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,1,255,0),this[v]=g&255,v+1},m.prototype.writeUint16LE=m.prototype.writeUInt16LE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,2,65535,0),this[v]=g&255,this[v+1]=g>>>8,v+2},m.prototype.writeUint16BE=m.prototype.writeUInt16BE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,2,65535,0),this[v]=g>>>8,this[v+1]=g&255,v+2},m.prototype.writeUint32LE=m.prototype.writeUInt32LE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,4,4294967295,0),this[v+3]=g>>>24,this[v+2]=g>>>16,this[v+1]=g>>>8,this[v]=g&255,v+4},m.prototype.writeUint32BE=m.prototype.writeUInt32BE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,4,4294967295,0),this[v]=g>>>24,this[v+1]=g>>>16,this[v+2]=g>>>8,this[v+3]=g&255,v+4};function ht(A,g,v,M,V){kt(g,M,V,A,v,7);let oe=Number(g&BigInt(4294967295));A[v++]=oe,oe=oe>>8,A[v++]=oe,oe=oe>>8,A[v++]=oe,oe=oe>>8,A[v++]=oe;let me=Number(g>>BigInt(32)&BigInt(4294967295));return A[v++]=me,me=me>>8,A[v++]=me,me=me>>8,A[v++]=me,me=me>>8,A[v++]=me,v}function st(A,g,v,M,V){kt(g,M,V,A,v,7);let oe=Number(g&BigInt(4294967295));A[v+7]=oe,oe=oe>>8,A[v+6]=oe,oe=oe>>8,A[v+5]=oe,oe=oe>>8,A[v+4]=oe;let me=Number(g>>BigInt(32)&BigInt(4294967295));return A[v+3]=me,me=me>>8,A[v+2]=me,me=me>>8,A[v+1]=me,me=me>>8,A[v]=me,v+8}m.prototype.writeBigUInt64LE=Ht(function(g,v=0){return ht(this,g,v,BigInt(0),BigInt("0xffffffffffffffff"))}),m.prototype.writeBigUInt64BE=Ht(function(g,v=0){return st(this,g,v,BigInt(0),BigInt("0xffffffffffffffff"))}),m.prototype.writeIntLE=function(g,v,M,V){if(g=+g,v=v>>>0,!V){const Dt=Math.pow(2,8*M-1);Y(this,g,v,M,Dt-1,-Dt)}let oe=0,me=1,ft=0;for(this[v]=g&255;++oe<M&&(me*=256);)g<0&&ft===0&&this[v+oe-1]!==0&&(ft=1),this[v+oe]=(g/me>>0)-ft&255;return v+M},m.prototype.writeIntBE=function(g,v,M,V){if(g=+g,v=v>>>0,!V){const Dt=Math.pow(2,8*M-1);Y(this,g,v,M,Dt-1,-Dt)}let oe=M-1,me=1,ft=0;for(this[v+oe]=g&255;--oe>=0&&(me*=256);)g<0&&ft===0&&this[v+oe+1]!==0&&(ft=1),this[v+oe]=(g/me>>0)-ft&255;return v+M},m.prototype.writeInt8=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,1,127,-128),g<0&&(g=255+g+1),this[v]=g&255,v+1},m.prototype.writeInt16LE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,2,32767,-32768),this[v]=g&255,this[v+1]=g>>>8,v+2},m.prototype.writeInt16BE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,2,32767,-32768),this[v]=g>>>8,this[v+1]=g&255,v+2},m.prototype.writeInt32LE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,4,2147483647,-2147483648),this[v]=g&255,this[v+1]=g>>>8,this[v+2]=g>>>16,this[v+3]=g>>>24,v+4},m.prototype.writeInt32BE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[v]=g>>>24,this[v+1]=g>>>16,this[v+2]=g>>>8,this[v+3]=g&255,v+4},m.prototype.writeBigInt64LE=Ht(function(g,v=0){return ht(this,g,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),m.prototype.writeBigInt64BE=Ht(function(g,v=0){return st(this,g,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ct(A,g,v,M,V,oe){if(v+M>A.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("Index out of range")}function fe(A,g,v,M,V){return g=+g,v=v>>>0,V||ct(A,g,v,4,34028234663852886e22,-34028234663852886e22),N.write(A,g,v,M,23,4),v+4}m.prototype.writeFloatLE=function(g,v,M){return fe(this,g,v,!0,M)},m.prototype.writeFloatBE=function(g,v,M){return fe(this,g,v,!1,M)};function pe(A,g,v,M,V){return g=+g,v=v>>>0,V||ct(A,g,v,8,17976931348623157e292,-17976931348623157e292),N.write(A,g,v,M,52,8),v+8}m.prototype.writeDoubleLE=function(g,v,M){return pe(this,g,v,!0,M)},m.prototype.writeDoubleBE=function(g,v,M){return pe(this,g,v,!1,M)},m.prototype.copy=function(g,v,M,V){if(!m.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!V&&V!==0&&(V=this.length),v>=g.length&&(v=g.length),v||(v=0),V>0&&V<M&&(V=M),V===M||g.length===0||this.length===0)return 0;if(v<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(V<0)throw new RangeError("sourceEnd out of bounds");V>this.length&&(V=this.length),g.length-v<V-M&&(V=g.length-v+M);const oe=V-M;return this===g&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(v,M,V):Uint8Array.prototype.set.call(g,this.subarray(M,V),v),oe},m.prototype.fill=function(g,v,M,V){if(typeof g=="string"){if(typeof v=="string"?(V=v,v=0,M=this.length):typeof M=="string"&&(V=M,M=this.length),V!==void 0&&typeof V!="string")throw new TypeError("encoding must be a string");if(typeof V=="string"&&!m.isEncoding(V))throw new TypeError("Unknown encoding: "+V);if(g.length===1){const me=g.charCodeAt(0);(V==="utf8"&&me<128||V==="latin1")&&(g=me)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(v<0||this.length<v||this.length<M)throw new RangeError("Out of range index");if(M<=v)return this;v=v>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let oe;if(typeof g=="number")for(oe=v;oe<M;++oe)this[oe]=g;else{const me=m.isBuffer(g)?g:m.from(g,V),ft=me.length;if(ft===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(oe=0;oe<M-v;++oe)this[oe+v]=me[oe%ft]}return this};const qe={};function Qe(A,g,v){qe[A]=class extends v{constructor(){super();Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${A}]`,this.stack,delete this.name}get code(){return A}set code(V){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:V,writable:!0})}toString(){return`${this.name} [${A}]: ${this.message}`}}}Qe("ERR_BUFFER_OUT_OF_BOUNDS",function(A){return A?`${A} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Qe("ERR_INVALID_ARG_TYPE",function(A,g){return`The "${A}" argument must be of type number. Received type ${typeof g}`},TypeError),Qe("ERR_OUT_OF_RANGE",function(A,g,v){let M=`The value of "${A}" is out of range.`,V=v;return Number.isInteger(v)&&Math.abs(v)>2**32?V=xt(String(v)):typeof v=="bigint"&&(V=String(v),(v>BigInt(2)**BigInt(32)||v<-(BigInt(2)**BigInt(32)))&&(V=xt(V)),V+="n"),M+=` It must be ${g}. Received ${V}`,M},RangeError);function xt(A){let g="",v=A.length;const M=A[0]==="-"?1:0;for(;v>=M+4;v-=3)g=`_${A.slice(v-3,v)}${g}`;return`${A.slice(0,v)}${g}`}function mr(A,g,v){It(g,"offset"),(A[g]===void 0||A[g+v]===void 0)&&zr(g,A.length-(v+1))}function kt(A,g,v,M,V,oe){if(A>v||A<g){const me=typeof g=="bigint"?"n":"";let ft;throw oe>3?g===0||g===BigInt(0)?ft=`>= 0${me} and < 2${me} ** ${(oe+1)*8}${me}`:ft=`>= -(2${me} ** ${(oe+1)*8-1}${me}) and < 2 ** ${(oe+1)*8-1}${me}`:ft=`>= ${g}${me} and <= ${v}${me}`,new qe.ERR_OUT_OF_RANGE("value",ft,A)}mr(M,V,oe)}function It(A,g){if(typeof A!="number")throw new qe.ERR_INVALID_ARG_TYPE(g,"number",A)}function zr(A,g,v){throw Math.floor(A)!==A?(It(A,v),new qe.ERR_OUT_OF_RANGE(v||"offset","an integer",A)):g<0?new qe.ERR_BUFFER_OUT_OF_BOUNDS:new qe.ERR_OUT_OF_RANGE(v||"offset",`>= ${v?1:0} and <= ${g}`,A)}const Pr=/[^+/0-9A-Za-z-_]/g;function tr(A){if(A=A.split("=")[0],A=A.trim().replace(Pr,""),A.length<2)return"";for(;A.length%4!=0;)A=A+"=";return A}function Xe(A,g){g=g||1/0;let v;const M=A.length;let V=null;const oe=[];for(let me=0;me<M;++me){if(v=A.charCodeAt(me),v>55295&&v<57344){if(!V){if(v>56319){(g-=3)>-1&&oe.push(239,191,189);continue}else if(me+1===M){(g-=3)>-1&&oe.push(239,191,189);continue}V=v;continue}if(v<56320){(g-=3)>-1&&oe.push(239,191,189),V=v;continue}v=(V-55296<<10|v-56320)+65536}else V&&(g-=3)>-1&&oe.push(239,191,189);if(V=null,v<128){if((g-=1)<0)break;oe.push(v)}else if(v<2048){if((g-=2)<0)break;oe.push(v>>6|192,v&63|128)}else if(v<65536){if((g-=3)<0)break;oe.push(v>>12|224,v>>6&63|128,v&63|128)}else if(v<1114112){if((g-=4)<0)break;oe.push(v>>18|240,v>>12&63|128,v>>6&63|128,v&63|128)}else throw new Error("Invalid code point")}return oe}function Ot(A){const g=[];for(let v=0;v<A.length;++v)g.push(A.charCodeAt(v)&255);return g}function Vi(A,g){let v,M,V;const oe=[];for(let me=0;me<A.length&&!((g-=2)<0);++me)v=A.charCodeAt(me),M=v>>8,V=v%256,oe.push(V),oe.push(M);return oe}function Me(A){return T.toByteArray(tr(A))}function mt(A,g,v,M){let V;for(V=0;V<M&&!(V+v>=g.length||V>=A.length);++V)g[V+v]=A[V];return V}function Ee(A,g){return A instanceof g||A!=null&&A.constructor!=null&&A.constructor.name!=null&&A.constructor.name===g.name}function it(A){return A!==A}const jt=function(){const A="0123456789abcdef",g=new Array(256);for(let v=0;v<16;++v){const M=v*16;for(let V=0;V<16;++V)g[M+V]=A[v]+A[V]}return g}();function Ht(A){return typeof BigInt=="undefined"?Zt:A}function Zt(){throw new Error("BigInt not supported")}},1:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer=__webpack_require__(8764).Buffer;const Token=__webpack_require__(3416),strtok3=__webpack_require__(5849),{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=__webpack_require__(6188),supported=__webpack_require__(9898),minimumBytes=4100;async function fromStream(d){const C=await strtok3.fromStream(d);try{return await fromTokenizer(C)}finally{await C.close()}}async function fromBuffer(d){if(!(d instanceof Uint8Array||d instanceof ArrayBuffer||Buffer.isBuffer(d)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof d}\``);const C=d instanceof Buffer?d:Buffer.from(d);if(!(C&&C.length>1))return;const B=strtok3.fromBuffer(C);return fromTokenizer(B)}function _check(d,C,B){B={offset:0,...B};for(const[T,N]of C.entries())if(B.mask){if(N!==(B.mask[T]&d[T+B.offset]))return!1}else if(N!==d[T+B.offset])return!1;return!0}async function fromTokenizer(d){try{return _fromTokenizer(d)}catch(C){if(!(C instanceof strtok3.EndOfStreamError))throw C}}async function _fromTokenizer(d){let C=Buffer.alloc(minimumBytes);const B=12,T=($,q)=>_check(C,$,q),N=($,q)=>T(stringToBytes($),q);if(d.fileInfo.size||(d.fileInfo.size=Number.MAX_SAFE_INTEGER),await d.peekBuffer(C,{length:B,mayBeLess:!0}),T([66,77]))return{ext:"bmp",mime:"image/bmp"};if(T([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(T([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(T([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(T([37,33]))return await d.peekBuffer(C,{length:24,mayBeLess:!0}),N("PS-Adobe-",{offset:2})&&N(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(T([31,160])||T([31,157]))return{ext:"Z",mime:"application/x-compress"};if(T([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(T([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(T([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(T([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(N("ID3")){await d.ignore(6);const $=await d.readToken(uint32SyncSafeToken);return d.position+$>d.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await d.ignore($),fromTokenizer(d))}if(N("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((C[0]===67||C[0]===70)&&T([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(T([71,73,70]))return{ext:"gif",mime:"image/gif"};if(N("FLIF"))return{ext:"flif",mime:"image/flif"};if(N("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(N("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(N("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(N("FORM"))return{ext:"aif",mime:"audio/aiff"};if(N("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(T([80,75,3,4])){try{for(;d.position+30<d.fileInfo.size;){await d.readBuffer(C,{length:30});const $={compressedSize:C.readUInt32LE(18),uncompressedSize:C.readUInt32LE(22),filenameLength:C.readUInt16LE(26),extraFieldLength:C.readUInt16LE(28)};if($.filename=await d.readToken(new Token.StringType($.filenameLength,"utf-8")),await d.ignore($.extraFieldLength),$.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if($.filename.endsWith(".rels")||$.filename.endsWith(".xml"))switch($.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if($.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if($.filename.startsWith("3D/")&&$.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if($.filename==="mimetype"&&$.compressedSize===$.uncompressedSize)switch(await d.readToken(new Token.StringType($.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}if($.compressedSize===0){let q=-1;for(;q<0&&d.position<d.fileInfo.size;)await d.peekBuffer(C,{mayBeLess:!0}),q=C.indexOf("504B0304",0,"hex"),await d.ignore(q>=0?q:C.length)}else await d.ignore($.compressedSize)}}catch($){if(!($ instanceof strtok3.EndOfStreamError))throw $}return{ext:"zip",mime:"application/zip"}}if(N("OggS")){await d.ignore(28);const $=Buffer.alloc(8);return await d.readBuffer($),_check($,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check($,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check($,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check($,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check($,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check($,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(T([80,75])&&(C[2]===3||C[2]===5||C[2]===7)&&(C[3]===4||C[3]===6||C[3]===8))return{ext:"zip",mime:"application/zip"};if(N("ftyp",{offset:4})&&(C[8]&96)!=0){const $=C.toString("binary",8,12).replace("\0"," ").trim();switch($){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return $.startsWith("3g")?$.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(N("MThd"))return{ext:"mid",mime:"audio/midi"};if(N("wOFF")&&(T([0,1,0,0],{offset:4})||N("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(N("wOF2")&&(T([0,1,0,0],{offset:4})||N("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(T([212,195,178,161])||T([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(N("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(N("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(N("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(T([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(N("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(N("%PDF")){await d.ignore(1350);const $=10*1024*1024,q=Buffer.alloc(Math.min($,d.fileInfo.size));return await d.readBuffer(q,{mayBeLess:!0}),q.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(T([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(T([73,73,42,0]))return N("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:T([28,0,254,0],{offset:8})||T([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:T([8,0,0,0],{offset:4})&&(T([45,0,254,0],{offset:8})||T([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(C=Buffer.alloc(24),await d.peekBuffer(C),(T([16,251,134,1],{offset:4})||T([8,0,0,0],{offset:4}))&&T([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(T([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(N("MAC "))return{ext:"ape",mime:"audio/ape"};if(T([26,69,223,163])){async function $(){const E=await d.peekNumber(Token.UINT8);let R=128,x=0;for(;(E&R)==0;)++x,R>>=1;const k=Buffer.alloc(x+1);return await d.readBuffer(k),k}async function q(){const E=await $(),R=await $();R[0]^=128>>R.length-1;const x=Math.min(6,R.length);return{id:E.readUIntBE(0,E.length),len:R.readUIntBE(R.length-x,x)}}async function W(E,R){for(;R>0;){const x=await q();if(x.id===17026)return d.readToken(new Token.StringType(x.len,"utf-8"));await d.ignore(x.len),--R}}const P=await q();switch(await W(1,P.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(T([82,73,70,70])){if(T([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(T([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(T([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(N("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(T([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(N("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(N("MSCF")||N("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(T([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(T([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(T([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(T([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(N("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(N("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(T([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(N("IMPM"))return{ext:"it",mime:"audio/x-it"};if(N("-lh0-",{offset:2})||N("-lh1-",{offset:2})||N("-lh2-",{offset:2})||N("-lh3-",{offset:2})||N("-lh4-",{offset:2})||N("-lh5-",{offset:2})||N("-lh6-",{offset:2})||N("-lh7-",{offset:2})||N("-lzs-",{offset:2})||N("-lz4-",{offset:2})||N("-lz5-",{offset:2})||N("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(T([0,0,1,186])){if(T([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(T([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(N("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(T([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(N("<?xml "))return{ext:"xml",mime:"application/xml"};if(T([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(T([82,97,114,33,26,7])&&(C[6]===0||C[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(N("solid "))return{ext:"stl",mime:"model/stl"};if(N("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(N("!<arch>"))return await d.ignore(8),await d.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(T([137,80,78,71,13,10,26,10])){await d.ignore(8);async function $(){return{length:await d.readToken(Token.INT32_BE),type:await d.readToken(new Token.StringType(4,"binary"))}}do{const q=await $();if(q.length<0)return;switch(q.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await d.ignore(q.length+4)}}while(d.position+8<d.fileInfo.size);return{ext:"png",mime:"image/png"}}if(T([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(T([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(T([102,114,101,101],{offset:4})||T([109,100,97,116],{offset:4})||T([109,111,111,118],{offset:4})||T([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(T([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(N("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(T([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(T([48,38,178,117,142,102,207,17,166,217])){async function $(){const q=Buffer.alloc(16);return await d.readBuffer(q),{id:q,size:Number(await d.readToken(Token.UINT64_LE))}}for(await d.ignore(30);d.position+24<d.fileInfo.size;){const q=await $();let W=q.size-24;if(_check(q.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const P=Buffer.alloc(16);if(W-=await d.readBuffer(P),_check(P,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(P,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await d.ignore(W)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(T([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((T([126,16,4])||T([126,24,4]))&&T([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(T([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(T([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await d.ignore(20),await d.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(T([255,10])||T([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(T([0,0,1,186])||T([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(T([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(T([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(T([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(T([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await d.peekBuffer(C,{length:Math.min(256,d.fileInfo.size),mayBeLess:!0}),N("BEGIN:")){if(N("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(N("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(N("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(N("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(N("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(T([4,0,0,0])&&C.length>=16){const $=C.readUInt32LE(12);if($>12&&C.length>=$+16)try{const q=C.slice(16,$+16).toString();if(JSON.parse(q).files)return{ext:"asar",mime:"application/x-asar"}}catch(q){}}if(T([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(N("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(T([71],{offset:4})&&(T([71],{offset:192})||T([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(T([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(T([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(T([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(T([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(T([76,80],{offset:34})&&(T([0,0,1],{offset:8})||T([1,0,2],{offset:8})||T([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(T([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await d.peekBuffer(C,{length:Math.min(512,d.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(C))return{ext:"tar",mime:"application/x-tar"};if(T([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(N("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(C.length>=2&&T([255,224],{offset:0,mask:[255,224]})){if(T([16],{offset:1,mask:[22]}))return T([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(T([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(T([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(T([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const d=new stream.PassThrough;let C;stream.pipeline?C=stream.pipeline(readableStream,d,()=>{}):C=readableStream.pipe(d);const B=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const T=await fromBuffer(B);d.fileType=T}catch(T){reject(T)}resolve(C)})}),fileType={fromStream,fromTokenizer,fromBuffer,stream};Object.defineProperty(fileType,"extensions",{get(){return new Set(supported.extensions)}}),Object.defineProperty(fileType,"mimeTypes",{get(){return new Set(supported.mimeTypes)}}),module.exports=fileType},7769:(d,C,B)=>{"use strict";const T=B(6597),N=B(1);async function $(W){const P=await T.fromFile(W);try{return await N.fromTokenizer(P)}finally{await P.close()}}const q={fromFile:$};Object.assign(q,N),Object.defineProperty(q,"extensions",{get(){return N.extensions}}),Object.defineProperty(q,"mimeTypes",{get(){return N.mimeTypes}}),d.exports=q},9898:d=>{"use strict";d.exports={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]}},6188:(d,C)=>{"use strict";C.stringToBytes=B=>[...B].map(T=>T.charCodeAt(0)),C.tarHeaderChecksumMatches=(B,T=0)=>{const N=parseInt(B.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(N))return!1;let $=8*32;for(let q=T;q<T+148;q++)$+=B[q];for(let q=T+156;q<T+512;q++)$+=B[q];return N===$},C.uint32SyncSafeToken={get:(B,T)=>B[T+3]&127|B[T+2]<<7|B[T+1]<<14|B[T]<<21,len:4}},2664:(d,C,B)=>{"use strict";/*!
 * fill-range <https://github.com/jonschlinkert/fill-range>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Licensed under the MIT License.
 */const T=B(1932),N=B(5702),$=L=>L!==null&&typeof L=="object"&&!Array.isArray(L),q=L=>z=>L===!0?Number(z):String(z),W=L=>typeof L=="number"||typeof L=="string"&&L!=="",P=L=>Number.isInteger(+L),m=L=>{let z=`${L}`,ee=-1;if(z[0]==="-"&&(z=z.slice(1)),z==="0")return!1;for(;z[++ee]==="0";);return ee>0},E=(L,z,ee)=>typeof L=="string"||typeof z=="string"?!0:ee.stringify===!0,R=(L,z,ee)=>{if(z>0){let se=L[0]==="-"?"-":"";se&&(L=L.slice(1)),L=se+L.padStart(se?z-1:z,"0")}return ee===!1?String(L):L},x=(L,z)=>{let ee=L[0]==="-"?"-":"";for(ee&&(L=L.slice(1),z--);L.length<z;)L="0"+L;return ee?"-"+L:L},k=(L,z)=>{L.negatives.sort((ge,Ae)=>ge<Ae?-1:ge>Ae?1:0),L.positives.sort((ge,Ae)=>ge<Ae?-1:ge>Ae?1:0);let ee=z.capture?"":"?:",se="",ie="",ce;return L.positives.length&&(se=L.positives.join("|")),L.negatives.length&&(ie=`-(${ee}${L.negatives.join("|")})`),se&&ie?ce=`${se}|${ie}`:ce=se||ie,z.wrap?`(${ee}${ce})`:ce},H=(L,z,ee,se)=>{if(ee)return N(L,z,{wrap:!1,...se});let ie=String.fromCharCode(L);if(L===z)return ie;let ce=String.fromCharCode(z);return`[${ie}-${ce}]`},F=(L,z,ee)=>{if(Array.isArray(L)){let se=ee.wrap===!0,ie=ee.capture?"":"?:";return se?`(${ie}${L.join("|")})`:L.join("|")}return N(L,z,ee)},Q=(...L)=>new RangeError("Invalid range arguments: "+T.inspect(...L)),he=(L,z,ee)=>{if(ee.strictRanges===!0)throw Q([L,z]);return[]},_e=(L,z)=>{if(z.strictRanges===!0)throw new TypeError(`Expected step "${L}" to be a number`);return[]},j=(L,z,ee=1,se={})=>{let ie=Number(L),ce=Number(z);if(!Number.isInteger(ie)||!Number.isInteger(ce)){if(se.strictRanges===!0)throw Q([L,z]);return[]}ie===0&&(ie=0),ce===0&&(ce=0);let ge=ie>ce,Ae=String(L),Be=String(z),He=String(ee);ee=Math.max(Math.abs(ee),1);let be=m(Ae)||m(Be)||m(He),Ye=be?Math.max(Ae.length,Be.length,He.length):0,ot=be===!1&&E(L,z,se)===!1,We=se.transform||q(ot);if(se.toRegex&&ee===1)return H(x(L,Ye),x(z,Ye),!0,se);let De={negatives:[],positives:[]},Ge=Y=>De[Y<0?"negatives":"positives"].push(Math.abs(Y)),at=[],je=0;for(;ge?ie>=ce:ie<=ce;)se.toRegex===!0&&ee>1?Ge(ie):at.push(R(We(ie,je),Ye,ot)),ie=ge?ie-ee:ie+ee,je++;return se.toRegex===!0?ee>1?k(De,se):F(at,null,{wrap:!1,...se}):at},K=(L,z,ee=1,se={})=>{if(!P(L)&&L.length>1||!P(z)&&z.length>1)return he(L,z,se);let ie=se.transform||(ot=>String.fromCharCode(ot)),ce=`${L}`.charCodeAt(0),ge=`${z}`.charCodeAt(0),Ae=ce>ge,Be=Math.min(ce,ge),He=Math.max(ce,ge);if(se.toRegex&&ee===1)return H(Be,He,!1,se);let be=[],Ye=0;for(;Ae?ce>=ge:ce<=ge;)be.push(ie(ce,Ye)),ce=Ae?ce-ee:ce+ee,Ye++;return se.toRegex===!0?F(be,null,{wrap:!1,options:se}):be},X=(L,z,ee,se={})=>{if(z==null&&W(L))return[L];if(!W(L)||!W(z))return he(L,z,se);if(typeof ee=="function")return X(L,z,1,{transform:ee});if($(ee))return X(L,z,0,ee);let ie={...se};return ie.capture===!0&&(ie.wrap=!0),ee=ee||ie.step||1,P(ee)?P(L)&&P(z)?j(L,z,ee,ie):K(L,z,Math.max(Math.abs(ee),1),ie):ee!=null&&!$(ee)?_e(ee,ie):X(L,z,1,ee)};d.exports=X},7360:function(d,C){var B,T,N;(function($,q){T=[],B=q,N=typeof B=="function"?B.apply(C,T):B,N!==void 0&&(d.exports=N)})(this,function(){function q(j){var K={single:function(X,L,z){if(!X||(Q(X)||(X=K.getPreparedSearch(X)),!L))return null;Q(L)||(L=K.getPrepared(L));var ee=z&&z.allowTypo!==void 0?z.allowTypo:j&&j.allowTypo!==void 0?j.allowTypo:!0,se=ee?K.algorithm:K.algorithmNoTypo;return se(X,L,X[0])},go:function(X,L,z){if(!X)return E;X=K.prepareSearch(X);var ee=X[0],se=z&&z.threshold||j&&j.threshold||-9007199254740991,ie=z&&z.limit||j&&j.limit||9007199254740991,ce=z&&z.allowTypo!==void 0?z.allowTypo:j&&j.allowTypo!==void 0?j.allowTypo:!0,ge=ce?K.algorithm:K.algorithmNoTypo,Ae=0,Be=0,He=L.length;if(z&&z.keys)for(var be=z.scoreFn||H,Ye=z.keys,ot=Ye.length,We=He-1;We>=0;--We){for(var De=L[We],Ge=new Array(ot),at=ot-1;at>=0;--at){var je=Ye[at],Y=F(De,je);if(!Y){Ge[at]=null;continue}Q(Y)||(Y=K.getPrepared(Y)),Ge[at]=ge(X,Y,ee)}Ge.obj=De;var ht=be(Ge);ht!==null&&(ht<se||(Ge.score=ht,Ae<ie?(_e.add(Ge),++Ae):(++Be,ht>_e.peek().score&&_e.replaceTop(Ge))))}else if(z&&z.key)for(var je=z.key,We=He-1;We>=0;--We){var De=L[We],Y=F(De,je);if(!!Y){Q(Y)||(Y=K.getPrepared(Y));var st=ge(X,Y,ee);st!==null&&(st.score<se||(st={target:st.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:st.score,indexes:st.indexes,obj:De},Ae<ie?(_e.add(st),++Ae):(++Be,st.score>_e.peek().score&&_e.replaceTop(st))))}}else for(var We=He-1;We>=0;--We){var Y=L[We];if(!!Y){Q(Y)||(Y=K.getPrepared(Y));var st=ge(X,Y,ee);st!==null&&(st.score<se||(Ae<ie?(_e.add(st),++Ae):(++Be,st.score>_e.peek().score&&_e.replaceTop(st))))}}if(Ae===0)return E;for(var ct=new Array(Ae),We=Ae-1;We>=0;--We)ct[We]=_e.poll();return ct.total=Ae+Be,ct},goAsync:function(X,L,z){var ee=!1,se=new Promise(function(ie,ce){if(!X)return ie(E);X=K.prepareSearch(X);var ge=X[0],Ae=he(),Be=L.length-1,He=z&&z.threshold||j&&j.threshold||-9007199254740991,be=z&&z.limit||j&&j.limit||9007199254740991,Ye=z&&z.allowTypo!==void 0?z.allowTypo:j&&j.allowTypo!==void 0?j.allowTypo:!0,ot=Ye?K.algorithm:K.algorithmNoTypo,We=0,De=0;function Ge(){if(ee)return ce("canceled");var at=Date.now();if(z&&z.keys)for(var je=z.scoreFn||H,Y=z.keys,ht=Y.length;Be>=0;--Be){for(var st=L[Be],ct=new Array(ht),fe=ht-1;fe>=0;--fe){var pe=Y[fe],qe=F(st,pe);if(!qe){ct[fe]=null;continue}Q(qe)||(qe=K.getPrepared(qe)),ct[fe]=ot(X,qe,ge)}ct.obj=st;var Qe=je(ct);if(Qe!==null&&!(Qe<He)&&(ct.score=Qe,We<be?(Ae.add(ct),++We):(++De,Qe>Ae.peek().score&&Ae.replaceTop(ct)),Be%1e3==0&&Date.now()-at>=10)){W?setImmediate(Ge):setTimeout(Ge);return}}else if(z&&z.key)for(var pe=z.key;Be>=0;--Be){var st=L[Be],qe=F(st,pe);if(!!qe){Q(qe)||(qe=K.getPrepared(qe));var xt=ot(X,qe,ge);if(xt!==null&&!(xt.score<He)&&(xt={target:xt.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:xt.score,indexes:xt.indexes,obj:st},We<be?(Ae.add(xt),++We):(++De,xt.score>Ae.peek().score&&Ae.replaceTop(xt)),Be%1e3==0&&Date.now()-at>=10)){W?setImmediate(Ge):setTimeout(Ge);return}}}else for(;Be>=0;--Be){var qe=L[Be];if(!!qe){Q(qe)||(qe=K.getPrepared(qe));var xt=ot(X,qe,ge);if(xt!==null&&!(xt.score<He)&&(We<be?(Ae.add(xt),++We):(++De,xt.score>Ae.peek().score&&Ae.replaceTop(xt)),Be%1e3==0&&Date.now()-at>=10)){W?setImmediate(Ge):setTimeout(Ge);return}}}if(We===0)return ie(E);for(var mr=new Array(We),kt=We-1;kt>=0;--kt)mr[kt]=Ae.poll();mr.total=We+De,ie(mr)}W?setImmediate(Ge):Ge()});return se.cancel=function(){ee=!0},se},highlight:function(X,L,z){if(X===null)return null;L===void 0&&(L="<b>"),z===void 0&&(z="</b>");for(var ee="",se=0,ie=!1,ce=X.target,ge=ce.length,Ae=X.indexes,Be=0;Be<ge;++Be){var He=ce[Be];if(Ae[se]===Be){if(++se,ie||(ie=!0,ee+=L),se===Ae.length){ee+=He+z+ce.substr(Be+1);break}}else ie&&(ie=!1,ee+=z);ee+=He}return ee},prepare:function(X){if(!!X)return{target:X,_targetLowerCodes:K.prepareLowerCodes(X),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(X){if(!!X)return{target:X,_targetLowerCodes:K.prepareLowerCodes(X),_nextBeginningIndexes:K.prepareNextBeginningIndexes(X),score:null,indexes:null,obj:null}},prepareSearch:function(X){if(!!X)return K.prepareLowerCodes(X)},getPrepared:function(X){if(X.length>999)return K.prepare(X);var L=P.get(X);return L!==void 0||(L=K.prepare(X),P.set(X,L)),L},getPreparedSearch:function(X){if(X.length>999)return K.prepareSearch(X);var L=m.get(X);return L!==void 0||(L=K.prepareSearch(X),m.set(X,L)),L},algorithm:function(X,L,z){for(var ee=L._targetLowerCodes,se=X.length,ie=ee.length,ce=0,ge=0,Ae=0,Be=0;;){var He=z===ee[ge];if(He){if(R[Be++]=ge,++ce,ce===se)break;z=X[Ae===0?ce:Ae===ce?ce+1:Ae===ce-1?ce-1:ce]}if(++ge,ge>=ie)for(;;){if(ce<=1)return null;if(Ae===0){--ce;var be=X[ce];if(z===be)continue;Ae=ce}else{if(Ae===1)return null;--Ae,ce=Ae,z=X[ce+1];var be=X[ce];if(z===be)continue}Be=ce,ge=R[Be-1]+1;break}}var ce=0,Ye=0,ot=!1,We=0,De=L._nextBeginningIndexes;De===null&&(De=L._nextBeginningIndexes=K.prepareNextBeginningIndexes(L.target));var Ge=ge=R[0]===0?0:De[R[0]-1];if(ge!==ie)for(;;)if(ge>=ie){if(ce<=0){if(++Ye,Ye>se-2)break;if(X[Ye]===X[Ye+1])continue;ge=Ge;continue}--ce;var at=x[--We];ge=De[at]}else{var He=X[Ye===0?ce:Ye===ce?ce+1:Ye===ce-1?ce-1:ce]===ee[ge];if(He){if(x[We++]=ge,++ce,ce===se){ot=!0;break}++ge}else ge=De[ge]}{if(ot)var je=x,Y=We;else var je=R,Y=Be;for(var ht=0,st=-1,ct=0;ct<se;++ct){var ge=je[ct];st!==ge-1&&(ht-=ge),st=ge}ot?Ye!==0&&(ht+=-20):(ht*=1e3,Ae!==0&&(ht+=-20)),ht-=ie-se,L.score=ht,L.indexes=new Array(Y);for(var ct=Y-1;ct>=0;--ct)L.indexes[ct]=je[ct];return L}},algorithmNoTypo:function(X,L,z){for(var ee=L._targetLowerCodes,se=X.length,ie=ee.length,ce=0,ge=0,Ae=0;;){var Be=z===ee[ge];if(Be){if(R[Ae++]=ge,++ce,ce===se)break;z=X[ce]}if(++ge,ge>=ie)return null}var ce=0,He=!1,be=0,Ye=L._nextBeginningIndexes;Ye===null&&(Ye=L._nextBeginningIndexes=K.prepareNextBeginningIndexes(L.target));var ot=ge=R[0]===0?0:Ye[R[0]-1];if(ge!==ie)for(;;)if(ge>=ie){if(ce<=0)break;--ce;var We=x[--be];ge=Ye[We]}else{var Be=X[ce]===ee[ge];if(Be){if(x[be++]=ge,++ce,ce===se){He=!0;break}++ge}else ge=Ye[ge]}{if(He)var De=x,Ge=be;else var De=R,Ge=Ae;for(var at=0,je=-1,Y=0;Y<se;++Y){var ge=De[Y];je!==ge-1&&(at-=ge),je=ge}He||(at*=1e3),at-=ie-se,L.score=at,L.indexes=new Array(Ge);for(var Y=Ge-1;Y>=0;--Y)L.indexes[Y]=De[Y];return L}},prepareLowerCodes:function(X){for(var L=X.length,z=[],ee=X.toLowerCase(),se=0;se<L;++se)z[se]=ee.charCodeAt(se);return z},prepareBeginningIndexes:function(X){for(var L=X.length,z=[],ee=0,se=!1,ie=!1,ce=0;ce<L;++ce){var ge=X.charCodeAt(ce),Ae=ge>=65&&ge<=90,Be=Ae||ge>=97&&ge<=122||ge>=48&&ge<=57,He=Ae&&!se||!ie||!Be;se=Ae,ie=Be,He&&(z[ee++]=ce)}return z},prepareNextBeginningIndexes:function(X){for(var L=X.length,z=K.prepareBeginningIndexes(X),ee=[],se=z[0],ie=0,ce=0;ce<L;++ce)se>ce?ee[ce]=se:(se=z[++ie],ee[ce]=se===void 0?L:se);return ee},cleanup:k,new:q};return K}var W=typeof window=="undefined",P=new Map,m=new Map,E=[];E.total=0;var R=[],x=[];function k(){P.clear(),m.clear(),R=[],x=[]}function H(j){for(var K=-9007199254740991,X=j.length-1;X>=0;--X){var L=j[X];if(L!==null){var z=L.score;z>K&&(K=z)}}return K===-9007199254740991?null:K}function F(j,K){var X=j[K];if(X!==void 0)return X;var L=K;Array.isArray(K)||(L=K.split("."));for(var z=L.length,ee=-1;j&&++ee<z;)j=j[L[ee]];return j}function Q(j){return typeof j=="object"}var he=function(){var j=[],K=0,X={};function L(){for(var z=0,ee=j[z],se=1;se<K;){var ie=se+1;z=se,ie<K&&j[ie].score<j[se].score&&(z=ie),j[z-1>>1]=j[z],se=1+(z<<1)}for(var ce=z-1>>1;z>0&&ee.score<j[ce].score;ce=(z=ce)-1>>1)j[z]=j[ce];j[z]=ee}return X.add=function(z){var ee=K;j[K++]=z;for(var se=ee-1>>1;ee>0&&z.score<j[se].score;se=(ee=se)-1>>1)j[ee]=j[se];j[ee]=z},X.poll=function(){if(K!==0){var z=j[0];return j[0]=j[--K],L(),z}},X.peek=function(z){if(K!==0)return j[0]},X.replaceTop=function(z){j[0]=z,L()},X},_e=he();return q()})},645:(d,C)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */C.read=function(B,T,N,$,q){var W,P,m=q*8-$-1,E=(1<<m)-1,R=E>>1,x=-7,k=N?q-1:0,H=N?-1:1,F=B[T+k];for(k+=H,W=F&(1<<-x)-1,F>>=-x,x+=m;x>0;W=W*256+B[T+k],k+=H,x-=8);for(P=W&(1<<-x)-1,W>>=-x,x+=$;x>0;P=P*256+B[T+k],k+=H,x-=8);if(W===0)W=1-R;else{if(W===E)return P?NaN:(F?-1:1)*(1/0);P=P+Math.pow(2,$),W=W-R}return(F?-1:1)*P*Math.pow(2,W-$)},C.write=function(B,T,N,$,q,W){var P,m,E,R=W*8-q-1,x=(1<<R)-1,k=x>>1,H=q===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=$?0:W-1,Q=$?1:-1,he=T<0||T===0&&1/T<0?1:0;for(T=Math.abs(T),isNaN(T)||T===1/0?(m=isNaN(T)?1:0,P=x):(P=Math.floor(Math.log(T)/Math.LN2),T*(E=Math.pow(2,-P))<1&&(P--,E*=2),P+k>=1?T+=H/E:T+=H*Math.pow(2,1-k),T*E>=2&&(P++,E/=2),P+k>=x?(m=0,P=x):P+k>=1?(m=(T*E-1)*Math.pow(2,q),P=P+k):(m=T*Math.pow(2,k-1)*Math.pow(2,q),P=0));q>=8;B[N+F]=m&255,F+=Q,m/=256,q-=8);for(P=P<<q|m,R+=q;R>0;B[N+F]=P&255,F+=Q,P/=256,R-=8);B[N+F-Q]|=he*128}},9924:d=>{"use strict";/*!
 * is-number <https://github.com/jonschlinkert/is-number>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */d.exports=function(C){return typeof C=="number"?C-C==0:typeof C=="string"&&C.trim()!==""?Number.isFinite?Number.isFinite(+C):isFinite(+C):!1}},850:(d,C,B)=>{"use strict";const T=B(7170),N=B(6744),$=B(9444),q=B(8702),W=m=>m===""||m==="./",P=(m,E,R)=>{E=[].concat(E),m=[].concat(m);let x=new Set,k=new Set,H=new Set,F=0,Q=j=>{H.add(j.output),R&&R.onResult&&R.onResult(j)};for(let j=0;j<E.length;j++){let K=$(String(E[j]),{...R,onResult:Q},!0),X=K.state.negated||K.state.negatedExtglob;X&&F++;for(let L of m){let z=K(L,!0);!(X?!z.isMatch:z.isMatch)||(X?x.add(z.output):(x.delete(z.output),k.add(z.output)))}}let _e=(F===E.length?[...H]:[...k]).filter(j=>!x.has(j));if(R&&_e.length===0){if(R.failglob===!0)throw new Error(`No matches found for "${E.join(", ")}"`);if(R.nonull===!0||R.nullglob===!0)return R.unescape?E.map(j=>j.replace(/\\/g,"")):E}return _e};P.match=P,P.matcher=(m,E)=>$(m,E),P.isMatch=(m,E,R)=>$(E,R)(m),P.any=P.isMatch,P.not=(m,E,R={})=>{E=[].concat(E).map(String);let x=new Set,k=[],F=P(m,E,{...R,onResult:Q=>{R.onResult&&R.onResult(Q),k.push(Q.output)}});for(let Q of k)F.includes(Q)||x.add(Q);return[...x]},P.contains=(m,E,R)=>{if(typeof m!="string")throw new TypeError(`Expected a string: "${T.inspect(m)}"`);if(Array.isArray(E))return E.some(x=>P.contains(m,x,R));if(typeof E=="string"){if(W(m)||W(E))return!1;if(m.includes(E)||m.startsWith("./")&&m.slice(2).includes(E))return!0}return P.isMatch(m,E,{...R,contains:!0})},P.matchKeys=(m,E,R)=>{if(!q.isObject(m))throw new TypeError("Expected the first argument to be an object");let x=P(Object.keys(m),E,R),k={};for(let H of x)k[H]=m[H];return k},P.some=(m,E,R)=>{let x=[].concat(m);for(let k of[].concat(E)){let H=$(String(k),R);if(x.some(F=>H(F)))return!0}return!1},P.every=(m,E,R)=>{let x=[].concat(m);for(let k of[].concat(E)){let H=$(String(k),R);if(!x.every(F=>H(F)))return!1}return!0},P.all=(m,E,R)=>{if(typeof m!="string")throw new TypeError(`Expected a string: "${T.inspect(m)}"`);return[].concat(E).every(x=>$(x,R)(m))},P.capture=(m,E,R)=>{let x=q.isWindows(R),H=$.makeRe(String(m),{...R,capture:!0}).exec(x?q.toPosixSlashes(E):E);if(H)return H.slice(1).map(F=>F===void 0?"":F)},P.makeRe=(...m)=>$.makeRe(...m),P.scan=(...m)=>$.scan(...m),P.parse=(m,E)=>{let R=[];for(let x of[].concat(m||[]))for(let k of N(String(x),E))R.push($.parse(k,E));return R},P.braces=(m,E)=>{if(typeof m!="string")throw new TypeError("Expected a string");return E&&E.nobrace===!0||!/\{.*\}/.test(m)?[m]:N(m,E)},P.braceExpand=(m,E)=>{if(typeof m!="string")throw new TypeError("Expected a string");return P.braces(m,{...E,expand:!0})},d.exports=P},447:(d,C,B)=>{var T=B(2479);d.exports=T(N),d.exports.strict=T($),N.proto=N(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return N(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return $(this)},configurable:!0})});function N(q){var W=function(){return W.called?W.value:(W.called=!0,W.value=q.apply(this,arguments))};return W.called=!1,W}function $(q){var W=function(){if(W.called)throw new Error(W.onceError);return W.called=!0,W.value=q.apply(this,arguments)},P=q.name||"Function wrapped with `once`";return W.onceError=P+" shouldn't be called more than once",W.called=!1,W}},6470:(d,C,B)=>{"use strict";var T=B(4155);function N(P){if(typeof P!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(P))}function $(P,m){for(var E="",R=0,x=-1,k=0,H,F=0;F<=P.length;++F){if(F<P.length)H=P.charCodeAt(F);else{if(H===47)break;H=47}if(H===47){if(!(x===F-1||k===1))if(x!==F-1&&k===2){if(E.length<2||R!==2||E.charCodeAt(E.length-1)!==46||E.charCodeAt(E.length-2)!==46){if(E.length>2){var Q=E.lastIndexOf("/");if(Q!==E.length-1){Q===-1?(E="",R=0):(E=E.slice(0,Q),R=E.length-1-E.lastIndexOf("/")),x=F,k=0;continue}}else if(E.length===2||E.length===1){E="",R=0,x=F,k=0;continue}}m&&(E.length>0?E+="/..":E="..",R=2)}else E.length>0?E+="/"+P.slice(x+1,F):E=P.slice(x+1,F),R=F-x-1;x=F,k=0}else H===46&&k!==-1?++k:k=-1}return E}function q(P,m){var E=m.dir||m.root,R=m.base||(m.name||"")+(m.ext||"");return E?E===m.root?E+R:E+P+R:R}var W={resolve:function(){for(var m="",E=!1,R,x=arguments.length-1;x>=-1&&!E;x--){var k;x>=0?k=arguments[x]:(R===void 0&&(R=T.cwd()),k=R),N(k),k.length!==0&&(m=k+"/"+m,E=k.charCodeAt(0)===47)}return m=$(m,!E),E?m.length>0?"/"+m:"/":m.length>0?m:"."},normalize:function(m){if(N(m),m.length===0)return".";var E=m.charCodeAt(0)===47,R=m.charCodeAt(m.length-1)===47;return m=$(m,!E),m.length===0&&!E&&(m="."),m.length>0&&R&&(m+="/"),E?"/"+m:m},isAbsolute:function(m){return N(m),m.length>0&&m.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var m,E=0;E<arguments.length;++E){var R=arguments[E];N(R),R.length>0&&(m===void 0?m=R:m+="/"+R)}return m===void 0?".":W.normalize(m)},relative:function(m,E){if(N(m),N(E),m===E||(m=W.resolve(m),E=W.resolve(E),m===E))return"";for(var R=1;R<m.length&&m.charCodeAt(R)===47;++R);for(var x=m.length,k=x-R,H=1;H<E.length&&E.charCodeAt(H)===47;++H);for(var F=E.length,Q=F-H,he=k<Q?k:Q,_e=-1,j=0;j<=he;++j){if(j===he){if(Q>he){if(E.charCodeAt(H+j)===47)return E.slice(H+j+1);if(j===0)return E.slice(H+j)}else k>he&&(m.charCodeAt(R+j)===47?_e=j:j===0&&(_e=0));break}var K=m.charCodeAt(R+j),X=E.charCodeAt(H+j);if(K!==X)break;K===47&&(_e=j)}var L="";for(j=R+_e+1;j<=x;++j)(j===x||m.charCodeAt(j)===47)&&(L.length===0?L+="..":L+="/..");return L.length>0?L+E.slice(H+_e):(H+=_e,E.charCodeAt(H)===47&&++H,E.slice(H))},_makeLong:function(m){return m},dirname:function(m){if(N(m),m.length===0)return".";for(var E=m.charCodeAt(0),R=E===47,x=-1,k=!0,H=m.length-1;H>=1;--H)if(E=m.charCodeAt(H),E===47){if(!k){x=H;break}}else k=!1;return x===-1?R?"/":".":R&&x===1?"//":m.slice(0,x)},basename:function(m,E){if(E!==void 0&&typeof E!="string")throw new TypeError('"ext" argument must be a string');N(m);var R=0,x=-1,k=!0,H;if(E!==void 0&&E.length>0&&E.length<=m.length){if(E.length===m.length&&E===m)return"";var F=E.length-1,Q=-1;for(H=m.length-1;H>=0;--H){var he=m.charCodeAt(H);if(he===47){if(!k){R=H+1;break}}else Q===-1&&(k=!1,Q=H+1),F>=0&&(he===E.charCodeAt(F)?--F==-1&&(x=H):(F=-1,x=Q))}return R===x?x=Q:x===-1&&(x=m.length),m.slice(R,x)}else{for(H=m.length-1;H>=0;--H)if(m.charCodeAt(H)===47){if(!k){R=H+1;break}}else x===-1&&(k=!1,x=H+1);return x===-1?"":m.slice(R,x)}},extname:function(m){N(m);for(var E=-1,R=0,x=-1,k=!0,H=0,F=m.length-1;F>=0;--F){var Q=m.charCodeAt(F);if(Q===47){if(!k){R=F+1;break}continue}x===-1&&(k=!1,x=F+1),Q===46?E===-1?E=F:H!==1&&(H=1):E!==-1&&(H=-1)}return E===-1||x===-1||H===0||H===1&&E===x-1&&E===R+1?"":m.slice(E,x)},format:function(m){if(m===null||typeof m!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof m);return q("/",m)},parse:function(m){N(m);var E={root:"",dir:"",base:"",ext:"",name:""};if(m.length===0)return E;var R=m.charCodeAt(0),x=R===47,k;x?(E.root="/",k=1):k=0;for(var H=-1,F=0,Q=-1,he=!0,_e=m.length-1,j=0;_e>=k;--_e){if(R=m.charCodeAt(_e),R===47){if(!he){F=_e+1;break}continue}Q===-1&&(he=!1,Q=_e+1),R===46?H===-1?H=_e:j!==1&&(j=1):H!==-1&&(j=-1)}return H===-1||Q===-1||j===0||j===1&&H===Q-1&&H===F+1?Q!==-1&&(F===0&&x?E.base=E.name=m.slice(1,Q):E.base=E.name=m.slice(F,Q)):(F===0&&x?(E.name=m.slice(1,H),E.base=m.slice(1,Q)):(E.name=m.slice(F,H),E.base=m.slice(F,Q)),E.ext=m.slice(H,Q)),F>0?E.dir=m.slice(0,F-1):x&&(E.dir="/"),E},sep:"/",delimiter:":",win32:null,posix:null};W.posix=W,d.exports=W},7279:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.EndOfStreamError=C.defaultMessages=void 0,C.defaultMessages="End-Of-Stream";class B extends Error{constructor(){super(C.defaultMessages)}}C.EndOfStreamError=B},5167:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.StreamReader=C.EndOfStreamError=void 0;const T=B(7279);var N=B(7279);Object.defineProperty(C,"EndOfStreamError",{enumerable:!0,get:function(){return N.EndOfStreamError}});class ${constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((m,E)=>{this.reject=E,this.resolve=m})}}const q=1*1024*1024;class W{constructor(m){if(this.s=m,this.request=null,this.endOfStream=!1,this.peekQueue=[],!m.read||!m.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new T.EndOfStreamError)),this.s.once("error",E=>this.reject(E)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(m,E,R){const x=await this.read(m,E,R);return this.peekQueue.push(m.subarray(E,E+x)),x}async read(m,E,R){if(R===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new T.EndOfStreamError;let x=R,k=0;for(;this.peekQueue.length>0&&x>0;){const H=this.peekQueue.pop();if(!H)throw new Error("peekData should be defined");const F=Math.min(H.length,x);m.set(H.subarray(0,F),E+k),k+=F,x-=F,F<H.length&&this.peekQueue.push(H.subarray(F))}for(;x>0&&!this.endOfStream;){const H=Math.min(x,q),F=await this._read(m,E+k,H);if(k+=F,F<H)break;x-=F}return k}async _read(m,E,R){if(this.request)throw new Error("Concurrent read operation?");const x=this.s.read(R);return x?(m.set(x,E),x.length):(this.request={buffer:m,offset:E,length:R,deferred:new $},this.s.once("readable",()=>{this.tryRead()}),this.request.deferred.promise)}tryRead(){if(!this.request)throw new Error("this.request should be defined");const m=this.s.read(this.request.length);m?(this.request.buffer.set(m,this.request.offset),this.request.deferred.resolve(m.length),this.request=null):this.s.once("readable",()=>{this.tryRead()})}reject(m){this.endOfStream=!0,this.request&&(this.request.deferred.reject(m),this.request=null)}}C.StreamReader=W},9444:(d,C,B)=>{"use strict";d.exports=B(6087)},1006:(d,C,B)=>{"use strict";const T=B(6470),N="\\\\/",$=`[^${N}]`,q="\\.",W="\\+",P="\\?",m="\\/",E="(?=.)",R="[^/]",x=`(?:${m}|$)`,k=`(?:^|${m})`,H=`${q}{1,2}${x}`,F=`(?!${q})`,Q=`(?!${k}${H})`,he=`(?!${q}{0,1}${x})`,_e=`(?!${H})`,j=`[^.${m}]`,K=`${R}*?`,X={DOT_LITERAL:q,PLUS_LITERAL:W,QMARK_LITERAL:P,SLASH_LITERAL:m,ONE_CHAR:E,QMARK:R,END_ANCHOR:x,DOTS_SLASH:H,NO_DOT:F,NO_DOTS:Q,NO_DOT_SLASH:he,NO_DOTS_SLASH:_e,QMARK_NO_DOT:j,STAR:K,START_ANCHOR:k},L={...X,SLASH_LITERAL:`[${N}]`,QMARK:$,STAR:`${$}*?`,DOTS_SLASH:`${q}{1,2}(?:[${N}]|$)`,NO_DOT:`(?!${q})`,NO_DOTS:`(?!(?:^|[${N}])${q}{1,2}(?:[${N}]|$))`,NO_DOT_SLASH:`(?!${q}{0,1}(?:[${N}]|$))`,NO_DOTS_SLASH:`(?!${q}{1,2}(?:[${N}]|$))`,QMARK_NO_DOT:`[^.${N}]`,START_ANCHOR:`(?:^|[${N}])`,END_ANCHOR:`(?:[${N}]|$)`},z={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};d.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:z,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:T.sep,extglobChars(ee){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${ee.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(ee){return ee===!0?L:X}}},3376:(d,C,B)=>{"use strict";const T=B(1006),N=B(8702),{MAX_LENGTH:$,POSIX_REGEX_SOURCE:q,REGEX_NON_SPECIAL_CHARS:W,REGEX_SPECIAL_CHARS_BACKREF:P,REPLACEMENTS:m}=T,E=(k,H)=>{if(typeof H.expandRange=="function")return H.expandRange(...k,H);k.sort();const F=`[${k.join("-")}]`;try{new RegExp(F)}catch(Q){return k.map(he=>N.escapeRegex(he)).join("..")}return F},R=(k,H)=>`Missing ${k}: "${H}" - use "\\\\${H}" to match literal characters`,x=(k,H)=>{if(typeof k!="string")throw new TypeError("Expected a string");k=m[k]||k;const F={...H},Q=typeof F.maxLength=="number"?Math.min($,F.maxLength):$;let he=k.length;if(he>Q)throw new SyntaxError(`Input length: ${he}, exceeds maximum allowed length: ${Q}`);const _e={type:"bos",value:"",output:F.prepend||""},j=[_e],K=F.capture?"":"?:",X=N.isWindows(H),L=T.globChars(X),z=T.extglobChars(L),{DOT_LITERAL:ee,PLUS_LITERAL:se,SLASH_LITERAL:ie,ONE_CHAR:ce,DOTS_SLASH:ge,NO_DOT:Ae,NO_DOT_SLASH:Be,NO_DOTS_SLASH:He,QMARK:be,QMARK_NO_DOT:Ye,STAR:ot,START_ANCHOR:We}=L,De=Me=>`(${K}(?:(?!${We}${Me.dot?ge:ee}).)*?)`,Ge=F.dot?"":Ae,at=F.dot?be:Ye;let je=F.bash===!0?De(F):ot;F.capture&&(je=`(${je})`),typeof F.noext=="boolean"&&(F.noextglob=F.noext);const Y={input:k,index:-1,start:0,dot:F.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:j};k=N.removePrefix(k,Y),he=k.length;const ht=[],st=[],ct=[];let fe=_e,pe;const qe=()=>Y.index===he-1,Qe=Y.peek=(Me=1)=>k[Y.index+Me],xt=Y.advance=()=>k[++Y.index]||"",mr=()=>k.slice(Y.index+1),kt=(Me="",mt=0)=>{Y.consumed+=Me,Y.index+=mt},It=Me=>{Y.output+=Me.output!=null?Me.output:Me.value,kt(Me.value)},zr=()=>{let Me=1;for(;Qe()==="!"&&(Qe(2)!=="("||Qe(3)==="?");)xt(),Y.start++,Me++;return Me%2==0?!1:(Y.negated=!0,Y.start++,!0)},Pr=Me=>{Y[Me]++,ct.push(Me)},tr=Me=>{Y[Me]--,ct.pop()},Xe=Me=>{if(fe.type==="globstar"){const mt=Y.braces>0&&(Me.type==="comma"||Me.type==="brace"),Ee=Me.extglob===!0||ht.length&&(Me.type==="pipe"||Me.type==="paren");Me.type!=="slash"&&Me.type!=="paren"&&!mt&&!Ee&&(Y.output=Y.output.slice(0,-fe.output.length),fe.type="star",fe.value="*",fe.output=je,Y.output+=fe.output)}if(ht.length&&Me.type!=="paren"&&(ht[ht.length-1].inner+=Me.value),(Me.value||Me.output)&&It(Me),fe&&fe.type==="text"&&Me.type==="text"){fe.value+=Me.value,fe.output=(fe.output||"")+Me.value;return}Me.prev=fe,j.push(Me),fe=Me},Ot=(Me,mt)=>{const Ee={...z[mt],conditions:1,inner:""};Ee.prev=fe,Ee.parens=Y.parens,Ee.output=Y.output;const it=(F.capture?"(":"")+Ee.open;Pr("parens"),Xe({type:Me,value:mt,output:Y.output?"":ce}),Xe({type:"paren",extglob:!0,value:xt(),output:it}),ht.push(Ee)},Vi=Me=>{let mt=Me.close+(F.capture?")":""),Ee;if(Me.type==="negate"){let it=je;Me.inner&&Me.inner.length>1&&Me.inner.includes("/")&&(it=De(F)),(it!==je||qe()||/^\)+$/.test(mr()))&&(mt=Me.close=`)$))${it}`),Me.inner.includes("*")&&(Ee=mr())&&/^\.[^\\/.]+$/.test(Ee)&&(mt=Me.close=`)${Ee})${it})`),Me.prev.type==="bos"&&(Y.negatedExtglob=!0)}Xe({type:"paren",extglob:!0,value:pe,output:mt}),tr("parens")};if(F.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(k)){let Me=!1,mt=k.replace(P,(Ee,it,jt,Ht,Zt,A)=>Ht==="\\"?(Me=!0,Ee):Ht==="?"?it?it+Ht+(Zt?be.repeat(Zt.length):""):A===0?at+(Zt?be.repeat(Zt.length):""):be.repeat(jt.length):Ht==="."?ee.repeat(jt.length):Ht==="*"?it?it+Ht+(Zt?je:""):je:it?Ee:`\\${Ee}`);return Me===!0&&(F.unescape===!0?mt=mt.replace(/\\/g,""):mt=mt.replace(/\\+/g,Ee=>Ee.length%2==0?"\\\\":Ee?"\\":"")),mt===k&&F.contains===!0?(Y.output=k,Y):(Y.output=N.wrapOutput(mt,Y,H),Y)}for(;!qe();){if(pe=xt(),pe==="\0")continue;if(pe==="\\"){const Ee=Qe();if(Ee==="/"&&F.bash!==!0||Ee==="."||Ee===";")continue;if(!Ee){pe+="\\",Xe({type:"text",value:pe});continue}const it=/^\\+/.exec(mr());let jt=0;if(it&&it[0].length>2&&(jt=it[0].length,Y.index+=jt,jt%2!=0&&(pe+="\\")),F.unescape===!0?pe=xt():pe+=xt(),Y.brackets===0){Xe({type:"text",value:pe});continue}}if(Y.brackets>0&&(pe!=="]"||fe.value==="["||fe.value==="[^")){if(F.posix!==!1&&pe===":"){const Ee=fe.value.slice(1);if(Ee.includes("[")&&(fe.posix=!0,Ee.includes(":"))){const it=fe.value.lastIndexOf("["),jt=fe.value.slice(0,it),Ht=fe.value.slice(it+2),Zt=q[Ht];if(Zt){fe.value=jt+Zt,Y.backtrack=!0,xt(),!_e.output&&j.indexOf(fe)===1&&(_e.output=ce);continue}}}(pe==="["&&Qe()!==":"||pe==="-"&&Qe()==="]")&&(pe=`\\${pe}`),pe==="]"&&(fe.value==="["||fe.value==="[^")&&(pe=`\\${pe}`),F.posix===!0&&pe==="!"&&fe.value==="["&&(pe="^"),fe.value+=pe,It({value:pe});continue}if(Y.quotes===1&&pe!=='"'){pe=N.escapeRegex(pe),fe.value+=pe,It({value:pe});continue}if(pe==='"'){Y.quotes=Y.quotes===1?0:1,F.keepQuotes===!0&&Xe({type:"text",value:pe});continue}if(pe==="("){Pr("parens"),Xe({type:"paren",value:pe});continue}if(pe===")"){if(Y.parens===0&&F.strictBrackets===!0)throw new SyntaxError(R("opening","("));const Ee=ht[ht.length-1];if(Ee&&Y.parens===Ee.parens+1){Vi(ht.pop());continue}Xe({type:"paren",value:pe,output:Y.parens?")":"\\)"}),tr("parens");continue}if(pe==="["){if(F.nobracket===!0||!mr().includes("]")){if(F.nobracket!==!0&&F.strictBrackets===!0)throw new SyntaxError(R("closing","]"));pe=`\\${pe}`}else Pr("brackets");Xe({type:"bracket",value:pe});continue}if(pe==="]"){if(F.nobracket===!0||fe&&fe.type==="bracket"&&fe.value.length===1){Xe({type:"text",value:pe,output:`\\${pe}`});continue}if(Y.brackets===0){if(F.strictBrackets===!0)throw new SyntaxError(R("opening","["));Xe({type:"text",value:pe,output:`\\${pe}`});continue}tr("brackets");const Ee=fe.value.slice(1);if(fe.posix!==!0&&Ee[0]==="^"&&!Ee.includes("/")&&(pe=`/${pe}`),fe.value+=pe,It({value:pe}),F.literalBrackets===!1||N.hasRegexChars(Ee))continue;const it=N.escapeRegex(fe.value);if(Y.output=Y.output.slice(0,-fe.value.length),F.literalBrackets===!0){Y.output+=it,fe.value=it;continue}fe.value=`(${K}${it}|${fe.value})`,Y.output+=fe.value;continue}if(pe==="{"&&F.nobrace!==!0){Pr("braces");const Ee={type:"brace",value:pe,output:"(",outputIndex:Y.output.length,tokensIndex:Y.tokens.length};st.push(Ee),Xe(Ee);continue}if(pe==="}"){const Ee=st[st.length-1];if(F.nobrace===!0||!Ee){Xe({type:"text",value:pe,output:pe});continue}let it=")";if(Ee.dots===!0){const jt=j.slice(),Ht=[];for(let Zt=jt.length-1;Zt>=0&&(j.pop(),jt[Zt].type!=="brace");Zt--)jt[Zt].type!=="dots"&&Ht.unshift(jt[Zt].value);it=E(Ht,F),Y.backtrack=!0}if(Ee.comma!==!0&&Ee.dots!==!0){const jt=Y.output.slice(0,Ee.outputIndex),Ht=Y.tokens.slice(Ee.tokensIndex);Ee.value=Ee.output="\\{",pe=it="\\}",Y.output=jt;for(const Zt of Ht)Y.output+=Zt.output||Zt.value}Xe({type:"brace",value:pe,output:it}),tr("braces"),st.pop();continue}if(pe==="|"){ht.length>0&&ht[ht.length-1].conditions++,Xe({type:"text",value:pe});continue}if(pe===","){let Ee=pe;const it=st[st.length-1];it&&ct[ct.length-1]==="braces"&&(it.comma=!0,Ee="|"),Xe({type:"comma",value:pe,output:Ee});continue}if(pe==="/"){if(fe.type==="dot"&&Y.index===Y.start+1){Y.start=Y.index+1,Y.consumed="",Y.output="",j.pop(),fe=_e;continue}Xe({type:"slash",value:pe,output:ie});continue}if(pe==="."){if(Y.braces>0&&fe.type==="dot"){fe.value==="."&&(fe.output=ee);const Ee=st[st.length-1];fe.type="dots",fe.output+=pe,fe.value+=pe,Ee.dots=!0;continue}if(Y.braces+Y.parens===0&&fe.type!=="bos"&&fe.type!=="slash"){Xe({type:"text",value:pe,output:ee});continue}Xe({type:"dot",value:pe,output:ee});continue}if(pe==="?"){if(!(fe&&fe.value==="(")&&F.noextglob!==!0&&Qe()==="("&&Qe(2)!=="?"){Ot("qmark",pe);continue}if(fe&&fe.type==="paren"){const it=Qe();let jt=pe;if(it==="<"&&!N.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(fe.value==="("&&!/[!=<:]/.test(it)||it==="<"&&!/<([!=]|\w+>)/.test(mr()))&&(jt=`\\${pe}`),Xe({type:"text",value:pe,output:jt});continue}if(F.dot!==!0&&(fe.type==="slash"||fe.type==="bos")){Xe({type:"qmark",value:pe,output:Ye});continue}Xe({type:"qmark",value:pe,output:be});continue}if(pe==="!"){if(F.noextglob!==!0&&Qe()==="("&&(Qe(2)!=="?"||!/[!=<:]/.test(Qe(3)))){Ot("negate",pe);continue}if(F.nonegate!==!0&&Y.index===0){zr();continue}}if(pe==="+"){if(F.noextglob!==!0&&Qe()==="("&&Qe(2)!=="?"){Ot("plus",pe);continue}if(fe&&fe.value==="("||F.regex===!1){Xe({type:"plus",value:pe,output:se});continue}if(fe&&(fe.type==="bracket"||fe.type==="paren"||fe.type==="brace")||Y.parens>0){Xe({type:"plus",value:pe});continue}Xe({type:"plus",value:se});continue}if(pe==="@"){if(F.noextglob!==!0&&Qe()==="("&&Qe(2)!=="?"){Xe({type:"at",extglob:!0,value:pe,output:""});continue}Xe({type:"text",value:pe});continue}if(pe!=="*"){(pe==="$"||pe==="^")&&(pe=`\\${pe}`);const Ee=W.exec(mr());Ee&&(pe+=Ee[0],Y.index+=Ee[0].length),Xe({type:"text",value:pe});continue}if(fe&&(fe.type==="globstar"||fe.star===!0)){fe.type="star",fe.star=!0,fe.value+=pe,fe.output=je,Y.backtrack=!0,Y.globstar=!0,kt(pe);continue}let Me=mr();if(F.noextglob!==!0&&/^\([^?]/.test(Me)){Ot("star",pe);continue}if(fe.type==="star"){if(F.noglobstar===!0){kt(pe);continue}const Ee=fe.prev,it=Ee.prev,jt=Ee.type==="slash"||Ee.type==="bos",Ht=it&&(it.type==="star"||it.type==="globstar");if(F.bash===!0&&(!jt||Me[0]&&Me[0]!=="/")){Xe({type:"star",value:pe,output:""});continue}const Zt=Y.braces>0&&(Ee.type==="comma"||Ee.type==="brace"),A=ht.length&&(Ee.type==="pipe"||Ee.type==="paren");if(!jt&&Ee.type!=="paren"&&!Zt&&!A){Xe({type:"star",value:pe,output:""});continue}for(;Me.slice(0,3)==="/**";){const g=k[Y.index+4];if(g&&g!=="/")break;Me=Me.slice(3),kt("/**",3)}if(Ee.type==="bos"&&qe()){fe.type="globstar",fe.value+=pe,fe.output=De(F),Y.output=fe.output,Y.globstar=!0,kt(pe);continue}if(Ee.type==="slash"&&Ee.prev.type!=="bos"&&!Ht&&qe()){Y.output=Y.output.slice(0,-(Ee.output+fe.output).length),Ee.output=`(?:${Ee.output}`,fe.type="globstar",fe.output=De(F)+(F.strictSlashes?")":"|$)"),fe.value+=pe,Y.globstar=!0,Y.output+=Ee.output+fe.output,kt(pe);continue}if(Ee.type==="slash"&&Ee.prev.type!=="bos"&&Me[0]==="/"){const g=Me[1]!==void 0?"|$":"";Y.output=Y.output.slice(0,-(Ee.output+fe.output).length),Ee.output=`(?:${Ee.output}`,fe.type="globstar",fe.output=`${De(F)}${ie}|${ie}${g})`,fe.value+=pe,Y.output+=Ee.output+fe.output,Y.globstar=!0,kt(pe+xt()),Xe({type:"slash",value:"/",output:""});continue}if(Ee.type==="bos"&&Me[0]==="/"){fe.type="globstar",fe.value+=pe,fe.output=`(?:^|${ie}|${De(F)}${ie})`,Y.output=fe.output,Y.globstar=!0,kt(pe+xt()),Xe({type:"slash",value:"/",output:""});continue}Y.output=Y.output.slice(0,-fe.output.length),fe.type="globstar",fe.output=De(F),fe.value+=pe,Y.output+=fe.output,Y.globstar=!0,kt(pe);continue}const mt={type:"star",value:pe,output:je};if(F.bash===!0){mt.output=".*?",(fe.type==="bos"||fe.type==="slash")&&(mt.output=Ge+mt.output),Xe(mt);continue}if(fe&&(fe.type==="bracket"||fe.type==="paren")&&F.regex===!0){mt.output=pe,Xe(mt);continue}(Y.index===Y.start||fe.type==="slash"||fe.type==="dot")&&(fe.type==="dot"?(Y.output+=Be,fe.output+=Be):F.dot===!0?(Y.output+=He,fe.output+=He):(Y.output+=Ge,fe.output+=Ge),Qe()!=="*"&&(Y.output+=ce,fe.output+=ce)),Xe(mt)}for(;Y.brackets>0;){if(F.strictBrackets===!0)throw new SyntaxError(R("closing","]"));Y.output=N.escapeLast(Y.output,"["),tr("brackets")}for(;Y.parens>0;){if(F.strictBrackets===!0)throw new SyntaxError(R("closing",")"));Y.output=N.escapeLast(Y.output,"("),tr("parens")}for(;Y.braces>0;){if(F.strictBrackets===!0)throw new SyntaxError(R("closing","}"));Y.output=N.escapeLast(Y.output,"{"),tr("braces")}if(F.strictSlashes!==!0&&(fe.type==="star"||fe.type==="bracket")&&Xe({type:"maybe_slash",value:"",output:`${ie}?`}),Y.backtrack===!0){Y.output="";for(const Me of Y.tokens)Y.output+=Me.output!=null?Me.output:Me.value,Me.suffix&&(Y.output+=Me.suffix)}return Y};x.fastpaths=(k,H)=>{const F={...H},Q=typeof F.maxLength=="number"?Math.min($,F.maxLength):$,he=k.length;if(he>Q)throw new SyntaxError(`Input length: ${he}, exceeds maximum allowed length: ${Q}`);k=m[k]||k;const _e=N.isWindows(H),{DOT_LITERAL:j,SLASH_LITERAL:K,ONE_CHAR:X,DOTS_SLASH:L,NO_DOT:z,NO_DOTS:ee,NO_DOTS_SLASH:se,STAR:ie,START_ANCHOR:ce}=T.globChars(_e),ge=F.dot?ee:z,Ae=F.dot?se:z,Be=F.capture?"":"?:",He={negated:!1,prefix:""};let be=F.bash===!0?".*?":ie;F.capture&&(be=`(${be})`);const Ye=Ge=>Ge.noglobstar===!0?be:`(${Be}(?:(?!${ce}${Ge.dot?L:j}).)*?)`,ot=Ge=>{switch(Ge){case"*":return`${ge}${X}${be}`;case".*":return`${j}${X}${be}`;case"*.*":return`${ge}${be}${j}${X}${be}`;case"*/*":return`${ge}${be}${K}${X}${Ae}${be}`;case"**":return ge+Ye(F);case"**/*":return`(?:${ge}${Ye(F)}${K})?${Ae}${X}${be}`;case"**/*.*":return`(?:${ge}${Ye(F)}${K})?${Ae}${be}${j}${X}${be}`;case"**/.*":return`(?:${ge}${Ye(F)}${K})?${j}${X}${be}`;default:{const at=/^(.*?)\.(\w+)$/.exec(Ge);if(!at)return;const je=ot(at[1]);return je?je+j+at[2]:void 0}}},We=N.removePrefix(k,He);let De=ot(We);return De&&F.strictSlashes!==!0&&(De+=`${K}?`),De},d.exports=x},6087:(d,C,B)=>{"use strict";const T=B(6470),N=B(3921),$=B(3376),q=B(8702),W=B(1006),P=E=>E&&typeof E=="object"&&!Array.isArray(E),m=(E,R,x=!1)=>{if(Array.isArray(E)){const K=E.map(L=>m(L,R,x));return L=>{for(const z of K){const ee=z(L);if(ee)return ee}return!1}}const k=P(E)&&E.tokens&&E.input;if(E===""||typeof E!="string"&&!k)throw new TypeError("Expected pattern to be a non-empty string");const H=R||{},F=q.isWindows(R),Q=k?m.compileRe(E,R):m.makeRe(E,R,!1,!0),he=Q.state;delete Q.state;let _e=()=>!1;if(H.ignore){const K={...R,ignore:null,onMatch:null,onResult:null};_e=m(H.ignore,K,x)}const j=(K,X=!1)=>{const{isMatch:L,match:z,output:ee}=m.test(K,Q,R,{glob:E,posix:F}),se={glob:E,state:he,regex:Q,posix:F,input:K,output:ee,match:z,isMatch:L};return typeof H.onResult=="function"&&H.onResult(se),L===!1?(se.isMatch=!1,X?se:!1):_e(K)?(typeof H.onIgnore=="function"&&H.onIgnore(se),se.isMatch=!1,X?se:!1):(typeof H.onMatch=="function"&&H.onMatch(se),X?se:!0)};return x&&(j.state=he),j};m.test=(E,R,x,{glob:k,posix:H}={})=>{if(typeof E!="string")throw new TypeError("Expected input to be a string");if(E==="")return{isMatch:!1,output:""};const F=x||{},Q=F.format||(H?q.toPosixSlashes:null);let he=E===k,_e=he&&Q?Q(E):E;return he===!1&&(_e=Q?Q(E):E,he=_e===k),(he===!1||F.capture===!0)&&(F.matchBase===!0||F.basename===!0?he=m.matchBase(E,R,x,H):he=R.exec(_e)),{isMatch:Boolean(he),match:he,output:_e}},m.matchBase=(E,R,x,k=q.isWindows(x))=>(R instanceof RegExp?R:m.makeRe(R,x)).test(T.basename(E)),m.isMatch=(E,R,x)=>m(R,x)(E),m.parse=(E,R)=>Array.isArray(E)?E.map(x=>m.parse(x,R)):$(E,{...R,fastpaths:!1}),m.scan=(E,R)=>N(E,R),m.compileRe=(E,R,x=!1,k=!1)=>{if(x===!0)return E.output;const H=R||{},F=H.contains?"":"^",Q=H.contains?"":"$";let he=`${F}(?:${E.output})${Q}`;E&&E.negated===!0&&(he=`^(?!${he}).*$`);const _e=m.toRegex(he,R);return k===!0&&(_e.state=E),_e},m.makeRe=(E,R={},x=!1,k=!1)=>{if(!E||typeof E!="string")throw new TypeError("Expected a non-empty string");let H={negated:!1,fastpaths:!0};return R.fastpaths!==!1&&(E[0]==="."||E[0]==="*")&&(H.output=$.fastpaths(E,R)),H.output||(H=$(E,R)),m.compileRe(H,R,x,k)},m.toRegex=(E,R)=>{try{const x=R||{};return new RegExp(E,x.flags||(x.nocase?"i":""))}catch(x){if(R&&R.debug===!0)throw x;return/$^/}},m.constants=W,d.exports=m},3921:(d,C,B)=>{"use strict";const T=B(8702),{CHAR_ASTERISK:N,CHAR_AT:$,CHAR_BACKWARD_SLASH:q,CHAR_COMMA:W,CHAR_DOT:P,CHAR_EXCLAMATION_MARK:m,CHAR_FORWARD_SLASH:E,CHAR_LEFT_CURLY_BRACE:R,CHAR_LEFT_PARENTHESES:x,CHAR_LEFT_SQUARE_BRACKET:k,CHAR_PLUS:H,CHAR_QUESTION_MARK:F,CHAR_RIGHT_CURLY_BRACE:Q,CHAR_RIGHT_PARENTHESES:he,CHAR_RIGHT_SQUARE_BRACKET:_e}=B(1006),j=L=>L===E||L===q,K=L=>{L.isPrefix!==!0&&(L.depth=L.isGlobstar?1/0:1)},X=(L,z)=>{const ee=z||{},se=L.length-1,ie=ee.parts===!0||ee.scanToEnd===!0,ce=[],ge=[],Ae=[];let Be=L,He=-1,be=0,Ye=0,ot=!1,We=!1,De=!1,Ge=!1,at=!1,je=!1,Y=!1,ht=!1,st=!1,ct=!1,fe=0,pe,qe,Qe={value:"",depth:0,isGlob:!1};const xt=()=>He>=se,mr=()=>Be.charCodeAt(He+1),kt=()=>(pe=qe,Be.charCodeAt(++He));for(;He<se;){qe=kt();let Xe;if(qe===q){Y=Qe.backslashes=!0,qe=kt(),qe===R&&(je=!0);continue}if(je===!0||qe===R){for(fe++;xt()!==!0&&(qe=kt());){if(qe===q){Y=Qe.backslashes=!0,kt();continue}if(qe===R){fe++;continue}if(je!==!0&&qe===P&&(qe=kt())===P){if(ot=Qe.isBrace=!0,De=Qe.isGlob=!0,ct=!0,ie===!0)continue;break}if(je!==!0&&qe===W){if(ot=Qe.isBrace=!0,De=Qe.isGlob=!0,ct=!0,ie===!0)continue;break}if(qe===Q&&(fe--,fe===0)){je=!1,ot=Qe.isBrace=!0,ct=!0;break}}if(ie===!0)continue;break}if(qe===E){if(ce.push(He),ge.push(Qe),Qe={value:"",depth:0,isGlob:!1},ct===!0)continue;if(pe===P&&He===be+1){be+=2;continue}Ye=He+1;continue}if(ee.noext!==!0&&(qe===H||qe===$||qe===N||qe===F||qe===m)===!0&&mr()===x){if(De=Qe.isGlob=!0,Ge=Qe.isExtglob=!0,ct=!0,qe===m&&He===be&&(st=!0),ie===!0){for(;xt()!==!0&&(qe=kt());){if(qe===q){Y=Qe.backslashes=!0,qe=kt();continue}if(qe===he){De=Qe.isGlob=!0,ct=!0;break}}continue}break}if(qe===N){if(pe===N&&(at=Qe.isGlobstar=!0),De=Qe.isGlob=!0,ct=!0,ie===!0)continue;break}if(qe===F){if(De=Qe.isGlob=!0,ct=!0,ie===!0)continue;break}if(qe===k){for(;xt()!==!0&&(Xe=kt());){if(Xe===q){Y=Qe.backslashes=!0,kt();continue}if(Xe===_e){We=Qe.isBracket=!0,De=Qe.isGlob=!0,ct=!0;break}}if(ie===!0)continue;break}if(ee.nonegate!==!0&&qe===m&&He===be){ht=Qe.negated=!0,be++;continue}if(ee.noparen!==!0&&qe===x){if(De=Qe.isGlob=!0,ie===!0){for(;xt()!==!0&&(qe=kt());){if(qe===x){Y=Qe.backslashes=!0,qe=kt();continue}if(qe===he){ct=!0;break}}continue}break}if(De===!0){if(ct=!0,ie===!0)continue;break}}ee.noext===!0&&(Ge=!1,De=!1);let It=Be,zr="",Pr="";be>0&&(zr=Be.slice(0,be),Be=Be.slice(be),Ye-=be),It&&De===!0&&Ye>0?(It=Be.slice(0,Ye),Pr=Be.slice(Ye)):De===!0?(It="",Pr=Be):It=Be,It&&It!==""&&It!=="/"&&It!==Be&&j(It.charCodeAt(It.length-1))&&(It=It.slice(0,-1)),ee.unescape===!0&&(Pr&&(Pr=T.removeBackslashes(Pr)),It&&Y===!0&&(It=T.removeBackslashes(It)));const tr={prefix:zr,input:L,start:be,base:It,glob:Pr,isBrace:ot,isBracket:We,isGlob:De,isExtglob:Ge,isGlobstar:at,negated:ht,negatedExtglob:st};if(ee.tokens===!0&&(tr.maxDepth=0,j(qe)||ge.push(Qe),tr.tokens=ge),ee.parts===!0||ee.tokens===!0){let Xe;for(let Ot=0;Ot<ce.length;Ot++){const Vi=Xe?Xe+1:be,Me=ce[Ot],mt=L.slice(Vi,Me);ee.tokens&&(Ot===0&&be!==0?(ge[Ot].isPrefix=!0,ge[Ot].value=zr):ge[Ot].value=mt,K(ge[Ot]),tr.maxDepth+=ge[Ot].depth),(Ot!==0||mt!=="")&&Ae.push(mt),Xe=Me}if(Xe&&Xe+1<L.length){const Ot=L.slice(Xe+1);Ae.push(Ot),ee.tokens&&(ge[ge.length-1].value=Ot,K(ge[ge.length-1]),tr.maxDepth+=ge[ge.length-1].depth)}tr.slashes=ce,tr.parts=Ae}return tr};d.exports=X},8702:(d,C,B)=>{"use strict";var T=B(4155);const N=B(6470),$=T.platform==="win32",{REGEX_BACKSLASH:q,REGEX_REMOVE_BACKSLASH:W,REGEX_SPECIAL_CHARS:P,REGEX_SPECIAL_CHARS_GLOBAL:m}=B(1006);C.isObject=E=>E!==null&&typeof E=="object"&&!Array.isArray(E),C.hasRegexChars=E=>P.test(E),C.isRegexChar=E=>E.length===1&&C.hasRegexChars(E),C.escapeRegex=E=>E.replace(m,"\\$1"),C.toPosixSlashes=E=>E.replace(q,"/"),C.removeBackslashes=E=>E.replace(W,R=>R==="\\"?"":R),C.supportsLookbehinds=()=>{const E=T.version.slice(1).split(".").map(Number);return E.length===3&&E[0]>=9||E[0]===8&&E[1]>=10},C.isWindows=E=>E&&typeof E.windows=="boolean"?E.windows:$===!0||N.sep==="\\",C.escapeLast=(E,R,x)=>{const k=E.lastIndexOf(R,x);return k===-1?E:E[k-1]==="\\"?C.escapeLast(E,R,k-1):`${E.slice(0,k)}\\${E.slice(k)}`},C.removePrefix=(E,R={})=>{let x=E;return x.startsWith("./")&&(x=x.slice(2),R.prefix="./"),x},C.wrapOutput=(E,R={},x={})=>{const k=x.contains?"":"^",H=x.contains?"":"$";let F=`${k}(?:${E})${H}`;return R.negated===!0&&(F=`(?:^(?!${F}).*$)`),F}},4155:d=>{var C=d.exports={},B,T;function N(){throw new Error("setTimeout has not been defined")}function $(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?B=setTimeout:B=N}catch(Q){B=N}try{typeof clearTimeout=="function"?T=clearTimeout:T=$}catch(Q){T=$}})();function q(Q){if(B===setTimeout)return setTimeout(Q,0);if((B===N||!B)&&setTimeout)return B=setTimeout,setTimeout(Q,0);try{return B(Q,0)}catch(he){try{return B.call(null,Q,0)}catch(_e){return B.call(this,Q,0)}}}function W(Q){if(T===clearTimeout)return clearTimeout(Q);if((T===$||!T)&&clearTimeout)return T=clearTimeout,clearTimeout(Q);try{return T(Q)}catch(he){try{return T.call(null,Q)}catch(_e){return T.call(this,Q)}}}var P=[],m=!1,E,R=-1;function x(){!m||!E||(m=!1,E.length?P=E.concat(P):R=-1,P.length&&k())}function k(){if(!m){var Q=q(x);m=!0;for(var he=P.length;he;){for(E=P,P=[];++R<he;)E&&E[R].run();R=-1,he=P.length}E=null,m=!1,W(Q)}}C.nextTick=function(Q){var he=new Array(arguments.length-1);if(arguments.length>1)for(var _e=1;_e<arguments.length;_e++)he[_e-1]=arguments[_e];P.push(new H(Q,he)),P.length===1&&!m&&q(k)};function H(Q,he){this.fun=Q,this.array=he}H.prototype.run=function(){this.fun.apply(null,this.array)},C.title="browser",C.browser=!0,C.env={},C.argv=[],C.version="",C.versions={};function F(){}C.on=F,C.addListener=F,C.once=F,C.off=F,C.removeListener=F,C.removeAllListeners=F,C.emit=F,C.prependListener=F,C.prependOnceListener=F,C.listeners=function(Q){return[]},C.binding=function(Q){throw new Error("process.binding is not supported")},C.cwd=function(){return"/"},C.chdir=function(Q){throw new Error("process.chdir is not supported")},C.umask=function(){return 0}},842:(d,C,B)=>{"use strict";var T=B(8764).Buffer;Object.defineProperty(C,"__esModule",{value:!0}),C.AbstractTokenizer=void 0;const N=B(5167);class ${constructor(W){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=W||{}}async readToken(W,P=this.position){const m=T.alloc(W.len);if(await this.readBuffer(m,{position:P})<W.len)throw new N.EndOfStreamError;return W.get(m,0)}async peekToken(W,P=this.position){const m=T.alloc(W.len);if(await this.peekBuffer(m,{position:P})<W.len)throw new N.EndOfStreamError;return W.get(m,0)}async readNumber(W){if(await this.readBuffer(this.numBuffer,{length:W.len})<W.len)throw new N.EndOfStreamError;return W.get(this.numBuffer,0)}async peekNumber(W){if(await this.peekBuffer(this.numBuffer,{length:W.len})<W.len)throw new N.EndOfStreamError;return W.get(this.numBuffer,0)}async ignore(W){if(this.fileInfo.size!==void 0){const P=this.fileInfo.size-this.position;if(W>P)return this.position+=P,P}return this.position+=W,W}async close(){}normalizeOptions(W,P){if(P&&P.position!==void 0&&P.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return P?{mayBeLess:P.mayBeLess===!0,offset:P.offset?P.offset:0,length:P.length?P.length:W.length-(P.offset?P.offset:0),position:P.position?P.position:this.position}:{mayBeLess:!1,offset:0,length:W.length,position:this.position}}}C.AbstractTokenizer=$},778:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BufferTokenizer=void 0;const T=B(5167),N=B(842);class $ extends N.AbstractTokenizer{constructor(W,P){super(P);this.uint8Array=W,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:W.length}async readBuffer(W,P){if(P&&P.position){if(P.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=P.position}const m=await this.peekBuffer(W,P);return this.position+=m,m}async peekBuffer(W,P){const m=this.normalizeOptions(W,P),E=Math.min(this.uint8Array.length-m.position,m.length);if(!m.mayBeLess&&E<m.length)throw new T.EndOfStreamError;return W.set(this.uint8Array.subarray(m.position,m.position+E),m.offset),E}async close(){}}C.BufferTokenizer=$},7859:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.fromFile=C.FileTokenizer=void 0;const T=B(842),N=B(5167),$=B(7209);class q extends T.AbstractTokenizer{constructor(m,E){super(E);this.fd=m}async readBuffer(m,E){const R=this.normalizeOptions(m,E);this.position=R.position;const x=await $.read(this.fd,m,R.offset,R.length,R.position);if(this.position+=x.bytesRead,x.bytesRead<R.length&&(!E||!E.mayBeLess))throw new N.EndOfStreamError;return x.bytesRead}async peekBuffer(m,E){const R=this.normalizeOptions(m,E),x=await $.read(this.fd,m,R.offset,R.length,R.position);if(!R.mayBeLess&&x.bytesRead<R.length)throw new N.EndOfStreamError;return x.bytesRead}async close(){return $.close(this.fd)}}C.FileTokenizer=q;async function W(P){const m=await $.stat(P);if(!m.isFile)throw new Error(`File not a file: ${P}`);const E=await $.open(P,"r");return new q(E,{path:P,size:m.size})}C.fromFile=W},7209:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.readFile=C.writeFileSync=C.writeFile=C.read=C.open=C.close=C.stat=C.createReadStream=C.pathExists=void 0;const T=B(4059);C.pathExists=T.existsSync,C.createReadStream=T.createReadStream;async function N(R){return new Promise((x,k)=>{T.stat(R,(H,F)=>{H?k(H):x(F)})})}C.stat=N;async function $(R){return new Promise((x,k)=>{T.close(R,H=>{H?k(H):x()})})}C.close=$;async function q(R,x){return new Promise((k,H)=>{T.open(R,x,(F,Q)=>{F?H(F):k(Q)})})}C.open=q;async function W(R,x,k,H,F){return new Promise((Q,he)=>{T.read(R,x,k,H,F,(_e,j,K)=>{_e?he(_e):Q({bytesRead:j,buffer:K})})})}C.read=W;async function P(R,x){return new Promise((k,H)=>{T.writeFile(R,x,F=>{F?H(F):k()})})}C.writeFile=P;function m(R,x){T.writeFileSync(R,x)}C.writeFileSync=m;async function E(R){return new Promise((x,k)=>{T.readFile(R,(H,F)=>{H?k(H):x(F)})})}C.readFile=E},599:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.ReadStreamTokenizer=void 0;const T=B(842),N=B(5167),$=256e3;class q extends T.AbstractTokenizer{constructor(P,m){super(m);this.streamReader=new N.StreamReader(P)}async getFileInfo(){return this.fileInfo}async readBuffer(P,m){const E=this.normalizeOptions(P,m),R=E.position-this.position;if(R>0)return await this.ignore(R),this.readBuffer(P,m);if(R<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(E.length===0)return 0;const x=await this.streamReader.read(P,E.offset,E.length);if(this.position+=x,(!m||!m.mayBeLess)&&x<E.length)throw new N.EndOfStreamError;return x}async peekBuffer(P,m){const E=this.normalizeOptions(P,m);let R=0;if(E.position){const x=E.position-this.position;if(x>0){const k=new Uint8Array(E.length+x);return R=await this.peekBuffer(k,{mayBeLess:E.mayBeLess}),P.set(k.subarray(x),E.offset),R-x}else if(x<0)throw new Error("Cannot peek from a negative offset in a stream")}if(E.length>0){try{R=await this.streamReader.peek(P,E.offset,E.length)}catch(x){if(m&&m.mayBeLess&&x instanceof N.EndOfStreamError)return 0;throw x}if(!E.mayBeLess&&R<E.length)throw new N.EndOfStreamError}return R}async ignore(P){const m=Math.min($,P),E=new Uint8Array(m);let R=0;for(;R<P;){const x=P-R,k=await this.readBuffer(E,{length:Math.min(m,x)});if(k<0)return k;R+=k}return R}}C.ReadStreamTokenizer=q},5849:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.fromBuffer=C.fromStream=C.EndOfStreamError=void 0;const T=B(599),N=B(778);var $=B(5167);Object.defineProperty(C,"EndOfStreamError",{enumerable:!0,get:function(){return $.EndOfStreamError}});function q(P,m){return m=m||{},new T.ReadStreamTokenizer(P,m)}C.fromStream=q;function W(P,m){return new N.BufferTokenizer(P,m)}C.fromBuffer=W},6597:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.fromStream=C.fromBuffer=C.EndOfStreamError=C.fromFile=void 0;const T=B(7209),N=B(5849);var $=B(7859);Object.defineProperty(C,"fromFile",{enumerable:!0,get:function(){return $.fromFile}});var q=B(5849);Object.defineProperty(C,"EndOfStreamError",{enumerable:!0,get:function(){return q.EndOfStreamError}}),Object.defineProperty(C,"fromBuffer",{enumerable:!0,get:function(){return q.fromBuffer}});async function W(P,m){if(m=m||{},P.path){const E=await T.stat(P.path);m.path=P.path,m.size=E.size}return N.fromStream(P,m)}C.fromStream=W},5702:(d,C,B)=>{"use strict";/*!
 * to-regex-range <https://github.com/micromatch/to-regex-range>
 *
 * Copyright (c) 2015-present, Jon Schlinkert.
 * Released under the MIT License.
 */const T=B(9924),N=(j,K,X)=>{if(T(j)===!1)throw new TypeError("toRegexRange: expected the first argument to be a number");if(K===void 0||j===K)return String(j);if(T(K)===!1)throw new TypeError("toRegexRange: expected the second argument to be a number.");let L={relaxZeros:!0,...X};typeof L.strictZeros=="boolean"&&(L.relaxZeros=L.strictZeros===!1);let z=String(L.relaxZeros),ee=String(L.shorthand),se=String(L.capture),ie=String(L.wrap),ce=j+":"+K+"="+z+ee+se+ie;if(N.cache.hasOwnProperty(ce))return N.cache[ce].result;let ge=Math.min(j,K),Ae=Math.max(j,K);if(Math.abs(ge-Ae)===1){let ot=j+"|"+K;return L.capture?`(${ot})`:L.wrap===!1?ot:`(?:${ot})`}let Be=he(j)||he(K),He={min:j,max:K,a:ge,b:Ae},be=[],Ye=[];if(Be&&(He.isPadded=Be,He.maxLen=String(He.max).length),ge<0){let ot=Ae<0?Math.abs(Ae):1;Ye=P(ot,Math.abs(ge),He,L),ge=He.a=0}return Ae>=0&&(be=P(ge,Ae,He,L)),He.negatives=Ye,He.positives=be,He.result=$(Ye,be,L),L.capture===!0?He.result=`(${He.result})`:L.wrap!==!1&&be.length+Ye.length>1&&(He.result=`(?:${He.result})`),N.cache[ce]=He,He.result};function $(j,K,X){let L=m(j,K,"-",!1,X)||[],z=m(K,j,"",!1,X)||[],ee=m(j,K,"-?",!0,X)||[];return L.concat(ee).concat(z).join("|")}function q(j,K){let X=1,L=1,z=k(j,X),ee=new Set([K]);for(;j<=z&&z<=K;)ee.add(z),X+=1,z=k(j,X);for(z=H(K+1,L)-1;j<z&&z<=K;)ee.add(z),L+=1,z=H(K+1,L)-1;return ee=[...ee],ee.sort(R),ee}function W(j,K,X){if(j===K)return{pattern:j,count:[],digits:0};let L=E(j,K),z=L.length,ee="",se=0;for(let ie=0;ie<z;ie++){let[ce,ge]=L[ie];ce===ge?ee+=ce:ce!=="0"||ge!=="9"?ee+=Q(ce,ge,X):se++}return se&&(ee+=X.shorthand===!0?"\\d":"[0-9]"),{pattern:ee,count:[se],digits:z}}function P(j,K,X,L){let z=q(j,K),ee=[],se=j,ie;for(let ce=0;ce<z.length;ce++){let ge=z[ce],Ae=W(String(se),String(ge),L),Be="";if(!X.isPadded&&ie&&ie.pattern===Ae.pattern){ie.count.length>1&&ie.count.pop(),ie.count.push(Ae.count[0]),ie.string=ie.pattern+F(ie.count),se=ge+1;continue}X.isPadded&&(Be=_e(ge,X,L)),Ae.string=Be+Ae.pattern+F(Ae.count),ee.push(Ae),se=ge+1,ie=Ae}return ee}function m(j,K,X,L,z){let ee=[];for(let se of j){let{string:ie}=se;!L&&!x(K,"string",ie)&&ee.push(X+ie),L&&x(K,"string",ie)&&ee.push(X+ie)}return ee}function E(j,K){let X=[];for(let L=0;L<j.length;L++)X.push([j[L],K[L]]);return X}function R(j,K){return j>K?1:K>j?-1:0}function x(j,K,X){return j.some(L=>L[K]===X)}function k(j,K){return Number(String(j).slice(0,-K)+"9".repeat(K))}function H(j,K){return j-j%Math.pow(10,K)}function F(j){let[K=0,X=""]=j;return X||K>1?`{${K+(X?","+X:"")}}`:""}function Q(j,K,X){return`[${j}${K-j==1?"":"-"}${K}]`}function he(j){return/^-?(0+)\d/.test(j)}function _e(j,K,X){if(!K.isPadded)return j;let L=Math.abs(K.maxLen-String(j).length),z=X.relaxZeros!==!1;switch(L){case 0:return"";case 1:return z?"0?":"0";case 2:return z?"0{0,2}":"00";default:return z?`0{0,${L}}`:`0{${L}}`}}N.cache={},N.clearCache=()=>N.cache={},d.exports=N},3416:(d,C,B)=>{"use strict";var T=B(8764).Buffer;Object.defineProperty(C,"__esModule",{value:!0}),C.AnsiStringType=C.StringType=C.BufferType=C.Uint8ArrayType=C.IgnoreType=C.Float80_LE=C.Float80_BE=C.Float64_LE=C.Float64_BE=C.Float32_LE=C.Float32_BE=C.Float16_LE=C.Float16_BE=C.INT64_BE=C.UINT64_BE=C.INT64_LE=C.UINT64_LE=C.INT32_LE=C.INT32_BE=C.INT24_BE=C.INT24_LE=C.INT16_LE=C.INT16_BE=C.INT8=C.UINT32_BE=C.UINT32_LE=C.UINT24_BE=C.UINT24_LE=C.UINT16_BE=C.UINT16_LE=C.UINT8=void 0;const N=B(645);function $(R){return new DataView(R.buffer,R.byteOffset)}C.UINT8={len:1,get(R,x){return $(R).getUint8(x)},put(R,x,k){return $(R).setUint8(x,k),x+1}},C.UINT16_LE={len:2,get(R,x){return $(R).getUint16(x,!0)},put(R,x,k){return $(R).setUint16(x,k,!0),x+2}},C.UINT16_BE={len:2,get(R,x){return $(R).getUint16(x)},put(R,x,k){return $(R).setUint16(x,k),x+2}},C.UINT24_LE={len:3,get(R,x){const k=$(R);return k.getUint8(x)+(k.getUint16(x+1,!0)<<8)},put(R,x,k){const H=$(R);return H.setUint8(x,k&255),H.setUint16(x+1,k>>8,!0),x+3}},C.UINT24_BE={len:3,get(R,x){const k=$(R);return(k.getUint16(x)<<8)+k.getUint8(x+2)},put(R,x,k){const H=$(R);return H.setUint16(x,k>>8),H.setUint8(x+2,k&255),x+3}},C.UINT32_LE={len:4,get(R,x){return $(R).getUint32(x,!0)},put(R,x,k){return $(R).setUint32(x,k,!0),x+4}},C.UINT32_BE={len:4,get(R,x){return $(R).getUint32(x)},put(R,x,k){return $(R).setUint32(x,k),x+4}},C.INT8={len:1,get(R,x){return $(R).getInt8(x)},put(R,x,k){return $(R).setInt8(x,k),x+2}},C.INT16_BE={len:2,get(R,x){return $(R).getInt16(x)},put(R,x,k){return $(R).setInt16(x,k),x+2}},C.INT16_LE={len:2,get(R,x){return $(R).getInt16(x,!0)},put(R,x,k){return $(R).setInt16(x,k,!0),x+2}},C.INT24_LE={len:3,get(R,x){const k=C.UINT24_LE.get(R,x);return k>8388607?k-16777216:k},put(R,x,k){const H=$(R);return H.setUint8(x,k&255),H.setUint16(x+1,k>>8,!0),x+3}},C.INT24_BE={len:3,get(R,x){const k=C.UINT24_BE.get(R,x);return k>8388607?k-16777216:k},put(R,x,k){const H=$(R);return H.setUint16(x,k>>8),H.setUint8(x+2,k&255),x+3}},C.INT32_BE={len:4,get(R,x){return $(R).getInt32(x)},put(R,x,k){return $(R).setInt32(x,k),x+4}},C.INT32_LE={len:4,get(R,x){return $(R).getInt32(x,!0)},put(R,x,k){return $(R).setInt32(x,k,!0),x+4}},C.UINT64_LE={len:8,get(R,x){return $(R).getBigUint64(x,!0)},put(R,x,k){return $(R).setBigUint64(x,k,!0),x+8}},C.INT64_LE={len:8,get(R,x){return $(R).getBigInt64(x,!0)},put(R,x,k){return $(R).setBigInt64(x,k,!0),x+8}},C.UINT64_BE={len:8,get(R,x){return $(R).getBigUint64(x)},put(R,x,k){return $(R).setBigUint64(x,k),x+8}},C.INT64_BE={len:8,get(R,x){return $(R).getBigInt64(x)},put(R,x,k){return $(R).setBigInt64(x,k),x+8}},C.Float16_BE={len:2,get(R,x){return N.read(R,x,!1,10,this.len)},put(R,x,k){return N.write(R,k,x,!1,10,this.len),x+this.len}},C.Float16_LE={len:2,get(R,x){return N.read(R,x,!0,10,this.len)},put(R,x,k){return N.write(R,k,x,!0,10,this.len),x+this.len}},C.Float32_BE={len:4,get(R,x){return $(R).getFloat32(x)},put(R,x,k){return $(R).setFloat32(x,k),x+4}},C.Float32_LE={len:4,get(R,x){return $(R).getFloat32(x,!0)},put(R,x,k){return $(R).setFloat32(x,k,!0),x+4}},C.Float64_BE={len:8,get(R,x){return $(R).getFloat64(x)},put(R,x,k){return $(R).setFloat64(x,k),x+8}},C.Float64_LE={len:8,get(R,x){return $(R).getFloat64(x,!0)},put(R,x,k){return $(R).setFloat64(x,k,!0),x+8}},C.Float80_BE={len:10,get(R,x){return N.read(R,x,!1,63,this.len)},put(R,x,k){return N.write(R,k,x,!1,63,this.len),x+this.len}},C.Float80_LE={len:10,get(R,x){return N.read(R,x,!0,63,this.len)},put(R,x,k){return N.write(R,k,x,!0,63,this.len),x+this.len}};class q{constructor(x){this.len=x}get(x,k){}}C.IgnoreType=q;class W{constructor(x){this.len=x}get(x,k){return x.subarray(k,k+this.len)}}C.Uint8ArrayType=W;class P{constructor(x){this.len=x}get(x,k){return x.slice(k,k+this.len)}}C.BufferType=P;class m{constructor(x,k){this.len=x,this.encoding=k}get(x,k){return T.from(x).toString(this.encoding,k,k+this.len)}}C.StringType=m;class E{constructor(x){this.len=x}static decode(x,k,H){let F="";for(let Q=k;Q<H;++Q)F+=E.codePointToString(E.singleByteDecoder(x[Q]));return F}static inRange(x,k,H){return k<=x&&x<=H}static codePointToString(x){return x<=65535?String.fromCharCode(x):(x-=65536,String.fromCharCode((x>>10)+55296,(x&1023)+56320))}static singleByteDecoder(x){if(E.inRange(x,0,127))return x;const k=E.windows1252[x-128];if(k===null)throw Error("invaliding encoding");return k}get(x,k=0){return E.decode(x,k,k+this.len)}}C.AnsiStringType=E,E.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]},5102:()=>{},189:function(d,C,B){"use strict";var T=this&&this.__spreadArrays||function(){for(var m=0,E=0,R=arguments.length;E<R;E++)m+=arguments[E].length;for(var x=Array(m),k=0,E=0;E<R;E++)for(var H=arguments[E],F=0,Q=H.length;F<Q;F++,k++)x[k]=H[F];return x};Object.defineProperty(C,"__esModule",{value:!0}),C.config=C.loadMessageBundle=void 0;var N=B(1926),$=B(800),q=B(800);Object.defineProperty(C,"MessageFormat",{enumerable:!0,get:function(){return q.MessageFormat}}),Object.defineProperty(C,"BundleFormat",{enumerable:!0,get:function(){return q.BundleFormat}});function W(m){return function(E,R){for(var x=[],k=2;k<arguments.length;k++)x[k-2]=arguments[k];if(typeof E=="number")throw new Error("Browser implementation does currently not support externalized strings.");return $.localize.apply(void 0,T([E,R],x))}}C.loadMessageBundle=W;function P(m){return $.setPseudo((m==null?void 0:m.locale.toLowerCase())==="pseudo"),W}C.config=P,N.default.install(Object.freeze({loadMessageBundle:W,config:P}))},800:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.config=C.loadMessageBundle=C.localize=C.format=C.setPseudo=C.isPseudo=C.isDefined=C.BundleFormat=C.MessageFormat=void 0;var T=B(1926),N;(function(k){k.file="file",k.bundle="bundle",k.both="both"})(N=C.MessageFormat||(C.MessageFormat={}));var $;(function(k){k.standalone="standalone",k.languagePack="languagePack"})($=C.BundleFormat||(C.BundleFormat={}));var q;(function(k){function H(F){var Q=F;return Q&&W(Q.key)&&W(Q.comment)}k.is=H})(q||(q={}));function W(k){return typeof k!="undefined"}C.isDefined=W,C.isPseudo=!1;function P(k){C.isPseudo=k}C.setPseudo=P;function m(k,H){var F;return C.isPseudo&&(k="\uFF3B"+k.replace(/[aouei]/g,"$&$&")+"\uFF3D"),H.length===0?F=k:F=k.replace(/\{(\d+)\}/g,function(Q,he){var _e=he[0],j=H[_e],K=Q;return typeof j=="string"?K=j:(typeof j=="number"||typeof j=="boolean"||j===void 0||j===null)&&(K=String(j)),K}),F}C.format=m;function E(k,H){for(var F=[],Q=2;Q<arguments.length;Q++)F[Q-2]=arguments[Q];return m(H,F)}C.localize=E;function R(k){return T.default().loadMessageBundle(k)}C.loadMessageBundle=R;function x(k){return T.default().config(k)}C.config=x},1926:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});var B;function T(){if(B===void 0)throw new Error("No runtime abstraction layer installed");return B}(function(N){function $(q){if(q===void 0)throw new Error("No runtime abstraction layer provided");B=q}N.install=$})(T||(T={})),C.default=T},6822:(d,C,B)=>{"use strict";d.exports=B(189)},2479:d=>{d.exports=C;function C(B,T){if(B&&T)return C(B)(T);if(typeof B!="function")throw new TypeError("need wrapper function");return Object.keys(B).forEach(function($){N[$]=B[$]}),N;function N(){for(var $=new Array(arguments.length),q=0;q<$.length;q++)$[q]=arguments[q];var W=B.apply(this,$),P=$[$.length-1];return typeof W=="function"&&W!==P&&Object.keys(P).forEach(function(m){W[m]=P[m]}),W}}},1932:()=>{},7170:()=>{},4059:()=>{}},__webpack_module_cache__={};function __webpack_require__(d){var C=__webpack_module_cache__[d];if(C!==void 0)return C.exports;var B=__webpack_module_cache__[d]={exports:{}};return __webpack_modules__[d].call(B.exports,B,B.exports,__webpack_require__),B.exports}(()=>{__webpack_require__.n=d=>{var C=d&&d.__esModule?()=>d.default:()=>d;return __webpack_require__.d(C,{a:C}),C}})(),(()=>{__webpack_require__.d=(d,C)=>{for(var B in C)__webpack_require__.o(C,B)&&!__webpack_require__.o(d,B)&&Object.defineProperty(d,B,{enumerable:!0,get:C[B]})}})(),(()=>{__webpack_require__.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(d){if(typeof window=="object")return window}}()})(),(()=>{__webpack_require__.o=(d,C)=>Object.prototype.hasOwnProperty.call(d,C)})(),(()=>{__webpack_require__.r=d=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})}})();var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{StateKeys:()=>Io,activate:()=>QI,getOpenActionsService:()=>pu,getState:()=>Jy,isInsiders:()=>tb,updateState:()=>tp});const d=require("vscode");var C=__webpack_require__(189),B;(function(t){t.Off="off",t.Auto="auto",t.Always="always"})(B||(B={}));var T;(function(t){t.None="none",t.Latest="latest",t.Match="match",t.TipPlusLatest="tip+latest"})(T||(T={})),function(t){function e(r){return r===t.None||r===t.Latest||r===t.Match||r===t.TipPlusLatest?r:t.None}t.sanitize=e}(T||(T={}));var N;(function(t){t.Browse="browse",t.Edit="edit"})(N||(N={})),function(t){function e(n){return n===t.Browse||n===t.Edit?n:t.Edit}t.sanitize=e;function r(n){return n===t.Browse?t.Edit:t.Browse}t.toggle=r}(N||(N={}));var $;(function(t){function e(r,n){return r.display===n.display&&r.index===n.index}t.equals=e})($||($={}));var q;(function(t){t.Branch="branch",t.RemoteBranch="remoteBranch",t.PullRequestBranch="pullRequestBranch",t.PullRequestRemoteBranch="pullRequestRemoteBranch",t.Tag="tag",t.Commit="commit"})(q||(q={}));var W;(function(t){const e=new Map([[q.Branch,T.None],[q.RemoteBranch,T.None],[q.PullRequestBranch,T.Match],[q.PullRequestRemoteBranch,T.Match],[q.Commit,T.Match],[q.Tag,T.Match]]),r=new Map([[q.Branch,N.Edit],[q.RemoteBranch,N.Edit],[q.PullRequestBranch,N.Browse],[q.PullRequestRemoteBranch,N.Browse],[q.Commit,N.Browse],[q.Tag,N.Browse]]);function n(i){var o,a;return{display:(o=r.get(i))!=null?o:N.Edit,index:(a=e.get(i))!=null?a:T.None}}t.getDefault=n})(W||(W={}));const P=null;function m(){this.__data__=[],this.size=0}const E=m;function R(t,e){return t===e||t!==t&&e!==e}const x=R;function k(t,e){for(var r=t.length;r--;)if(x(t[r][0],e))return r;return-1}const H=k;var F=Array.prototype,Q=F.splice;function he(t){var e=this.__data__,r=H(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Q.call(e,r,1),--this.size,!0}const _e=he;function j(t){var e=this.__data__,r=H(e,t);return r<0?void 0:e[r][1]}const K=j;function X(t){return H(this.__data__,t)>-1}const L=X;function z(t,e){var r=this.__data__,n=H(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}const ee=z;function se(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}se.prototype.clear=E,se.prototype.delete=_e,se.prototype.get=K,se.prototype.has=L,se.prototype.set=ee;const ie=se;function ce(){this.__data__=new ie,this.size=0}const ge=ce;function Ae(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}const Be=Ae;function He(t){return this.__data__.get(t)}const be=He;function Ye(t){return this.__data__.has(t)}const ot=Ye;var We=typeof global=="object"&&global&&global.Object===Object&&global;const De=We;var Ge=typeof self=="object"&&self&&self.Object===Object&&self,at=De||Ge||Function("return this")();const je=at;var Y=je.Symbol;const ht=Y;var st=Object.prototype,ct=st.hasOwnProperty,fe=st.toString,pe=ht?ht.toStringTag:void 0;function qe(t){var e=ct.call(t,pe),r=t[pe];try{t[pe]=void 0;var n=!0}catch(o){}var i=fe.call(t);return n&&(e?t[pe]=r:delete t[pe]),i}const Qe=qe;var xt=Object.prototype,mr=xt.toString;function kt(t){return mr.call(t)}const It=kt;var zr="[object Null]",Pr="[object Undefined]",tr=ht?ht.toStringTag:void 0;function Xe(t){return t==null?t===void 0?Pr:zr:tr&&tr in Object(t)?Qe(t):It(t)}const Ot=Xe;function Vi(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}const Me=Vi;var mt="[object AsyncFunction]",Ee="[object Function]",it="[object GeneratorFunction]",jt="[object Proxy]";function Ht(t){if(!Me(t))return!1;var e=Ot(t);return e==Ee||e==it||e==mt||e==jt}const Zt=Ht;var A=je["__core-js_shared__"];const g=A;var v=function(){var t=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function M(t){return!!v&&v in t}const V=M;var oe=Function.prototype,me=oe.toString;function ft(t){if(t!=null){try{return me.call(t)}catch(e){}try{return t+""}catch(e){}}return""}const Dt=ft;var qt=/[\\^$.*+?()[\]{}|]/g,Xt=/^\[object .+?Constructor\]$/,Ft=Function.prototype,nb=Object.prototype,ib=Ft.toString,ob=nb.hasOwnProperty,ab=RegExp("^"+ib.call(ob).replace(qt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function sb(t){if(!Me(t)||V(t))return!1;var e=Zt(t)?ab:Xt;return e.test(Dt(t))}const cb=sb;function lb(t,e){return t==null?void 0:t[e]}const ub=lb;function db(t,e){var r=ub(t,e);return cb(r)?r:void 0}const Do=db;var hb=Do(je,"Map");const Pa=hb;var fb=Do(Object,"create");const Fa=fb;function pb(){this.__data__=Fa?Fa(null):{},this.size=0}const gb=pb;function mb(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}const vb=mb;var wb="__lodash_hash_undefined__",yb=Object.prototype,bb=yb.hasOwnProperty;function _b(t){var e=this.__data__;if(Fa){var r=e[t];return r===wb?void 0:r}return bb.call(e,t)?e[t]:void 0}const xb=_b;var Sb=Object.prototype,Cb=Sb.hasOwnProperty;function Eb(t){var e=this.__data__;return Fa?e[t]!==void 0:Cb.call(e,t)}const Rb=Eb;var Ab="__lodash_hash_undefined__";function Tb(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Fa&&e===void 0?Ab:e,this}const kb=Tb;function Po(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Po.prototype.clear=gb,Po.prototype.delete=vb,Po.prototype.get=xb,Po.prototype.has=Rb,Po.prototype.set=kb;const ip=Po;function Ib(){this.size=0,this.__data__={hash:new ip,map:new(Pa||ie),string:new ip}}const Db=Ib;function Pb(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}const Fb=Pb;function Nb(t,e){var r=t.__data__;return Fb(e)?r[typeof e=="string"?"string":"hash"]:r.map}const cc=Nb;function $b(t){var e=cc(this,t).delete(t);return this.size-=e?1:0,e}const Mb=$b;function Bb(t){return cc(this,t).get(t)}const Ob=Bb;function Ub(t){return cc(this,t).has(t)}const Lb=Ub;function Hb(t,e){var r=cc(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}const qb=Hb;function Fo(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Fo.prototype.clear=Db,Fo.prototype.delete=Mb,Fo.prototype.get=Ob,Fo.prototype.has=Lb,Fo.prototype.set=qb;const op=Fo;var Wb=200;function zb(t,e){var r=this.__data__;if(r instanceof ie){var n=r.__data__;if(!Pa||n.length<Wb-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new op(n)}return r.set(t,e),this.size=r.size,this}const jb=zb;function No(t){var e=this.__data__=new ie(t);this.size=e.size}No.prototype.clear=ge,No.prototype.delete=Be,No.prototype.get=be,No.prototype.has=ot,No.prototype.set=jb;const mu=No;var Vb="__lodash_hash_undefined__";function Gb(t){return this.__data__.set(t,Vb),this}const Kb=Gb;function Zb(t){return this.__data__.has(t)}const Xb=Zb;function lc(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new op;++e<r;)this.add(t[e])}lc.prototype.add=lc.prototype.push=Kb,lc.prototype.has=Xb;const Qb=lc;function Yb(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}const Jb=Yb;function e_(t,e){return t.has(e)}const t_=e_;var r_=1,n_=2;function i_(t,e,r,n,i,o){var a=r&r_,s=t.length,c=e.length;if(s!=c&&!(a&&c>s))return!1;var l=o.get(t),u=o.get(e);if(l&&u)return l==e&&u==t;var f=-1,h=!0,p=r&n_?new Qb:void 0;for(o.set(t,e),o.set(e,t);++f<s;){var b=t[f],y=e[f];if(n)var w=a?n(y,b,f,e,t,o):n(b,y,f,t,e,o);if(w!==void 0){if(w)continue;h=!1;break}if(p){if(!Jb(e,function(_,S){if(!t_(p,S)&&(b===_||i(b,_,r,n,o)))return p.push(S)})){h=!1;break}}else if(!(b===y||i(b,y,r,n,o))){h=!1;break}}return o.delete(t),o.delete(e),h}const ap=i_;var o_=je.Uint8Array;const sp=o_;function a_(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}const s_=a_;function c_(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}const l_=c_;var u_=1,d_=2,h_="[object Boolean]",f_="[object Date]",p_="[object Error]",g_="[object Map]",m_="[object Number]",v_="[object RegExp]",w_="[object Set]",y_="[object String]",b_="[object Symbol]",__="[object ArrayBuffer]",x_="[object DataView]",cp=ht?ht.prototype:void 0,vu=cp?cp.valueOf:void 0;function S_(t,e,r,n,i,o,a){switch(r){case x_:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case __:return!(t.byteLength!=e.byteLength||!o(new sp(t),new sp(e)));case h_:case f_:case m_:return x(+t,+e);case p_:return t.name==e.name&&t.message==e.message;case v_:case y_:return t==e+"";case g_:var s=s_;case w_:var c=n&u_;if(s||(s=l_),t.size!=e.size&&!c)return!1;var l=a.get(t);if(l)return l==e;n|=d_,a.set(t,e);var u=ap(s(t),s(e),n,i,o,a);return a.delete(t),u;case b_:if(vu)return vu.call(t)==vu.call(e)}return!1}const C_=S_;function E_(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}const R_=E_;var A_=Array.isArray;const uc=A_;function T_(t,e,r){var n=e(t);return uc(t)?n:R_(n,r(t))}const k_=T_;function I_(t,e){for(var r=-1,n=t==null?0:t.length,i=0,o=[];++r<n;){var a=t[r];e(a,r,t)&&(o[i++]=a)}return o}const D_=I_;function P_(){return[]}const F_=P_;var N_=Object.prototype,$_=N_.propertyIsEnumerable,lp=Object.getOwnPropertySymbols,M_=lp?function(t){return t==null?[]:(t=Object(t),D_(lp(t),function(e){return $_.call(t,e)}))}:F_;const B_=M_;function O_(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}const U_=O_;function L_(t){return t!=null&&typeof t=="object"}const Na=L_;var H_="[object Arguments]";function q_(t){return Na(t)&&Ot(t)==H_}const up=q_;var dp=Object.prototype,W_=dp.hasOwnProperty,z_=dp.propertyIsEnumerable,j_=up(function(){return arguments}())?up:function(t){return Na(t)&&W_.call(t,"callee")&&!z_.call(t,"callee")};const V_=j_;function G_(){return!1}const K_=G_;var hp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fp=hp&&typeof module=="object"&&module&&!module.nodeType&&module,Z_=fp&&fp.exports===hp,pp=Z_?je.Buffer:void 0,X_=pp?pp.isBuffer:void 0,Q_=X_||K_;const wu=Q_;var Y_=9007199254740991,J_=/^(?:0|[1-9]\d*)$/;function ex(t,e){var r=typeof t;return e=e==null?Y_:e,!!e&&(r=="number"||r!="symbol"&&J_.test(t))&&t>-1&&t%1==0&&t<e}const tx=ex;var rx=9007199254740991;function nx(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=rx}const gp=nx;var ix="[object Arguments]",ox="[object Array]",ax="[object Boolean]",sx="[object Date]",cx="[object Error]",lx="[object Function]",ux="[object Map]",dx="[object Number]",hx="[object Object]",fx="[object RegExp]",px="[object Set]",gx="[object String]",mx="[object WeakMap]",vx="[object ArrayBuffer]",wx="[object DataView]",yx="[object Float32Array]",bx="[object Float64Array]",_x="[object Int8Array]",xx="[object Int16Array]",Sx="[object Int32Array]",Cx="[object Uint8Array]",Ex="[object Uint8ClampedArray]",Rx="[object Uint16Array]",Ax="[object Uint32Array]",Vt={};Vt[yx]=Vt[bx]=Vt[_x]=Vt[xx]=Vt[Sx]=Vt[Cx]=Vt[Ex]=Vt[Rx]=Vt[Ax]=!0,Vt[ix]=Vt[ox]=Vt[vx]=Vt[ax]=Vt[wx]=Vt[sx]=Vt[cx]=Vt[lx]=Vt[ux]=Vt[dx]=Vt[hx]=Vt[fx]=Vt[px]=Vt[gx]=Vt[mx]=!1;function Tx(t){return Na(t)&&gp(t.length)&&!!Vt[Ot(t)]}const kx=Tx;function Ix(t){return function(e){return t(e)}}const Dx=Ix;var mp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,$a=mp&&typeof module=="object"&&module&&!module.nodeType&&module,Px=$a&&$a.exports===mp,yu=Px&&De.process,Fx=function(){try{var t=$a&&$a.require&&$a.require("util").types;return t||yu&&yu.binding&&yu.binding("util")}catch(e){}}();const vp=Fx;var wp=vp&&vp.isTypedArray,Nx=wp?Dx(wp):kx;const yp=Nx;var $x=Object.prototype,Mx=$x.hasOwnProperty;function Bx(t,e){var r=uc(t),n=!r&&V_(t),i=!r&&!n&&wu(t),o=!r&&!n&&!i&&yp(t),a=r||n||i||o,s=a?U_(t.length,String):[],c=s.length;for(var l in t)(e||Mx.call(t,l))&&!(a&&(l=="length"||i&&(l=="offset"||l=="parent")||o&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||tx(l,c)))&&s.push(l);return s}const Ox=Bx;var Ux=Object.prototype;function Lx(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Ux;return t===r}const Hx=Lx;function qx(t,e){return function(r){return t(e(r))}}var Wx=qx(Object.keys,Object);const zx=Wx;var jx=Object.prototype,Vx=jx.hasOwnProperty;function Gx(t){if(!Hx(t))return zx(t);var e=[];for(var r in Object(t))Vx.call(t,r)&&r!="constructor"&&e.push(r);return e}const Kx=Gx;function Zx(t){return t!=null&&gp(t.length)&&!Zt(t)}const Xx=Zx;function Qx(t){return Xx(t)?Ox(t):Kx(t)}const Yx=Qx;function Jx(t){return k_(t,Yx,B_)}const bp=Jx;var eS=1,tS=Object.prototype,rS=tS.hasOwnProperty;function nS(t,e,r,n,i,o){var a=r&eS,s=bp(t),c=s.length,l=bp(e),u=l.length;if(c!=u&&!a)return!1;for(var f=c;f--;){var h=s[f];if(!(a?h in e:rS.call(e,h)))return!1}var p=o.get(t),b=o.get(e);if(p&&b)return p==e&&b==t;var y=!0;o.set(t,e),o.set(e,t);for(var w=a;++f<c;){h=s[f];var _=t[h],S=e[h];if(n)var I=a?n(S,_,h,e,t,o):n(_,S,h,t,e,o);if(!(I===void 0?_===S||i(_,S,r,n,o):I)){y=!1;break}w||(w=h=="constructor")}if(y&&!w){var D=t.constructor,O=e.constructor;D!=O&&"constructor"in t&&"constructor"in e&&!(typeof D=="function"&&D instanceof D&&typeof O=="function"&&O instanceof O)&&(y=!1)}return o.delete(t),o.delete(e),y}const iS=nS;var oS=Do(je,"DataView");const bu=oS;var aS=Do(je,"Promise");const _u=aS;var sS=Do(je,"Set");const xu=sS;var cS=Do(je,"WeakMap");const Su=cS;var _p="[object Map]",lS="[object Object]",xp="[object Promise]",Sp="[object Set]",Cp="[object WeakMap]",Ep="[object DataView]",uS=Dt(bu),dS=Dt(Pa),hS=Dt(_u),fS=Dt(xu),pS=Dt(Su),Gi=Ot;(bu&&Gi(new bu(new ArrayBuffer(1)))!=Ep||Pa&&Gi(new Pa)!=_p||_u&&Gi(_u.resolve())!=xp||xu&&Gi(new xu)!=Sp||Su&&Gi(new Su)!=Cp)&&(Gi=function(t){var e=Ot(t),r=e==lS?t.constructor:void 0,n=r?Dt(r):"";if(n)switch(n){case uS:return Ep;case dS:return _p;case hS:return xp;case fS:return Sp;case pS:return Cp}return e});const Rp=Gi;var gS=1,Ap="[object Arguments]",Tp="[object Array]",dc="[object Object]",mS=Object.prototype,kp=mS.hasOwnProperty;function vS(t,e,r,n,i,o){var a=uc(t),s=uc(e),c=a?Tp:Rp(t),l=s?Tp:Rp(e);c=c==Ap?dc:c,l=l==Ap?dc:l;var u=c==dc,f=l==dc,h=c==l;if(h&&wu(t)){if(!wu(e))return!1;a=!0,u=!1}if(h&&!u)return o||(o=new mu),a||yp(t)?ap(t,e,r,n,i,o):C_(t,e,c,r,n,i,o);if(!(r&gS)){var p=u&&kp.call(t,"__wrapped__"),b=f&&kp.call(e,"__wrapped__");if(p||b){var y=p?t.value():t,w=b?e.value():e;return o||(o=new mu),i(y,w,r,n,o)}}return h?(o||(o=new mu),iS(t,e,r,n,i,o)):!1}const wS=vS;function Ip(t,e,r,n,i){return t===e?!0:t==null||e==null||!Na(t)&&!Na(e)?t!==t&&e!==e:wS(t,e,r,n,Ip,i)}const yS=Ip;function bS(t,e){return yS(t,e)}const _S=bS,jn="remoteHub",Cu="modes",Dp="indexMemento";class Pp{constructor(){this._onDidChange=new d.EventEmitter,this._onDidChangeAny=new d.EventEmitter,this.memoryState=new Map}static configure(e){Je.state=e.workspaceState,e.subscriptions.push(d.workspace.onDidChangeConfiguration(Je.onConfigurationChanged,Je))}get onDidChange(){return this._onDidChange.event}get onDidChangeAny(){return this._onDidChangeAny.event}onConfigurationChanged(e){if(!e.affectsConfiguration(jn)){this._onDidChangeAny.fire(e);return}this._onDidChangeAny.fire(e),this._onDidChange.fire(e)}set state(e){if(this._state=e,this.modes=this._state.get(Cu),this.modes===void 0&&(this.modes=Object.create(null)),this.memoryState.size!==0){for(const r of this.memoryState.entries())this.modes[r[0]]=r[1];this._state.update(Cu,this.modes).then(()=>{this.memoryState.clear()},void 0)}this.indexMemento=this._state.get(Dp),this.indexMemento===void 0&&(this.indexMemento=Object.create(null))}get(e,r,n){return n===void 0?d.workspace.getConfiguration(e===void 0?void 0:jn,r).get(e===void 0?jn:e):d.workspace.getConfiguration(e===void 0?void 0:jn,r).get(e===void 0?jn:e,n)}getMode(e,r,n){const i=e.toString(),o=this.modes!==void 0?this.modes[i]:void 0;if(o!==void 0)return{display:N.sanitize(o.display),index:T.sanitize(o.index)};if(this.memoryState.get(i),!n)return W.getDefault(r)}setMode(e,r){return this._state===void 0||this.modes===void 0?(this.memoryState.set(e.toString(),r),Promise.resolve()):(this.modes[e.toString()]=r,this._state.update(Cu,this.modes))}getIndexMemento(e){if(this.indexMemento!==void 0)return this.indexMemento[e.toString()]}setIndexMemento(e,r){return this.indexMemento===void 0||this._state===void 0?Promise.resolve():(this.indexMemento[e.toString()]=r,this._state.update(Dp,this.indexMemento))}getAny(e,r,n){return n===void 0?d.workspace.getConfiguration(void 0,r).get(e):d.workspace.getConfiguration(void 0,r).get(e,n)}changed(e,r,n){var i;return(i=e==null?void 0:e.affectsConfiguration(`${jn}.${r}`,n))!=null?i:!0}inspect(e,r){return d.workspace.getConfiguration(e===void 0?void 0:jn,r).inspect(e===void 0?jn:e)}inspectAny(e,r){return d.workspace.getConfiguration(void 0,r).inspect(e)}async migrate(e,r,n){const i=Je.inspect(e);if(i===void 0)return!1;let o=!1;return i.globalValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.globalValue):i.globalValue,d.ConfigurationTarget.Global),o=!0),i.workspaceValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceValue):i.workspaceValue,d.ConfigurationTarget.Workspace),o=!0),i.workspaceFolderValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceFolderValue):i.workspaceFolderValue,d.ConfigurationTarget.WorkspaceFolder),o=!0),!o&&n.fallbackValue!==void 0&&(await this.update(r,n.fallbackValue,d.ConfigurationTarget.Global),o=!0),o}async migrateIfMissing(e,r,n){const i=Je.inspect(e);if(i===void 0)return;const o=Je.inspect(r);i.globalValue!==void 0&&(o===void 0||o.globalValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.globalValue):i.globalValue,d.ConfigurationTarget.Global),i.workspaceValue!==void 0&&(o===void 0||o.workspaceValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceValue):i.workspaceValue,d.ConfigurationTarget.Workspace),i.workspaceFolderValue!==void 0&&(o===void 0||o.workspaceFolderValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceFolderValue):i.workspaceFolderValue,d.ConfigurationTarget.WorkspaceFolder)}name(e){return e}update(e,r,n){return d.workspace.getConfiguration(jn).update(e,r,n)}updateAny(e,r,n,i){return d.workspace.getConfiguration(void 0,n===d.ConfigurationTarget.Global?void 0:i).update(e,r,n)}updateEffective(e,r){const n=Je.inspect(e);return n.workspaceFolderValue!==void 0?r===n.workspaceFolderValue?Promise.resolve(void 0):Je.update(e,r,d.ConfigurationTarget.WorkspaceFolder):n.workspaceValue!==void 0?r===n.workspaceValue?Promise.resolve(void 0):Je.update(e,r,d.ConfigurationTarget.Workspace):n.globalValue===r||n.globalValue===void 0&&r===n.defaultValue?Promise.resolve(void 0):Je.update(e,_S(r,n.defaultValue)?void 0:r,d.ConfigurationTarget.Global)}getUseNewCommitApi(){let e=this.get("experimental.useNewCommitApi");return e===null&&(e=tb()),e}}const Je=new Pp,jr="";var Rt;(function(t){t.Off="off",t.Error="error",t.Warn="warn",t.Info="info",t.Debug="debug"})(Rt||(Rt={}));var Fp;(function(t){t[t.Off=0]="Off",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"})(Fp||(Fp={}));const xS="GitHub Repositories",hc="[RemoteHub]",Ki=class{static configure(t,e){this._isDebugging=t.extensionMode===d.ExtensionMode.Development,this.logLevel=e}static enabled(t){return this.level>=this.toOrderedLevel(t)}static get logLevel(){return this._logLevel}static set logLevel(t){var e,r;this._logLevel=t,this.level=this.toOrderedLevel(t),t===Rt.Off?((e=this.output)==null||e.dispose(),this.output=void 0):this.output=(r=this.output)!=null?r:d.window.createOutputChannel(xS)}static toOrderedLevel(t){switch(t){case Rt.Off:return 0;case Rt.Error:return 1;case Rt.Warn:return 2;case Rt.Info:return 3;case Rt.Debug:return 4}}static get isDebugging(){return this._isDebugging}static debug(t,...e){Ki.isDebugging&&console.log(this.timestamp,hc,t!=null?t:jr,...e),!(this.output===void 0||this.level<4)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:jr}${this.toLoggableParams(!0,e)}`)}static error(t,e,...r){if(!(this.level<1&&!Ki.isDebugging)){if(e===void 0){const n=t instanceof Error?t.stack:void 0;if(n){const i=/.*\s*?at\s(.+?)\s/.exec(n);i!==null&&(e=i[1])}}Ki.isDebugging&&console.error(this.timestamp,hc,e!=null?e:jr,...r,t),!(this.output===void 0||this.level<1)&&this.output.appendLine(`${this.timestamp} ${e!=null?e:jr}${this.toLoggableParams(!1,r)}
${String(t)}`)}}static log(t,...e){Ki.isDebugging&&console.log(this.timestamp,hc,t!=null?t:jr,...e),!(this.output===void 0||this.level<3)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:jr}${this.toLoggableParams(!1,e)}`)}static warn(t,...e){Ki.isDebugging&&console.warn(this.timestamp,hc,t!=null?t:jr,...e),!(this.output===void 0||this.level<2)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:jr}${this.toLoggableParams(!1,e)}`)}static showOutputChannel(){var t;(t=this.output)==null||t.show()}static toLoggable(t,e){if(typeof t!="object")return String(t);if(t instanceof d.Uri)return`Uri(${t.toString(!0)})`;try{return JSON.stringify(t,e)}catch{return"<error>"}}static toLoggableName(t){var e,r,n;let i;if(typeof t=="function"){if(t.prototype===void 0||t.prototype.constructor===void 0)return t.name;i=(e=t.prototype.constructor.name)!=null?e:jr}else i=(n=(r=t.constructor)==null?void 0:r.name)!=null?n:jr;const o=i.indexOf("_");return o===-1?i:i.substr(o+1)}static get timestamp(){const t=new Date;return`[${t.toISOString().replace(/T/," ").replace(/\..+/,jr)}:${`00${t.getUTCMilliseconds()}`.slice(-3)}]`}static toLoggableParams(t,e){if(e.length===0||t&&this.level<4&&!Ki.isDebugging)return jr;const r=e.map(n=>this.toLoggable(n)).join(", ");return r.length!==0?` \u2014 ${r}`:jr}};let Z=Ki;Z.level=0,Z._logLevel=Rt.Off;const Np=47;function we(t){if(t===void 0)return;const e=t.path.endsWith("/");return!e&&!t.fragment?t.toString():t.with({path:e?t.path.slice(0,-1):t.path,fragment:""}).toString()}function Vn(t){if(t===void 0)return;const e=t.path.endsWith("/");return!e&&!t.query&&!t.fragment?t.toString():t.with({path:e?t.path.slice(0,-1):t.path,query:"",fragment:""}).toString()}function Eu(t,e){return`${(e==null?void 0:e.excludeScheme)?"":`${t.scheme}-`}${t.authority}${t.path.endsWith("/")?t.path.slice(0,-1):t.path}`}function Or(t){const e=t.path;let r=0,n=-1,i=!0;for(let o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===Np){if(!i){r=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":e.slice(r,n)}function iD(t){const e=t.path;if(e.length===1)return"/";let r,n=-1,i=!0;for(let o=e.length-1;o>=1;--o)if(r=e.charCodeAt(o),r===Np){if(!i){n=o;break}}else i=!1;return n===-1?"/":e.slice(0,n)}function SS(t){const e=t.path.lastIndexOf("/");return e===-1?t.with({path:"/"}):t.with({path:t.path.substring(0,e)})}function Ma(t,e){const r=typeof e=="string"?e:e.path;return r.startsWith(t.path)?d.Uri.joinPath(t,r.substr(t.path.length)):d.Uri.joinPath(t,r)}function fc(t,e){return typeof e=="string"?(e.startsWith("/")||(e=`/${e}`),Gn(t,e)&&t.path.substr(e.length+(e.endsWith("/")?0:1)).split("/").length===1):Gn(t,e)&&t.path.substr(e.path.length+(e.path.endsWith("/")?0:1)).split("/").length===1}function Gn(t,e){return typeof e=="string"?(e.startsWith("/")||(e=`/${e}`),e.length===1||t.path.startsWith(e.endsWith("/")?e:`${e}/`)):e.scheme===t.scheme&&e.authority===t.authority&&(e.path.length===1||t.path.startsWith(e.path.endsWith("/")?e.path:`${e.path}/`))}function pc(t){return t&&typeof t=="object"&&"scheme"in t}const Ru=class{constructor(t){this.storageService=t,this._onDidChange=new d.EventEmitter,this.cache=new Map}get onDidChange(){return this._onDidChange.event}async delete(t){const e=we(t),r=this.cache.has(e);this.cache.delete(e);try{await this.storageService.delete(this.getStorageKey(e))}catch(n){throw Z.error(n,`Failed to delete repository metadata for ${e}`),n}!r||setTimeout(()=>this._onDidChange.fire({uri:t}),0)}async get(t){this.assertMatchingScheme(t);const e=we(t),r=this.cache.get(e);if(r!==void 0)return r;let n;try{n=this.fromStorage(await this.storageService.get(this.getStorageKey(e)))}catch(i){throw Z.error(i,`Failed to get repository metadata for ${e}`),i}return n?this.cache.set(e,{revision:n}):this.cache.delete(e),{revision:n}}async set(t,e,r,n){this.assertMatchingScheme(t);const i=(await this.get(t)).revision!==e?"revision":void 0,o=we(t);if(r!==void 0&&!this.validate(r))throw new Error(`Metadata validation failed for ${t.toString()}`);const a={revision:e,cachedMetadata:r};this.cache.set(o,a);try{await this.storageService.store(this.getStorageKey(o),this.toStorage(e))}catch(s){throw this.cache.delete(o),Z.error(s,`Failed to save repository metadata for ${o}`),s}(n==null?void 0:n.silent)||setTimeout(()=>this._onDidChange.fire({uri:t,reason:i}),0)}refresh(){this.cache.clear()}validate(t){var e,r,n,i,o,a,s,c;return typeof t.version=="number"&&t.version>=Ru.schemaVersion&&typeof t.timestamp=="number"&&typeof((e=t.provider)==null?void 0:e.id)=="string"&&typeof t.provider.name=="string"&&typeof t.name=="string"&&t.repo&&typeof t.user=="string"&&typeof t.accessLevel=="number"&&typeof((r=t.HEAD)==null?void 0:r.type)=="number"&&typeof((n=t.HEAD)==null?void 0:n.name)=="string"&&typeof((i=t.HEAD)==null?void 0:i.sha)=="string"&&(typeof((o=t.HEAD.detached)==null?void 0:o.name)=="string"&&typeof((a=t.HEAD.detached)==null?void 0:a.type)=="number"||typeof((s=t.HEAD.branch)==null?void 0:s.name)=="string")&&typeof((c=t.defaultBranch)==null?void 0:c.name)=="string"&&typeof t.defaultBranch.sha=="string"}assertMatchingScheme(t){if(t.scheme!==Pt.scheme)throw new Error(`Uri scheme '${t.scheme}' must match configured scheme '${Pt.scheme}'; uri=${t.toString()}`)}getStorageKey(t){return`metadata/${t}`}fromStorage(t){if(!t)return;const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&pc(n)?d.Uri.from(n):n);return e==null?void 0:e.revision}toStorage(t){const e={schemaVersion:Ru.storageSchemaVersion,revision:t};return JSON.stringify(e)}};let Ba=Ru;Ba.schemaVersion=6,Ba.storageSchemaVersion=1;var $t;(function(t){t[t.Admin=100]="Admin",t[t.Maintain=40]="Maintain",t[t.WriteToPullRequest=31]="WriteToPullRequest",t[t.Write=30]="Write",t[t.Triage=20]="Triage",t[t.Read=10]="Read",t[t.None=0]="None"})($t||($t={}));var Le;(function(t){t[t.Branch=0]="Branch",t[t.RemoteBranch=1]="RemoteBranch",t[t.Tag=2]="Tag",t[t.Commit=3]="Commit"})(Le||(Le={}));class _n extends Error{constructor(e,r){super(typeof e=="string"?e:e.message);this.reauthenticate=r;var n;this.original=typeof e!="string"?e:void 0,(n=Error.captureStackTrace)==null||n.call(Error,this,_n)}}class gc extends Error{constructor(e,r,n){super(e.message);this.original=e,this.name=r,this.id=n;var i;(i=Error.captureStackTrace)==null||i.call(Error,this,gc)}}class Oa extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,Oa)}}class Ua extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,Ua)}}class mc extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,mc)}}class Zi extends Error{constructor(e){super(e);var r;(r=Error.captureStackTrace)==null||r.call(Error,this,Zi)}}class La extends Error{constructor(e,r){super(e.message);this.original=e,this.duplicate=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,La)}}class Ha extends Error{constructor(e){super(e.message);this.original=e;var r;(r=Error.captureStackTrace)==null||r.call(Error,this,Ha)}}class $o extends Error{constructor(e){super(e);var r;(r=Error.captureStackTrace)==null||r.call(Error,this,$o)}}class Xi extends Error{constructor(e=!1){super(e?"Unable to sync the repository":"Unable to fetch the repository");var r;(r=Error.captureStackTrace)==null||r.call(Error,this,Xi)}}class qa extends Error{constructor(){super("Sync operation will result in conflicts");var e;(e=Error.captureStackTrace)==null||e.call(Error,this,qa)}}class vc extends Error{constructor(){super("Failed to create and push commit");var e;(e=Error.captureStackTrace)==null||e.call(Error,this,vc)}}class wi extends Error{constructor(e){var r;const n=typeof e=="string"?e:Pt.getProviderId(e);super(`No provider registered with ${n}`);this.id=n,(r=Error.captureStackTrace)==null||r.call(Error,this,wi)}}const CS=/^[0-9a-f]{40}$/i;function yi(t){return t!==void 0&&CS.test(t)}const ES=/^[^/](?!.*\/\.)(?!.*\.\.)(?!.*\/\/)(?!.*@\{)[^\000-\037\177 ~^:?*[\\]+[^./]$/;function RS(t){return ES.test(t)}function fr(t){return t===""||t==="~"||t==="HEAD"?t:t.endsWith("^")?`${t.substr(0,7)}^`:t.substr(0,7)}var Ue;(function(t){t[t.Branch=0]="Branch",t[t.Tag=1]="Tag",t[t.Commit=2]="Commit",t[t.PullRequest=3]="PullRequest",t[t.Tree=4]="Tree"})(Ue||(Ue={}));var Ur;(function(t){t.GitHub="github",t.AzureRepos="azurerepos"})(Ur||(Ur={}));class AS{constructor(e,r,n,i,o){this.providerService=e,this.uri=r,this.id=n,this.name=i,this.provider={id:o.id,name:o.name}}get canonicalUri(){return this.providerService.getVirtualCanonicalRootUri(this.uri)}createRelativeUri(e){return this.providerService.createRelativeUri(this.uri,e)}async getMetadata(){const e=await this.providerService.getMetadata(this.uri);if(!e)throw new Error(`Unable to find metadata for ${this.uri.toString()}`);return e}async getIndexMetadata(){return this.providerService.getIndexMetadata(this.uri)}getUriMetadata(){return this.providerService.getVirtualUriMetadata(this.uri)}}var Vr;(function(t){t[t.Repository=0]="Repository",t[t.PullRequest=1]="PullRequest",t[t.Branch=2]="Branch",t[t.Commit=3]="Commit",t[t.File=4]="File"})(Vr||(Vr={}));var Gr;(function(t){t[t.Clone=-1]="Clone",t[t.Repository=0]="Repository",t[t.PullRequest=1]="PullRequest",t[t.Branch=2]="Branch",t[t.Commit=3]="Commit",t[t.Tag=4]="Tag"})(Gr||(Gr={}));var bi;(function(t){t[t.Open=0]="Open",t[t.Closed=1]="Closed",t[t.Merged=2]="Merged"})(bi||(bi={}));var vt;(function(t){t[t.NotIndexed=0]="NotIndexed",t[t.Indexed=1]="Indexed",t[t.Match=2]="Match",t[t.Active=3]="Active"})(vt||(vt={})),function(t){function e(r){return r!==void 0&&(r===t.Indexed||r===t.Match||r===t.Active)}t.hasIndex=e}(vt||(vt={}));var wc;(function(t){function e(r){return r!==void 0&&r.type===3}t.isActive=e})(wc||(wc={}));var Kr;(function(t){t[t.Latest=1]="Latest",t[t.SHA=2]="SHA"})(Kr||(Kr={}));var Qi;(function(t){function e(r){const n=Pt.decodeAuthority(r).metadata;if(!(n===void 0||n.idx===void 0)){if(n.idx==="latest")return{type:1};if(yi(n.idx))return{type:2,sha:n.idx}}}t.decode=e})(Qi||(Qi={}));function*$p(t,e){for(const r of t)yield*e(r)}function*TS(t,e){for(const r of t)e(r)&&(yield r)}function*yc(t,e){for(const r of t){const n=e(r);n!=null&&(yield n)}}function kS(t,e){for(const r of t)if(e(r))return r}function IS(t,e){let r="";const n=t[Symbol.iterator]();let i=n.next();if(i.done)return r;for(;;){const o=i.value.toString();if(i=n.next(),i.done){r+=o;break}r+=o,r+=e}return r}function*Wa(t,e){for(const r of t)yield e(r)}function oD(t,e){for(const r of t)if(e(r))return!0;return!1}function*DS(...t){for(const e of t)for(const r of e)yield r}function*PS(t){const e=new Set;for(const r of t)e.has(r)||(e.add(r),yield r)}const FS="";function NS(...t){if(t.length===1){const e=t[0];return e===void 0?FS:typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"||e instanceof Error?String(e):e instanceof d.Uri?e.toString():JSON.stringify(e)}return JSON.stringify(t)}function xn(t){return(e,r,n)=>{let i;if(typeof n.value=="function"?i=n.value:typeof n.get=="function"&&(i=n.get),i===void 0)throw new Error("Not supported");const o=`$serialize$${r}`;n.value=function(...a){const s=a.length===0?o:`${o}$${(t!=null?t:NS)(...a)}`;Object.prototype.hasOwnProperty.call(this,s)||Object.defineProperty(this,s,{configurable:!1,enumerable:!1,writable:!0,value:void 0});let c=this[s];const l=()=>i.apply(this,a);return c===void 0?c=l():c=c.then(l,l),this[s]=c,c}}}function za(t){const e=performance.now()*.001;let r=Math.floor(e),n=Math.floor(e%1*1e9);return t!==void 0&&(r=r-t[0],n=n-t[1],n<0&&(r--,n+=1e9)),[r,n]}let Au=0;function $S(){return Au===Number.MAX_SAFE_INTEGER&&(Au=0),++Au}const Yi=class{constructor(t,e,...r){this.context=t,this.instance=`[${$S().toString().padStart(5)}] `;var n,i,o,a,s,c;let l;if(typeof(e==null?void 0:e.log)=="boolean"?l=e.log?{}:void 0:l=(n=e==null?void 0:e.log)!=null?n:{},this.logLevel=(i=e==null?void 0:e.logLevel)!=null?i:Rt.Info,this.time=za(),l){if(!Z.enabled(this.logLevel))return;r.length?bc(this.logLevel,`${this.instance}${(o=l.prefix)!=null?o:""}${t}${(a=l.message)!=null?a:""}`,...r):bc(this.logLevel,`${this.instance}${(s=l.prefix)!=null?s:""}${t}${(c=l.message)!=null?c:""}`)}}log(t){this.logCore(this.context,t,!1)}logStep(t,e){(!t||e)&&this.logCore(this.context,e,!1),this.step=t?{time:za(),label:t}:void 0}restart(t){this.logCore(this.context,t,!0),this.step=void 0,this.time=za()}stop(t){this.restart(t)}logCore(t,e,r){var n,i,o,a,s,c,l;if(!Z.enabled(this.logLevel))return;let u="";if(this.step){const[b,y]=za(this.step.time),w=b*1e3+Math.floor(y/1e6);u=`${this.step.label?`${this.step.label} took `:""}${w} ms`}if(!r){bc(this.logLevel,`${this.instance}${(n=e==null?void 0:e.prefix)!=null?n:""}${t}${(i=e==null?void 0:e.message)!=null?i:""}${u?` ${u}`:""}${(o=e==null?void 0:e.suffix)!=null?o:""}`);return}const[f,h]=za(this.time),p=f*1e3+Math.floor(h/1e6);bc(p>500?Rt.Warn:this.logLevel,`${this.instance}${(a=e==null?void 0:e.prefix)!=null?a:""}${t}${(s=e==null?void 0:e.message)!=null?s:""}${(c=e==null?void 0:e.took)!=null?c:" took "}${p} ms${u?` (${u})`:""}${(l=e==null?void 0:e.suffix)!=null?l:""}`)}static start(t,e,...r){var n;(n=Yi.watches.get(t))==null||n.log(),Yi.watches.set(t,new Yi(t,e,...r))}static log(t,e){var r;(r=Yi.watches.get(t))==null||r.log(e)}static stop(t,e){var r;(r=Yi.watches.get(t))==null||r.stop(e),Yi.watches.delete(t)}};let $e=Yi;$e.watches=new Map;function bc(t,e,...r){switch(t){case Rt.Warn:Z.warn(e,...r);break;case Rt.Info:Z.log(e,...r);break;default:Z.debug(e,...r);break}}const MS=new TextDecoder,BS=new TextEncoder;async function ja(t){const e=typeof t=="string"?BS.encode(t):t;let r;if(globalThis.crypto.subtle)r=await globalThis.crypto.subtle.digest({name:"sha-1"},e);else{const n=new Up;n.update(e),r=n.digest()}return globalThis.btoa(encodeURIComponent(MS.decode(r)))}var Mp;(function(t){t[t.BLOCK_SIZE=64]="BLOCK_SIZE"})(Mp||(Mp={}));function Tu(t,e,r=32){const n=r-e,i=~((1<<n)-1);return(t<<e|(i&t)>>>n)>>>0}function Bp(t,e=0,r=t.byteLength,n=0){for(let i=0;i<r;i++)t[e+i]=n}const Op=class{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(64+3),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._finished=!1}update(t){const e=this._buff;let r=this._buffLen,n=0;const i=t.byteLength;for(;n<i;){const o=Math.min(64-r,i-n);for(let a=0;a<o;a++)e[r++]=t[n++];r>=64&&(this._step(),r-=64,this._totalLen+=64)}this._buffLen=r}digest(){this._finished||(this._finished=!0,this._totalLen+=this._buffLen,this._wrapUp());const t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this._h0,!1),e.setUint32(4,this._h1,!1),e.setUint32(8,this._h2,!1),e.setUint32(12,this._h3,!1),e.setUint32(16,this._h4,!1),t}_wrapUp(){this._buff[this._buffLen++]=128,Bp(this._buff,this._buffLen),this._buffLen>56&&(this._step(),Bp(this._buff));const t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){const t=Op._bigBlock32,e=this._buffDV;for(let u=0;u<64;u+=4)t.setUint32(u,e.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)t.setUint32(u,Tu(t.getUint32(u-12,!1)^t.getUint32(u-32,!1)^t.getUint32(u-56,!1)^t.getUint32(u-64,!1),1),!1);let r=this._h0,n=this._h1,i=this._h2,o=this._h3,a=this._h4,s,c,l;for(let u=0;u<80;u++)u<20?(s=n&i|~n&o,c=1518500249):u<40?(s=n^i^o,c=1859775393):u<60?(s=n&i|n&o|i&o,c=2400959708):(s=n^i^o,c=3395469782),l=Tu(r,5)+s+a+c+t.getUint32(u*4,!1)&4294967295,a=o,o=i,i=Tu(n,30),n=r,r=l;this._h0=this._h0+r&4294967295,this._h1=this._h1+n&4294967295,this._h2=this._h2+i&4294967295,this._h3=this._h3+o&4294967295,this._h4=this._h4+a&4294967295}};let Up=Op;Up._bigBlock32=new DataView(new ArrayBuffer(320));function OS(t){const e=globalThis.atob(t),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.charCodeAt(i);return n}const{fromCharCode:US}=String;function _c(t){let e;if(typeof t=="string")e=t;else{e="";for(let r=0,{length:n}=t;r<n;r++)e+=US(t[r])}return globalThis.btoa(e)}const LS=new TextDecoder,HS=new TextEncoder,qS=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function ku(t){const e=HS.encode(t),r=new Array(e.length);for(let n=0;n<e.length;++n)r[n]=qS[e[n]];return r.join("")}function Lp(t){const e=t.match(/(\w{2})/g);if(e===null)return"";const r=new Uint8Array(e.map(n=>parseInt(n,16)));return LS.decode(r)}function WS(t,e){if(t===e)return-1;let r=0;for(;t[r]===e[r];)r++;return r}var aD=__webpack_require__(5102),zS=Object.defineProperty,jS=Object.getOwnPropertyDescriptor,VS=(t,e,r,n)=>{for(var i=n>1?void 0:n?jS(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&zS(e,r,i),i},Zr;(function(t){t[t.Abort=0]="Abort",t[t.KeepCurrent=1]="KeepCurrent",t[t.DiscardCurrent=2]="DiscardCurrent",t[t.Merge=3]="Merge"})(Zr||(Zr={}));const rr=class{constructor(t,e){this.metadataStore=t,this.telemetryService=e,this._providers=new Map,this._onDidChangeProviders=new d.EventEmitter,this._repositories=new Map,this._onDidChangeRepositories=new d.EventEmitter,this._onDidChangeRepository=new d.EventEmitter,this._onDidSyncRepository=new d.EventEmitter,this._onDidRefresh=new d.EventEmitter,this._onWillRefresh=new d.EventEmitter,this.pendingMetadataRequests=new Map,this.disposable=d.Disposable.from(d.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this),t.onDidChange(r=>this.onMetadataChanged(r)))}get onDidChangeProviders(){return this._onDidChangeProviders.event}get onDidChangeRepositories(){return this._onDidChangeRepositories.event}get onDidChangeRepository(){return this._onDidChangeRepository.event}get onDidSyncRepository(){return this._onDidSyncRepository.event}get onDidRefresh(){return this._onDidRefresh.event}get onWillRefresh(){return this._onWillRefresh.event}dispose(){this.disposable.dispose(),this._providers.clear(),this._repositories.clear()}onMetadataChanged(t){const e=this._repositories.get(we(t.uri));!e||(Z.log(`VirtualProviderService.onMetadataChanged(${t.uri.toString()}, reason=${t.reason}): Firing onDidChangeRepository...`),this._onDidChangeRepository.fire({repository:e,reason:t.reason==="revision"?"HEAD":void 0}))}onWorkspaceFoldersChanged(t){if(t.added.length)for(const e of t.added){const r=we(e.uri);if(e.uri.scheme!==rr.scheme||this._repositories.has(r))continue;const n=this.getProvider(e.uri);if(!n)continue;this._repositories.set(r,null);const{repo:i,name:o}=this.getVirtualUriMetadata(e.uri),a=new AS(this,e.uri,i,o,n);this._repositories.set(r,a),this._onDidChangeRepositories.fire({added:[a],removed:[]}),this.telemetryService.sendEvent("repository.opened",{provider:n.id,repositories:this._repositories.size.toString()})}if(t.removed.length)for(const e of t.removed){const r=we(e.uri);if(e.uri.scheme!==rr.scheme||!this._repositories.has(r))continue;const n=this._repositories.get(r);this._repositories.delete(r),n&&(this._onDidChangeRepositories.fire({added:[],removed:[n]}),this.telemetryService.sendEvent("repository.closed",{repositories:this._repositories.size.toString()}))}Di(ci.HasVirtualFolders,this._repositories.size!==0),Di(ci.VirtualFolderProviders,IS(PS(Wa(this.getRepositories(),e=>e.provider.id)),","))}get hasProviders(){return this._providers.size!==0}get registeredProviders(){return[...Wa(this._providers.values(),t=>({id:t.id,name:t.name}))]}get repositories(){return[...this.getRepositories()]}register(t,e,r,n,i){var o;if(this._providers.has(t))throw new Error(`Provider '${t}' has already been registered`);const a={id:t,name:e,provider:r,fs:n,index:i};return this._providers.set(t,a),this._onDidChangeProviders.fire({added:[a],removed:[]}),this.telemetryService.sendEvent("provider.registered",{provider:t}),this.onWorkspaceFoldersChanged({added:(o=d.workspace.workspaceFolders)!=null?o:[],removed:[]}),{dispose:()=>{this._providers.delete(t);const s=[];for(const[c,l]of[...this._repositories])(l==null?void 0:l.provider.id)===t&&(this._repositories.delete(c),s.push(l));this._onDidChangeRepositories.fire({added:[],removed:s}),this._onDidChangeProviders.fire({added:[],removed:[a]})}}}refresh(){if(this._providers.size===0)return;const t=[],e=[];for(const r of this._providers.values())t.push(...Wa(this.getRepositories(r.id),n=>n.uri)),r.index!==void 0&&e.push(r.index);this._onWillRefresh.fire(t),this.metadataStore.refresh(),e.forEach(r=>r.refresh(t)),this._onDidRefresh.fire(t)}getRegisteredProvider(t){const e=this.getProvider(t);return e?{id:e.id,name:e.name}:void 0}getRepository(t,e){const r=d.workspace.getWorkspaceFolder(t);if(!r||r.uri.scheme!==rr.scheme)return;const n=this._repositories.get(we(r.uri));if(!(e!==void 0&&(n==null?void 0:n.provider.id)!==e))return n!=null?n:void 0}getRepositories(t){return TS(this._repositories.values(),e=>e!==null&&(!t||e.provider.id===t))}getOpenUris(t,e){const r=new Map,n=d.workspace.textDocuments;if(n.length===0)return r;for(const i of n)i.uri.scheme===t&&e.some(o=>Gn(i.uri,o))&&r.set(we(i.uri),i.uri);return r}hasProvider(t,e){const r=typeof t=="string"?t:rr.getProviderId(t),n=this._providers.get(r);return e!==void 0&&(n==null?void 0:n.id)!==e?!1:n!==void 0}isReadonly(t){var e;return Boolean((e=this.getProvider(t))==null?void 0:e.provider.isReadonly)}getProvider(t){const e=typeof t=="string"?t:rr.getProviderId(t);return this._providers.get(e)}getRepositoryProvider(t){var e;const r=(e=this.getProvider(t))==null?void 0:e.provider;if(r)return r;throw new wi(t)}getFileSystemProvider(t){var e;const r=(e=this.getProvider(t))==null?void 0:e.fs;if(r)return r;throw new wi(t)}getRemoteWorkspaceSourceProviders(t){var e,r,n,i;return t?(i=(n=(e=this.getProvider(t))==null?void 0:(r=e.provider).getRemoteWorkspaceSourceProviders)==null?void 0:n.call(r))!=null?i:[]:[...$p(this._providers.values(),o=>{var a,s,c;return(c=(s=(a=o.provider).getRemoteWorkspaceSourceProviders)==null?void 0:s.call(a))!=null?c:[]})]}isInWorkspace(t){return this.getVirtualWorkspaceUri(t)!==void 0}getAuthentication(t){const e=this.getProvider(t);if(!e)throw new wi(t);return e==null?void 0:e.provider.getAuthentication(t)}canOpenRemoteUrl(t,e){if(e){const r=this.getProvider(e),n=r==null?void 0:r.provider.canOpenRemoteUrl(t);return n!==void 0?{provider:r,urlType:n}:void 0}for(const r of this._providers.values()){const n=r.provider.canOpenRemoteUrl(t);if(n!==void 0)return{provider:r,urlType:n}}}async createWorkspaceForRemoteUrl(t,e,r=Tt.CurrentWindow){var n;const i=this.canOpenRemoteUrl(t,e);return(n=i==null?void 0:i.provider)==null?void 0:n.provider.createWorkspaceForRemoteUrl(t,r)}createProviderUri(t,e,r){return this.getProviderUri(this.getRepositoryProvider(t).createVirtualUri(rr.baseVirtualWorkspaceUri,e,r))}createRelativeProviderUri(t,e){return this.getProviderUri(this.createRelativeUri(t,e))}createRelativeUri(t,e){const r=this.getProviderRootUri(t);let n=`${r.path}/`;n.endsWith("/")&&(n=n.slice(0,-1));const i=r.with({path:`${r.path}/${e.startsWith("/")?e.substr(1):e}`});return t.scheme===rr.scheme?this.getVirtualUri(i):i}createRelativeVirtualUri(t,e){return this.getVirtualUri(this.createRelativeUri(t,e))}createVirtualUri(t,e,r){return this.getRepositoryProvider(t).createVirtualUri(rr.baseVirtualWorkspaceUri,e,r)}async getBestRemoteUri(t,e){const{provider:r,repo:n,ref:i}=this.getVirtualUriMetadata(t);if(e===Gr.Repository)return this.getRemoteUri(r.id,{repo:n});if(e===Gr.Clone)return this.getRemoteUri(r.id,{repo:n,clone:!0});if(e===Gr.PullRequest||e===void 0&&(i==null?void 0:i.type)===Ue.PullRequest){if((i==null?void 0:i.type)===Ue.PullRequest)return this.getRemoteUri(r.id,{repo:n,pullRequest:{id:i.id}});const{pullRequest:o}=await this.getMetadata(t);if(e===Gr.PullRequest&&o)return this.getRemoteUri(r.id,{repo:n,pullRequest:{id:o.id}})}if(e===Gr.Branch||e===void 0&&(i==null?void 0:i.type)===Ue.Branch){if((i==null?void 0:i.type)===Ue.Branch)return this.getRemoteUri(r.id,{repo:n,branch:i.id});const{HEAD:o}=await this.getMetadata(t);if(o.type===Le.Branch||o.type===Le.RemoteBranch&&e===Gr.Branch)return this.getRemoteUri(r.id,{repo:n,branch:o.branch.name})}if(e===Gr.Tag||e===void 0&&(i==null?void 0:i.type)===Ue.Tag){if((i==null?void 0:i.type)===Ue.Tag)return this.getRemoteUri(r.id,{repo:n,tag:i.id});const{HEAD:o}=await this.getMetadata(t);if(o.type===Le.Tag)return this.getRemoteUri(r.id,{repo:n,tag:o.detached.name})}if(e===Gr.Commit||e===void 0&&((i==null?void 0:i.type)===Ue.Commit||(i==null?void 0:i.type)===Ue.Tree&&yi(i.id))){if((i==null?void 0:i.type)===Ue.Commit||(i==null?void 0:i.type)===Ue.Tree&&yi(i.id))return this.getRemoteUri(r.id,{repo:n,sha:i.id});const{HEAD:o}=await this.getMetadata(t);if(e===Gr.Commit||o.type===Le.Commit)return this.getRemoteUri(r.id,{repo:n,sha:o.sha})}if(e===void 0)return this.getRemoteUri(r.id,{repo:n})}getCanonicalUri(t){let{authority:e}=t;const r=e.indexOf(rr.authoritySeparator);return r!==-1&&(e=e.substr(0,r)),t.with({authority:e})}getRemoteUri(t,e){var r,n;return(n=(r=this.getRepositoryProvider(t)).getRemoteUri)==null?void 0:n.call(r,e)}getProviderUri(t){return t.scheme!==rr.scheme?t:t.with({scheme:rr.getProviderId(t)})}getProviderRootUri(t){return t=this.getProviderUri(t),this.getRepositoryProvider(t).getProviderRootUri(t)}getRelativeFilePath(t,e){return e=this.getProviderUri(e!=null?e:t),this.getRepositoryProvider(e).getRelativeFilePath(t,e)}getVirtualUriMetadata(t){return this.getRepositoryProvider(t).getVirtualUriMetadata(t)}getVirtualUri(t){return t.scheme===rr.scheme?t:t.with({scheme:rr.scheme})}getVirtualCanonicalRootUri(t){const e=this.getVirtualUri(this.getProviderRootUri(t));let{authority:r}=e;const n=r.indexOf(rr.authoritySeparator);return n!==-1&&(r=r.substr(0,n)),e.with({authority:r})}getVirtualRootUri(t){return this.getVirtualUri(this.getProviderRootUri(t))}getVirtualWorkspaceUri(t){var e;return(e=d.workspace.getWorkspaceFolder(this.getVirtualUri(t)))==null?void 0:e.uri}createIGitRepository(t,e,r,n){var i,o;return(o=(i=this.getRepositoryProvider(t)).createIGitRepository)==null?void 0:o.call(i,t,e,r,n)}async getCommitOperations(t,e,r){let n;return(r==null?void 0:r.staged)?(n=await e.getStagedChanges(t),n.length===0&&r.staged==="auto"&&(n=await e.getChanges(t))):n=await e.getChanges(t),n.map(o=>{const a=this.getRelativeFilePath(t,o.uri);switch(o.type){case rt.Created:return{type:o.type,path:a,fileType:o.fileType,content:e.readFile(o.uri).then(s=>s!=null?s:new Uint8Array)};case rt.Changed:return{type:o.type,path:a,fileType:o.fileType,content:e.readFile(o.uri).then(s=>s!=null?s:new Uint8Array)};case rt.Deleted:return{type:o.type,path:a,fileType:o.fileType,content:void 0}}})}async getMetadata(t){return{...await this.getMetadataCore(this.getVirtualRootUri(t)),path:this.getRelativeFilePath(t,t)}}async getIndexMetadata(t){const e=this.getProvider(t);return(e==null?void 0:e.index)?e.index.getIndexMetadata(t):void 0}getModeConfig(t,e,r){return Je.getMode(this.getVirtualRootUri(t),e,Boolean(r))}async getModeRefType(t,e){return t=this.getVirtualRootUri(t),this.getRepositoryProvider(t).getModeRefType(t,e)}getIndexProvider(t){var e;return(e=this.getProvider(t))==null?void 0:e.index}async getMetadataCore(t){const e=we(t);let r=this.pendingMetadataRequests.get(e);if(r)return r;let{revision:n,cachedMetadata:i}=await this.metadataStore.get(t);if(i!==void 0)return i;const o=this.getProvider(t);if(!o)throw new wi(t);const a=Qi.decode(t);(a==null?void 0:a.type)===Kr.SHA&&(n=a.sha),r=o.provider.createMetadata(t,n),this.pendingMetadataRequests.set(e,r);try{const s=await r;return await this.updateMetadataCore(t,s,{silent:!0}),s}finally{this.pendingMetadataRequests.delete(e)}}async updateMetadata(t,e){const r=new $e(`VirtualProviderService.updateMetadata(${t.toString()})`,{},e.HEAD.sha);try{await this.metadataStore.set(this.getVirtualUri(t),e.HEAD.sha,e)}finally{r.stop()}}updateMetadataCore(t,e,r){return this.metadataStore.set(this.getVirtualUri(t),e.HEAD.sha,e,r)}async clone(t){const e=await this.getBestRemoteUri(t,Gr.Clone);if(!e)throw new Error("No url found for clone");if(si)return void d.env.openExternal(d.Uri.parse(`${d.env.uriScheme}://vscode.git/clone?url=${encodeURIComponent(e.toString(!0))}`));try{const r=d.extensions.getExtension("vscode.git");if(r)await(r==null?void 0:r.activate()),await d.commands.executeCommand("git.clone",e.toString(!0));else throw new Error("Git extension not found")}catch(r){Z.error(r,"Unable to clone repository")}}createBranch(t,e,r,n){return this.getRepositoryProvider(t).createBranch(t,e,r,n)}createCommit(t,e,r,n){return this.getRepositoryProvider(t).createCommit(t,e,r,n)}createAndPushCommit(t,e,r,n,i){return this.getRepositoryProvider(t).createAndPushCommit(t,e,r,n,i)}createPullRequest(t,e,r,n,i){return this.getRepositoryProvider(t).createPullRequest(t,e,r,n,i)}fetch(t,e){return this.getRepositoryProvider(t).fetch(t,e)}fork(t){return this.getRepositoryProvider(t).fork(t)}getBranches(t,e){return this.getRepositoryProvider(t).getBranches(t,e)}getCommit(t,e){return this.getRepositoryProvider(t).getCommit(t,e)}getCommits(t,e){var r;return(r=this.getRepositoryProvider(t))==null?void 0:r.getCommits(t,e)}compareCommits(t,e){var r;return(r=this.getRepositoryProvider(t))==null?void 0:r.compareCommits(t,e)}getFileContent(t,e,r){return this.getRepositoryProvider(t).getFileContent(t,e,r)}getFork(t){return this.getRepositoryProvider(t).getFork(t)}async getIncomingChanges(t){var e,r,n;return(n=(r=(e=this.getRepositoryProvider(t)).getIncomingChanges)==null?void 0:r.call(e,t))!=null?n:[]}getPullRequest(t,e){return this.getRepositoryProvider(t).getPullRequest(t,e)}getTags(t,e){return this.getRepositoryProvider(t).getTags(t,e)}getSnapshots(t,e){var r,n;return(n=(r=this.getIndexProvider(t))==null?void 0:r.getSnapshots(t,e))!=null?n:Promise.resolve([])}async getTarGz(t){var e,r;return(r=(e=this.getRepositoryProvider(t)).getTarGz)==null?void 0:r.call(e,t)}pushCommit(t,e,r,n){return this.getRepositoryProvider(t).pushCommit(t,e,r,n)}switchTo(t,e,r){return this.getRepositoryProvider(t).switchTo(t,e,r)}async sync(t,e,r){const n=this._repositories.get(we(t));n&&this._onDidSyncRepository.fire({repository:n,syncing:!0});try{const i=this.getProvider(t);if(i===void 0)throw new wi(t);let{to:o,reason:a,...s}=r!=null?r:{};return o===void 0&&i.index&&(o=await i.index.resolveIndexRef(t,a==="user")),await i.provider.sync(t,e,{conflictResolution:0,...s,to:o})}finally{n&&this._onDidSyncRepository.fire({repository:n,syncing:!1})}}stat(t){return this.getFileSystemProvider(t).stat(t)}readDirectory(t){return this.getFileSystemProvider(t).readDirectory(t)}readFile(t){return this.getFileSystemProvider(t).readFile(t)}watch(t,e){return this.getFileSystemProvider(t).watch(t,e)}provideFileSearchResults(t,e,r){return this.getFileSystemProvider(e.folder).provideFileSearchResults(t,e,r)}provideTextSearchResults(t,e,r,n){return this.getFileSystemProvider(e.folder).provideTextSearchResults(t,e,r,n)}static decodeAuthority(t,e){const[r,n]=t.authority.split(rr.authoritySeparator);let i;if(n)try{const o=JSON.parse(Lp(n));i=e?e(o):o}catch{}return{scheme:r,metadata:i}}static encodeAuthority(t,e){const r=e?`${rr.authoritySeparator}${ku(JSON.stringify(e))}`:"";return`${t}${r}`}static getProviderId(t){const{authority:e}=t,r=e.indexOf(rr.authoritySeparator);return r!==-1?e.substr(0,r):e}static isCanonicalUri(t){return t.authority.indexOf(rr.authoritySeparator)===-1}};let Pt=rr;Pt.scheme="vscode-vfs",Pt.authoritySeparator="+",Pt.baseVirtualWorkspaceUri=d.Uri.parse(`${rr.scheme}://`),VS([xn()],Pt.prototype,"getMetadataCore",1);function Kn(){}Kn.prototype={diff:function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n.callback;typeof n=="function"&&(i=n,n={}),this.options=n;var o=this;function a(y){return i?(setTimeout(function(){i(void 0,y)},0),!0):y}e=this.castInput(e),r=this.castInput(r),e=this.removeEmpty(this.tokenize(e)),r=this.removeEmpty(this.tokenize(r));var s=r.length,c=e.length,l=1,u=s+c,f=[{newPos:-1,components:[]}],h=this.extractCommon(f[0],r,e,0);if(f[0].newPos+1>=s&&h+1>=c)return a([{value:this.join(r),count:r.length}]);function p(){for(var y=-1*l;y<=l;y+=2){var w=void 0,_=f[y-1],S=f[y+1],I=(S?S.newPos:0)-y;_&&(f[y-1]=void 0);var D=_&&_.newPos+1<s,O=S&&0<=I&&I<c;if(!D&&!O){f[y]=void 0;continue}if(!D||O&&_.newPos<S.newPos?(w=KS(S),o.pushComponent(w.components,void 0,!0)):(w=_,w.newPos++,o.pushComponent(w.components,!0,void 0)),I=o.extractCommon(w,r,e,y),w.newPos+1>=s&&I+1>=c)return a(GS(o,w.components,r,e,o.useLongestToken));f[y]=w}l++}if(i)(function y(){setTimeout(function(){if(l>u)return i();p()||y()},0)})();else for(;l<=u;){var b=p();if(b)return b}},pushComponent:function(e,r,n){var i=e[e.length-1];i&&i.added===r&&i.removed===n?e[e.length-1]={count:i.count+1,added:r,removed:n}:e.push({count:1,added:r,removed:n})},extractCommon:function(e,r,n,i){for(var o=r.length,a=n.length,s=e.newPos,c=s-i,l=0;s+1<o&&c+1<a&&this.equals(r[s+1],n[c+1]);)s++,c++,l++;return l&&e.components.push({count:l}),e.newPos=s,c},equals:function(e,r){return this.options.comparator?this.options.comparator(e,r):e===r||this.options.ignoreCase&&e.toLowerCase()===r.toLowerCase()},removeEmpty:function(e){for(var r=[],n=0;n<e.length;n++)e[n]&&r.push(e[n]);return r},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function GS(t,e,r,n,i){for(var o=0,a=e.length,s=0,c=0;o<a;o++){var l=e[o];if(l.removed){if(l.value=t.join(n.slice(c,c+l.count)),c+=l.count,o&&e[o-1].added){var f=e[o-1];e[o-1]=e[o],e[o]=f}}else{if(!l.added&&i){var u=r.slice(s,s+l.count);u=u.map(function(p,b){var y=n[c+b];return y.length>p.length?y:p}),l.value=t.join(u)}else l.value=t.join(r.slice(s,s+l.count));s+=l.count,l.added||(c+=l.count)}}var h=e[a-1];return a>1&&typeof h.value=="string"&&(h.added||h.removed)&&t.equals("",h.value)&&(e[a-2].value+=h.value,e.pop()),e}function KS(t){return{newPos:t.newPos,components:t.components.slice(0)}}var ZS=new Kn;function sD(t,e,r){return ZS.diff(t,e,r)}function Hp(t,e){if(typeof t=="function")e.callback=t;else if(t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var qp=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Wp=/\S/,xc=new Kn;xc.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!Wp.test(t)&&!Wp.test(e)},xc.tokenize=function(t){for(var e=t.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),r=0;r<e.length-1;r++)!e[r+1]&&e[r+2]&&qp.test(e[r])&&qp.test(e[r+2])&&(e[r]+=e[r+2],e.splice(r+1,2),r--);return e};function cD(t,e,r){return r=Hp(r,{ignoreWhitespace:!0}),xc.diff(t,e,r)}function lD(t,e,r){return xc.diff(t,e,r)}var Sc=new Kn;Sc.tokenize=function(t){var e=[],r=t.split(/(\n|\r\n)/);r[r.length-1]||r.pop();for(var n=0;n<r.length;n++){var i=r[n];n%2&&!this.options.newlineIsToken?e[e.length-1]+=i:(this.options.ignoreWhitespace&&(i=i.trim()),e.push(i))}return e};function XS(t,e,r){return Sc.diff(t,e,r)}function uD(t,e,r){var n=Hp(r,{ignoreWhitespace:!0});return Sc.diff(t,e,n)}var zp=new Kn;zp.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};function dD(t,e,r){return zp.diff(t,e,r)}var jp=new Kn;jp.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function hD(t,e,r){return jp.diff(t,e,r)}function Cc(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cc=function(e){return typeof e}:Cc=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cc(t)}function Zn(t){return QS(t)||YS(t)||JS(t)||eC()}function QS(t){if(Array.isArray(t))return Iu(t)}function YS(t){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(t))return Array.from(t)}function JS(t,e){if(!!t){if(typeof t=="string")return Iu(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Iu(t,e)}}function Iu(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function eC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var tC=Object.prototype.toString,Mo=new Kn;Mo.useLongestToken=!0,Mo.tokenize=Sc.tokenize,Mo.castInput=function(t){var e=this.options,r=e.undefinedReplacement,n=e.stringifyReplacer,i=n===void 0?function(o,a){return typeof a=="undefined"?r:a}:n;return typeof t=="string"?t:JSON.stringify(Du(t,null,null,i),i,"  ")},Mo.equals=function(t,e){return Kn.prototype.equals.call(Mo,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function fD(t,e,r){return Mo.diff(t,e,r)}function Du(t,e,r,n,i){e=e||[],r=r||[],n&&(t=n(i,t));var o;for(o=0;o<e.length;o+=1)if(e[o]===t)return r[o];var a;if(tC.call(t)==="[object Array]"){for(e.push(t),a=new Array(t.length),r.push(a),o=0;o<t.length;o+=1)a[o]=Du(t[o],e,r,n,i);return e.pop(),r.pop(),a}if(t&&t.toJSON&&(t=t.toJSON()),Cc(t)==="object"&&t!==null){e.push(t),a={},r.push(a);var s=[],c;for(c in t)t.hasOwnProperty(c)&&s.push(c);for(s.sort(),o=0;o<s.length;o+=1)c=s[o],a[c]=Du(t[c],e,r,n,c);e.pop(),r.pop()}else a=t;return a}var Ec=new Kn;Ec.tokenize=function(t){return t.slice()},Ec.join=Ec.removeEmpty=function(t){return t};function pD(t,e,r){return Ec.diff(t,e,r)}function Va(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.split(/\r\n|[\n\v\f\r\x85]/),n=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],i=[],o=0;function a(){var l={};for(i.push(l);o<r.length;){var u=r[o];if(/^(\-\-\-|\+\+\+|@@)\s/.test(u))break;var f=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(u);f&&(l.index=f[1]),o++}for(s(l),s(l),l.hunks=[];o<r.length;){var h=r[o];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(h))break;if(/^@@/.test(h))l.hunks.push(c());else{if(h&&e.strict)throw new Error("Unknown line "+(o+1)+" "+JSON.stringify(h));o++}}}function s(l){var u=/^(---|\+\+\+)\s+(.*)$/.exec(r[o]);if(u){var f=u[1]==="---"?"old":"new",h=u[2].split("	",2),p=h[0].replace(/\\\\/g,"\\");/^".*"$/.test(p)&&(p=p.substr(1,p.length-2)),l[f+"FileName"]=p,l[f+"Header"]=(h[1]||"").trim(),o++}}function c(){var l=o,u=r[o++],f=u.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),h={oldStart:+f[1],oldLines:typeof f[2]=="undefined"?1:+f[2],newStart:+f[3],newLines:typeof f[4]=="undefined"?1:+f[4],lines:[],linedelimiters:[]};h.oldLines===0&&(h.oldStart+=1),h.newLines===0&&(h.newStart+=1);for(var p=0,b=0;o<r.length&&!(r[o].indexOf("--- ")===0&&o+2<r.length&&r[o+1].indexOf("+++ ")===0&&r[o+2].indexOf("@@")===0);o++){var y=r[o].length==0&&o!=r.length-1?" ":r[o][0];if(y==="+"||y==="-"||y===" "||y==="\\")h.lines.push(r[o]),h.linedelimiters.push(n[o]||`
`),y==="+"?p++:y==="-"?b++:y===" "&&(p++,b++);else break}if(!p&&h.newLines===1&&(h.newLines=0),!b&&h.oldLines===1&&(h.oldLines=0),e.strict){if(p!==h.newLines)throw new Error("Added line count did not match for hunk at line "+(l+1));if(b!==h.oldLines)throw new Error("Removed line count did not match for hunk at line "+(l+1))}return h}for(;o<r.length;)a();return i}function rC(t,e,r){var n=!0,i=!1,o=!1,a=1;return function s(){if(n&&!o){if(i?a++:n=!1,t+a<=r)return a;o=!0}if(!i)return o||(n=!0),e<=t-a?-a++:(i=!0,s())}}function Vp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string"&&(e=Va(e)),Array.isArray(e)){if(e.length>1)throw new Error("applyPatch only works with a single input.");e=e[0]}var n=t.split(/\r\n|[\n\v\f\r\x85]/),i=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],o=e.hunks,a=r.compareLine||function(Se,ke,Te,ze){return ke===ze},s=0,c=r.fuzzFactor||0,l=0,u=0,f,h;function p(Se,ke){for(var Te=0;Te<Se.lines.length;Te++){var ze=Se.lines[Te],Ze=ze.length>0?ze[0]:" ",nt=ze.length>0?ze.substr(1):ze;if(Ze===" "||Ze==="-"){if(!a(ke+1,n[ke],Ze,nt)&&(s++,s>c))return!1;ke++}}return!0}for(var b=0;b<o.length;b++){for(var y=o[b],w=n.length-y.oldLines,_=0,S=u+y.oldStart-1,I=rC(S,l,w);_!==void 0;_=I())if(p(y,S+_)){y.offset=u+=_;break}if(_===void 0)return!1;l=y.offset+y.oldStart+y.oldLines}for(var D=0,O=0;O<o.length;O++){var te=o[O],J=te.oldStart+te.offset+D-1;D+=te.newLines-te.oldLines;for(var G=0;G<te.lines.length;G++){var ue=te.lines[G],re=ue.length>0?ue[0]:" ",ae=ue.length>0?ue.substr(1):ue,ye=te.linedelimiters[G];if(re===" ")J++;else if(re==="-")n.splice(J,1),i.splice(J,1);else if(re==="+")n.splice(J,0,ae),i.splice(J,0,ye),J++;else if(re==="\\"){var dt=te.lines[G-1]?te.lines[G-1][0]:null;dt==="+"?f=!0:dt==="-"&&(h=!0)}}}if(f)for(;!n[n.length-1];)n.pop(),i.pop();else h&&(n.push(""),i.push(`
`));for(var ne=0;ne<n.length-1;ne++)n[ne]=n[ne]+i[ne];return n.join("")}function gD(t,e){typeof t=="string"&&(t=Va(t));var r=0;function n(){var i=t[r++];if(!i)return e.complete();e.loadFile(i,function(o,a){if(o)return e.complete(o);var s=Vp(a,i,e);e.patched(i,s,function(c){if(c)return e.complete(c);n()})})}n()}function Gp(t,e,r,n,i,o,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var s=XS(r,n,a);s.push({value:"",lines:[]});function c(_){return _.map(function(S){return" "+S})}for(var l=[],u=0,f=0,h=[],p=1,b=1,y=function(S){var I=s[S],D=I.lines||I.value.replace(/\n$/,"").split(`
`);if(I.lines=D,I.added||I.removed){var O;if(!u){var te=s[S-1];u=p,f=b,te&&(h=a.context>0?c(te.lines.slice(-a.context)):[],u-=h.length,f-=h.length)}(O=h).push.apply(O,Zn(D.map(function(ne){return(I.added?"+":"-")+ne}))),I.added?b+=D.length:p+=D.length}else{if(u)if(D.length<=a.context*2&&S<s.length-2){var J;(J=h).push.apply(J,Zn(c(D)))}else{var G,ue=Math.min(D.length,a.context);(G=h).push.apply(G,Zn(c(D.slice(0,ue))));var re={oldStart:u,oldLines:p-u+ue,newStart:f,newLines:b-f+ue,lines:h};if(S>=s.length-2&&D.length<=a.context){var ae=/\n$/.test(r),ye=/\n$/.test(n),dt=D.length==0&&h.length>re.oldLines;!ae&&dt&&r.length>0&&h.splice(re.oldLines,0,"\\ No newline at end of file"),(!ae&&!dt||!ye)&&h.push("\\ No newline at end of file")}l.push(re),u=0,f=0,h=[]}p+=D.length,b+=D.length}},w=0;w<s.length;w++)y(w);return{oldFileName:t,newFileName:e,oldHeader:i,newHeader:o,hunks:l}}function nC(t){var e=[];t.oldFileName==t.newFileName&&e.push("Index: "+t.oldFileName),e.push("==================================================================="),e.push("--- "+t.oldFileName+(typeof t.oldHeader=="undefined"?"":"	"+t.oldHeader)),e.push("+++ "+t.newFileName+(typeof t.newHeader=="undefined"?"":"	"+t.newHeader));for(var r=0;r<t.hunks.length;r++){var n=t.hunks[r];n.oldLines===0&&(n.oldStart-=1),n.newLines===0&&(n.newStart-=1),e.push("@@ -"+n.oldStart+","+n.oldLines+" +"+n.newStart+","+n.newLines+" @@"),e.push.apply(e,n.lines)}return e.join(`
`)+`
`}function iC(t,e,r,n,i,o,a){return nC(Gp(t,e,r,n,i,o,a))}function Pu(t,e,r,n,i,o){return iC(t,t,e,r,n,i,o)}function oC(t,e){return t.length!==e.length?!1:Fu(t,e)}function Fu(t,e){if(e.length>t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function aC(t){var e=$u(t.lines),r=e.oldLines,n=e.newLines;r!==void 0?t.oldLines=r:delete t.oldLines,n!==void 0?t.newLines=n:delete t.newLines}function mD(t,e,r){t=Kp(t,r),e=Kp(e,r);var n={};(t.index||e.index)&&(n.index=t.index||e.index),(t.newFileName||e.newFileName)&&(Zp(t)?Zp(e)?(n.oldFileName=Rc(n,t.oldFileName,e.oldFileName),n.newFileName=Rc(n,t.newFileName,e.newFileName),n.oldHeader=Rc(n,t.oldHeader,e.oldHeader),n.newHeader=Rc(n,t.newHeader,e.newHeader)):(n.oldFileName=t.oldFileName,n.newFileName=t.newFileName,n.oldHeader=t.oldHeader,n.newHeader=t.newHeader):(n.oldFileName=e.oldFileName||t.oldFileName,n.newFileName=e.newFileName||t.newFileName,n.oldHeader=e.oldHeader||t.oldHeader,n.newHeader=e.newHeader||t.newHeader)),n.hunks=[];for(var i=0,o=0,a=0,s=0;i<t.hunks.length||o<e.hunks.length;){var c=t.hunks[i]||{oldStart:1/0},l=e.hunks[o]||{oldStart:1/0};if(Xp(c,l))n.hunks.push(Qp(c,a)),i++,s+=c.newLines-c.oldLines;else if(Xp(l,c))n.hunks.push(Qp(l,s)),o++,a+=l.newLines-l.oldLines;else{var u={oldStart:Math.min(c.oldStart,l.oldStart),oldLines:0,newStart:Math.min(c.newStart+a,l.oldStart+s),newLines:0,lines:[]};sC(u,c.oldStart,c.lines,l.oldStart,l.lines),o++,i++,n.hunks.push(u)}}return n}function Kp(t,e){if(typeof t=="string"){if(/^@@/m.test(t)||/^Index:/m.test(t))return Va(t)[0];if(!e)throw new Error("Must provide a base reference or pass in a patch");return Gp(void 0,void 0,e,t)}return t}function Zp(t){return t.newFileName&&t.newFileName!==t.oldFileName}function Rc(t,e,r){return e===r?e:(t.conflict=!0,{mine:e,theirs:r})}function Xp(t,e){return t.oldStart<e.oldStart&&t.oldStart+t.oldLines<e.oldStart}function Qp(t,e){return{oldStart:t.oldStart,oldLines:t.oldLines,newStart:t.newStart+e,newLines:t.newLines,lines:t.lines}}function sC(t,e,r,n,i){var o={offset:e,lines:r,index:0},a={offset:n,lines:i,index:0};for(Jp(t,o,a),Jp(t,a,o);o.index<o.lines.length&&a.index<a.lines.length;){var s=o.lines[o.index],c=a.lines[a.index];if((s[0]==="-"||s[0]==="+")&&(c[0]==="-"||c[0]==="+"))cC(t,o,a);else if(s[0]==="+"&&c[0]===" "){var l;(l=t.lines).push.apply(l,Zn(Ji(o)))}else if(c[0]==="+"&&s[0]===" "){var u;(u=t.lines).push.apply(u,Zn(Ji(a)))}else s[0]==="-"&&c[0]===" "?Yp(t,o,a):c[0]==="-"&&s[0]===" "?Yp(t,a,o,!0):s===c?(t.lines.push(s),o.index++,a.index++):Nu(t,Ji(o),Ji(a))}eg(t,o),eg(t,a),aC(t)}function cC(t,e,r){var n=Ji(e),i=Ji(r);if(tg(n)&&tg(i)){if(Fu(n,i)&&rg(r,n,n.length-i.length)){var o;(o=t.lines).push.apply(o,Zn(n));return}else if(Fu(i,n)&&rg(e,i,i.length-n.length)){var a;(a=t.lines).push.apply(a,Zn(i));return}}else if(oC(n,i)){var s;(s=t.lines).push.apply(s,Zn(n));return}Nu(t,n,i)}function Yp(t,e,r,n){var i=Ji(e),o=lC(r,i);if(o.merged){var a;(a=t.lines).push.apply(a,Zn(o.merged))}else Nu(t,n?o:i,n?i:o)}function Nu(t,e,r){t.conflict=!0,t.lines.push({conflict:!0,mine:e,theirs:r})}function Jp(t,e,r){for(;e.offset<r.offset&&e.index<e.lines.length;){var n=e.lines[e.index++];t.lines.push(n),e.offset++}}function eg(t,e){for(;e.index<e.lines.length;){var r=e.lines[e.index++];t.lines.push(r)}}function Ji(t){for(var e=[],r=t.lines[t.index][0];t.index<t.lines.length;){var n=t.lines[t.index];if(r==="-"&&n[0]==="+"&&(r="+"),r===n[0])e.push(n),t.index++;else break}return e}function lC(t,e){for(var r=[],n=[],i=0,o=!1,a=!1;i<e.length&&t.index<t.lines.length;){var s=t.lines[t.index],c=e[i];if(c[0]==="+")break;if(o=o||s[0]!==" ",n.push(c),i++,s[0]==="+")for(a=!0;s[0]==="+";)r.push(s),s=t.lines[++t.index];c.substr(1)===s.substr(1)?(r.push(s),t.index++):a=!0}if((e[i]||"")[0]==="+"&&o&&(a=!0),a)return r;for(;i<e.length;)n.push(e[i++]);return{merged:n,changes:r}}function tg(t){return t.reduce(function(e,r){return e&&r[0]==="-"},!0)}function rg(t,e,r){for(var n=0;n<r;n++){var i=e[e.length-r+n].substr(1);if(t.lines[t.index+n]!==" "+i)return!1}return t.index+=r,!0}function $u(t){var e=0,r=0;return t.forEach(function(n){if(typeof n!="string"){var i=$u(n.mine),o=$u(n.theirs);e!==void 0&&(i.oldLines===o.oldLines?e+=i.oldLines:e=void 0),r!==void 0&&(i.newLines===o.newLines?r+=i.newLines:r=void 0)}else r!==void 0&&(n[0]==="+"||n[0]===" ")&&r++,e!==void 0&&(n[0]==="-"||n[0]===" ")&&e++}),{oldLines:e,newLines:r}}function vD(t){for(var e=[],r,n,i=0;i<t.length;i++)r=t[i],r.added?n=1:r.removed?n=-1:n=0,e.push([n,r.value]);return e}function wD(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];n.added?e.push("<ins>"):n.removed&&e.push("<del>"),e.push(uC(n.value)),n.added?e.push("</ins>"):n.removed&&e.push("</del>")}return e.join("")}function uC(t){var e=t;return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e}function Mu(t,e){let r={};for(let o=0;o<e.length;o++){const a=e[o];r[a]?r[a].push(o):r[a]=[o]}let i=[{buffer1index:-1,buffer2index:-1,chain:null}];for(let o=0;o<t.length;o++){const a=t[o],s=r[a]||[];let c=0,l=i[0];for(let u=0;u<s.length;u++){const f=s[u];let h;for(h=c;h<i.length&&!(i[h].buffer2index<f&&(h===i.length-1||i[h+1].buffer2index>f));h++);if(h<i.length){const p={buffer1index:o,buffer2index:f,chain:i[h]};if(c===i.length?i.push(l):i[c]=l,c=h+1,l=p,c===i.length)break}}i[c]=l}return i[i.length-1]}function dC(t,e){const r=Mu(t,e);let n=[],i=t.length,o=e.length,a={common:[]};function s(){a.common.length&&(a.common.reverse(),n.push(a),a={common:[]})}for(let c=r;c!==null;c=c.chain){let l={buffer1:[],buffer2:[]};for(;--i>c.buffer1index;)l.buffer1.push(t[i]);for(;--o>c.buffer2index;)l.buffer2.push(e[o]);(l.buffer1.length||l.buffer2.length)&&(s(),l.buffer1.reverse(),l.buffer2.reverse(),n.push(l)),i>=0&&a.common.push(t[i])}return s(),n.reverse(),n}function ng(t,e){const r=Mu(t,e);let n=[],i=t.length,o=e.length;for(let a=r;a!==null;a=a.chain){const s=i-a.buffer1index-1,c=o-a.buffer2index-1;i=a.buffer1index,o=a.buffer2index,(s||c)&&n.push({buffer1:[i+1,s],buffer1Content:t.slice(i+1,i+1+s),buffer2:[o+1,c],buffer2Content:e.slice(o+1,o+1+c)})}return n.reverse(),n}function yD(t,e){const r=Mu(t,e);let n=[],i=t.length,o=e.length;function a(s,c,l){let u=[];for(let f=0;f<l;f++)u.push(s[c+f]);return{offset:c,length:l,chunk:u}}for(let s=r;s!==null;s=s.chain){const c=i-s.buffer1index-1,l=o-s.buffer2index-1;i=s.buffer1index,o=s.buffer2index,(c||l)&&n.push({buffer1:a(t,s.buffer1index+1,c),buffer2:a(e,s.buffer2index+1,l)})}return n.reverse(),n}function hC(t,e,r){let n=[];function i(c,l){n.push({ab:l,oStart:c.buffer1[0],oLength:c.buffer1[1],abStart:c.buffer2[0],abLength:c.buffer2[1]})}ng(e,t).forEach(c=>i(c,"a")),ng(e,r).forEach(c=>i(c,"b")),n.sort((c,l)=>c.oStart-l.oStart);let o=[],a=0;function s(c){c>a&&(o.push({stable:!0,buffer:"o",bufferStart:a,bufferLength:c-a,bufferContent:e.slice(a,c)}),a=c)}for(;n.length;){let c=n.shift(),l=c.oStart,u=c.oStart+c.oLength,f=[c];for(s(l);n.length;){const h=n[0],p=h.oStart;if(p>u)break;u=Math.max(u,p+h.oLength),f.push(n.shift())}if(f.length===1){if(c.abLength>0){const h=c.ab==="a"?t:r;o.push({stable:!0,buffer:c.ab,bufferStart:c.abStart,bufferLength:c.abLength,bufferContent:h.slice(c.abStart,c.abStart+c.abLength)})}}else{let h={a:[t.length,-1,e.length,-1],b:[r.length,-1,e.length,-1]};for(;f.length;){c=f.shift();const S=c.oStart,I=S+c.oLength,D=c.abStart,O=D+c.abLength;let te=h[c.ab];te[0]=Math.min(D,te[0]),te[1]=Math.max(O,te[1]),te[2]=Math.min(S,te[2]),te[3]=Math.max(I,te[3])}const p=h.a[0]+(l-h.a[2]),b=h.a[1]+(u-h.a[3]),y=h.b[0]+(l-h.b[2]),w=h.b[1]+(u-h.b[3]);let _={stable:!1,aStart:p,aLength:b-p,aContent:t.slice(p,b),oStart:l,oLength:u-l,oContent:e.slice(l,u),bStart:y,bLength:w-y,bContent:r.slice(y,w)};o.push(_)}a=u}return s(e.length),o}function Bu(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},n);const o=typeof t=="string",a=typeof e=="string",s=typeof r=="string";o&&(t=t.split(n.stringSeparator)),a&&(e=e.split(n.stringSeparator)),s&&(r=r.split(n.stringSeparator));let c=[];const l=hC(t,e,r);let u=[];function f(){u.length&&c.push({ok:u}),u=[]}function h(p,b){if(p.length!==b.length)return!1;for(let y=0;y<p.length;y++)if(p[y]!==b[y])return!1;return!0}return l.forEach(p=>{p.stable?u.push(...p.bufferContent):n.excludeFalseConflicts&&h(p.aContent,p.bContent)?u.push(...p.aContent):(f(),c.push({conflict:{a:p.aContent,aIndex:p.aStart,o:p.oContent,oIndex:p.oStart,b:p.bContent,bIndex:p.bStart}}))}),f(),c}function bD(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/,label:{}},n);const o=Bu(t,e,r,n);let a=!1,s=[];return o.forEach(c=>{c.ok?s=s.concat(c.ok):c.conflict&&(a=!0,s.push(`<<<<<<<${n.label.a?` ${n.label.a}`:""}`),s=s.concat(c.conflict.a),s.push(`|||||||${n.label.o?` ${n.label.o}`:""}`),s=s.concat(c.conflict.o),s.push("======="),s=s.concat(c.conflict.b),s.push(`>>>>>>>${n.label.b?` ${n.label.b}`:""}`))}),{conflict:a,result:s}}function fC(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},n);const o=Bu(t,e,r,n);let a=!1,s=[];for(let c=0;c<o.length;c++){const l=o[c];l.ok?s=s.concat(l.ok):(a=!0,s=s.concat([`
<<<<<<<<<
`],l.conflict.a,[`
=========
`],l.conflict.b,[`
>>>>>>>>>
`]))}return{conflict:a,result:s}}function _D(t,e,r,n){n=Object.assign({excludeFalseConflicts:!1,stringSeparator:/\s+/},n);const o=Bu(t,e,r,n);let a=!1,s=[];for(let c=0;c<o.length;c++){const l=o[c];if(l.ok)s=s.concat(l.ok);else{const u=dC(l.conflict.a,l.conflict.b);for(let f=0;f<u.length;f++){let h=u[f];h.common?s=s.concat(h.common):(a=!0,s=s.concat([`
<<<<<<<<<
`],h.buffer1,[`
=========
`],h.buffer2,[`
>>>>>>>>>
`]))}}}return{conflict:a,result:s}}function xD(t,e){let r=[],n=0;function i(o){for(;n<o;)r.push(t[n]),n++}for(let o=0;o<e.length;o++){let a=e[o];i(a.buffer1.offset);for(let s=0;s<a.buffer2.chunk.length;s++)r.push(a.buffer2.chunk[s]);n+=a.buffer1.length}return i(t.length),r}function SD(t){return t.map(e=>({buffer1:{offset:e.buffer1.offset,length:e.buffer1.length},buffer2:{chunk:e.buffer2.chunk}}))}function CD(t){return t.map(e=>({buffer1:e.buffer2,buffer2:e.buffer1}))}function ig(t,e,r){return Vp(t,e,r)}function pC(t,e){const r=[];for(const n of Va(t,e))r.push({...n,oldFileName:n.newFileName,oldHeader:n.newHeader,newFileName:n.oldFileName,newHeader:n.oldHeader,hunks:n.hunks.map(i=>({...i,oldLines:i.newLines,oldStart:i.newStart,newLines:i.oldLines,newStart:i.oldStart,lines:i.lines.map(o=>o[0]==="-"?`+${o.slice(1)}`:o[0]==="+"?`-${o.slice(1)}`:o)}))}),r.push(n);return r}function og(t,e,r){let n=`
`;const i=t.match(/(?:\r?\n)/g);if(i!==null&&i.length!==0){const c=i.filter(l=>l===`\r
`).length;n=c>i.length-c?`\r
`:`
`}const o=fC(t,e,r,{excludeFalseConflicts:!0,stringSeparator:/\r?\n/}),a=o.result;let s=!1;if(o.conflict){let c;const l=[];let u=0;for(const p of a)p===`
<<<<<<<<<
`?c={start:u,separator:u,end:u}:p===`
=========
`?c.separator=u:p===`
>>>>>>>>>
`&&(c.end=u,l.push(c)),u++;let f=0,h=0;for(const p of l)a.splice(p.start-f,1),f++,h=p.end-p.separator+1,a.splice(p.separator-f,h),f+=h;l.length&&(s=!0)}return{conflicts:s,mergedContent:a.join(n)}}function gC(t){return t!==void 0&&typeof t.then=="function"}const mC="";function vC(...t){if(t.length===1){const e=t[0];return e===void 0?mC:typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"||e instanceof Error?String(e):e instanceof d.Uri?e.toString():JSON.stringify(e)}return JSON.stringify(t)}function vr(t){return(e,r,n)=>{let i;if(typeof n.value=="function"?i=n.value:typeof n.get=="function"&&(i=n.get),i===void 0)throw new Error("Not supported");const o=`$gate$${r}`;n.value=function(...a){const s=a.length===0?o:`${o}$${(t!=null?t:vC)(...a)}`;Object.prototype.hasOwnProperty.call(this,s)||Object.defineProperty(this,s,{configurable:!1,enumerable:!1,writable:!0,value:void 0});let c=this[s];if(c===void 0){let l;try{if(l=i.apply(this,a),l==null||!gC(l))return l;this[s]=c=l.then(u=>(this[s]=void 0,u)).catch(u=>{throw this[s]=void 0,u})}catch(u){throw this[s]=void 0,u}}return c}}}let Ou=0;function wC(){return Ou===Number.MAX_SAFE_INTEGER&&(Ou=0),String(++Ou)}class yC{constructor(){this.id=wC()}async synchronize(e){let r;const n=this.promise;this.promise=new Promise(i=>r=i),await n;try{return await e()}finally{r()}}}class Ac{constructor(e){this.lock=new yC,this.readers=new Set,this.counter=0,this._id=e!=null?e:this.lock.id}get id(){return this._id}getNextCounter(){return this.counter===Number.MAX_SAFE_INTEGER&&(this.counter=0),++this.counter}async synchronizeRead(e,r){let n;const i=new $e(`Reader(${this.getNextCounter()}|${this.id})`,{log:{prefix:"(A) ",message:r?` \u2022 ${r}`:""},logLevel:Rt.Debug});let o;await this.lock.synchronize(async()=>{this.writer&&await this.writer,o=new Promise(a=>n=a),this.readers.add(o)}),i.restart({prefix:"(L) ",suffix:r?` \u2022 ${r}`:"",took:" waited for "});try{return await e()}finally{i.stop({prefix:"(U) ",suffix:r?` \u2022 ${r}`:"",took:" locked for "}),o!==void 0&&this.readers.delete(o),n()}}async synchronizeWrite(e,r){let n;const i=new $e(`Writer(${this.getNextCounter()}|${this.id})`,{log:{prefix:"(A) ",message:r?` \u2022 ${r}`:""},logLevel:Rt.Debug});await this.lock.synchronize(async()=>{if(this.writer&&await this.writer,this.readers.size){const o=[...this.readers];this.readers.clear(),await Promise.all(o)}this.writer=new Promise(o=>n=o)}),i.restart({prefix:"(L) ",suffix:r?` \u2022 ${r}`:"",took:" waited for "});try{return await e()}finally{i.stop({prefix:"(U) ",suffix:r?` \u2022 ${r}`:"",took:" locked for "}),n(),this.writer=void 0}}}class bC{constructor(){this.locks=new Map}async synchronizeRead(e,r,n){let i=this.locks.get(e);return i===void 0&&(i=new Ac(String(e)),this.locks.set(e,i)),i.synchronizeRead(r,n)}async synchronizeWrite(e,r,n){let i=this.locks.get(e);return i===void 0&&(i=new Ac(String(e)),this.locks.set(e,i)),i.synchronizeWrite(r,n)}}var _C=Object.defineProperty,xC=Object.getOwnPropertyDescriptor,SC=(t,e,r,n)=>{for(var i=n>1?void 0:n?xC(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&_C(e,r,i),i};const Yr=(0,C.loadMessageBundle)(),CC=d.FileSystemError.FileNotFound().code,ag=`===================================================================
`,Sn=new TextDecoder,EC=new TextEncoder;var rt;(function(t){t[t.Changed=1]="Changed",t[t.Created=2]="Created",t[t.Deleted=3]="Deleted"})(rt||(rt={}));function RC(t){return t&&"type"in t&&"uri"in t&&"uri"in t&&"fileType"in t&&"revision"in t&&"timestamp"in t}function Ga(t,e,r){return{type:t.type,rootUri:e,uri:r!=null?r:t.uri}}const Bo=class{constructor(t,e,r,n,i,o){this.providerService=t,this.storageService=e,this.fileStorageService=r,this.telemetryService=n,this.workspaceId=i,this._onDidChange=new d.EventEmitter,this.cache=new Map,this.lock=new bC,this.scopedStores=new Map,o===void 0&&(Bo._instance=this,this.disposable=d.Disposable.from(this.providerService.onDidRefresh(()=>this.cache.clear())))}static get instance(){return this._instance}get onDidChange(){return this._onDidChange.event}dispose(){var t;(t=this.disposable)==null||t.dispose()}async exportDebugInfo(t){var e;async function r(n){const i=await d.workspace.openTextDocument({language:"json",content:`ChangeStore Operations for ${n.toString(!0)}

${this.toStorage(await this.getWorkingOperations(n))}`});return void d.window.showTextDocument(i)}if(t===void 0)for(const n of(e=d.workspace.workspaceFolders)!=null?e:[])await r.call(this,n.uri);else return r.call(this,t)}async getWorkspaceProvidersWithChanges(){var t,e;const r=new Map;for(const n of(t=d.workspace.workspaceFolders)!=null?t:[])if(n.uri.scheme===Pt.scheme&&await this.hasChanges(n.uri)){const i=(e=this.providerService.getRepository(n.uri))==null?void 0:e.provider;if(!i)continue;r.set(i.id,i)}return[...r.values()]}async getWorkspacesWithChanges(){var t;const e=new $e("ChangeStore.getWorkspacesWithChanges()");try{const r=[];for(const n of(t=d.workspace.workspaceFolders)!=null?t:[])n.uri.scheme===Pt.scheme&&await this.hasChanges(n.uri)&&r.push(n.uri);return r.length>0?r:void 0}finally{e.stop()}}async acceptAll(t,e){const r=`ChangeStore.acceptAll(${t.toString()}, ${e==null?void 0:e.staged})`;Z.log(r);const n=[];await this.lock.synchronizeWrite(we(t),async()=>{const i=await this.getWorkingOperations(t),o=[];let a=[];const s=(e==null?void 0:e.staged)&&!(e.staged==="auto"&&!i.some(c=>c.staged));for(const c of i){if(s&&!c.staged){a.push(c);continue}c.fileType===d.FileType.File&&await this.discardWorkingContent(t,c.uri);let l;if(c.type===2&&c.fileType===d.FileType.Directory&&(i.some(u=>fc(u.uri,c.uri))||(l={type:3,rootUri:t,uri:c.uri})),n.push(l!=null?l:Ga(c,t)),c.type===2){let u=c.uri;for(;;){const{parent:f}=this.findParent(u,i,h=>h.type===2);if(f){o.push(f),u=f.uri;continue}break}}}a.length>0&&o.length>0&&(a=a.filter(c=>o.includes(c)?(n.push(Ga(c,t)),!1):!0)),await this.saveWorkingOperations(t,a)},r),n.length!==0&&this._onDidChange.fire(n)}async discard(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.discard(${t.toString()})`;Z.log(r);const n=[];await this.lock.synchronizeWrite(we(e),async()=>this.discardCore(e,t,n),r),n.length!==0&&this._onDidChange.fire(n)}async discardCore(t,e,r){Z.debug(`ChangeStore.discardCore(${e.toString()})`);const n=await this.getWorkingOperations(t);if(n.length===0)return;const i=Vn(e),o=n.findIndex(c=>Vn(c.uri)===i);if(o===-1)return;const[a]=n.splice(o,1);let s;switch(a.type){case 2:s=3;break;case 3:s=2;break;default:s=a.type;break}if(r.push({type:s,rootUri:t,uri:e}),a.type===2){let c=a.uri;for(;;){const{parent:l,parentIndex:u}=this.findNewParentWithOnlyChild(c,n);if(l){n.splice(u,1),r.push({type:3,rootUri:t,uri:l.uri}),c=l.uri;continue}break}}await this.saveWorkingOperations(t,n),a.fileType===d.FileType.File&&await this.discardWorkingContent(t,e)}async discardAll(t,e){const r=this.getUriScope(t);if(r)return this.getScopedChangeStore(r).discardAll(t,e);const n=`ChangeStore.discardAll(${t.toString()}, ${e==null?void 0:e.staged})`;Z.log(n);const i=[];await this.lock.synchronizeWrite(we(t),async()=>{const o=await this.getWorkingOperations(t),a=[];let s=[];const c=(e==null?void 0:e.staged)&&!(e.staged==="auto"&&!o.some(l=>l.staged));for(const l of o){if(c&&!l.staged){s.push(l);continue}l.fileType===d.FileType.File&&await this.discardWorkingContent(t,l.uri);let u;switch(l.type){case 2:u=3;break;case 3:u=2;break;default:u=l.type;break}if(i.push({type:u,rootUri:t,uri:l.uri}),l.type===2){let f=l.uri;for(;;){const{parent:h}=this.findNewParentWithOnlyChild(f,o);if(h){a.push(h),f=h.uri;continue}break}}}s.length>0&&a.length>0&&(s=s.filter(l=>a.includes(l)?(i.push({type:3,rootUri:t,uri:l.uri}),!1):!0)),await this.saveWorkingOperations(t,s)},n),i.length!==0&&this._onDidChange.fire(i)}async stage(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.stage(${t.toString()})`;Z.log(r);const n=[];await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e);i!==void 0&&await this.spliceOperation(t,o,{...i,staged:!0,timestamp:Date.now()},n)},r),n.length!==0&&this._onDidChange.fire(n)}async stageAll(t){const e=`ChangeStore.stageAll(${t.toString()})`;Z.log(e);const r=[];await this.lock.synchronizeWrite(we(t),async()=>{const n=(await this.getWorkingOperations(t)).map(i=>({...i,staged:!0,timestamp:Date.now()}));n.length!==0&&(await this.saveWorkingOperations(t,n),r.push(...n.map(i=>Ga(i,t))))},e),r.length!==0&&this._onDidChange.fire(r)}async unstage(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.unstage(${t.toString()})`;Z.log(r);const n=[];await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e);i!==void 0&&await this.spliceOperation(t,o,{...i,staged:!1,timestamp:Date.now()},n)},r),n.length!==0&&this._onDidChange.fire(n)}async unstageAll(t){const e=`ChangeStore.unstageAll(${t.toString()})`;Z.log(e);const r=[];await this.lock.synchronizeWrite(we(t),async()=>{const n=(await this.getWorkingOperations(t)).map(i=>({...i,staged:!1,timestamp:Date.now()}));n.length!==0&&(await this.saveWorkingOperations(t,n),r.push(...n.map(i=>Ga(i,t))))},e),r.length!==0&&this._onDidChange.fire(r)}async hasChanges(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).hasChanges(t);const r=we(t),n=this.cache.get(r);return n!==void 0?n.length!==0:this.lock.synchronizeRead(r,async()=>(await this.getWorkingOperations(t)).length!==0,`ChangeStore.hasChanges(${t.toString()})`)}maybeHasChanges(t,e){const r=this.getUriScope(t);if(r)return this.getScopedChangeStore(r).maybeHasChanges(t,e);const n=this.cache.get(we(t));if(n===void 0)return;if(n.length===0)return!1;if(e===void 0)return!0;const i=Vn(e);return n.some(o=>Vn(o.uri)===i)}async hasMergeConflicts(t){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).some(e=>e.conflicts!==void 0),`ChangeStore.hasMergeConflicts(${t.toString()})`)}async hasStagedChanges(t){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).some(e=>e.staged&&e.conflicts===void 0),`ChangeStore.hasStagedChanges(${t.toString()})`)}async hasWorkingChanges(t){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).some(e=>!e.staged&&e.conflicts===void 0),`ChangeStore.hasWorkingChanges(${t.toString()})`)}async getChange(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).getChange(t);const r=this.providerService.getVirtualRootUri(t);if(r!==void 0)return this.lock.synchronizeRead(we(r),async()=>{const{operation:n}=await this.getWorkingOperation(t,r);return n},`ChangeStore.getChange(${t.toString()})`)}async getChanges(t,e){const r=this.getUriScope(t);return r?this.getScopedChangeStore(r).getChanges(t,e):this.lock.synchronizeRead(we(t),async()=>{let n=await this.getWorkingOperations(t);if((e==null?void 0:e.excludeConflicts)||(e==null?void 0:e.predicate)){const{excludeConflicts:i,predicate:o}=e;n=n.filter(a=>{var s;return(!i||a.conflicts===void 0)&&((s=o==null?void 0:o(a))!=null?s:!0)})}return n},`ChangeStore.getChanges(${t.toString()})`)}async getGroupedChanges(t,e){const r=this.getUriScope(t);return r?this.getScopedChangeStore(r).getGroupedChanges(t,e):this.lock.synchronizeRead(we(t),async()=>{var n,i;const o=await this.getWorkingOperations(t),a={conflicts:[],staged:[],working:[]};for(const s of o)!((i=(n=e==null?void 0:e.predicate)==null?void 0:n.call(e,s))!=null?i:!0)||(s.conflicts?a.conflicts.push(s):s.staged?a.staged.push(s):a.working.push(s));return a},`ChangeStore.getChangesByType(${t.toString()})`)}async getContent(t){const e=this.providerService.getVirtualRootUri(t);if(e===void 0)throw new Error(`Unable to find content for ${t.toString()}; Repository not found`);const r=we(e),n=this.cache.get(r);if((n==null?void 0:n.length)===0)throw new Error(`Unable to find content for ${t.toString()}`);return this.lock.synchronizeRead(r,async()=>{const i=Sn.decode(await this.getWorkingContent(e,t));if(i!==void 0)return i;throw new Error(`Unable to find content for ${t.toString()}`)},`ChangeStore.getContent(${t.toString()}}`)}async getMergeConflicts(t,e){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,o;return n.conflicts!==void 0&&((o=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?o:!0)}),`ChangeStore.getMergeConflicts(${t.toString()})`)}async getStagedChanges(t,e){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,o;return n.staged&&n.conflicts===void 0&&((o=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?o:!0)}),`ChangeStore.getStagedChanges(${t.toString()})`)}async getWorkingChanges(t,e){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,o;return!n.staged&&n.conflicts===void 0&&((o=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?o:!0)}),`ChangeStore.getWorkingChanges(${t.toString()})`)}async applyChangeset(t,e,r,n){var i;let o;RC(r)?o=r:n=n!=null?n:r,Z.log(`ChangeStore.applyChangeset${t.toString()}`,e.workspaceId,e.uri,o==null?void 0:o.uri,n==null?void 0:n.save);const a=this.getScopedChangeStore(e.workspaceId),s=(i=e.patch)!=null?i:await a.createPatch(e.uri,o==null?void 0:o.uri);await this.applyPatchCore(t,s,{...n,getIncomingContent:async c=>{const l=this.getScopedUri(this.providerService.createRelativeVirtualUri(e.uri,c),e.workspaceId);return Sn.decode(await d.workspace.fs.readFile(l))},merge:async(c,l,u)=>{try{const f=this.providerService.getProviderUri(c),h=Sn.decode(await d.workspace.fs.readFile(f)),p=this.getScopedUri(this.providerService.createRelativeVirtualUri(e.uri,l),e.workspaceId),b=Sn.decode(await d.workspace.fs.readFile(p));return{...og(u,h,b),baseUri:f,incomingUri:p}}catch(f){throw new Error(`Unable to apply patch to ${l}: ${String(f)}`)}}})}async applyPatch(t,e,r){if(Z.log(`ChangeStore.applyPatch(${t.toString()})`,r==null?void 0:r.save),!e.startsWith("diff --"))throw new Error("Invalid patch");return this.applyPatchCore(t,e,r)}async applyPatchCore(t,e,r={}){const n=`ChangeStore.applyPatchCore(${t.toString()})`;Z.debug(n,r==null?void 0:r.save);const i=new d.WorkspaceEdit,o=[],a=new Map;async function s(h){var p;const b=we(h),y=d.workspace.textDocuments.find(w=>we(w.uri)===b);return(p=y==null?void 0:y.getText())!=null?p:Sn.decode(await d.workspace.fs.readFile(h))}async function c(h){try{const p=await d.workspace.fs.stat(h);return Boolean(p)}catch{return!1}}async function l(h,p,b){let y=ig("",b,{fuzzFactor:0});if(y===!1){if(!r.getIncomingContent)throw new Error(`Unable to apply patch to ${p}`);y=await r.getIncomingContent(p)}i.createFile(h,{overwrite:!0}),i.replace(h,new d.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),y)}async function u(h,p,b,y){const w=await s(h);let _=ig(w,b,{fuzzFactor:1});if(_===!1){if(r.merge===void 0)throw new Error(`Unable to apply patch to ${p}; Resulted in conflicts`);const S={title:Yr("apply patch failed prompt confirm","Merge")},I={title:Yr("apply patch failed prompt cancel","Skip File"),isCloseAffordance:!0};if(await d.window.showWarningMessage(Yr("apply patch failed prompt",`Unable to apply changes to '{0}'.

Do you want to retry by merging the files?`,p),{modal:!0,useCustom:!0},S,I)!==S)return;const O=await r.merge(h,p,w);_=O.mergedContent,O.conflicts&&a.set(we(h),{type:y,baseUri:O.baseUri,incomingUri:O.incomingUri})}i.replace(h,new d.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),_)}const f=(r==null?void 0:r.reverse)?pC(e,{}):Va(e,{});for(const h of f)if(h.oldFileName==="/dev/null"){if(!h.newFileName)continue;const p=h.newFileName.startsWith("b/")?h.newFileName.substr(2):h.newFileName,b=this.providerService.createRelativeVirtualUri(t,p);o.push(we(b)),!await c(b)?await l(b,p,h):await u(b,p,h,2)}else if(h.newFileName==="/dev/null"){if(!h.oldFileName)continue;const p=h.oldFileName.startsWith("a/")?h.oldFileName.substr(2):h.oldFileName,b=this.providerService.createRelativeVirtualUri(t,p);await c(b)&&i.deleteFile(b)}else if(h.oldFileName===h.newFileName){if(!h.newFileName)continue;const p=this.providerService.createRelativeVirtualUri(t,h.newFileName);o.push(we(p)),!await c(p)?await l(p,h.newFileName,h):await u(p,h.newFileName,h,1)}else throw new Error(`Unable to apply patch to ${h.oldFileName}; Renames aren't currently supported`);if(await d.workspace.applyEdit(i),r.save&&o.length)for(const h of o){const p=d.workspace.textDocuments.find(b=>we(b.uri)===h);await(p==null?void 0:p.save())}a.size&&setTimeout(async()=>{const h=[];await this.lock.synchronizeWrite(we(t),async()=>{const p=await this.getWorkingOperations(t);if(p.length===0)return;let b=-1;for(const y of p){b++;const w=a.get(we(y.uri));w!==void 0&&await this.spliceOperation(y.uri,b,{...y,conflicts:{baseUri:w.baseUri,incomingUri:w.incomingUri,status:[y.type,w.type]},timestamp:Date.now()},h)}},n),h.length!==0&&this._onDidChange.fire(h)},0)}async createChangeset(t){Z.log(`ChangeStore.createChangeset${t.toString()})`);const e=await this.createPatch(t);return e?{workspaceId:this.workspaceId,uri:t,patch:e}:void 0}async createPatch(t,e,r){if(Z.log(`ChangeStore.createPatch${t.toString()})`,e),e===void 0){let o=await this.getWorkingOperations(t);if((r==null?void 0:r.staged)&&(o=o.filter(s=>s.staged)),o.length===0)return"";const a=[];for(const s of o){const c=await this.createPatchCore(t,s);a.push(c)}return a.join("")}const{operation:n}=await this.getWorkingOperation(e,t);if(n===void 0)throw new Error(`Unable to create patch for ${e.toString()}`);return(r==null?void 0:r.staged)&&n.staged?"":await this.createPatchCore(t,n)}async createPatchCore(t,e){const r=this.providerService.getRelativeFilePath(t,e.uri),n=`diff --git a/${r} b/${r}`;if(e.type===2){let c=await this.getContent(e.uri),l;!c.endsWith(`
`)&&!c.endsWith(`\r
`)?l=`
\\ No newline at end of file`:l="";let u=0;return c=c.replace(/\r?\n/g,f=>(u++,`${f}+`)),`${n}
new file mode 100644
--- /dev/null
+++ b/${r}
@@ -0,0 +1,${u} @@
+${c}${l}`}if(e.type===3){let c=Sn.decode(await d.workspace.fs.readFile(this.providerService.getProviderUri(e.uri))),l=0;return c=c.replace(/\r?\n/g,u=>(l++,`${u}-`)),`${n}
deleted file mode 100644
--- a/${r}
+++ /dev/null
@@ -1,${l} +0,0 @@
-${c}`}const i=await this.getContent(e.uri),o=Sn.decode(await d.workspace.fs.readFile(this.providerService.getProviderUri(e.uri))),a=Pu(r,o,i),s=a.indexOf(ag);return`${n}
${a.substr(s+ag.length)}`}async keep(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return;const n=`ChangeStore.keep(${t.toString()})`;Z.log(n,e);const i=[];await this.lock.synchronizeWrite(we(r),async()=>{const{operation:o,index:a}=await this.getWorkingOperation(t,r);if(o===void 0)return;if(e===void 0&&o.conflicts){const[,c]=o.conflicts.status;switch(c){case 1:switch(o.type){case 1:case 2:case 3:await this.spliceOperation(t,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break}break;case 2:switch(o.type){case 1:case 3:await this.spliceOperation(t,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break;case 2:await this.spliceOperation(t,a,{...o,type:1,size:o.size,hash:o.hash,originalHash:o.originalHash,conflicts:void 0,timestamp:Date.now()},i);break}break;case 3:switch(o.type){case 3:await this.discardCore(r,t,i);break;case 1:await this.spliceOperation(t,a,{...o,type:2,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);break;case 2:await this.spliceOperation(t,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break}break}return}if(e===void 0)return;switch(e.type){case 1:switch(o.type){case 3:await this.spliceOperation(t,a,{...o,type:3,size:void 0,hash:void 0,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);return;case 2:break;case 1:break}break;case 2:switch(o.type){case 1:case 3:return;case 2:break}break;case 3:switch(o.type){case 3:return this.discardCore(r,t,i);case 1:await this.spliceOperation(t,a,{...o,type:2,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);return;case 2:return}}const s=e!==void 0?await d.workspace.fs.readFile(e.providerUri):void 0;await this.spliceOperation(t,a,{...o,type:1,originalHash:s!==void 0?await ja(s):o.originalHash,conflicts:void 0,timestamp:Date.now()},i)},n),i.length!==0&&this._onDidChange.fire(i)}async merge(t,e,r){const n=this.providerService.getVirtualWorkspaceUri(t);if(n===void 0)return;const i=`ChangeStore.merge(${t.toString()})`;Z.log(i,e,r);const o=[];await this.lock.synchronizeWrite(we(n),async()=>{const{operation:a,index:s}=await this.getWorkingOperation(t,n);if(a===void 0)return;switch(e.type){case 1:switch(a.type){case 3:return void this.spliceOperation(t,s,{...a,type:3,size:void 0,hash:void 0,originalHash:void 0,conflicts:{baseUri:r.providerUri,incomingUri:e.providerUri,status:[a.type,e.type]},timestamp:Date.now()},o);case 2:break;case 1:break}break;case 2:switch(a.type){case 3:case 1:return;case 2:break}break;case 3:switch(a.type){case 3:return this.discardCore(n,t,o);case 1:return void this.spliceOperation(t,s,{...a,type:2,originalHash:void 0,conflicts:{baseUri:void 0,incomingUri:e.providerUri,status:[a.type,e.type]},timestamp:Date.now()},o);case 2:return}}const c=await this.getWorkingContent(n,t),l=await d.workspace.fs.readFile(r.providerUri),u=await d.workspace.fs.readFile(e.providerUri),f=og(Sn.decode(c),Sn.decode(l),Sn.decode(u));await this.writeFileCore(n,t,o,EC.encode(f.mergedContent),u!=null?u:new Uint8Array(0),f.conflicts?{baseUri:r.providerUri,incomingUri:e.providerUri,status:[a.type,e.type]}:void 0)},i),o.length!==0&&this._onDidChange.fire(o)}async resolveDiffCommand(t,e,r,n){let i;const o=this.providerService.getVirtualRootUri(t);return o!==void 0&&({operation:i}=await this.getWorkingOperation(t,o)),(i==null?void 0:i.type)===3?this.resolveOpenCommand(e):((i==null?void 0:i.type)===2&&(e=e.with({query:"~"})),{command:"vscode.diff",title:"Open Changes",arguments:[e,t,r,n]})}resolveOpenCommand(t,e){return{command:"vscode.open",title:"Open File",arguments:[t,e]}}getScopedUri(t,e){const r=typeof e=="string"?e:e.workspaceId;return r===this.workspaceId?t:t.with({fragment:r})}getUriScope(t){return t.fragment||void 0}getScopedChangeStore(t){const e=typeof t=="string"?t:t.workspaceId;Z.log(`ChangeStore.getScopedChangeStore(${e})`);let r=this.scopedStores.get(e);return r===void 0&&(r=e===this.workspaceId?new Bo.ScopedChangeStore(this,e,this.workspaceId):new Bo.ScopedChangeStore(new Bo(this.providerService,this.storageService.with(e),this.fileStorageService.with(e),this.telemetryService,this.workspaceId,e),e,this.workspaceId),this.scopedStores.set(e,r)),r}async stat(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).stat(t);const r=this.providerService.getVirtualRootUri(t);if(r===void 0)return;const n=we(r),i=this.cache.get(n);if((i==null?void 0:i.length)!==0)return this.lock.synchronizeRead(n,async()=>{var o;const{operation:a}=await this.getWorkingOperation(t,r);if(a!==void 0){if(a.type===3)throw d.FileSystemError.FileNotFound(`The ${a.fileType===d.FileType.Directory?"folder":"file"} has been deleted.`);return{type:a.fileType,size:(o=a.size)!=null?o:0,ctime:0,mtime:a.timestamp}}},`ChangeStore.stat(${t.toString()}`)}async readFile(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).readFile(t);const r=new $e(`ChangeStore.readFile(${t.toString()})`);try{const n=this.providerService.getVirtualRootUri(t);if(n===void 0)return;const i=we(n),o=this.cache.get(i);return(o==null?void 0:o.length)===0?void 0:await this.lock.synchronizeRead(i,()=>{const a=this.cache.get(i);if((a==null?void 0:a.length)===0){r.log({message:": Not found; no operations"});return}return this.getWorkingContent(n,t)},r.context)}finally{r.stop()}}async createDirectory(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new $e(`ChangeStore.createDirectory(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e),a=await this.providerService.getMetadata(t);await this.spliceOperation(t,o,i===void 0?{type:2,uri:t,fileType:d.FileType.Directory,revision:a.HEAD.sha,timestamp:Date.now(),size:0,hash:"",originalHash:void 0}:{...i,timestamp:Date.now()},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async deleteDirectory(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new $e(`ChangeStore.deleteDirectory(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e);if((i==null?void 0:i.type)===2)return this.discardCore(e,t,n);const a=await this.providerService.getMetadata(t);await this.spliceOperation(t,o,{type:3,uri:t,fileType:d.FileType.Directory,revision:a.HEAD.sha,timestamp:Date.now(),size:void 0,hash:void 0,originalHash:void 0},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async updateDirectoryEntries(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return e;const n=new $e(`ChangeStore.updateDirectoryEntries(${t.toString()})`,{},e.length);try{const i=we(r),o=this.cache.get(i);return(o==null?void 0:o.length)===0?e:await this.lock.synchronizeRead(i,async()=>{const{path:a}=Ma(r,t),s=await this.getWorkingOperations(r);for(const c of s)switch(c.type){case 1:break;case 2:{if(fc(c.uri,a)){const l=this.providerService.getRelativeFilePath(t,c.uri);e.push([l,c.fileType])}break}case 3:{if(fc(c.uri,a)){const l=this.providerService.getRelativeFilePath(t,c.uri),u=e.findIndex(([f])=>f===l);u!==-1&&e.splice(u,1)}break}}return e},n.context)}finally{n.stop()}}async writeFile(t,e,r,n){const i=this.providerService.getVirtualWorkspaceUri(t);if(i===void 0)return;const o=new $e(`ChangeStore.writeFile(${t.toString()})`,{},e.length,n);try{const a=[];if(await this.lock.synchronizeWrite(we(i),async()=>this.writeFileCore(i,t,a,e,r,n),o.context),a.length===0)return;this._onDidChange.fire(a)}finally{o.stop()}}async writeFileCore(t,e,r,n,i,o){const a=new $e(`ChangeStore.writeFileCore(${e.toString()})`,{},n.length,o);try{const[{operation:s,index:c},l,u]=await Promise.all([this.getWorkingOperation(e,t),ja(n),ja(i)]);if(l===u&&(s==null?void 0:s.type)===1)return this.discardCore(t,e,r);if(l===(s==null?void 0:s.hash)&&u===(s==null?void 0:s.originalHash))return;const[{HEAD:f}]=await Promise.all([this.providerService.getMetadata(e),this.saveWorkingContent(t,e,n)]);await this.spliceOperation(e,c,s===void 0?{type:1,uri:e,fileType:d.FileType.File,revision:f.sha,timestamp:Date.now(),size:n.byteLength,hash:l,originalHash:u,conflicts:o,staged:!1}:{...s,revision:f.sha,timestamp:Date.now(),size:n.byteLength,hash:l,originalHash:u,conflicts:o,staged:!1},r)}finally{a.stop()}}async createFile(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return;const n=new $e(`ChangeStore.createFile(${t.toString()})`,{},e.length);try{const i=[];if(await this.lock.synchronizeWrite(we(r),async()=>{const[{operation:o,index:a},s,c]=await Promise.all([this.getWorkingOperation(t,r),ja(e),this.providerService.getMetadata(t),this.saveWorkingContent(r,t,e)]);await this.spliceOperation(t,a,o===void 0?{type:2,uri:t,fileType:d.FileType.File,revision:c.HEAD.sha,timestamp:Date.now(),size:e.byteLength,hash:s,originalHash:s}:{...o,type:2,revision:c.HEAD.sha,timestamp:Date.now(),size:e.byteLength,hash:s},i)},n.context),i.length===0)return;this._onDidChange.fire(i)}finally{n.stop()}}async deleteFile(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new $e(`ChangeStore.deleteFile(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e);if((i==null?void 0:i.type)===2)return this.discardCore(e,t,n);const[a]=await Promise.all([this.providerService.getMetadata(t),this.discardWorkingContent(e,t)]);await this.spliceOperation(t,o,{type:3,uri:t,fileType:d.FileType.File,revision:a.HEAD.sha,timestamp:Date.now(),size:void 0,hash:void 0,originalHash:void 0},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}findParent(t,e,r){const n=SS(t),{operation:i,index:o}=this.findWorkingOperation(n,e);return i!==void 0&&r(i,e)?{parent:i,parentIndex:o}:{parent:void 0,parentIndex:-1}}findNewParentWithOnlyChild(t,e){const r=Vn(t);return this.findParent(t,e,(n,i)=>n.type===2&&!i.some(o=>fc(o.uri,n.uri)&&Vn(o.uri)!==r))}async getWorkingOperation(t,e){return this.findWorkingOperation(t,await this.getWorkingOperations(e))}findWorkingOperation(t,e){if(e.length===0)return{operation:void 0,index:-1};const r=Vn(t);let n=-1;const i=e.find((o,a)=>Vn(o.uri)!==r?!1:(n=a,!0));return i===void 0?{operation:void 0,index:-1}:{operation:i,index:n}}async getWorkingOperations(t){const e=we(t);let r=this.cache.get(e);return r===void 0&&(r=this.fromStorage(await this.storageService.get(this.getOperationsStorageKey(e))),this.cache.set(e,r)),r}async saveWorkingOperations(t,e){Z.debug(`ChangeStore.saveWorkingOperations(${t.toString()})`,e.length);const r=we(t);this.cache.set(r,e);try{await this.storageService.store(this.getOperationsStorageKey(r),this.toStorage(e))}catch(n){throw this.cache.delete(r),Z.error(n,`Failed to save repository changes for ${r}`),n}}getOperationsStorageKey(t){return`operations/${t}`}async getWorkingContent(t,e){try{return await this.fileStorageService.get(this.getFileStorageKey(t,e))}catch(r){throw Z.error(r),this.telemetryService.sendException(r),r}}async discardWorkingContent(t,e){Z.debug(`ChangeStore.discardWorkingContent(${e.toString()})`);try{return await this.fileStorageService.delete(this.getFileStorageKey(t,e))}catch(r){if(r instanceof d.FileSystemError&&r.code===CC)return;throw Z.error(r),this.telemetryService.sendException(r),r}}async saveWorkingContent(t,e,r){Z.debug(`ChangeStore.saveWorkingContent(${e.toString()})`,r.length);try{return await this.fileStorageService.store(this.getFileStorageKey(t,e),r)}catch(n){throw Z.error(n),this.telemetryService.sendException(n),n}}getFileStorageKey(t,e){return`changestore/${Eu(e)}`}async spliceOperation(t,e,r,n){const i=this.providerService.getVirtualWorkspaceUri(t);if(i===void 0)return;const o=await this.getWorkingOperations(i);e!==-1?o.splice(e,1,r):o.push(r),await this.saveWorkingOperations(i,o),n.push(Ga(r,i,t))}fromStorage(t){if(!t)return[];try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&pc(n)?typeof n=="string"?d.Uri.parse(n):d.Uri.from(n):n);return Array.isArray(e)?e:e.operations}catch(e){throw Z.error(e,"Failed to deserialize ChangeStore operations"),e}}toStorage(t){const e={schemaVersion:Bo.operationsStorageSchemaVersion,operations:t};return JSON.stringify(e)}};let Ka=Bo;Ka.operationsStorageSchemaVersion=1,Ka.ScopedChangeStore=class{constructor(t,e,r){this.changeStore=t,this.scope=e,this.workspaceId=r}createPatch(t,e,r){return this.changeStore.createPatch(this.stripUriScope(t),this.stripUriScope(e),r)}discardAll(t,e){return this.changeStore.discardAll(this.stripUriScope(t),e)}getChange(t){return this.changeStore.getChange(this.stripUriScope(t))}getChanges(t,e){return this.changeStore.getChanges(this.stripUriScope(t),e)}async getGroupedChanges(t,e){return this.changeStore.getGroupedChanges(this.stripUriScope(t),e)}hasChanges(t){return this.changeStore.hasChanges(this.stripUriScope(t))}maybeHasChanges(t,e){return this.changeStore.maybeHasChanges(this.stripUriScope(t),this.stripUriScope(e))}async stat(t){const r=this.changeStore.getUriScope(t)!==this.workspaceId,n=await this.changeStore.stat(this.stripUriScope(t));return n!==void 0&&r&&(n.permissions=d.FilePermission.Readonly),n}readFile(t){return this.changeStore.readFile(this.stripUriScope(t))}resolveDiffCommand(t,e,r,n){return this.changeStore.resolveDiffCommand(this.changeStore.getScopedUri(t,this.scope),this.changeStore.getScopedUri(e,this.scope),r,n)}stripUriScope(t){return t===void 0||!t.fragment?t:t.with({fragment:""})}},SC([vr()],Ka.prototype,"getWorkingOperations",1);function sg(t){switch(t){case 1:return Yr("change type changed","Modified");case 2:return Yr("change type created","Added");case 3:return Yr("change type deleted","Deleted")}}function AC(t){const[e,r]=t;switch(e){case 1:switch(r){case 1:case 2:return Yr("conflict status changed both","Modified by Both");case 3:return Yr("conflict status deleted them","Deleted by Incoming")}break;case 2:switch(r){case 1:case 2:return Yr("conflict status created both","Added by Both");case 3:return Yr("conflict status deleted them","Deleted by Incoming")}break;case 3:switch(r){case 1:case 2:return Yr("conflict status deleted us","Deleted by Current");case 3:return Yr("conflict status deleted both","Deleted by Both")}break}}var cg=Object.defineProperty,TC=t=>cg(t,"__esModule",{value:!0}),xe=(t,e)=>()=>(t&&(e=t(t=0)),e),kC=(t,e)=>{TC(t);for(var r in e)cg(t,r,{get:e[r],enumerable:!0})},lg,IC=xe(()=>{lg={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5}}),Oo,Cn,Xn,Xr,Tc,Qn,kc,Ic,ug,dg,Za,Uu=xe(()=>{Oo="function",Cn="object",Xn="undefined",Xr="prototype",Tc="hasOwnProperty",Qn=Object,kc=Qn[Xr],Ic=Qn.assign,ug=Qn.create,dg=Qn.defineProperty,Za=kc[Tc]});function Uo(){return typeof globalThis!==Xn&&globalThis?globalThis:typeof self!==Xn&&self?self:typeof window!==Xn&&window?window:typeof __webpack_require__.g!==Xn&&__webpack_require__.g?__webpack_require__.g:null}function Lu(t){throw new TypeError(t)}function Dc(t){var e=ug;if(e)return e(t);if(t==null)return{};var r=typeof t;r!==Cn&&r!==Oo&&Lu("Object prototype may only be an Object:"+t);function n(){}return n[Xr]=t,new n}var hg=xe(()=>{Uu()});function Nt(t,e){typeof e!==Oo&&e!==null&&Lu("Class extends value "+String(e)+" is not a constructor or null"),Pc(t,e);function r(){this.constructor=t}t[Xr]=e===null?Dc(e):(r[Xr]=e[Xr],new r)}var DC,PC,fg,Lo,Pc,FC=xe(()=>{Uu(),hg(),DC=(Uo()||{}).Symbol,PC=(Uo()||{}).Reflect,fg=function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)kc[Tc].call(e,i)&&(t[i]=e[i])}return t},Lo=Ic||fg,Pc=function(t,e){return Pc=Qn.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n[Tc](i)&&(r[i]=n[i])},Pc(t,e)}}),NC=xe(()=>{}),Ut=xe(()=>{Uu(),hg(),FC(),NC()});function _i(t,e){return t&&Ja[En].hasOwnProperty.call(t,e)}function pg(t){return t&&(t===Ja[En]||t===Array[En])}function Hu(t){return pg(t)||t===Function[En]}function eo(t){if(t){if(qo)return qo(t);var e=t[mg]||t[En]||(t[Xa]?t[Xa][En]:null);if(e)return e}return null}function Fc(t,e){var r=[],n=Ja.getOwnPropertyNames;if(n)r=n(t);else for(var i in t)typeof i=="string"&&_i(t,i)&&r.push(i);if(r&&r.length>0)for(var o=0;o<r.length;o++)e(r[o])}function qu(t,e,r){return e!==Xa&&typeof t[e]===Qa&&(r||_i(t,e))}function Nc(t){throw new TypeError("DynamicProto: "+t)}function $C(t){var e={};return Fc(t,function(r){!e[r]&&qu(t,r,!1)&&(e[r]=t[r])}),e}function Wu(t,e){for(var r=t.length-1;r>=0;r--)if(t[r]===e)return!0;return!1}function MC(t,e,r,n){function i(c,l,u){var f=l[u];if(f[$c]&&n){var h=c[Ya]||{};h[Ho]!==!1&&(f=(h[l[to]]||{})[u]||f)}return function(){return f.apply(c,arguments)}}var o={};Fc(r,function(c){o[c]=i(e,r,c)});for(var a=eo(t),s=[];a&&!Hu(a)&&!Wu(s,a);)Fc(a,function(c){!o[c]&&qu(a,c,!qo)&&(o[c]=i(e,a,c))}),s.push(a),a=eo(a);return o}function BC(t,e,r,n){var i=null;if(t&&_i(r,to)){var o=t[Ya]||{};if(i=(o[r[to]]||{})[e],i||Nc("Missing ["+e+"] "+Qa),!i[Mc]&&o[Ho]!==!1){for(var a=!_i(t,e),s=eo(t),c=[];a&&s&&!Hu(s)&&!Wu(c,s);){var l=s[e];if(l){a=l===n;break}c.push(s),s=eo(s)}try{a&&(t[e]=i),i[Mc]=1}catch(u){o[Ho]=!1}}}return i}function OC(t,e,r){var n=e[t];return n===r&&(n=eo(e)[t]),typeof n!==Qa&&Nc("["+t+"] is not a "+Qa),n}function UC(t,e,r,n,i){function o(c,l){var u=function(){var f=BC(this,l,c,u)||OC(l,c,u);return f.apply(this,arguments)};return u[$c]=1,u}if(!pg(t)){var a=r[Ya]=r[Ya]||{},s=a[e]=a[e]||{};a[Ho]!==!1&&(a[Ho]=!!i),Fc(r,function(c){qu(r,c,!1)&&r[c]!==n[c]&&(s[c]=r[c],delete r[c],(!_i(t,c)||t[c]&&!t[c][$c])&&(t[c]=o(t,c)))})}}function LC(t,e){if(qo)for(var r=[],n=eo(e);n&&!Hu(n)&&!Wu(r,n);){if(n===t)return!0;r.push(n),n=eo(n)}return!1}function zu(t,e){return _i(t,En)?t.name||e||Gu:((t||{})[Xa]||{}).name||e||Gu}function ju(t,e,r,n){_i(t,En)||Nc("theClass is an invalid class definition.");var i=t[En];LC(i,e)||Nc("["+zu(t)+"] is not in class hierarchy of ["+zu(e)+"]");var o=null;_i(i,to)?o=i[to]:(o=gg+zu(t,"_")+"$"+Zu,Zu++,i[to]=o);var a=ju[Vu],s=!!a[Bc];s&&n&&n[Bc]!==void 0&&(s=!!n[Bc]);var c=$C(e),l=MC(i,e,c,s);r(e,l);var u=!!qo&&!!a[Ku];u&&n&&(u=!!n[Ku]),UC(i,o,e,c,u!==!1)}var Xa,En,Qa,Ya,$c,to,gg,Mc,Ho,Vu,Gu,mg,Bc,Ku,Ja,qo,Zu,vg,nr,pr=xe(()=>{Xa="constructor",En="prototype",Qa="function",Ya="_dynInstFuncs",$c="_isDynProxy",to="_dynClass",gg="_dynCls$",Mc="_dynInstChk",Ho=Mc,Vu="_dfOpts",Gu="_unknown_",mg="__proto__",Bc="useBaseInst",Ku="setInstFuncs",Ja=Object,qo=Ja.getPrototypeOf,Zu=0,vg={setInstFuncs:!0,useBaseInst:!0},ju[Vu]=vg,nr=ju}),Pe,Re,Oc=xe(()=>{(function(t){t[t.CRITICAL=1]="CRITICAL",t[t.WARNING=2]="WARNING"})(Pe||(Pe={})),Re={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103}});function Xu(t){return kc.toString.call(t)}function HC(t,e){return typeof t===e}function Fr(t){return t===void 0||typeof t===Xn}function Fe(t){return t===null||Fr(t)}function qC(t){return!Fe(t)}function Qu(t,e){return t&&Za.call(t,e)}function ro(t){return typeof t===Cn}function St(t){return typeof t===Oo}function es(t,e,r,n){n===void 0&&(n=!1);var i=!1;if(!Fe(t))try{Fe(t[id])?Fe(t[nd])||(t[nd](rd+e,r),i=!0):(t[id](e,r,n),i=!0)}catch(o){}return i}function wg(t,e,r,n){if(n===void 0&&(n=!1),!Fe(t))try{Fe(t[ad])?Fe(t[od])||t[od](rd+e,r):t[ad](e,r,n)}catch(i){}}function WC(t){var e=t,r=/([^\w\d_$])/g;return r.test(t)&&(e=t.replace(r,"_")),e}function cr(t,e){if(t)for(var r in t)Za.call(t,r)&&e.call(t,r,t[r])}function zC(t,e){if(t&&e){var r=e.length,n=t.length;if(t===e)return!0;if(n>=r){for(var i=n-1,o=r-1;o>=0;o--){if(t[i]!=e[o])return!1;i--}return!0}}return!1}function Cr(t,e){return t&&e?t.indexOf(e)!==-1:!1}function Yu(t){return Xu(t)==="[object Date]"}function Yn(t){return Xu(t)==="[object Array]"}function Uc(t){return Xu(t)==="[object Error]"}function pt(t){return typeof t=="string"}function Ju(t){return typeof t=="number"}function ed(t){return typeof t=="boolean"}function xi(t){if(Yu(t)){var e=function(r){var n=String(r);return n.length===1&&(n="0"+n),n};return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"."+String((t.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}function gt(t,e,r){for(var n=t.length,i=0;i<n&&!(i in t&&e.call(r||t,t[i],i,t)===-1);i++);}function ts(t,e,r){for(var n=t.length,i=r||0,o=Math.max(i>=0?i:n-Math.abs(i),0);o<n;o++)if(o in t&&t[o]===e)return o;return-1}function rs(t,e,r){for(var n=t.length,i=r||t,o=new Array(n),a=0;a<n;a++)a in t&&(o[a]=e.call(i,t[a],t));return o}function yg(t,e,r){var n=t.length,i=0,o;if(arguments.length>=3)o=arguments[2];else{for(;i<n&&!(i in t);)i++;o=t[i++]}for(;i<n;)i in t&&(o=e(o,t[i],i,t)),i++;return o}function wr(t){return typeof t!="string"?t:t.replace(/^\s+|\s+$/g,"")}function no(t){var e=typeof t;e!==Oo&&(e!==Cn||t===null)&&Lu("objKeys called on non-object");var r=[];for(var n in t)t&&Za.call(t,n)&&r.push(n);if(Sg)for(var i=Lc.length,o=0;o<i;o++)t&&Za.call(t,Lc[o])&&r.push(Lc[o]);return r}function Wo(t,e,r,n){if(sd)try{var i={enumerable:!0,configurable:!0};return r&&(i.get=r),n&&(i.set=n),sd(t,e,i),!0}catch(o){}return!1}function Jr(){var t=Date;return t.now?t.now():new t().getTime()}function At(t){return Uc(t)?t.name:""}function Ct(t,e,r,n,i){var o=r;return t&&(o=t[e],o!==r&&(!i||i(o))&&(!n||n(r))&&(o=r,t[e]=o)),o}function Er(t,e,r){var n;return t?(n=t[e],!n&&Fe(n)&&(n=Fr(r)?{}:r,t[e]=n)):n=Fr(r)?{}:r,n}function bg(t){return!t}function td(t){return!!t}function Rn(t){throw new Error(t)}function _g(t,e,r){if(t&&e&&t!==e&&ro(t)&&ro(e)){var n=function(o){if(pt(o)){var a=e[o];St(a)?(!r||r(o,!0,e,t))&&(t[o]=function(s){return function(){var c=arguments;return e[s].apply(e,c)}}(o)):(!r||r(o,!1,e,t))&&(Qu(t,o)&&delete t[o],Wo(t,o,function(){return e[o]},function(s){e[o]=s})||(t[o]=a))}};for(var i in e)n(i)}return t}function jC(t){return function(){function e(){var r=this;t&&cr(t,function(n,i){r[n]=i})}return e}()}function xg(t){return t&&(t=Qn(Ic?Ic({},t):t)),t}var rd,nd,id,od,ad,sd,VC,GC,Sg,Lc,Rr=xe(()=>{Ut(),rd="on",nd="attachEvent",id="addEventListener",od="detachEvent",ad="removeEventListener",sd=dg,VC=Qn.freeze,GC=Qn.seal,Sg=!{toString:null}.propertyIsEnumerable("toString"),Lc=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]});function Ar(t){var e=Uo();return e&&e[t]?e[t]:t===ld&&Hc()?window:null}function Hc(){return Boolean(typeof window===Cn&&window)}function ns(){return Hc()?window:Ar(ld)}function Cg(){return Boolean(typeof document===Cn&&document)}function An(){return Cg()?document:Ar(Eg)}function KC(){return Boolean(typeof navigator===Cn&&navigator)}function Tn(){return KC()?navigator:Ar(Rg)}function ZC(){return Boolean(typeof history===Cn&&history)}function XC(){return ZC()?history:Ar(Ag)}function io(t){if(t&&Ng){var e=Ar("__mockLocation");if(e)return e}return typeof location===Cn&&location?location:Ar(Tg)}function QC(){return typeof console!==Xn?console:Ar(kg)}function Jn(){return Ar(Ig)}function zo(){return Boolean(typeof JSON===Cn&&JSON||Ar(ud)!==null)}function hn(){return zo()?JSON||Ar(ud):null}function YC(){return Ar(Dg)}function JC(){return Ar(Pg)}function e1(){var t=Tn();return t&&t.product?t.product===Fg:!1}function qc(){var t=Tn();if(t&&(t.userAgent!==Vc||jc===null)){Vc=t.userAgent;var e=(Vc||"").toLowerCase();jc=Cr(e,Wc)||Cr(e,zc)}return jc}function cd(t){if(t===void 0&&(t=null),!t){var e=Tn()||{};t=e?(e.userAgent||"").toLowerCase():""}var r=(t||"").toLowerCase();if(Cr(r,Wc))return parseInt(r.split(Wc)[1]);if(Cr(r,zc)){var n=parseInt(r.split(zc)[1]);if(n)return n+4}return null}function lt(t){var e=Object[Xr].toString.call(t),r="";return e==="[object Error]"?r="{ stack: '"+t.stack+"', message: '"+t.message+"', name: '"+t.name+"'":zo()&&(r=hn().stringify(t)),e+r}var ld,Eg,Rg,Ag,Tg,kg,Ig,ud,Dg,Pg,Fg,Wc,zc,jc,Vc,Ng,is=xe(()=>{Ut(),Rr(),ld="window",Eg="document",Rg="navigator",Ag="history",Tg="location",kg="console",Ig="performance",ud="JSON",Dg="crypto",Pg="msCrypto",Fg="ReactNative",Wc="msie",zc="trident/",jc=null,Vc=null,Ng=!1});function $g(t){return t?'"'+t.replace(/\"/g,"")+'"':""}function Gc(t,e){return(t||{}).logger||new dd(e)}var Mg,Bg,Og,jo,dd,hd=xe(()=>{Oc(),is(),pr(),Rr(),Mg="AI (Internal): ",Bg="AI: ",Og="AITR_",jo=function(){function t(e,r,n,i){n===void 0&&(n=!1);var o=this;o.messageId=e,o.message=(n?Bg:Mg)+e;var a="";zo()&&(a=hn().stringify(i));var s=(r?" message:"+$g(r):"")+(i?" props:"+$g(a):"");o.message+=s}return t.dataType="MessageData",t}(),dd=function(){function t(e){this.identifier="DiagnosticLogger",this.queue=[];var r=0,n={};nr(t,this,function(i){Fe(e)&&(e={}),i.consoleLoggingLevel=function(){return o("loggingLevelConsole",0)},i.telemetryLoggingLevel=function(){return o("loggingLevelTelemetry",1)},i.maxInternalMessageLimit=function(){return o("maxMessageLimit",25)},i.enableDebugExceptions=function(){return o("enableDebugExceptions",!1)},i.throwInternal=function(s,c,l,u,f){f===void 0&&(f=!1);var h=new jo(c,l,f,u);if(i.enableDebugExceptions())throw h;if(!Fr(h.message)){var p=i.consoleLoggingLevel();if(f){var b=+h.messageId;!n[b]&&p>=Pe.WARNING&&(i.warnToConsole(h.message),n[b]=!0)}else p>=Pe.WARNING&&i.warnToConsole(h.message);i.logInternalMessage(s,h)}},i.warnToConsole=function(s){var c=QC();if(c){var l="log";c.warn&&(l="warn"),St(c[l])&&c[l](s)}},i.resetInternalMessageCount=function(){r=0,n={}},i.logInternalMessage=function(s,c){if(!a()){var l=!0,u=Og+c.messageId;if(n[u]?l=!1:n[u]=!0,l&&(s<=i.telemetryLoggingLevel()&&(i.queue.push(c),r++),r===i.maxInternalMessageLimit())){var f="Internal events throttle limit per PageView reached for this app.",h=new jo(Re.MessageLimitPerPVExceeded,f,!1);i.queue.push(h),i.warnToConsole(f)}}};function o(s,c){var l=e[s];return Fe(l)?c:l}function a(){return r>=i.maxInternalMessageLimit()}})}return t}()});function Vo(t,e,r,n,i){if(t){var o=t;if(St(o.getPerfMgr)&&(o=o.getPerfMgr()),o){var a=void 0,s=o.getCtx(Kc);try{if(a=o.create(e(),n,i),a){if(s&&a.setCtx&&(a.setCtx(Go.ParentContextKey,s),s.getCtx&&s.setCtx)){var c=s.getCtx(Go.ChildrenContextKey);c||(c=[],s.setCtx(Go.ChildrenContextKey,c)),c.push(a)}return o.setCtx(Kc,a),r(a)}}catch(l){a&&a.setCtx&&a.setCtx("exception",l)}finally{a&&o.fire(a),o.setCtx(Kc,s)}}}return r()}var oo,Go,fd,Kc,Zc=xe(()=>{pr(),Rr(),oo="ctx",Go=function(){function t(e,r,n){var i=this,o=!1;if(i.start=Jr(),i.name=e,i.isAsync=n,i.isChildEvt=function(){return!1},St(r)){var a;o=Wo(i,"payload",function(){return!a&&St(r)&&(a=r(),r=null),a})}i.getCtx=function(s){return s?s===t.ParentContextKey||s===t.ChildrenContextKey?i[s]:(i[oo]||{})[s]:null},i.setCtx=function(s,c){if(s)if(s===t.ParentContextKey)i[s]||(i.isChildEvt=function(){return!0}),i[s]=c;else if(s===t.ChildrenContextKey)i[s]=c;else{var l=i[oo]=i[oo]||{};l[s]=c}},i.complete=function(){var s=0,c=i.getCtx(t.ChildrenContextKey);if(Yn(c))for(var l=0;l<c.length;l++){var u=c[l];u&&(s+=u.time)}i.time=Jr()-i.start,i.exTime=i.time-s,i.complete=function(){},!o&&St(r)&&(i.payload=r())}}return t.ParentContextKey="parent",t.ChildrenContextKey="childEvts",t}(),fd=function(){function t(e){this.ctx={},nr(t,this,function(r){r.create=function(n,i,o){return new Go(n,i,o)},r.fire=function(n){n&&(n.complete(),e&&e.perfEvent(n))},r.setCtx=function(n,i){if(n){var o=r[oo]=r[oo]||{};o[n]=i}},r.getCtx=function(n){return(r[oo]||{})[n]}})}return t}(),Kc="CoreUtils.doPerf"}),Ug,t1=xe(()=>{Zc(),Oc(),Rr(),Ug=function(){function t(e,r){var n=this,i=null,o=St(e.processTelemetry),a=St(e.setNextPlugin);n._hasRun=!1,n.getPlugin=function(){return e},n.getNext=function(){return i},n.setNext=function(s){i=s},n.processTelemetry=function(s,c){c||(c=r);var l=e?e.identifier:"TelemetryPluginChain";Vo(c?c.core():null,function(){return l+":processTelemetry"},function(){if(e&&o){n._hasRun=!0;try{c.setNext(i),a&&e.setNextPlugin(i),i&&(i._hasRun=!1),e.processTelemetry(s,c)}catch(f){var u=i&&i._hasRun;(!i||!u)&&c.diagLog().throwInternal(Pe.CRITICAL,Re.PluginException,"Plugin ["+e.identifier+"] failed during processTelemetry - "+f),i&&!u&&i.processTelemetry(s,c)}}else i&&(n._hasRun=!0,i.processTelemetry(s,c))},function(){return{item:s}},!s.sync)}}return t}()});function pd(t,e){var r=[];if(t&&t.length>0)for(var n=null,i=0;i<t.length;i++){var o=t[i];if(o&&St(o.processTelemetry)){var a=new Ug(o,e);r.push(a),n&&n.setNext(a),n=a}}return r.length>0?r[0]:null}function r1(t,e,r){var n=[],i=!r;if(t)for(;t;){var o=t.getPlugin();(i||o===r)&&(i=!0,n.push(o)),t=t.getNext()}return i||n.push(r),pd(n,e)}function n1(t,e,r){var n=t,i=!1;return r&&t&&(n=[],gt(t,function(o){(i||o===r)&&(i=!0,n.push(o))})),r&&!i&&(n||(n=[]),n.push(r)),pd(n,e)}var ao,gd=xe(()=>{hd(),t1(),Rr(),ao=function(){function t(e,r,n,i){var o=this,a=null;i!==null&&(e&&St(e.getPlugin)?a=r1(e,o,i||e.getPlugin()):i?a=n1(e,o,i):Fr(i)&&(a=pd(e,o))),o.core=function(){return n},o.diagLog=function(){return Gc(n,r)},o.getCfg=function(){return r},o.getExtCfg=function(s,c){c===void 0&&(c={});var l;if(r){var u=r.extensionConfig;u&&s&&(l=u[s])}return l||c},o.getConfig=function(s,c,l){l===void 0&&(l=!1);var u,f=o.getExtCfg(s,null);return f&&!Fe(f[c])?u=f[c]:r&&!Fe(r[c])&&(u=r[c]),Fe(u)?l:u},o.hasNext=function(){return a!=null},o.getNext=function(){return a},o.setNext=function(s){a=s},o.processNext=function(s){var c=a;c&&(a=c.getNext(),c.processTelemetry(s,o))},o.createNew=function(s,c){return s===void 0&&(s=null),new t(s||a,r,n,c)}}return t}()}),Lg,md,Hg=xe(()=>{Lg="iKey",md="extensionConfig"}),os,so,qg=xe(()=>{gd(),Rr(),Hg(),os="getPlugin",so=function(){function t(){var e=this,r=!1,n=null,i=null;e.core=null,e.diagLog=function(o){return e._getTelCtx(o).diagLog()},e.isInitialized=function(){return r},e.setInitialized=function(o){r=o},e.setNextPlugin=function(o){i=o},e.processNext=function(o,a){a?a.processNext(o):i&&St(i.processTelemetry)&&i.processTelemetry(o,null)},e._getTelCtx=function(o){o===void 0&&(o=null);var a=o;if(!a){var s=n||new ao(null,{},e.core);i&&i[os]?a=s.createNew(null,i[os]):a=s.createNew(null,i)}return a},e._baseTelInit=function(o,a,s,c){o&&Ct(o,md,[],null,Fe),!c&&a&&(c=a.getProcessTelContext().getNext());var l=i;i&&i[os]&&(l=i[os]()),e.core=a,n=new ao(c,o,a,l),r=!0}}return t.prototype.initialize=function(e,r,n,i){this._baseTelInit(e,r,n,i)},t}()});function vd(t,e){for(var r=[],n=null,i=t.getNext();i;){var o=i.getPlugin();o&&(n&&St(n[yd])&&St(o[Xc])&&n[yd](o),(!St(o[bd])||!o[bd]())&&r.push(o),n=o,i=i.getNext())}gt(r,function(a){a.initialize(t.getCfg(),t.core(),e,t.getNext())})}function Wg(t){return t.sort(function(e,r){var n=0,i=St(r[Xc]);return St(e[Xc])?n=i?e[wd]-r[wd]:1:i&&(n=-1),n})}var Xc,wd,yd,bd,zg=xe(()=>{Rr(),Xc="processTelemetry",wd="priority",yd="setNextPlugin",bd="isInitialized"}),Qc,jg,Vg,i1=xe(()=>{Ut(),pr(),qg(),gd(),zg(),Rr(),Qc=500,jg="Channel has invalid priority",Vg=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.identifier="ChannelControllerPlugin",r.priority=Qc;var n;nr(e,r,function(s,c){s.setNextPlugin=function(l){},s.processTelemetry=function(l,u){n&&gt(n,function(f){if(f.length>0){var h=r._getTelCtx(u).createNew(f);h.processNext(l)}})},s.getChannelControls=function(){return n},s.initialize=function(l,u,f){s.isInitialized()||(c.initialize(l,u,f),a((l||{}).channels,f),gt(n,function(h){return vd(new ao(h,l,u),f)}))}});function i(s){gt(s,function(c){c.priority<Qc&&Rn(jg+c.identifier)})}function o(s){s&&s.length>0&&(s=s.sort(function(c,l){return c.priority-l.priority}),i(s),n.push(s))}function a(s,c){if(n=[],s&&gt(s,function(u){return o(u)}),c){var l=[];gt(c,function(u){u.priority>Qc&&l.push(u)}),o(l)}}return r}return e._staticInit=function(){var r=e.prototype;Wo(r,"ChannelControls",r.getChannelControls),Wo(r,"channelQueue",r.getChannelControls)}(),e}(so)});function Gg(t,e){var r=as[ei]||cs[ei];return r||(r=as[ei]=as(t,e),cs[ei]=r),r}function Yc(t){return t?t.isEnabled():!0}function o1(t){var e=t.cookieCfg=t.cookieCfg||{};if(Ct(e,"domain",t.cookieDomain,qC,Fe),Ct(e,"path",t.cookiePath||"/",null,Fe),Fe(e[tl])){var r=void 0;Fr(t[Cd])||(r=!t[Cd]),Fr(t[Ed])||(r=!t[Ed]),e[tl]=r}return e}function _d(t,e){var r;if(t)r=t.getCookieMgr();else if(e){var n=e.cookieCfg;n[ei]?r=n[ei]:r=as(e)}return r||(r=Gg(e,(t||{}).logger)),r}function as(t,e){var r=o1(t||cs),n=r.path||"/",i=r.domain,o=r[tl]!==!1,a={isEnabled:function(){var s=o&&Kg(e),c=cs[ei];return s&&c&&a!==c&&(s=Yc(c)),s},setEnabled:function(s){o=s!==!1},set:function(s,c,l,u,f){if(Yc(a)){var h={},p=wr(c||en),b=p.indexOf(";");if(b!==-1&&(p=wr(c.substring(0,b)),h=Zg(c.substring(b+1))),Ct(h,"domain",u||i,td,Fr),!Fe(l)){var y=qc();if(Fr(h[el])){var w=Jr(),_=w+l*1e3;if(_>0){var S=new Date;S.setTime(_),Ct(h,el,Xg(S,y?xd:Sd)||Xg(S,y?xd:Sd)||en,td)}}y||Ct(h,"max-age",en+l,null,Fr)}var I=io();I&&I.protocol==="https:"&&(Ct(h,"secure",null,null,Fr),rl===null&&(rl=!Jg((Tn()||{}).userAgent)),rl&&Ct(h,"SameSite","None",null,Fr)),Ct(h,"path",f||n,null,Fr);var D=r.setCookie||Yg;D(s,Qg(p,h))}},get:function(s){var c=en;return Yc(a)&&(c=(r.getCookie||a1)(s)),c},del:function(s,c){Yc(a)&&a.purge(s,c)},purge:function(s,c){if(Kg(e)){var l=(f={},f.path=c||"/",f[el]="Thu, 01 Jan 1970 00:00:01 GMT",f);qc()||(l["max-age"]="0");var u=r.delCookie||Yg;u(s,Qg(en,l))}var f}};return a[ei]=a,a}function Kg(t){if(ss===null){ss=!1;try{var e=Ko||{};ss=e[Jc]!==void 0}catch(r){t&&t.throwInternal(Pe.WARNING,Re.CannotAccessCookie,"Cannot access document.cookie - "+At(r),{exception:lt(r)})}}return ss}function Zg(t){var e={};if(t&&t.length){var r=wr(t).split(";");gt(r,function(n){if(n=wr(n||en),n){var i=n.indexOf("=");i===-1?e[n]=null:e[wr(n.substring(0,i))]=wr(n.substring(i+1))}})}return e}function Xg(t,e){return St(t[e])?t[e]():null}function Qg(t,e){var r=t||en;return cr(e,function(n,i){r+="; "+n+(Fe(i)?en:"="+i)}),r}function a1(t){var e=en;if(Ko){var r=Ko[Jc]||en;Rd!==r&&(Ad=Zg(r),Rd=r),e=wr(Ad[t]||en)}return e}function Yg(t,e){Ko&&(Ko[Jc]=t+"="+e)}function Jg(t){return pt(t)?!!(Cr(t,"CPU iPhone OS 12")||Cr(t,"iPad; CPU OS 12")||Cr(t,"Macintosh; Intel Mac OS X 10_14")&&Cr(t,"Version/")&&Cr(t,"Safari")||Cr(t,"Macintosh; Intel Mac OS X 10_14")&&zC(t,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||Cr(t,"Chrome/5")||Cr(t,"Chrome/6")||Cr(t,"UnrealEngine")&&!Cr(t,"Chrome")||Cr(t,"UCBrowser/12")||Cr(t,"UCBrowser/11")):!1}var xd,Sd,Jc,el,tl,Cd,Ed,ei,en,ss,rl,Rd,Ko,Ad,cs,Td=xe(()=>{Oc(),is(),Rr(),xd="toGMTString",Sd="toUTCString",Jc="cookie",el="expires",tl="enabled",Cd="isCookieUseDisabled",Ed="disableCookiesUsage",ei="_ckMgr",en="",ss=null,rl=null,Rd=null,Ko=An(),Ad={},cs={}}),em,kd,Id,tm=xe(()=>{Ut(),pr(),i1(),gd(),zg(),Zc(),Td(),Rr(),Hg(),em="Extensions must provide callback to initialize",kd="_notificationManager",Id=function(){function t(){var e=!1,r,n,i,o,a;nr(t,this,function(s){s._extensions=new Array,n=new Vg,s.logger=Dc({throwInternal:function(c,l,u,f,h){h===void 0&&(h=!1)},warnToConsole:function(c){},resetInternalMessageCount:function(){}}),r=[],s.isInitialized=function(){return e},s.initialize=function(c,l,u,f){s.isInitialized()&&Rn("Core should not be initialized more than once"),(!c||Fe(c.instrumentationKey))&&Rn("Please provide instrumentation key"),i=f,s[kd]=f,s.config=c||{},c.extensions=Fe(c.extensions)?[]:c.extensions;var h=Er(c,md);h.NotificationManager=f,u&&(s.logger=u);var p=[];p.push.apply(p,l.concat(c.extensions)),p=Wg(p);var b=[],y=[],w={};gt(p,function(_){(Fe(_)||Fe(_.initialize))&&Rn(em);var S=_.priority,I=_.identifier;_&&S&&(Fe(w[S])?w[S]=I:u.warnToConsole("Two extensions have same priority #"+S+" - "+w[S]+", "+I)),!S||S<n.priority?b.push(_):y.push(_)}),p.push(n),b.push(n),p=Wg(p),s._extensions=p,vd(new ao([n],c,s),p),vd(new ao(b,c,s),p),s._extensions=b,s.getTransmissionControls().length===0&&Rn("No channels available"),e=!0,s.releaseQueue()},s.getTransmissionControls=function(){return n.getChannelControls()},s.track=function(c){Ct(c,Lg,s.config.instrumentationKey,null,bg),Ct(c,"time",xi(new Date),null,bg),Ct(c,"ver","4.0",null,Fe),s.isInitialized()?s.getProcessTelContext().processNext(c):r.push(c)},s.getProcessTelContext=function(){var c=s._extensions,l=c;return(!c||c.length===0)&&(l=[n]),new ao(l,s.config,s)},s.getNotifyMgr=function(){return i||(i=Dc({addNotificationListener:function(c){},removeNotificationListener:function(c){},eventsSent:function(c){},eventsDiscarded:function(c,l){},eventsSendRequest:function(c,l){}}),s[kd]=i),i},s.getCookieMgr=function(){return a||(a=as(s.config,s.logger)),a},s.setCookieMgr=function(c){a=c},s.getPerfMgr=function(){return o||s.config&&s.config.enablePerfMgr&&(o=new fd(s.getNotifyMgr())),o},s.setPerfMgr=function(c){o=c},s.eventCnt=function(){return r.length},s.releaseQueue=function(){r.length>0&&(gt(r,function(c){s.getProcessTelContext().processNext(c)}),r=[])}})}return t}()}),Dd,rm=xe(()=>{pr(),Rr(),Dd=function(){function t(e){this.listeners=[];var r=!!(e||{}).perfEvtsSendAll;nr(t,this,function(n){n.addNotificationListener=function(i){n.listeners.push(i)},n.removeNotificationListener=function(i){for(var o=ts(n.listeners,i);o>-1;)n.listeners.splice(o,1),o=ts(n.listeners,i)},n.eventsSent=function(i){gt(n.listeners,function(o){o&&o.eventsSent&&setTimeout(function(){return o.eventsSent(i)},0)})},n.eventsDiscarded=function(i,o){gt(n.listeners,function(a){a&&a.eventsDiscarded&&setTimeout(function(){return a.eventsDiscarded(i,o)},0)})},n.eventsSendRequest=function(i,o){gt(n.listeners,function(a){if(a&&a.eventsSendRequest)if(o)setTimeout(function(){return a.eventsSendRequest(i,o)},0);else try{a.eventsSendRequest(i,o)}catch(s){}})},n.perfEvent=function(i){i&&(r||!i.isChildEvt())&&gt(n.listeners,function(o){if(o&&o.perfEvent)if(i.isAsync)setTimeout(function(){return o.perfEvent(i)},0);else try{o.perfEvent(i)}catch(a){}})}})}return t}()}),Pd,s1=xe(()=>{Ut(),tm(),IC(),rm(),Zc(),hd(),pr(),Rr(),Pd=function(t){Nt(e,t);function e(){var r=t.call(this)||this;return nr(e,r,function(n,i){n.initialize=function(s,c,l,u){i.initialize(s,c,l||new dd(s),u||new Dd(s))},n.track=function(s){Vo(n.getPerfMgr(),function(){return"AppInsightsCore:track"},function(){s===null&&(a(s),Rn("Invalid telemetry item")),o(s),i.track(s)},function(){return{item:s}},!s.sync)},n.addNotificationListener=function(s){var c=n.getNotifyMgr();c&&c.addNotificationListener(s)},n.removeNotificationListener=function(s){var c=n.getNotifyMgr();c&&c.removeNotificationListener(s)},n.pollInternalLogs=function(s){var c=n.config.diagnosticLogInterval;return(!c||!(c>0))&&(c=1e4),setInterval(function(){var l=n.logger?n.logger.queue:[];gt(l,function(u){var f={name:s||"InternalMessageId: "+u.messageId,iKey:n.config.instrumentationKey,time:xi(new Date),baseType:jo.dataType,baseData:{message:u.message}};n.track(f)}),l.length=0},c)};function o(s){if(Fe(s.name))throw a(s),Error("telemetry name required")}function a(s){var c=n.getNotifyMgr();c&&c.eventsDiscarded([s],lg.InvalidEvent)}}),r}return e}(Id)});function nm(t){t<0&&(t>>>=0),Zo=123456789+t&ti,Xo=987654321-t&ti,Nd=!0}function im(){try{var t=Jr()&2147483647;nm((Math.random()*Fd^t)+t)}catch(e){}}function om(t){return t>0?Math.floor(co()/ti*(t+1))>>>0:0}function co(t){var e,r=YC()||JC();return r&&r.getRandomValues?e=r.getRandomValues(new Uint32Array(1))[0]&ti:qc()?(Nd||im(),e=am()&ti):e=Math.floor(Fd*Math.random()|0),t||(e>>>=0),e}function c1(t){t?nm(t):im()}function am(t){Xo=36969*(Xo&65535)+(Xo>>16)&ti,Zo=18e3*(Zo&65535)+(Zo>>16)&ti;var e=(Xo<<16)+(Zo&65535)>>>0&ti|0;return t||(e>>>=0),e}var Fd,ti,Nd,Zo,Xo,sm=xe(()=>{is(),Rr(),Fd=4294967296,ti=4294967295,Nd=!1,Zo=123456789,Xo=987654321});function lo(t,e){var r=!1,n=ns();n&&(r=es(n,t,e),r=es(n.body,t,e)||r);var i=An();return i&&(r=us.Attach(i,t,e)||r),r}function l1(){function t(){return om(15)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(lm,function(e){var r=t()|0,n=e==="x"?r:r&3|8;return n.toString(16)})}function u1(){var t=Jn();return t&&t.now?t.now():Jr()}function nl(t){t===void 0&&(t=22);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=co()>>>0,n=0,i="";i.length<t;)n++,i+=e.charAt(r&63),r>>>=6,n===5&&(r=(co()<<2&4294967295|r&3)>>>0,n=0);return i}function kn(){for(var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],e="",r,n=0;n<4;n++)r=co(),e+=t[r&15]+t[r>>4&15]+t[r>>8&15]+t[r>>12&15]+t[r>>16&15]+t[r>>20&15]+t[r>>24&15]+t[r>>28&15];var i=t[8+(co()&3)|0];return e.substr(0,8)+e.substr(9,4)+"4"+e.substr(13,3)+i+e.substr(16,3)+e.substr(19,12)}function Qo(t,e){var r=Gg(t,e),n=il._canUseCookies;return Yo===null&&(Yo=[],ls=n,Wo(il,"_canUseCookies",function(){return ls},function(i){ls=i,gt(Yo,function(o){o.setEnabled(i)})})),ts(Yo,r)===-1&&Yo.push(r),ed(n)&&r.setEnabled(n),ed(ls)&&r.setEnabled(ls),r}function cm(){Qo().setEnabled(!1)}function d1(t){return Qo(null,t).isEnabled()}function h1(t,e){return Qo(null,t).get(e)}function f1(t,e,r,n){Qo(null,t).set(e,r,null,n)}function p1(t,e){return Qo(null,t).del(e)}var Yo,ls,il,lm,us,g1=xe(()=>{Ut(),Td(),is(),Rr(),sm(),Yo=null,il={_canUseCookies:void 0,isTypeof:HC,isUndefined:Fr,isNullOrUndefined:Fe,hasOwnProperty:Qu,isFunction:St,isObject:ro,isDate:Yu,isArray:Yn,isError:Uc,isString:pt,isNumber:Ju,isBoolean:ed,toISOString:xi,arrForEach:gt,arrIndexOf:ts,arrMap:rs,arrReduce:yg,strTrim:wr,objCreate:Dc,objKeys:no,objDefineAccessors:Wo,addEventHandler:lo,dateNow:Jr,isIE:qc,disableCookies:cm,newGuid:l1,perfNow:u1,newId:nl,randomValue:om,random32:co,mwcRandomSeed:c1,mwcRandom32:am,generateW3CId:kn},lm=/[xy]/g,us={Attach:es,AttachEvent:es,Detach:wg,DetachEvent:wg}});function $d(t,e){if(t)for(var r=0;r<t.length&&!e(t[r],r);r++);}function Md(t,e,r,n,i){i>=0&&i<=2&&$d(t,function(o,a){var s=o.cbks,c=s[Ud[i]];if(c){e.ctx=function(){var f=n[a]=n[a]||{};return f};try{c.apply(e.inst,r)}catch(f){var l=e.err;try{var u=s[Ud[2]];u&&(e.err=f,u.apply(e.inst,r))}catch(h){}finally{e.err=l}}}})}function m1(t){return function(){var e=this,r=arguments,n=t.h,i={name:t.n,inst:e,ctx:null,set:c},o=[],a=s([i],r);function s(u,f){return $d(f,function(h){u.push(h)}),u}function c(u,f){r=s([],r),r[u]=f,a=s([i],r)}Md(n,i,a,o,0);var l=t.f;try{i.rslt=l.apply(e,r)}catch(u){throw i.err=u,Md(n,i,a,o,3),u}return Md(n,i,a,o,1),i.rslt}}function v1(t){if(t){if(Ld)return Ld(t);var e=t[dm]||t[Xr]||t[hm];if(e)return e}return null}function um(t,e,r){var n=null;return t&&(Qu(t,e)?n=t:r&&(n=um(v1(t),e,!1))),n}function w1(t,e,r){return t?Bd(t[Xr],e,r,!1):null}function Bd(t,e,r,n){if(n===void 0&&(n=!0),t&&e&&r){var i=um(t,e,n);if(i){var o=i[e];if(typeof o===Oo){var a=o[Od];if(!a){a={i:0,n:e,f:o,h:[]};var s=m1(a);s[Od]=a,i[e]=s}var c={id:a.i,cbks:r,rm:function(){var l=this.id;$d(a.h,function(u,f){if(u.id===l)return a.h.splice(f,1),1})}};return a.i++,a.h.push(c),c}}}return null}var Od,Ud,dm,hm,Ld,y1=xe(()=>{Ut(),Rr(),Od="_aiHooks",Ud=["req","rsp","hkErr","fnErr"],dm="__proto__",hm="constructor",Ld=Object.getPrototypeOf}),wt=xe(()=>{s1(),tm(),qg(),sm(),g1(),Rr(),is(),Ut(),rm(),Zc(),hd(),Oc(),y1(),Td()}),Wt,fm=xe(()=>{Wt={requestContextHeader:"Request-Context",requestContextTargetKey:"appId",requestContextAppIdFormat:"appId=cid-v1:",requestIdHeader:"Request-Id",traceParentHeader:"traceparent",traceStateHeader:"tracestate",sdkContextHeader:"Sdk-Context",sdkContextHeaderAppIdRequest:"appId",requestContextHeaderLowerCase:"request-context"}});function Hd(t,e,r){var n=e.length,i=pm(t,e);if(i.length!==n){for(var o=0,a=i;r[a]!==void 0;)o++,a=i.substring(0,150-3)+vm(o);i=a}return i}function pm(t,e){var r;return e&&(e=wr(e.toString()),e.length>150&&(r=e.substring(0,150),t.throwInternal(Pe.WARNING,Re.NameTooLong,"name is too long.  It has been truncated to "+150+" characters.",{name:e},!0))),r||e}function Nr(t,e,r){r===void 0&&(r=1024);var n;return e&&(r=r||1024,e=wr(e),e.toString().length>r&&(n=e.toString().substring(0,r),t.throwInternal(Pe.WARNING,Re.StringValueTooLong,"string value is too long. It has been truncated to "+r+" characters.",{value:e},!0))),n||e}function ds(t,e){return Wd(t,e,2048,Re.UrlTooLong)}function qd(t,e){var r;return e&&e.length>32768&&(r=e.substring(0,32768),t.throwInternal(Pe.WARNING,Re.MessageTruncated,"message is too long, it has been truncated to "+32768+" characters.",{message:e},!0)),r||e}function gm(t,e){var r;if(e){var n=""+e;n.length>32768&&(r=n.substring(0,32768),t.throwInternal(Pe.WARNING,Re.ExceptionTruncated,"exception is too long, it has been truncated to "+32768+" characters.",{exception:e},!0))}return r||e}function Si(t,e){if(e){var r={};cr(e,function(n,i){if(ro(i)&&zo())try{i=hn().stringify(i)}catch(o){t.throwInternal(Pe.WARNING,Re.CannotSerializeObjectNonSerializable,"custom property is not valid",{exception:o},!0)}i=Nr(t,i,8192),n=Hd(t,n,r),r[n]=i}),e=r}return e}function Ci(t,e){if(e){var r={};cr(e,function(n,i){n=Hd(t,n,r),r[n]=i}),e=r}return e}function mm(t,e){return e&&Wd(t,e,128,Re.IdTooLong).toString()}function Wd(t,e,r,n){var i;return e&&(e=wr(e),e.length>r&&(i=e.substring(0,r),t.throwInternal(Pe.WARNING,n,"input is too long, it has been truncated to "+r+" characters.",{data:e},!0))),i||e}function vm(t){var e="00"+t;return e.substr(e.length-3)}var wm,fn=xe(()=>{wt(),wm={MAX_NAME_LENGTH:150,MAX_ID_LENGTH:128,MAX_PROPERTY_LENGTH:8192,MAX_STRING_LENGTH:1024,MAX_URL_LENGTH:2048,MAX_MESSAGE_LENGTH:32768,MAX_EXCEPTION_LENGTH:32768,sanitizeKeyAndAddUniqueness:Hd,sanitizeKey:pm,sanitizeString:Nr,sanitizeUrl:ds,sanitizeMessage:qd,sanitizeException:gm,sanitizeProperties:Si,sanitizeMeasurements:Ci,sanitizeId:mm,sanitizeInput:Wd,padNumber:vm,trim:wr}});function Jo(t){var e=null;if(St(Event))e=new Event(t);else{var r=An();r&&r.createEvent&&(e=r.createEvent("Event"),e.initEvent(t,!0,!0))}return e}var ym=xe(()=>{wt()});function Mt(t,e){return e===void 0&&(e=!1),t==null?e:t.toString().toLowerCase()==="true"}function ri(t){(isNaN(t)||t<0)&&(t=0),t=Math.round(t);var e=""+t%1e3,r=""+Math.floor(t/1e3)%60,n=""+Math.floor(t/(1e3*60))%60,i=""+Math.floor(t/(1e3*60*60))%24,o=Math.floor(t/(1e3*60*60*24));return e=e.length===1?"00"+e:e.length===2?"0"+e:e,r=r.length<2?"0"+r:r,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i,(o>0?o+".":"")+i+":"+n+":"+r+"."+e}function zd(){var t=Tn();return"sendBeacon"in t&&t.sendBeacon}function bm(t,e){var r=null;return gt(t,function(n){if(n.identifier===e)return r=n,-1}),r}function _m(t,e,r,n,i){return!i&&pt(t)&&(t==="Script error."||t==="Script error")}var ol=xe(()=>{wt()}),uo,al,ea,sl,jd,tn,pn=xe(()=>{uo="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",al="sampleRate",ea="ProcessLegacy",sl="http.method",jd="https://dc.services.visualstudio.com",tn="not_specified"}),ho,gn,xm=xe(()=>{(function(t){t[t.LocalStorage=0]="LocalStorage",t[t.SessionStorage=1]="SessionStorage"})(ho||(ho={})),function(t){t[t.AI=0]="AI",t[t.AI_AND_W3C=1]="AI_AND_W3C",t[t.W3C=2]="W3C"}(gn||(gn={}))});function Vd(){return Kd()?cl(ho.LocalStorage):null}function cl(t){try{if(Fe(Uo()))return null;var e=new Date,r=Ar(t===ho.LocalStorage?"localStorage":"sessionStorage");r.setItem(e.toString(),e.toString());var n=r.getItem(e.toString())!==e.toString();if(r.removeItem(e.toString()),!n)return r}catch(i){}return null}function Gd(){return ta()?cl(ho.SessionStorage):null}function Sm(){Ei=!1,Ri=!1}function Kd(){return Ei===void 0&&(Ei=!!cl(ho.LocalStorage)),Ei}function Cm(t,e){var r=Vd();if(r!==null)try{return r.getItem(e)}catch(n){Ei=!1,t.throwInternal(Pe.WARNING,Re.BrowserCannotReadLocalStorage,"Browser failed read of local storage. "+At(n),{exception:lt(n)})}return null}function Em(t,e,r){var n=Vd();if(n!==null)try{return n.setItem(e,r),!0}catch(i){Ei=!1,t.throwInternal(Pe.WARNING,Re.BrowserCannotWriteLocalStorage,"Browser failed write to local storage. "+At(i),{exception:lt(i)})}return!1}function Rm(t,e){var r=Vd();if(r!==null)try{return r.removeItem(e),!0}catch(n){Ei=!1,t.throwInternal(Pe.WARNING,Re.BrowserFailedRemovalFromLocalStorage,"Browser failed removal of local storage item. "+At(n),{exception:lt(n)})}return!1}function ta(){return Ri===void 0&&(Ri=!!cl(ho.SessionStorage)),Ri}function b1(){var t=[];return ta()&&cr(Ar("sessionStorage"),function(e){t.push(e)}),t}function ll(t,e){var r=Gd();if(r!==null)try{return r.getItem(e)}catch(n){Ri=!1,t.throwInternal(Pe.WARNING,Re.BrowserCannotReadSessionStorage,"Browser failed read of session storage. "+At(n),{exception:lt(n)})}return null}function ul(t,e,r){var n=Gd();if(n!==null)try{return n.setItem(e,r),!0}catch(i){Ri=!1,t.throwInternal(Pe.WARNING,Re.BrowserCannotWriteSessionStorage,"Browser failed write to session storage. "+At(i),{exception:lt(i)})}return!1}function Am(t,e){var r=Gd();if(r!==null)try{return r.removeItem(e),!0}catch(n){Ri=!1,t.throwInternal(Pe.WARNING,Re.BrowserFailedRemovalFromSessionStorage,"Browser failed removal of session storage item. "+At(n),{exception:lt(n)})}return!1}var Ei,Ri,Tm=xe(()=>{wt(),xm(),Ei=void 0,Ri=void 0});function hs(t){var e=Qd,r=Pm,n=r[e];return Xd.createElement?r[e]||(n=r[e]=Xd.createElement("a")):n={host:Dm(t,!0)},n.href=t,e++,e>=r.length&&(e=0),Qd=e,n}function km(t){var e,r=hs(t);return r&&(e=r.href),e}function _1(t){var e,r=hs(t);return r&&(e=r.pathname),e}function Im(t,e){return t?t.toUpperCase()+" "+e:e}function Dm(t,e){var r=Zd(t,e)||"";if(r){var n=r.match(/(www[0-9]?\.)?(.[^/:]+)(\:[\d]+)?/i);if(n!=null&&n.length>3&&pt(n[2])&&n[2].length>0)return n[2]+(n[3]||"")}return r}function Zd(t,e){var r=null;if(t){var n=t.match(/(\w*):\/\/(.[^/:]+)(\:[\d]+)?/i);if(n!=null&&n.length>2&&pt(n[2])&&n[2].length>0&&(r=n[2]||"",e&&n.length>2)){var i=(n[1]||"").toLowerCase(),o=n[3]||"";(i==="http"&&o===":80"||i==="https"&&o===":443")&&(o=""),r+=o}}return r}var Xd,Qd,Pm,Fm=xe(()=>{wt(),Xd=An()||{},Qd=0,Pm=[null,null,null,null,null]});function dl(t){return Nm.indexOf(t.toLowerCase())!==-1}function x1(t,e,r,n){var i,o=n,a=n;if(e&&e.length>0){var s=hs(e);if(i=s.host,!o)if(s.pathname!=null){var c=s.pathname.length===0?"/":s.pathname;c.charAt(0)!=="/"&&(c="/"+c),a=s.pathname,o=Nr(t,r?r+" "+c:c)}else o=Nr(t,e)}else i=n,o=n;return{target:i,name:o,data:a}}function fs(){var t=Jn();if(t&&t.now&&t.timing){var e=t.now()+t.timing.navigationStart;if(e>0)return e}return Jr()}function $r(t,e){var r=null;return t!==0&&e!==0&&!Fe(t)&&!Fe(e)&&(r=e-t),r}var Nm,Yd,$m,Ai,Mm,Bm=xe(()=>{wt(),fm(),fn(),ym(),ol(),pn(),Tm(),Fm(),Nm=["https://dc.services.visualstudio.com/v2/track","https://breeze.aimon.applicationinsights.io/v2/track","https://dc-int.services.visualstudio.com/v2/track"],Yd={NotSpecified:tn,createDomEvent:Jo,disableStorage:Sm,isInternalApplicationInsightsEndpoint:dl,canUseLocalStorage:Kd,getStorage:Cm,setStorage:Em,removeStorage:Rm,canUseSessionStorage:ta,getSessionStorageKeys:b1,getSessionStorage:ll,setSessionStorage:ul,removeSessionStorage:Am,disableCookies:cm,canUseCookies:d1,disallowsSameSiteNone:Jg,setCookie:f1,stringToBoolOrDefault:Mt,getCookie:h1,deleteCookie:p1,trim:wr,newId:nl,random32:function(){return co(!0)},generateW3CId:kn,isArray:Yn,isError:Uc,isDate:Yu,toISOStringForIE8:xi,getIEVersion:cd,msToTimeSpan:ri,isCrossOriginError:_m,dump:lt,getExceptionName:At,addEventHandler:es,IsBeaconApiSupported:zd,getExtension:bm},$m={parseUrl:hs,getAbsoluteUrl:km,getPathName:_1,getCompleteUrl:Im,parseHost:Dm,parseFullHost:Zd},Ai={correlationIdPrefix:"cid-v1:",canIncludeCorrelationHeader:function(t,e,r){if(!e||t&&t.disableCorrelationHeaders)return!1;if(t&&t.correlationHeaderExcludePatterns){for(var n=0;n<t.correlationHeaderExcludePatterns.length;n++)if(t.correlationHeaderExcludePatterns[n].test(e))return!1}var i=hs(e).host.toLowerCase();if(i&&(i.indexOf(":443")!==-1||i.indexOf(":80")!==-1)&&(i=(Zd(e,!0)||"").toLowerCase()),(!t||!t.enableCorsCorrelation)&&i&&i!==r)return!1;var o=t&&t.correlationHeaderDomains;if(o){var a;if(gt(o,function(l){var u=new RegExp(l.toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));a=a||u.test(i)}),!a)return!1}var s=t&&t.correlationHeaderExcludedDomains;if(!s||s.length===0)return!0;for(var n=0;n<s.length;n++){var c=new RegExp(s[n].toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));if(c.test(i))return!1}return i&&i.length>0},getCorrelationContext:function(t){if(t){var e=Ai.getCorrelationContextValue(t,Wt.requestContextTargetKey);if(e&&e!==Ai.correlationIdPrefix)return e}},getCorrelationContextValue:function(t,e){if(t)for(var r=t.split(","),n=0;n<r.length;++n){var i=r[n].split("=");if(i.length===2&&i[0]===e)return i[1]}}},Mm={Now:fs,GetDuration:$r}});function Om(t){if(!t)return{};var e=t.split(Um),r=yg(e,function(i,o){var a=o.split(Lm);if(a.length===2){var s=a[0].toLowerCase(),c=a[1];i[s]=c}return i},{});if(no(r).length>0){if(r.endpointsuffix){var n=r.location?r.location+".":"";r.ingestionendpoint=r.ingestionendpoint||"https://"+n+"dc."+r.endpointsuffix}r.ingestionendpoint=r.ingestionendpoint||jd}return r}var Um,Lm,Hm,S1=xe(()=>{pn(),wt(),Um=";",Lm="=",Hm={parse:Om}}),Jd,qm=xe(()=>{Jd=function(){function t(){}return t}()}),eh,Wm=xe(()=>{Ut(),qm(),eh=function(t){Nt(e,t);function e(){return t.call(this)||this}return e}(Jd)}),zm,C1=xe(()=>{zm=function(){function t(){this.ver=1,this.sampleRate=100,this.tags={}}return t}()}),th,E1=xe(()=>{Ut(),C1(),fn(),wt(),pn(),th=function(t){Nt(e,t);function e(r,n,i){var o=t.call(this)||this;return o.name=Nr(r,i)||tn,o.data=n,o.time=xi(new Date),o.aiDataContract={time:1,iKey:1,name:1,sampleRate:function(){return o.sampleRate===100?4:1},tags:1,data:1},o}return e}(zm)}),rh,jm=xe(()=>{rh=function(){function t(){this.ver=2,this.properties={},this.measurements={}}return t}()}),mn,R1=xe(()=>{Ut(),jm(),fn(),pn(),mn=function(t){Nt(e,t);function e(r,n,i,o){var a=t.call(this)||this;return a.aiDataContract={ver:1,name:1,properties:0,measurements:0},a.name=Nr(r,n)||tn,a.properties=Si(r,i),a.measurements=Ci(r,o),a}return e.envelopeType="Microsoft.ApplicationInsights.{0}.Event",e.dataType="EventData",e}(rh)}),Vm,A1=xe(()=>{Vm=function(){function t(){}return t}()}),Gm,T1=xe(()=>{Gm=function(){function t(){this.ver=2,this.exceptions=[],this.properties={},this.measurements={}}return t}()}),Km,k1=xe(()=>{Km=function(){function t(){this.hasFullStack=!0,this.parsedStack=[]}return t}()});function nh(t,e){var r=t;return r&&!pt(r)&&(JSON&&JSON.stringify?(r=JSON.stringify(t),e&&(!r||r==="{}")&&(St(t.toString)?r=t.toString():r=""+t)):r=""+t+" - (Missing JSON.stringify)"),r||""}function Zm(t,e){var r=t;return t&&(r=t[pl]||t[ah]||"",r&&!pt(r)&&(r=nh(r,!0)),t.filename&&(r=r+" @"+(t.filename||"")+":"+(t.lineno||"?")+":"+(t.colno||"?"))),e&&e!=="String"&&e!=="Object"&&e!=="Error"&&(r||"").indexOf(e)===-1&&(r=e+": "+r),r||""}function I1(t){return ro(t)?"hasFullStack"in t&&"typeName"in t:!1}function D1(t){return ro(t)?"ver"in t&&"exceptions"in t&&"properties"in t:!1}function Xm(t){return t&&t.src&&pt(t.src)&&t.obj&&Yn(t.obj)}function ra(t){var e=t||"";pt(e)||(pt(e[Qr])?e=e[Qr]:e=""+e);var r=e.split(`
`);return{src:e,obj:r}}function P1(t){for(var e=[],r=t.split(`
`),n=0;n<r.length;n++){var i=r[n];r[n+1]&&(i+="@"+r[n+1],n++),e.push(i)}return{src:t,obj:e}}function Qm(t){var e=null;if(t)try{if(t[Qr])e=ra(t[Qr]);else if(t[fo]&&t[fo][Qr])e=ra(t[fo][Qr]);else if(t.exception&&t.exception[Qr])e=ra(t.exception[Qr]);else if(Xm(t))e=t;else if(Xm(t[fl]))e=t[fl];else if(window.opera&&t[pl])e=P1(t.message);else if(pt(t))e=ra(t);else{var r=t[pl]||t[ah]||"";pt(t[oh])&&(r&&(r+=`
`),r+=" from "+t[oh]),r&&(e=ra(r))}}catch(n){e=ra(n)}return e||{src:"",obj:null}}function F1(t){var e="";return t&&(t.obj?gt(t.obj,function(r){e+=r+`
`}):e=t.src||""),e}function N1(t){var e,r=t.obj;if(r&&r.length>0){e=[];var n=0,i=0;gt(r,function(b){var y=b.toString();if(gl.regex.test(y)){var w=new gl(y,n++);i+=w.sizeInBytes,e.push(w)}});var o=32*1024;if(i>o)for(var a=0,s=e.length-1,c=0,l=a,u=s;a<s;){var f=e[a].sizeInBytes,h=e[s].sizeInBytes;if(c+=f+h,c>o){var p=u-l+1;e.splice(l,p);break}l=a,u=s,a++,s--}}return e}function hl(t){var e="";if(t&&(e=t.typeName||t.name||"",!e))try{var r=/function (.{1,200})\(/,n=r.exec(t.constructor.toString());e=n&&n.length>1?n[1]:""}catch(i){}return e}function ih(t){if(t)try{if(!pt(t)){var e=hl(t),r=nh(t,!1);return(!r||r==="{}")&&(t[fo]&&(t=t[fo],e=hl(t)),r=nh(t,!0)),r.indexOf(e)!==0&&e!=="String"?e+":"+r:r}}catch(n){}return""+(t||"")}var Ym,fo,Qr,fl,oh,pl,ah,Mr,sh,gl,$1=xe(()=>{Ut(),A1(),T1(),k1(),fn(),wt(),pn(),Ym="<no_method>",fo="error",Qr="stack",fl="stackDetails",oh="errorSrc",pl="message",ah="description",Mr=function(t){Nt(e,t);function e(r,n,i,o,a,s){var c=t.call(this)||this;return c.aiDataContract={ver:1,exceptions:1,severityLevel:0,properties:0,measurements:0},D1(n)?(c.exceptions=n.exceptions,c.properties=n.properties,c.measurements=n.measurements,n.severityLevel&&(c.severityLevel=n.severityLevel),n.id&&(c.id=n.id),n.problemGroup&&(c.problemGroup=n.problemGroup),c.ver=2,Fe(n.isManual)||(c.isManual=n.isManual)):(i||(i={}),c.exceptions=[new sh(r,n,i)],c.properties=Si(r,i),c.measurements=Ci(r,o),a&&(c.severityLevel=a),s&&(c.id=s)),c}return e.CreateAutoException=function(r,n,i,o,a,s,c,l){var u=hl(a||s||r);return{message:Zm(r,u),url:n,lineNumber:i,columnNumber:o,error:ih(a||s||r),evt:ih(s||r),typeName:u,stackDetails:Qm(c||a||s),errorSrc:l}},e.CreateFromInterface=function(r,n,i,o){var a=n.exceptions&&rs(n.exceptions,function(c){return sh.CreateFromInterface(r,c)}),s=new e(r,Lo({},n,{exceptions:a}),i,o);return s},e.prototype.toInterface=function(){var r=this,n=r.exceptions,i=r.properties,o=r.measurements,a=r.severityLevel,s=r.ver,c=r.problemGroup,l=r.id,u=r.isManual,f=n instanceof Array&&rs(n,function(h){return h.toInterface()})||void 0;return{ver:"4.0",exceptions:f,severityLevel:a,properties:i,measurements:o,problemGroup:c,id:l,isManual:u}},e.CreateSimpleException=function(r,n,i,o,a,s){return{exceptions:[{hasFullStack:!0,message:r,stack:a,typeName:n}]}},e.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",e.dataType="ExceptionData",e.formatError=ih,e}(Gm),sh=function(t){Nt(e,t);function e(r,n,i){var o=t.call(this)||this;if(o.aiDataContract={id:0,outerId:0,typeName:1,message:1,hasFullStack:0,stack:0,parsedStack:2},I1(n))o.typeName=n.typeName,o.message=n.message,o[Qr]=n[Qr],o.parsedStack=n.parsedStack,o.hasFullStack=n.hasFullStack;else{var a=n,s=a&&a.evt;Uc(a)||(a=a[fo]||s||a),o.typeName=Nr(r,hl(a))||tn,o.message=qd(r,Zm(n||a,o.typeName))||tn;var c=n[fl]||Qm(n);o.parsedStack=N1(c),o[Qr]=gm(r,F1(c)),o.hasFullStack=Yn(o.parsedStack)&&o.parsedStack.length>0,i&&(i.typeName=i.typeName||o.typeName)}return o}return e.prototype.toInterface=function(){var r=this.parsedStack instanceof Array&&rs(this.parsedStack,function(i){return i.toInterface()}),n={id:this.id,outerId:this.outerId,typeName:this.typeName,message:this.message,hasFullStack:this.hasFullStack,stack:this[Qr],parsedStack:r||void 0};return n},e.CreateFromInterface=function(r,n){var i=n.parsedStack instanceof Array&&rs(n.parsedStack,function(a){return gl.CreateFromInterface(a)})||n.parsedStack,o=new e(r,Lo({},n,{parsedStack:i}));return o},e}(Km),gl=function(t){Nt(e,t);function e(r,n){var i=t.call(this)||this;if(i.sizeInBytes=0,i.aiDataContract={level:1,method:1,assembly:0,fileName:0,line:0},typeof r=="string"){var o=r;i.level=n,i.method=Ym,i.assembly=wr(o),i.fileName="",i.line=0;var a=o.match(e.regex);a&&a.length>=5&&(i.method=wr(a[2])||i.method,i.fileName=wr(a[4]),i.line=parseInt(a[5])||0)}else i.level=r.level,i.method=r.method,i.assembly=r.assembly,i.fileName=r.fileName,i.line=r.line,i.sizeInBytes=0;return i.sizeInBytes+=i.method.length,i.sizeInBytes+=i.fileName.length,i.sizeInBytes+=i.assembly.length,i.sizeInBytes+=e.baseSize,i.sizeInBytes+=i.level.toString().length,i.sizeInBytes+=i.line.toString().length,i}return e.CreateFromInterface=function(r){return new e(r,null)},e.prototype.toInterface=function(){return{level:this.level,method:this.method,assembly:this.assembly,fileName:this.fileName,line:this.line}},e.regex=/^([\s]+at)?[\s]{0,50}([^\@\()]+?)[\s]{0,50}(\@|\()([^\(\n]+):([0-9]+):([0-9]+)(\)?)$/,e.baseSize=58,e}(Vm)}),Jm,M1=xe(()=>{Jm=function(){function t(){this.ver=2,this.metrics=[],this.properties={},this.measurements={}}return t}()}),ch,B1=xe(()=>{(function(t){t[t.Measurement=0]="Measurement",t[t.Aggregation=1]="Aggregation"})(ch||(ch={}))}),ev,O1=xe(()=>{B1(),ev=function(){function t(){this.kind=ch.Measurement}return t}()}),tv,U1=xe(()=>{Ut(),O1(),tv=function(t){Nt(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.aiDataContract={name:1,kind:0,value:1,count:0,min:0,max:0,stdDev:0},r}return e}(ev)}),In,L1=xe(()=>{Ut(),M1(),fn(),U1(),pn(),In=function(t){Nt(e,t);function e(r,n,i,o,a,s,c,l){var u=t.call(this)||this;u.aiDataContract={ver:1,metrics:1,properties:0};var f=new tv;return f.count=o>0?o:void 0,f.max=isNaN(s)||s===null?void 0:s,f.min=isNaN(a)||a===null?void 0:a,f.name=Nr(r,n)||tn,f.value=i,u.metrics=[f],u.properties=Si(r,c),u.measurements=Ci(r,l),u}return e.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",e.dataType="MetricData",e}(Jm)}),ml,lh=xe(()=>{Ut(),jm(),ml=function(t){Nt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(rh)}),vn,H1=xe(()=>{Ut(),lh(),fn(),ol(),pn(),vn=function(t){Nt(e,t);function e(r,n,i,o,a,s,c){var l=t.call(this)||this;return l.aiDataContract={ver:1,name:0,url:0,duration:0,properties:0,measurements:0,id:0},l.id=mm(r,c),l.url=ds(r,i),l.name=Nr(r,n)||tn,isNaN(o)||(l.duration=ri(o)),l.properties=Si(r,a),l.measurements=Ci(r,s),l}return e.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",e.dataType="PageviewData",e}(ml)}),rv,q1=xe(()=>{rv=function(){function t(){this.ver=2,this.success=!0,this.properties={},this.measurements={}}return t}()}),Dn,W1=xe(()=>{Ut(),fn(),Bm(),q1(),ol(),Dn=function(t){Nt(e,t);function e(r,n,i,o,a,s,c,l,u,f,h,p){u===void 0&&(u="Ajax");var b=t.call(this)||this;b.aiDataContract={id:1,ver:1,name:0,resultCode:0,duration:0,success:0,data:0,target:0,type:0,properties:0,measurements:0,kind:0,value:0,count:0,min:0,max:0,stdDev:0,dependencyKind:0,dependencySource:0,commandName:0,dependencyTypeName:0},b.id=n,b.duration=ri(a),b.success=s,b.resultCode=c+"",b.type=Nr(r,u);var y=x1(r,i,l,o);return b.data=ds(r,o)||y.data,b.target=Nr(r,y.target),f&&(b.target=b.target+" | "+f),b.name=Nr(r,y.name),b.properties=Si(r,h),b.measurements=Ci(r,p),b}return e.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",e.dataType="RemoteDependencyData",e}(rv)}),nv,z1=xe(()=>{nv=function(){function t(){this.ver=2,this.properties={},this.measurements={}}return t}()}),ni,j1=xe(()=>{Ut(),z1(),fn(),pn(),ni=function(t){Nt(e,t);function e(r,n,i,o,a){var s=t.call(this)||this;return s.aiDataContract={ver:1,message:1,severityLevel:0,properties:0},n=n||tn,s.message=qd(r,n),s.properties=Si(r,o),s.measurements=Ci(r,a),i&&(s.severityLevel=i),s}return e.envelopeType="Microsoft.ApplicationInsights.{0}.Message",e.dataType="MessageData",e}(nv)}),iv,V1=xe(()=>{Ut(),lh(),iv=function(t){Nt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(ml)}),ii,G1=xe(()=>{Ut(),V1(),fn(),pn(),ii=function(t){Nt(e,t);function e(r,n,i,o,a,s,c){var l=t.call(this)||this;return l.aiDataContract={ver:1,name:0,url:0,duration:0,perfTotal:0,networkConnect:0,sentRequest:0,receivedResponse:0,domProcessing:0,properties:0,measurements:0},l.url=ds(r,i),l.name=Nr(r,n)||tn,l.properties=Si(r,a),l.measurements=Ci(r,s),c&&(l.domProcessing=c.domProcessing,l.duration=c.duration,l.networkConnect=c.networkConnect,l.perfTotal=c.perfTotal,l.receivedResponse=c.receivedResponse,l.sentRequest=c.sentRequest),l}return e.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",e.dataType="PageviewPerformanceData",e}(iv)}),oi,K1=xe(()=>{Ut(),Wm(),oi=function(t){Nt(e,t);function e(r,n){var i=t.call(this)||this;return i.aiDataContract={baseType:1,baseData:1},i.baseType=r,i.baseData=n,i}return e}(eh)}),ps,Z1=xe(()=>{(function(t){t[t.Verbose=0]="Verbose",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.Critical=4]="Critical"})(ps||(ps={}))}),ov,X1=xe(()=>{wt(),ov=function(){function t(){}return t.getConfig=function(e,r,n,i){i===void 0&&(i=!1);var o;return n&&e.extensionConfig&&e.extensionConfig[n]&&!Fe(e.extensionConfig[n][r])?o=e.extensionConfig[n][r]:o=e[r],Fe(o)?i:o},t}()});function Ti(t){var e="ai."+t+".";return function(r){return e+r}}var na,ir,gs,po,vl,ai,ki,ia,wl,av=xe(()=>{Ut(),wt(),na=Ti("application"),ir=Ti("device"),gs=Ti("location"),po=Ti("operation"),vl=Ti("session"),ai=Ti("user"),ki=Ti("cloud"),ia=Ti("internal"),wl=function(t){Nt(e,t);function e(){return t.call(this)||this}return e}(jC({applicationVersion:na("ver"),applicationBuild:na("build"),applicationTypeId:na("typeId"),applicationId:na("applicationId"),applicationLayer:na("layer"),deviceId:ir("id"),deviceIp:ir("ip"),deviceLanguage:ir("language"),deviceLocale:ir("locale"),deviceModel:ir("model"),deviceFriendlyName:ir("friendlyName"),deviceNetwork:ir("network"),deviceNetworkName:ir("networkName"),deviceOEMName:ir("oemName"),deviceOS:ir("os"),deviceOSVersion:ir("osVersion"),deviceRoleInstance:ir("roleInstance"),deviceRoleName:ir("roleName"),deviceScreenResolution:ir("screenResolution"),deviceType:ir("type"),deviceMachineName:ir("machineName"),deviceVMName:ir("vmName"),deviceBrowser:ir("browser"),deviceBrowserVersion:ir("browserVersion"),locationIp:gs("ip"),locationCountry:gs("country"),locationProvince:gs("province"),locationCity:gs("city"),operationId:po("id"),operationName:po("name"),operationParentId:po("parentId"),operationRootId:po("rootId"),operationSyntheticSource:po("syntheticSource"),operationCorrelationVector:po("correlationVector"),sessionId:vl("id"),sessionIsFirst:vl("isFirst"),sessionIsNew:vl("isNew"),userAccountAcquisitionDate:ai("accountAcquisitionDate"),userAccountId:ai("accountId"),userAgent:ai("userAgent"),userId:ai("id"),userStoreRegion:ai("storeRegion"),userAuthUserId:ai("authUserId"),userAnonymousUserAcquisitionDate:ai("anonUserAcquisitionDate"),userAuthenticatedUserAcquisitionDate:ai("authUserAcquisitionDate"),cloudName:ki("name"),cloudRole:ki("role"),cloudRoleVer:ki("roleVer"),cloudRoleInstance:ki("roleInstance"),cloudEnvironment:ki("environment"),cloudLocation:ki("location"),cloudDeploymentUnit:ki("deploymentUnit"),internalNodeName:ia("nodeName"),internalSdkVersion:ia("sdkVersion"),internalAgentVersion:ia("agentVersion"),internalSnippet:ia("snippet"),internalSdkSrc:ia("sdkSrc")}))}),Pn,Q1=xe(()=>{fn(),wt(),pn(),Pn=function(){function t(){}return t.create=function(e,r,n,i,o,a){if(n=Nr(i,n)||tn,Fe(e)||Fe(r)||Fe(n))throw Error("Input doesn't contain all required fields");var s={name:n,time:xi(new Date),iKey:"",ext:a||{},tags:[],data:{},baseType:r,baseData:e};return Fe(o)||cr(o,function(c,l){s.data[c]=l}),s},t}()}),Br,Lt,Y1=xe(()=>{av(),Br={UserExt:"user",DeviceExt:"device",TraceExt:"trace",WebExt:"web",AppExt:"app",OSExt:"os",SessionExt:"ses",SDKExt:"sdk"},Lt=new wl}),oa,yl,uh,lr=xe(()=>{Bm(),S1(),fm(),pn(),Wm(),qm(),E1(),R1(),$1(),L1(),H1(),lh(),W1(),j1(),G1(),K1(),Z1(),X1(),av(),fn(),Q1(),Y1(),xm(),ol(),ym(),Tm(),Fm(),oa="AppInsightsPropertiesPlugin",yl="AppInsightsChannelPlugin",uh="ApplicationInsightsAnalytics"}),sv,J1=xe(()=>{lr(),wt(),pr(),sv=function(){function t(e,r,n,i){nr(t,this,function(o){var a=null,s=[],c=!1,l;n&&(l=n.logger);function u(){n&&gt(n.getTransmissionControls(),function(h){gt(h,function(p){return p.flush(!0)})})}function f(h){s.push(h),a||(a=setInterval(function(){var p=s.slice(0),b=!1;s=[],gt(p,function(y){y()?b=!0:s.push(y)}),s.length===0&&(clearInterval(a),a=null),b&&u()},100))}o.trackPageView=function(h,p){var b=h.name;if(Fe(b)||typeof b!="string"){var y=An();b=h.name=y&&y.title||""}var w=h.uri;if(Fe(w)||typeof w!="string"){var _=io();w=h.uri=_&&_.href||""}if(!i.isPerformanceTimingSupported()){e.sendPageViewInternal(h,p),u(),l.throwInternal(Pe.WARNING,Re.NavigationTimingNotSupported,"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info.");return}var S=!1,I,D=i.getPerformanceTiming().navigationStart;D>0&&(I=$r(D,+new Date),i.shouldCollectDuration(I)||(I=void 0));var O;!Fe(p)&&!Fe(p.duration)&&(O=p.duration),(r||!isNaN(O))&&(isNaN(O)&&(p||(p={}),p.duration=I),e.sendPageViewInternal(h,p),u(),S=!0);var te=6e4;p||(p={}),f(function(){var J=!1;try{if(i.isPerformanceTimingDataReady()){J=!0;var G={name:b,uri:w};i.populatePageViewPerformanceEvent(G),!G.isValid&&!S?(p.duration=I,e.sendPageViewInternal(h,p)):(S||(p.duration=G.durationMs,e.sendPageViewInternal(h,p)),c||(e.sendPageViewPerformanceInternal(G,p),c=!0))}else D>0&&$r(D,+new Date)>te&&(J=!0,S||(p.duration=te,e.sendPageViewInternal(h,p)))}catch(ue){l.throwInternal(Pe.CRITICAL,Re.TrackPVFailedCalc,"trackPageView failed on page load calculation: "+At(ue),{exception:lt(ue)})}return J})}})}return t}()}),cv,lv,eE=xe(()=>{lr(),wt(),cv=function(){function t(e,r){this.prevPageVisitDataKeyName="prevPageVisitData",this.pageVisitTimeTrackingHandler=r,this._logger=e}return t.prototype.trackPreviousPageVisit=function(e,r){try{var n=this.restartPageVisitTimer(e,r);n&&this.pageVisitTimeTrackingHandler(n.pageName,n.pageUrl,n.pageVisitTime)}catch(i){this._logger.warnToConsole("Auto track page visit time failed, metric will not be collected: "+lt(i))}},t.prototype.restartPageVisitTimer=function(e,r){try{var n=this.stopPageVisitTimer();return this.startPageVisitTimer(e,r),n}catch(i){return this._logger.warnToConsole("Call to restart failed: "+lt(i)),null}},t.prototype.startPageVisitTimer=function(e,r){try{if(ta()){ll(this._logger,this.prevPageVisitDataKeyName)!=null&&Rn("Cannot call startPageVisit consecutively without first calling stopPageVisit");var n=new lv(e,r),i=hn().stringify(n);ul(this._logger,this.prevPageVisitDataKeyName,i)}}catch(o){this._logger.warnToConsole("Call to start failed: "+lt(o))}},t.prototype.stopPageVisitTimer=function(){try{if(ta()){var e=Jr(),r=ll(this._logger,this.prevPageVisitDataKeyName);if(r&&zo()){var n=hn().parse(r);return n.pageVisitTime=e-n.pageVisitStartTime,Am(this._logger,this.prevPageVisitDataKeyName),n}else return null}return null}catch(i){return this._logger.warnToConsole("Stop page visit timer failed: "+lt(i)),null}},t}(),lv=function(){function t(e,r){this.pageVisitStartTime=Jr(),this.pageName=e,this.pageUrl=r}return t}()}),uv,tE=xe(()=>{lr(),wt(),uv=function(){function t(e){this.MAX_DURATION_ALLOWED=36e5,e&&(this._logger=e.logger)}return t.prototype.populatePageViewPerformanceEvent=function(e){e.isValid=!1;var r=this.getPerformanceNavigationTiming(),n=this.getPerformanceTiming(),i=0,o=0,a=0,s=0,c=0;(r||n)&&(r?(i=r.duration,o=r.startTime===0?r.connectEnd:$r(r.startTime,r.connectEnd),a=$r(r.requestStart,r.responseStart),s=$r(r.responseStart,r.responseEnd),c=$r(r.responseEnd,r.loadEventEnd)):(i=$r(n.navigationStart,n.loadEventEnd),o=$r(n.navigationStart,n.connectEnd),a=$r(n.requestStart,n.responseStart),s=$r(n.responseStart,n.responseEnd),c=$r(n.responseEnd,n.loadEventEnd)),i===0?this._logger.throwInternal(Pe.WARNING,Re.ErrorPVCalc,"error calculating page view performance.",{total:i,network:o,request:a,response:s,dom:c}):this.shouldCollectDuration(i,o,a,s,c)?i<Math.floor(o)+Math.floor(a)+Math.floor(s)+Math.floor(c)?this._logger.throwInternal(Pe.WARNING,Re.ClientPerformanceMathError,"client performance math error.",{total:i,network:o,request:a,response:s,dom:c}):(e.durationMs=i,e.perfTotal=e.duration=ri(i),e.networkConnect=ri(o),e.sentRequest=ri(a),e.receivedResponse=ri(s),e.domProcessing=ri(c),e.isValid=!0):this._logger.throwInternal(Pe.WARNING,Re.InvalidDurationValue,"Invalid page load duration value. Browser perf data won't be sent.",{total:i,network:o,request:a,response:s,dom:c}))},t.prototype.getPerformanceTiming=function(){return this.isPerformanceTimingSupported()?Jn().timing:null},t.prototype.getPerformanceNavigationTiming=function(){return this.isPerformanceNavigationTimingSupported()?Jn().getEntriesByType("navigation")[0]:null},t.prototype.isPerformanceNavigationTimingSupported=function(){var e=Jn();return e&&e.getEntriesByType&&e.getEntriesByType("navigation").length>0},t.prototype.isPerformanceTimingSupported=function(){var e=Jn();return e&&e.timing},t.prototype.isPerformanceTimingDataReady=function(){var e=Jn(),r=e?e.timing:0;return r&&r.domainLookupStart>0&&r.navigationStart>0&&r.responseStart>0&&r.requestStart>0&&r.loadEventEnd>0&&r.responseEnd>0&&r.connectEnd>0&&r.domLoading>0},t.prototype.shouldCollectDuration=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=Tn()||{},i=["googlebot","adsbot-google","apis-google","mediapartners-google"],o=n.userAgent,a=!1;if(o)for(var s=0;s<i.length;s++)a=a||o.toLowerCase().indexOf(i[s])!==-1;if(a)return!1;for(var s=0;s<e.length;s++)if(e[s]<0||e[s]>=this.MAX_DURATION_ALLOWED)return!1;return!0},t}()});function ms(t,e){t&&t.dispatchEvent&&e&&t.dispatchEvent(e)}var dh,bl,hh,fh,rE=xe(()=>{Ut(),lr(),wt(),J1(),eE(),tE(),pr(),dh="duration",bl="event",hh=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.identifier=uh,r.priority=180,r.autoRoutePVDelay=500;var n,i,o,a=0,s,c;return nr(e,r,function(l,u){var f=io(!0);s=f&&f.href||"",l.getCookieMgr=function(){return _d(l.core)},l.processTelemetry=function(w,_){Vo(l.core,function(){return l.identifier+":processTelemetry"},function(){var S=!1,I=l._telemetryInitializers.length;_=l._getTelCtx(_);for(var D=0;D<I;++D){var O=l._telemetryInitializers[D];if(O)try{if(O.apply(null,[w])===!1){S=!0;break}}catch(te){_.diagLog().throwInternal(Pe.CRITICAL,Re.TelemetryInitializerFailed,"One of telemetry initializers failed, telemetry item will not be sent: "+At(te),{exception:lt(te)},!0)}}S||l.processNext(w,_)},function(){return{item:w}},!w.sync)},l.trackEvent=function(w,_){try{var S=Pn.create(w,mn.dataType,mn.envelopeType,l.diagLog(),_);l.core.track(S)}catch(I){l.diagLog().throwInternal(Pe.WARNING,Re.TrackTraceFailed,"trackTrace failed, trace will not be collected: "+At(I),{exception:lt(I)})}},l.startTrackEvent=function(w){try{n.start(w)}catch(_){l.diagLog().throwInternal(Pe.CRITICAL,Re.StartTrackEventFailed,"startTrackEvent failed, event will not be collected: "+At(_),{exception:lt(_)})}},l.stopTrackEvent=function(w,_,S){try{n.stop(w,void 0,_)}catch(I){l.diagLog().throwInternal(Pe.CRITICAL,Re.StopTrackEventFailed,"stopTrackEvent failed, event will not be collected: "+At(I),{exception:lt(I)})}},l.trackTrace=function(w,_){try{var S=Pn.create(w,ni.dataType,ni.envelopeType,l.diagLog(),_);l.core.track(S)}catch(I){l.diagLog().throwInternal(Pe.WARNING,Re.TrackTraceFailed,"trackTrace failed, trace will not be collected: "+At(I),{exception:lt(I)})}},l.trackMetric=function(w,_){try{var S=Pn.create(w,In.dataType,In.envelopeType,l.diagLog(),_);l.core.track(S)}catch(I){l.diagLog().throwInternal(Pe.CRITICAL,Re.TrackMetricFailed,"trackMetric failed, metric will not be collected: "+At(I),{exception:lt(I)})}},l.trackPageView=function(w,_){try{var S=w||{};l._pageViewManager.trackPageView(S,Lo({},S.properties,S.measurements,_)),l.config.autoTrackPageVisitTime&&l._pageVisitTimeManager.trackPreviousPageVisit(S.name,S.uri)}catch(I){l.diagLog().throwInternal(Pe.CRITICAL,Re.TrackPVFailed,"trackPageView failed, page view will not be collected: "+At(I),{exception:lt(I)})}},l.sendPageViewInternal=function(w,_,S){var I=An();I&&(w.refUri=w.refUri===void 0?I.referrer:w.refUri);var D=Pn.create(w,vn.dataType,vn.envelopeType,l.diagLog(),_,S);l.core.track(D),a=0},l.sendPageViewPerformanceInternal=function(w,_,S){var I=Pn.create(w,ii.dataType,ii.envelopeType,l.diagLog(),_,S);l.core.track(I)},l.trackPageViewPerformance=function(w,_){try{l._pageViewPerformanceManager.populatePageViewPerformanceEvent(w),l.sendPageViewPerformanceInternal(w,_)}catch(S){l.diagLog().throwInternal(Pe.CRITICAL,Re.TrackPVFailed,"trackPageViewPerformance failed, page view will not be collected: "+At(S),{exception:lt(S)})}},l.startTrackPage=function(w){try{if(typeof w!="string"){var _=An();w=_&&_.title||""}i.start(w)}catch(S){l.diagLog().throwInternal(Pe.CRITICAL,Re.StartTrackFailed,"startTrackPage failed, page view may not be collected: "+At(S),{exception:lt(S)})}},l.stopTrackPage=function(w,_,S,I){try{if(typeof w!="string"){var D=An();w=D&&D.title||""}if(typeof _!="string"){var O=io();_=O&&O.href||""}i.stop(w,_,S,I),l.config.autoTrackPageVisitTime&&l._pageVisitTimeManager.trackPreviousPageVisit(w,_)}catch(te){l.diagLog().throwInternal(Pe.CRITICAL,Re.StopTrackFailed,"stopTrackPage failed, page view will not be collected: "+At(te),{exception:lt(te)})}},l.sendExceptionInternal=function(w,_,S){var I=w.exception||w.error||new Error(tn),D=new Mr(l.diagLog(),I,w.properties||_,w.measurements,w.severityLevel,w.id).toInterface(),O=Pn.create(D,Mr.dataType,Mr.envelopeType,l.diagLog(),_,S);l.core.track(O)},l.trackException=function(w,_){try{l.sendExceptionInternal(w,_)}catch(S){l.diagLog().throwInternal(Pe.CRITICAL,Re.TrackExceptionFailed,"trackException failed, exception will not be collected: "+At(S),{exception:lt(S)})}},l._onerror=function(w){var _=w&&w.error,S=w&&w.evt;try{if(!S){var I=ns();I&&(S=I[bl])}var D=w&&w.url||(An()||{}).URL,O=w.errorSrc||"window.onerror@"+D+":"+(w.lineNumber||0)+":"+(w.columnNumber||0),te={errorSrc:O,url:D,lineNumber:w.lineNumber||0,columnNumber:w.columnNumber||0,message:w.message};_m(w.message,w.url,w.lineNumber,w.columnNumber,w.error)?y(Mr.CreateAutoException("Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.",D,w.lineNumber||0,w.columnNumber||0,_,S,null,O),te):(w.errorSrc||(w.errorSrc=O),l.trackException({exception:w,severityLevel:ps.Error},te))}catch(G){var J=_?_.name+", "+_.message:"null";l.diagLog().throwInternal(Pe.CRITICAL,Re.ExceptionWhileLoggingError,"_onError threw exception while logging error, error will not be collected: "+At(G),{exception:lt(G),errorString:J})}},l.addTelemetryInitializer=function(w){l._telemetryInitializers.push(w)},l.initialize=function(w,_,S,I){if(!l.isInitialized()){if(Fe(_))throw Error("Error initializing");u.initialize(w,_,S,I),l.setInitialized(!1);var D=l._getTelCtx(),O=l.identifier;l.config=D.getExtCfg(O);var te=e.getDefaultConfig(w);te!==void 0&&cr(te,function(Te,ze){l.config[Te]=D.getConfig(O,Te,ze),l.config[Te]===void 0&&(l.config[Te]=ze)}),l.config.isStorageUseDisabled&&Sm();var J={instrumentationKey:function(){return w.instrumentationKey},accountId:function(){return l.config.accountId||w.accountId},sessionRenewalMs:function(){return l.config.sessionRenewalMs||w.sessionRenewalMs},sessionExpirationMs:function(){return l.config.sessionExpirationMs||w.sessionExpirationMs},sampleRate:function(){return l.config.samplingPercentage||w.samplingPercentage},sdkExtension:function(){return l.config.sdkExtension||w.sdkExtension},isBrowserLinkTrackingEnabled:function(){return l.config.isBrowserLinkTrackingEnabled||w.isBrowserLinkTrackingEnabled},appId:function(){return l.config.appId||w.appId}};l._pageViewPerformanceManager=new uv(l.core),l._pageViewManager=new sv(r,l.config.overridePageViewDuration,l.core,l._pageViewPerformanceManager),l._pageVisitTimeManager=new cv(l.diagLog(),function(Te,ze,Ze){return h(Te,ze,Ze)}),l._telemetryInitializers=l._telemetryInitializers||[],p(J),n=new fh(l.diagLog(),"trackEvent"),n.action=function(Te,ze,Ze,nt){nt||(nt={}),nt[dh]=Ze.toString(),l.trackEvent({name:Te,properties:nt})},i=new fh(l.diagLog(),"trackPageView"),i.action=function(Te,ze,Ze,nt,yt){Fe(nt)&&(nt={}),nt[dh]=Ze.toString();var Bt={name:Te,uri:ze,properties:nt,measurements:yt};l.sendPageViewInternal(Bt,nt)};var G=ns(),ue=XC(),re=io(!0),ae=r;if(l.config.disableExceptionTracking===!1&&!l.config.autoExceptionInstrumented&&G){var ye="onerror",dt=G[ye];G.onerror=function(Te,ze,Ze,nt,yt){var Bt=G[bl],un=dt&&dt(Te,ze,Ze,nt,yt);return un!==!0&&ae._onerror(Mr.CreateAutoException(Te,ze,Ze,nt,yt,Bt)),un},l.config.autoExceptionInstrumented=!0}if(l.config.disableExceptionTracking===!1&&l.config.enableUnhandledPromiseRejectionTracking===!0&&!l.config.autoUnhandledPromiseInstrumented&&G){var ne="onunhandledrejection",Se=G[ne];G[ne]=function(Te){var ze=G[bl],Ze=Se&&Se.call(G,Te);return Ze!==!0&&ae._onerror(Mr.CreateAutoException(Te.reason.toString(),re?re.href:"",0,0,Te,ze)),Ze},l.config.autoUnhandledPromiseInstrumented=!0}if(l.config.enableAutoRouteTracking===!0&&ue&&St(ue.pushState)&&St(ue.replaceState)&&G&&typeof Event!="undefined"){var ke=r;gt(S,function(Te){Te.identifier===oa&&(o=Te)}),ue.pushState=function(Te){return function(){var ze=Te.apply(this,arguments);return ms(G,Jo(ke.config.namePrefix+"pushState")),ms(G,Jo(ke.config.namePrefix+"locationchange")),ze}}(ue.pushState),ue.replaceState=function(Te){return function(){var ze=Te.apply(this,arguments);return ms(G,Jo(ke.config.namePrefix+"replaceState")),ms(G,Jo(ke.config.namePrefix+"locationchange")),ze}}(ue.replaceState),G.addEventListener&&(G.addEventListener(ke.config.namePrefix+"popstate",function(){ms(G,Jo(ke.config.namePrefix+"locationchange"))}),G.addEventListener(ke.config.namePrefix+"locationchange",function(){if(o&&o.context&&o.context.telemetryTrace){o.context.telemetryTrace.traceID=kn();var Te="_unknown_";re&&re.pathname&&(Te=re.pathname+(re.hash||"")),o.context.telemetryTrace.name=Te}c&&(s=c),c=re&&re.href||"",setTimeout(function(ze){ke.trackPageView({refUri:ze,properties:{duration:0}})}.bind(r,s),ke.autoRoutePVDelay)}))}l.setInitialized(!0)}};function h(w,_,S){var I={PageName:w,PageUrl:_};l.trackMetric({name:"PageVisitTime",average:S,max:S,min:S,sampleCount:1},I)}function p(w){if(!w.isBrowserLinkTrackingEnabled()){var _=["/browserLinkSignalR/","/__browserLink/"],S=function(I){if(I.baseType===Dn.dataType){var D=I.baseData;if(D){for(var O=0;O<_.length;O++)if(D.target&&D.target.indexOf(_[O])>=0)return!1}}return!0};b(S)}}function b(w){l._telemetryInitializers.push(w)}function y(w,_){var S=Pn.create(w,Mr.dataType,Mr.envelopeType,l.diagLog(),_);l.core.track(S)}}),r}return e.getDefaultConfig=function(r){return r||(r={}),r.sessionRenewalMs=30*60*1e3,r.sessionExpirationMs=24*60*60*1e3,r.disableExceptionTracking=Mt(r.disableExceptionTracking),r.autoTrackPageVisitTime=Mt(r.autoTrackPageVisitTime),r.overridePageViewDuration=Mt(r.overridePageViewDuration),r.enableUnhandledPromiseRejectionTracking=Mt(r.enableUnhandledPromiseRejectionTracking),(isNaN(r.samplingPercentage)||r.samplingPercentage<=0||r.samplingPercentage>=100)&&(r.samplingPercentage=100),r.isStorageUseDisabled=Mt(r.isStorageUseDisabled),r.isBrowserLinkTrackingEnabled=Mt(r.isBrowserLinkTrackingEnabled),r.enableAutoRouteTracking=Mt(r.enableAutoRouteTracking),r.namePrefix=r.namePrefix||"",r.enableDebug=Mt(r.enableDebug),r.disableFlushOnBeforeUnload=Mt(r.disableFlushOnBeforeUnload),r.disableFlushOnUnload=Mt(r.disableFlushOnUnload,r.disableFlushOnBeforeUnload),r},e.Version="2.6.4",e}(so),fh=function(){function t(e,r){var n=this,i={};n.start=function(o){typeof i[o]!="undefined"&&e.throwInternal(Pe.WARNING,Re.StartCalledMoreThanOnce,"start was called more than once for this event without calling stop.",{name:o,key:o},!0),i[o]=+new Date},n.stop=function(o,a,s,c){var l=i[o];if(isNaN(l))e.throwInternal(Pe.WARNING,Re.StopCalledWithoutStart,"stop was called without a corresponding start.",{name:o,key:o},!0);else{var u=+new Date,f=$r(l,u);n.action(o,a,f,s,c)}delete i[o],i[o]=void 0}}return t}()}),dv=xe(()=>{rE()}),hv,fv,nE=xe(()=>{lr(),wt(),pr(),hv=function(){function t(e){var r=[];nr(t,this,function(n){n.enqueue=function(i){r.push(i)},n.count=function(){return r.length},n.clear=function(){r.length=0},n.getItems=function(){return r.slice(0)},n.batchPayloads=function(i){if(i&&i.length>0){var o=e.emitLineDelimitedJson()?i.join(`
`):"["+i.join(",")+"]";return o}return null},n.markAsSent=function(i){n.clear()},n.clearSent=function(i){}})}return t}(),fv=function(){function t(e,r){var n=!1,i;nr(t,this,function(o){var a=l(t.BUFFER_KEY),s=l(t.SENT_BUFFER_KEY);i=a.concat(s),i.length>t.MAX_BUFFER_SIZE&&(i.length=t.MAX_BUFFER_SIZE),u(t.SENT_BUFFER_KEY,[]),u(t.BUFFER_KEY,i),o.enqueue=function(f){if(i.length>=t.MAX_BUFFER_SIZE){n||(e.throwInternal(Pe.WARNING,Re.SessionStorageBufferFull,"Maximum buffer size reached: "+i.length,!0),n=!0);return}i.push(f),u(t.BUFFER_KEY,i)},o.count=function(){return i.length},o.clear=function(){i=[],u(t.BUFFER_KEY,[]),u(t.SENT_BUFFER_KEY,[]),n=!1},o.getItems=function(){return i.slice(0)},o.batchPayloads=function(f){if(f&&f.length>0){var h=r.emitLineDelimitedJson()?f.join(`
`):"["+f.join(",")+"]";return h}return null},o.markAsSent=function(f){i=c(f,i),u(t.BUFFER_KEY,i);var h=l(t.SENT_BUFFER_KEY);h instanceof Array&&f instanceof Array&&(h=h.concat(f),h.length>t.MAX_BUFFER_SIZE&&(e.throwInternal(Pe.CRITICAL,Re.SessionStorageBufferFull,"Sent buffer reached its maximum size: "+h.length,!0),h.length=t.MAX_BUFFER_SIZE),u(t.SENT_BUFFER_KEY,h))},o.clearSent=function(f){var h=l(t.SENT_BUFFER_KEY);h=c(f,h),u(t.SENT_BUFFER_KEY,h)};function c(f,h){var p=[];return gt(h,function(b){!St(b)&&ts(f,b)===-1&&p.push(b)}),p}function l(f){var h=f;try{h=r.namePrefix&&r.namePrefix()?r.namePrefix()+"_"+h:h;var p=ll(e,h);if(p){var b=hn().parse(p);if(pt(b)&&(b=hn().parse(b)),b&&Yn(b))return b}}catch(y){e.throwInternal(Pe.CRITICAL,Re.FailedToRestoreStorageBuffer," storage key: "+h+", "+At(y),{exception:lt(y)})}return[]}function u(f,h){var p=f;try{p=r.namePrefix&&r.namePrefix()?r.namePrefix()+"_"+p:p;var b=JSON.stringify(h);ul(e,p,b)}catch(y){ul(e,p,JSON.stringify([])),e.throwInternal(Pe.WARNING,Re.FailedToSetStorageBuffer," storage key: "+p+", "+At(y)+". Buffer cleared",{exception:lt(y)})}}})}return t.BUFFER_KEY="AI_buffer",t.SENT_BUFFER_KEY="AI_sentBuffer",t.MAX_BUFFER_SIZE=2e3,t}()});function or(t,e,r){return Ct(t,e,r,td)}var _l,Gt,ur,ph,Yt,pv,gh,gv,mv,vv,wv,yv,iE=xe(()=>{Ut(),lr(),wt(),_l="baseType",Gt="baseData",ur="properties",ph="true",Yt=function(){function t(){}return t.extractPropsAndMeasurements=function(e,r,n){Fe(e)||cr(e,function(i,o){Ju(o)?n[i]=o:pt(o)?r[i]=o:zo()&&(r[i]=hn().stringify(o))})},t.createEnvelope=function(e,r,n,i){var o=new th(e,i,r);or(o,"sampleRate",n[al]),(n[Gt]||{}).startTime&&(o.time=xi(n[Gt].startTime)),o.iKey=n.iKey;var a=n.iKey.replace(/-/g,"");return o.name=o.name.replace("{0}",a),t.extractPartAExtensions(n,o),n.tags=n.tags||[],xg(o)},t.extractPartAExtensions=function(e,r){var n=r.tags=r.tags||{},i=e.ext=e.ext||{},o=e.tags=e.tags||[],a=i.user;a&&(or(n,Lt.userAuthUserId,a.authId),or(n,Lt.userId,a.id||a.localId));var s=i.app;s&&or(n,Lt.sessionId,s.sesId);var c=i.device;c&&(or(n,Lt.deviceId,c.id||c.localId),or(n,Lt.deviceType,c.deviceClass),or(n,Lt.deviceIp,c.ip),or(n,Lt.deviceModel,c.model),or(n,Lt.deviceType,c.deviceType));var l=e.ext.web;if(l){or(n,Lt.deviceLanguage,l.browserLang),or(n,Lt.deviceBrowserVersion,l.browserVer),or(n,Lt.deviceBrowser,l.browser);var u=r.data=r.data||{},f=u[Gt]=u[Gt]||{},h=f[ur]=f[ur]||{};or(h,"domain",l.domain),or(h,"isManual",l.isManual?ph:null),or(h,"screenRes",l.screenRes),or(h,"userConsent",l.userConsent?ph:null)}var p=i.os;p&&or(n,Lt.deviceOS,p.name);var b=i.trace;b&&(or(n,Lt.operationParentId,b.parentID),or(n,Lt.operationName,b.name),or(n,Lt.operationId,b.traceID));for(var y={},w=o.length-1;w>=0;w--){var _=o[w];cr(_,function(I,D){y[I]=D}),o.splice(w,1)}cr(o,function(I,D){y[I]=D});var S=Lo({},n,y);S[Lt.internalSdkVersion]||(S[Lt.internalSdkVersion]="javascript:"+t.Version),r.tags=xg(S)},t.prototype.Init=function(e,r){this._logger=e,Fe(r[Gt])&&this._logger.throwInternal(Pe.CRITICAL,Re.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.")},t.Version="2.6.4",t}(),pv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt].measurements||{},o=n[Gt][ur]||{};Yt.extractPropsAndMeasurements(n.data,o,i);var a=n[Gt];if(Fe(a))return r.warnToConsole("Invalid input for dependency data"),null;var s=a[ur]&&a[ur][sl]?a[ur][sl]:"GET",c=new Dn(r,a.id,a.target,a.name,a.duration,a.success,a.responseCode,s,a.type,a.correlationContext,o,i),l=new oi(Dn.dataType,c);return Yt.createEnvelope(r,Dn.envelopeType,n,l)},e.DependencyEnvelopeCreator=new e,e}(Yt),gh=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i={},o={};n[_l]!==mn.dataType&&(i.baseTypeSource=n[_l]),n[_l]===mn.dataType?(i=n[Gt][ur]||{},o=n[Gt].measurements||{}):n[Gt]&&Yt.extractPropsAndMeasurements(n[Gt],i,o),Yt.extractPropsAndMeasurements(n.data,i,o);var a=n[Gt].name,s=new mn(r,a,i,o),c=new oi(mn.dataType,s);return Yt.createEnvelope(r,mn.envelopeType,n,c)},e.EventEnvelopeCreator=new e,e}(Yt),gv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt].measurements||{},o=n[Gt][ur]||{};Yt.extractPropsAndMeasurements(n.data,o,i);var a=n[Gt],s=Mr.CreateFromInterface(r,a,o,i),c=new oi(Mr.dataType,s);return Yt.createEnvelope(r,Mr.envelopeType,n,c)},e.ExceptionEnvelopeCreator=new e,e}(Yt),mv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt],o=i[ur]||{},a=i.measurements||{};Yt.extractPropsAndMeasurements(n.data,o,a);var s=new In(r,i.name,i.average,i.sampleCount,i.min,i.max,o,a),c=new oi(In.dataType,s);return Yt.createEnvelope(r,In.envelopeType,n,c)},e.MetricEnvelopeCreator=new e,e}(Yt),vv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i="duration",o,a=n[Gt];!Fe(a)&&!Fe(a[ur])&&!Fe(a[ur][i])?(o=a[ur][i],delete a[ur][i]):!Fe(n.data)&&!Fe(n.data[i])&&(o=n.data[i],delete n.data[i]);var s=n[Gt],c;((n.ext||{}).trace||{}).traceID&&(c=n.ext.trace.traceID);var l=s.id||c,u=s.name,f=s.uri,h=s[ur]||{},p=s.measurements||{};if(Fe(s.refUri)||(h.refUri=s.refUri),Fe(s.pageType)||(h.pageType=s.pageType),Fe(s.isLoggedIn)||(h.isLoggedIn=s.isLoggedIn.toString()),!Fe(s[ur])){var b=s[ur];cr(b,function(_,S){h[_]=S})}Yt.extractPropsAndMeasurements(n.data,h,p);var y=new vn(r,u,f,o,h,p,l),w=new oi(vn.dataType,y);return Yt.createEnvelope(r,vn.envelopeType,n,w)},e.PageViewEnvelopeCreator=new e,e}(Yt),wv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt],o=i.name,a=i.uri||i.url,s=i[ur]||{},c=i.measurements||{};Yt.extractPropsAndMeasurements(n.data,s,c);var l=new ii(r,o,a,void 0,s,c,i),u=new oi(ii.dataType,l);return Yt.createEnvelope(r,ii.envelopeType,n,u)},e.PageViewPerformanceEnvelopeCreator=new e,e}(Yt),yv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt].message,o=n[Gt].severityLevel,a=n[Gt][ur]||{},s=n[Gt].measurements||{};Yt.extractPropsAndMeasurements(n.data,a,s);var c=new ni(r,i,o,a,s),l=new oi(ni.dataType,c);return Yt.createEnvelope(r,ni.envelopeType,n,l)},e.TraceEnvelopeCreator=new e,e}(Yt)}),bv,oE=xe(()=>{wt(),pr(),bv=function(){function t(e){nr(t,this,function(r){r.serialize=function(a){var s=n(a,"root");try{return hn().stringify(s)}catch(c){e.throwInternal(Pe.CRITICAL,Re.CannotSerializeObject,c&&St(c.toString)?c.toString():"Error serializing object",null,!0)}};function n(a,s){var c="__aiCircularRefCheck",l={};if(!a)return e.throwInternal(Pe.CRITICAL,Re.CannotSerializeObject,"cannot serialize object because it is null or undefined",{name:s},!0),l;if(a[c])return e.throwInternal(Pe.WARNING,Re.CircularReferenceDetected,"Circular reference detected while serializing object",{name:s},!0),l;if(!a.aiDataContract){if(s==="measurements")l=o(a,"number",s);else if(s==="properties")l=o(a,"string",s);else if(s==="tags")l=o(a,"string",s);else if(Yn(a))l=i(a,s);else{e.throwInternal(Pe.WARNING,Re.CannotSerializeObjectNonSerializable,"Attempting to serialize an object which does not implement ISerializable",{name:s},!0);try{hn().stringify(a),l=a}catch(u){e.throwInternal(Pe.CRITICAL,Re.CannotSerializeObject,u&&St(u.toString)?u.toString():"Error serializing object",null,!0)}}return l}return a[c]=!0,cr(a.aiDataContract,function(u,f){var h=St(f)?f()&1:f&1,p=St(f)?f()&4:f&4,b=f&2,y=a[u]!==void 0,w=ro(a[u])&&a[u]!==null;if(h&&!y&&!b)e.throwInternal(Pe.CRITICAL,Re.MissingRequiredFieldSpecification,"Missing required field specification. The field is required but not present on source",{field:u,name:s});else if(!p){var _=void 0;w?b?_=i(a[u],u):_=n(a[u],u):_=a[u],_!==void 0&&(l[u]=_)}}),delete a[c],l}function i(a,s){var c;if(a)if(!Yn(a))e.throwInternal(Pe.CRITICAL,Re.ItemNotInArray,`This field was specified as an array in the contract but the item is not an array.\r
`,{name:s},!0);else{c=[];for(var l=0;l<a.length;l++){var u=a[l],f=n(u,s+"["+l+"]");c.push(f)}}return c}function o(a,s,c){var l;return a&&(l={},cr(a,function(u,f){if(s==="string")f===void 0?l[u]="undefined":f===null?l[u]="null":f.toString?l[u]=f.toString():l[u]="invalid field: toString() is not defined.";else if(s==="number")if(f===void 0)l[u]="undefined";else if(f===null)l[u]="null";else{var h=parseFloat(f);isNaN(h)?l[u]="NaN":l[u]=h}else l[u]="invalid field: "+c+" is of unknown type.",e.throwInternal(Pe.CRITICAL,l[u],null,!0)})),l}})}return t}()}),_v,mh,aE=xe(()=>{wt(),pr(),_v=function(){function t(){var e=ns(),r=An(),n=!1,i=!0;nr(t,this,function(o){try{if(e&&us.Attach(e,"online",c)&&(us.Attach(e,"offline",l),n=!0),r){var a=r.body||r;Fr(a.ononline)||(a.ononline=c,a.onoffline=l,n=!0)}if(n){var s=Tn();s&&!Fe(s.onLine)&&(i=s.onLine)}}catch(u){n=!1}o.isListening=n,o.isOnline=function(){var u=!0,f=Tn();return n?u=i:f&&!Fe(f.onLine)&&(u=f.onLine),u},o.isOffline=function(){return!o.isOnline()};function c(){i=!0}function l(){i=!1}})}return t.Offline=new t,t}(),mh=_v.Offline}),xv,sE=xe(()=>{xv=function(){function t(){}return t.prototype.getHashCodeScore=function(e){var r=this.getHashCode(e)/t.INT_MAX_VALUE;return r*100},t.prototype.getHashCode=function(e){if(e==="")return 0;for(;e.length<t.MIN_INPUT_LENGTH;)e=e.concat(e);for(var r=5381,n=0;n<e.length;++n)r=(r<<5)+r+e.charCodeAt(n),r=r&r;return Math.abs(r)},t.INT_MAX_VALUE=2147483647,t.MIN_INPUT_LENGTH=8,t}()}),Sv,cE=xe(()=>{sE(),lr(),Sv=function(){function t(){this.hashCodeGeneragor=new xv,this.keys=new wl}return t.prototype.getSamplingScore=function(e){var r=0;return e.tags&&e.tags[this.keys.userId]?r=this.hashCodeGeneragor.getHashCodeScore(e.tags[this.keys.userId]):e.ext&&e.ext.user&&e.ext.user.id?r=this.hashCodeGeneragor.getHashCodeScore(e.ext.user.id):e.tags&&e.tags[this.keys.operationId]?r=this.hashCodeGeneragor.getHashCodeScore(e.tags[this.keys.operationId]):e.ext&&e.ext.telemetryTrace&&e.ext.telemetryTrace.traceID?r=this.hashCodeGeneragor.getHashCodeScore(e.ext.telemetryTrace.traceID):r=Math.random()*100,r},t}()}),Cv,lE=xe(()=>{cE(),lr(),wt(),Cv=function(){function t(e,r){this.INT_MAX_VALUE=2147483647,this._logger=r||Gc(null),(e>100||e<0)&&(this._logger.throwInternal(Pe.WARNING,Re.SampleRateOutOfRange,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),e=100),this.sampleRate=e,this.samplingScoreGenerator=new Sv}return t.prototype.isSampledIn=function(e){var r=this.sampleRate,n=!1;return r==null||r>=100||e.baseType===In.dataType?!0:(n=this.samplingScoreGenerator.getSamplingScore(e)<r,n)},t}()});function xl(t){try{return t.responseText}catch(e){}return null}var vh,uE=xe(()=>{Ut(),nE(),iE(),oE(),lr(),wt(),aE(),lE(),pr(),vh=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.priority=1001,r.identifier=yl,r._XMLHttpRequestSupported=!1;var n,i,o,a,s,c,l={};return nr(e,r,function(u,f){function h(){Rn("Method not implemented.")}u.pause=h,u.resume=h,u.flush=function(){try{u.triggerSend(!0,null,1)}catch(ne){u.diagLog().throwInternal(Pe.CRITICAL,Re.FlushFailed,"flush failed, telemetry will not be collected: "+At(ne),{exception:lt(ne)})}},u.onunloadFlush=function(){if((u._senderConfig.onunloadDisableBeacon()===!1||u._senderConfig.isBeaconApiDisabled()===!1)&&zd())try{u.triggerSend(!0,w,2)}catch(ne){u.diagLog().throwInternal(Pe.CRITICAL,Re.FailedToSendQueuedTelemetry,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+At(ne),{exception:lt(ne)})}else u.flush()},u.teardown=h,u.addHeader=function(ne,Se){l[ne]=Se},u.initialize=function(ne,Se,ke,Te){f.initialize(ne,Se,ke,Te);var ze=u._getTelCtx(),Ze=u.identifier;s=new bv(Se.logger),n=0,i=null,o=0,u._sender=null,c=0;var nt=e._getDefaultAppInsightsChannelConfig();if(u._senderConfig=e._getEmptyAppInsightsChannelConfig(),cr(nt,function(ve,Ie){u._senderConfig[ve]=function(){return ze.getConfig(Ze,ve,Ie())}}),u._buffer=u._senderConfig.enableSessionStorageBuffer()&&ta()?new fv(u.diagLog(),u._senderConfig):new hv(u._senderConfig),u._sample=new Cv(u._senderConfig.samplingPercentage(),u.diagLog()),dt(ne)||u.diagLog().throwInternal(Pe.CRITICAL,Re.InvalidInstrumentationKey,"Invalid Instrumentation key "+ne.instrumentationKey),!dl(u._senderConfig.endpointUrl())&&u._senderConfig.customHeaders()&&u._senderConfig.customHeaders().length>0&&gt(u._senderConfig.customHeaders(),function(ve){r.addHeader(ve.header,ve.value)}),!u._senderConfig.isBeaconApiDisabled()&&zd())u._sender=w;else{var yt=Ar("XMLHttpRequest");if(yt){var Bt=new yt;"withCredentials"in Bt?(u._sender=_,u._XMLHttpRequestSupported=!0):typeof XDomainRequest!==Xn&&(u._sender=ue)}else{var un=Ar("fetch");un&&(u._sender=S)}}},u.processTelemetry=function(ne,Se){Se=u._getTelCtx(Se);try{if(u._senderConfig.disableTelemetry())return;if(!ne){Se.diagLog().throwInternal(Pe.CRITICAL,Re.CannotSendEmptyTelemetry,"Cannot send empty telemetry");return}if(ne.baseData&&!ne.baseType){Se.diagLog().throwInternal(Pe.CRITICAL,Re.InvalidEvent,"Cannot send telemetry without baseData and baseType");return}if(ne.baseType||(ne.baseType="EventData"),!u._sender){Se.diagLog().throwInternal(Pe.CRITICAL,Re.SenderNotInitialized,"Sender was not initialized");return}if(p(ne))ne[al]=u._sample.sampleRate;else{Se.diagLog().throwInternal(Pe.WARNING,Re.TelemetrySampledAndNotSent,"Telemetry item was sampled out and not sent",{SampleRate:u._sample.sampleRate});return}var ke=e.constructEnvelope(ne,u._senderConfig.instrumentationKey(),Se.diagLog());if(!ke){Se.diagLog().throwInternal(Pe.CRITICAL,Re.CreateEnvelopeError,"Unable to create an AppInsights envelope");return}var Te=!1;if(ne.tags&&ne.tags[ea]&&(gt(ne.tags[ea],function(yt){try{yt&&yt(ke)===!1&&(Te=!0,Se.diagLog().warnToConsole("Telemetry processor check returns false"))}catch(Bt){Se.diagLog().throwInternal(Pe.CRITICAL,Re.TelemetryInitializerFailed,"One of telemetry initializers failed, telemetry item will not be sent: "+At(Bt),{exception:lt(Bt)},!0)}}),delete ne.tags[ea]),Te)return;var ze=s.serialize(ke),Ze=u._buffer.getItems(),nt=u._buffer.batchPayloads(Ze);nt&&nt.length+ze.length>u._senderConfig.maxBatchSizeInBytes()&&u.triggerSend(!0,null,10),u._buffer.enqueue(ze),te()}catch(yt){Se.diagLog().throwInternal(Pe.WARNING,Re.FailedAddingTelemetryToBuffer,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+At(yt),{exception:lt(yt)})}u.processNext(ne,Se)},u._xhrReadyStateChange=function(ne,Se,ke){ne.readyState===4&&b(ne.status,Se,ne.responseURL,ke,G(ne),xl(ne)||ne.response)},u.triggerSend=function(ne,Se,ke){ne===void 0&&(ne=!0);try{if(u._senderConfig.disableTelemetry())u._buffer.clear();else{if(u._buffer.count()>0){var Te=u._buffer.getItems();ye(ke||0,ne),Se?Se.call(r,Te,ne):u._sender(Te,ne)}o=+new Date}clearTimeout(a),a=null,i=null}catch(Ze){var ze=cd();(!ze||ze>9)&&u.diagLog().throwInternal(Pe.CRITICAL,Re.TransmissionFailed,"Telemetry transmission failed, some telemetry will be lost: "+At(Ze),{exception:lt(Ze)})}},u._onError=function(ne,Se,ke){u.diagLog().throwInternal(Pe.WARNING,Re.OnError,"Failed to send telemetry.",{message:Se}),u._buffer.clearSent(ne)},u._onPartialSuccess=function(ne,Se){for(var ke=[],Te=[],ze=Se.errors.reverse(),Ze=0,nt=ze;Ze<nt.length;Ze++){var yt=nt[Ze],Bt=ne.splice(yt.index,1)[0];J(yt.statusCode)?Te.push(Bt):ke.push(Bt)}ne.length>0&&u._onSuccess(ne,Se.itemsAccepted),ke.length>0&&u._onError(ke,G(null,["partial success",Se.itemsAccepted,"of",Se.itemsReceived].join(" "))),Te.length>0&&(D(Te),u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,"Partial success. Delivered: "+ne.length+", Failed: "+ke.length+". Will retry to send "+Te.length+" our of "+Se.itemsReceived+" items"))},u._onSuccess=function(ne,Se){u._buffer.clearSent(ne)},u._xdrOnLoad=function(ne,Se){var ke=xl(ne);if(ne&&(ke+""=="200"||ke===""))n=0,u._onSuccess(Se,0);else{var Te=I(ke);Te&&Te.itemsReceived&&Te.itemsReceived>Te.itemsAccepted&&!u._senderConfig.isRetryDisabled()?u._onPartialSuccess(Se,Te):u._onError(Se,re(ne))}};function p(ne){return u._sample.isSampledIn(ne)}function b(ne,Se,ke,Te,ze,Ze){var nt=null;if(u._appId||(nt=I(Ze),nt&&nt.appId&&(u._appId=nt.appId)),(ne<200||ne>=300)&&ne!==0){if((ne===301||ne===307||ne===308)&&!y(ke)){u._onError(Se,ze);return}!u._senderConfig.isRetryDisabled()&&J(ne)?(D(Se),u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,". Response code "+ne+". Will retry to send "+Se.length+" items.")):u._onError(Se,ze)}else if(mh.isOffline()){if(!u._senderConfig.isRetryDisabled()){var yt=10;D(Se,yt),u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,". Offline - Response Code: "+ne+". Offline status: "+mh.isOffline()+". Will retry to send "+Se.length+" items.")}}else y(ke),ne===206?(nt||(nt=I(Ze)),nt&&!u._senderConfig.isRetryDisabled()?u._onPartialSuccess(Se,nt):u._onError(Se,ze)):(n=0,u._onSuccess(Se,Te))}function y(ne){return c>=10?!1:!Fe(ne)&&ne!==""&&ne!==u._senderConfig.endpointUrl()?(u._senderConfig.endpointUrl=function(){return ne},++c,!0):!1}function w(ne,Se){var ke=u._senderConfig.endpointUrl(),Te=u._buffer.batchPayloads(ne),ze=new Blob([Te],{type:"text/plain;charset=UTF-8"}),Ze=Tn().sendBeacon(ke,ze);Ze?(u._buffer.markAsSent(ne),u._onSuccess(ne,ne.length)):(_(ne,!0),u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,". Failed to send telemetry with Beacon API, retried with xhrSender."))}function _(ne,Se){var ke=new XMLHttpRequest,Te=u._senderConfig.endpointUrl();try{ke[uo]=!0}catch(Ze){}ke.open("POST",Te,Se),ke.setRequestHeader("Content-type","application/json"),dl(Te)&&ke.setRequestHeader(Wt.sdkContextHeader,Wt.sdkContextHeaderAppIdRequest),gt(no(l),function(Ze){ke.setRequestHeader(Ze,l[Ze])}),ke.onreadystatechange=function(){return u._xhrReadyStateChange(ke,ne,ne.length)},ke.onerror=function(Ze){return u._onError(ne,G(ke),Ze)};var ze=u._buffer.batchPayloads(ne);ke.send(ze),u._buffer.markAsSent(ne)}function S(ne,Se){var ke=u._senderConfig.endpointUrl(),Te=u._buffer.batchPayloads(ne),ze=new Blob([Te],{type:"text/plain;charset=UTF-8"}),Ze=new Headers;dl(ke)&&Ze.append(Wt.sdkContextHeader,Wt.sdkContextHeaderAppIdRequest),gt(no(l),function(Bt){Ze.append(Bt,l[Bt])});var nt={method:"POST",headers:Ze,body:ze},yt=new Request(ke,nt);fetch(yt).then(function(Bt){if(Bt.ok)Bt.text().then(function(un){b(Bt.status,ne,Bt.url,ne.length,Bt.statusText,un)}),u._buffer.markAsSent(ne);else throw Error(Bt.statusText)}).catch(function(Bt){u._onError(ne,Bt.message)})}function I(ne){try{if(ne&&ne!==""){var Se=hn().parse(ne);if(Se&&Se.itemsReceived&&Se.itemsReceived>=Se.itemsAccepted&&Se.itemsReceived-Se.itemsAccepted===Se.errors.length)return Se}}catch(ke){u.diagLog().throwInternal(Pe.CRITICAL,Re.InvalidBackendResponse,"Cannot parse the response. "+At(ke),{response:ne})}return null}function D(ne,Se){if(Se===void 0&&(Se=1),!(!ne||ne.length===0)){u._buffer.clearSent(ne),n++;for(var ke=0,Te=ne;ke<Te.length;ke++){var ze=Te[ke];u._buffer.enqueue(ze)}O(Se),te()}}function O(ne){var Se=10,ke;if(n<=1)ke=Se;else{var Te=(Math.pow(2,n)-1)/2,ze=Math.floor(Math.random()*Te*Se)+1;ze=ne*ze,ke=Math.max(Math.min(ze,3600),Se)}var Ze=Jr()+ke*1e3;i=Ze}function te(){if(!a){var ne=i?Math.max(0,i-Jr()):0,Se=Math.max(u._senderConfig.maxBatchInterval(),ne);a=setTimeout(function(){u.triggerSend(!0,null,1)},Se)}}function J(ne){return ne===408||ne===429||ne===500||ne===503}function G(ne,Se){return ne?"XMLHttpRequest,Status:"+ne.status+",Response:"+xl(ne)||0||0:Se}function ue(ne,Se){var ke=ns(),Te=new XDomainRequest;Te.onload=function(){return u._xdrOnLoad(Te,ne)},Te.onerror=function(yt){return u._onError(ne,re(Te),yt)};var ze=ke&&ke.location&&ke.location.protocol||"";if(u._senderConfig.endpointUrl().lastIndexOf(ze,0)!==0){u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,". Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol."),u._buffer.clear();return}var Ze=u._senderConfig.endpointUrl().replace(/^(https?:)/,"");Te.open("POST",Ze);var nt=u._buffer.batchPayloads(ne);Te.send(nt),u._buffer.markAsSent(ne)}function re(ne,Se){return ne?"XDomainRequest,Response:"+xl(ne)||0:Se}function ae(){var ne="getNotifyMgr";return u.core[ne]?u.core[ne]():u.core._notificationManager}function ye(ne,Se){var ke=ae();if(ke&&ke.eventsSendRequest)try{ke.eventsSendRequest(ne,Se)}catch(Te){u.diagLog().throwInternal(Pe.CRITICAL,Re.NotificationException,"send request notification failed: "+At(Te),{exception:lt(Te)})}}function dt(ne){var Se=Fe(ne.disableInstrumentationKeyValidation)?!1:ne.disableInstrumentationKeyValidation;if(Se)return!0;var ke="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",Te=new RegExp(ke);return Te.test(ne.instrumentationKey)}}),r}return e.constructEnvelope=function(r,n,i){var o;switch(n!==r.iKey&&!Fe(n)?o=Lo({},r,{iKey:n}):o=r,o.baseType){case mn.dataType:return gh.EventEnvelopeCreator.Create(i,o);case ni.dataType:return yv.TraceEnvelopeCreator.Create(i,o);case vn.dataType:return vv.PageViewEnvelopeCreator.Create(i,o);case ii.dataType:return wv.PageViewPerformanceEnvelopeCreator.Create(i,o);case Mr.dataType:return gv.ExceptionEnvelopeCreator.Create(i,o);case In.dataType:return mv.MetricEnvelopeCreator.Create(i,o);case Dn.dataType:return pv.DependencyEnvelopeCreator.Create(i,o);default:return gh.EventEnvelopeCreator.Create(i,o)}},e._getDefaultAppInsightsChannelConfig=function(){return{endpointUrl:function(){return"https://dc.services.visualstudio.com/v2/track"},emitLineDelimitedJson:function(){return!1},maxBatchInterval:function(){return 15e3},maxBatchSizeInBytes:function(){return 102400},disableTelemetry:function(){return!1},enableSessionStorageBuffer:function(){return!0},isRetryDisabled:function(){return!1},isBeaconApiDisabled:function(){return!0},onunloadDisableBeacon:function(){return!1},instrumentationKey:function(){},namePrefix:function(){},samplingPercentage:function(){return 100},customHeaders:function(){}}},e._getEmptyAppInsightsChannelConfig=function(){return{endpointUrl:void 0,emitLineDelimitedJson:void 0,maxBatchInterval:void 0,maxBatchSizeInBytes:void 0,disableTelemetry:void 0,enableSessionStorageBuffer:void 0,isRetryDisabled:void 0,isBeaconApiDisabled:void 0,onunloadDisableBeacon:void 0,instrumentationKey:void 0,namePrefix:void 0,samplingPercentage:void 0,customHeaders:void 0}},e}(so)}),Ev=xe(()=>{uE()}),Rv,wh,Av,dE=xe(()=>{pr(),lr(),wt(),Rv="ai_session",wh=function(){function t(){}return t}(),Av=function(){function t(e,r){var n=this,i,o,a=Gc(r),s=_d(r);nr(t,n,function(c){e||(e={}),St(e.sessionExpirationMs)||(e.sessionExpirationMs=function(){return t.acquisitionSpan}),St(e.sessionRenewalMs)||(e.sessionRenewalMs=function(){return t.renewalSpan}),c.config=e;var l=c.config.sessionCookiePostfix&&c.config.sessionCookiePostfix()?c.config.sessionCookiePostfix():c.config.namePrefix&&c.config.namePrefix()?c.config.namePrefix():"";i=function(){return Rv+l},c.automaticSession=new wh,c.update=function(){var y=Jr(),w=!1,_=c.automaticSession;_.id||(w=!u(_,y));var S=c.config.sessionExpirationMs();if(!w&&S>0){var I=c.config.sessionRenewalMs(),D=y-_.acquisitionDate,O=y-_.renewalDate;w=D<0||O<0,w=w||D>S,w=w||O>I}w?h(y):(!o||y-o>t.cookieUpdateInterval)&&p(_,y)},c.backup=function(){var y=c.automaticSession;b(y.id,y.acquisitionDate,y.renewalDate)};function u(y,w){var _=!1,S=s.get(i());if(S&&St(S.split))_=f(y,S);else{var I=Cm(a,i());I&&(_=f(y,I))}return _||!!y.id}function f(y,w){var _=!1,S=", session will be reset",I=w.split("|");if(I.length>=2)try{var D=+I[1]||0,O=+I[2]||0;isNaN(D)||D<=0?a.throwInternal(Pe.WARNING,Re.SessionRenewalDateIsZero,"AI session acquisition date is 0"+S):isNaN(O)||O<=0?a.throwInternal(Pe.WARNING,Re.SessionRenewalDateIsZero,"AI session renewal date is 0"+S):I[0]&&(y.id=I[0],y.acquisitionDate=D,y.renewalDate=O,_=!0)}catch(te){a.throwInternal(Pe.CRITICAL,Re.ErrorParsingAISessionCookie,"Error parsing ai_session value ["+(w||"")+"]"+S+" - "+At(te),{exception:lt(te)})}return _}function h(y){var w=c.config||{},_=(w.getNewId?w.getNewId():null)||nl;c.automaticSession.id=_(w.idLength?w.idLength():22),c.automaticSession.acquisitionDate=y,p(c.automaticSession,y),Kd()||a.throwInternal(Pe.WARNING,Re.BrowserDoesNotSupportLocalStorage,"Browser does not support local storage. Session durations will be inaccurate.")}function p(y,w){var _=y.acquisitionDate;y.renewalDate=w;var S=c.config,I=S.sessionRenewalMs(),D=_+S.sessionExpirationMs()-w,O=[y.id,_,w],te=0;D<I?te=D/1e3:te=I/1e3;var J=S.cookieDomain?S.cookieDomain():null;s.set(i(),O.join("|"),S.sessionExpirationMs()>0?te:null,J),o=w}function b(y,w,_){Em(a,i(),[y,w,_].join("|"))}})}return t.acquisitionSpan=864e5,t.renewalSpan=18e5,t.cookieUpdateInterval=6e4,t}()}),Tv,hE=xe(()=>{Tv=function(){function t(){}return t}()}),kv,fE=xe(()=>{kv=function(){function t(){this.id="browser",this.deviceClass="Browser"}return t}()}),Iv,Dv,pE=xe(()=>{Iv="2.6.4",Dv=function(){function t(e){this.sdkVersion=(e.sdkExtension&&e.sdkExtension()?e.sdkExtension()+"_":"")+"javascript:"+Iv}return t}()});function Pv(t){return!(typeof t!="string"||!t||t.match(/,|;|=| |\|/))}var Fv,gE=xe(()=>{pr(),lr(),wt(),Fv=function(){function t(e,r){this.isNewUser=!1;var n=Gc(r),i=_d(r),o;nr(t,this,function(a){a.config=e;var s=a.config.userCookiePostfix&&a.config.userCookiePostfix()?a.config.userCookiePostfix():"";o=function(){return t.userCookieName+s};var c=i.get(o());if(c){a.isNewUser=!1;var l=c.split(t.cookieSeparator);l.length>0&&(a.id=l[0])}if(!a.id){var u=e||{},f=(u.getNewId?u.getNewId():null)||nl;a.id=f(u.idLength?e.idLength():22);var h=31536e3,p=xi(new Date);a.accountAcquisitionDate=p,a.isNewUser=!0;var b=[a.id,p];i.set(o(),b.join(t.cookieSeparator),h);var y=e.namePrefix&&e.namePrefix()?e.namePrefix()+"ai_session":"ai_session";Rm(n,y)}a.accountId=e.accountId?e.accountId():void 0;var w=i.get(t.authUserCookieName);if(w){w=decodeURI(w);var _=w.split(t.cookieSeparator);_[0]&&(a.authenticatedId=_[0]),_.length>1&&_[1]&&(a.accountId=_[1])}a.setAuthenticatedUserContext=function(S,I,D){D===void 0&&(D=!1);var O=!Pv(S)||I&&!Pv(I);if(O){n.throwInternal(Pe.WARNING,Re.SetAuthContextFailedAccountName,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0);return}a.authenticatedId=S;var te=a.authenticatedId;I&&(a.accountId=I,te=[a.authenticatedId,a.accountId].join(t.cookieSeparator)),D&&i.set(t.authUserCookieName,encodeURI(te))},a.clearAuthenticatedUserContext=function(){a.authenticatedId=null,a.accountId=null,i.del(t.authUserCookieName)}})}return t.cookieSeparator="|",t.userCookieName="ai_user",t.authUserCookieName="ai_authUser",t}()}),Nv,mE=xe(()=>{Nv=function(){function t(){}return t}()}),$v,vE=xe(()=>{lr(),wt(),$v=function(){function t(e,r,n,i){var o=this;o.traceID=e||kn(),o.parentID=r,o.name=n;var a=io();!n&&a&&a.pathname&&(o.name=a.pathname),o.name=Nr(i,o.name)}return t}()});function aa(t,e){t&&t[e]&&no(t[e]).length===0&&delete t[e]}var vs,ws,Mv,wE=xe(()=>{pr(),wt(),dE(),lr(),hE(),fE(),pE(),gE(),mE(),vE(),vs="ext",ws="tags",Mv=function(){function t(e,r){var n=this,i=e.logger;this.appId=function(){return null},nr(t,this,function(o){o.application=new Tv,o.internal=new Dv(r),Hc()&&(o.sessionManager=new Av(r,e),o.device=new kv,o.location=new Nv,o.user=new Fv(r,e),o.telemetryTrace=new $v(void 0,void 0,void 0,i),o.session=new wh),o.applySessionContext=function(a,s){var c=o.session,l=o.sessionManager;c&&pt(c.id)?Ct(Er(a.ext,Br.AppExt),"sesId",c.id):l&&l.automaticSession&&Ct(Er(a.ext,Br.AppExt),"sesId",l.automaticSession.id,pt)},o.applyOperatingSystemContxt=function(a,s){Ct(a.ext,Br.OSExt,o.os)},o.applyApplicationContext=function(a,s){var c=o.application;if(c){var l=Er(a,ws);Ct(l,Lt.applicationVersion,c.ver,pt),Ct(l,Lt.applicationBuild,c.build,pt)}},o.applyDeviceContext=function(a,s){var c=o.device;if(c){var l=Er(Er(a,vs),Br.DeviceExt);Ct(l,"localId",c.id,pt),Ct(l,"ip",c.ip,pt),Ct(l,"model",c.model,pt),Ct(l,"deviceClass",c.deviceClass,pt)}},o.applyInternalContext=function(a,s){var c=o.internal;if(c){var l=Er(a,ws);Ct(l,Lt.internalAgentVersion,c.agentVersion,pt),Ct(l,Lt.internalSdkVersion,c.sdkVersion,pt),(a.baseType===jo.dataType||a.baseType===vn.dataType)&&(Ct(l,Lt.internalSnippet,c.snippetVer,pt),Ct(l,Lt.internalSdkSrc,c.sdkSrc,pt))}},o.applyLocationContext=function(a,s){var c=n.location;c&&Ct(Er(a,ws,[]),Lt.locationIp,c.ip,pt)},o.applyOperationContext=function(a,s){var c=o.telemetryTrace;if(c){var l=Er(Er(a,vs),Br.TraceExt,{traceID:void 0,parentID:void 0});Ct(l,"traceID",c.traceID,pt),Ct(l,"name",c.name,pt),Ct(l,"parentID",c.parentID,pt)}},o.applyWebContext=function(a,s){var c=n.web;c&&Ct(Er(a,vs),Br.WebExt,c)},o.applyUserContext=function(a,s){var c=o.user;if(c){var l=Er(a,ws,[]);Ct(l,Lt.userAccountId,c.accountId,pt);var u=Er(Er(a,vs),Br.UserExt);Ct(u,"id",c.id,pt),Ct(u,"authId",c.authenticatedId,pt)}},o.cleanUp=function(a,s){var c=a.ext;c&&(aa(c,Br.DeviceExt),aa(c,Br.UserExt),aa(c,Br.WebExt),aa(c,Br.OSExt),aa(c,Br.AppExt),aa(c,Br.TraceExt))}})}return t}()}),Bv,yh,yE=xe(()=>{Ut(),pr(),wt(),wE(),lr(),Bv=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.priority=110,r.identifier=oa;var n,i;return nr(e,r,function(o,a){o.initialize=function(c,l,u,f){a.initialize(c,l,u,f);var h=o._getTelCtx(),p=o.identifier,b=e.getDefaultConfig();i=i||{},cr(b,function(y,w){i[y]=function(){return h.getConfig(p,y,w())}}),o.context=new Mv(l,i),n=bm(u,yl),o.context.appId=function(){return n?n._appId:null},o._extConfig=i},o.processTelemetry=function(c,l){if(!Fe(c)){l=o._getTelCtx(l),c.name===vn.envelopeType&&l.diagLog().resetInternalMessageCount();var u=o.context||{};if(u.session&&typeof o.context.session.id!="string"&&u.sessionManager&&u.sessionManager.update(),s(c,l),u.user&&u.user.isNewUser){u.user.isNewUser=!1;var f=new jo(Re.SendBrowserInfoOnUserInit,(Tn()||{}).userAgent||"");l.diagLog().logInternalMessage(Pe.CRITICAL,f)}o.processNext(c,l)}};function s(c,l){Er(c,"tags",[]),Er(c,"ext",{});var u=o.context;u.applySessionContext(c,l),u.applyApplicationContext(c,l),u.applyDeviceContext(c,l),u.applyOperationContext(c,l),u.applyUserContext(c,l),u.applyOperatingSystemContxt(c,l),u.applyWebContext(c,l),u.applyLocationContext(c,l),u.applyInternalContext(c,l),u.cleanUp(c,l)}}),r}return e.getDefaultConfig=function(){var r={instrumentationKey:function(){},accountId:function(){return null},sessionRenewalMs:function(){return 30*60*1e3},samplingPercentage:function(){return 100},sessionExpirationMs:function(){return 24*60*60*1e3},cookieDomain:function(){return null},sdkExtension:function(){return null},isBrowserLinkTrackingEnabled:function(){return!1},appId:function(){return null},namePrefix:function(){},sessionCookiePostfix:function(){},userCookiePostfix:function(){},idLength:function(){return 22},getNewId:function(){return null}};return r},e}(so),yh=Bv}),Ov=xe(()=>{yE()});function Uv(t,e,r){var n=0,i=t[e],o=t[r];return i&&o&&(n=$r(i,o)),n}function go(t,e,r,n,i){var o=0,a=Uv(r,n,i);return a&&(o=Ii(t,e,ri(a))),o}function Ii(t,e,r){var n="ajaxPerf",i=0;if(t&&e&&r){var o=t[n]=t[n]||{};o[e]=r,i=1}return i}function bE(t,e){var r=t.perfTiming,n=e[Lr]||{},i=0,o="name",a="Start",s="End",c="domainLookup",l="connect",u="redirect",f="request",h="response",p="duration",b="startTime",y=c+a,w=c+s,_=l+a,S=l+s,I=f+a,D=f+s,O=h+a,te=h+s,J=u+a,G=u=s,ue="transferSize",re="encodedBodySize",ae="decodedBodySize",ye="serverTiming";if(r){i|=go(n,u,r,J,G),i|=go(n,c,r,y,w),i|=go(n,l,r,_,S),i|=go(n,f,r,I,D),i|=go(n,h,r,O,te),i|=go(n,"networkConnect",r,b,S),i|=go(n,"sentRequest",r,I,te);var dt=r[p];dt||(dt=Uv(r,b,te)||0),i|=Ii(n,p,dt),i|=Ii(n,"perfTotal",dt);var ne=r[ye];if(ne){var Se={};gt(ne,function(ke,Te){var ze=WC(ke[o]||""+Te),Ze=Se[ze]||{};cr(ke,function(nt,yt){(nt!==o&&pt(yt)||Ju(yt))&&(Ze[nt]&&(yt=Ze[nt]+";"+yt),(yt||!pt(yt))&&(Ze[nt]=yt))}),Se[ze]=Ze}),i|=Ii(n,ye,Se)}i|=Ii(n,ue,r[ue]),i|=Ii(n,re,r[re]),i|=Ii(n,ae,r[ae])}else t.perfMark&&(i|=Ii(n,"missing",t.perfAttempts));i&&(e[Lr]=n)}var Lr,Lv,bh,_E=xe(()=>{lr(),wt(),pr(),Lr="properties",Lv=function(){function t(){var e=this;e.openDone=!1,e.setRequestHeaderDone=!1,e.sendDone=!1,e.abortDone=!1,e.stateChangeAttached=!1}return t}(),bh=function(){function t(e,r,n){var i=this,o=n,a="responseText";i.perfMark=null,i.completed=!1,i.requestHeadersSize=null,i.requestHeaders=null,i.responseReceivingDuration=null,i.callbackDuration=null,i.ajaxTotalDuration=null,i.aborted=0,i.pageUrl=null,i.requestUrl=null,i.requestSize=0,i.method=null,i.status=null,i.requestSentTime=null,i.responseStartedTime=null,i.responseFinishedTime=null,i.callbackFinishedTime=null,i.endTime=null,i.xhrMonitoringState=new Lv,i.clientFailure=0,i.traceID=e,i.spanID=r,nr(t,i,function(s){s.getAbsoluteUrl=function(){return s.requestUrl?km(s.requestUrl):null},s.getPathName=function(){return s.requestUrl?ds(o,Im(s.method,s.requestUrl)):null},s.CreateTrackItem=function(c,l,u){if(s.ajaxTotalDuration=Math.round($r(s.requestSentTime,s.responseFinishedTime)*1e3)/1e3,s.ajaxTotalDuration<0)return null;var f=(y={id:"|"+s.traceID+"."+s.spanID,target:s.getAbsoluteUrl(),name:s.getPathName(),type:c,startTime:null,duration:s.ajaxTotalDuration,success:+s.status>=200&&+s.status<400,responseCode:+s.status,method:s.method},y[Lr]={HttpMethod:s.method},y);if(s.requestSentTime&&(f.startTime=new Date,f.startTime.setTime(s.requestSentTime)),bE(s,f),l&&no(s.requestHeaders).length>0&&(f[Lr]=f[Lr]||{},f[Lr].requestHeaders=s.requestHeaders),u){var h=u();if(h){var p=h.correlationContext;if(p&&(f.correlationContext=p),h.headerMap&&no(h.headerMap).length>0&&(f[Lr]=f[Lr]||{},f[Lr].responseHeaders=h.headerMap),s.status>=400){var b=h.type;f[Lr]=f[Lr]||{},(b===""||b==="text")&&(f[Lr][a]=h[a]?h.statusText+" - "+h[a]:h.statusText),b==="json"&&(f[Lr][a]=h.response?h.statusText+" - "+JSON.stringify(h.response):h.statusText)}}}return f;var y}})}return t}()}),xE,SE=xe(()=>{wt(),wt(),xE=function(){function t(){}return t.GetLength=function(e){var r=0;if(!Fe(e)){var n="";try{n=e.toString()}catch(i){}r=n.length,r=isNaN(r)?0:r}return r},t}()}),_h,CE=xe(()=>{wt(),_h=function(){function t(e,r){var n=this;n.traceFlag=t.DEFAULT_TRACE_FLAG,n.version=t.DEFAULT_VERSION,e&&t.isValidTraceId(e)?n.traceId=e:n.traceId=kn(),r&&t.isValidSpanId(r)?n.spanId=r:n.spanId=kn().substr(0,16)}return t.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&e!=="00000000000000000000000000000000"},t.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&e!=="0000000000000000"},t.prototype.toString=function(){var e=this;return e.version+"-"+e.traceId+"-"+e.spanId+"-"+e.traceFlag},t.DEFAULT_TRACE_FLAG="01",t.DEFAULT_VERSION="00",t}()});function EE(){var t=Uo();return!t||Fe(t.Request)||Fe(t.Request[Xr])||Fe(t[la])?null:t[la]}function RE(t){var e=!1;if(typeof XMLHttpRequest!==Xn&&!Fe(XMLHttpRequest)){var r=XMLHttpRequest[Xr];e=!Fe(r)&&!Fe(r.open)&&!Fe(r.send)&&!Fe(r.abort)}var n=cd();if(n&&n<9&&(e=!1),e)try{var i=new XMLHttpRequest;i[Hr]={};var o=XMLHttpRequest[Xr].open;XMLHttpRequest[Xr].open=o}catch(a){e=!1,ys(t,Re.FailedMonitorAjaxOpen,"Failed to enable XMLHttpRequest monitoring, extension is not supported",{exception:lt(a)})}return e}function Sl(t){var e="";try{!Fe(t)&&!Fe(t[Hr])&&!Fe(t[Hr].requestUrl)&&(e+="(url: '"+t[Hr].requestUrl+"')")}catch(r){}return e}function ys(t,e,r,n,i){t[ca]()[Sh](Pe.CRITICAL,e,r,n,i)}function Cl(t,e,r,n,i){t[ca]()[Sh](Pe.WARNING,e,r,n,i)}function bs(t,e,r){return function(n){ys(t,e,r,{ajaxDiagnosticsMessage:Sl(n.inst),exception:lt(n.err)})}}function sa(t,e){return t&&e?t.indexOf(e):-1}var xh,ca,Hr,Sh,la,Ch,Eh,AE=xe(()=>{Ut(),lr(),wt(),_E(),SE(),CE(),pr(),xh="ai.ajxmn.",ca="diagLog",Hr="ajaxData",Sh="throwInternal",la="fetch",Ch=0,Eh=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.identifier=e.identifier,r.priority=120;var n="trackDependencyDataInternal",i=io(),o=!1,a=!1,s=i&&i.host&&i.host.toLowerCase(),c=e.getEmptyConfig(),l=!1,u=0,f,h,p,b,y=!1,w=0,_=!1,S=[],I={},D;return nr(e,r,function(O,te){O.initialize=function(ve,Ie,Oe,Ne){if(!O.isInitialized()){te.initialize(ve,Ie,Oe,Ne);var Ve=O._getTelCtx(),tt=e.getDefaultConfig();cr(tt,function(Dr,vi){c[Dr]=Ve.getConfig(e.identifier,Dr,vi)});var et=c.distributedTracingMode;if(l=c.enableRequestHeaderTracking,y=c.enableAjaxPerfTracking,w=c.maxAjaxCallsPerView,_=c.enableResponseHeaderTracking,D=c.excludeRequestFromAutoTrackingPatterns,p=et===gn.AI||et===gn.AI_AND_W3C,h=et===gn.AI_AND_W3C||et===gn.W3C,y){var bt=ve.instrumentationKey||"unkwn";bt.length>5?b=xh+bt.substring(bt.length-5)+".":b=xh+bt+"."}if(c.disableAjaxTracking===!1&&re(),G(),Oe.length>0&&Oe){for(var zt=void 0,er=0;!zt&&er<Oe.length;)Oe[er]&&Oe[er].identifier===oa&&(zt=Oe[er]),er++;zt&&(f=zt.context)}}},O.teardown=function(){gt(S,function(ve){ve.rm()}),S=[],o=!1,a=!1,O.setInitialized(!1)},O.trackDependencyData=function(ve,Ie){O[n](ve,Ie)},O.includeCorrelationHeaders=function(ve,Ie,Oe,Ne){var Ve=O._currentWindowHost||s;if(Ie){if(Ai.canIncludeCorrelationHeader(c,ve.getAbsoluteUrl(),Ve)){if(Oe||(Oe={}),Oe.headers=new Headers(Oe.headers||(Ie instanceof Request?Ie.headers||{}:{})),p){var tt="|"+ve.traceID+"."+ve.spanID;Oe.headers.set(Wt.requestIdHeader,tt),l&&(ve.requestHeaders[Wt.requestIdHeader]=tt)}var et=c.appId||f&&f.appId();if(et&&(Oe.headers.set(Wt.requestContextHeader,Wt.requestContextAppIdFormat+et),l&&(ve.requestHeaders[Wt.requestContextHeader]=Wt.requestContextAppIdFormat+et)),h){var bt=new _h(ve.traceID,ve.spanID);Oe.headers.set(Wt.traceParentHeader,bt.toString()),l&&(ve.requestHeaders[Wt.traceParentHeader]=bt.toString())}}return Oe}else if(Ne){if(Ai.canIncludeCorrelationHeader(c,ve.getAbsoluteUrl(),Ve)){if(p){var tt="|"+ve.traceID+"."+ve.spanID;Ne.setRequestHeader(Wt.requestIdHeader,tt),l&&(ve.requestHeaders[Wt.requestIdHeader]=tt)}var et=c.appId||f&&f.appId();if(et&&(Ne.setRequestHeader(Wt.requestContextHeader,Wt.requestContextAppIdFormat+et),l&&(ve.requestHeaders[Wt.requestContextHeader]=Wt.requestContextAppIdFormat+et)),h){var bt=new _h(ve.traceID,ve.spanID);Ne.setRequestHeader(Wt.traceParentHeader,bt.toString()),l&&(ve.requestHeaders[Wt.traceParentHeader]=bt.toString())}}return Ne}},O[n]=function(ve,Ie,Oe){if(w===-1||u<w){(c.distributedTracingMode===gn.W3C||c.distributedTracingMode===gn.AI_AND_W3C)&&typeof ve.id=="string"&&ve.id[ve.id.length-1]!=="."&&(ve.id+="."),Fe(ve.startTime)&&(ve.startTime=new Date);var Ne=Pn.create(ve,Dn.dataType,Dn.envelopeType,O[ca](),Ie,Oe);O.core.track(Ne)}else u===w&&ys(O,Re.MaxAjaxPerPVExceeded,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++u};function J(ve){var Ie=!0;return(ve||c.ignoreHeaders)&&gt(c.ignoreHeaders,function(Oe){if(Oe.toLowerCase()===ve.toLowerCase())return Ie=!1,-1}),Ie}function G(){var ve=EE();if(ve){var Ie=Uo(),Oe=ve.polyfill;c.disableFetchTracking===!1?(S.push(Bd(Ie,la,{req:function(Ne,Ve,tt){var et;if(o&&!ae(null,Ve,tt)&&!(Oe&&a)){var bt=Ne.ctx();et=nt(Ve,tt);var zt=O.includeCorrelationHeaders(et,Ve,tt);zt!==tt&&Ne.set(1,zt),bt.data=et}},rsp:function(Ne,Ve){var tt=Ne.ctx().data;tt&&(Ne.rslt=Ne.rslt.then(function(et){return Bt(Ne,(et||{}).status,et,tt,function(){var bt={statusText:et.statusText,headerMap:null,correlationContext:un(et)};if(_){var zt={};et.headers.forEach(function(er,Dr){J(Dr)&&(zt[Dr]=er)}),bt.headerMap=zt}return bt}),et}).catch(function(et){throw Bt(Ne,0,Ve,tt,null,{error:et.message}),et}))},hkErr:bs(O,Re.FailedMonitorAjaxOpen,"Failed to monitor Window.fetch, monitoring data for this fetch call may be incorrect.")})),o=!0):Oe&&S.push(Bd(Ie,la,{req:function(Ne,Ve,tt){ae(null,Ve,tt)}})),Oe&&(Ie[la].polyfill=Oe)}}function ue(ve,Ie,Oe){S.push(w1(ve,Ie,Oe))}function re(){RE(O)&&!a&&(ue(XMLHttpRequest,"open",{req:function(ve,Ie,Oe,Ne){var Ve=ve.inst,tt=Ve[Hr];!ae(Ve,Oe)&&ye(Ve,!0)&&(!tt||!tt.xhrMonitoringState.openDone)&&dt(Ve,Ie,Oe,Ne)},hkErr:bs(O,Re.FailedMonitorAjaxOpen,"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.")}),ue(XMLHttpRequest,"send",{req:function(ve,Ie){var Oe=ve.inst,Ne=Oe[Hr];ye(Oe)&&!Ne.xhrMonitoringState.sendDone&&(ze("xhr",Ne),Ne.requestSentTime=fs(),O.includeCorrelationHeaders(Ne,void 0,void 0,Oe),Ne.xhrMonitoringState.sendDone=!0)},hkErr:bs(O,Re.FailedMonitorAjaxSend,"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.")}),ue(XMLHttpRequest,"abort",{req:function(ve){var Ie=ve.inst,Oe=Ie[Hr];ye(Ie)&&!Oe.xhrMonitoringState.abortDone&&(Oe.aborted=1,Oe.xhrMonitoringState.abortDone=!0)},hkErr:bs(O,Re.FailedMonitorAjaxAbort,"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.")}),l&&ue(XMLHttpRequest,"setRequestHeader",{req:function(ve,Ie,Oe){var Ne=ve.inst;ye(Ne)&&J(Ie)&&(Ne[Hr].requestHeaders[Ie]=Oe)},hkErr:bs(O,Re.FailedMonitorAjaxSetRequestHeader,"Failed to monitor XMLHttpRequest.setRequestHeader, monitoring data for this ajax call may be incorrect.")}),a=!0)}function ae(ve,Ie,Oe){var Ne=!1,Ve=((pt(Ie)?Ie:(Ie||{}).url||"")||"").toLowerCase();if(gt(D,function(bt){var zt=bt;pt(bt)&&(zt=new RegExp(bt)),Ne||(Ne=zt.test(Ve))}),Ne)return Ne;var tt=sa(Ve,"?"),et=sa(Ve,"#");return(tt===-1||et!==-1&&et<tt)&&(tt=et),tt!==-1&&(Ve=Ve.substring(0,tt)),Fe(ve)?Fe(Ie)||(Ne=(typeof Ie=="object"?Ie[uo]===!0:!1)||(Oe?Oe[uo]===!0:!1)):Ne=ve[uo]===!0||Ve[uo]===!0,Ne?I[Ve]||(I[Ve]=1):I[Ve]&&(Ne=!0),Ne}function ye(ve,Ie){var Oe=!0,Ne=a;return Fe(ve)||(Oe=Ie===!0||!Fe(ve[Hr])),Ne&&Oe}function dt(ve,Ie,Oe,Ne){var Ve=f&&f.telemetryTrace&&f.telemetryTrace.traceID||kn(),tt=kn().substr(0,16),et=new bh(Ve,tt,O[ca]());et.method=Ie,et.requestUrl=Oe,et.xhrMonitoringState.openDone=!0,et.requestHeaders={},et.async=Ne,ve[Hr]=et,ne(ve)}function ne(ve){ve[Hr].xhrMonitoringState.stateChangeAttached=us.Attach(ve,"readystatechange",function(){try{ve&&ve.readyState===4&&ye(ve)&&ke(ve)}catch(Oe){var Ie=lt(Oe);(!Ie||sa(Ie.toLowerCase(),"c00c023f")===-1)&&ys(O,Re.FailedMonitorAjaxRSC,"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:Sl(ve),exception:Ie})}})}function Se(ve){try{var Ie=ve.responseType;if(Ie===""||Ie==="text")return ve.responseText}catch(Oe){}return null}function ke(ve){var Ie=ve[Hr];Ie.responseFinishedTime=fs(),Ie.status=ve.status;function Oe(Ne,Ve){var tt=Ve||{};tt.ajaxDiagnosticsMessage=Sl(ve),Ne&&(tt.exception=lt(Ne)),Cl(O,Re.FailedMonitorAjaxDur,"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.",tt)}Ze("xmlhttprequest",Ie,function(){try{var Ne=Ie.CreateTrackItem("Ajax",l,function(){var Ve={statusText:ve.statusText,headerMap:null,correlationContext:Te(ve),type:ve.responseType,responseText:Se(ve),response:ve.response};if(_){var tt=ve.getAllResponseHeaders();if(tt){var et=wr(tt).split(/[\r\n]+/),bt={};gt(et,function(zt){var er=zt.split(": "),Dr=er.shift(),vi=er.join(": ");J(Dr)&&(bt[Dr]=vi)}),Ve.headerMap=bt}}return Ve});Ne?O[n](Ne):Oe(null,{requestSentTime:Ie.requestSentTime,responseFinishedTime:Ie.responseFinishedTime})}finally{try{ve[Hr]=null}catch(Ve){}}},function(Ne){Oe(Ne,null)})}function Te(ve){try{var Ie=ve.getAllResponseHeaders();if(Ie!==null){var Oe=sa(Ie.toLowerCase(),Wt.requestContextHeaderLowerCase);if(Oe!==-1){var Ne=ve.getResponseHeader(Wt.requestContextHeader);return Ai.getCorrelationContext(Ne)}}}catch(Ve){Cl(O,Re.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{ajaxDiagnosticsMessage:Sl(ve),exception:lt(Ve)})}}function ze(ve,Ie){if(Ie.requestUrl&&b&&y){var Oe=Jn();if(Oe&&St(Oe.mark)){Ch++;var Ne=b+ve+"#"+Ch;Oe.mark(Ne);var Ve=Oe.getEntriesByName(Ne);Ve&&Ve.length===1&&(Ie.perfMark=Ve[0])}}}function Ze(ve,Ie,Oe,Ne){var Ve=Ie.perfMark,tt=Jn(),et=c.maxAjaxPerfLookupAttempts,bt=c.ajaxPerfLookupDelay,zt=Ie.requestUrl,er=0;(function Dr(){try{if(tt&&Ve){er++;for(var vi=null,gu=tt.getEntries(),Da=gu.length-1;Da>=0;Da--){var dn=gu[Da];if(dn){if(dn.entryType==="resource")dn.initiatorType===ve&&(sa(dn.name,zt)!==-1||sa(zt,dn.name)!==-1)&&(vi=dn);else if(dn.entryType==="mark"&&dn.name===Ve.name){Ie.perfTiming=vi;break}if(dn.startTime<Ve.startTime-1e3)break}}}!Ve||Ie.perfTiming||er>=et||Ie.async===!1?(Ve&&St(tt.clearMarks)&&tt.clearMarks(Ve.name),Ie.perfAttempts=er,Oe()):setTimeout(Dr,bt)}catch(rp){Ne(rp)}})()}function nt(ve,Ie){var Oe=f&&f.telemetryTrace&&f.telemetryTrace.traceID||kn(),Ne=kn().substr(0,16),Ve=new bh(Oe,Ne,O[ca]());Ve.requestSentTime=fs(),ve instanceof Request?Ve.requestUrl=ve?ve.url:"":Ve.requestUrl=ve;var tt="GET";Ie&&Ie.method?tt=Ie.method:ve&&ve instanceof Request&&(tt=ve.method),Ve.method=tt;var et={};if(l){var bt=new Headers((Ie?Ie.headers:0)||(ve instanceof Request?ve.headers||{}:{}));bt.forEach(function(zt,er){J(er)&&(et[er]=zt)})}return Ve.requestHeaders=et,ze("fetch",Ve),Ve}function yt(ve){var Ie="";try{Fe(ve)||(typeof ve=="string"?Ie+="(url: '"+ve+"')":Ie+="(url: '"+ve.url+"')")}catch(Oe){ys(O,Re.FailedMonitorAjaxOpen,"Failed to grab failed fetch diagnostics message",{exception:lt(Oe)})}return Ie}function Bt(ve,Ie,Oe,Ne,Ve,tt){if(!Ne)return;function et(bt,zt,er){var Dr=er||{};Dr.fetchDiagnosticsMessage=yt(Oe),zt&&(Dr.exception=lt(zt)),Cl(O,bt,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",Dr)}Ne.responseFinishedTime=fs(),Ne.status=Ie,Ze("fetch",Ne,function(){var bt=Ne.CreateTrackItem("Fetch",l,Ve);bt?O[n](bt):et(Re.FailedMonitorAjaxDur,null,{requestSentTime:Ne.requestSentTime,responseFinishedTime:Ne.responseFinishedTime})},function(bt){et(Re.FailedMonitorAjaxGetCorrelationHeader,bt,null)})}function un(ve){if(ve&&ve.headers)try{var Ie=ve.headers.get(Wt.requestContextHeader);return Ai.getCorrelationContext(Ie)}catch(Oe){Cl(O,Re.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{fetchDiagnosticsMessage:yt(ve),exception:lt(Oe)})}}}),r}return e.getDefaultConfig=function(){var r={maxAjaxCallsPerView:500,disableAjaxTracking:!1,disableFetchTracking:!0,excludeRequestFromAutoTrackingPatterns:void 0,disableCorrelationHeaders:!1,distributedTracingMode:gn.AI_AND_W3C,correlationHeaderExcludedDomains:["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],correlationHeaderDomains:void 0,correlationHeaderExcludePatterns:void 0,appId:void 0,enableCorsCorrelation:!1,enableRequestHeaderTracking:!1,enableResponseHeaderTracking:!1,enableAjaxErrorStatusText:!1,enableAjaxPerfTracking:!1,maxAjaxPerfLookupAttempts:3,ajaxPerfLookupDelay:25,ignoreHeaders:["Authorization","X-API-Key","WWW-Authenticate"]};return r},e.getEmptyConfig=function(){var r=this.getDefaultConfig();return cr(r,function(n){r[n]=void 0}),r},e.prototype.processTelemetry=function(r,n){this.processNext(r,n)},e.identifier="AjaxDependencyPlugin",e}(so)}),Hv=xe(()=>{AE()}),Rh,Ah,qv,Wv,Th,zv=xe(()=>{wt(),dv(),Ev(),Ov(),Hv(),lr(),Ah=["snippet","dependencies","properties","_snippetVersion","appInsightsNew","getSKUDefaults"],qv={Default:0,Required:1,Array:2,Hidden:4},Wv={__proto__:null,PropertiesPluginIdentifier:oa,BreezeChannelIdentifier:yl,AnalyticsPluginIdentifier:uh,Util:Yd,CorrelationIdHelper:Ai,UrlHelper:$m,DateTimeUtils:Mm,ConnectionStringParser:Hm,FieldType:qv,RequestHeaders:Wt,DisabledPropertyName:uo,ProcessLegacy:ea,SampleRate:al,HttpMethod:sl,DEFAULT_BREEZE_ENDPOINT:jd,AIData:eh,AIBase:Jd,Envelope:th,Event:mn,Exception:Mr,Metric:In,PageView:vn,PageViewData:ml,RemoteDependencyData:Dn,Trace:ni,PageViewPerformance:ii,Data:oi,SeverityLevel:ps,ConfigurationManager:ov,ContextTagKeys:wl,DataSanitizer:wm,TelemetryItemCreator:Pn,CtxTagKeys:Lt,Extensions:Br,DistributedTracingModes:gn},Th=function(){function t(e){var r=this;r._snippetVersion=""+(e.sv||e.version||""),e.queue=e.queue||[],e.version=e.version||2;var n=e.config||{};if(n.connectionString){var i=Om(n.connectionString),o=i.ingestionendpoint;n.endpointUrl=o?o+"/v2/track":n.endpointUrl,n.instrumentationKey=i.instrumentationkey||n.instrumentationKey}r.appInsights=new hh,r.properties=new yh,r.dependencies=new Eh,r.core=new Pd,r._sender=new vh,r.snippet=e,r.config=n,r.getSKUDefaults()}return t.prototype.getCookieMgr=function(){return this.appInsights.getCookieMgr()},t.prototype.trackEvent=function(e,r){this.appInsights.trackEvent(e,r)},t.prototype.trackPageView=function(e){var r=e||{};this.appInsights.trackPageView(r)},t.prototype.trackPageViewPerformance=function(e){var r=e||{};this.appInsights.trackPageViewPerformance(r)},t.prototype.trackException=function(e){e&&!e.exception&&e.error&&(e.exception=e.error),this.appInsights.trackException(e)},t.prototype._onerror=function(e){this.appInsights._onerror(e)},t.prototype.trackTrace=function(e,r){this.appInsights.trackTrace(e,r)},t.prototype.trackMetric=function(e,r){this.appInsights.trackMetric(e,r)},t.prototype.startTrackPage=function(e){this.appInsights.startTrackPage(e)},t.prototype.stopTrackPage=function(e,r,n,i){this.appInsights.stopTrackPage(e,r,n,i)},t.prototype.startTrackEvent=function(e){this.appInsights.startTrackEvent(e)},t.prototype.stopTrackEvent=function(e,r,n){this.appInsights.stopTrackEvent(e,r,n)},t.prototype.addTelemetryInitializer=function(e){return this.appInsights.addTelemetryInitializer(e)},t.prototype.setAuthenticatedUserContext=function(e,r,n){n===void 0&&(n=!1),this.properties.context.user.setAuthenticatedUserContext(e,r,n)},t.prototype.clearAuthenticatedUserContext=function(){this.properties.context.user.clearAuthenticatedUserContext()},t.prototype.trackDependencyData=function(e){this.dependencies.trackDependencyData(e)},t.prototype.flush=function(e){var r=this;e===void 0&&(e=!0),Vo(this.core,function(){return"AISKU.flush"},function(){gt(r.core.getTransmissionControls(),function(n){gt(n,function(i){i.flush(e)})})},null,e)},t.prototype.onunloadFlush=function(e){e===void 0&&(e=!0),gt(this.core.getTransmissionControls(),function(r){gt(r,function(n){n.onunloadFlush?n.onunloadFlush():n.flush(e)})})},t.prototype.loadAppInsights=function(e,r,n){var i=this;e===void 0&&(e=!1);var o=this;function a(s){if(s){var c="";Fe(o._snippetVersion)||(c+=o._snippetVersion),e&&(c+=".lg"),o.context&&o.context.internal&&(o.context.internal.snippetVer=c||"-"),cr(o,function(l,u){pt(l)&&!St(u)&&l&&l[0]!=="_"&&Ah.indexOf(l)===-1&&(s[l]=u)})}}return e&&o.config.extensions&&o.config.extensions.length>0&&Rn("Extensions not allowed in legacy mode"),Vo(o.core,function(){return"AISKU.loadAppInsights"},function(){var s=[];s.push(o._sender),s.push(o.properties),s.push(o.dependencies),s.push(o.appInsights),o.core.initialize(o.config,s,r,n),o.context=o.properties.context,Rh&&o.context&&(o.context.internal.sdkSrc=Rh),a(o.snippet),o.emptyQueue(),o.pollInternalLogs(),o.addHousekeepingBeforeUnload(i)}),o},t.prototype.updateSnippetDefinitions=function(e){_g(e,this,function(r){return r&&Ah.indexOf(r)===-1})},t.prototype.emptyQueue=function(){var e=this;try{if(Yn(e.snippet.queue)){for(var r=e.snippet.queue.length,n=0;n<r;n++){var i=e.snippet.queue[n];i()}e.snippet.queue=void 0,delete e.snippet.queue}}catch(a){var o={};a&&St(a.toString)&&(o.exception=a.toString())}},t.prototype.pollInternalLogs=function(){this.core.pollInternalLogs()},t.prototype.addHousekeepingBeforeUnload=function(e){if(Hc()||Cg()){var r=function(){e.onunloadFlush(!1),gt(e.appInsights.core._extensions,function(i){if(i.identifier===oa)return i&&i.context&&i.context._sessionManager&&i.context._sessionManager.backup(),-1})};if(!e.appInsights.config.disableFlushOnBeforeUnload){var n=lo("beforeunload",r);n=lo("unload",r)||n,n=lo("pagehide",r)||n,n=lo("visibilitychange",r)||n,!n&&!e1()&&e.appInsights.core.logger.throwInternal(Pe.CRITICAL,Re.FailedToAddHandlerForOnBeforeUnload,"Could not add handler for beforeunload and pagehide")}e.appInsights.config.disableFlushOnUnload||(lo("pagehide",r),lo("visibilitychange",r))}},t.prototype.getSender=function(){return this._sender},t.prototype.getSKUDefaults=function(){var e=this;e.config.diagnosticLogInterval=e.config.diagnosticLogInterval&&e.config.diagnosticLogInterval>0?e.config.diagnosticLogInterval:1e4},t}(),function(){var t=null,e=!1,r=["://js.monitor.azure.com/","://az416426.vo.msecnd.net/"];try{var n=(document||{}).currentScript;n&&(t=n.src)}catch(s){}if(t)try{var i=t.toLowerCase();if(i){for(var o="",a=0;a<r.length;a++)if(i.indexOf(r[a])!==-1){o="cdn"+(a+1),i.indexOf("/scripts/")===-1&&(i.indexOf("/next/")!==-1?o+="-next":i.indexOf("/beta/")!==-1&&(o+="-beta")),Rh=o+(e?".mod":"");break}}}catch(s){}}()}),jv,Vv,TE=xe(()=>{lr(),wt(),jv=["snippet","getDefaultConfig","_hasLegacyInitializers","_queue","_processLegacyInitializers"],Vv=function(){function t(e,r){this._hasLegacyInitializers=!1,this._queue=[],this.config=t.getDefaultConfig(e.config),this.appInsightsNew=r,this.context={addTelemetryInitializer:this.addTelemetryInitializers.bind(this)}}return t.getDefaultConfig=function(e){return e||(e={}),e.endpointUrl=e.endpointUrl||"https://dc.services.visualstudio.com/v2/track",e.sessionRenewalMs=30*60*1e3,e.sessionExpirationMs=24*60*60*1e3,e.maxBatchSizeInBytes=e.maxBatchSizeInBytes>0?e.maxBatchSizeInBytes:102400,e.maxBatchInterval=isNaN(e.maxBatchInterval)?15e3:e.maxBatchInterval,e.enableDebug=Mt(e.enableDebug),e.disableExceptionTracking=Mt(e.disableExceptionTracking),e.disableTelemetry=Mt(e.disableTelemetry),e.verboseLogging=Mt(e.verboseLogging),e.emitLineDelimitedJson=Mt(e.emitLineDelimitedJson),e.diagnosticLogInterval=e.diagnosticLogInterval||1e4,e.autoTrackPageVisitTime=Mt(e.autoTrackPageVisitTime),(isNaN(e.samplingPercentage)||e.samplingPercentage<=0||e.samplingPercentage>=100)&&(e.samplingPercentage=100),e.disableAjaxTracking=Mt(e.disableAjaxTracking),e.maxAjaxCallsPerView=isNaN(e.maxAjaxCallsPerView)?500:e.maxAjaxCallsPerView,e.isBeaconApiDisabled=Mt(e.isBeaconApiDisabled,!0),e.disableCorrelationHeaders=Mt(e.disableCorrelationHeaders),e.correlationHeaderExcludedDomains=e.correlationHeaderExcludedDomains||["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],e.disableFlushOnBeforeUnload=Mt(e.disableFlushOnBeforeUnload),e.disableFlushOnUnload=Mt(e.disableFlushOnUnload,e.disableFlushOnBeforeUnload),e.enableSessionStorageBuffer=Mt(e.enableSessionStorageBuffer,!0),e.isRetryDisabled=Mt(e.isRetryDisabled),e.isCookieUseDisabled=Mt(e.isCookieUseDisabled),e.isStorageUseDisabled=Mt(e.isStorageUseDisabled),e.isBrowserLinkTrackingEnabled=Mt(e.isBrowserLinkTrackingEnabled),e.enableCorsCorrelation=Mt(e.enableCorsCorrelation),e},t.prototype.addTelemetryInitializers=function(e){var r=this;this._hasLegacyInitializers||(this.appInsightsNew.addTelemetryInitializer(function(n){r._processLegacyInitializers(n)}),this._hasLegacyInitializers=!0),this._queue.push(e)},t.prototype.getCookieMgr=function(){return this.appInsightsNew.getCookieMgr()},t.prototype.startTrackPage=function(e){this.appInsightsNew.startTrackPage(e)},t.prototype.stopTrackPage=function(e,r,n,i){this.appInsightsNew.stopTrackPage(e,r,n)},t.prototype.trackPageView=function(e,r,n,i,o){var a={name:e,uri:r,properties:n,measurements:i};this.appInsightsNew.trackPageView(a)},t.prototype.trackEvent=function(e,r,n){this.appInsightsNew.trackEvent({name:e})},t.prototype.trackDependency=function(e,r,n,i,o,a,s){this.appInsightsNew.trackDependencyData({id:e,target:n,type:i,duration:o,properties:{HttpMethod:r},success:a,responseCode:s})},t.prototype.trackException=function(e,r,n,i,o){this.appInsightsNew.trackException({exception:e})},t.prototype.trackMetric=function(e,r,n,i,o,a){this.appInsightsNew.trackMetric({name:e,average:r,sampleCount:n,min:i,max:o})},t.prototype.trackTrace=function(e,r,n){this.appInsightsNew.trackTrace({message:e,severityLevel:n})},t.prototype.flush=function(e){this.appInsightsNew.flush(e)},t.prototype.setAuthenticatedUserContext=function(e,r,n){this.appInsightsNew.context.user.setAuthenticatedUserContext(e,r,n)},t.prototype.clearAuthenticatedUserContext=function(){this.appInsightsNew.context.user.clearAuthenticatedUserContext()},t.prototype._onerror=function(e,r,n,i,o){this.appInsightsNew._onerror({message:e,url:r,lineNumber:n,columnNumber:i,error:o})},t.prototype.startTrackEvent=function(e){this.appInsightsNew.startTrackEvent(e)},t.prototype.stopTrackEvent=function(e,r,n){this.appInsightsNew.stopTrackEvent(e,r,n)},t.prototype.downloadAndSetup=function(e){Rn("downloadAndSetup not implemented in web SKU")},t.prototype.updateSnippetDefinitions=function(e){_g(e,this,function(r){return r&&jv.indexOf(r)===-1})},t.prototype.loadAppInsights=function(){var e=this;if(this.config.iKey){var r=this.trackPageView;this.trackPageView=function(o,a,s){r.apply(e,[null,o,a,s])}}var n="logPageView";typeof this.snippet[n]=="function"&&(this[n]=function(o,a,s){e.trackPageView(null,o,a,s)});var i="logEvent";return typeof this.snippet[i]=="function"&&(this[i]=function(o,a,s){e.trackEvent(o,a,s)}),this},t.prototype._processLegacyInitializers=function(e){return e.tags[ea]=this._queue,e},t}()}),Gv,kE=xe(()=>{TE(),zv(),wt(),Gv=function(){function t(){}return t.getAppInsights=function(e,r){var n=new Th(e),i=r!==2;if(Qo(),r===2)return n.updateSnippetDefinitions(e),n.loadAppInsights(i),n;var o=new Vv(e,n);return o.updateSnippetDefinitions(e),n.loadAppInsights(i),o},t}()}),Kv={};kC(Kv,{AppInsightsCore:()=>Pd,ApplicationAnalytics:()=>hh,ApplicationInsights:()=>Th,ApplicationInsightsContainer:()=>Gv,BaseCore:()=>Id,BaseTelemetryPlugin:()=>so,CoreUtils:()=>il,DependenciesPlugin:()=>Eh,DistributedTracingModes:()=>gn,Event:()=>mn,Exception:()=>Mr,LoggingSeverity:()=>Pe,Metric:()=>In,NotificationManager:()=>Dd,PageView:()=>vn,PageViewPerformance:()=>ii,PerfEvent:()=>Go,PerfManager:()=>fd,PropertiesPlugin:()=>yh,RemoteDependencyData:()=>Dn,Sender:()=>vh,SeverityLevel:()=>ps,Telemetry:()=>Wv,Trace:()=>ni,Util:()=>Yd,_InternalMessageId:()=>Re,doPerf:()=>Vo});var IE=xe(()=>{zv(),kE(),wt(),lr(),Ev(),dv(),Ov(),Hv()}),rn;(function(t){t.ON="on",t.ERROR="error",t.OFF="off"})(rn||(rn={}));function kh(){let t="telemetry",e="enableTelemetry";return d.env.isTelemetryEnabled!==void 0?d.env.isTelemetryEnabled?rn.ON:rn.OFF:d.workspace.getConfiguration(t).get(e)?rn.ON:rn.OFF}var DE=class{constructor(t,e,r,n,i){this.extensionId=t,this.extensionVersion=e,this.telemetryAppender=r,this.osShim=n,this.firstParty=!1,this.userOptIn=!1,this.errorOptIn=!1,this.disposables=[],this.firstParty=!!i,this.updateUserOptStatus(),d.env.onDidChangeTelemetryEnabled!==void 0?(this.disposables.push(d.env.onDidChangeTelemetryEnabled(()=>this.updateUserOptStatus())),this.disposables.push(d.workspace.onDidChangeConfiguration(()=>this.updateUserOptStatus()))):this.disposables.push(d.workspace.onDidChangeConfiguration(()=>this.updateUserOptStatus()))}updateUserOptStatus(){let t=kh();this.userOptIn=t===rn.ON,this.errorOptIn=t===rn.ERROR||t===rn.ON,(this.userOptIn||this.errorOptIn)&&this.telemetryAppender.instantiateAppender()}cleanRemoteName(t){if(!t)return"none";let e="other";return["ssh-remote","dev-container","attached-container","wsl"].forEach(r=>{t.indexOf(`${r}+`)===0&&(e=r)}),e}get extension(){return this._extension===void 0&&(this._extension=d.extensions.getExtension(this.extensionId)),this._extension}cloneAndChange(t,e){if(t===null||typeof t!="object"||typeof e!="function")return t;let r={};for(let n in t)r[n]=e(n,t[n]);return r}shouldSendErrorTelemetry(){return this.errorOptIn===!1?!1:this.firstParty?this.cleanRemoteName(d.env.remoteName)!=="other"?!0:!(this.extension===void 0||this.extension.extensionKind===d.ExtensionKind.Workspace||d.env.uiKind===d.UIKind.Web):!0}getCommonProperties(){let t=Object.create(null);if(t["common.os"]=this.osShim.platform,t["common.platformversion"]=(this.osShim.release||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),t["common.extname"]=this.extensionId,t["common.extversion"]=this.extensionVersion,d&&d.env){switch(t["common.vscodemachineid"]=d.env.machineId,t["common.vscodesessionid"]=d.env.sessionId,t["common.vscodeversion"]=d.version,t["common.isnewappinstall"]=d.env.isNewAppInstall?d.env.isNewAppInstall.toString():"false",t["common.product"]=d.env.appHost,d.env.uiKind){case d.UIKind.Web:t["common.uikind"]="web";break;case d.UIKind.Desktop:t["common.uikind"]="desktop";break;default:t["common.uikind"]="unknown"}t["common.remotename"]=this.cleanRemoteName(d.env.remoteName)}return t}anonymizeFilePaths(t,e){let r;if(t==null)return"";let n=[];d.env.appRoot!==""&&n.push(new RegExp(d.env.appRoot.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi")),this.extension&&n.push(new RegExp(this.extension.extensionPath.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"));let i=t;if(e){let o=[];for(let l of n)for(;(r=l.exec(t))&&r;)o.push([r.index,l.lastIndex]);let a=/^[\\/]?(node_modules|node_modules\.asar)[\\/]/,s=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-._]+(\\\\|\\|\/))+[\w-._]*/g,c=0;for(i="";(r=s.exec(t))&&r;)r[0]&&!a.test(r[0])&&o.every(([l,u])=>r.index<l||r.index>=u)&&(i+=t.substring(c,r.index)+"<REDACTED: user-file-path>",c=s.lastIndex);c<t.length&&(i+=t.substr(c))}for(let o of n)i=i.replace(o,"");return i}removePropertiesWithPossibleUserInfo(t){if(typeof t!="object")return;let e=Object.create(null);for(let r of Object.keys(t)){let n=t[r];if(!n)continue;let i=/@[a-zA-Z0-9-.]+/;/\S*(key|token|sig|password|passwd|pwd)[="':\s]+\S*/.test(n.toLowerCase())?e[r]="<REDACTED: secret>":i.test(n)?e[r]="<REDACTED: email>":e[r]=n}return e}sendTelemetryEvent(t,e,r){if(this.userOptIn&&t!==""){e={...e,...this.getCommonProperties()};let n=this.cloneAndChange(e,(i,o)=>this.anonymizeFilePaths(o,this.firstParty));this.telemetryAppender.logEvent(`${this.extensionId}/${t}`,{properties:this.removePropertiesWithPossibleUserInfo(n),measurements:r})}}sendTelemetryErrorEvent(t,e,r,n){if(this.errorOptIn&&t!==""){e={...e,...this.getCommonProperties()};let i=this.cloneAndChange(e,(o,a)=>this.shouldSendErrorTelemetry()?this.anonymizeFilePaths(a,this.firstParty):n===void 0||n.indexOf(o)!==-1?"REDACTED":this.anonymizeFilePaths(a,this.firstParty));this.telemetryAppender.logEvent(`${this.extensionId}/${t}`,{properties:this.removePropertiesWithPossibleUserInfo(i),measurements:r})}}sendTelemetryException(t,e,r){if(this.shouldSendErrorTelemetry()&&this.errorOptIn&&t){e={...e,...this.getCommonProperties()};let n=this.cloneAndChange(e,(i,o)=>this.anonymizeFilePaths(o,this.firstParty));t.stack&&(t.stack=this.anonymizeFilePaths(t.stack,this.firstParty)),this.telemetryAppender.logException(t,{properties:this.removePropertiesWithPossibleUserInfo(n),measurements:r})}}dispose(){return this.telemetryAppender.flush(),Promise.all(this.disposables.map(t=>t.dispose()))}},PE=class{constructor(t){this._key=t,this._isInstantiated=!1,kh()!==rn.OFF&&this.instantiateAppender()}logEvent(t,e){!this._aiClient||this._aiClient.trackEvent({name:t},{...e.properties,...e.measurements})}logException(t,e){!this._aiClient||this._aiClient.trackException({exception:t,properties:{...e.properties,...e.measurements}})}flush(){return this._aiClient&&(this._aiClient.flush(),this._aiClient=void 0),Promise.resolve(void 0)}instantiateAppender(){this._isInstantiated||Promise.resolve().then(()=>(IE(),Kv)).then(t=>{let e;this._key&&this._key.indexOf("AIF-")===0&&(e="https://vortex.data.microsoft.com/collect/v1"),this._aiClient=new t.ApplicationInsights({config:{instrumentationKey:this._key,endpointUrl:e,disableAjaxTracking:!0,disableExceptionTracking:!0,disableFetchTracking:!0,disableCorrelationHeaders:!0,disableCookiesUsage:!0,autoTrackPageVisitTime:!1,emitLineDelimitedJson:!0,disableInstrumentationKeyValidation:!0}}),this._aiClient.loadAppInsights();let r=kh();e&&(r===rn.ON||r===rn.ERROR)&&fetch(e).catch(()=>this._aiClient=void 0),this._isInstantiated=!0})}},FE=class extends DE{constructor(t,e,r,n){let i=new PE(r);r&&r.indexOf("AIF-")===0&&(n=!0);super(t,e,i,{release:navigator.appVersion,platform:"web"},n)}};/*!
 * Microsoft Dynamic Proto Utility, 1.1.4
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */const Ih=class{constructor(t){this.sharedProperties={},Ih._instance=this,this.reporter=new FE(t.extension.id,t.extension.packageJSON.version,Ih.aiKey,!0)}static get instance(){return this._instance}dispose(){this.reporter.dispose()}sendEvent(t,e,r){this.reporter.sendTelemetryEvent(t,{...this.sharedProperties,...e},r)}sendErrorEvent(t,e,r){this.reporter.sendTelemetryErrorEvent(t,{...this.sharedProperties,...e},r)}sendException(t,e,r){this.reporter.sendTelemetryException(t,{...this.sharedProperties,...e},r)}setSharedProperty(t,e){this.sharedProperties[t]=e}};let _s=Ih;_s.aiKey="AIF-d9b70cd4-b9f9-4d70-929b-a071c400b217";const El=(0,C.loadMessageBundle)();let si;var Dh;(function(t){function e(r){const n=ME(r);return si=d.env.uiKind===d.UIKind.Web,Z.warn(`Running on the ${si?"web":"desktop"}${r.extensionRuntime!==d.ExtensionRuntime.Node?" in a webworker":""}; workspaceId=${n}; storageUri=${r.globalStorageUri.toString(!0)}`),n}t.configure=e})(Dh||(Dh={}));function NE(){var t,e;return(e=(t=d.workspace.workspaceFolders)==null?void 0:t.every(r=>r.uri.scheme===Pt.scheme))!=null?e:!1}var Tt;(function(t){t.CurrentWindow="currentWindow",t.NewWindow="newWindow",t.AddToWorkspace="addToWorkspace"})(Tt||(Tt={}));const $E=/\/workspaceStorage\/(?<id>[^/]+)/i;function ME(t){var e;if(t.storageUri===void 0)return"";const r=$E.exec(t.storageUri.path);let n;if((e=r==null?void 0:r.groups)==null?void 0:e.id)n=r.groups.id;else{n=t.storageUri.path;const i=WS(t.globalStorageUri.path,n),o=`/${t.extension.id}`;n.endsWith(o)?n=n.slice(i,-o.length):n=n.substr(i)}return/-[0-9]$/.test(n)?n.slice(0,-2):n}async function nn(t,e){var r,n,i,o,a;if(_s.instance.sendEvent("openWorkspace",{location:t.location}),t.location===Tt.AddToWorkspace){const c=(n=(r=d.workspace.workspaceFolders)==null?void 0:r.length)!=null?n:0;return void d.workspace.updateWorkspaceFolders(c,0,{uri:t.uri,name:t.name})}if(t.location===Tt.CurrentWindow&&!(e==null?void 0:e.skipChangesPrompt)){const c=await Ka.instance.getWorkspaceProvidersWithChanges();if(c.length){const l={title:El("continue","Continue")},u={title:El("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showWarningMessage(si?El("open folder uncommitted changes web",`You have uncommitted changes.

If you want to see your changes on {0} or from other browsers or machines, commit them before leaving this workspace. Otherwise, you can re-open this workspace anytime and pick up right where you left off.

Do you want to continue opening a new workspace?`,c.map(h=>h.name).join(", ")):El("open folder uncommitted changes",`You have uncommitted changes.

If you want to see your changes on {0} or from other machines, commit them before leaving this workspace. Otherwise, you can re-open this workspace anytime and pick up right where you left off.

Do you want to continue opening a new workspace?`,c.map(h=>h.name).join(", ")),{modal:!0,useCustom:!0},l,u)!==l){_s.instance.sendEvent("openWorkspace.abort",{reason:"abandoned uncommitted changes prompt"});return}}}const s=d.env.remoteName?!0:void 0;return t.filesToOpen&&(t.location===Tt.CurrentWindow&&s===void 0&&((i=d.workspace.workspaceFolders)==null?void 0:i.length)===1&&d.workspace.workspaceFolders[0].uri.toString()===t.uri.toString()?await((o=pu())==null?void 0:o.openPendingFiles(t.uri,t.filesToOpen)):await((a=pu())==null?void 0:a.setPendingFilesToOpen(t.uri,t.filesToOpen))),_s.instance.sendEvent("openWorkspace.success",{location:t.location,forceLocalWindow:String(s)}),void d.commands.executeCommand("vscode.openFolder",t.uri,{forceNewWindow:t.location===Tt.NewWindow,forceLocalWindow:s})}var ci;(function(t){t.HasVirtualFolders="remoteHub:hasVirtualFolders",t.HasSearchIndexes="remoteHub:hasSearchIndexes",t.EnabledSomeSearchIndexes="remoteHub:enabledSomeSearchIndexes",t.EnabledAllSearchIndexes="remoteHub:enabledAllSearchIndexes",t.VirtualFolderProviders="remoteHub:virtualFolderProviders",t.HasPullRequestExtension="remoteHub:hasPullRequestExtension",t.HasWriteableScmProvider="remoteHub:hasWriteableScmProvider"})(ci||(ci={}));const Zv=new Map;function ua(t){return t==="isWeb"?si:t==="remoteName"?d.env.remoteName:t==="virtualWorkspace"?NE():t.startsWith("config.")?Je.getAny(t.substr(7)):Zv.get(t)}function da(t){return t==="isWeb"||t==="remoteName"||t==="virtualWorkspace"||t.startsWith("config.")||t.startsWith("remoteHub:")||t.startsWith("continueOn:")}async function Di(t,e){Zv.set(t,e),!t.startsWith("continueOn:")&&await d.commands.executeCommand("setContext",t,e)}class BE{constructor(e){this.menuItem=e}get label(){return`${this.menuItem.icon?`${this.menuItem.icon} `:""}${this.menuItem.title}`}get description(){return this.menuItem.extension.builtin?"Built-in":this.menuItem.extension.name||this.menuItem.extension.id}async execute(e){return void await d.commands.executeCommand(this.menuItem.command,e)}}var Ph;(function(t){async function e(r,n,i){const o=OE(r).map(c=>new BE(c)),a=d.window.createQuickPick(),s=[];try{return await new Promise(l=>{s.push(a.onDidHide(()=>l(void 0)),a.onDidAccept(()=>{if(a.activeItems.length!==0){const[u]=a.activeItems;l(u)}})),a.title=i,a.placeholder=n,a.items=o,a.show()})}finally{a.dispose(),s.forEach(c=>void c.dispose())}}t.show=e})(Ph||(Ph={}));function OE(t){var e,r,n,i,o;const a=new Map,[,s]=t.split(".");for(const l of d.extensions.all){const{name:u,displayName:f,contributes:h}=l.packageJSON;if(!h)continue;const p=(r=(e=h.virtualWorkspaces)==null?void 0:e.menus)==null?void 0:r.continueOn;if(p==null?void 0:p.length){const b=new Map(((n=h.commands)!=null?n:[]).map(y=>[y.command,y]));for(const y of p){if(!y.command)continue;if(a.has(y.command)){Z.warn(`Duplicate 'continueOn' menu command: ${y.command}`);continue}const w=b.get(y.command);if(!w){Z.warn(`Unable to find 'continueOn' menu command: ${y.command}`);continue}if(!UE(y.when))continue;const _=(o=(i=y.group)==null?void 0:i.lastIndexOf("@"))!=null?o:-1;a.set(y.command,{extension:{id:u,name:f,builtin:u===s},command:w.command,title:w.title,icon:typeof w.icon=="string"?w.icon:void 0,group:_>0?y.group.substr(0,_):y.group,order:_>0?Number(y.group.substr(_+1)):0,category:w.category})}}}function c(l,u){const f=l.group,h=u.group;if(f!==h){if(!f)return 1;if(!h||f==="navigation")return-1;if(h==="navigation")return 1;const p=f.localeCompare(h);if(p!==0)return p}return l.order<u.order?-1:l.order>u.order?1:l.title.localeCompare(u.title)}return[...a.values()].sort(c)}function UE(t){return t?t.split("&&").every(e=>{const r=/^(?:(!)?(\S+)|(\S+)\s?(==|!=|=~)\s?(\S+))$/.exec(e.trim());if(!r)return!0;const[,n,i,o,a,s]=r;if(i){if(i==="false")return!1;if(!da(i))return!0;const c=ua(i);return n?!c:c}if(o&&a&&s)switch(a){case"==":return!da(o)||!da(s)||ua(o)==ua(s);case"!=":return!da(o)||!da(s)||ua(o)!=ua(s);case"=~":{if(!da(o))return!0;const c=ua(o);try{return new RegExp(s.slice(1,-1)).test(String(c!=null?c:""))}catch{return!1}}}return!0}):!0}class Fh{constructor(e){this.defaultDelay=e}dispose(){this.cancelTimeout()}debounce(e,r=this.defaultDelay){return this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((n,i)=>{this.resolver=n,this.rejecter=i}).then(()=>{if(this.completionPromise=void 0,this.resolver=void 0,this.task){const n=this.task;return this.task=void 0,n()}})),this.timeout=setTimeout(()=>{var n;this.timeout=void 0,(n=this.resolver)==null||n.call(this,void 0)},r),this.completionPromise}cancel(){var e;this.cancelTimeout(),this.completionPromise&&((e=this.rejecter)==null||e.call(this,new Error("Canceled")),this.completionPromise=void 0)}cancelTimeout(){this.timeout!==void 0&&(clearTimeout(this.timeout),this.timeout=void 0)}}const Pi=(0,C.loadMessageBundle)(),Nh=Symbol("QuickPickGoBack");var $h;(function(t){async function e(r,n,i,o,a,s){const c=r.getRemoteWorkspaceSourceProviders();let l=[];c.length===0?l=[]:l=c.map(y=>new Xv(y));const u=await n.getRemoteWorkspaceSourceProvider("github");if(u){const y=await u.provideSources();l.push(...y.map(w=>({label:`${w.icon?`${w.icon} `:""}${w.name}`,description:w.description,detail:w.detail,url:w.url,workspace:w.url?void 0:w.workspace,buttons:[wn.OpenInNewWindow]})))}let f=await d.env.clipboard.readText();r.canOpenRemoteUrl(f)||(f="");const h=d.window.createQuickPick(),p=[];let b=i;try{for(;;){const y=await new Promise(w=>{p.push(h.onDidHide(()=>w(void 0)),h.onDidChangeValue(_=>{_=_.trim(),_.length===0?(h.ignoreFocusOut=!1,h.items=l):(h.ignoreFocusOut=!0,h.activeItems.length===0||h.activeItems[0]instanceof xs?h.items=[new xs(r,_),...l]:h.items=l)}),h.onDidAccept(()=>{if(h.activeItems.length!==0){const[_]=h.activeItems;(!(_ instanceof xs)||_.validate())&&w(_)}}),h.onDidChangeActive(()=>{if(b!==void 0||!(s==null?void 0:s.allowAddToWorkspace))return;const[_]=h.activeItems;let S=!0;if(_===void 0?S=Boolean(h.value):S=_ instanceof xs,S){if(h.buttons.length===1)return;h.buttons=[wn.AddToWorkspace]}else{if(h.buttons.length===0)return;h.buttons=[]}}),h.onDidTriggerButton(_=>{if(_===wn.AddToWorkspace){const[S]=h.activeItems;if(!(S instanceof xs))return;S.validate()&&(b=Tt.AddToWorkspace,w(S))}}),h.onDidTriggerItemButton(_=>{switch(_.button){case wn.OpenInNewWindow:b=Tt.NewWindow,w(_.item);break;default:break}})),h.title=a,h.placeholder=o,h.matchOnDescription=!0,h.items=l,h.sortByLabel=!1,h.value=f,h.show(),f&&h._onDidChangeValueEmitter.fire(h.value)});if(y instanceof Xv){const w=await y.show(b,y.placeholder,a,s);if(w===Nh)continue;return w}return[y,b]}}finally{h.dispose(),p.forEach(y=>void y.dispose())}}t.show=e})($h||($h={}));class Xv{constructor(e){this.provider=e}get label(){return`${this.provider.icon?`${this.provider.icon} `:""}${this.provider.label}`}get placeholder(){return this.provider.placeholder}async show(e,r,n,i){const o=d.window.createQuickPick(),a=new Fh(500),s=[a];async function c(b,y,w){return(await b.provideSources(y,w)).map(S=>({label:`${S.icon?`${S.icon} `:""}${S.name}`,description:S.description,detail:S.detail,url:S.url,workspace:S.workspace,buttons:[wn.OpenInNewWindow]}))}const l=c(this.provider,void 0,{sort:"updated"});let u=e,f,h=!1;async function p(b){f=void 0;const y=o.activeItems;o.items=b!=null?b:await l,h&&y.length!==0&&(o.activeItems=o.items.filter(w=>y.some(_=>_.url===w.url))),o.busy=!1}try{const b=await new Promise(y=>{s.push(o.onDidHide(()=>y(void 0)),o.onDidChangeValue(w=>{h=!1,w=w.trim(),o.busy=!0;const _=a.debounce(w?()=>c(this.provider,w,{sort:"stars"}):()=>l);f===void 0&&(f=_.then(async S=>p(S)))}),o.onDidAccept(()=>{if(o.activeItems.length!==0){const[w]=o.activeItems;y(w)}}),o.onDidChangeActive(()=>{if(h=o.activeItems.length!==0,u!==void 0||!(i==null?void 0:i.allowAddToWorkspace))return;const[w]=o.activeItems;if(w===void 0){if(o.buttons.length===1)return;o.buttons=[d.QuickInputButtons.Back]}else{if(o.buttons.length===2)return;o.buttons=[d.QuickInputButtons.Back,wn.AddToWorkspace]}}),o.onDidTriggerButton(w=>{if(w===d.QuickInputButtons.Back){y(Nh);return}if(w===wn.AddToWorkspace){const[_]=o.activeItems;if(_===void 0)return;u=Tt.AddToWorkspace,y(_)}}),o.onDidTriggerItemButton(w=>{switch(w.button){case wn.OpenInNewWindow:u=Tt.NewWindow,y(w.item);break;default:break}})),o.title=n,o.placeholder=r,o.matchOnDetail=!0,o.ignoreFocusOut=!0,o.sortByLabel=!1,o.buttons=[d.QuickInputButtons.Back],o.busy=!0,o.show(),f=a.debounce(async()=>l,0).then(w=>p(w))});return b===Nh?b:[b,u]}finally{o.dispose(),s.forEach(b=>void b.dispose())}}}class xs{constructor(e,r){this.url=r,this.alwaysShow=!0,this.canOpenResult=e.canOpenRemoteUrl(r,"github")}get buttons(){return[wn.OpenInNewWindow]}get label(){if(this.canOpenResult){const{provider:e,urlType:r}=this.canOpenResult;switch(r){case Vr.Branch:return Pi("remote url picker open branch","Open Branch from {0} Repository",e.name);case Vr.Commit:return Pi("remote url picker open commit","Open Commit from {0} Repository",e.name);case Vr.File:return Pi("remote url picker open file","Open File from {0} Repository",e.name);case Vr.PullRequest:return Pi("remote url picker open pull request","Open Pull Request from {0} Repository",e.name);default:return Pi("remote url picker open repository","Open {0} Repository",e.name)}}return Pi("remote url picker open unknown","Enter a Remote Url")}get description(){return this.url}validate(){return this.canOpenResult!==void 0}}var wn;(function(t){t.AddToWorkspace={iconPath:new d.ThemeIcon("plus"),tooltip:Pi("remote url picker button add to workspace","Add to Workspace")},t.OpenInNewWindow={iconPath:new d.ThemeIcon("empty-window"),tooltip:Pi("remote picker open in new window","Open in New Window")}})(wn||(wn={}));var LE=Object.defineProperty,HE=Object.getOwnPropertyDescriptor,li=(t,e,r,n)=>{for(var i=n>1?void 0:n?HE(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&LE(e,r,i),i};const Jt=(0,C.loadMessageBundle)();class Fn{showGitHubStatus500Message(){return d.window.showErrorMessage(Jt("github 500 error notification","GitHub failed to respond and might be experiencing issues. Visit the [GitHub status page](https://githubstatus.com) for more information."),Jt("ok","OK")),Promise.resolve()}async showStatus401Message(e){if(!e)return void d.window.showErrorMessage(Jt("401 error notification","The provided credentials are either invalid or expired."),Jt("ok","OK"));const r=Jt("401 error notification confirm","Reauthenticate");await d.window.showErrorMessage(Jt("401 error notification with reauth","The provided credentials are either invalid or expired. Would you like to reauthenticate?"),r)===r&&e()}async showStatus403Message(e){if(!e)return void d.window.showErrorMessage(Jt("403 error notification","The provided credentials do not have the required access."),Jt("ok","OK"));const r=Jt("403 error notification confirm","Reauthenticate");await d.window.showErrorMessage(Jt("403 error notification with reauth","The provided credentials do not have the required access. Would you like to reauthenticate to grant additional access?"),r)===r&&e()}async showRepositoryEmptyMessage(e){const r=Jt("repository empty open","Open Repository");await d.window.showErrorMessage(Jt("repository empty","Repository '{0}' is empty and cannot be opened. Would you like to open another repository?",e),r)===r&&d.commands.executeCommand("remoteHub.openRepository")}async showPullRequestNotFoundMessage(e,r){const n=Jt("pull request not found open","Open Pull Request");await d.window.showErrorMessage(Jt("pull request not found","Unable to find pull request {1} on repository '{0}'. Would you like to open another pull request?",e,r),n)===n&&d.commands.executeCommand("remoteHub.openRepository")}async showPullRequestHeadNotFoundMessage(e,r){const n=Jt("pull request head not found ok","OK");await d.window.showWarningMessage(Jt("pull request head not found","Unable to find the source branch for pull request {1} on repository '{0}'.",e,r),n)}async showRepositoryForbiddenMessage(e){const r=Jt("repository forbidden open","Open Repository");await d.window.showErrorMessage(Jt("repository forbidden","You don't have access to repository '{0}'. Would you like to open another repository?",e),r)===r&&d.commands.executeCommand("remoteHub.openRepository")}async showRepositoryNotFoundMessage(e){const r=Jt("repository not found confirm","Open Repository");await d.window.showErrorMessage(Jt("repository not found","Unable to find repository '{0}'. Would you like to open another repository?",e),r)===r&&d.commands.executeCommand("remoteHub.openRepository")}async showUnableToOpenRepositoryMessage(e){const r=Jt("unable to open repo confirm","Open Repository");await d.window.showErrorMessage(Jt("unable to open repo","Unable to open repository. {0}. Would you like to open another repository?",String(e)),r)===r&&d.commands.executeCommand("remoteHub.openRepository")}}li([vr(()=>"")],Fn.prototype,"showGitHubStatus500Message",1),li([vr(()=>"")],Fn.prototype,"showStatus401Message",1),li([vr(()=>"")],Fn.prototype,"showStatus403Message",1),li([vr()],Fn.prototype,"showRepositoryEmptyMessage",1),li([vr()],Fn.prototype,"showPullRequestNotFoundMessage",1),li([vr()],Fn.prototype,"showPullRequestHeadNotFoundMessage",1),li([vr()],Fn.prototype,"showRepositoryForbiddenMessage",1),li([vr()],Fn.prototype,"showRepositoryNotFoundMessage",1),li([vr()],Fn.prototype,"showUnableToOpenRepositoryMessage",1);const Tr=new Fn,yr=(0,C.loadMessageBundle)();function qE(t,e,r,n,i){async function o(s){const[c,l]=await $h.show(t,r,s,yr("open repo placeholder","Enter a remote url, or select a remote provider"),s===Tt.AddToWorkspace?yr("open repo title add to workspace","Add Remote Repository to Workspace"):yr("open repo title current window","Open Remote Repository"),{allowAddToWorkspace:!1});if(!c){i.sendEvent("openRepository.abort",{reason:"abandoned"});return}try{let u;if(c.workspace)u=c.workspace,u.location=l!=null?l:u.location;else if(u=await t.createWorkspaceForRemoteUrl(c.url,void 0,l!=null?l:s),!u){i.sendEvent("openRepository.abort",{reason:"aborted invalid url"});return}await nn(u)}catch(u){if(i.sendException(u),u instanceof _n){const{reauthenticate:f}=u;Tr.showStatus401Message(()=>f());return}if(u instanceof Ua){Tr.showRepositoryNotFoundMessage(u.name);return}if(u instanceof Oa){Tr.showRepositoryForbiddenMessage(u.name);return}if(u instanceof mc){Tr.showRepositoryEmptyMessage(u.name);return}if(u instanceof gc){Tr.showPullRequestNotFoundMessage(u.name,u.id);return}Z.error(u)}}async function a(s,c,l){if(l==null?void 0:l.workspaceFolder){const f=t.getRepository(l.workspaceFolder,c);if(f!==void 0)return f}const u=c?t.repositories.filter(f=>f.provider.id===c):t.repositories;if(u.length!==0){if(u.length>1){const f=await d.window.showQuickPick(u.map(h=>({label:h.name,description:h.provider.name,repository:h})),{placeHolder:s});return f?f.repository:void 0}return u[0]}}return[d.commands.registerCommand("remoteHub.openRepository",()=>(i.sendEvent("command.openRepository"),o())),d.commands.registerCommand("remoteHub.continueOn.openRepository",()=>(i.sendEvent("command.continueOn.openRepository"),o())),d.commands.registerCommand("remoteHub.addRepositoryToWorkspace",()=>{i.sendEvent("command.continueOn.openRepository")}),d.commands.registerCommand("remoteHub.continueOn.addRepositoryToWorkspace",()=>{i.sendEvent("command.continueOn.openRepository")}),d.commands.registerCommand("remoteHub.continueOn",async()=>{const s=await a(yr("continue on choose repository placeholder","Choose which repository to continue working on elsewhere"));if(s===void 0)return;i.sendEvent("command.continueOn");const c=await Ph.show(n,yr("continue on placeholder","Choose how you would like to continue working"),yr("continue on title","Continue '{0}' on",s.name));if(!c){i.sendEvent("command.continueOn.abort",{reason:"abandoned"});return}if(await e.hasChanges(s.uri)){const f={title:yr("continue","Continue")},h={title:yr("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showWarningMessage(yr("continue on uncommitted changes",`You have uncommitted changes.

Unless you commit those changes, you won't be able see them from elsewhere.`),{modal:!0,useCustom:!0},f,h)!==f){i.sendEvent("command.continueOn.abort",{reason:"abandoned uncommitted changes prompt"});return}}const l=t.getRemoteUri(s.provider.id,{repo:s.id}),{HEAD:u}=await s.getMetadata();await c.execute({provider:s.provider,workspaceFolder:s.uri,name:s.name,url:l==null?void 0:l.toString(!0),ref:u.name})}),d.commands.registerCommand("remoteHub.openOnDesktop",async s=>{if(!si)return;const c=await a(yr("continue on desktop choose repository placeholder","Choose which repository to open on the desktop"),void 0,s);if(c===void 0)return;const l=await t.getBestRemoteUri(c.uri);l!==void 0&&(i.sendEvent("command.openOnDesktop"),d.env.openExternal(d.Uri.parse(`${d.env.uriScheme}://${n}/open?url=${encodeURIComponent(l.toString(!0))}`)))}),d.commands.registerCommand("remoteHub.openOnWeb",async s=>{if(si)return;const c=await a(yr("continue on web choose repository placeholder","Choose which repository to open on the web"),void 0,s);if(c===void 0)return;const l=await t.getBestRemoteUri(c.uri);l!==void 0&&(i.sendEvent("command.openOnWeb"),d.env.openExternal(l))}),d.commands.registerCommand("remoteHub.goToRepository",async()=>{i.sendEvent("command.goToRepository");const s=await a(yr("open on remote choose repository placeholder","Choose which repository to open on the remote"));if(!s)return;const c={provider:s.provider,repo:s.id};return d.commands.executeCommand("remoteHub.openOnRemote",c)}),d.commands.registerCommand("remoteHub.openOnRemote",async s=>{i.sendEvent("command.openOnRemote");const{provider:c,...l}=s,u=t.getRemoteUri(c.id,l);if(u){await d.env.openExternal(u);return}d.window.showErrorMessage(yr("open on remote command provider not supported","Unable to open the resource on {0}",s.provider.name))}),d.commands.registerCommand("remoteHub.clone",async s=>{const c=await a(yr("clone placeholder","Choose which repository to clone"),void 0,s);if(c!==void 0){if(i.sendEvent("command.clone"),s===void 0&&await e.hasChanges(c.uri)){const l={title:yr("continue","Continue")},u={title:yr("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showWarningMessage(yr("clone uncommitted changes",`You have uncommitted changes.

Unless you commit those changes, you won't be able see them in your local clone.`),{modal:!0,useCustom:!0},l,u)!==l){i.sendEvent("command.clone.abort",{reason:"abandoned uncommitted changes prompt"});return}}await t.clone(c.uri)}}),d.commands.registerCommand("remoteHub.refresh",()=>void t.refresh()),d.commands.registerCommand("remoteHub.enableDebugLogging",()=>Je.updateEffective("logLevel",Rt.Debug)),d.commands.registerCommand("remoteHub.disableDebugLogging",()=>Je.updateEffective("logLevel",Rt.Warn)),d.commands.registerCommand("remoteHub.exportDebugInfo",async()=>{await r.exportDebugInfo(),await e.exportDebugInfo()}),d.commands.registerCommand("remoteHub.setContext",async(s,c)=>{if(!s.startsWith("continueOn:"))throw new Error("Key must start with 'continueOn:'");await Di(s,c)})]}function yn(t){return t}async function Mh(t,e){return d.commands.executeCommand(t,e)}class WE{constructor(){this._timeout=0,this._disposable=Je.onDidChange(this.onConfigurationChanged,this),this.maybeQueueFetch()}dispose(){this._disposable.dispose(),this._timeout&&clearTimeout(this._timeout)}get config(){var e;if(this._config===void 0){const r=Je.get("autoFetch");this._config={enabled:(e=r.enabled)!=null?e:!0,interval:r.interval*1e3}}return this._config}onConfigurationChanged(e){!Je.changed(e,"autoFetch")||(this._config=void 0,this.maybeQueueFetch())}async fetchAll(){try{await Mh("remoteHub.fetchAll",{automated:!0})}catch(e){Z.error(e,"Autofetch failed")}this.maybeQueueFetch()}maybeQueueFetch(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),!!this.config.enabled&&(this._timeout=setTimeout(()=>this.fetchAll(),this.config.interval))}}var zE=__webpack_require__(8764),Rl,jE=new Uint8Array(16);function VE(){if(!Rl&&(Rl=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Rl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Rl(jE)}const GE=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function KE(t){return typeof t=="string"&&GE.test(t)}const ZE=KE;for(var br=[],Bh=0;Bh<256;++Bh)br.push((Bh+256).toString(16).substr(1));function XE(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(br[t[e+0]]+br[t[e+1]]+br[t[e+2]]+br[t[e+3]]+"-"+br[t[e+4]]+br[t[e+5]]+"-"+br[t[e+6]]+br[t[e+7]]+"-"+br[t[e+8]]+br[t[e+9]]+"-"+br[t[e+10]]+br[t[e+11]]+br[t[e+12]]+br[t[e+13]]+br[t[e+14]]+br[t[e+15]]).toLowerCase();if(!ZE(r))throw TypeError("Stringified UUID is invalid");return r}const QE=XE;function YE(t,e,r){t=t||{};var n=t.random||(t.rng||VE)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return QE(n)}const JE=YE,on=globalThis.fetch;var eR="/";const tR=C.loadMessageBundle(__webpack_require__(6470).join(eR,"azure-devops/azdoAuthHelper.ts")),rR="https://app.vssps.visualstudio.com/oauth2",Qv="https://prod.richnav.vsengsaas.visualstudio.com/api/v0.1/azDOAuth",nR="1BACBD12-21C6-46ED-899C-1FC50517FBAA",Al=["vso.code"];function iR(t){return(t.query.includes("&")?t.query:decodeURIComponent(t.query)).split("&").reduce((r,n)=>{const i=n.split("=");return r[i[0]]=i[1],r},{})}const Fi=new d.EventEmitter,Yv=new d.EventEmitter,Tl="Network failure",Ss="AzDO";class oR{constructor(e){this._tokens=[],this._refreshTimeouts=new Map,this._disposables=[],this._pendingStates=new Map,this._codeExchangePromises=new Map,this.secretStorage=e.secrets,this.extensionId=e.extension.id}async initialize(){const e=await this.secretStorage.get(Ss);if(e)try{const n=this.parseStoredData(e).map(async i=>{var o;if(!i.refreshToken)return Promise.resolve();try{await this.refreshToken(i.refreshToken,i.scope,i.id)}catch(a){a.message===Tl?await this.handleRefreshNetworkError(i.id,i.refreshToken,i.scope)||(this._tokens.push({accessToken:void 0,refreshToken:i.refreshToken,account:{label:(o=i.account.label)!=null?o:i.account.displayName,id:i.account.id},scope:i.scope,sessionId:i.id}),this.pollForReconnect(i.id,i.refreshToken,i.scope)):await this.removeSession(i.id)}});await Promise.all(n)}catch(r){Z.log("Failed to initialize stored data"),await this.clearSessions()}this._disposables.push(this.secretStorage.onDidChange(()=>this.checkForUpdates))}parseStoredData(e){return JSON.parse(e)}async storeTokenData(){const e=this._tokens.map(r=>({id:r.sessionId,refreshToken:r.refreshToken,scope:r.scope,account:r.account}));await this.secretStorage.store(Ss,JSON.stringify(e))}async checkForUpdates(){const e=[];let r=[];const n=await this.secretStorage.get(Ss);if(n)try{const i=this.parseStoredData(n);let o=i.map(async a=>{if(!this._tokens.some(c=>c.scope===a.scope&&c.sessionId===a.id)&&a.refreshToken)try{const c=await this.refreshToken(a.refreshToken,a.scope,a.id);e.push(this.convertToSessionSync(c))}catch(c){c.message===Tl||await this.removeSession(a.id)}});o=o.concat(this._tokens.map(async a=>{i.some(c=>a.scope===c.scope&&a.sessionId===c.id)||(await this.removeSession(a.sessionId),r.push(this.convertToSessionSync(a)))})),await Promise.all(o)}catch(i){Z.error(i),r=this._tokens.map(this.convertToSessionSync),this.clearSessions()}else this._tokens.length&&(r=this._tokens.map(this.convertToSessionSync),Z.log("No stored keychain data, clearing local data"),this._tokens=[],this._refreshTimeouts.forEach(i=>{clearTimeout(i)}),this._refreshTimeouts.clear());(e.length||r.length)&&Fi.fire({added:e,removed:r,changed:[]})}convertToSessionSync(e){return{id:e.sessionId,accessToken:e.accessToken,account:e.account,scopes:e.scope.split(" ")}}async convertToSession(e){const r=await this.resolveAccessToken(e);return{id:e.sessionId,accessToken:r,account:e.account,scopes:e.scope.split(" ")}}async resolveAccessToken(e){if(e.accessToken&&(!e.expiresAt||e.expiresAt>Date.now()))return e.expiresAt?Z.log(`Token available from cache, expires in ${e.expiresAt-Date.now()} milliseconds`):Z.log("Token available from cache"),Promise.resolve(e.accessToken);try{Z.log("Token expired or unavailable, trying refresh");const r=await this.refreshToken(e.refreshToken,e.scope,e.sessionId);if(r.accessToken)return r.accessToken;throw new Error("No access token returned.")}catch(r){throw new Error("Unavailable due to network problems")}}getTokenClaims(e){try{return JSON.parse(zE.Buffer.from(e.split(".")[1],"base64").toString())}catch(r){throw Z.error(r),new Error("Unable to read token claims")}}get sessions(){return Promise.all(this._tokens.map(e=>this.convertToSession(e)))}async getSessions(e){if(!e)return this.sessions;const r=e.sort().join(" "),n=this._tokens.filter(i=>i.scope===r);return Promise.all(n.map(i=>this.convertToSession(i)))}createSession(e){return Z.log("Logging in..."),this.loginWithoutLocalServer(e)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}async loginWithoutLocalServer(e){var r;const i=(await d.env.asExternalUri(d.Uri.parse(`${d.env.uriScheme}://${this.extensionId}/login`))).toString(),o=d.Uri.parse(`${rR}/authorize?client_id=${nR}&response_type=Assertion&state=${encodeURIComponent(i)}&scope=${encodeURIComponent(Al.join(" "))}&redirect_uri=${encodeURIComponent(Qv)}`),a=new Promise((l,u)=>{const f=setTimeout(()=>{clearTimeout(f),u("Login timed out.")},1e3*60*5)}),s=(r=this._pendingStates.get(e))!=null?r:[];this._pendingStates.set(e,[...s,i]);let c=this._codeExchangePromises.get(e);return c||(c=this.handleCodeResponse(e),this._codeExchangePromises.set(e,c)),d.env.openExternal(o),Promise.race([c,a]).finally(()=>{this._pendingStates.delete(e),this._codeExchangePromises.delete(e)})}async handleCodeResponse(e){let r;return new Promise((n,i)=>{r=Yv.event(async o=>{try{Z.log(`Received Uri: ${o.toString()}`);const a=iR(o);if(!a.accessInfo)throw new Error(`No access info found in query: ${JSON.stringify(a)}`);const s=JSON.parse(a.accessInfo),c=await this.getTokenFromResponse(s,e);this.setToken(c,e);const l=await this.convertToSession(c);n(l)}catch(a){Z.error(a),i(a)}})}).then(n=>(r.dispose(),n)).catch(n=>{throw r.dispose(),n})}setToken(e,r){const n=this._tokens.findIndex(i=>i.sessionId===e.sessionId);return n>-1?this._tokens.splice(n,1,e):this._tokens.push(e),this.clearSessionTimeout(e.sessionId),e.expiresIn&&this._refreshTimeouts.set(e.sessionId,setTimeout(async()=>{try{const i=await this.refreshToken(e.refreshToken,r,e.sessionId);Fi.fire({added:[],removed:[],changed:[this.convertToSessionSync(i)]})}catch(i){i.message===Tl?await this.handleRefreshNetworkError(e.sessionId,e.refreshToken,r)||this.pollForReconnect(e.sessionId,e.refreshToken,e.scope):(await this.removeSession(e.sessionId),Fi.fire({added:[],removed:[this.convertToSessionSync(e)],changed:[]}))}},1e3*(e.expiresIn-30))),this.storeTokenData()}async getTokenFromResponse(e,r,n){var i;const o=this.getTokenClaims(e.accessToken),a=await on("https://app.vssps.visualstudio.com/_apis/profile/profiles/me?api-version=6.0",{headers:{Authorization:`Bearer ${e.accessToken}`,"Content-Type":"application/json"}});let s;if(a.ok)s=(await a.json()).displayName;else{const c=await a.text();Z.error(c),s="User"}return{expiresIn:e.expiresIn,expiresAt:e.expiresIn?Date.now()+e.expiresIn*1e3:void 0,accessToken:e.accessToken,refreshToken:e.refreshToken,scope:r,sessionId:n!=null?n:`${o.nameid}/${JE()}`,account:{label:s,id:`${o.nameid}/${(i=o.aui)!=null?i:""}`}}}async refreshToken(e,r,n){Z.log("Refreshing token...");let i;try{const o=`${Qv}/refresh?refreshToken=${e}&isFromRemoteHub=true`;i=await on(o)}catch(o){throw Z.error("Refreshing token failed"),new Error(Tl)}try{if(i.ok){const o=await i.json(),a=await this.getTokenFromResponse({accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token},r,n);return this.setToken(a,r),Z.log("Token refresh success"),a}throw new Error("Bad request.")}catch(o){throw await d.window.showErrorMessage(tR(0,null)),Z.error(`Refreshing token failed: ${i.statusText}`),new Error("Refreshing token failed")}}clearSessionTimeout(e){const r=this._refreshTimeouts.get(e);r&&(clearTimeout(r),this._refreshTimeouts.delete(e))}removeInMemorySessionData(e){const r=this._tokens.findIndex(i=>i.sessionId===e);let n;return r>-1&&(n=this._tokens[r],this._tokens.splice(r,1)),this.clearSessionTimeout(e),n}pollForReconnect(e,r,n){this.clearSessionTimeout(e),this._refreshTimeouts.set(e,setTimeout(async()=>{try{const i=await this.refreshToken(r,n,e);Fi.fire({added:[],removed:[],changed:[this.convertToSessionSync(i)]})}catch(i){this.pollForReconnect(e,r,n)}},1e3*60*30))}handleRefreshNetworkError(e,r,n,i=1){return new Promise((o,a)=>{if(i===3)return Z.error("Token refresh failed after 3 attempts"),o(!1);const s=5*i*i;this.clearSessionTimeout(e),this._refreshTimeouts.set(e,setTimeout(async()=>{try{const c=await this.refreshToken(r,n,e);return Fi.fire({added:[],removed:[],changed:[this.convertToSessionSync(c)]}),o(!0)}catch(c){return o(await this.handleRefreshNetworkError(e,r,n,i+1))}},1e3*s))})}async removeSession(e){Z.log(`Logging out of session '${e}'`);const r=this.removeInMemorySessionData(e);let n;return r&&(n=this.convertToSessionSync(r)),this._tokens.length===0?await this.secretStorage.delete(Ss):this.storeTokenData(),n}async clearSessions(){Z.log("Logging out of all sessions"),this._tokens=[],await this.secretStorage.delete(Ss),this._refreshTimeouts.forEach(e=>{clearTimeout(e)}),this._refreshTimeouts.clear()}}const Jv=class{constructor(t){this.onDidChangeSessions=Fi.event,this.loginService=new oR(t),this.initializePromise=this.loginService.initialize(),this.disposable=d.authentication.registerAuthenticationProvider(Jv.id,"Azure Repos",this)}dispose(){this.disposable.dispose()}async getSessions(t){return await this.initializePromise,this.loginService.getSessions(t)}async createSession(t){await this.initializePromise;const e=await this.loginService.createSession(t.sort().join(" "));return Fi.fire({added:[e],removed:[],changed:[]}),e}async removeSession(t){await this.initializePromise;const e=await this.loginService.removeSession(t);e&&Fi.fire({added:[],removed:[e],changed:[]})}};let mo=Jv;mo.id="azurerepos";var ha=__webpack_require__(7360),Oh=__webpack_require__(850);function Uh(t,e,r){if(!(e==null?void 0:e.length)&&!(r==null?void 0:r.length))return new Set(t);let n;if(e==null?void 0:e.length){const i=new Set([...e,...e.map(a=>`${a}/**`)]),o=Oh(t,[...i],{dot:!0,nocase:!0});n=new Set(o)}if(r==null?void 0:r.length){const i=new Set([...r,...r.map(o=>`${o}/**`)]);if(n===void 0){const o=Oh.not(t,[...i],{dot:!0,nocase:!0});n=new Set(o)}else Oh(t,[...i],{dot:!0,nocase:!0}).forEach(n.delete,n)}return n}var aR=Object.defineProperty,sR=Object.getOwnPropertyDescriptor,Lh=(t,e,r,n)=>{for(var i=n>1?void 0:n?sR(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&aR(e,r,i),i};const cR=(0,C.loadMessageBundle)(),lR=d.FileSystemError.FileNotFound().code,uR=/(\/|\\)/g;class kl{constructor(e,r,n){this.providerService=e,this.azdo=r,this.changeStore=n,this._onDidChangeFile=new d.EventEmitter,this.contentCache=new Map,this.fileSearchCache=new Map,this.pendingUriRequests=new Map,this.pendingUriRequestsEventDelay=10,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.pathTypeMap={},this.disposable=d.Disposable.from(d.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0,isReadonly:!0}),d.workspace.registerFileSearchProvider(this.scheme,this),d.workspace.registerTextSearchProvider(this.scheme,this),d.workspace.onDidCloseTextDocument(i=>this.onTextDocumentClosed(i.uri)),e.onDidChangeRepository(i=>{i.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([i.repository.uri])}),e.onDidRefresh(i=>this.onRefreshOrRepositoryChanged(i)))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return this.azdo.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){if(e=e.filter(r=>Pt.getProviderId(r)===this.scheme).map(r=>this.providerService.getProviderUri(r)),e.length!==0){Z.log(`AzDOFS.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.fileSearchCache.clear();for(const[r,n]of[...this.pendingUriRequests])e.some(i=>Gn(n.uri,i))&&(this.pendingUriRequests.delete(r),n.outdated=!0);for(const[r,{uri:n}]of[...this.contentCache])e.some(i=>Gn(n,i))&&this.contentCache.delete(r);this.updateOpenOrWatchedUris(e)}}onTextDocumentClosed(e){e.scheme===this.scheme&&this.contentCache.delete(we(e))}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,o]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(a=>Gn(o,a))&&(this.implicitlyWatchedUris.delete(i),r.set(i,o));Z.debug(`AzDOFS.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(we(i),i);const n=[...r.values()].map(i=>({type:d.FileChangeType.Changed,uri:i}));setTimeout(()=>{Z.debug(`AzDOFS.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=we(e);return this.watchedUris.set(n,e),{dispose:()=>{this.watchedUris.delete(n)}}}async stat(e){const r=we(e);this.implicitlyWatchedUris.set(r,e);const n={uri:e,outdated:!1};try{this.pendingUriRequests.set(`stat:${r}`,n);const i=await this.providerService.getMetadata(e),o=d.FilePermission.Readonly;if(!i.path)return{type:d.FileType.Directory,mtime:0,ctime:0,size:0,permissions:o};if(i.path in this.pathTypeMap||await this.updateWorkspaceItemMap(i,e.path,!0),i.path in this.pathTypeMap)return this.pathTypeMap[i.path]===d.FileType.Directory?{type:d.FileType.Directory,mtime:0,ctime:0,size:0,permissions:o}:{type:d.FileType.File,mtime:0,ctime:0,size:0,permissions:o};if(this.implicitlyWatchedUris.delete(r),e.query!=="~")throw d.FileSystemError.FileNotFound(e);return{type:d.FileType.File,size:0,ctime:0,mtime:Date.now(),permissions:d.FilePermission.Readonly}}finally{this.pendingUriRequests.delete(`stat:${r}`),(n==null?void 0:n.outdated)&&setTimeout(()=>{Z.log(`AzDOFS.stat(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:d.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}async updateWorkspaceItemMap(e,r,n){const i=new Array,o=await this.azdo.getRepoItems(e,r);for(const a of o){const s=a.path.substring(1);if(s!==e.path||n){const c=a.isFolder===!0?d.FileType.Directory:d.FileType.File;this.pathTypeMap[s]=c,i.push([s,c])}}return i}async readDirectory(e){this.implicitlyWatchedUris.set(we(e),e);const r=this.providerService.getVirtualRootUri(e),n=await this.providerService.getMetadata(e);return(await this.updateWorkspaceItemMap(n,e.path,!1)).map(o=>[this.providerService.getRelativeFilePath(e,Ma(r,o[0])),o[1]])}createDirectory(e){throw d.FileSystemError.NoPermissions()}async readFile(e){var r;const n=we(e);this.implicitlyWatchedUris.set(n,e);let i=this.contentCache.get(n);if(i!==void 0)return i.content;const o={uri:e,outdated:!1};try{return this.pendingUriRequests.set(n,o),i={content:this.azdo.getFileContent(e),uri:e},this.contentCache.set(n,i),await i.content}catch(a){if(this.implicitlyWatchedUris.delete(n),i!==void 0&&i.content===((r=this.contentCache.get(n))==null?void 0:r.content)&&this.contentCache.delete(n),e.query==="~"&&a instanceof d.FileSystemError&&a.code===lR)return new Uint8Array(0);throw a}finally{this.pendingUriRequests.delete(n),(o==null?void 0:o.outdated)&&setTimeout(()=>{Z.log(`AzDOFS.readFile(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:d.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}writeFile(e,r,n){throw d.FileSystemError.NoPermissions()}delete(e,r){throw d.FileSystemError.NoPermissions()}rename(e,r,n){throw d.FileSystemError.NoPermissions()}copy(e,r,n){throw d.FileSystemError.NoPermissions()}async provideFileSearchResults(e,{folder:r,maxResults:n,includes:i,excludes:o},a){const s=`${we(r)}|${JSON.stringify({includes:i,excludes:o})}`;let c=this.fileSearchCache.get(s);if(c===void 0){let u=await this.azdo.getRepoFileNames(r);if(u.length===0||a.isCancellationRequested)return[];((i==null?void 0:i.length)||(o==null?void 0:o.length))&&(u=[...Uh(u,i,o)]),c=u.map(f=>ha.prepareSlow(f)),this.fileSearchCache.set(s,c)}let l;return e.pattern===""?l=c.map(u=>d.Uri.joinPath(r,u.target)):(l=ha.go(e.pattern.replace(uR,"/"),c,{allowTypo:!0,limit:n}).map(u=>d.Uri.joinPath(r,u.target)),ha.cleanup()),n!==void 0&&n!==0&&n<l.length&&(l=l.slice(0,n)),l}async provideTextSearchResults(e,r,n,i){const o=[];(e.isCaseSensitive||e.isRegExp||e.isWordMatch)&&o.push({text:cR("azdo flags not supported","Search flags are not supported."),type:d.TextSearchCompleteMessageType.Warning});const a=await this.azdo.searchCodeQuery(e.pattern,r.folder,{maxResults:r.maxResults,context:{before:r.beforeContext,after:r.afterContext}});if(a.warnings&&a.warnings.forEach(c=>{o.push({text:c,type:d.TextSearchCompleteMessageType.Warning})}),a===void 0)return{limitHit:!0,message:o};let s;for(const c of a.matches)s=d.Uri.joinPath(r.folder,c.path),n.report({uri:s,ranges:c.ranges,preview:{text:c.preview,matches:c.matches}});return{limitHit:!1,message:o}}}Lh([xn()],kl.prototype,"stat",1),Lh([xn()],kl.prototype,"readDirectory",1),Lh([xn()],kl.prototype,"readFile",1);var e0;(function(t){t[t.Force=0]="Force",t[t.ForceWithLease=1]="ForceWithLease"})(e0||(e0={}));var Nn;(function(t){t[t.Head=0]="Head",t[t.RemoteHead=1]="RemoteHead",t[t.Tag=2]="Tag"})(Nn||(Nn={}));var Cs;(function(t){t[t.INDEX_MODIFIED=0]="INDEX_MODIFIED",t[t.INDEX_ADDED=1]="INDEX_ADDED",t[t.INDEX_DELETED=2]="INDEX_DELETED",t[t.INDEX_RENAMED=3]="INDEX_RENAMED",t[t.INDEX_COPIED=4]="INDEX_COPIED",t[t.MODIFIED=5]="MODIFIED",t[t.DELETED=6]="DELETED",t[t.UNTRACKED=7]="UNTRACKED",t[t.IGNORED=8]="IGNORED",t[t.INTENT_TO_ADD=9]="INTENT_TO_ADD",t[t.ADDED_BY_US=10]="ADDED_BY_US",t[t.ADDED_BY_THEM=11]="ADDED_BY_THEM",t[t.DELETED_BY_US=12]="DELETED_BY_US",t[t.DELETED_BY_THEM=13]="DELETED_BY_THEM",t[t.BOTH_ADDED=14]="BOTH_ADDED",t[t.BOTH_DELETED=15]="BOTH_DELETED",t[t.BOTH_MODIFIED=16]="BOTH_MODIFIED"})(Cs||(Cs={}));var t0;(function(t){t.BadConfigFile="BadConfigFile",t.AuthenticationFailed="AuthenticationFailed",t.NoUserNameConfigured="NoUserNameConfigured",t.NoUserEmailConfigured="NoUserEmailConfigured",t.NoRemoteRepositorySpecified="NoRemoteRepositorySpecified",t.NotAGitRepository="NotAGitRepository",t.NotAtRepositoryRoot="NotAtRepositoryRoot",t.Conflict="Conflict",t.StashConflict="StashConflict",t.UnmergedChanges="UnmergedChanges",t.PushRejected="PushRejected",t.RemoteConnectionError="RemoteConnectionError",t.DirtyWorkTree="DirtyWorkTree",t.CantOpenResource="CantOpenResource",t.GitNotFound="GitNotFound",t.CantCreatePipe="CantCreatePipe",t.PermissionDenied="PermissionDenied",t.CantAccessRemote="CantAccessRemote",t.RepositoryNotFound="RepositoryNotFound",t.RepositoryIsLocked="RepositoryIsLocked",t.BranchNotFullyMerged="BranchNotFullyMerged",t.NoRemoteReference="NoRemoteReference",t.InvalidBranchName="InvalidBranchName",t.BranchAlreadyExists="BranchAlreadyExists",t.NoLocalChanges="NoLocalChanges",t.NoStashFound="NoStashFound",t.LocalChangesOverwritten="LocalChangesOverwritten",t.NoUpstreamBranch="NoUpstreamBranch",t.IsInSubmodule="IsInSubmodule",t.WrongCase="WrongCase",t.CantLockRef="CantLockRef",t.CantRebaseMultipleBranches="CantRebaseMultipleBranches",t.PatchDoesNotApply="PatchDoesNotApply",t.NoPathFound="NoPathFound",t.UnknownPath="UnknownPath"})(t0||(t0={}));var dR=Object.defineProperty,hR=Object.getOwnPropertyDescriptor,fR=(t,e,r,n)=>{for(var i=n>1?void 0:n?hR(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&dR(e,r,i),i};const ED=(0,C.loadMessageBundle)(),r0=/^https:\/\/(?<organization>[^.]+)\.visualstudio\.com(?:\/defaultcollection)?\/(?<project>[^/]+)(?:\/_git)?\/(?<repo>[^/?#]+)(?:\/commit\/(?<commit>[0-9a-f]{40})|\/pullrequest\/(?<pull>\d+))?(?:\/)?(?:\?(?<query>[^#]+))?(?:#(?<fragment>.*))?$/i,n0=/^https:\/\/dev\.azure\.com(?:\/defaultcollection)?\/(?<organization>[^/]+)\/(?<project>[^/]+)(?:\/_git)?\/(?<repo>[^/?#]+)(?:\/commit\/(?<commit>[0-9a-f]{40})|\/pullrequest\/(?<pull>\d+))?(?:\/)?(?:\?(?<query>[^#]+))?(?:#(?<fragment>.*))?$/i,i0=1,o0=Object.freeze({id:Ur.AzureRepos,name:"Azure Repos"});function Ni(t){const{scheme:e,metadata:r}=Pt.decodeAuthority(t),[,n,i,o,...a]=t.path.split("/");return{scheme:e,provider:o0,name:`${n}/${i}/${o}`,repo:{organization:n,project:i,name:o},path:a.join("/")||"",ref:r==null?void 0:r.ref,idx:r==null?void 0:r.idx}}function pR(t,e){const{repo:r}=e!=null?e:Ni(t);return t.with({path:`/${r.organization}/${r.project}/${r.name}`,query:"",fragment:""})}function Hh(t,e,r){const{repo:{organization:n,name:i}}=t instanceof d.Uri?Ni(t):t;return d.Uri.parse(`azurerepos://${Pt.encodeAuthority("azurerepos",{v:i0,ref:{type:Ue.Commit,id:e}})}/${n}/${i}/${r}`)}class a0{constructor(e){this.providerService=e}get isReadonly(){return!0}get scheme(){return"azurerepos"}dispose(){}async ensureAuthenticated(e=!1){const r=new $e("AzDO.ensureAuthenticated");try{if(this._session===void 0){async function n(){try{return await d.authentication.getSession(mo.id,Al,{createIfNone:!0,forceNewSession:e})}catch{try{const o=await d.authentication.getSession(mo.id,Al,{createIfNone:!1});if(o!==void 0)return o}catch{}return new Promise(o=>{async function a(){const c=await d.authentication.getSession(mo.id,Al,{createIfNone:!0});c!==void 0&&o(c)}const s=d.authentication.onDidChangeSessions(async c=>{c.provider.id===mo.id&&(s.dispose(),await a())})})}}this._session=await n();const i=d.authentication.onDidChangeSessions(o=>{if(this._session===void 0){i.dispose();return}o.provider.id===mo.id&&(this.clearAuthenticationSession(),i.dispose())})}return this._session}finally{r.stop()}}async getAuthentication(e){const r=await this.ensureAuthenticated();return{provider:o0,session:r,getRichNavigationHeaders:()=>({"X-Git-AzureDevOps":`Basic ${this.getBase64AuthenticationSessionToken(r)}`})}}getBase64AuthenticationSessionToken(e){if(this._sessionTokenBase64===void 0){if(e===void 0)return this.ensureAuthenticated().then(r=>(this._sessionTokenBase64=_c(`PAT:${r.accessToken}`),this._sessionTokenBase64));this._sessionTokenBase64=_c(`PAT:${e.accessToken}`)}return this._sessionTokenBase64}clearAuthenticationSession(){this._session=void 0,this._sessionTokenBase64=void 0}async reauthenticate(){this.clearAuthenticationSession(),await this.ensureAuthenticated(!0)}async sendGetRequest(e,r,n,i){const a=`${n?`https://dev.azure.com/${e}/${n}/_apis/`:`https://dev.azure.com/${e}/_apis/`}${r}${i?`?${i}&`:"?"}api-version=5.1`;try{const s=await this.getBase64AuthenticationSessionToken();if(!s)throw new _n("Unauthenticated",()=>this.reauthenticate());const c=await on(a,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${s}`}});if(c.status===401)throw new _n("Unauthenticated",()=>this.reauthenticate());if(c.status===404)return;const l=await c.json();return l!=null?l:void 0}catch(s){throw Z.error(s),s instanceof _n&&Tr.showStatus401Message(s.reauthenticate),s}}async sendPostRequest(e,r){try{const n=await this.getBase64AuthenticationSessionToken();if(!n)throw new _n("Unauthenticated",()=>this.reauthenticate());const i=await on(e,{method:"POST",body:r,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${n}`}});if(i.status===401)throw new _n("Unauthenticated",()=>this.reauthenticate());const o=await i.json();return o!=null?o:void 0}catch(n){throw Z.error(n),n instanceof _n&&Tr.showStatus401Message(n.reauthenticate),n}}canOpenRemoteUrl(e){var r;const n=(r=r0.exec(e))!=null?r:n0.exec(e);if((n==null?void 0:n.groups)===void 0)return;const{commit:i}=n.groups;return i?Vr.Commit:Vr.Repository}async createWorkspaceForRemoteUrl(e,r=Tt.CurrentWindow){var n;const i=(n=r0.exec(e))!=null?n:n0.exec(e);if((i==null?void 0:i.groups)===void 0)return;const{organization:o,project:a,repo:s,commit:c}=i.groups;let l;c&&(l={type:Ue.Commit,id:c});const u=this.providerService.createVirtualUri(Ur.AzureRepos,{repo:{organization:o,project:a,name:s},ref:l});return{name:(await this.providerService.getMetadata(u)).name,uri:u,location:r}}createVirtualUri(e,{repo:r,ref:n,idx:i},o){if((n==null?void 0:n.type)===Ue.Tree)throw new Error(`Invalid ref type '${n.type}'`);const a=n!==void 0||i!==void 0?{v:i0}:void 0;return a&&(n&&(a.ref={type:n.type,id:n.id}),i&&(a.idx=i)),e.with({authority:Pt.encodeAuthority("azurerepos",a),path:`/${r.organization}/${r.project}/${r.name}${(o==null?void 0:o.startsWith("/"))?o:`/${o!=null?o:""}`}`})}getRemoteUri(e){const r=`https://dev.azure.com/${e.repo.organization}/${e.repo.project}/_git/${e.repo.name}`;return e.sha?d.Uri.parse(`${r}/commit/${e.sha}`):e.clone?d.Uri.parse(`https://${e.repo.organization}@dev.azure.com/${e.repo.organization}/${e.repo.project}/_git/${e.repo.name}`):d.Uri.parse(r)}getProviderRootUri(e){return pR(e)}getRelativeFilePath(e,r){const{path:n}=Ni(e),{path:i}=Ni(Ma(e,r));return n.length!==0&&i!==n&&i.startsWith(n)?i.slice(n.length+1):i}getVirtualUriMetadata(e){const{provider:r,name:n,repo:i,ref:o}=Ni(e);return{provider:r,name:n,repo:i,ref:o}}async validateBranchOrTagCasing(e,r,n,i){const o=`git/repositories/${n}/refs`,a="includeLinks=true",s=await this.sendGetRequest(e,o,r,a);if((s==null?void 0:s.value)===void 0){Z.warn("Could not get branches, might be incorrect auth token");return}const c=s.value;if(c.length===0)return i?{type:Ue.Branch,id:i}:void 0;const l=`refs/heads/${i.toLowerCase()}`,u=`refs/tags/${i.toLowerCase()}`;for(const f of c){const h=f.name;if(h.toLowerCase()==l)return{type:Ue.Branch,id:h.substr(11)};if(h.toLowerCase()==u)return{type:Ue.Tag,id:h.substr(10)}}}async getModeRefType(e,r){const{HEAD:n,pullRequest:i}=await(r!=null?r:this.getMetadata(e));switch(n.type){case Le.Branch:return i!==void 0?q.PullRequestBranch:q.Branch;case Le.RemoteBranch:return i!==void 0?q.PullRequestRemoteBranch:q.RemoteBranch;case Le.Tag:return q.Tag;case Le.Commit:return q.Commit}}async createMetadata(e,r){var n,i,o,a;const s=new $e(`AzDO.createMetadata(${e.toString()}, ${r})`);let c;try{let{provider:l,name:u,repo:{organization:f,project:h,name:p},ref:b}=Ni(e);if(!b||b.type===Ue.Commit&&/HEAD/i.test(b.id))b={type:Ue.Commit,id:"HEAD"};else if((b.type===Ue.Branch||b.type===Ue.Tag)&&(b=await this.validateBranchOrTagCasing(f,h,p,b.id),b===void 0))throw new Error(`Cannot get metadata for Uri(${e.toString(!0)}); Unable to find the specified branch or tag`);const y=await this.getRepositoryInfo(f,h,p,b);if(y===void 0)throw c=" \u2022 Aborted; Unable to get repository info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let w;if(r)w=r;else if(b.type===Ue.Commit)w=b.id;else if(w=(i=(n=y.ref)==null?void 0:n.sha)!=null?i:y.defaultBranch.sha,w===void 0)throw c=" \u2022 Aborted; Unable to get repository revision",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let _;((o=y.ref)==null?void 0:o.prefix)==="refs/heads/"?_={type:Le.Branch,name:y.ref.name,sha:w,branch:{name:y.ref.name,sha:y.ref.sha}}:((a=y.ref)==null?void 0:a.prefix)==="refs/tags/"?_={type:Le.Tag,name:y.ref.name,sha:w,detached:{type:Le.Tag,name:y.ref.name}}:_={type:Le.Commit,name:fr(w),sha:w,detached:{type:Le.Commit,name:fr(w)}};const S={version:Ba.schemaVersion,timestamp:Date.now(),provider:l,name:u,repo:y.repo,user:y.user,accessLevel:y.accessLevel,HEAD:_,defaultBranch:y.defaultBranch,pullRequest:y.pullRequest};return c=` \u2022 HEAD=${_.sha}`,S}finally{s.stop(c?{suffix:c}:void 0)}}getMetadata(e){return this.providerService.getMetadata(e)}getRemoteWorkspaceSourceProviders(){return[]}async createBranch(e,r,n,i){throw new Error("Branch creation is currently not supported")}async createCommit(e,r,n,i){throw new Error("Commit creation is currently not supported")}async createAndPushCommit(e,r,n,i,o){throw new Error("Commit creation is currently not supported")}async createPullRequest(e,r,n,i,o){throw new Error("PR creation is currently not supported")}async fetch(e,r){const{fetched:n,metadata:i}=await this.fetchCore(e,!1,r);n&&await this.providerService.updateMetadata(e,i)}async fetchCore(e,r,n){var i,o,a,s;const{force:c,to:l}={...n,force:r||(n==null?void 0:n.force)},u=new $e(`AzDO.fetch(${e.toString()}, force=${c}, to=${l})`);let f;try{const h=await this.getMetadata(e);if(h.HEAD.detached)return f=" \u2022 Skipped; detached HEAD",{fetched:!1,metadata:h};if(h.HEAD.type===Le.RemoteBranch)return f=" \u2022 Skipped; remote branch",{fetched:!1,metadata:h};const p=await this.getBranchTips(e);if(!p)throw f=" \u2022 Unable to fetch branch tips",new Xi(r);if(!c&&!l&&((i=p.defaultBranch)==null?void 0:i.sha)!==void 0&&p.defaultBranch.sha===h.defaultBranch.sha&&((o=p.branch)==null?void 0:o.sha)!==void 0&&p.branch.sha===h.HEAD.branch.sha)return f=" \u2022 No changes detected",{fetched:!1,metadata:h};let b;if(((a=p.defaultBranch)==null?void 0:a.sha)!==void 0&&p.defaultBranch.sha!==h.defaultBranch.sha&&(b={defaultBranch:{...h.defaultBranch,sha:p.defaultBranch.sha}}),((s=p.branch)==null?void 0:s.sha)===void 0){if(f=" \u2022 Unable to find branch tip",c)throw new Xi(r);return b!==void 0?{fetched:!0,metadata:{...h,...b}}:{fetched:!1,metadata:h}}return p.branch.sha!==h.HEAD.branch.sha&&(b={...b,HEAD:{...h.HEAD,branch:{...h.HEAD.branch,sha:p.branch.sha},detached:void 0}}),p.branch.sha===h.HEAD.sha?(f=" \u2022 Up to date",h.state!==void 0||b!==void 0?{fetched:!0,metadata:{...h,...b,state:void 0}}:{fetched:!1,metadata:h}):b!==void 0?{fetched:!0,metadata:{...h,...b}}:{fetched:!1,metadata:h}}finally{u.stop(f?{suffix:f}:void 0)}}async fork(e){throw new Error("Forks are currently not supported")}async getBranches(e,r){var n;try{const{repo:{organization:i,project:o,name:a}}=Ni(e),s=`git/repositories/${a}/refs`,c="includeLinks=true",l=await this.sendGetRequest(i,s,o,c),u=(n=l==null?void 0:l.value)!=null?n:[];if(u.length===0)return{branches:[]};const f=[];for(const h of u)!h.name.startsWith("refs/heads/")||f.push({type:Nn.Head,name:h.name.substr(11),commit:h.objectId,commitUrl:h.url});return{branches:f}}catch(i){return{branches:[]}}}async getCommit(e,r){try{const{repo:{organization:n,project:i,name:o}}=await this.getMetadata(e),a=`git/repositories/${o}/commits/${r}`,s=await this.sendGetRequest(n,a,i);return s===void 0?void 0:{hash:s.commitId,message:s.comment,parents:s.parents,authorDate:new Date(s.author.date),authorEmail:s.author.email,authorName:s.author.name,commitDate:new Date(s.committer.date)}}catch(n){return}}async getCommits(e,r){try{const{repo:{organization:n,project:i,name:o}}=await this.getMetadata(e),a=`git/repositories/${o}/commits`;let s=`searchCriteria.itemVersion.version=${r==null?void 0:r.ref}&searchCriteria.itemVersion.versionType=commit`;(r==null?void 0:r.path)&&(s+=`&searchCriteria.itemPath=${r.path}`);const c=await this.sendGetRequest(n,a,i,s);if((c==null?void 0:c.value)===void 0)return;const l=c.value,u=[];for(const f of l)u.push({hash:f.commitId,message:f.comment,parents:[],authorDate:new Date(f.author.date),authorEmail:f.author.email,authorName:f.author.name,commitDate:new Date(f.committer.date)});return{commits:u}}catch(n){return}}async getFileContent(e,r,n){try{const{HEAD:i,repo:{organization:o,project:a,id:s},path:c}=await this.providerService.getMetadata(e);n=n!=null?n:c;const l=`git/repositories/${s}/items`;let u="";n&&(u+=`path=${n}&includeContent=true`),r?u+=`&versionDescriptor.version=${r}&versionDescriptor.versionType=commit`:i.type===Le.Branch?u+=`&versionDescriptor.version=${i.branch.name}&versionDescriptor.versionType=branch`:i.type===Le.Tag&&(u+=`&versionDescriptor.version=${i.name}&versionDescriptor.versionType=tag`);const f=await this.sendGetRequest(o,l,a,u);if(f==null?void 0:f.content)return new TextEncoder().encode(f.content);throw d.FileSystemError.FileNotFound(e)}catch(i){throw Z.logLevel===Rt.Debug&&Z.error(i),i}}async getFork(e){throw new Error("Forks are currently not supported")}async getIncomingChanges(e){var r,n;return(n=(r=(await this.getMetadata(e)).state)==null?void 0:r.incomingChanges)!=null?n:[]}async compareCommits(e,r){throw new Error("Comparing commits is currently not supported")}async getObjectDetails(e,r,n){throw new Error("Not able to get object detail")}async getPullRequest(e,r){throw new Error("PRs are currently not supported")}async getRepoItems(e,r){const n=`git/repositories/${e.repo.name}/items`,[,,,,...i]=r.split("/");let o=`scopePath=${i.join("/")}&recursionLevel=1&includeContentMetadata=true`;e.HEAD.type===Le.Commit?o+=`&versionDescriptor.version=${e.HEAD.sha}&versionDescriptor.versionType=commit`:e.HEAD.type===Le.Branch?o+=`&versionDescriptor.version=${e.HEAD.branch.name}&versionDescriptor.versionType=branch`:e.HEAD.type===Le.Tag&&(o+=`&versionDescriptor.version=${e.HEAD.name}&versionDescriptor.versionType=tag`);const a=await this.sendGetRequest(e.repo.organization,n,e.repo.project,o);return a&&Array.isArray(a==null?void 0:a.value)?a==null?void 0:a.value:(Z.debug(`AzDOProvider.getRepoItems returned ${a===void 0?"empty":"invalid"} result ${a==null?void 0:a.value} for path ${r}`),[])}async getRepoFileNames(e){return[]}async getTags(e,r){var n;try{const{repo:{organization:i,project:o,name:a}}=Ni(e),s=`git/repositories/${a}/refs`,c="includeLinks=true",l=await this.sendGetRequest(i,s,o,c),u=(n=l==null?void 0:l.value)!=null?n:[];if(u.length===0)return{tags:[]};const f=[];for(const h of u)!h.name.startsWith("refs/tags/")||f.push({type:Nn.Tag,name:h.name.substr(10),commit:h.objectId,commitUrl:h.url});return{tags:f}}catch(i){return{tags:[]}}}async getTarGz(e,r){throw new Error("Getting zip is currently not supported")}async pushCommit(e,r,n,i){throw new Error("Commit pushing is not currently supported")}async getItems(e){const r=await this.sendGetRequest(e,"projects");if(!r){Z.warn("do something here");return}return r}async getProjects(e){const r=await this.getItems(e),n=[];return r==null||r.value.map(i=>n.push({label:i.name,description:i.description})),d.window.showQuickPick(n,{placeholder:"Select a Azure DevOps project",title:"Select a Azure DevOps project",ignoreFocusOut:!0})}async searchRepositoriesQuery(e,r){try{const n=await d.window.showInputBox({placeHolder:"Enter an Azure DevOps Organization",ignoreFocusOut:!0});if(!n)return[];const i=await this.getProjects(n),o=await this.sendGetRequest(n,"git/repositories",i.label);return o==null?void 0:o.value.map(a=>({name:a.name,description:void 0,url:a.webUrl,fork:void 0,stars:0}))}catch(n){throw Z.error(n),n}}async searchCodeQuery(e,r,n){var i;const{repo:{organization:o,project:a,name:s},HEAD:c,defaultBranch:l}=await this.getMetadata(r),u=`https://almsearch.dev.azure.com/${o}/${a}/_apis/search/codesearchresults?api-version=6.1-preview.1`,f=c.branch?c.branch.name:l.name,h={searchText:e,$skip:0,$top:1e3,filters:{Project:[a],Repository:[s],Path:["/"],Branch:[f]},$orderBy:[{field:"filename",sortOrder:"ASC"}],includeSnippet:!0},p=await this.sendPostRequest(u,JSON.stringify(h)),b=new d.Range(0,0,0,0),y=[];let w;for(const _ of(i=p==null?void 0:p.results)!=null?i:[])for(const S of _.matches.content){w={path:_.path,ranges:[],preview:"",matches:[]};const I=Math.max(0,S.line-1),D=S.charOffset,O=D+S.length;w.preview=S.codeSnippet?S.codeSnippet:`CharOffset: ${S.charOffset}, Type: ${S.type}`,w.ranges.push(new d.Range(I,D,I,O)),w.matches.push(b),y.push(w)}return{matches:y,limitHit:!1}}async switchTo(e,r,n){const{name:i,repo:o,HEAD:{branch:a}}=await this.getMetadata(e);let s;if(!(r!==void 0&&(typeof r=="string"?r.startsWith("refs/heads/")?s={type:Ue.Branch,id:r.substr(11)}:r.startsWith("refs/tags/")?s={type:Ue.Tag,id:r.substr(10)}:s={type:Ue.Branch,id:r}:s={...r,type:r.type===Ue.Tree?Ue.Branch:r.type},(a==null?void 0:a.name)===s.id)))return{name:i,uri:this.providerService.createVirtualUri(e,{repo:o,ref:s}),location:(n==null?void 0:n.openInNewWindow)?Tt.NewWindow:Tt.CurrentWindow}}async sync(e,r,n){var i,o,a,s,c,l;const u=new $e(`AzDO.sync(${e.toString()}, resolution=${n.conflictResolution}, to=${n.to})`);let f;try{const{metadata:h}=await this.fetchCore(e,!0,{to:n.to});if(h.HEAD.detached){f=" \u2022 Skipped; detached HEAD";return}if(((o=(i=h==null?void 0:h.state)==null?void 0:i.behind)!=null?o:0)>0&&await r.hasChanges(e)){u.logStep("Fetching upstream changes");const p=[],b=(s=(a=h.state)==null?void 0:a.incomingChanges)!=null?s:[];if(b.length>0){const y=await r.getChanges(e);for(const w of y){const _=this.providerService.getRelativeFilePath(e,w.uri),S=b.find(I=>I.uri.path===w.uri.path);if(S!==void 0){p.push({path:_,current:w,incomingType:S.type});break}}}if(p.length>0)switch(n.conflictResolution){case Zr.KeepCurrent:u.logStep("Syncing (keep) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (keep) upstream changes..."});for(const y of p)await r.keep(y.current.uri,{type:y.incomingType,providerUri:Hh(h,h.HEAD.branch.sha,y.path)});break;case Zr.DiscardCurrent:u.logStep("Syncing (discard) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (discard) upstream changes..."});for(const y of p)await r.discard(y.current.uri);break;case Zr.Merge:u.logStep("Syncing (merge) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (merge) upstream changes..."});for(const y of p)await r.merge(y.current.uri,{type:y.incomingType,providerUri:Hh(h,h.HEAD.branch.sha,y.path)},{providerUri:Hh(h,h.HEAD.sha,y.path)});break;case Zr.Abort:default:throw u.logStep("Syncing (abort) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (abort) upstream changes..."}),await this.providerService.updateMetadata(e,h),new qa}}f=` \u2022 to=${(c=n.to)!=null?c:h.HEAD.branch.sha}`,await this.fastForwardTo(e,(l=n.to)!=null?l:h.HEAD.branch.sha,h)}finally{u.stop(f?{suffix:f}:void 0)}}async fastForwardTo(e,r,n){if(n.HEAD.detached)throw new Zi("Unable to fast-forward; no current branch");n.HEAD.sha===r&&n.state===void 0||(Z.log(`Fast forward to ${r}; rootUri=${e.toString()}`),await this.providerService.updateMetadata(e,{...n,HEAD:{...n.HEAD,detached:void 0,sha:r},state:void 0,timestamp:Date.now()}),r!==n.HEAD.branch.sha&&await this.fetchCore(e,!1,{to:r}))}async getBranchTips(e,r){try{const{repo:{organization:n,project:i,name:o},HEAD:{branch:a}}=await this.getMetadata(e);r===void 0?r=a?`heads/${a.name}`:"":r.startsWith("refs/")&&(r=r.slice(5));const s=`git/repositories/${o}/refs`,c=`includeLinks=true&filter=${r}`,l=await this.sendGetRequest(n,s,i,c),u=l==null?void 0:l.value;if(u===[])return;const f={target:{oid:u[0].objectId}},h=`git/repositories/${o}`,p=await this.sendGetRequest(n,h,i);let b=p==null?void 0:p.defaultBranch;b.startsWith("refs/")&&(b=b.slice(5));const y=`git/repositories/${o}/refs`,w=`includeLinks=true&filter=${b}`,_=await this.sendGetRequest(n,y,i,w),S=_==null?void 0:_.value;if(S===[])return;const I={target:{oid:S[0].objectId}};if(!I&&!f)return;const D=I?{sha:I.target.oid}:void 0,O=f?{sha:f.target.oid}:void 0;return{defaultBranch:D,branch:O}}catch(n){return}}async getRepositoryId(e,r,n){const i=`git/repositories/${n}`,o=await this.sendGetRequest(e,i,r);if(o){if(o.id)return o.id;throw new Error("Sign in page was returned for repoId. Check the token sent")}throw new Error("Can't get Repo Id")}async getRepositoryInfo(e,r,n,i){const o=await this.getRepositoryId(e,r,n),a=`git/repositories/${o}`,s=await this.sendGetRequest(e,a,r);if(!s)return;s.defaultBranch.startsWith("refs/heads/")&&(s.defaultBranch=s.defaultBranch.substr(11));const c=`git/repositories/${n}/stats/branches`,l=`name=${s.defaultBranch}`,u=await this.sendGetRequest(e,c,r,l);if(!u)return;let f=null;yi(i.id)&&(f=i.id);const h={user:"jepetty",repo:{organization:e,project:r,name:n,id:o},accessLevel:$t.Read,defaultBranch:{name:u.name,sha:f||u.commit.commitId}};if(i.type===Ue.Branch){const p=`git/repositories/${n}/stats/branches`,b=`name=${i.id}`,y=await this.sendGetRequest(e,p,r,b);if(y)return{...h,ref:{name:y.name,sha:y.commit.commitId,prefix:"refs/heads/"}}}else if(i.type===Ue.Tag){const p=`git/repositories/${o}/items`,b=`versionDescriptor.version=${i.id}&versionDescriptor.versionType=tag`,y=await this.sendGetRequest(e,p,r,b);if(y&&y.value.length===1)return{...h,ref:{name:i.id,sha:y.value[0].commitId,prefix:"refs/tags/"}}}else{if(i.type===Ue.Commit)return i.id==="HEAD"&&(i.id=s.defaultBranch),{...h,ref:{name:i.id,sha:u.commit.commitId,prefix:"refs/heads/"}};throw new Error("Not supported yet :(")}}}fR([vr()],a0.prototype,"ensureAuthenticated",1);class gR{constructor(e,r){this.providerService=e,this.changeStore=r,this.providers=[],this.handledRepositories=new Set,this.services=new Map,this.disposable=d.Disposable.from(e.onDidChangeRepositories(n=>{for(const i of n.added)this.repositoryOpened(i);for(const i of n.removed)this.repositoryClosed(i)}));for(const n of this.providerService.repositories)this.repositoryOpened(n)}dispose(){this.disposable.dispose()}register(e){const r=this.providers.length;return this.providers.push(e),{dispose:()=>this.providers.splice(r,1)}}async repositoryOpened(e){const r=we(e.uri);if(!this.handledRepositories.has(r)){this.handledRepositories.add(r);for(const n of this.providers){const i=await n.createNavigationService(this.providerService,e,this.changeStore);if(i!==void 0){const o=i();this.services.set(r,{service:o});break}}}}repositoryClosed(e){const r=we(e.uri);this.handledRepositories.delete(r);const n=this.services.get(r);n!==void 0&&(n.service.dispose(),this.services.delete(we(e.uri)))}}/*! (c) Andrea Giammarchi - ISC */var Il={};try{(function(t,e){if(new t("q=%2B").get("q")!==e||new t({q:e}).get("q")!==e||new t([["q",e]]).get("q")!==e||new t(`q=
`).toString()!=="q=%0A"||new t({q:" &"}).toString()!=="q=+%26"||new t({q:"%zx"}).toString()!=="q=%25zx")throw t;Il.URLSearchParams=t})(URLSearchParams,"+")}catch(t){(function(e,r,n){"use strict";var i=e.create,o=e.defineProperty,a=/[!'\(\)~]|%20|%00/g,s=/%(?![0-9a-fA-F]{2})/g,c=/\+/g,l={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},u={append:function(S,I){b(this._ungap,S,I)},delete:function(S){delete this._ungap[S]},get:function(S){return this.has(S)?this._ungap[S][0]:null},getAll:function(S){return this.has(S)?this._ungap[S].slice(0):[]},has:function(S){return S in this._ungap},set:function(S,I){this._ungap[S]=[r(I)]},forEach:function(S,I){var D=this;for(var O in D._ungap)D._ungap[O].forEach(te,O);function te(J){S.call(I,J,r(O),D)}},toJSON:function(){return{}},toString:function(){var S=[];for(var I in this._ungap)for(var D=w(I),O=0,te=this._ungap[I];O<te.length;O++)S.push(D+"="+w(te[O]));return S.join("&")}};for(var f in u)o(h.prototype,f,{configurable:!0,writable:!0,value:u[f]});Il.URLSearchParams=h;function h(S){var I=i(null);switch(o(this,"_ungap",{value:I}),!0){case!S:break;case typeof S=="string":S.charAt(0)==="?"&&(S=S.slice(1));for(var D=S.split("&"),O=0,te=D.length;O<te;O++){var J=D[O],G=J.indexOf("=");-1<G?b(I,y(J.slice(0,G)),y(J.slice(G+1))):J.length&&b(I,y(J),"")}break;case n(S):for(var O=0,te=S.length;O<te;O++){var J=S[O];b(I,J[0],J[1])}break;case"forEach"in S:S.forEach(p,I);break;default:for(var ue in S)b(I,ue,S[ue])}}function p(S,I){b(this,I,S)}function b(S,I,D){var O=n(D)?D.join(","):D;I in S?S[I].push(O):S[I]=[O]}function y(S){return decodeURIComponent(S.replace(s,"%25").replace(c," "))}function w(S){return encodeURIComponent(S).replace(a,_)}function _(S){return l[S]}})(Object,String,Array.isArray)}(function(t){var e=!1;try{e=!!Symbol.iterator}catch(n){}"forEach"in t||(t.forEach=function(i,o){var a=this,s=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach(function(c){!c.length||c in s||(s[c]=a.getAll(c)).forEach(function(l){i.call(o,l,c,a)})})}),"keys"in t||(t.keys=function(){return r(this,function(i,o){this.push(o)})}),"values"in t||(t.values=function(){return r(this,function(i,o){this.push(i)})}),"entries"in t||(t.entries=function(){return r(this,function(i,o){this.push([o,i])})}),e&&!(Symbol.iterator in t)&&(t[Symbol.iterator]=t.entries),"sort"in t||(t.sort=function(){for(var i=this.entries(),o=i.next(),a=o.done,s=[],c=Object.create(null),l,u,f;!a;)f=o.value,u=f[0],s.push(u),u in c||(c[u]=[]),c[u].push(f[1]),o=i.next(),a=o.done;for(s.sort(),l=0;l<s.length;l++)this.delete(s[l]);for(l=0;l<s.length;l++)u=s[l],this.append(u,c[u].shift())});function r(n,i){var o=[];return n.forEach(i,o),e?o[Symbol.iterator]():{next:function(){var a=o.shift();return{done:a===void 0,value:a}}}}(function(n){var i=n.defineProperty,o=n.getOwnPropertyDescriptor,a=function(f){function h(y,w){t.append.call(this,y,w),y=this.toString(),f.set.call(this._usp,y?"?"+y:"")}function p(y){t.delete.call(this,y),y=this.toString(),f.set.call(this._usp,y?"?"+y:"")}function b(y,w){t.set.call(this,y,w),y=this.toString(),f.set.call(this._usp,y?"?"+y:"")}return function(y,w){return y.append=h,y.delete=p,y.set=b,i(y,"_usp",{configurable:!0,writable:!0,value:w})}},s=function(f){return function(h,p){return i(h,"_searchParams",{configurable:!0,writable:!0,value:f(p,h)}),p}},c=function(f){var h=f.append;f.append=t.append,URLSearchParams.call(f,f._usp.search.slice(1)),f.append=h},l=function(f,h){if(!(f instanceof h))throw new TypeError("'searchParams' accessed on an object that does not implement interface "+h.name)},u=function(f){var h=f.prototype,p=o(h,"searchParams"),b=o(h,"href"),y=o(h,"search"),w;!p&&y&&y.set&&(w=s(a(y)),n.defineProperties(h,{href:{get:function(){return b.get.call(this)},set:function(_){var S=this._searchParams;b.set.call(this,_),S&&c(S)}},search:{get:function(){return y.get.call(this)},set:function(_){var S=this._searchParams;y.set.call(this,_),S&&c(S)}},searchParams:{get:function(){return l(this,f),this._searchParams||w(this,new URLSearchParams(this.search.slice(1)))},set:function(_){l(this,f),w(this,_)}}}))};try{u(HTMLAnchorElement),/^function|object$/.test(typeof URL)&&URL.prototype&&u(URL)}catch(f){}})(Object)})(Il.URLSearchParams.prototype,Object);const s0=Il.URLSearchParams;var mR=__webpack_require__(6822);const Ke=(0,C.loadMessageBundle)(),qh=60,Wh=qh*60,Es=Wh*24,c0=Es*7,l0=Es*30,u0=Es*365;function Rs(t,e){typeof t!="number"&&(t=t.getTime());const r=Math.round((new Date().getTime()-t)/1e3);if(r<-30)return Ke("date.fromNow.in","in {0}",Rs(new Date().getTime()+r*1e3,{ago:!1,short:e==null?void 0:e.short}));if(r<30)return(e==null?void 0:e.ago)?(e==null?void 0:e.short)?Ke("date.fromNow.seconds.short.ago","secs ago"):Ke("date.fromNow.seconds.ago","A few seconds ago"):(e==null?void 0:e.short)?Ke("date.fromNow.now.short","now"):Ke("date.fromNow.now","Just now");let n;return r<qh?(n=r,(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.seconds.singular.short.ago","{0} sec ago",n):Ke("date.fromNow.seconds.singular.ago","{0} second ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.seconds.plural.short.ago","{0} secs ago",n):Ke("date.fromNow.seconds.plural.ago","{0} seconds ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.seconds.singular.short","{0} sec",n):Ke("date.fromNow.seconds.singular","{0} second",n):(e==null?void 0:e.short)?Ke("date.fromNow.seconds.plural.short","{0} secs",n):Ke("date.fromNow.seconds.plural","{0} seconds",n)):r<Wh?(n=Math.floor(r/qh),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.minutes.singular.short.ago","{0} min ago",n):Ke("date.fromNow.minutes.singular.ago","{0} minute ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.minutes.plural.short.ago","{0} mins ago",n):Ke("date.fromNow.minutes.plural.ago","{0} minutes ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.minutes.singular.short","{0} min",n):Ke("date.fromNow.minutes.singular","{0} minute",n):(e==null?void 0:e.short)?Ke("date.fromNow.minutes.plural.short","{0} mins",n):Ke("date.fromNow.minutes.plural","{0} minutes",n)):r<Es?(n=Math.floor(r/Wh),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.hours.singular.short.ago","{0} hr ago",n):Ke("date.fromNow.hours.singular.ago","{0} hour ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.hours.plural.short.ago","{0} hrs ago",n):Ke("date.fromNow.hours.plural.ago","{0} hours ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.hours.singular.short","{0} hr",n):Ke("date.fromNow.hours.singular","{0} hour",n):(e==null?void 0:e.short)?Ke("date.fromNow.hours.plural.short","{0} hrs",n):Ke("date.fromNow.hours.plural","{0} hours",n)):r<c0?(n=Math.floor(r/Es),(e==null?void 0:e.ago)?n===1?Ke("date.fromNow.days.singular.ago","{0} day ago",n):Ke("date.fromNow.days.plural.ago","{0} days ago",n):n===1?Ke("date.fromNow.days.singular","{0} day",n):Ke("date.fromNow.days.plural","{0} days",n)):r<l0?(n=Math.floor(r/c0),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.weeks.singular.short.ago","{0} wk ago",n):Ke("date.fromNow.weeks.singular.ago","{0} week ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.weeks.plural.short.ago","{0} wks ago",n):Ke("date.fromNow.weeks.plural.ago","{0} weeks ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.weeks.singular.short","{0} wk",n):Ke("date.fromNow.weeks.singular","{0} week",n):(e==null?void 0:e.short)?Ke("date.fromNow.weeks.plural.short","{0} wks",n):Ke("date.fromNow.weeks.plural","{0} weeks",n)):r<u0?(n=Math.floor(r/l0),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.months.singular.short.ago","{0} mo ago",n):Ke("date.fromNow.months.singular.ago","{0} month ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.months.plural.short.ago","{0} mos ago",n):Ke("date.fromNow.months.plural.ago","{0} months ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.months.singular.short","{0} mo",n):Ke("date.fromNow.months.singular","{0} month",n):(e==null?void 0:e.short)?Ke("date.fromNow.months.plural.short","{0} mos",n):Ke("date.fromNow.months.plural","{0} months",n)):(n=Math.floor(r/u0),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.years.singular.short.ago","{0} yr ago",n):Ke("date.fromNow.years.singular.ago","{0} year ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.years.plural.short.ago","{0} yrs ago",n):Ke("date.fromNow.years.plural.ago","{0} years ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.years.singular.short","{0} yr",n):Ke("date.fromNow.years.singular","{0} year",n):(e==null?void 0:e.short)?Ke("date.fromNow.years.plural.short","{0} yrs",n):Ke("date.fromNow.years.plural","{0} years",n))}var d0,kr;(function(t){t.None=0,t.First=1,t.AsOld=t.First,t.Last=2,t.AsNew=t.Last})(kr||(kr={}));class vR{constructor(){this[d0]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return(e=this._head)==null?void 0:e.value}get last(){var e;return(e=this._tail)==null?void 0:e.value}has(e){return this._map.has(e)}get(e,r=kr.None){const n=this._map.get(e);if(!!n)return r!==kr.None&&this.touch(n,r),n.value}set(e,r,n=kr.None){let i=this._map.get(e);if(i)i.value=r,n!==kr.None&&this.touch(i,n);else{switch(i={key:e,value:r,next:void 0,previous:void 0},n){case kr.None:this.addItemLast(i);break;case kr.First:this.addItemFirst(i);break;case kr.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return Boolean(this.remove(e))}remove(e){const r=this._map.get(e);if(!!r)return this._map.delete(e),this.removeItem(r),this._size--,r.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,r){const n=this._state;let i=this._head;for(;i;){if(r?e.bind(r)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:r.key,done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}values(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:r.value,done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}entries(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:[r.key,r.value],done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}[(d0=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let r=this._head,n=this.size;for(;r&&n>e;)this._map.delete(r.key),r=r.next,n--;this._head=r,this._size=n,r&&(r.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const r=e.next,n=e.previous;if(!r||!n)throw new Error("Invalid list");r.previous=n,n.next=r}e.next=void 0,e.previous=void 0,this._state++}touch(e,r){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(r!==kr.First&&r!==kr.Last)){if(r===kr.First){if(e===this._head)return;const n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(r===kr.Last){if(e===this._tail)return;const n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){const e=[];return this.forEach((r,n)=>{e.push([n,r])}),e}fromJSON(e){this.clear();for(const[r,n]of e)this.set(r,n)}}class $i extends vR{constructor(e,r=1){super();this._limit=e,this._ratio=Math.min(Math.max(0,r),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,r=kr.AsNew){return super.get(e,r)}peek(e){return super.get(e,kr.None)}set(e,r){return super.set(e,r,kr.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}function wR(t,e,r){return new vo(new p0(t),new p0(e)).ComputeDiff(r).changes}class Mi{constructor(e,r,n,i){this.originalStart=e,this.originalLength=r,this.modifiedStart=n,this.modifiedLength=i}getOriginalEnd(){return this.originalStart+this.originalLength}getModifiedEnd(){return this.modifiedStart+this.modifiedLength}}var h0;(function(t){t[t.MAX_SAFE_SMALL_INTEGER=1073741824]="MAX_SAFE_SMALL_INTEGER",t[t.MIN_SAFE_SMALL_INTEGER=-1073741824]="MIN_SAFE_SMALL_INTEGER",t[t.MAX_UINT_8=255]="MAX_UINT_8",t[t.MAX_UINT_16=65535]="MAX_UINT_16",t[t.MAX_UINT_32=4294967295]="MAX_UINT_32",t[t.UNICODE_SUPPLEMENTARY_PLANE_BEGIN=65536]="UNICODE_SUPPLEMENTARY_PLANE_BEGIN"})(h0||(h0={}));function f0(t,e){return(e<<5)-e+t|0}function yR(t,e){e=f0(149417,e);for(let r=0,n=t.length;r<n;r++)e=f0(t.charCodeAt(r),e);return e}class p0{constructor(e){this.source=e}getElements(){const e=this.source,r=new Int32Array(e.length);for(let n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return r}}class fa{static Assert(e,r){if(!e)throw new Error(r)}}class pa{static Copy(e,r,n,i,o){for(let a=0;a<o;a++)n[i+a]=e[r+a]}static Copy2(e,r,n,i,o){for(let a=0;a<o;a++)n[i+a]=e[r+a]}}var g0;(function(t){t[t.MaxDifferencesHistory=1447]="MaxDifferencesHistory"})(g0||(g0={}));class m0{constructor(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}MarkNextChange(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new Mi(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824}AddOriginalElement(e,r){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,r),this.m_originalCount++}AddModifiedElement(e,r){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,r),this.m_modifiedCount++}getChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes}getReverseChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes}}class vo{constructor(e,r,n=null){this.ContinueProcessingPredicate=n,this._originalSequence=e,this._modifiedSequence=r;const[i,o,a]=vo._getElements(e),[s,c,l]=vo._getElements(r);this._hasStrings=a&&l,this._originalStringElements=i,this._originalElementsOrHash=o,this._modifiedStringElements=s,this._modifiedElementsOrHash=c,this.m_forwardHistory=[],this.m_reverseHistory=[]}static _isStringArray(e){return e.length>0&&typeof e[0]=="string"}static _getElements(e){const r=e.getElements();if(vo._isStringArray(r)){const n=new Int32Array(r.length);for(let i=0,o=r.length;i<o;i++)n[i]=yR(r[i],0);return[r,n,!0]}return r instanceof Int32Array?[[],r,!1]:[[],new Int32Array(r),!1]}ElementsAreEqual(e,r){return this._originalElementsOrHash[e]!==this._modifiedElementsOrHash[r]?!1:this._hasStrings?this._originalStringElements[e]===this._modifiedStringElements[r]:!0}ElementsAreStrictEqual(e,r){if(!this.ElementsAreEqual(e,r))return!1;const n=vo._getStrictElement(this._originalSequence,e),i=vo._getStrictElement(this._modifiedSequence,r);return n===i}static _getStrictElement(e,r){return typeof e.getStrictElement=="function"?e.getStrictElement(r):null}OriginalElementsAreEqual(e,r){return this._originalElementsOrHash[e]!==this._originalElementsOrHash[r]?!1:this._hasStrings?this._originalStringElements[e]===this._originalStringElements[r]:!0}ModifiedElementsAreEqual(e,r){return this._modifiedElementsOrHash[e]!==this._modifiedElementsOrHash[r]?!1:this._hasStrings?this._modifiedStringElements[e]===this._modifiedStringElements[r]:!0}ComputeDiff(e){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1,e)}_ComputeDiff(e,r,n,i,o){const a=[!1];let s=this.ComputeDiffRecursive(e,r,n,i,a);return o&&(s=this.PrettifyChanges(s)),{quitEarly:a[0],changes:s}}ComputeDiffRecursive(e,r,n,i,o){for(o[0]=!1;e<=r&&n<=i&&this.ElementsAreEqual(e,n);)e++,n++;for(;r>=e&&i>=n&&this.ElementsAreEqual(r,i);)r--,i--;if(e>r||n>i){let f;return n<=i?(fa.Assert(e===r+1,"originalStart should only be one more than originalEnd"),f=[new Mi(e,0,n,i-n+1)]):e<=r?(fa.Assert(n===i+1,"modifiedStart should only be one more than modifiedEnd"),f=[new Mi(e,r-e+1,n,0)]):(fa.Assert(e===r+1,"originalStart should only be one more than originalEnd"),fa.Assert(n===i+1,"modifiedStart should only be one more than modifiedEnd"),f=[]),f}const a=[0],s=[0],c=this.ComputeRecursionPoint(e,r,n,i,a,s,o),l=a[0],u=s[0];if(c!==null)return c;if(!o[0]){const f=this.ComputeDiffRecursive(e,l,n,u,o);let h=[];return o[0]?h=[new Mi(l+1,r-(l+1)+1,u+1,i-(u+1)+1)]:h=this.ComputeDiffRecursive(l+1,r,u+1,i,o),this.ConcatenateChanges(f,h)}return[new Mi(e,r-e+1,n,i-n+1)]}WALKTRACE(e,r,n,i,o,a,s,c,l,u,f,h,p,b,y,w,_,S){let I=null,D=null,O=new m0,te=r,J=n,G=p[0]-w[0]-i,ue=-1073741824,re=this.m_forwardHistory.length-1;do{const ae=G+e;ae===te||ae<J&&l[ae-1]<l[ae+1]?(f=l[ae+1],b=f-G-i,f<ue&&O.MarkNextChange(),ue=f,O.AddModifiedElement(f+1,b),G=ae+1-e):(f=l[ae-1]+1,b=f-G-i,f<ue&&O.MarkNextChange(),ue=f-1,O.AddOriginalElement(f,b+1),G=ae-1-e),re>=0&&(l=this.m_forwardHistory[re],e=l[0],te=1,J=l.length-1)}while(--re>=-1);if(I=O.getReverseChanges(),S[0]){let ae=p[0]+1,ye=w[0]+1;if(I!==null&&I.length>0){const dt=I[I.length-1];ae=Math.max(ae,dt.getOriginalEnd()),ye=Math.max(ye,dt.getModifiedEnd())}D=[new Mi(ae,h-ae+1,ye,y-ye+1)]}else{O=new m0,te=a,J=s,G=p[0]-w[0]-c,ue=1073741824,re=_?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{const ae=G+o;ae===te||ae<J&&u[ae-1]>=u[ae+1]?(f=u[ae+1]-1,b=f-G-c,f>ue&&O.MarkNextChange(),ue=f+1,O.AddOriginalElement(f+1,b+1),G=ae+1-o):(f=u[ae-1],b=f-G-c,f>ue&&O.MarkNextChange(),ue=f,O.AddModifiedElement(f+1,b+1),G=ae-1-o),re>=0&&(u=this.m_reverseHistory[re],o=u[0],te=1,J=u.length-1)}while(--re>=-1);D=O.getChanges()}return this.ConcatenateChanges(I,D)}ComputeRecursionPoint(e,r,n,i,o,a,s){let c=0,l=0,u=0,f=0,h=0,p=0;e--,n--,o[0]=0,a[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];const b=r-e+(i-n),y=b+1,w=new Int32Array(y),_=new Int32Array(y),S=i-n,I=r-e,D=e-n,O=r-i,J=(I-S)%2==0;w[S]=e,_[I]=r,s[0]=!1;for(let G=1;G<=b/2+1;G++){let ue=0,re=0;u=this.ClipDiagonalBound(S-G,G,S,y),f=this.ClipDiagonalBound(S+G,G,S,y);for(let ye=u;ye<=f;ye+=2){ye===u||ye<f&&w[ye-1]<w[ye+1]?c=w[ye+1]:c=w[ye-1]+1,l=c-(ye-S)-D;const dt=c;for(;c<r&&l<i&&this.ElementsAreEqual(c+1,l+1);)c++,l++;if(w[ye]=c,c+l>ue+re&&(ue=c,re=l),!J&&Math.abs(ye-I)<=G-1&&c>=_[ye])return o[0]=c,a[0]=l,dt<=_[ye]&&1447>0&&G<=1447+1?this.WALKTRACE(S,u,f,D,I,h,p,O,w,_,c,r,o,l,i,a,J,s):null}const ae=(ue-e+(re-n)-G)/2;if(this.ContinueProcessingPredicate!==null&&!this.ContinueProcessingPredicate(ue,ae))return s[0]=!0,o[0]=ue,a[0]=re,ae>0&&1447>0&&G<=1447+1?this.WALKTRACE(S,u,f,D,I,h,p,O,w,_,c,r,o,l,i,a,J,s):(e++,n++,[new Mi(e,r-e+1,n,i-n+1)]);h=this.ClipDiagonalBound(I-G,G,I,y),p=this.ClipDiagonalBound(I+G,G,I,y);for(let ye=h;ye<=p;ye+=2){ye===h||ye<p&&_[ye-1]>=_[ye+1]?c=_[ye+1]-1:c=_[ye-1],l=c-(ye-I)-O;const dt=c;for(;c>e&&l>n&&this.ElementsAreEqual(c,l);)c--,l--;if(_[ye]=c,J&&Math.abs(ye-S)<=G&&c<=w[ye])return o[0]=c,a[0]=l,dt>=w[ye]&&1447>0&&G<=1447+1?this.WALKTRACE(S,u,f,D,I,h,p,O,w,_,c,r,o,l,i,a,J,s):null}if(G<=1447){let ye=new Int32Array(f-u+2);ye[0]=S-u+1,pa.Copy2(w,u,ye,1,f-u+1),this.m_forwardHistory.push(ye),ye=new Int32Array(p-h+2),ye[0]=I-h+1,pa.Copy2(_,h,ye,1,p-h+1),this.m_reverseHistory.push(ye)}}return this.WALKTRACE(S,u,f,D,I,h,p,O,w,_,c,r,o,l,i,a,J,s)}PrettifyChanges(e){for(let r=0;r<e.length;r++){const n=e[r],i=r<e.length-1?e[r+1].originalStart:this._originalElementsOrHash.length,o=r<e.length-1?e[r+1].modifiedStart:this._modifiedElementsOrHash.length,a=n.originalLength>0,s=n.modifiedLength>0;for(;n.originalStart+n.originalLength<i&&n.modifiedStart+n.modifiedLength<o&&(!a||this.OriginalElementsAreEqual(n.originalStart,n.originalStart+n.originalLength))&&(!s||this.ModifiedElementsAreEqual(n.modifiedStart,n.modifiedStart+n.modifiedLength));){const l=this.ElementsAreStrictEqual(n.originalStart,n.modifiedStart);if(this.ElementsAreStrictEqual(n.originalStart+n.originalLength,n.modifiedStart+n.modifiedLength)&&!l)break;n.originalStart++,n.modifiedStart++}let c=[null];if(r<e.length-1&&this.ChangesOverlap(e[r],e[r+1],c)){e[r]=c[0],e.splice(r+1,1),r--;continue}}for(let r=e.length-1;r>=0;r--){const n=e[r];let i=0,o=0;if(r>0){const f=e[r-1];i=f.originalStart+f.originalLength,o=f.modifiedStart+f.modifiedLength}const a=n.originalLength>0,s=n.modifiedLength>0;let c=0,l=this._boundaryScore(n.originalStart,n.originalLength,n.modifiedStart,n.modifiedLength);for(let f=1;;f++){const h=n.originalStart-f,p=n.modifiedStart-f;if(h<i||p<o||a&&!this.OriginalElementsAreEqual(h,h+n.originalLength)||s&&!this.ModifiedElementsAreEqual(p,p+n.modifiedLength))break;const y=(h===i&&p===o?5:0)+this._boundaryScore(h,n.originalLength,p,n.modifiedLength);y>l&&(l=y,c=f)}n.originalStart-=c,n.modifiedStart-=c;const u=[null];if(r>0&&this.ChangesOverlap(e[r-1],e[r],u)){e[r-1]=u[0],e.splice(r,1),r++;continue}}if(this._hasStrings)for(let r=1,n=e.length;r<n;r++){const i=e[r-1],o=e[r],a=o.originalStart-i.originalStart-i.originalLength,s=i.originalStart,c=o.originalStart+o.originalLength,l=c-s,u=i.modifiedStart,f=o.modifiedStart+o.modifiedLength,h=f-u;if(a<5&&l<20&&h<20){const p=this._findBetterContiguousSequence(s,l,u,h,a);if(p){const[b,y]=p;(b!==i.originalStart+i.originalLength||y!==i.modifiedStart+i.modifiedLength)&&(i.originalLength=b-i.originalStart,i.modifiedLength=y-i.modifiedStart,o.originalStart=b+a,o.modifiedStart=y+a,o.originalLength=c-o.originalStart,o.modifiedLength=f-o.modifiedStart)}}}return e}_findBetterContiguousSequence(e,r,n,i,o){if(r<o||i<o)return null;const a=e+r-o+1,s=n+i-o+1;let c=0,l=0,u=0;for(let f=e;f<a;f++)for(let h=n;h<s;h++){const p=this._contiguousSequenceScore(f,h,o);p>0&&p>c&&(c=p,l=f,u=h)}return c>0?[l,u]:null}_contiguousSequenceScore(e,r,n){let i=0;for(let o=0;o<n;o++){if(!this.ElementsAreEqual(e+o,r+o))return 0;i+=this._originalStringElements[e+o].length}return i}_OriginalIsBoundary(e){return e<=0||e>=this._originalElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._originalStringElements[e])}_OriginalRegionIsBoundary(e,r){if(this._OriginalIsBoundary(e)||this._OriginalIsBoundary(e-1))return!0;if(r>0){const n=e+r;if(this._OriginalIsBoundary(n-1)||this._OriginalIsBoundary(n))return!0}return!1}_ModifiedIsBoundary(e){return e<=0||e>=this._modifiedElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._modifiedStringElements[e])}_ModifiedRegionIsBoundary(e,r){if(this._ModifiedIsBoundary(e)||this._ModifiedIsBoundary(e-1))return!0;if(r>0){const n=e+r;if(this._ModifiedIsBoundary(n-1)||this._ModifiedIsBoundary(n))return!0}return!1}_boundaryScore(e,r,n,i){const o=this._OriginalRegionIsBoundary(e,r)?1:0,a=this._ModifiedRegionIsBoundary(n,i)?1:0;return o+a}ConcatenateChanges(e,r){let n=[];if(e.length===0||r.length===0)return r.length>0?r:e;if(this.ChangesOverlap(e[e.length-1],r[0],n)){const i=new Array(e.length+r.length-1);return pa.Copy(e,0,i,0,e.length-1),i[e.length-1]=n[0],pa.Copy(r,1,i,e.length,r.length-1),i}else{const i=new Array(e.length+r.length);return pa.Copy(e,0,i,0,e.length),pa.Copy(r,0,i,e.length,r.length),i}}ChangesOverlap(e,r,n){if(fa.Assert(e.originalStart<=r.originalStart,"Left change is not less than or equal to right change"),fa.Assert(e.modifiedStart<=r.modifiedStart,"Left change is not less than or equal to right change"),e.originalStart+e.originalLength>=r.originalStart||e.modifiedStart+e.modifiedLength>=r.modifiedStart){const i=e.originalStart;let o=e.originalLength;const a=e.modifiedStart;let s=e.modifiedLength;return e.originalStart+e.originalLength>=r.originalStart&&(o=r.originalStart+r.originalLength-e.originalStart),e.modifiedStart+e.modifiedLength>=r.modifiedStart&&(s=r.modifiedStart+r.modifiedLength-e.modifiedStart),n[0]=new Mi(i,o,a,s),!0}else return n[0]=null,!1}ClipDiagonalBound(e,r,n,i){if(e>=0&&e<i)return e;const o=n,a=i-n-1,s=r%2==0;if(e<0){const c=o%2==0;return s===c?0:1}else{const c=a%2==0;return s===c?i-1:i-2}}}var zh;(function(t){function e(n,i){return n instanceof As?i:new d.Position(i.line,i.character)}t.makePosition=e;function r(n,i){return n instanceof As?i:new d.Range(i.start.line,i.start.character,i.end.line,i.end.character)}t.makeRange=r})(zh||(zh={}));var v0;(function(t){t[t.index2code=1]="index2code",t[t.code2Index=2]="code2Index"})(v0||(v0={}));const w0=class{constructor(t,e,r,n){this.diffCache=new $i(32),this.indexDocumentCache=new $i(32),this.codeDocumentCache=new $i(32),this.providerService=t,this.rootUri=e,this.index=r,this.code=n,this.changes=this.computeChanges()}async computeChanges(){if(this.index===this.code)return new Map;const t=await this.providerService.compareCommits(this.rootUri,{base:this.index,compare:this.code});return t===void 0?new Map:new Map(t.map(e=>[e.uri.toString(),e.type]))}async needsMapping(t){const e=t.uri;if(!e.toString().startsWith(this.rootUri.toString()))return!1;if((await this.changes).get(e.toString())!==void 0)return!0;const i=await this.getIndexDocument(e);return i===void 0?!0:this.getDiff(1,i,t).length!==0}async mapPositionFromCodeToIndex(t,e){const r=t.uri;if(!r.toString().startsWith(this.rootUri.toString()))return;const i=(await this.changes).get(r.toString());if(i===rt.Created||i===rt.Deleted)return;const o=await this.getIndexDocument(r);if(o===void 0)return;const a=this.getDiff(2,o,t);if(a.length===0)return e;const s=t.offsetAt(new d.Position(e.line,e.character));let c=s;for(const h of a){if(h.modifiedStart<=s&&s<h.modifiedStart+h.modifiedLength)return;if(c<h.modifiedStart)break;c=c-(h.modifiedLength-h.originalLength)}const l=o.positionAt(c),u=this.getWordAtOffset(o.lineAt(l.line).text,l.character),f=this.getWordAtOffset(t.lineAt(e.line).text,e.character);if(!(u===void 0||f===void 0||u!==f))return new d.Position(l.line,l.character)}async mapRangeFromIndexToCode(t,e){const r=t instanceof d.Uri?t:t.uri;if(!r.toString().startsWith(this.rootUri.toString()))return;const i=(await this.changes).get(r.toString());if(i===rt.Created||i===rt.Deleted)return;const[o,a]=await Promise.all([this.getIndexDocument(r),this.getCodeDocument(t)]);if(o===void 0||a===void 0)return;const s=this.getDiff(1,o,a);if(s.length===0)return e;const c=o.offsetAt(e.start);let l=c;const u=o.offsetAt(e.end);let f=u;for(const w of s){if(f<w.originalStart)break;const _=w.modifiedLength-w.originalLength;if(w.originalStart<=c){if(c<w.originalStart+w.originalLength)return;l+=_}else if(u<w.originalStart+w.originalLength)return;if(w.originalStart<=u){if(u<w.originalStart+w.originalLength)return;f+=_}}const h=a.positionAt(l),p=a.positionAt(f),b=o.getText(e),y=a.getText(zh.makeRange(a,{start:h,end:p}));if(b===y)return new d.Range(h.line,h.character,p.line,p.character)}async getIndexDocument(t){return this.getDocument(this.indexDocumentCache,t,this.index)}async getCodeDocument(t){return t instanceof d.Uri?this.getDocument(this.codeDocumentCache,t,this.code):t}async getDocument(t,e,r){let n=t.get(e.toString());if(n!==null)return n!==void 0||(n=this._getDocument(e,r),t.set(e.toString(),n),n.then(i=>{i===void 0&&t.set(e.toString(),null)},void 0)),n}async _getDocument(t,e){const r=t.toString().substr(this.rootUri.toString().length);return this.providerService.getFileContent(this.rootUri,e,r).then(n=>new As(t,Number.MAX_VALUE,w0.textDecoder.decode(n)),()=>{})}getDiff(t,e,r){if(e.uri.toString()!==r.uri.toString())throw new Error(`Original (${e.uri.toString()}) and modified (${r.uri.toString()}) are pointing to a different document`);const n=`${t}${e.uri.toString()}`;let i=this.diffCache.get(n);return i!==void 0&&i.original===e.version&&i.modified===r.version||(i={original:e.version,modified:r.version,changes:wR(e.getText(),r.getText(),!0)},this.diffCache.set(n,i)),i.changes}getWordAtOffset(t,e){let r="findStart",n=0,i=t.length,o=0;for(;o<t.length&&r!=="endFound";){switch(o===e&&(r="findEnd"),t[o]){case" ":case"	":case"(":case")":case"[":case"]":case"{":case"}":case"'":case'"':case"`":switch(r){case"findStart":n=o+1;break;case"findEnd":i=o,r="endFound";break}break}o++}return r==="endFound"?t.substring(n,i):void 0}};let y0=w0;y0.textDecoder=new TextDecoder("utf8");var b0;(function(t){t[t.LineFeed=10]="LineFeed",t[t.CarriageReturn=13]="CarriageReturn"})(b0||(b0={}));class As{static computeLineOffsets(e,r,n=0){const i=r?[n]:[];for(let o=0;o<e.length;o++){const a=e.charCodeAt(o);(a===13||a===10)&&(a===13&&o+1<e.length&&e.charCodeAt(o+1)===10&&o++,i.push(n+o+1))}return i}constructor(e,r,n){this._content=n,this.uri=e,this.version=r,this._lineOffsets=void 0}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=As.computeLineOffsets(this._content,!0)),this._lineOffsets}getText(e){if(e){const r=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(r,n)}return this._content}lineAt(e){const r=this.getLineOffsets();if(e>=r.length)return{lineNumber:e,text:""};const n=r[e],i=r[e+1];if(i===void 0)return{lineNumber:e,text:this._content.substring(n)};const o=this._content.substring(n,i);let a=o.length-1;for(;a>=0&&(o[a]===`
`||o[a]==="\r");)a--;return{lineNumber:e,text:o.substr(0,a+1)}}positionAt(e){e=Math.max(Math.min(e,this._content.length),0);const r=this.getLineOffsets();let n=0,i=r.length;if(i===0)return{line:0,character:e};for(;n<i;){const a=Math.floor((n+i)/2);r[a]>e?i=a:n=a+1}const o=n-1;return{line:o,character:e-r[o]}}offsetAt(e){const r=this.getLineOffsets();if(e.line>=r.length)return this._content.length;if(e.line<0)return 0;const n=r[e.line],i=e.line+1<r.length?r[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)}get lineCount(){return this.getLineOffsets().length}}var _0;(function(t){t.MIN_VALUE=-2147483648,t.MAX_VALUE=2147483647})(_0||(_0={}));var Dl;(function(t){t.MIN_VALUE=0,t.MAX_VALUE=2147483647})(Dl||(Dl={}));var $n;(function(t){function e(n,i){return n===Number.MAX_VALUE&&(n=Dl.MAX_VALUE),i===Number.MAX_VALUE&&(i=Dl.MAX_VALUE),{line:n,character:i}}t.create=e;function r(n){var i=n;return le.objectLiteral(i)&&le.uinteger(i.line)&&le.uinteger(i.character)}t.is=r})($n||($n={}));var _r;(function(t){function e(n,i,o,a){if(le.uinteger(n)&&le.uinteger(i)&&le.uinteger(o)&&le.uinteger(a))return{start:$n.create(n,i),end:$n.create(o,a)};if($n.is(n)&&$n.is(i))return{start:n,end:i};throw new Error("Range#create called with invalid arguments["+n+", "+i+", "+o+", "+a+"]")}t.create=e;function r(n){var i=n;return le.objectLiteral(i)&&$n.is(i.start)&&$n.is(i.end)}t.is=r})(_r||(_r={}));var jh;(function(t){function e(n,i){return{uri:n,range:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&_r.is(i.range)&&(le.string(i.uri)||le.undefined(i.uri))}t.is=r})(jh||(jh={}));var Pl;(function(t){function e(n,i,o,a){return{targetUri:n,targetRange:i,targetSelectionRange:o,originSelectionRange:a}}t.create=e;function r(n){var i=n;return le.defined(i)&&_r.is(i.targetRange)&&le.string(i.targetUri)&&(_r.is(i.targetSelectionRange)||le.undefined(i.targetSelectionRange))&&(_r.is(i.originSelectionRange)||le.undefined(i.originSelectionRange))}t.is=r})(Pl||(Pl={}));var Vh;(function(t){function e(n,i,o,a){return{red:n,green:i,blue:o,alpha:a}}t.create=e;function r(n){var i=n;return le.numberRange(i.red,0,1)&&le.numberRange(i.green,0,1)&&le.numberRange(i.blue,0,1)&&le.numberRange(i.alpha,0,1)}t.is=r})(Vh||(Vh={}));var x0;(function(t){function e(n,i){return{range:n,color:i}}t.create=e;function r(n){var i=n;return _r.is(i.range)&&Vh.is(i.color)}t.is=r})(x0||(x0={}));var S0;(function(t){function e(n,i,o){return{label:n,textEdit:i,additionalTextEdits:o}}t.create=e;function r(n){var i=n;return le.string(i.label)&&(le.undefined(i.textEdit)||Bi.is(i))&&(le.undefined(i.additionalTextEdits)||le.typedArray(i.additionalTextEdits,Bi.is))}t.is=r})(S0||(S0={}));var Ts;(function(t){t.Comment="comment",t.Imports="imports",t.Region="region"})(Ts||(Ts={}));var C0;(function(t){function e(n,i,o,a,s){var c={startLine:n,endLine:i};return le.defined(o)&&(c.startCharacter=o),le.defined(a)&&(c.endCharacter=a),le.defined(s)&&(c.kind=s),c}t.create=e;function r(n){var i=n;return le.uinteger(i.startLine)&&le.uinteger(i.startLine)&&(le.undefined(i.startCharacter)||le.uinteger(i.startCharacter))&&(le.undefined(i.endCharacter)||le.uinteger(i.endCharacter))&&(le.undefined(i.kind)||le.string(i.kind))}t.is=r})(C0||(C0={}));var Gh;(function(t){function e(n,i){return{location:n,message:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&jh.is(i.location)&&le.string(i.message)}t.is=r})(Gh||(Gh={}));var ga;(function(t){t.Error=1,t.Warning=2,t.Information=3,t.Hint=4})(ga||(ga={}));var Fl;(function(t){t.Unnecessary=1,t.Deprecated=2})(Fl||(Fl={}));var Kh;(function(t){function e(r){var n=r;return n!=null&&le.string(n.href)}t.is=e})(Kh||(Kh={}));var Nl;(function(t){function e(n,i,o,a,s,c){var l={range:n,message:i};return le.defined(o)&&(l.severity=o),le.defined(a)&&(l.code=a),le.defined(s)&&(l.source=s),le.defined(c)&&(l.relatedInformation=c),l}t.create=e;function r(n){var i,o=n;return le.defined(o)&&_r.is(o.range)&&le.string(o.message)&&(le.number(o.severity)||le.undefined(o.severity))&&(le.integer(o.code)||le.string(o.code)||le.undefined(o.code))&&(le.undefined(o.codeDescription)||le.string((i=o.codeDescription)===null||i===void 0?void 0:i.href))&&(le.string(o.source)||le.undefined(o.source))&&(le.undefined(o.relatedInformation)||le.typedArray(o.relatedInformation,Gh.is))}t.is=r})(Nl||(Nl={}));var ks;(function(t){function e(n,i){for(var o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];var s={title:n,command:i};return le.defined(o)&&o.length>0&&(s.arguments=o),s}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.title)&&le.string(i.command)}t.is=r})(ks||(ks={}));var Bi;(function(t){function e(o,a){return{range:o,newText:a}}t.replace=e;function r(o,a){return{range:{start:o,end:o},newText:a}}t.insert=r;function n(o){return{range:o,newText:""}}t.del=n;function i(o){var a=o;return le.objectLiteral(a)&&le.string(a.newText)&&_r.is(a.range)}t.is=i})(Bi||(Bi={}));var ma;(function(t){function e(n,i,o){var a={label:n};return i!==void 0&&(a.needsConfirmation=i),o!==void 0&&(a.description=o),a}t.create=e;function r(n){var i=n;return i!==void 0&&le.objectLiteral(i)&&le.string(i.label)&&(le.boolean(i.needsConfirmation)||i.needsConfirmation===void 0)&&(le.string(i.description)||i.description===void 0)}t.is=r})(ma||(ma={}));var Ir;(function(t){function e(r){var n=r;return typeof n=="string"}t.is=e})(Ir||(Ir={}));var Oi;(function(t){function e(o,a,s){return{range:o,newText:a,annotationId:s}}t.replace=e;function r(o,a,s){return{range:{start:o,end:o},newText:a,annotationId:s}}t.insert=r;function n(o,a){return{range:o,newText:"",annotationId:a}}t.del=n;function i(o){var a=o;return Bi.is(a)&&(ma.is(a.annotationId)||Ir.is(a.annotationId))}t.is=i})(Oi||(Oi={}));var Is;(function(t){function e(n,i){return{textDocument:n,edits:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&Ml.is(i.textDocument)&&Array.isArray(i.edits)}t.is=r})(Is||(Is={}));var va;(function(t){function e(n,i,o){var a={kind:"create",uri:n};return i!==void 0&&(i.overwrite!==void 0||i.ignoreIfExists!==void 0)&&(a.options=i),o!==void 0&&(a.annotationId=o),a}t.create=e;function r(n){var i=n;return i&&i.kind==="create"&&le.string(i.uri)&&(i.options===void 0||(i.options.overwrite===void 0||le.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||le.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||Ir.is(i.annotationId))}t.is=r})(va||(va={}));var wa;(function(t){function e(n,i,o,a){var s={kind:"rename",oldUri:n,newUri:i};return o!==void 0&&(o.overwrite!==void 0||o.ignoreIfExists!==void 0)&&(s.options=o),a!==void 0&&(s.annotationId=a),s}t.create=e;function r(n){var i=n;return i&&i.kind==="rename"&&le.string(i.oldUri)&&le.string(i.newUri)&&(i.options===void 0||(i.options.overwrite===void 0||le.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||le.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||Ir.is(i.annotationId))}t.is=r})(wa||(wa={}));var ya;(function(t){function e(n,i,o){var a={kind:"delete",uri:n};return i!==void 0&&(i.recursive!==void 0||i.ignoreIfNotExists!==void 0)&&(a.options=i),o!==void 0&&(a.annotationId=o),a}t.create=e;function r(n){var i=n;return i&&i.kind==="delete"&&le.string(i.uri)&&(i.options===void 0||(i.options.recursive===void 0||le.boolean(i.options.recursive))&&(i.options.ignoreIfNotExists===void 0||le.boolean(i.options.ignoreIfNotExists)))&&(i.annotationId===void 0||Ir.is(i.annotationId))}t.is=r})(ya||(ya={}));var Zh;(function(t){function e(r){var n=r;return n&&(n.changes!==void 0||n.documentChanges!==void 0)&&(n.documentChanges===void 0||n.documentChanges.every(function(i){return le.string(i.kind)?va.is(i)||wa.is(i)||ya.is(i):Is.is(i)}))}t.is=e})(Zh||(Zh={}));var $l=function(){function t(e,r){this.edits=e,this.changeAnnotations=r}return t.prototype.insert=function(e,r,n){var i,o;if(n===void 0?i=Bi.insert(e,r):Ir.is(n)?(o=n,i=Oi.insert(e,r,n)):(this.assertChangeAnnotations(this.changeAnnotations),o=this.changeAnnotations.manage(n),i=Oi.insert(e,r,o)),this.edits.push(i),o!==void 0)return o},t.prototype.replace=function(e,r,n){var i,o;if(n===void 0?i=Bi.replace(e,r):Ir.is(n)?(o=n,i=Oi.replace(e,r,n)):(this.assertChangeAnnotations(this.changeAnnotations),o=this.changeAnnotations.manage(n),i=Oi.replace(e,r,o)),this.edits.push(i),o!==void 0)return o},t.prototype.delete=function(e,r){var n,i;if(r===void 0?n=Bi.del(e):Ir.is(r)?(i=r,n=Oi.del(e,r)):(this.assertChangeAnnotations(this.changeAnnotations),i=this.changeAnnotations.manage(r),n=Oi.del(e,i)),this.edits.push(n),i!==void 0)return i},t.prototype.add=function(e){this.edits.push(e)},t.prototype.all=function(){return this.edits},t.prototype.clear=function(){this.edits.splice(0,this.edits.length)},t.prototype.assertChangeAnnotations=function(e){if(e===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},t}(),E0=function(){function t(e){this._annotations=e===void 0?Object.create(null):e,this._counter=0,this._size=0}return t.prototype.all=function(){return this._annotations},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.manage=function(e,r){var n;if(Ir.is(e)?n=e:(n=this.nextId(),r=e),this._annotations[n]!==void 0)throw new Error("Id "+n+" is already in use.");if(r===void 0)throw new Error("No annotation provided for id "+n);return this._annotations[n]=r,this._size++,n},t.prototype.nextId=function(){return this._counter++,this._counter.toString()},t}(),RD=function(){function t(e){var r=this;this._textEditChanges=Object.create(null),e!==void 0?(this._workspaceEdit=e,e.documentChanges?(this._changeAnnotations=new E0(e.changeAnnotations),e.changeAnnotations=this._changeAnnotations.all(),e.documentChanges.forEach(function(n){if(Is.is(n)){var i=new $l(n.edits,r._changeAnnotations);r._textEditChanges[n.textDocument.uri]=i}})):e.changes&&Object.keys(e.changes).forEach(function(n){var i=new $l(e.changes[n]);r._textEditChanges[n]=i})):this._workspaceEdit={}}return Object.defineProperty(t.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),t.prototype.getTextEditChange=function(e){if(Ml.is(e)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var r={uri:e.uri,version:e.version},n=this._textEditChanges[r.uri];if(!n){var i=[],o={textDocument:r,edits:i};this._workspaceEdit.documentChanges.push(o),n=new $l(i,this._changeAnnotations),this._textEditChanges[r.uri]=n}return n}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var n=this._textEditChanges[e];if(!n){var i=[];this._workspaceEdit.changes[e]=i,n=new $l(i),this._textEditChanges[e]=n}return n}},t.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new E0,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},t.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},t.prototype.createFile=function(e,r,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var i;ma.is(r)||Ir.is(r)?i=r:n=r;var o,a;if(i===void 0?o=va.create(e,n):(a=Ir.is(i)?i:this._changeAnnotations.manage(i),o=va.create(e,n,a)),this._workspaceEdit.documentChanges.push(o),a!==void 0)return a},t.prototype.renameFile=function(e,r,n,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var o;ma.is(n)||Ir.is(n)?o=n:i=n;var a,s;if(o===void 0?a=wa.create(e,r,i):(s=Ir.is(o)?o:this._changeAnnotations.manage(o),a=wa.create(e,r,i,s)),this._workspaceEdit.documentChanges.push(a),s!==void 0)return s},t.prototype.deleteFile=function(e,r,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var i;ma.is(r)||Ir.is(r)?i=r:n=r;var o,a;if(i===void 0?o=ya.create(e,n):(a=Ir.is(i)?i:this._changeAnnotations.manage(i),o=ya.create(e,n,a)),this._workspaceEdit.documentChanges.push(o),a!==void 0)return a},t}(),R0;(function(t){function e(n){return{uri:n}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.uri)}t.is=r})(R0||(R0={}));var A0;(function(t){function e(n,i){return{uri:n,version:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.uri)&&le.integer(i.version)}t.is=r})(A0||(A0={}));var Ml;(function(t){function e(n,i){return{uri:n,version:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.uri)&&(i.version===null||le.integer(i.version))}t.is=r})(Ml||(Ml={}));var T0;(function(t){function e(n,i,o,a){return{uri:n,languageId:i,version:o,text:a}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.uri)&&le.string(i.languageId)&&le.integer(i.version)&&le.string(i.text)}t.is=r})(T0||(T0={}));var ui;(function(t){t.PlainText="plaintext",t.Markdown="markdown"})(ui||(ui={})),function(t){function e(r){var n=r;return n===t.PlainText||n===t.Markdown}t.is=e}(ui||(ui={}));var Xh;(function(t){function e(r){var n=r;return le.objectLiteral(r)&&ui.is(n.kind)&&le.string(n.value)}t.is=e})(Xh||(Xh={}));var k0;(function(t){t.Text=1,t.Method=2,t.Function=3,t.Constructor=4,t.Field=5,t.Variable=6,t.Class=7,t.Interface=8,t.Module=9,t.Property=10,t.Unit=11,t.Value=12,t.Enum=13,t.Keyword=14,t.Snippet=15,t.Color=16,t.File=17,t.Reference=18,t.Folder=19,t.EnumMember=20,t.Constant=21,t.Struct=22,t.Event=23,t.Operator=24,t.TypeParameter=25})(k0||(k0={}));var I0;(function(t){t.PlainText=1,t.Snippet=2})(I0||(I0={}));var D0;(function(t){t.Deprecated=1})(D0||(D0={}));var P0;(function(t){function e(n,i,o){return{newText:n,insert:i,replace:o}}t.create=e;function r(n){var i=n;return i&&le.string(i.newText)&&_r.is(i.insert)&&_r.is(i.replace)}t.is=r})(P0||(P0={}));var F0;(function(t){t.asIs=1,t.adjustIndentation=2})(F0||(F0={}));var N0;(function(t){function e(r){return{label:r}}t.create=e})(N0||(N0={}));var $0;(function(t){function e(r,n){return{items:r||[],isIncomplete:!!n}}t.create=e})($0||($0={}));var Bl;(function(t){function e(n){return n.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}t.fromPlainText=e;function r(n){var i=n;return le.string(i)||le.objectLiteral(i)&&le.string(i.language)&&le.string(i.value)}t.is=r})(Bl||(Bl={}));var M0;(function(t){function e(r){var n=r;return!!n&&le.objectLiteral(n)&&(Xh.is(n.contents)||Bl.is(n.contents)||le.typedArray(n.contents,Bl.is))&&(r.range===void 0||_r.is(r.range))}t.is=e})(M0||(M0={}));var B0;(function(t){function e(r,n){return n?{label:r,documentation:n}:{label:r}}t.create=e})(B0||(B0={}));var O0;(function(t){function e(r,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var a={label:r};return le.defined(n)&&(a.documentation=n),le.defined(i)?a.parameters=i:a.parameters=[],a}t.create=e})(O0||(O0={}));var Ds;(function(t){t.Text=1,t.Read=2,t.Write=3})(Ds||(Ds={}));var U0;(function(t){function e(r,n){var i={range:r};return le.number(n)&&(i.kind=n),i}t.create=e})(U0||(U0={}));var Qh;(function(t){t.File=1,t.Module=2,t.Namespace=3,t.Package=4,t.Class=5,t.Method=6,t.Property=7,t.Field=8,t.Constructor=9,t.Enum=10,t.Interface=11,t.Function=12,t.Variable=13,t.Constant=14,t.String=15,t.Number=16,t.Boolean=17,t.Array=18,t.Object=19,t.Key=20,t.Null=21,t.EnumMember=22,t.Struct=23,t.Event=24,t.Operator=25,t.TypeParameter=26})(Qh||(Qh={}));var Yh;(function(t){t.Deprecated=1})(Yh||(Yh={}));var L0;(function(t){function e(r,n,i,o,a){var s={name:r,kind:n,location:{uri:o,range:i}};return a&&(s.containerName=a),s}t.create=e})(L0||(L0={}));var H0;(function(t){function e(n,i,o,a,s,c){var l={name:n,detail:i,kind:o,range:a,selectionRange:s};return c!==void 0&&(l.children=c),l}t.create=e;function r(n){var i=n;return i&&le.string(i.name)&&le.number(i.kind)&&_r.is(i.range)&&_r.is(i.selectionRange)&&(i.detail===void 0||le.string(i.detail))&&(i.deprecated===void 0||le.boolean(i.deprecated))&&(i.children===void 0||Array.isArray(i.children))&&(i.tags===void 0||Array.isArray(i.tags))}t.is=r})(H0||(H0={}));var Mn;(function(t){t.Empty="",t.QuickFix="quickfix",t.Refactor="refactor",t.RefactorExtract="refactor.extract",t.RefactorInline="refactor.inline",t.RefactorRewrite="refactor.rewrite",t.Source="source",t.SourceOrganizeImports="source.organizeImports",t.SourceFixAll="source.fixAll"})(Mn||(Mn={}));var q0;(function(t){function e(n,i){var o={diagnostics:n};return i!=null&&(o.only=i),o}t.create=e;function r(n){var i=n;return le.defined(i)&&le.typedArray(i.diagnostics,Nl.is)&&(i.only===void 0||le.typedArray(i.only,le.string))}t.is=r})(q0||(q0={}));var W0;(function(t){function e(n,i,o){var a={title:n},s=!0;return typeof i=="string"?(s=!1,a.kind=i):ks.is(i)?a.command=i:a.edit=i,s&&o!==void 0&&(a.kind=o),a}t.create=e;function r(n){var i=n;return i&&le.string(i.title)&&(i.diagnostics===void 0||le.typedArray(i.diagnostics,Nl.is))&&(i.kind===void 0||le.string(i.kind))&&(i.edit!==void 0||i.command!==void 0)&&(i.command===void 0||ks.is(i.command))&&(i.isPreferred===void 0||le.boolean(i.isPreferred))&&(i.edit===void 0||Zh.is(i.edit))}t.is=r})(W0||(W0={}));var z0;(function(t){function e(n,i){var o={range:n};return le.defined(i)&&(o.data=i),o}t.create=e;function r(n){var i=n;return le.defined(i)&&_r.is(i.range)&&(le.undefined(i.command)||ks.is(i.command))}t.is=r})(z0||(z0={}));var j0;(function(t){function e(n,i){return{tabSize:n,insertSpaces:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.uinteger(i.tabSize)&&le.boolean(i.insertSpaces)}t.is=r})(j0||(j0={}));var V0;(function(t){function e(n,i,o){return{range:n,target:i,data:o}}t.create=e;function r(n){var i=n;return le.defined(i)&&_r.is(i.range)&&(le.undefined(i.target)||le.string(i.target))}t.is=r})(V0||(V0={}));var G0;(function(t){function e(n,i){return{range:n,parent:i}}t.create=e;function r(n){var i=n;return i!==void 0&&_r.is(i.range)&&(i.parent===void 0||t.is(i.parent))}t.is=r})(G0||(G0={}));var AD=null,K0;(function(t){function e(o,a,s,c){return new bR(o,a,s,c)}t.create=e;function r(o){var a=o;return!!(le.defined(a)&&le.string(a.uri)&&(le.undefined(a.languageId)||le.string(a.languageId))&&le.uinteger(a.lineCount)&&le.func(a.getText)&&le.func(a.positionAt)&&le.func(a.offsetAt))}t.is=r;function n(o,a){for(var s=o.getText(),c=i(a,function(b,y){var w=b.range.start.line-y.range.start.line;return w===0?b.range.start.character-y.range.start.character:w}),l=s.length,u=c.length-1;u>=0;u--){var f=c[u],h=o.offsetAt(f.range.start),p=o.offsetAt(f.range.end);if(p<=l)s=s.substring(0,h)+f.newText+s.substring(p,s.length);else throw new Error("Overlapping edit");l=h}return s}t.applyEdits=n;function i(o,a){if(o.length<=1)return o;var s=o.length/2|0,c=o.slice(0,s),l=o.slice(s);i(c,a),i(l,a);for(var u=0,f=0,h=0;u<c.length&&f<l.length;){var p=a(c[u],l[f]);p<=0?o[h++]=c[u++]:o[h++]=l[f++]}for(;u<c.length;)o[h++]=c[u++];for(;f<l.length;)o[h++]=l[f++];return o}})(K0||(K0={}));var bR=function(){function t(e,r,n,i){this._uri=e,this._languageId=r,this._version=n,this._content=i,this._lineOffsets=void 0}return Object.defineProperty(t.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),t.prototype.getText=function(e){if(e){var r=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(r,n)}return this._content},t.prototype.update=function(e,r){this._content=e.text,this._version=r,this._lineOffsets=void 0},t.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var e=[],r=this._content,n=!0,i=0;i<r.length;i++){n&&(e.push(i),n=!1);var o=r.charAt(i);n=o==="\r"||o===`
`,o==="\r"&&i+1<r.length&&r.charAt(i+1)===`
`&&i++}n&&r.length>0&&e.push(r.length),this._lineOffsets=e}return this._lineOffsets},t.prototype.positionAt=function(e){e=Math.max(Math.min(e,this._content.length),0);var r=this.getLineOffsets(),n=0,i=r.length;if(i===0)return $n.create(0,e);for(;n<i;){var o=Math.floor((n+i)/2);r[o]>e?i=o:n=o+1}var a=n-1;return $n.create(a,e-r[a])},t.prototype.offsetAt=function(e){var r=this.getLineOffsets();if(e.line>=r.length)return this._content.length;if(e.line<0)return 0;var n=r[e.line],i=e.line+1<r.length?r[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)},Object.defineProperty(t.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),t}(),le;(function(t){var e=Object.prototype.toString;function r(p){return typeof p!="undefined"}t.defined=r;function n(p){return typeof p=="undefined"}t.undefined=n;function i(p){return p===!0||p===!1}t.boolean=i;function o(p){return e.call(p)==="[object String]"}t.string=o;function a(p){return e.call(p)==="[object Number]"}t.number=a;function s(p,b,y){return e.call(p)==="[object Number]"&&b<=p&&p<=y}t.numberRange=s;function c(p){return e.call(p)==="[object Number]"&&-2147483648<=p&&p<=2147483647}t.integer=c;function l(p){return e.call(p)==="[object Number]"&&0<=p&&p<=2147483647}t.uinteger=l;function u(p){return e.call(p)==="[object Function]"}t.func=u;function f(p){return p!==null&&typeof p=="object"}t.objectLiteral=f;function h(p,b){return Array.isArray(p)&&p.every(b)}t.typedArray=h})(le||(le={}));var Ps;(function(t){function e(n){return typeof n=="string"||n instanceof String}t.string=e;function r(n){return typeof n=="number"||n instanceof Number}t.number=r})(Ps||(Ps={}));var Jh;(function(t){function e(r){const n=r;return n!=null&&(Ps.number(n.value)||Ps.string(n.value))&&Ps.string(n.target)}t.is=e})(Jh||(Jh={}));class _R extends d.Diagnostic{constructor(e,r,n,i){super(e,r,n);this.data=i,this.hasDiagnosticCode=!1}}var Bn;(function(t){const e=Object.prototype.toString;function r(u){return typeof u!="undefined"}t.defined=r;function n(u){return u===!0||u===!1}t.boolean=n;function i(u){return e.call(u)==="[object String]"}t.string=i;function o(u){return e.call(u)==="[object Number]"}t.number=o;function a(u){return u!==null&&typeof u=="object"}t.objectLiteral=a;function s(u){return Array.isArray(u)}t.array=s;function c(u){return s(u)&&u.every(f=>i(f))}t.stringArray=c;function l(u,f){return Array.isArray(u)&&u.every(f)}t.typedArray=l})(Bn||(Bn={}));var Ol;(function(t){function e(r){const n=r;return n&&Bn.string(n.language)&&Bn.string(n.value)}t.is=e})(Ol||(Ol={}));function xR(t){const e=U=>d.Uri.parse(U),r=t!=null?t:e;function n(U){return r(U)}function i(U){return U.map(o)}function o(U){const Ce=new _R(f(U.range),U.message,p(U.severity),U.data);return U.code!==void 0&&(Kh.is(U.codeDescription)?Ce.code={value:U.code,target:n(U.codeDescription.href)}:Jh.is(U.code)?(Ce.hasDiagnosticCode=!0,Ce.code={value:U.code.value,target:n(U.code.target)}):Ce.code=U.code),U.source&&(Ce.source=U.source),U.relatedInformation&&(Ce.relatedInformation=a(U.relatedInformation)),Array.isArray(U.tags)&&(Ce.tags=c(U.tags)),Ce}function a(U){return U.map(s)}function s(U){return new d.DiagnosticRelatedInformation(G(U.location),U.message)}function c(U){if(!U)return;const Ce=[];for(const ut of U){const Sr=l(ut);Sr!==void 0&&Ce.push(Sr)}return Ce.length>0?Ce:void 0}function l(U){switch(U){case Fl.Unnecessary:return d.DiagnosticTag.Unnecessary;case Fl.Deprecated:return d.DiagnosticTag.Deprecated;default:return}}function u(U){if(!!U)return new d.Position(U.line,U.character)}function f(U){if(!!U)return new d.Range(u(U.start),u(U.end))}function h(U){return U.map(Ce=>f(Ce))}function p(U){if(U==null)return d.DiagnosticSeverity.Error;switch(U){case ga.Error:return d.DiagnosticSeverity.Error;case ga.Warning:return d.DiagnosticSeverity.Warning;case ga.Information:return d.DiagnosticSeverity.Information;case ga.Hint:return d.DiagnosticSeverity.Hint}return d.DiagnosticSeverity.Error}function b(U){if(Bn.string(U))return new d.MarkdownString(U);if(Ol.is(U))return new d.MarkdownString().appendCodeblock(U.value,U.language);if(Array.isArray(U)){const ut=[];for(const Sr of U){const sc=new d.MarkdownString;Ol.is(Sr)?sc.appendCodeblock(Sr.value,Sr.language):sc.appendMarkdown(Sr),ut.push(sc)}return ut}let Ce;switch(U.kind){case ui.Markdown:return new d.MarkdownString(U.value);case ui.PlainText:return Ce=new d.MarkdownString,Ce.appendText(U.value),Ce;default:return Ce=new d.MarkdownString,Ce.appendText(`Unsupported Markup content received. Kind is: ${U.kind}`),Ce}}function y(U){if(Bn.string(U))return U;switch(U.kind){case ui.Markdown:return new d.MarkdownString(U.value);case ui.PlainText:return U.value;default:return`Unsupported Markup content received. Kind is: ${U.kind}`}}function w(U){if(!!U)return new d.Hover(b(U.contents),f(U.range))}function _(U){if(!!U)return new d.TextEdit(f(U.range),U.newText)}function S(U){if(!!U)return U.map(_)}function I(U){if(!U)return;const Ce=new d.SignatureHelp;return Bn.number(U.activeSignature)?Ce.activeSignature=U.activeSignature:Ce.activeSignature=0,Bn.number(U.activeParameter)?Ce.activeParameter=U.activeParameter:Ce.activeParameter=0,U.signatures&&(Ce.signatures=D(U.signatures)),Ce}function D(U){return U.map(O)}function O(U){const Ce=new d.SignatureInformation(U.label);return U.documentation!==void 0&&(Ce.documentation=y(U.documentation)),U.parameters!==void 0&&(Ce.parameters=te(U.parameters)),U.activeParameter!==void 0&&(Ce.activeParameter=U.activeParameter),Ce}function te(U){return U.map(J)}function J(U){const Ce=new d.ParameterInformation(U.label);return U.documentation&&(Ce.documentation=y(U.documentation)),Ce}function G(U){if(!!U)return new d.Location(r(U.uri),f(U.range))}function ue(U){if(!!U)return ye(U)}function re(U){if(!!U)return ye(U)}function ae(U){if(!U)return;const Ce={targetUri:r(U.targetUri),targetRange:f(U.targetSelectionRange),originSelectionRange:f(U.originSelectionRange),targetSelectionRange:f(U.targetSelectionRange)};if(!Ce.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return Ce}function ye(U){if(!!U)return Bn.array(U)?U.length===0?[]:Pl.is(U[0])?U.map(Sr=>ae(Sr)):U.map(ut=>G(ut)):Pl.is(U)?[ae(U)]:G(U)}function dt(U){if(!!U)return U.map(Ce=>G(Ce))}function ne(U){if(!!U)return U.map(Se)}function Se(U){const Ce=new d.DocumentHighlight(f(U.range));return Bn.number(U.kind)&&(Ce.kind=ke(U.kind)),Ce}function ke(U){switch(U){case Ds.Text:return d.DocumentHighlightKind.Text;case Ds.Read:return d.DocumentHighlightKind.Read;case Ds.Write:return d.DocumentHighlightKind.Write}return d.DocumentHighlightKind.Text}function Te(U,Ce){if(!!U)return U.map(ut=>yt(ut,Ce))}function ze(U){return U<=Qh.TypeParameter?U-1:d.SymbolKind.Property}function Ze(U){switch(U){case Yh.Deprecated:return d.SymbolTag.Deprecated;default:return}}function nt(U){if(U==null)return;const Ce=[];for(const ut of U){const Sr=Ze(ut);Sr!==void 0&&Ce.push(Sr)}return Ce.length===0?void 0:Ce}function yt(U,Ce){const ut=new d.SymbolInformation(U.name,ze(U.kind),f(U.location.range),U.location.uri?r(U.location.uri):Ce);return ve(ut,U),U.containerName&&(ut.containerName=U.containerName),ut}function Bt(U){if(U!=null)return U.map(un)}function un(U){var Ce;const ut=new d.DocumentSymbol(U.name,(Ce=U.detail)!=null?Ce:"",ze(U.kind),f(U.range),f(U.selectionRange));if(ve(ut,U),U.children!==void 0&&U.children.length>0){const Sr=[];for(const sc of U.children)Sr.push(un(sc));ut.children=Sr}return ut}function ve(U,Ce){U.tags=nt(Ce.tags),Ce.deprecated&&(U.tags?U.tags.includes(d.SymbolTag.Deprecated)||(U.tags=U.tags.concat(d.SymbolTag.Deprecated)):U.tags=[d.SymbolTag.Deprecated])}function Ie(U){const Ce={title:U.title,command:U.command};return U.arguments&&(Ce.arguments=U.arguments),Ce}function Oe(U){if(!!U)return U.map(Ie)}const Ne=new Map;Ne.set(Mn.Empty,d.CodeActionKind.Empty),Ne.set(Mn.QuickFix,d.CodeActionKind.QuickFix),Ne.set(Mn.Refactor,d.CodeActionKind.Refactor),Ne.set(Mn.RefactorExtract,d.CodeActionKind.RefactorExtract),Ne.set(Mn.RefactorInline,d.CodeActionKind.RefactorInline),Ne.set(Mn.RefactorRewrite,d.CodeActionKind.RefactorRewrite),Ne.set(Mn.Source,d.CodeActionKind.Source),Ne.set(Mn.SourceOrganizeImports,d.CodeActionKind.SourceOrganizeImports);function Ve(U){if(U==null)return;let Ce=Ne.get(U);if(Ce)return Ce;const ut=U.split(".");Ce=d.CodeActionKind.Empty;for(const Sr of ut)Ce=Ce.append(Sr);return Ce}function tt(U){if(U!=null)return U.map(Ce=>Ve(Ce))}function et(U){if(U==null)return;const Ce=new d.CodeAction(U.title);return U.kind!==void 0&&(Ce.kind=Ve(U.kind)),U.diagnostics&&(Ce.diagnostics=i(U.diagnostics)),U.edit&&(Ce.edit=bt(U.edit)),U.command&&(Ce.command=Ie(U.command)),U.isPreferred!==void 0&&(Ce.isPreferred=U.isPreferred),Ce}function bt(U){if(!U)return;const Ce=new d.WorkspaceEdit;return U.documentChanges?U.documentChanges.forEach(ut=>{if(va.is(ut))Ce.createFile(r(ut.uri),ut.options);else if(wa.is(ut))Ce.renameFile(r(ut.oldUri),r(ut.newUri),ut.options);else if(ya.is(ut))Ce.deleteFile(r(ut.uri),ut.options);else if(Is.is(ut))Ce.set(r(ut.textDocument.uri),S(ut.edits));else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(ut,void 0,4)}`)}):U.changes&&Object.keys(U.changes).forEach(ut=>{Ce.set(r(ut),S(U.changes[ut]))}),Ce}function zt(U){return new d.Color(U.red,U.green,U.blue,U.alpha)}function er(U){return new d.ColorInformation(f(U.range),zt(U.color))}function Dr(U){if(Array.isArray(U))return U.map(er)}function vi(U){const Ce=new d.ColorPresentation(U.label);return Ce.additionalTextEdits=S(U.additionalTextEdits),U.textEdit&&(Ce.textEdit=_(U.textEdit)),Ce}function gu(U){if(Array.isArray(U))return U.map(vi)}function Da(U){if(U)switch(U){case Ts.Comment:return d.FoldingRangeKind.Comment;case Ts.Imports:return d.FoldingRangeKind.Imports;case Ts.Region:return d.FoldingRangeKind.Region}}function dn(U){return new d.FoldingRange(U.startLine,U.endLine,Da(U.kind))}function rp(U){if(Array.isArray(U))return U.map(dn)}function np(U){return new d.SelectionRange(f(U.range),U.parent?np(U.parent):void 0)}function rD(U){if(!Array.isArray(U))return[];const Ce=[];for(const ut of U)Ce.push(np(ut));return Ce}return{asUri:n,asDiagnostics:i,asDiagnostic:o,asRange:f,asRanges:h,asPosition:u,asDiagnosticSeverity:p,asDiagnosticTag:l,asHover:w,asTextEdit:_,asTextEdits:S,asSignatureHelp:I,asSignatureInformations:D,asSignatureInformation:O,asParameterInformations:te,asParameterInformation:J,asDeclarationResult:ue,asDefinitionResult:re,asLocation:G,asReferences:dt,asDocumentHighlights:ne,asDocumentHighlight:Se,asDocumentHighlightKind:ke,asSymbolKind:ze,asSymbolTag:Ze,asSymbolTags:nt,asSymbolInformations:Te,asSymbolInformation:yt,asDocumentSymbols:Bt,asDocumentSymbol:un,asCommand:Ie,asCommands:Oe,asCodeAction:et,asCodeActionKind:Ve,asCodeActionKinds:tt,asWorkspaceEdit:bt,asFoldingRangeKind:Da,asFoldingRange:dn,asFoldingRanges:rp,asColor:zt,asColorInformation:er,asColorInformations:Dr,asColorPresentation:vi,asColorPresentations:gu,asSelectionRange:np,asSelectionRanges:rD}}const ar=(0,mR.loadMessageBundle)();var On;(function(t){function e(n,i){const{provider:o,repo:a}=i instanceof d.Uri?n.getVirtualUriMetadata(i):i;return n.getRemoteUri(o.id,{repo:a})}t.externalUri=e;function r(n,i){const{provider:o,repo:a}=i instanceof d.Uri?n.getVirtualUriMetadata(i):i;return n.getRemoteUri(o.id,{repo:a})}t.externalIndexUri=r})(On||(On={}));var di;(function(t){function e(i){if(i.HEAD.type===Le.Branch||i.HEAD.type===Le.RemoteBranch)return i.HEAD.name}t.getBranchName=e;function r(i){if(i.HEAD.type===Le.Branch)return i.HEAD.name}t.getIndexBranchName=r;async function n(i,o,a=dr.timeout){const s=await i.getMetadata(o),c=On.externalIndexUri(i,s),l=t.getIndexBranchName(s);if(!(c===void 0||l===void 0))return dr.getIndexedTip(i.getAuthentication(o),c,l,a)}t.getIndexedTip=n})(di||(di={}));var Fs;(function(t){const e=new $i(1024);function r(a,s,c){let l=e.get(c);return l!==void 0||(l=a.getCommit(s,c),e.set(c,l)),l}t.get=r;async function n(a,s,c){const l=[];for(const f of c)l.push(r(a,s,f));const u=[];for(const f of await Promise.all(l))f!==void 0&&u.push(f);return u}t.all=n;function i(a,s){const c=a.commitDate,l=s.commitDate;return c===void 0&&l===void 0?0:c===void 0?1:l===void 0?-1:c<l?1:c>l?-1:0}t.sort=i;function o(a){const s=a.authorName!==void 0?`  \u2022  ${a.authorName}`:"",c=a.commitDate!==void 0?`  \u2022  ${Rs(a.commitDate,{ago:!0})}`:"",l=a.branchName!==void 0?` - ${a.branchName}`:"",u=a.tags!==void 0?typeof a.tags=="string"?`  \u2022  ${a.tags}`:`  \u2022  ${a.tags.join(" ")}`:"";return{author:s,date:c,branch:l,tag:u}}t.getCommitInfo=o})(Fs||(Fs={}));var Z0;(function(t){t[t.Unknown=0]="Unknown",t[t.New=1]="New",t[t.Failed=2]="Failed",t[t.Partial=3]="Partial",t[t.InProgress=4]="InProgress",t[t.Complete=5]="Complete",t[t.PartialIndex=6]="PartialIndex",t[t.CompleteIndex=7]="CompleteIndex"})(Z0||(Z0={}));var Ul;(function(t){function e(n){return{workspaceId:n.WorkspaceId,snapshotId:n.SnapshotId,state:n.State,commitId:n.commitId.toLowerCase(),branchName:r(n.BranchName),creationDate:new Date(n._ts*1e3)}}t.asWorkspaceSnapshot=e;function r(n){if(n!==null)return n.startsWith("refs/heads/")?n.substr(11):n}})(Ul||(Ul={}));var dr;(function(t){t.timeout=5*60*1e3;const e=new $i(32),r=new $i(32);async function n(f,h,p,b=t.timeout){const y=await i(f,h,p,b);if(!(y===void 0||y.length===0))return y[0]}t.getIndexedTip=n;async function i(f,h,p,b=t.timeout){const y=a(h,p);let w=e.get(y);if(w===void 0||w!==void 0&&Date.now()-w.time>b){const _=an.getAllWorkspaceSnapshots(f,h,s(p));w={time:Date.now(),promise:_,snapshots:void 0},e.set(y,w)}if(w.snapshots!==null){if(w.snapshots===void 0){let _=await w.promise;if(_===void 0){w.snapshots=null;return}_.sort((S,I)=>I.creationDate.getTime()-S.creationDate.getTime()),_=_.filter(S=>S.state===5),w.snapshots=_}return w.snapshots}}t.all=i;async function o(f,h,p,b,y=t.timeout){const w=h.toString();let _=r.get(w);if(_===null)return;if(_!==void 0)return _;const S=a(h,b),I=e.get(S);if(I!==void 0&&Date.now()-I.time<=y){if(I.snapshots===null)return;const D=I.snapshots!==void 0?I.snapshots:await i(f,h,b);if(D!==void 0){for(const O of D)if(O.commitId===p)return O}return}if(_=await an.getWorkspaceSnapshot(f,p),_===void 0){r.set(w,null);return}return r.set(w,_),_}t.single=o;function a(f,h){return h!==void 0?`${h}\\${f.toString()}`:f.toString()}function s(f){return f===void 0||f.startsWith("refs/heads/")?f:`refs/heads/${f}`}async function c(f,h,p,b=t.timeout){return await o(f,h,p,void 0,b)!==void 0}t.exists=c;async function l(f,h,p,b=t.timeout){return await i(f,h,p,b)!==void 0}t.branch=l;async function u(f,h,p){const b=new Map(p.map(_=>[_.commitId,_])),y=await Fs.all(f,h.uri,p.map(_=>_.commitId));if(y.length===0)return;const w=[];for(const _ of y){const S=b.get(_.hash);S!==void 0&&w.push({...S,commit:_})}if(w.length!==0)return w}t.resolve=u})(dr||(dr={}));var Un;(function(t){function e(r=!1){return{hoverProvider:r,declarationProvider:r,definitionProvider:r,typeDefinitionProvider:r,referencesProvider:r,documentSymbolProvider:r,foldingRangeProvider:r,diagnosticProvider:r}}t.create=e})(Un||(Un={}));var an;(function(t){const e="v0.1",r="https://prod.richnav.vsengsaas.visualstudio.com/api";async function n(_,S,I){const D=await on(S,{method:"POST",body:JSON.stringify(I),headers:{"Content-Type":"application/json",...(await _).getRichNavigationHeaders()}});if(!!D.ok)return D.json()}async function i(_,S,I){const D=await on(S,{method:"POST",body:I,headers:(await _).getRichNavigationHeaders()});if(!!D.ok)return await D.json()}function o(_,S){return`${r}/${e}/HttpLanguageService/${_}/${S}`}async function a(_,S){const I=await on(`${r}/${e}/WorkspaceSnapshot?commitId=${S}`,{headers:(await _).getRichNavigationHeaders()});if(I.ok){const D=await I.json();return{workspaceId:D.workspaceId,snapshotId:D.snapshotId,state:D.state,commitId:S.toLowerCase(),branchName:void 0,creationDate:new Date}}}t.getWorkspaceSnapshot=a;async function s(_,S,I){const D=new s0;D.append("uriString",S.toString(!0)),I!==void 0&&D.append("branchName",I);try{const O=await i(_,`${r}/${e}/WorkspaceSnapshot/all`,D);return O===void 0?void 0:O.map(Ul.asWorkspaceSnapshot)}catch(O){Z.error(O);return}}t.getAllWorkspaceSnapshots=s;async function c(_,S,I){const D=new s0;D.append("uriString",S.toString(!0)),I!==void 0&&D.append("branchName",I);try{const O=await i(_,`${r}/${e}/WorkspaceSnapshot/latest`,D);return O===void 0?void 0:Ul.asWorkspaceSnapshot(O)}catch(O){Z.error(O);return}}t.getLatestWorkspaceSnapshot=c;async function l(_,S,I){try{return n(_,o(S,"textDocument/capabilities"),I)}catch(D){Z.error(D);return}}t.capabilities=l;async function u(_,S,I){try{return n(_,o(S,"textDocument/hover"),I)}catch(D){Z.error(D);return}}t.provideHover=u;async function f(_,S,I){try{return n(_,o(S,"textDocument/definition"),I)}catch(D){Z.error(D);return}}t.provideDefinition=f;async function h(_,S,I){try{return n(_,o(S,"textDocument/declaration"),I)}catch(D){Z.error(D);return}}t.provideDeclaration=h;async function p(_,S,I){try{return n(_,o(S,"textDocument/typeDefinition"),I)}catch(D){Z.error(D);return}}t.provideTypeDefinition=p;async function b(_,S,I){try{return n(_,o(S,"textDocument/references"),I)}catch(D){Z.error(D);return}}t.provideReferences=b;async function y(_,S,I){try{return n(_,o(S,"textDocument/foldingRange"),I)}catch(D){Z.error(D);return}}t.providerFoldingRanges=y;async function w(_,S,I){const D=d.Uri.from({scheme:"https",authority:"prod.richnav.vsengsaas.visualstudio.com",path:`/api/${e}/Workspace/${_}/${S}/assets/designtime`,query:`id=${I}`});try{const O=await on(D.toString().replace("?id%3D","?id="),{method:"GET",headers:{accept:"text/plain"}});return O.ok?O.text():void 0}catch(O){Z.error(O);return}}t.getDesignTimeFileContent=w})(an||(an={}));class SR{constructor(e){this.providerService=e,this.metadata=new Map,this.providerService.onDidChangeRepositories(r=>{for(const n of r.added){const i=n.uri,o=Je.getIndexMemento(i);if(o!==void 0){const a=On.externalIndexUri(this.providerService,i);a!==void 0&&(typeof o.branchName=="string"?dr.all(this.providerService.getAuthentication(i),a,o.branchName).catch(void 0):typeof o.ref=="string"&&yi(o.ref)&&dr.single(this.providerService.getAuthentication(i),a,o.ref).catch(void 0))}this.providerService.getMetadata(i).then(a=>{const s={},c=di.getIndexBranchName(a);c!==void 0?s.branchName=c:s.ref=a.HEAD.sha,Je.setIndexMemento(i,s).then(void 0,void 0)},void 0)}}),this.providerService.onDidChangeRepository(r=>{const n=r.repository.uri,i=we(n);this.metadata.delete(i),this.getIndexMetadata(n).catch(void 0)})}async resolveIndexRef(e,r){const n=await this.providerService.getModeRefType(e),i=Qi.decode(e);if(i!==void 0){if(i.type===Kr.Latest)return n===q.Branch?this.getIndexedTip(e,r?0:dr.timeout):void 0;if(i.type===Kr.SHA){const a=On.externalIndexUri(this.providerService,e);return a===void 0?void 0:await dr.exists(this.providerService.getAuthentication(e),a,i.sha,r?0:dr.timeout)?i.sha:void 0}}if(this.providerService.getModeConfig(e,n).index===T.Latest)return this.getIndexedTip(e,r?0:dr.timeout)}refresh(e){for(const r of e)this.metadata.delete(r.toString())}getIndexMetadata(e){const r=this.providerService.getVirtualRootUri(e),n=we(r);let i=this.metadata.get(n);return i!==void 0||(i=this.createIndexMetadata(e),this.metadata.set(n,i)),i}async getIndexedTip(e,r=dr.timeout){const n=await di.getIndexedTip(this.providerService,e,r);return n!==void 0?n.commitId:void 0}async createIndexMetadata(e){const r=new $e(`RichNavIndexProvider.createIndexMetadata(${e.toString()})`);try{const n=On.externalIndexUri(this.providerService,e);if(n===void 0)return;r.logStep("Getting metadata");const i=this.providerService.getMetadata(e),o=this.providerService.getModeRefType(e,i),a=await i;r.logStep("Getting snapshot",{suffix:" \u2022 Getting snapshot..."});const s=this.providerService.getAuthentication(e),c=di.getIndexBranchName(a),l=await dr.single(s,n,a.HEAD.sha,c);if(a.HEAD.type===Le.Branch||a.HEAD.type===Le.RemoteBranch){const p=Qi.decode(e);if(p!==void 0)return r.logStep("Handle legacy encoding",{suffix:" \u2022 Handle legacy encoding..."}),l===void 0?p.type===Kr.Latest?(r.logStep("Getting branch snapshot",{suffix:" \u2022 Getting branch snapshot..."}),await dr.branch(s,n,a.HEAD.name)?{type:vt.Indexed}:{type:vt.NotIndexed}):{type:vt.NotIndexed}:p.type===Kr.Latest||p.type===Kr.SHA?{type:vt.Active,sha:Promise.resolve(l.commitId),branch:{name:l.branchName}}:{type:vt.Match,sha:Promise.resolve(l.commitId),branch:{name:l.branchName}}}r.logStep("Getting mode config",{suffix:" \u2022 Getting mode config..."});const f=this.providerService.getModeConfig(e,await o),h=this.providerService.getVirtualUriMetadata(e);if((f.index===T.Latest||f.index===T.Match)&&l!==void 0)return{type:vt.Active,sha:Promise.resolve(l.commitId),branch:{name:l.branchName}};if(f.index===T.TipPlusLatest&&h.provider.id===Ur.GitHub){if(l!==void 0&&l.commitId===a.HEAD.sha)return{type:vt.Active,sha:Promise.resolve(l.commitId),branch:{name:l.branchName}};if(a.HEAD.type===Le.Branch&&c!==void 0){r.logStep("Getting closest index",{suffix:" \u2022 Getting closest index..."});const p=await dr.all(s,n,c);if(p!==void 0&&p.length>0)return{type:vt.Active,sha:this.computeClosestIndex(e,a.HEAD.sha,p),branch:{name:c}}}}if(l!==void 0)return{type:vt.Indexed};if(a.HEAD.type===Le.Branch){const p=di.getIndexBranchName(a);if(r.logStep("Getting branch snapshot",{suffix:" \u2022 Getting branch snapshot..."}),p!==void 0&&await dr.branch(s,n,p))return{type:vt.Indexed}}return{type:vt.NotIndexed}}finally{r.stop()}}async computeClosestIndex(e,r,n){if(n.length===0)throw new Error("At least on snapshot should exist");const i=new Set(n.map(u=>u.commitId)),o=await this.providerService.getCommits(e,{ref:r,limit:100});if(o===void 0)return;let a;for(const u of o.commits)if(u.hash===r){a=u;break}if(a===void 0)return;const s=new Map(o.commits.map(u=>[u.hash,u])),c=[a];let l;for(;c.length>0;){for(l=c.shift();l!==void 0&&!i.has(l.hash);)if(l.parents.length>0){for(let u=1;u<l.parents.length;u++){const f=s.get(l.parents[u]);f!==void 0&&c.push(f)}l=s.get(l.parents[0])}if(l!==void 0)break}return l!==void 0?l.hash:void 0}async getSnapshots(e,r){const n=On.externalIndexUri(this.providerService,e);if(n===void 0)return[];const i=await dr.all(this.providerService.getAuthentication(e),n);if(i===void 0)return[];const o=[];for(const a of i)a.branchName!==void 0&&o.push({workspaceId:a.workspaceId,snapshotId:a.snapshotId,hash:a.commitId,branch:{name:a.branchName}});return o}async getStatusBarContributions(e){const r=await this.providerService.getMetadata(e),[n,i]=await Promise.all([this.getIndexMetadata(e),this.providerService.getModeRefType(e,r)]),o=this.providerService.getModeConfig(e,i);if(n===void 0)return[];const{HEAD:a}=r,s=[];if(n!==void 0){let c;const l=[`${fr(a.sha)}`];if(n.type===vt.Active){const u=await n.sha;o.index===T.Latest||o.index===T.Match?(c=o.display===N.Browse?"$(layers-active)\u2009\u2009$(lock)":"$(layers-active)",l.push(ar("statusbar.active",`The commit is indexed and rich code navigation features are enabled.
The files in the workspace are readonly.`))):o.index===T.TipPlusLatest&&(c="$(layers-dot)",u!==r.HEAD.sha?l.push(ar("statusbar.tipPlusLatest","The commit is not indexed. Rich code navigation features are enabled using a former indexed commit which might lead to fuzzy results.")):l.push(ar("statusbar.tipPlusLatest","The commit is indexed. Rich code navigation features are enabled. Files in the workspace can be modified which might lead to fuzzy results.")))}else n.type===vt.Match?(c="$(layers)",l.push(ar("statusbar.match",`The commit you are on is indexed, but rich navigation is not enabled.
Click the status bar item to enable it.`))):n.type===vt.Indexed&&(c="$(layers)",l.push(ar("statusbar.indexed",`The branch you are on is indexed, but rich navigation is not enabled.
Click the status bar item to enable it.`)));c&&s.push(yn({command:"remoteHub.indexMode.select",title:c,tooltip:l.join(`
`),arguments:[{uri:e}]}))}return s}}var wo;(function(t){let e;function r(){return e=d.window.createStatusBarItem(d.StatusBarAlignment.Right),e.text="$(compass)",e.command="remoteHub.indexMode.select",e.hide(),[e,d.window.onDidChangeActiveTextEditor(()=>{c()}),d.commands.registerCommand("remoteHub.indexMode.select",u=>{l(u).catch(f=>Z.log("Selecting index mode failed.",f))})]}t.create=r;const n=new Map;function i(u){n.set(u.key(),u)}t.addService=i;function o(u){n.delete(u.key())}t.removeService=o;function a(u){return n.get(we(u))}async function s(u){for(const f of n.values())if(await f.handles(u))return f}async function c(){try{let u=function(b){const y=b.lastIndexOf("/");return y<=0?b:b.substr(y+1)};const f=d.window.activeTextEditor;if(f===void 0){e.hide();return}const h=await s(f.document);if(h===void 0){e.hide();return}const p=await h.isDocumentIndexed(f.document);p===Ll.Indexed?(e.text="$(compass)",e.tooltip=new d.MarkdownString(ar("isIndexed","The source file '{0}' is indexed and provides rich code navigation features like Go to Declaration and Find all References.",u(f.document.uri.path))),e.show()):p===Ll.IndexMapped?(e.text="$(compass-dot)",e.tooltip=new d.MarkdownString(ar("isIndexed","The source file '{0}' provides rich code navigation features using an earlier indexed commit. Navigation results might be fuzzy.",u(f.document.uri.path))),e.show()):e.hide()}catch(u){e.hide()}}t.updateStatusBarItem=c;async function l(u){const f=u.uri,h=a(f);if(h===void 0)return;const[p,b,y,w]=await Promise.all([h.getBranchName(),h.getMetadata(),h.getIndexMetadata(),h.getModeRefType(f)]);if(y===void 0||!vt.hasIndex(y.type))return;let _,S=!1;const I=Qi.decode(f);(I==null?void 0:I.type)===Kr.Latest||(I==null?void 0:I.type)===Kr.SHA?(S=!0,_={display:N.Browse,index:I.type===Kr.Latest?T.Latest:T.Match}):_=h.getModeConfig(f,w);const D=ar("current item","{0} current","$(check)"),O={kind:"disable",label:ar("RichNavStatus.disable.label","Disable"),description:_.index===T.None?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.disable.detail","Disable rich navigation. Files will be writable.")},te=h.getUriMetadata();let J,G;if(w===q.PullRequestBranch||w===q.PullRequestRemoteBranch||w===q.Commit||w===q.Tag){const ue={kind:"match",label:ar("RichNavStatus.match.label","Current indexed commit - readonly"),description:_.index===T.Match&&_.display===N.Browse?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.match.detail","Enable rich navigation only if the current commit is indexed. Files will be read-only.")},re={kind:"match+writeable",label:ar("RichNavStatus.matchWritable.label","Current indexed commit - writable"),description:_.index===T.Match&&_.display===N.Edit?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.match.detail","Enable rich navigation only if the current commit is indexed. Files will be writable.")};let ae=te.provider.id===Ur.GitHub;ae&&(ae=b.HEAD.type===Le.RemoteBranch?b.HEAD.branch.remote.accessLevel>=$t.Write:!0);const ye=ae?[ue,re,O]:[ue,O];G=await d.window.showQuickPick(ye,{placeHolder:"Pick a rich navigation mode"})}else if(w===q.Branch||w===q.RemoteBranch){const ue={kind:"latest",label:ar("RichNavStatus.latestIndexed.label","Latest indexed commit"),description:_.index===T.Latest?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.latestIndexed.detail","Enable rich navigation on the latest indexed commit. Files will be read-only.")},re={kind:"tip+latest",label:ar("RichNavStatus.matchLatestIndexed.label","Current commit & latest index"),description:_.index===T.TipPlusLatest?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.matchLatestIndexed.detail","Enable rich navigation on the current commit using the latest index. Files will be writeable.")},ae=te.provider.id===Ur.GitHub?[ue,re,O]:[ue,O];G=await d.window.showQuickPick(ae,{placeHolder:ar("RichNavStatus.placeHolder","Pick a rich navigation mode for branch {0}",p)})}if(G!==void 0&&(G.kind==="disable"?J={display:N.Edit,index:T.None}:G.kind==="match"?J={display:N.Browse,index:T.Match}:G.kind==="match+writeable"?J={display:N.Edit,index:T.Match}:G.kind==="tip+latest"?J={display:N.Edit,index:T.TipPlusLatest}:G.kind==="latest"&&(J={display:N.Browse,index:T.Latest}),J!==void 0&&!$.equals(_,J))){if(await h.hasChanges()&&J.display===N.Browse){await d.window.showInformationMessage("The repository has outgoing changes. Commit them first before switching to browse mode.",{modal:!0,useCustom:!0});return}if(J.index===T.Latest){const ue=await h.getIndexedTip();if(ue===void 0)return;await h.sync(ue.hash)}else J.index===T.TipPlusLatest&&await h.sync();if(await Je.setMode(f,J),S){const ue=await h.getNonIndexedWorkspaceDescriptor();ue!==void 0&&nn(ue)}else h.refresh()}}})(wo||(wo={}));class X0{static createStatus(){return wo.create()}async createNavigationService(e,r,n){const i=await e.getIndexMetadata(r.uri);if(!(i===void 0||i.type===vt.NotIndexed))return()=>new tf(e,r,n)}}var Ns;(function(t){const e=new RegExp("^vsck:\\/\\/([a-fA-F0-9]+)\\/(latest|[a-fA-F0-9]{15})\\/designtime\\/([a-fA-F0-9]+)(\\/?.*)$");function r(i){const o=e.exec(i);if(o===null||o.length!==5)return;const a={v:1,w:o[1],s:o[2],a:o[3]};return d.Uri.from({scheme:hi.scheme,authority:ku(JSON.stringify(a)),path:o[4]})}t.toVSCode=r;function n(i){if(i.scheme!==hi.scheme)return;let o;try{return o=JSON.parse(Lp(i.authority)),o===void 0?void 0:{workspaceId:o.w,snapshotId:o.s,assetId:`${o.a}${i.path}`}}catch{return}}t.toRichNavComponents=n})(Ns||(Ns={}));const ef=class{constructor(){this._onDidChangeFile=new d.EventEmitter,this.cache=new $i(64),this.textEncoder=new TextEncoder}get onDidChangeFile(){return this._onDidChangeFile.event}watch(t,e){return ef.emptyDisposable}async stat(t){const e=await this.getFile(t);if(e===void 0)throw d.FileSystemError.FileNotFound();return{type:d.FileType.File,mtime:e.time,ctime:e.time,size:e.content.length,permissions:d.FilePermission.Readonly}}readDirectory(t){return[]}createDirectory(t){throw d.FileSystemError.NoPermissions()}async readFile(t){const e=await this.getFile(t);if(e===void 0)throw d.FileSystemError.FileNotFound();return e.content}writeFile(t,e,r){throw d.FileSystemError.NoPermissions()}delete(t,e){throw d.FileSystemError.NoPermissions()}rename(t,e,r){throw d.FileSystemError.NoPermissions()}async getFile(t){let e=this.cache.get(t.toString());if(e!==void 0)return e;if(t.scheme!==ef.scheme)return;const r=Ns.toRichNavComponents(t);if(r===void 0)return;const n=await an.getDesignTimeFileContent(r.workspaceId,r.snapshotId,r.assetId);if(n!==void 0)return e={content:this.textEncoder.encode(n),time:Date.now()},this.cache.set(t.toString(),e),e}};let hi=ef;hi.scheme="vsck-fs",hi.emptyDisposable={dispose:()=>{}};var Ll;(function(t){t[t.NotIndexed=0]="NotIndexed",t[t.IndexMapped=1]="IndexMapped",t[t.Indexed=2]="Indexed"})(Ll||(Ll={}));const Ln=class{static registerCapability(t,e,r){var n;const i=this.disabledCapabilities.get(t);if(i==null?void 0:i[e])return!1;const o=this.localCapabilities.get(t);return(o==null?void 0:o[e])?!1:(n=r[e])!=null?n:!1}constructor(t,e,r){this.providerService=t,this.repository=e,this.changeStore=r,this.repositoryRoot=`${e.uri.toString()}/`;const n=(i=!1)=>{const o=this.repository.uri;i||(this.metadata=this.providerService.getMetadata(o),this.indexMetadata=this.providerService.getIndexMetadata(o)),Promise.all([this.metadata,this.indexMetadata,this.providerService.getModeRefType(o,this.metadata)]).then(async a=>{const[s,c,l]=this.currentlyResolved,[u,f,h]=a,p=this.providerService.getModeConfig(o,h);if(s!==void 0&&c!==void 0&&l!==void 0&&s.HEAD.sha===u.HEAD.sha&&f!==void 0&&c.type===f.type&&l.index===p.index&&l.display===p.display){const b=(c==null?void 0:c.type)===vt.Active?await c.sha:void 0,y=(f==null?void 0:f.type)===vt.Active?await f.sha:void 0;if(b===y)return}this.currentlyResolved=[u,f,p];for(const b of this.registeredFeatures.values())b.dispose();if(this.registeredFeatures.clear(),this.pendingCapabilitiesRequests.clear(),this.currentListeners!==void 0&&this.currentListeners.dispose(),this.workspaceSnapshot=void 0,this.mapper=void 0,wc.isActive(f)){const b=On.externalIndexUri(this.providerService,u),y=await f.sha;if(b!==void 0&&y!==void 0){const w=await dr.single(this.providerService.getAuthentication(o),b,y,di.getIndexBranchName(u));w!==void 0&&(this.workspaceSnapshot=w,this.currentListeners=this.installListeners(),((p==null?void 0:p.display)===N.Edit||u.HEAD.sha!==y)&&(this.mapper=new y0(this.providerService,o,y,u.HEAD.sha)))}}await wo.updateStatusBarItem()}).then(void 0,void 0)};this.metadata=this.providerService.getMetadata(this.repository.uri),this.indexMetadata=this.providerService.getIndexMetadata(this.repository.uri),this.currentlyResolved=[void 0,void 0,void 0],this.registeredFeatures=new Map,this.pendingCapabilitiesRequests=new Map,this.capabilitiesCache=new $i(2048),this.knownDesignTimeFiles=new Set,this.providerService.onDidChangeRepository(i=>{we(i.repository.uri)===we(this.repository.uri)&&n()}),this.providerService.onDidRefresh(i=>{for(const o of i)if(we(o)===we(this.repository.uri)){n();break}}),n(!0),wo.addService(this),this.indexMetadata.then(async i=>{const o=this.repository.uri;let a=!1;const s=Qi.decode(this.repository.uri);if(s!==void 0&&i!==void 0&&(s.type===Kr.Latest&&i.type!==vt.Active||s.type===Kr.SHA&&(i.type!==vt.Active||await i.sha!==s.sha))&&(a=!0),!a){const c=this.providerService.getModeConfig(o,await this.providerService.getModeRefType(o,this.metadata),!0);c!==void 0&&c.display===N.Browse&&i!==void 0&&c.index!==T.None&&i.type!==vt.Active?a=!0:(i==null?void 0:i.type)===vt.Active&&await i.sha===void 0&&((c==null?void 0:c.display)===N.Browse,a=!0)}a&&d.window.showWarningMessage(ar("RichNavService.latest.notIndexed","The repository got opened in rich code navigation mode but no corresponding index is available. Rich code navigation features are disabled.")).then(void 0,void 0)},void 0),Ln.fileSystemProvider===void 0&&(Ln.fileSystemProvider=new hi,d.workspace.registerFileSystemProvider(hi.scheme,Ln.fileSystemProvider))}key(){return we(this.repository.uri)}dispose(){for(const t of this.registeredFeatures.values())t.dispose();this.registeredFeatures.clear(),wo.removeService(this)}handles(t){return t.uri.scheme!==Pt.scheme?Promise.resolve(!1):Promise.resolve(t.uri.toString().startsWith(this.repositoryRoot))}async getBranchName(){return di.getBranchName(await this.metadata)}async getMetadata(){return this.metadata}async getIndexMetadata(){return this.indexMetadata}getUriMetadata(){return this.providerService.getVirtualUriMetadata(this.repository.uri)}getModeConfig(t,e){return this.providerService.getModeConfig(t,e)}getModeRefType(t){return this.providerService.getModeRefType(t)}refresh(){return this.providerService.refresh()}async getNonIndexedWorkspaceDescriptor(){const{name:t,repo:e}=await this.metadata,{ref:r}=this.providerService.getVirtualUriMetadata(this.repository.uri);return{name:t,uri:this.providerService.createVirtualUri(this.repository.uri,{repo:e,ref:r}),location:Tt.CurrentWindow}}async isDocumentIndexed(t){await this.metadata;const e=await this.indexMetadata;if(e===void 0||e.type===vt.NotIndexed||this.workspaceSnapshot===void 0)return 0;const r=this.pendingCapabilitiesRequests.get(t.uri.toString());return r!==void 0&&await r,this.registeredFeatures.has(t.uri.toString())?this.mapper===void 0?2:await this.mapper.needsMapping(t)?1:2:0}async getIndexedTip(){const t=await this.metadata,e=On.externalIndexUri(this.providerService,t),r=di.getIndexBranchName(t);if(e===void 0||r===void 0)return;const n=await dr.getIndexedTip(this.providerService.getAuthentication(this.repository.uri),e,r);if(n===void 0)return;const i=await Fs.get(this.providerService,this.repository.uri,n.commitId);if(i!==void 0)return{...i,branchName:r}}hasChanges(){return this.changeStore.hasChanges(this.repository.uri)}sync(t){return this.providerService.sync(this.repository.uri,this.changeStore,{to:t,reason:"user"})}async getCommit(t){const e=await this.metadata,r=On.externalIndexUri(this.providerService,e);if(r===void 0)return;const[n,i]=await Promise.all([Fs.get(this.providerService,this.repository.uri,t),dr.single(this.providerService.getAuthentication(this.repository.uri),r,t)]);if(!(n===void 0||i===void 0))return{...n,branchName:i.branchName}}installListeners(){const t=[],e=async r=>{const n=r.uri.scheme;if(Pt.scheme!==n&&hi.scheme!==n)return;const i=r.uri.toString();if(n===Pt.scheme&&!i.startsWith(this.repositoryRoot)||n===hi.scheme&&!this.knownDesignTimeFiles.has(i)||this.pendingCapabilitiesRequests.has(i))return;const o=this.workspaceSnapshot!==void 0?this.workspaceSnapshot.commitId:void 0;if(o===void 0)return;let a=this.capabilitiesCache.get(i);if(a!==null){if(a===void 0){const s=this.capabilities(r.uri);this.pendingCapabilitiesRequests.set(i,s),a=await s,this.pendingCapabilitiesRequests.delete(i),this.capabilitiesCache.set(i,a===void 0?null:a)}a===void 0||!d.workspace.textDocuments.some(s=>s===r)||this.registerProviders(r,a,o)}};return t.push(d.workspace.onDidOpenTextDocument(e)),d.workspace.textDocuments.forEach(e),t.push(d.workspace.onDidCloseTextDocument(r=>{const n=r.uri.toString(),i=this.registeredFeatures.get(n);i!==void 0&&(this.registeredFeatures.delete(r.uri.toString()),i.dispose()),this.pendingCapabilitiesRequests.delete(n)})),d.Disposable.from(...t)}registerProviders(t,e,r){if(this.workspaceSnapshot===void 0)return;const n=this.workspaceSnapshot,i=t.languageId,a=[{scheme:this.repository.uri.scheme,pattern:t.uri.fsPath,language:t.languageId,exclusive:!0}],s=[],c=new Promise((p,b)=>{const y=`vsck://${n.workspaceId}/${n.snapshotId}/source/`;this.metadata.then(w=>{p(xR(_=>{const S=d.Uri.parse(_);if(w===void 0)return S;try{if(_.startsWith(y))return this.repository.createRelativeUri(_.substr(y.length));const I=Ns.toVSCode(_);return I!==void 0?(this.knownDesignTimeFiles.add(I.toString()),I):S}catch(I){return S}}))},b)}),l=new RegExp(`^vsck:\\/\\/${n.workspaceId}\\/(?:latest|[a-fA-F0-9]{15})\\/designtime\\/(?:[a-fA-F0-9]+)(\\/?.*)$`);function u(p){const b=l.exec(p);return b===null||b.length===2}function f(p){if(p==null)return p;if(Array.isArray(p)){if(p.length===0)return[];const b=p[0];return typeof b.uri=="string"?p.filter(_=>u(_.uri)):typeof b.targetUri=="string"?p.filter(_=>u(_.targetUri)):[]}return l.exec(p.uri)===null?p:void 0}async function h(p,b,y){var w,_,S;if(y==null||p===void 0)return y;const I=new Map(d.workspace.textDocuments.map(O=>[O.uri.toString(!0),O]));if(Array.isArray(y)){const O=[],te=[];if(y.length===0)return[];for(const J of y){const G=J;if(G.uri instanceof d.Uri){const ue=await p.mapRangeFromIndexToCode((w=I.get(G.uri.toString()))!=null?w:G.uri,G.range);ue!==void 0&&O.push(new d.Location(G.uri,ue))}else{const ue=J,re=(_=I.get(ue.targetUri.toString()))!=null?_:ue.targetUri,ae=ue.originSelectionRange?await p.mapRangeFromIndexToCode(b,ue.originSelectionRange):void 0;if(ae!==void 0||ue.originSelectionRange===void 0){const ye=await p.mapRangeFromIndexToCode(re,ue.targetRange);if(ye!==void 0){const dt=ue.targetSelectionRange?await p.mapRangeFromIndexToCode(re,ue.targetSelectionRange):void 0;(dt!==void 0||ue.targetSelectionRange===void 0)&&te.push({targetUri:ue.targetUri,targetRange:ye,targetSelectionRange:dt,originSelectionRange:ae})}}}}return O.length>0?O:te}const D=await p.mapRangeFromIndexToCode((S=I.get(y.uri.toString()))!=null?S:y.uri,y.range);if(D!==void 0)return new d.Location(y.uri,D)}Ln.registerCapability(i,"hoverProvider",e)&&s.push(d.languages.registerHoverProvider(a,{provideHover:async(p,b)=>{const y=await this.createTextDocumentPositionParams(p,b);if(y!==void 0)return(await c).asHover(await an.provideHover(this.providerService.getAuthentication(p.uri),r,y))}})),Ln.registerCapability(i,"definitionProvider",e)&&s.push(d.languages.registerDefinitionProvider(a,{provideDefinition:async(p,b)=>{const y=await this.createTextDocumentPositionParams(p,b);if(y!==void 0)return h(this.mapper,p,(await c).asDefinitionResult(f(await an.provideDefinition(this.providerService.getAuthentication(p.uri),r,y))))}})),Ln.registerCapability(i,"declarationProvider",e)&&s.push(d.languages.registerDeclarationProvider(a,{provideDeclaration:async(p,b)=>{const y=await this.createTextDocumentPositionParams(p,b);if(y!==void 0)return h(this.mapper,p,(await c).asDeclarationResult(f(await an.provideDeclaration(this.providerService.getAuthentication(p.uri),r,y))))}})),Ln.registerCapability(i,"typeDefinitionProvider",e)&&s.push(d.languages.registerTypeDefinitionProvider(a,{provideTypeDefinition:async(p,b)=>{const y=await this.createTextDocumentPositionParams(p,b);if(y!==void 0)return h(this.mapper,p,(await c).asDefinitionResult(f(await an.provideTypeDefinition(this.providerService.getAuthentication(p.uri),r,y))))}})),Ln.registerCapability(i,"referencesProvider",e)&&s.push(d.languages.registerReferenceProvider(a,{provideReferences:async(p,b,y)=>{const w=this.mapper!==void 0?await this.mapper.mapPositionFromCodeToIndex(p,b):b;if(w===void 0)return;const _={position:{line:w.line,character:w.character},textDocument:{uri:this.createRichNavDocumentUri(p.uri).toString(!0)},context:{includeDeclaration:y.includeDeclaration}};return h(this.mapper,p,(await c).asReferences(f(await an.provideReferences(this.providerService.getAuthentication(p.uri),r,_))))}})),Ln.registerCapability(i,"foldingRangeProvider",e)&&s.push(d.languages.registerFoldingRangeProvider(a,{provideFoldingRanges:async p=>{if(!(this.mapper!==void 0&&await this.mapper.needsMapping(p)))return(await c).asFoldingRanges(await an.providerFoldingRanges(this.providerService.getAuthentication(p.uri),r,this.createTextDocumentParams(p.uri)))}})),this.registeredFeatures.set(t.uri.toString(),d.Disposable.from(...s)),wo.updateStatusBarItem()}async capabilities(t){var e;const r=this.workspaceSnapshot!==void 0?this.workspaceSnapshot.commitId:void 0;if(r!==void 0)return(e=await an.capabilities(this.providerService.getAuthentication(t),r,this.createTextDocumentParams(t)))!=null?e:void 0}createTextDocumentParams(t){return{textDocument:{uri:this.createRichNavDocumentUri(t).toString(!0)}}}async createTextDocumentPositionParams(t,e){const r=this.mapper!==void 0?await this.mapper.mapPositionFromCodeToIndex(t,e):e;if(r!==void 0)return{position:{line:r.line,character:r.character},textDocument:{uri:this.createRichNavDocumentUri(t.uri).toString(!0)}}}createRichNavDocumentUri(t){if(t.scheme===hi.scheme){const n=Ns.toRichNavComponents(t);return n===void 0?t:d.Uri.file(n.assetId)}const e=this.repository.uri.toString(!0),r=t.toString(!0);return d.Uri.file(r.substr(e.length))}};let tf=Ln;tf.localCapabilities=new Map([["javascript",Object.assign(Un.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["javascriptreact",Object.assign(Un.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["typescript",Object.assign(Un.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["typescriptreact",Object.assign(Un.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})]]),tf.disabledCapabilities=new Map([["javascript",Object.assign(Un.create(),{declarationProvider:!0})],["javascriptreact",Object.assign(Un.create(),{declarationProvider:!0})],["typescript",Object.assign(Un.create(),{declarationProvider:!0})],["typescriptreact",Object.assign(Un.create(),{declarationProvider:!0})]]);class CR{constructor(e){this.providerService=e}async getMetadata(e){const r=this.providerService.getVirtualUriMetadata(e);if(r===void 0)return;const{provider:n,repo:i}=r;return{provider:{id:n.id,name:n.name},repo:i,getRevision:async()=>{const{HEAD:o}=await this.providerService.getMetadata(e);return{type:o.type,name:o.name,revision:o.sha}}}}getProvider(e){return this.providerService.getRegisteredProvider(e)}getProviderUri(e){return this.providerService.getProviderUri(e)}getProviderRootUri(e){return this.providerService.getProviderRootUri(e)}isProviderUri(e,r){return e.scheme!==Pt.scheme&&this.providerService.hasProvider(e,r)}getVirtualUri(e){return this.providerService.getVirtualUri(e)}getVirtualWorkspaceUri(e){return this.providerService.getVirtualWorkspaceUri(e)}}var ER=Object.defineProperty,RR=Object.getOwnPropertyDescriptor,rf=(t,e,r,n)=>{for(var i=n>1?void 0:n?RR(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&ER(e,r,i),i};const nf=d.FileSystemError.FileNotFound().code;class Hl{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChangeFile=new d.EventEmitter,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.disposable=d.Disposable.from(d.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0}),d.workspace.registerFileSearchProvider(this.scheme,this),d.workspace.registerTextSearchProvider(this.scheme,this),e.onDidChangeRepository(n=>{n.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([n.repository.uri])}),e.onDidRefresh(n=>this.onRefreshOrRepositoryChanged(n)),r.onDidChange(n=>{const i=n.map(o=>{switch(o.type){case rt.Created:return{type:d.FileChangeType.Created,uri:o.uri};case rt.Changed:return{type:d.FileChangeType.Changed,uri:o.uri};case rt.Deleted:return{type:d.FileChangeType.Deleted,uri:o.uri}}});setTimeout(()=>this._onDidChangeFile.fire(i),0)}))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return Pt.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){e=e.filter(r=>r.scheme===this.scheme),e.length!==0&&(Z.log(`fs.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.updateOpenOrWatchedUris(e))}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,o]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(a=>Gn(o,a))&&(this.implicitlyWatchedUris.delete(i),r.set(i,o));Z.debug(`fs.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(we(i),i);const n=[...r.values()].map(i=>({type:d.FileChangeType.Changed,uri:i}));setTimeout(()=>{Z.debug(`fs.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=we(e);this.watchedUris.set(n,e);const i=this.providerService.watch(this.providerService.getProviderUri(e),r);return{dispose:()=>{this.watchedUris.delete(n),i.dispose()}}}async stat(e){const r=new $e(`fs.stat(${e.toString()})`);let n;try{if(this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e),e)!==!1){if(r.logStep("ChangeStore query"),n=await this.changeStore.stat(e),n!==void 0)return n;r.logStep("Provider query",{message:": Not found \u2022",suffix:" \u2022 Querying provider..."})}else r.logStep("Provider query"),this.implicitlyWatchedUris.set(we(e),e);return n=await this.providerService.stat(this.providerService.getProviderUri(e)),n}finally{n===void 0&&this.implicitlyWatchedUris.delete(we(e)),r.stop()}}async readDirectory(e){const r=new $e(`fs.readDirectory(${e.toString()})`);this.implicitlyWatchedUris.set(we(e),e);try{r.logStep("Provider query");let n=await this.providerService.readDirectory(this.providerService.getProviderUri(e));return this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e))!==!1&&(r.logStep("Applying changes",{suffix:" \u2022 Applying changes..."}),n=await this.changeStore.updateDirectoryEntries(e,n)),n}finally{r.stop()}}async createDirectory(e){const r=new $e(`fs.createDirectory(${e.toString()})`);try{await this.changeStore.createDirectory(e)}catch(n){throw Z.error(n,r.context),n}finally{r.stop()}}async readFile(e){const r=new $e(`fs.readFile(${e.toString()})`),n=we(e);let i;try{if(this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e),e)!==!1){r.logStep("ChangeStore query");const o=await this.changeStore.readFile(e);if(o!==void 0)return o;r.logStep("Provider query",{message:": Not found \u2022",suffix:" \u2022 Querying provider..."})}else r.logStep("Provider query"),this.implicitlyWatchedUris.set(n,e);return i=await this.providerService.readFile(this.providerService.getProviderUri(e)),i}finally{i===void 0&&this.implicitlyWatchedUris.delete(n),r.stop()}}async writeFile(e,r,n){const i=new $e(`fs.writeFile(${e.toString()})`,{},r.length,n);try{let o;try{if(o=await this.stat(e),!n.overwrite)throw d.FileSystemError.FileExists()}catch(a){if(a instanceof d.FileSystemError&&a.code===nf){if(!n.create)throw d.FileSystemError.FileNotFound(e)}else throw a}try{if(o===void 0)await this.changeStore.createFile(e,r);else{i.logStep("Provider original query");let a;try{a=await this.providerService.readFile(this.providerService.getProviderUri(e))}catch(s){if(s instanceof d.FileSystemError&&s.code===nf)a=new Uint8Array;else throw s}i.logStep("Writing file",{suffix:" \u2022 Writing file to Change Store..."}),await this.changeStore.writeFile(e,r,a)}}catch(a){throw Z.error(a,i.context),a}}finally{i.stop()}}async delete(e,r){const n=new $e(`fs.delete(${e.toString()})`,{},r);try{switch((await this.stat(e)).type){case d.FileType.File:await this.changeStore.deleteFile(e);break;case d.FileType.Directory:{await this.deleteDirectory(e,r);break}default:throw d.FileSystemError.NoPermissions()}}catch(i){throw Z.error(i,n.context),i}finally{n.stop()}}async deleteDirectory(e,r){const n=new $e(`fs.deleteDirectory(${e.toString()})`,{},r);try{const i=await this.readDirectory(e);if(i.length!==0){if(!r.recursive&&i.some(([,o])=>o===d.FileType.Directory))throw d.FileSystemError.NoPermissions();for(const[o,a]of i)a===d.FileType.Directory?await this.deleteDirectory(d.Uri.joinPath(e,o),r):await this.changeStore.deleteFile(d.Uri.joinPath(e,o))}await this.changeStore.deleteDirectory(e)}catch(i){throw Z.error(i,n.context),i}finally{n.stop()}}async rename(e,r,n){const i=new $e(`fs.rename(${e.toString()} -> ${r.toString()})`,{},n);try{switch((await this.stat(e)).type){case d.FileType.File:{const a=await this.readFile(e);await this.writeFile(r,a,{create:!0,overwrite:n.overwrite}),await this.delete(e,{recursive:!1});break}case d.FileType.Directory:{await this.renameDirectory(e,r,n);break}default:throw d.FileSystemError.NoPermissions()}}catch(o){throw Z.error(o,i.context),o}finally{i.stop()}}async renameDirectory(e,r,n){const i=new $e(`fs.renameDirectory(${e.toString()} -> ${r.toString()})`,{},n);try{await this.copyDirectory(e,r,n),await this.delete(e,{recursive:!0})}catch(o){throw Z.error(o,i.context),o}finally{i.stop()}}async copy(e,r,n){const i=new $e(`fs.copy(${e.toString()} -> ${r.toString()})`,{},n);try{switch((await this.stat(e)).type){case d.FileType.File:{const a=await this.readFile(e);await this.writeFile(r,a,{create:!0,overwrite:n.overwrite});break}case d.FileType.Directory:{await this.copyDirectory(e,r,n);break}default:throw d.FileSystemError.NoPermissions()}}catch(o){throw Z.error(o,i.context),o}finally{i.stop()}}async copyDirectory(e,r,n){const i=new $e(`fs.copyDirectory(${e.toString()} -> ${r.toString()})`,{},n);try{if(await this.exists(r))throw d.FileSystemError.FileExists();try{await this.createDirectory(r);const o=await this.readDirectory(e);for(const[a,s]of o)s===d.FileType.Directory?await this.copyDirectory(d.Uri.joinPath(e,a),d.Uri.joinPath(r,a),n):await this.copy(d.Uri.joinPath(e,a),d.Uri.joinPath(r,a),n)}catch(o){throw Z.error(o,i.context),o}}finally{i.stop()}}async exists(e){try{return await this.stat(e),!0}catch(r){if(r instanceof d.FileSystemError&&r.code===nf)return!1;throw r}}async provideFileSearchResults(e,r,n){var i;const o=new $e(`fs.provideFileSearchResults(${e.pattern}, ${r.folder.toString()})`,{logLevel:Rt.Debug});let a;try{return a=await this.providerService.provideFileSearchResults(e,{...r,folder:this.providerService.getProviderUri(r.folder)},n),a==null?void 0:a.map(s=>this.providerService.getVirtualUri(s))}catch(s){throw Z.error(s,o.context),s}finally{o.stop({suffix:` \u2022 ${(i=a==null?void 0:a.length)!=null?i:0} results found`})}}provideTextSearchResults(e,r,n,i){return this.providerService.provideTextSearchResults(e,{...r,folder:this.providerService.getProviderUri(r.folder)},{report:o=>n.report({...o,uri:this.providerService.getVirtualUri(o.uri)})},i)}}rf([xn()],Hl.prototype,"stat",1),rf([xn()],Hl.prototype,"readDirectory",1),rf([xn()],Hl.prototype,"readFile",1);function AR(t){return t.replace(/[-\\{}*+?|^$.[\]()#]/g,"\\$&")}function TR(t,e,r={}){if(!t)throw new Error("Cannot create regex from empty string");e||(t=AR(t)),r.wholeWord&&(/\B/.test(t.charAt(0))||(t=`\\b${t}`),/\B/.test(t.charAt(t.length-1))||(t=`${t}\\b`));let n="gmu";return r.matchCase||(n+="i"),new RegExp(t,n)}let Q0,Y0,of;const kR=(t,e,r,n)=>{const i=`${e.join("--")};;;;${r.join("--")}`,o=t.map(s=>s.path).join("::");if(Q0===o&&i==Y0&&of)return of;const a=Uh((n?t.filter(s=>s.size<n):t).map(s=>s.path),e,r);return Q0=o,Y0=i,of=a,a},IR=(t,e,r,n)=>{var i;const o=[];let a;if(typeof t=="string")a=t;else{const u=t;if(u[0]==255&&u[1]==254)a=new TextDecoder("utf-16le").decode(u);else if(u[0]==254&&u[1]==255)a=new TextDecoder("utf-16be").decode(u);else if(a=new TextDecoder("utf8").decode(u),a.slice(0,1e3).includes("\uFFFD")&&u.includes(0))return[]}const s=[];let c=null,l=n.remainingResultQuota;for(;l>=0&&(c=r.exec(a));)s.push({matchStartIndex:c.index,matchedText:c[0]}),l--;if(s.length){const u=new Set,f=new Set,h=[],p=S=>a.slice(h[S].start,h[S].end);let b=0,y=null;const w=/\r?\n/g;for(;y=w.exec(a);)h.push({start:b,end:y.index}),b=y.index+y[0].length;b<a.length&&h.push({start:b,end:a.length});let _=0;for(const{matchStartIndex:S,matchedText:I}of s){if(l<0)break;for(;Boolean(h[_+1])&&S>h[_].end;)_++;let D=_;for(;Boolean(h[D+1])&&S+I.length>h[D].end;)D++;if(n.beforeContext)for(let re=Math.max(0,_-n.beforeContext);re<_;re++)u.add(re);let O="",te=0;for(let re=_;re<=D;re++){let ae=p(re);((i=n.previewOptions)==null?void 0:i.charsPerLine)&&ae.length>n.previewOptions.charsPerLine&&(te=Math.max(S-h[_].start-20,0),ae=ae.substr(te,n.previewOptions.charsPerLine)),O+=`${ae}
`,f.add(re)}const J=new d.Range(_,S-h[_].start,D,S+I.length-h[D].start),G=new d.Range(0,S-h[_].start-te,D-_,S+I.length-h[D].start-(D===_?te:0)),ue={uri:d.Uri.file(e),ranges:J,preview:{text:O,matches:G}};if(o.push(ue),n.afterContext)for(let re=D+1;re<=Math.min(D+n.afterContext,h.length-1);re++)u.add(re)}for(const S of u)f.has(S)||o.push({uri:d.Uri.file(e),text:p(S),lineNumber:S+1})}return o};var DR=__webpack_require__(5790);/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */const PR=4,J0=0,ew=1,FR=2;function ba(t){let e=t.length;for(;--e>=0;)t[e]=0}const NR=0,tw=1,$R=2,MR=3,BR=258,af=29,$s=256,Ms=$s+1+af,_a=30,sf=19,rw=2*Ms+1,yo=15,cf=16,OR=7,lf=256,nw=16,iw=17,ow=18,uf=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ql=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),UR=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),aw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),LR=512,fi=new Array((Ms+2)*2);ba(fi);const Bs=new Array(_a*2);ba(Bs);const Os=new Array(LR);ba(Os);const Us=new Array(BR-MR+1);ba(Us);const df=new Array(af);ba(df);const Wl=new Array(_a);ba(Wl);function hf(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let sw,cw,lw;function ff(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const uw=t=>t<256?Os[t]:Os[256+(t>>>7)],Ls=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},qr=(t,e,r)=>{t.bi_valid>cf-r?(t.bi_buf|=e<<t.bi_valid&65535,Ls(t,t.bi_buf),t.bi_buf=e>>cf-t.bi_valid,t.bi_valid+=r-cf):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},Hn=(t,e,r)=>{qr(t,r[e*2],r[e*2+1])},dw=(t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},HR=t=>{t.bi_valid===16?(Ls(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},qR=(t,e)=>{const r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,f,h,p,b,y=0;for(h=0;h<=yo;h++)t.bl_count[h]=0;for(r[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<rw;l++)u=t.heap[l],h=r[r[u*2+1]*2+1]+1,h>c&&(h=c,y++),r[u*2+1]=h,!(u>n)&&(t.bl_count[h]++,p=0,u>=s&&(p=a[u-s]),b=r[u*2],t.opt_len+=b*(h+p),o&&(t.static_len+=b*(i[u*2+1]+p)));if(y!==0){do{for(h=c-1;t.bl_count[h]===0;)h--;t.bl_count[h]--,t.bl_count[h+1]+=2,t.bl_count[c]--,y-=2}while(y>0);for(h=c;h!==0;h--)for(u=t.bl_count[h];u!==0;)f=t.heap[--l],!(f>n)&&(r[f*2+1]!==h&&(t.opt_len+=(h-r[f*2+1])*r[f*2],r[f*2+1]=h),u--)}},hw=(t,e,r)=>{const n=new Array(yo+1);let i=0,o,a;for(o=1;o<=yo;o++)n[o]=i=i+r[o-1]<<1;for(a=0;a<=e;a++){let s=t[a*2+1];s!==0&&(t[a*2]=dw(n[s]++,s))}},WR=()=>{let t,e,r,n,i;const o=new Array(yo+1);for(r=0,n=0;n<af-1;n++)for(df[n]=r,t=0;t<1<<uf[n];t++)Us[r++]=n;for(Us[r-1]=n,i=0,n=0;n<16;n++)for(Wl[n]=i,t=0;t<1<<ql[n];t++)Os[i++]=n;for(i>>=7;n<_a;n++)for(Wl[n]=i<<7,t=0;t<1<<ql[n]-7;t++)Os[256+i++]=n;for(e=0;e<=yo;e++)o[e]=0;for(t=0;t<=143;)fi[t*2+1]=8,t++,o[8]++;for(;t<=255;)fi[t*2+1]=9,t++,o[9]++;for(;t<=279;)fi[t*2+1]=7,t++,o[7]++;for(;t<=287;)fi[t*2+1]=8,t++,o[8]++;for(hw(fi,Ms+1,o),t=0;t<_a;t++)Bs[t*2+1]=5,Bs[t*2]=dw(t,5);sw=new hf(fi,uf,$s+1,Ms,yo),cw=new hf(Bs,ql,0,_a,yo),lw=new hf(new Array(0),UR,0,sf,OR)},fw=t=>{let e;for(e=0;e<Ms;e++)t.dyn_ltree[e*2]=0;for(e=0;e<_a;e++)t.dyn_dtree[e*2]=0;for(e=0;e<sf;e++)t.bl_tree[e*2]=0;t.dyn_ltree[lf*2]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},pw=t=>{t.bi_valid>8?Ls(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},zR=(t,e,r,n)=>{pw(t),n&&(Ls(t,r),Ls(t,~r)),t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},gw=(t,e,r,n)=>{const i=e*2,o=r*2;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]},pf=(t,e,r)=>{const n=t.heap[r];let i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&gw(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!gw(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},mw=(t,e,r)=>{let n,i,o=0,a,s;if(t.last_lit!==0)do n=t.pending_buf[t.d_buf+o*2]<<8|t.pending_buf[t.d_buf+o*2+1],i=t.pending_buf[t.l_buf+o],o++,n===0?Hn(t,i,e):(a=Us[i],Hn(t,a+$s+1,e),s=uf[a],s!==0&&(i-=df[a],qr(t,i,s)),n--,a=uw(n),Hn(t,a,r),s=ql[a],s!==0&&(n-=Wl[a],qr(t,n,s)));while(o<t.last_lit);Hn(t,lf,e)},gf=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems;let a,s,c=-1,l;for(t.heap_len=0,t.heap_max=rw,a=0;a<o;a++)r[a*2]!==0?(t.heap[++t.heap_len]=c=a,t.depth[a]=0):r[a*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,r[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=n[l*2+1]);for(e.max_code=c,a=t.heap_len>>1;a>=1;a--)pf(t,r,a);l=o;do a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pf(t,r,1),s=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=s,r[l*2]=r[a*2]+r[s*2],t.depth[l]=(t.depth[a]>=t.depth[s]?t.depth[a]:t.depth[s])+1,r[a*2+1]=r[s*2+1]=l,t.heap[1]=l++,pf(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],qR(t,e),hw(r,c,t.bl_count)},vw=(t,e,r)=>{let n,i=-1,o,a=e[0*2+1],s=0,c=7,l=4;for(a===0&&(c=138,l=3),e[(r+1)*2+1]=65535,n=0;n<=r;n++)o=a,a=e[(n+1)*2+1],!(++s<c&&o===a)&&(s<l?t.bl_tree[o*2]+=s:o!==0?(o!==i&&t.bl_tree[o*2]++,t.bl_tree[nw*2]++):s<=10?t.bl_tree[iw*2]++:t.bl_tree[ow*2]++,s=0,i=o,a===0?(c=138,l=3):o===a?(c=6,l=3):(c=7,l=4))},ww=(t,e,r)=>{let n,i=-1,o,a=e[0*2+1],s=0,c=7,l=4;for(a===0&&(c=138,l=3),n=0;n<=r;n++)if(o=a,a=e[(n+1)*2+1],!(++s<c&&o===a)){if(s<l)do Hn(t,o,t.bl_tree);while(--s!=0);else o!==0?(o!==i&&(Hn(t,o,t.bl_tree),s--),Hn(t,nw,t.bl_tree),qr(t,s-3,2)):s<=10?(Hn(t,iw,t.bl_tree),qr(t,s-3,3)):(Hn(t,ow,t.bl_tree),qr(t,s-11,7));s=0,i=o,a===0?(c=138,l=3):o===a?(c=6,l=3):(c=7,l=4)}},jR=t=>{let e;for(vw(t,t.dyn_ltree,t.l_desc.max_code),vw(t,t.dyn_dtree,t.d_desc.max_code),gf(t,t.bl_desc),e=sf-1;e>=3&&t.bl_tree[aw[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},VR=(t,e,r,n)=>{let i;for(qr(t,e-257,5),qr(t,r-1,5),qr(t,n-4,4),i=0;i<n;i++)qr(t,t.bl_tree[aw[i]*2+1],3);ww(t,t.dyn_ltree,e-1),ww(t,t.dyn_dtree,r-1)},GR=t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return J0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return ew;for(r=32;r<$s;r++)if(t.dyn_ltree[r*2]!==0)return ew;return J0};let yw=!1;const KR=t=>{yw||(WR(),yw=!0),t.l_desc=new ff(t.dyn_ltree,sw),t.d_desc=new ff(t.dyn_dtree,cw),t.bl_desc=new ff(t.bl_tree,lw),t.bi_buf=0,t.bi_valid=0,fw(t)},bw=(t,e,r,n)=>{qr(t,(NR<<1)+(n?1:0),3),zR(t,e,r,!0)},ZR=t=>{qr(t,tw<<1,3),Hn(t,lf,fi),HR(t)},XR=(t,e,r,n)=>{let i,o,a=0;t.level>0?(t.strm.data_type===FR&&(t.strm.data_type=GR(t)),gf(t,t.l_desc),gf(t,t.d_desc),a=jR(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&e!==-1?bw(t,e,r,n):t.strategy===PR||o===i?(qr(t,(tw<<1)+(n?1:0),3),mw(t,fi,Bs)):(qr(t,($R<<1)+(n?1:0),3),VR(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),mw(t,t.dyn_ltree,t.dyn_dtree)),fw(t),n&&pw(t)},QR=(t,e,r)=>(t.pending_buf[t.d_buf+t.last_lit*2]=e>>>8&255,t.pending_buf[t.d_buf+t.last_lit*2+1]=e&255,t.pending_buf[t.l_buf+t.last_lit]=r&255,t.last_lit++,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(Us[r]+$s+1)*2]++,t.dyn_dtree[uw(e)*2]++),t.last_lit===t.lit_bufsize-1);var YR=KR,JR=bw,eA=XR,tA=QR,rA=ZR,nA={_tr_init:YR,_tr_stored_block:JR,_tr_flush_block:eA,_tr_tally:tA,_tr_align:rA},Hs=(t,e,r,n)=>{let i=t&65535|0,o=t>>>16&65535|0,a=0;for(;r!==0;){a=r>2e3?2e3:r,r-=a;do i=i+e[n++]|0,o=o+i|0;while(--a);i%=65521,o%=65521}return i|o<<16|0};const iA=()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},oA=new Uint32Array(iA());var gr=(t,e,r,n)=>{const i=oA,o=n+r;t^=-1;for(let a=n;a<o;a++)t=t>>>8^i[(t^e[a])&255];return t^-1},bo={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_o={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:aA,_tr_stored_block:sA,_tr_flush_block:cA,_tr_tally:Ui,_tr_align:lA}=nA,{Z_NO_FLUSH:xo,Z_PARTIAL_FLUSH:uA,Z_FULL_FLUSH:dA,Z_FINISH:Li,Z_BLOCK:_w,Z_OK:qn,Z_STREAM_END:xw,Z_STREAM_ERROR:sn,Z_DATA_ERROR:hA,Z_BUF_ERROR:mf,Z_DEFAULT_COMPRESSION:fA,Z_FILTERED:pA,Z_HUFFMAN_ONLY:zl,Z_RLE:gA,Z_FIXED:mA,Z_DEFAULT_STRATEGY:vA,Z_UNKNOWN:wA,Z_DEFLATED:jl}=_o,yA=9,bA=15,_A=8,xA=29,vf=256+1+xA,SA=30,CA=19,EA=2*vf+1,RA=15,_t=3,Hi=258,bn=Hi+_t+1,AA=32,Vl=42,wf=69,Gl=73,Kl=91,Zl=103,So=113,qs=666,hr=1,Ws=2,Co=3,xa=4,TA=3,qi=(t,e)=>(t.msg=bo[e],e),Sw=t=>(t<<1)-(t>4?9:0),Wi=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let zi=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const ji=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},xr=(t,e)=>{cA(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ji(t.strm)},Et=(t,e)=>{t.pending_buf[t.pending++]=e},zs=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},kA=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),t.state.wrap===1?t.adler=Hs(t.adler,e,i,r):t.state.wrap===2&&(t.adler=gr(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},Cw=(t,e)=>{let r=t.max_chain_length,n=t.strstart,i,o,a=t.prev_length,s=t.nice_match;const c=t.strstart>t.w_size-bn?t.strstart-(t.w_size-bn):0,l=t.window,u=t.w_mask,f=t.prev,h=t.strstart+Hi;let p=l[n+a-1],b=l[n+a];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do if(i=e,!(l[i+a]!==b||l[i+a-1]!==p||l[i]!==l[n]||l[++i]!==l[n+1])){n+=2,i++;do;while(l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&n<h);if(o=Hi-(h-n),n=h-Hi,o>a){if(t.match_start=e,a=o,o>=s)break;p=l[n+a-1],b=l[n+a]}}while((e=f[e&u])>c&&--r!=0);return a<=t.lookahead?a:t.lookahead},Eo=t=>{const e=t.w_size;let r,n,i,o,a;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-bn)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,n=t.hash_size,r=n;do i=t.head[--r],t.head[r]=i>=e?i-e:0;while(--n);n=e,r=n;do i=t.prev[--r],t.prev[r]=i>=e?i-e:0;while(--n);o+=e}if(t.strm.avail_in===0)break;if(n=kA(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=n,t.lookahead+t.insert>=_t)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=zi(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=zi(t,t.ins_h,t.window[a+_t-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<_t)););}while(t.lookahead<bn&&t.strm.avail_in!==0)},IA=(t,e)=>{let r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Eo(t),t.lookahead===0&&e===xo)return hr;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;const n=t.block_start+r;if((t.strstart===0||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,xr(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-bn&&(xr(t,!1),t.strm.avail_out===0))return hr}return t.insert=0,e===Li?(xr(t,!0),t.strm.avail_out===0?Co:xa):(t.strstart>t.block_start&&(xr(t,!1),t.strm.avail_out===0),hr)},yf=(t,e)=>{let r,n;for(;;){if(t.lookahead<bn){if(Eo(t),t.lookahead<bn&&e===xo)return hr;if(t.lookahead===0)break}if(r=0,t.lookahead>=_t&&(t.ins_h=zi(t,t.ins_h,t.window[t.strstart+_t-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-bn&&(t.match_length=Cw(t,r)),t.match_length>=_t)if(n=Ui(t,t.strstart-t.match_start,t.match_length-_t),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=_t){t.match_length--;do t.strstart++,t.ins_h=zi(t,t.ins_h,t.window[t.strstart+_t-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=zi(t,t.ins_h,t.window[t.strstart+1]);else n=Ui(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(xr(t,!1),t.strm.avail_out===0))return hr}return t.insert=t.strstart<_t-1?t.strstart:_t-1,e===Li?(xr(t,!0),t.strm.avail_out===0?Co:xa):t.last_lit&&(xr(t,!1),t.strm.avail_out===0)?hr:Ws},Sa=(t,e)=>{let r,n,i;for(;;){if(t.lookahead<bn){if(Eo(t),t.lookahead<bn&&e===xo)return hr;if(t.lookahead===0)break}if(r=0,t.lookahead>=_t&&(t.ins_h=zi(t,t.ins_h,t.window[t.strstart+_t-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=_t-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-bn&&(t.match_length=Cw(t,r),t.match_length<=5&&(t.strategy===pA||t.match_length===_t&&t.strstart-t.match_start>4096)&&(t.match_length=_t-1)),t.prev_length>=_t&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-_t,n=Ui(t,t.strstart-1-t.prev_match,t.prev_length-_t),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=zi(t,t.ins_h,t.window[t.strstart+_t-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=_t-1,t.strstart++,n&&(xr(t,!1),t.strm.avail_out===0))return hr}else if(t.match_available){if(n=Ui(t,0,t.window[t.strstart-1]),n&&xr(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return hr}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=Ui(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<_t-1?t.strstart:_t-1,e===Li?(xr(t,!0),t.strm.avail_out===0?Co:xa):t.last_lit&&(xr(t,!1),t.strm.avail_out===0)?hr:Ws},DA=(t,e)=>{let r,n,i,o;const a=t.window;for(;;){if(t.lookahead<=Hi){if(Eo(t),t.lookahead<=Hi&&e===xo)return hr;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=_t&&t.strstart>0&&(i=t.strstart-1,n=a[i],n===a[++i]&&n===a[++i]&&n===a[++i])){o=t.strstart+Hi;do;while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);t.match_length=Hi-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=_t?(r=Ui(t,1,t.match_length-_t),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=Ui(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(xr(t,!1),t.strm.avail_out===0))return hr}return t.insert=0,e===Li?(xr(t,!0),t.strm.avail_out===0?Co:xa):t.last_lit&&(xr(t,!1),t.strm.avail_out===0)?hr:Ws},PA=(t,e)=>{let r;for(;;){if(t.lookahead===0&&(Eo(t),t.lookahead===0)){if(e===xo)return hr;break}if(t.match_length=0,r=Ui(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(xr(t,!1),t.strm.avail_out===0))return hr}return t.insert=0,e===Li?(xr(t,!0),t.strm.avail_out===0?Co:xa):t.last_lit&&(xr(t,!1),t.strm.avail_out===0)?hr:Ws};function Wn(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}const js=[new Wn(0,0,0,0,IA),new Wn(4,4,8,4,yf),new Wn(4,5,16,8,yf),new Wn(4,6,32,32,yf),new Wn(4,4,16,16,Sa),new Wn(8,16,32,32,Sa),new Wn(8,16,128,128,Sa),new Wn(8,32,128,256,Sa),new Wn(32,128,258,1024,Sa),new Wn(32,258,258,4096,Sa)],FA=t=>{t.window_size=2*t.w_size,Wi(t.head),t.max_lazy_match=js[t.level].max_lazy,t.good_match=js[t.level].good_length,t.nice_match=js[t.level].nice_length,t.max_chain_length=js[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=_t-1,t.match_available=0,t.ins_h=0};function NA(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=jl,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(EA*2),this.dyn_dtree=new Uint16Array((2*SA+1)*2),this.bl_tree=new Uint16Array((2*CA+1)*2),Wi(this.dyn_ltree),Wi(this.dyn_dtree),Wi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(RA+1),this.heap=new Uint16Array(2*vf+1),Wi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*vf+1),Wi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ew=t=>{if(!t||!t.state)return qi(t,sn);t.total_in=t.total_out=0,t.data_type=wA;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Vl:So,t.adler=e.wrap===2?0:1,e.last_flush=xo,aA(e),qn},Rw=t=>{const e=Ew(t);return e===qn&&FA(t.state),e},$A=(t,e)=>!t||!t.state||t.state.wrap!==2?sn:(t.state.gzhead=e,qn),Aw=(t,e,r,n,i,o)=>{if(!t)return sn;let a=1;if(e===fA&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>yA||r!==jl||n<8||n>15||e<0||e>9||o<0||o>mA)return qi(t,sn);n===8&&(n=9);const s=new NA;return t.state=s,s.strm=t,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+_t-1)/_t),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=(1+2)*s.lit_bufsize,s.level=e,s.strategy=o,s.method=r,Rw(t)},MA=(t,e)=>Aw(t,e,jl,bA,_A,vA),BA=(t,e)=>{let r,n;if(!t||!t.state||e>_w||e<0)return t?qi(t,sn):sn;const i=t.state;if(!t.output||!t.input&&t.avail_in!==0||i.status===qs&&e!==Li)return qi(t,t.avail_out===0?mf:sn);i.strm=t;const o=i.last_flush;if(i.last_flush=e,i.status===Vl)if(i.wrap===2)t.adler=0,Et(i,31),Et(i,139),Et(i,8),i.gzhead?(Et(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Et(i,i.gzhead.time&255),Et(i,i.gzhead.time>>8&255),Et(i,i.gzhead.time>>16&255),Et(i,i.gzhead.time>>24&255),Et(i,i.level===9?2:i.strategy>=zl||i.level<2?4:0),Et(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(Et(i,i.gzhead.extra.length&255),Et(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=gr(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=wf):(Et(i,0),Et(i,0),Et(i,0),Et(i,0),Et(i,0),Et(i,i.level===9?2:i.strategy>=zl||i.level<2?4:0),Et(i,TA),i.status=So);else{let a=jl+(i.w_bits-8<<4)<<8,s=-1;i.strategy>=zl||i.level<2?s=0:i.level<6?s=1:i.level===6?s=2:s=3,a|=s<<6,i.strstart!==0&&(a|=AA),a+=31-a%31,i.status=So,zs(i,a),i.strstart!==0&&(zs(i,t.adler>>>16),zs(i,t.adler&65535)),t.adler=1}if(i.status===wf)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=gr(t.adler,i.pending_buf,i.pending-r,r)),ji(t),r=i.pending,i.pending===i.pending_buf_size));)Et(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(t.adler=gr(t.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Gl)}else i.status=Gl;if(i.status===Gl)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=gr(t.adler,i.pending_buf,i.pending-r,r)),ji(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,Et(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(t.adler=gr(t.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.gzindex=0,i.status=Kl)}else i.status=Kl;if(i.status===Kl)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=gr(t.adler,i.pending_buf,i.pending-r,r)),ji(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,Et(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(t.adler=gr(t.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.status=Zl)}else i.status=Zl;if(i.status===Zl&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ji(t),i.pending+2<=i.pending_buf_size&&(Et(i,t.adler&255),Et(i,t.adler>>8&255),t.adler=0,i.status=So)):i.status=So),i.pending!==0){if(ji(t),t.avail_out===0)return i.last_flush=-1,qn}else if(t.avail_in===0&&Sw(e)<=Sw(o)&&e!==Li)return qi(t,mf);if(i.status===qs&&t.avail_in!==0)return qi(t,mf);if(t.avail_in!==0||i.lookahead!==0||e!==xo&&i.status!==qs){let a=i.strategy===zl?PA(i,e):i.strategy===gA?DA(i,e):js[i.level].func(i,e);if((a===Co||a===xa)&&(i.status=qs),a===hr||a===Co)return t.avail_out===0&&(i.last_flush=-1),qn;if(a===Ws&&(e===uA?lA(i):e!==_w&&(sA(i,0,0,!1),e===dA&&(Wi(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),ji(t),t.avail_out===0))return i.last_flush=-1,qn}return e!==Li?qn:i.wrap<=0?xw:(i.wrap===2?(Et(i,t.adler&255),Et(i,t.adler>>8&255),Et(i,t.adler>>16&255),Et(i,t.adler>>24&255),Et(i,t.total_in&255),Et(i,t.total_in>>8&255),Et(i,t.total_in>>16&255),Et(i,t.total_in>>24&255)):(zs(i,t.adler>>>16),zs(i,t.adler&65535)),ji(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?qn:xw)},OA=t=>{if(!t||!t.state)return sn;const e=t.state.status;return e!==Vl&&e!==wf&&e!==Gl&&e!==Kl&&e!==Zl&&e!==So&&e!==qs?qi(t,sn):(t.state=null,e===So?qi(t,hA):qn)},UA=(t,e)=>{let r=e.length;if(!t||!t.state)return sn;const n=t.state,i=n.wrap;if(i===2||i===1&&n.status!==Vl||n.lookahead)return sn;if(i===1&&(t.adler=Hs(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){i===0&&(Wi(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(r-n.w_size,r),0),e=c,r=n.w_size}const o=t.avail_in,a=t.next_in,s=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Eo(n);n.lookahead>=_t;){let c=n.strstart,l=n.lookahead-(_t-1);do n.ins_h=zi(n,n.ins_h,n.window[c+_t-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--l);n.strstart=c,n.lookahead=_t-1,Eo(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=_t-1,n.match_available=0,t.next_in=a,t.input=s,t.avail_in=o,n.wrap=i,qn};var LA=MA,HA=Aw,qA=Rw,WA=Ew,zA=$A,jA=BA,VA=OA,GA=UA,KA="pako deflate (from Nodeca project)",Vs={deflateInit:LA,deflateInit2:HA,deflateReset:qA,deflateResetKeep:WA,deflateSetHeader:zA,deflate:jA,deflateEnd:VA,deflateSetDictionary:GA,deflateInfo:KA};const ZA=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var XA=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(!!r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)ZA(r,n)&&(t[n]=r[n])}}return t},QA=t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const r=new Uint8Array(e);for(let n=0,i=0,o=t.length;n<o;n++){let a=t[n];r.set(a,i),i+=a.length}return r},Xl={assign:XA,flattenChunks:QA};let Tw=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Tw=!1}const Gs=new Uint8Array(256);for(let t=0;t<256;t++)Gs[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Gs[254]=Gs[254]=1;var YA=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,i,o,a=t.length,s=0;for(i=0;i<a;i++)r=t.charCodeAt(i),(r&64512)==55296&&i+1<a&&(n=t.charCodeAt(i+1),(n&64512)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(s),o=0,i=0;o<s;i++)r=t.charCodeAt(i),(r&64512)==55296&&i+1<a&&(n=t.charCodeAt(i+1),(n&64512)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|r&63):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|r&63):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|r&63);return e};const JA=(t,e)=>{if(e<65534&&t.subarray&&Tw)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r};var eT=(t,e)=>{const r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,i;const o=new Array(r*2);for(i=0,n=0;n<r;){let a=t[n++];if(a<128){o[i++]=a;continue}let s=Gs[a];if(s>4){o[i++]=65533,n+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&n<r;)a=a<<6|t[n++]&63,s--;if(s>1){o[i++]=65533;continue}a<65536?o[i++]=a:(a-=65536,o[i++]=55296|a>>10&1023,o[i++]=56320|a&1023)}return JA(o,i)},tT=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)==128;)r--;return r<0||r===0?e:r+Gs[t[r]]>e?r:e},Ks={string2buf:YA,buf2string:eT,utf8border:tT};function rT(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var kw=rT;const Iw=Object.prototype.toString,{Z_NO_FLUSH:nT,Z_SYNC_FLUSH:iT,Z_FULL_FLUSH:oT,Z_FINISH:aT,Z_OK:Ql,Z_STREAM_END:sT,Z_DEFAULT_COMPRESSION:cT,Z_DEFAULT_STRATEGY:lT,Z_DEFLATED:uT}=_o;function Zs(t){this.options=Xl.assign({level:cT,method:uT,chunkSize:16384,windowBits:15,memLevel:8,strategy:lT},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kw,this.strm.avail_out=0;let r=Vs.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Ql)throw new Error(bo[r]);if(e.header&&Vs.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=Ks.string2buf(e.dictionary):Iw.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,r=Vs.deflateSetDictionary(this.strm,n),r!==Ql)throw new Error(bo[r]);this._dict_set=!0}}Zs.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?aT:nT,typeof t=="string"?r.input=Ks.string2buf(t):Iw.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===iT||o===oT)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(i=Vs.deflate(r,o),i===sT)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Vs.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ql;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0},Zs.prototype.onData=function(t){this.chunks.push(t)},Zs.prototype.onEnd=function(t){t===Ql&&(this.result=Xl.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function bf(t,e){const r=new Zs(e);if(r.push(t,!0),r.err)throw r.msg||bo[r.err];return r.result}function dT(t,e){return e=e||{},e.raw=!0,bf(t,e)}function hT(t,e){return e=e||{},e.gzip=!0,bf(t,e)}var fT=Zs,pT=bf,gT=dT,mT=hT,vT=_o,wT={Deflate:fT,deflate:pT,deflateRaw:gT,gzip:mT,constants:vT};const Yl=30,yT=12;var bT=function(e,r){let n,i,o,a,s,c,l,u,f,h,p,b,y,w,_,S,I,D,O,te,J,G,ue,re;const ae=e.state;n=e.next_in,ue=e.input,i=n+(e.avail_in-5),o=e.next_out,re=e.output,a=o-(r-e.avail_out),s=o+(e.avail_out-257),c=ae.dmax,l=ae.wsize,u=ae.whave,f=ae.wnext,h=ae.window,p=ae.hold,b=ae.bits,y=ae.lencode,w=ae.distcode,_=(1<<ae.lenbits)-1,S=(1<<ae.distbits)-1;e:do{b<15&&(p+=ue[n++]<<b,b+=8,p+=ue[n++]<<b,b+=8),I=y[p&_];t:for(;;){if(D=I>>>24,p>>>=D,b-=D,D=I>>>16&255,D===0)re[o++]=I&65535;else if(D&16){O=I&65535,D&=15,D&&(b<D&&(p+=ue[n++]<<b,b+=8),O+=p&(1<<D)-1,p>>>=D,b-=D),b<15&&(p+=ue[n++]<<b,b+=8,p+=ue[n++]<<b,b+=8),I=w[p&S];r:for(;;){if(D=I>>>24,p>>>=D,b-=D,D=I>>>16&255,D&16){if(te=I&65535,D&=15,b<D&&(p+=ue[n++]<<b,b+=8,b<D&&(p+=ue[n++]<<b,b+=8)),te+=p&(1<<D)-1,te>c){e.msg="invalid distance too far back",ae.mode=Yl;break e}if(p>>>=D,b-=D,D=o-a,te>D){if(D=te-D,D>u&&ae.sane){e.msg="invalid distance too far back",ae.mode=Yl;break e}if(J=0,G=h,f===0){if(J+=l-D,D<O){O-=D;do re[o++]=h[J++];while(--D);J=o-te,G=re}}else if(f<D){if(J+=l+f-D,D-=f,D<O){O-=D;do re[o++]=h[J++];while(--D);if(J=0,f<O){D=f,O-=D;do re[o++]=h[J++];while(--D);J=o-te,G=re}}}else if(J+=f-D,D<O){O-=D;do re[o++]=h[J++];while(--D);J=o-te,G=re}for(;O>2;)re[o++]=G[J++],re[o++]=G[J++],re[o++]=G[J++],O-=3;O&&(re[o++]=G[J++],O>1&&(re[o++]=G[J++]))}else{J=o-te;do re[o++]=re[J++],re[o++]=re[J++],re[o++]=re[J++],O-=3;while(O>2);O&&(re[o++]=re[J++],O>1&&(re[o++]=re[J++]))}}else if((D&64)==0){I=w[(I&65535)+(p&(1<<D)-1)];continue r}else{e.msg="invalid distance code",ae.mode=Yl;break e}break}}else if((D&64)==0){I=y[(I&65535)+(p&(1<<D)-1)];continue t}else if(D&32){ae.mode=yT;break e}else{e.msg="invalid literal/length code",ae.mode=Yl;break e}break}}while(n<i&&o<s);O=b>>3,n-=O,b-=O<<3,p&=(1<<b)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=o<s?257+(s-o):257-(o-s),ae.hold=p,ae.bits=b};const Ca=15,Dw=852,Pw=592,Fw=0,_f=1,Nw=2,_T=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),xT=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ST=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),CT=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Xs=(t,e,r,n,i,o,a,s)=>{const c=s.bits;let l=0,u=0,f=0,h=0,p=0,b=0,y=0,w=0,_=0,S=0,I,D,O,te,J,G=null,ue=0,re;const ae=new Uint16Array(Ca+1),ye=new Uint16Array(Ca+1);let dt=null,ne=0,Se,ke,Te;for(l=0;l<=Ca;l++)ae[l]=0;for(u=0;u<n;u++)ae[e[r+u]]++;for(p=c,h=Ca;h>=1&&ae[h]===0;h--);if(p>h&&(p=h),h===0)return i[o++]=1<<24|64<<16|0,i[o++]=1<<24|64<<16|0,s.bits=1,0;for(f=1;f<h&&ae[f]===0;f++);for(p<f&&(p=f),w=1,l=1;l<=Ca;l++)if(w<<=1,w-=ae[l],w<0)return-1;if(w>0&&(t===Fw||h!==1))return-1;for(ye[1]=0,l=1;l<Ca;l++)ye[l+1]=ye[l]+ae[l];for(u=0;u<n;u++)e[r+u]!==0&&(a[ye[e[r+u]]++]=u);if(t===Fw?(G=dt=a,re=19):t===_f?(G=_T,ue-=257,dt=xT,ne-=257,re=256):(G=ST,dt=CT,re=-1),S=0,u=0,l=f,J=o,b=p,y=0,O=-1,_=1<<p,te=_-1,t===_f&&_>Dw||t===Nw&&_>Pw)return 1;for(;;){Se=l-y,a[u]<re?(ke=0,Te=a[u]):a[u]>re?(ke=dt[ne+a[u]],Te=G[ue+a[u]]):(ke=32+64,Te=0),I=1<<l-y,D=1<<b,f=D;do D-=I,i[J+(S>>y)+D]=Se<<24|ke<<16|Te|0;while(D!==0);for(I=1<<l-1;S&I;)I>>=1;if(I!==0?(S&=I-1,S+=I):S=0,u++,--ae[l]==0){if(l===h)break;l=e[r+a[u]]}if(l>p&&(S&te)!==O){for(y===0&&(y=p),J+=f,b=l-y,w=1<<b;b+y<h&&(w-=ae[b+y],!(w<=0));)b++,w<<=1;if(_+=1<<b,t===_f&&_>Dw||t===Nw&&_>Pw)return 1;O=S&te,i[O]=p<<24|b<<16|J-o|0}}return S!==0&&(i[J+S]=l-y<<24|64<<16|0),s.bits=p,0};const ET=0,$w=1,Mw=2,{Z_FINISH:Bw,Z_BLOCK:RT,Z_TREES:Jl,Z_OK:Ro,Z_STREAM_END:AT,Z_NEED_DICT:TT,Z_STREAM_ERROR:cn,Z_DATA_ERROR:Ow,Z_MEM_ERROR:Uw,Z_BUF_ERROR:kT,Z_DEFLATED:Lw}=_o,Hw=1,qw=2,Ww=3,zw=4,jw=5,Vw=6,Gw=7,Kw=8,Zw=9,Xw=10,eu=11,pi=12,xf=13,Qw=14,Sf=15,Yw=16,Jw=17,ey=18,ty=19,tu=20,ru=21,ry=22,ny=23,iy=24,oy=25,ay=26,Cf=27,sy=28,cy=29,Qt=30,ly=31,IT=32,DT=852,PT=592,FT=15,uy=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function NT(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const dy=t=>{if(!t||!t.state)return cn;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Hw,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(DT),e.distcode=e.distdyn=new Int32Array(PT),e.sane=1,e.back=-1,Ro},hy=t=>{if(!t||!t.state)return cn;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,dy(t)},fy=(t,e)=>{let r;if(!t||!t.state)return cn;const n=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?cn:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,hy(t))},py=(t,e)=>{if(!t)return cn;const r=new NT;t.state=r,r.window=null;const n=fy(t,e);return n!==Ro&&(t.state=null),n},$T=t=>py(t,FT);let gy=!0,Ef,Rf;const MT=t=>{if(gy){Ef=new Int32Array(512),Rf=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Xs($w,t.lens,0,288,Ef,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Xs(Mw,t.lens,0,32,Rf,0,t.work,{bits:5}),gy=!1}t.lencode=Ef,t.lenbits=9,t.distcode=Rf,t.distbits=5},my=(t,e,r,n)=>{let i;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(r-n,r-n+i),o.wnext),n-=i,n?(o.window.set(e.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},BT=(t,e)=>{let r,n,i,o,a,s,c,l,u,f,h,p,b,y,w=0,_,S,I,D,O,te,J,G;const ue=new Uint8Array(4);let re,ae;const ye=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return cn;r=t.state,r.mode===pi&&(r.mode=xf),a=t.next_out,i=t.output,c=t.avail_out,o=t.next_in,n=t.input,s=t.avail_in,l=r.hold,u=r.bits,f=s,h=c,G=Ro;e:for(;;)switch(r.mode){case Hw:if(r.wrap===0){r.mode=xf;break}for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(r.wrap&2&&l===35615){r.check=0,ue[0]=l&255,ue[1]=l>>>8&255,r.check=gr(r.check,ue,2,0),l=0,u=0,r.mode=qw;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",r.mode=Qt;break}if((l&15)!==Lw){t.msg="unknown compression method",r.mode=Qt;break}if(l>>>=4,u-=4,J=(l&15)+8,r.wbits===0)r.wbits=J;else if(J>r.wbits){t.msg="invalid window size",r.mode=Qt;break}r.dmax=1<<r.wbits,t.adler=r.check=1,r.mode=l&512?Xw:pi,l=0,u=0;break;case qw:for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(r.flags=l,(r.flags&255)!==Lw){t.msg="unknown compression method",r.mode=Qt;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=Qt;break}r.head&&(r.head.text=l>>8&1),r.flags&512&&(ue[0]=l&255,ue[1]=l>>>8&255,r.check=gr(r.check,ue,2,0)),l=0,u=0,r.mode=Ww;case Ww:for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.head&&(r.head.time=l),r.flags&512&&(ue[0]=l&255,ue[1]=l>>>8&255,ue[2]=l>>>16&255,ue[3]=l>>>24&255,r.check=gr(r.check,ue,4,0)),l=0,u=0,r.mode=zw;case zw:for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.head&&(r.head.xflags=l&255,r.head.os=l>>8),r.flags&512&&(ue[0]=l&255,ue[1]=l>>>8&255,r.check=gr(r.check,ue,2,0)),l=0,u=0,r.mode=jw;case jw:if(r.flags&1024){for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.length=l,r.head&&(r.head.extra_len=l),r.flags&512&&(ue[0]=l&255,ue[1]=l>>>8&255,r.check=gr(r.check,ue,2,0)),l=0,u=0}else r.head&&(r.head.extra=null);r.mode=Vw;case Vw:if(r.flags&1024&&(p=r.length,p>s&&(p=s),p&&(r.head&&(J=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+p),J)),r.flags&512&&(r.check=gr(r.check,n,p,o)),s-=p,o+=p,r.length-=p),r.length))break e;r.length=0,r.mode=Gw;case Gw:if(r.flags&2048){if(s===0)break e;p=0;do J=n[o+p++],r.head&&J&&r.length<65536&&(r.head.name+=String.fromCharCode(J));while(J&&p<s);if(r.flags&512&&(r.check=gr(r.check,n,p,o)),s-=p,o+=p,J)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Kw;case Kw:if(r.flags&4096){if(s===0)break e;p=0;do J=n[o+p++],r.head&&J&&r.length<65536&&(r.head.comment+=String.fromCharCode(J));while(J&&p<s);if(r.flags&512&&(r.check=gr(r.check,n,p,o)),s-=p,o+=p,J)break e}else r.head&&(r.head.comment=null);r.mode=Zw;case Zw:if(r.flags&512){for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(l!==(r.check&65535)){t.msg="header crc mismatch",r.mode=Qt;break}l=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=pi;break;case Xw:for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}t.adler=r.check=uy(l),l=0,u=0,r.mode=eu;case eu:if(r.havedict===0)return t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=s,r.hold=l,r.bits=u,TT;t.adler=r.check=1,r.mode=pi;case pi:if(e===RT||e===Jl)break e;case xf:if(r.last){l>>>=u&7,u-=u&7,r.mode=Cf;break}for(;u<3;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}switch(r.last=l&1,l>>>=1,u-=1,l&3){case 0:r.mode=Qw;break;case 1:if(MT(r),r.mode=tu,e===Jl){l>>>=2,u-=2;break e}break;case 2:r.mode=Jw;break;case 3:t.msg="invalid block type",r.mode=Qt}l>>>=2,u-=2;break;case Qw:for(l>>>=u&7,u-=u&7;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if((l&65535)!=(l>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Qt;break}if(r.length=l&65535,l=0,u=0,r.mode=Sf,e===Jl)break e;case Sf:r.mode=Yw;case Yw:if(p=r.length,p){if(p>s&&(p=s),p>c&&(p=c),p===0)break e;i.set(n.subarray(o,o+p),a),s-=p,o+=p,c-=p,a+=p,r.length-=p;break}r.mode=pi;break;case Jw:for(;u<14;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(r.nlen=(l&31)+257,l>>>=5,u-=5,r.ndist=(l&31)+1,l>>>=5,u-=5,r.ncode=(l&15)+4,l>>>=4,u-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Qt;break}r.have=0,r.mode=ey;case ey:for(;r.have<r.ncode;){for(;u<3;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.lens[ye[r.have++]]=l&7,l>>>=3,u-=3}for(;r.have<19;)r.lens[ye[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,re={bits:r.lenbits},G=Xs(ET,r.lens,0,19,r.lencode,0,r.work,re),r.lenbits=re.bits,G){t.msg="invalid code lengths set",r.mode=Qt;break}r.have=0,r.mode=ty;case ty:for(;r.have<r.nlen+r.ndist;){for(;w=r.lencode[l&(1<<r.lenbits)-1],_=w>>>24,S=w>>>16&255,I=w&65535,!(_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(I<16)l>>>=_,u-=_,r.lens[r.have++]=I;else{if(I===16){for(ae=_+2;u<ae;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(l>>>=_,u-=_,r.have===0){t.msg="invalid bit length repeat",r.mode=Qt;break}J=r.lens[r.have-1],p=3+(l&3),l>>>=2,u-=2}else if(I===17){for(ae=_+3;u<ae;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=_,u-=_,J=0,p=3+(l&7),l>>>=3,u-=3}else{for(ae=_+7;u<ae;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=_,u-=_,J=0,p=11+(l&127),l>>>=7,u-=7}if(r.have+p>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Qt;break}for(;p--;)r.lens[r.have++]=J}}if(r.mode===Qt)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=Qt;break}if(r.lenbits=9,re={bits:r.lenbits},G=Xs($w,r.lens,0,r.nlen,r.lencode,0,r.work,re),r.lenbits=re.bits,G){t.msg="invalid literal/lengths set",r.mode=Qt;break}if(r.distbits=6,r.distcode=r.distdyn,re={bits:r.distbits},G=Xs(Mw,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,re),r.distbits=re.bits,G){t.msg="invalid distances set",r.mode=Qt;break}if(r.mode=tu,e===Jl)break e;case tu:r.mode=ru;case ru:if(s>=6&&c>=258){t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=s,r.hold=l,r.bits=u,bT(t,h),a=t.next_out,i=t.output,c=t.avail_out,o=t.next_in,n=t.input,s=t.avail_in,l=r.hold,u=r.bits,r.mode===pi&&(r.back=-1);break}for(r.back=0;w=r.lencode[l&(1<<r.lenbits)-1],_=w>>>24,S=w>>>16&255,I=w&65535,!(_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(S&&(S&240)==0){for(D=_,O=S,te=I;w=r.lencode[te+((l&(1<<D+O)-1)>>D)],_=w>>>24,S=w>>>16&255,I=w&65535,!(D+_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=D,u-=D,r.back+=D}if(l>>>=_,u-=_,r.back+=_,r.length=I,S===0){r.mode=ay;break}if(S&32){r.back=-1,r.mode=pi;break}if(S&64){t.msg="invalid literal/length code",r.mode=Qt;break}r.extra=S&15,r.mode=ry;case ry:if(r.extra){for(ae=r.extra;u<ae;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=ny;case ny:for(;w=r.distcode[l&(1<<r.distbits)-1],_=w>>>24,S=w>>>16&255,I=w&65535,!(_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if((S&240)==0){for(D=_,O=S,te=I;w=r.distcode[te+((l&(1<<D+O)-1)>>D)],_=w>>>24,S=w>>>16&255,I=w&65535,!(D+_<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=D,u-=D,r.back+=D}if(l>>>=_,u-=_,r.back+=_,S&64){t.msg="invalid distance code",r.mode=Qt;break}r.offset=I,r.extra=S&15,r.mode=iy;case iy:if(r.extra){for(ae=r.extra;u<ae;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Qt;break}r.mode=oy;case oy:if(c===0)break e;if(p=h-c,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Qt;break}p>r.wnext?(p-=r.wnext,b=r.wsize-p):b=r.wnext-p,p>r.length&&(p=r.length),y=r.window}else y=i,b=a-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do i[a++]=y[b++];while(--p);r.length===0&&(r.mode=ru);break;case ay:if(c===0)break e;i[a++]=r.length,c--,r.mode=ru;break;case Cf:if(r.wrap){for(;u<32;){if(s===0)break e;s--,l|=n[o++]<<u,u+=8}if(h-=c,t.total_out+=h,r.total+=h,h&&(t.adler=r.check=r.flags?gr(r.check,i,h,a-h):Hs(r.check,i,h,a-h)),h=c,(r.flags?l:uy(l))!==r.check){t.msg="incorrect data check",r.mode=Qt;break}l=0,u=0}r.mode=sy;case sy:if(r.wrap&&r.flags){for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(l!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=Qt;break}l=0,u=0}r.mode=cy;case cy:G=AT;break e;case Qt:G=Ow;break e;case ly:return Uw;case IT:default:return cn}return t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=s,r.hold=l,r.bits=u,(r.wsize||h!==t.avail_out&&r.mode<Qt&&(r.mode<Cf||e!==Bw))&&my(t,t.output,t.next_out,h-t.avail_out),f-=t.avail_in,h-=t.avail_out,t.total_in+=f,t.total_out+=h,r.total+=h,r.wrap&&h&&(t.adler=r.check=r.flags?gr(r.check,i,h,t.next_out-h):Hs(r.check,i,h,t.next_out-h)),t.data_type=r.bits+(r.last?64:0)+(r.mode===pi?128:0)+(r.mode===tu||r.mode===Sf?256:0),(f===0&&h===0||e===Bw)&&G===Ro&&(G=kT),G},OT=t=>{if(!t||!t.state)return cn;let e=t.state;return e.window&&(e.window=null),t.state=null,Ro},UT=(t,e)=>{if(!t||!t.state)return cn;const r=t.state;return(r.wrap&2)==0?cn:(r.head=e,e.done=!1,Ro)},LT=(t,e)=>{const r=e.length;let n,i,o;return!t||!t.state||(n=t.state,n.wrap!==0&&n.mode!==eu)?cn:n.mode===eu&&(i=1,i=Hs(i,e,r,0),i!==n.check)?Ow:(o=my(t,e,r,r),o?(n.mode=ly,Uw):(n.havedict=1,Ro))};var HT=hy,qT=fy,WT=dy,zT=$T,jT=py,VT=BT,GT=OT,KT=UT,ZT=LT,XT="pako inflate (from Nodeca project)",gi={inflateReset:HT,inflateReset2:qT,inflateResetKeep:WT,inflateInit:zT,inflateInit2:jT,inflate:VT,inflateEnd:GT,inflateGetHeader:KT,inflateSetDictionary:ZT,inflateInfo:XT};function QT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var YT=QT;const vy=Object.prototype.toString,{Z_NO_FLUSH:JT,Z_FINISH:ek,Z_OK:Qs,Z_STREAM_END:Af,Z_NEED_DICT:Tf,Z_STREAM_ERROR:tk,Z_DATA_ERROR:wy,Z_MEM_ERROR:rk}=_o;function Ys(t){this.options=Xl.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kw,this.strm.avail_out=0;let r=gi.inflateInit2(this.strm,e.windowBits);if(r!==Qs)throw new Error(bo[r]);if(this.header=new YT,gi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ks.string2buf(e.dictionary):vy.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=gi.inflateSetDictionary(this.strm,e.dictionary),r!==Qs)))throw new Error(bo[r])}Ys.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,a,s;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?ek:JT,vy.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=gi.inflate(r,a),o===Tf&&i&&(o=gi.inflateSetDictionary(r,i),o===Qs?o=gi.inflate(r,a):o===wy&&(o=Tf));r.avail_in>0&&o===Af&&r.state.wrap>0&&t[r.next_in]!==0;)gi.inflateReset(r),o=gi.inflate(r,a);switch(o){case tk:case wy:case Tf:case rk:return this.onEnd(o),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(r.avail_out===0||o===Af))if(this.options.to==="string"){let c=Ks.utf8border(r.output,r.next_out),l=r.next_out-c,u=Ks.buf2string(r.output,c);r.next_out=l,r.avail_out=n-l,l&&r.output.set(r.output.subarray(c,c+l),0),this.onData(u)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===Qs&&s===0)){if(o===Af)return o=gi.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},Ys.prototype.onData=function(t){this.chunks.push(t)},Ys.prototype.onEnd=function(t){t===Qs&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Xl.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function kf(t,e){const r=new Ys(e);if(r.push(t),r.err)throw r.msg||bo[r.err];return r.result}function nk(t,e){return e=e||{},e.raw=!0,kf(t,e)}var ik=Ys,ok=kf,ak=nk,sk=kf,ck=_o,lk={Inflate:ik,inflate:ok,inflateRaw:ak,ungzip:sk,constants:ck};const{Deflate:uk,deflate:dk,deflateRaw:hk,gzip:fk}=wT,{Inflate:pk,inflate:gk,inflateRaw:mk,ungzip:vk}=lk;var wk=uk,yk=dk,bk=hk,_k=fk,xk=pk,Sk=gk,Ck=mk,yy=vk,Ek=_o,ND={Deflate:wk,deflate:yk,deflateRaw:bk,gzip:_k,Inflate:xk,inflate:Sk,inflateRaw:Ck,ungzip:yy,constants:Ek};const Ao=(0,C.loadMessageBundle)(),nu=new TextDecoder,iu=new TextEncoder;class Rk{constructor(e,r=0){this.retainFor=r;try{this.weakRef=new WeakRef(e)}catch{}this.retain(e)}retain(e){this.retainTimeout&&clearTimeout(this.retainTimeout),this.strongRef=e,this.retainTimeout=setTimeout(()=>{this.strongRef=void 0,this.retainTimeout=void 0},this.retainFor)}deref(){var e,r;const n=(r=this.strongRef)!=null?r:(e=this.weakRef)==null?void 0:e.deref();return n&&this.retain(n),n}}class Ak{constructor(e,r){this.root=e,this.providerService=r,this._onDidChangeIndexingEnablement=new d.EventEmitter,this._onDidDownloadTar=new d.EventEmitter,this.ongoingRequests=new Map,this.usageFile=d.Uri.joinPath(this.root,"usageHistory.json"),this.indexingAllowanceFile=d.Uri.joinPath(this.root,"indexAllowances.json"),this._disposable=d.Disposable.from(...this.registerCommands()),this.updateContext()}get onDidChangeIndexingEnablement(){return this._onDidChangeIndexingEnablement.event}get onDidDownloadTar(){return this._onDidDownloadTar.event}async updateContext(){await Di(ci.HasSearchIndexes,(await this.listTars()).length>0);const e=this.providerService.repositories.map(i=>i.name),r=await this.getIndexingEnabledRepos(),n=r.has("*")||e.every(i=>r.has(i));await Di(ci.EnabledSomeSearchIndexes,r.size>0),await Di(ci.EnabledAllSearchIndexes,n)}dispose(){this._disposable.dispose()}registerCommands(){return[d.commands.registerCommand("remoteHub.configureIndexingAllowedRepos",async()=>{await this.configureIndexingAllowedRepos()}),d.commands.registerCommand("remoteHub.enableIndexing",async()=>{const e={title:Ao("search download prompt enable","Enable")},r={title:Ao("search download prompt enable always","Always Enable")},n={title:Ao("search download prompt configure","Configure")},i={title:Ao("search download prompt cancel","Cancel"),isCloseAffordance:!0},o=await d.window.showInformationMessage(Ao("search download prompt",`Indexing creates a copy of this repository in your browser's storage in order to provide enhanced text searches.

Without indexing, searches will use GitHub's text search, which is imprecise.

Do you want to enable creating local indexes for this repository on this browser? You should only enable indexing on machines you trust.`),{modal:!0,useCustom:!0},e,r,n,i);if(o===n&&await d.commands.executeCommand("workbench.action.openSettings","remoteHub.search.download"),o===e)return await this.markIndexingEnabledForRepos(...this.providerService.repositories.map(a=>a.name)),{triggerSearch:!0};if(o===r)return await this.markIndexingEnabledForRepos("*"),{triggerSearch:!0}}),d.commands.registerCommand("remoteHub.deleteLocalRepositoryData",async()=>{const e=i=>{const o=[{power:9,name:"GB"},{power:6,name:"MB"},{power:3,name:"kB"},{power:0,name:"B"}];for(const a of o)if(i>10**a.power)return`${Math.round(i/10**a.power)} ${a.name}`;return"Unknown size"},r=await this.listTars();if(r.length===0){await d.window.showInformationMessage("No Search Indexes Found");return}const n=d.window.createQuickPick();n.canSelectMany=!0,n.items=r.map(({name:i,size:o,path:a})=>({label:i,path:a,description:o?e(o):void 0})),n.show(),n.onDidAccept(async()=>{n.hide();for(const{label:i,path:o}of n.selectedItems){const a=d.workspace.fs.delete(o),s=d.window.setStatusBarMessage(`$(loading) Deleting ${i}`,a);await a,s.dispose()}this.updateContext()}),n.onDidHide(()=>n.dispose())}),d.commands.registerCommand("remoteHub.deleteAllLocalRepositoryData",()=>d.window.withProgress({location:d.ProgressLocation.Notification,title:"Deleting Search Indexes..."},async()=>{await Promise.all([d.workspace.fs.delete(this.root,{recursive:!0})]),this.updateContext()}))]}getTarFromMemory(e){var r;if(e===this.lastReadKey){const n=(r=this.lastReadValue)==null?void 0:r.deref();if(n)return n;Z.log("Weakref deallocated.")}}async getTarFromDisk(e){try{const r=await d.workspace.fs.readFile(e);return!r||!r.length?void 0:r}catch(r){if(r.code!=="FileNotFound")throw r;return}}async getTarFromNetwork(e){if(!await this.isIndexingEnabledForRepo(e))throw Error("Unable to search without indexing allowed");const r=await this.providerService.getTarGz(e);if(r===void 0)throw Error("Unable to search without an index");return this.updateContext(),r}async getTar(e,r){r===void 0&&({HEAD:{sha:r}}=await this.providerService.getMetadata(e)),e=this.providerService.getCanonicalUri(e);const n=this.getTarStorageUri(e,r),i=n.toString();try{let o=this.ongoingRequests.get(i);return o===void 0&&(o=this.getTarCore(e,r,n),this.ongoingRequests.set(i,o)),await o}finally{this.ongoingRequests.delete(i)}}async getCachedTar(e,r){return e=this.providerService.getCanonicalUri(e),this.getTarCore(e,r,this.getTarStorageUri(e,r),{skipDownload:!0})}async getTarCore(e,r,n,i){var o;const a=`${Eu(e,{excludeScheme:!0})}/${r}`,s=new $e(`TarPit.getTar(${a})`),c=n.toString(),l=Date.now();let u,f;try{if(s.logStep("Getting .tar from memory",{suffix:" \u2022 Getting .tar from memory..."}),f=this.getTarFromMemory(c),f)return u=" \u2022 Got .tar from memory",f;s.logStep("Getting .tar from disk",{message:": Not found \u2022",suffix:" \u2022 Getting .tar from disk..."});let h=!1,p=await this.getTarFromDisk(n);if(p==null?void 0:p.length)u=" \u2022 Got .tar from disk";else{if(i==null?void 0:i.skipDownload){u=" \u2022 Skipped download";return}s.logStep("Getting .tar from network",{message:": Not found \u2022",suffix:" \u2022 Getting .tar from network..."}),p=await this.getTarFromNetwork(e),h=!0,u=" \u2022 Got .tar from network",d.workspace.fs.writeFile(n,p).then(()=>Z.debug(`Sucessfully wrote tarball to disk in ${Date.now()-l}ms`),w=>Z.error(w,`Error writing tarball to disk in ${Date.now()-l}ms`))}if(!(p==null?void 0:p.length))throw new Error("Internal Error: Invalid search index. Try deleting repository data and running search again: `GitHub Repositories: Delete Local Repository Data...`");s.logStep("Unzipping .tar",{suffix:" \u2022 Unzipping .tar..."});const b=yy(p);s.logStep("Parsing .tar",{suffix:" \u2022 Parsing .tar..."}),f=(0,DR.t9)(b),s.logStep("Fixing up .tar entries",{suffix:" \u2022 Fixing up .tar entries..."});const y=[];for(const w of f.entries)((o=w.header.typeFlag)==null?void 0:o.name)==="Normal"&&(w.header.fullFileName=w.header.fullFileName.replace(/^[^/]+\/?/,""),y.push(w));return f.entries=y,this.lastReadValue=new Rk(f,Date.now()-l),this.lastReadKey=c,h&&setTimeout(()=>this._onDidDownloadTar.fire({rootUri:e,sha:r}),0),f}catch(h){throw u=` \u2022 Failed; ${String(h)}`,h}finally{f&&(this.markCacheEntryUsed(`${a}`).catch(h=>Z.log(`Error marking entry used: ${h}`)),this.cleanUpCache().catch(h=>Z.log(`Error cleaning cache: ${h}`))),s.stop(u?{suffix:u}:void 0)}}getTarStorageUri(e,r){return d.Uri.joinPath(this.root,"tars",Eu(e,{excludeScheme:!0}),r)}async readDir(e){try{return(await d.workspace.fs.readDirectory(e)).map(r=>d.Uri.joinPath(e,r[0]))}catch{return[]}}async isIndexingEnabledForRepo(e){const r=await this.getIndexingEnabledRepos();if(r.has("*"))return!0;const{name:n}=this.providerService.getVirtualUriMetadata(e);return n?r.has(n):!1}async configureIndexingAllowedRepos(){const e=[...(await this.getIndexingEnabledRepos()).values()],r=await d.window.showQuickPick(e.map(n=>({picked:!0,description:n==="*"?Ao("all","All Repositories"):"",label:n})),{canPickMany:!0,title:Ao("select repos where indexing is allowed","Select repositories that should be indexed")});r&&await this.resetIndexingAllowedRepos(r.map(n=>n.label))}async getIndexingEnabledRepos(){let e;try{e=JSON.parse(nu.decode(await d.workspace.fs.readFile(this.indexingAllowanceFile)))}catch(r){r instanceof d.FileSystemError&&r.code!==d.FileSystemError.FileNotFound().code&&Z.error(r,"Error reading index allowance data."),e=[]}return new Set(e)}async listTars(){const e=await this.readDir(d.Uri.joinPath(this.root,"tars")).catch(()=>[]),r=(await Promise.all(e.map(o=>this.readDir(o)))).flat(),n=(await Promise.all(r.map(o=>this.readDir(o)))).flat(),i=(await Promise.all(n.map(o=>this.readDir(o)))).flat();return Promise.all(i.map(async o=>({name:o.path.replace(/^.*\/tars\//,""),path:o,size:(await d.workspace.fs.stat(o)).size})))}async resetIndexingAllowedRepos(e){await d.workspace.fs.writeFile(this.indexingAllowanceFile,iu.encode(JSON.stringify(e))),await this.updateContext(),setTimeout(()=>this._onDidChangeIndexingEnablement.fire(),0)}async markIndexingEnabledForRepos(...e){let r;try{r=JSON.parse(nu.decode(await d.workspace.fs.readFile(this.indexingAllowanceFile)))}catch(n){n instanceof d.FileSystemError&&n.code!==d.FileSystemError.FileNotFound().code&&Z.error(n,"Error reading index allowance data."),r=[]}for(const n of e)r.includes(n)||r.push(n);await d.workspace.fs.writeFile(this.indexingAllowanceFile,iu.encode(JSON.stringify(r))),await this.updateContext(),setTimeout(()=>this._onDidChangeIndexingEnablement.fire(),0)}async markCacheEntryUsed(e){let r;try{r=JSON.parse(nu.decode(await d.workspace.fs.readFile(this.usageFile)))}catch(n){n instanceof d.FileSystemError&&n.code!==d.FileSystemError.FileNotFound().code&&Z.error(n,"Error reading usage data."),r={}}r[e]=Number(Date.now()),await d.workspace.fs.writeFile(this.usageFile,iu.encode(JSON.stringify(r)))}async cleanUpCache(){var e,r;Z.log("Cleaning up search cache...");const n=await this.listTars();let i;try{i=JSON.parse(nu.decode(await d.workspace.fs.readFile(this.usageFile)))}catch(f){f instanceof d.FileSystemError&&f.code!==d.FileSystemError.FileNotFound().code&&Z.error(f,"Error reading usage data. All existing indexes will be discarded."),i={}}const o=[];n.forEach(f=>{var h;const p=/^([^/]*\/[^/]*)\//.exec(f.name);if(!p)throw Error("Unexpected repo entry");const b=p[1],y=(h=i[f.name])!=null?h:0;o.push({...f,lastUsed:y,repo:b})}),o.sort((f,h)=>h.lastUsed-f.lastUsed);let a=0;const s=[],c=new Map,l=((e=Je.get("search.download.sizeLimit"))!=null?e:100)*1024*1024,u=(r=Je.get("search.download.repoLimit"))!=null?r:4;o.forEach(f=>{var h,p;(f.lastUsed===0||a>l||((h=c.get(f.repo))!=null?h:0)>u)&&s.push(f),a+=f.size,c.set(f.repo,((p=c.get(f.repo))!=null?p:0)+1)}),await Promise.all(s.map(async f=>{try{await d.workspace.fs.delete(f.path,{recursive:!0}),delete i[f.name],Z.log(`Deleted cache entry for ${f.name}`)}catch(h){Z.log(`Deleting cache entry for ${f.name} failed; ${String(h)}`)}})),await d.workspace.fs.writeFile(this.usageFile,iu.encode(JSON.stringify(i))),await this.updateContext()}}const Tk=(0,C.loadMessageBundle)();async function kk(t,e,r,n,i,o,a){return If("provideTextSearchResults",async()=>{const s=TR(n.pattern,Boolean(n.isRegExp),{matchCase:n.isCaseSensitive,wholeWord:n.isWordMatch,multiline:n.isMultiline,global:!0}),c=await If("fetch tarball",async()=>{let w;const _=r.getTar(i.folder).then(S=>(w=S,w));return Promise.race([_,(async()=>(await new Promise(S=>setTimeout(S,2e3)),w||d.window.withProgress({location:d.ProgressLocation.Notification,title:Tk("fetching index","Fetching search index...")},()=>_)))()])});if(a.isCancellationRequested)return{limitHit:!1};const{maxResults:l,maxFileSize:u,includes:f,excludes:h}=i,p=await Ik(i.folder,t,c,e);if(a.isCancellationRequested)return{limitHit:!0};let b=l;const y=kR(p,f,h,u);return If("searchFiles",async()=>{var w,_;let S=0;for(const I of p){if(!y.has(I.path))continue;const D=IR(I.contents,I.path,s,{beforeContext:(w=i.beforeContext)!=null?w:0,afterContext:(_=i.afterContext)!=null?_:0,previewOptions:i.previewOptions,remainingResultQuota:b});for(const O of D)o.report({...O,uri:d.Uri.joinPath(i.folder,O.uri.path)});if(b-=D.length,b<=0)return{limitHit:!0};if(S++,S%1e4==0&&(await new Promise(O=>setTimeout(O,0)),a.isCancellationRequested))return{limitHit:!1}}return{limitHit:!1}})})}async function Ik(t,e,r,n){const i=r.entries,o=e.getVirtualRootUri(t),a=await n.getChanges(o,{predicate:f=>f.fileType===d.FileType.File});if(a.length===0)return i.map(f=>({contents:f.dataAsBytes,path:f.header.fullFileName,size:f.dataAsBytes.byteLength}));const s=await Promise.all(yc(a,f=>{if(f.type===rt.Created)return n.getContent(f.uri).then(h=>({path:e.getRelativeFilePath(o,f.uri),size:h.length,contents:h}))})),c=await Promise.all(yc(a,f=>{if(f.type===rt.Changed)return n.getContent(f.uri).then(h=>({path:e.getRelativeFilePath(o,f.uri),size:h.length,contents:h}))})),l=new Set(DS(Wa(c,f=>f.path),yc(a,f=>{if(f.type===rt.Deleted)return e.getRelativeFilePath(o,f.uri)})));return[...yc(i,f=>{if(!l.has(f.header.fullFileName))return{contents:f.dataAsBytes,path:f.header.fullFileName,size:f.dataAsBytes.byteLength}}),...s,...c]}function $D(t,e){const r=Date.now(),n=e();return Logger.log(`${t} time: ${Date.now()-r}`),n}async function If(t,e){const r=Date.now(),n=await e();return Z.log(`${t} time: ${Date.now()-r}`),n}var Dk=Object.defineProperty,Pk=Object.getOwnPropertyDescriptor,Df=(t,e,r,n)=>{for(var i=n>1?void 0:n?Pk(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&Dk(e,r,i),i};const Pf=(0,C.loadMessageBundle)(),Fk=d.FileSystemError.FileNotFound().code,Nk=/(\/|\\)/g,by=".vscode/.github-pull-request.rec";class ou{constructor(e,r,n,i){this.providerService=e,this.github=r,this.changeStore=n,this.tarPit=i,this._onDidChangeFile=new d.EventEmitter,this.fileSearchCache=new Map,this.pendingUriRequests=new Map,this.pendingUriRequestsEventDelay=10,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.disposable=d.Disposable.from(d.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0,isReadonly:!0}),d.workspace.registerFileSearchProvider(this.scheme,this),d.workspace.registerTextSearchProvider(this.scheme,this),e.onDidChangeRepository(o=>{o.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([o.repository.uri])}),e.onDidRefresh(o=>this.onRefreshOrRepositoryChanged(o)))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return this.github.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){if(e=e.filter(r=>Pt.getProviderId(r)===this.scheme).map(r=>this.providerService.getProviderUri(r)),e.length!==0){Z.log(`GitHubFS.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.fileSearchCache.clear();for(const[r,n]of[...this.pendingUriRequests])e.some(i=>Gn(n.uri,i))&&(this.pendingUriRequests.delete(r),n.outdated=!0);this.updateOpenOrWatchedUris(e)}}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,o]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(a=>Gn(o,a))&&(this.implicitlyWatchedUris.delete(i),r.set(i,o));Z.debug(`GitHubFS.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(we(i),i);const n=[...r.values()].map(i=>({type:d.FileChangeType.Changed,uri:i}));setTimeout(()=>{Z.debug(`GitHubFS.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=we(e);return this.watchedUris.set(n,e),{dispose:()=>{this.watchedUris.delete(n)}}}async stat(e){var r,n;const i=we(e);this.implicitlyWatchedUris.set(i,e);const o=this.providerService.getRelativeFilePath(e),a={uri:e,outdated:!1};try{this.pendingUriRequests.set(`stat:${i}`,a);const s=await this.github.getFileTree(e),c=await s.get(o);if(c==null?void 0:c.stat)return c==null?void 0:c.stat;if(this.implicitlyWatchedUris.delete(i),e.query==="~")return{type:d.FileType.File,size:0,ctime:0,mtime:(r=s.timestamp)!=null?r:Date.now(),permissions:d.FilePermission.Readonly};if(o===by){const{ref:l}=this.providerService.getVirtualUriMetadata(e);if((l==null?void 0:l.type)===Ue.PullRequest)return{type:d.FileType.File,size:0,ctime:0,mtime:(n=s.timestamp)!=null?n:Date.now(),permissions:d.FilePermission.Readonly}}throw d.FileSystemError.FileNotFound(e)}finally{this.pendingUriRequests.delete(`stat:${i}`),(a==null?void 0:a.outdated)&&setTimeout(()=>{Z.log(`GitHubFS.stat(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:d.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}async readDirectory(e,r){this.implicitlyWatchedUris.set(we(e),e);const n=await this.github.getFileTree(e),i=this.providerService.getRelativeFilePath(e),o=(await n.getChildren(i,r)).map(([a,{stat:{type:s}}])=>[a,s]);return i===""&&$e.stop("Time to root directory"),o}createDirectory(e){throw d.FileSystemError.NoPermissions()}async readFile(e){const r=we(e);this.implicitlyWatchedUris.set(r,e);const n={uri:e,outdated:!1};try{return this.pendingUriRequests.set(r,n),await this.github.getFileContent(e)}catch(i){if(this.implicitlyWatchedUris.delete(r),i instanceof d.FileSystemError&&i.code===Fk){if(e.query==="~")return new Uint8Array(0);if(this.providerService.getRelativeFilePath(e)===by){const{ref:a}=this.providerService.getVirtualUriMetadata(e);if((a==null?void 0:a.type)===Ue.PullRequest)return new Uint8Array(0)}}throw i}finally{this.pendingUriRequests.delete(r),(n==null?void 0:n.outdated)&&setTimeout(()=>{Z.log(`GitHubFS.readFile(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:d.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}writeFile(e,r,n){throw d.FileSystemError.NoPermissions()}delete(e,r){throw d.FileSystemError.NoPermissions()}rename(e,r,n){throw d.FileSystemError.NoPermissions()}copy(e,r,n){throw d.FileSystemError.NoPermissions()}async provideFileSearchResults(e,{folder:r,maxResults:n,includes:i,excludes:o},a){const s=`${we(r)}|${JSON.stringify({includes:i,excludes:o})}`;let c=this.fileSearchCache.get(s);if(c===void 0){const u=this.providerService.getRelativeFilePath(r);let f;await this.github.hasFileTree(r)&&(f=await this.github.getFileTree(r));let h;if(f===void 0||f.loading||!f.hasEntireTree?h=await this.github.getFileList(r,u):h=(await f.getChildren(u,{filter:d.FileType.File,recursive:!0})).map(([p])=>p),h.length===0||a.isCancellationRequested)return[];((i==null?void 0:i.length)||(o==null?void 0:o.length))&&(h=[...Uh(h,i,o)]),c=h.map(p=>ha.prepareSlow(p)),this.fileSearchCache.set(s,c)}let l;return e.pattern===""?l=c.map(u=>d.Uri.joinPath(r,u.target)):(l=ha.go(e.pattern.replace(Nk,"/"),c,{allowTypo:!0,limit:n}).map(u=>d.Uri.joinPath(r,u.target)),ha.cleanup()),n!==void 0&&n!==0&&n<l.length&&(l=l.slice(0,n)),l}async provideTextSearchResults(e,r,n,i){const o=[];if(await this.tarPit.isIndexingEnabledForRepo(r.folder))try{return kk(this.providerService,this.changeStore,this.tarPit,e,r,n,i)}catch{o.push({text:Pf("index error","Error searching index, falling back to GitHub search. Try [deleting this repo's data]({0}) or [deleting all local data]({1}) to rebuild the index.","command:remoteHub.deleteLocalRepositoryData","command:remoteHub.deleteAllLocalRepositoryData"),type:d.TextSearchCompleteMessageType.Warning})}e.isCaseSensitive||e.isRegExp||e.isWordMatch?o.push({text:Pf("flags not supported","Search flags are not supported by GitHub search. [Enable indexing]({0}) for full search features and exact text searches.","command:remoteHub.enableIndexing"),type:d.TextSearchCompleteMessageType.Warning,trusted:!0}):o.push({text:Pf("enable index","Currently using GitHub text search. [Enable indexing]({0}) for exact text searches.","command:remoteHub.enableIndexing"),type:d.TextSearchCompleteMessageType.Information,trusted:!0});const a=await this.github.searchCodeQuery(e.pattern,r.folder,{maxResults:r.maxResults,context:{before:r.beforeContext,after:r.afterContext}});if(a.warnings&&a.warnings.forEach(c=>{o.push({text:c,trusted:!0,type:d.TextSearchCompleteMessageType.Warning})}),a===void 0)return{limitHit:!0,message:o};let s;for(const c of a.matches)s=d.Uri.joinPath(r.folder,c.path),n.report({uri:s,ranges:c.ranges,preview:{text:c.preview,matches:c.matches}});return{limitHit:!1,message:o}}}Df([xn()],ou.prototype,"stat",1),Df([xn()],ou.prototype,"readDirectory",1),Df([xn()],ou.prototype,"readFile",1);var $k=__webpack_require__(6470),Js=__webpack_require__(4155);function au(){return typeof navigator=="object"&&"userAgent"in navigator?navigator.userAgent:typeof Js=="object"&&"version"in Js?`Node.js/${Js.version.substr(1)} (${Js.platform}; ${Js.arch})`:"<environment undetectable>"}var Mk=__webpack_require__(5186);/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function _y(t){return Object.prototype.toString.call(t)==="[object Object]"}function xy(t){var e,r;return _y(t)===!1?!1:(e=t.constructor,e===void 0?!0:(r=e.prototype,!(_y(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)))}function Bk(t){return t?Object.keys(t).reduce((e,r)=>(e[r.toLowerCase()]=t[r],e),{}):{}}function Sy(t,e){const r=Object.assign({},t);return Object.keys(e).forEach(n=>{xy(e[n])?n in t?r[n]=Sy(t[n],e[n]):Object.assign(r,{[n]:e[n]}):Object.assign(r,{[n]:e[n]})}),r}function Cy(t){for(const e in t)t[e]===void 0&&delete t[e];return t}function Ff(t,e,r){if(typeof e=="string"){let[i,o]=e.split(" ");r=Object.assign(o?{method:i,url:o}:{url:i},r)}else r=Object.assign({},e);r.headers=Bk(r.headers),Cy(r),Cy(r.headers);const n=Sy(t||{},r);return t&&t.mediaType.previews.length&&(n.mediaType.previews=t.mediaType.previews.filter(i=>!n.mediaType.previews.includes(i)).concat(n.mediaType.previews)),n.mediaType.previews=n.mediaType.previews.map(i=>i.replace(/-preview/,"")),n}function Ok(t,e){const r=/\?/.test(t)?"&":"?",n=Object.keys(e);return n.length===0?t:t+r+n.map(i=>i==="q"?"q="+e.q.split("+").map(encodeURIComponent).join("+"):`${i}=${encodeURIComponent(e[i])}`).join("&")}const Uk=/\{[^}]+\}/g;function Lk(t){return t.replace(/^\W+|\W+$/g,"").split(/,/)}function Hk(t){const e=t.match(Uk);return e?e.map(Lk).reduce((r,n)=>r.concat(n),[]):[]}function Ey(t,e){return Object.keys(t).filter(r=>!e.includes(r)).reduce((r,n)=>(r[n]=t[n],r),{})}function Ry(t){return t.split(/(%[0-9A-Fa-f]{2})/g).map(function(e){return/%[0-9A-Fa-f]/.test(e)||(e=encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]")),e}).join("")}function Ea(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function ec(t,e,r){return e=t==="+"||t==="#"?Ry(e):Ea(e),r?Ea(r)+"="+e:e}function Ra(t){return t!=null}function Nf(t){return t===";"||t==="&"||t==="?"}function qk(t,e,r,n){var i=t[r],o=[];if(Ra(i)&&i!=="")if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")i=i.toString(),n&&n!=="*"&&(i=i.substring(0,parseInt(n,10))),o.push(ec(e,i,Nf(e)?r:""));else if(n==="*")Array.isArray(i)?i.filter(Ra).forEach(function(a){o.push(ec(e,a,Nf(e)?r:""))}):Object.keys(i).forEach(function(a){Ra(i[a])&&o.push(ec(e,i[a],a))});else{const a=[];Array.isArray(i)?i.filter(Ra).forEach(function(s){a.push(ec(e,s))}):Object.keys(i).forEach(function(s){Ra(i[s])&&(a.push(Ea(s)),a.push(ec(e,i[s].toString())))}),Nf(e)?o.push(Ea(r)+"="+a.join(",")):a.length!==0&&o.push(a.join(","))}else e===";"?Ra(i)&&o.push(Ea(r)):i===""&&(e==="&"||e==="?")?o.push(Ea(r)+"="):i===""&&o.push("");return o}function Wk(t){return{expand:zk.bind(null,t)}}function zk(t,e){var r=["+","#",".","/",";","?","&"];return t.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(n,i,o){if(i){let s="";const c=[];if(r.indexOf(i.charAt(0))!==-1&&(s=i.charAt(0),i=i.substr(1)),i.split(/,/g).forEach(function(l){var u=/([^:\*]*)(?::(\d+)|(\*))?/.exec(l);c.push(qk(e,s,u[1],u[2]||u[3]))}),s&&s!=="+"){var a=",";return s==="?"?a="&":s!=="#"&&(a=s),(c.length!==0?s:"")+c.join(a)}else return c.join(",")}else return Ry(o)})}function Ay(t){let e=t.method.toUpperCase(),r=(t.url||"/").replace(/:([a-z]\w+)/g,"{$1}"),n=Object.assign({},t.headers),i,o=Ey(t,["method","baseUrl","url","headers","request","mediaType"]);const a=Hk(r);r=Wk(r).expand(o),/^http/.test(r)||(r=t.baseUrl+r);const s=Object.keys(t).filter(u=>a.includes(u)).concat("baseUrl"),c=Ey(o,s);if(!/application\/octet-stream/i.test(n.accept)&&(t.mediaType.format&&(n.accept=n.accept.split(/,/).map(u=>u.replace(/application\/vnd(\.\w+)(\.v3)?(\.\w+)?(\+json)?$/,`application/vnd$1$2.${t.mediaType.format}`)).join(",")),t.mediaType.previews.length)){const u=n.accept.match(/[\w-]+(?=-preview)/g)||[];n.accept=u.concat(t.mediaType.previews).map(f=>{const h=t.mediaType.format?`.${t.mediaType.format}`:"+json";return`application/vnd.github.${f}-preview${h}`}).join(",")}return["GET","HEAD"].includes(e)?r=Ok(r,c):"data"in c?i=c.data:Object.keys(c).length?i=c:n["content-length"]=0,!n["content-type"]&&typeof i!="undefined"&&(n["content-type"]="application/json; charset=utf-8"),["PATCH","PUT"].includes(e)&&typeof i=="undefined"&&(i=""),Object.assign({method:e,url:r,headers:n},typeof i!="undefined"?{body:i}:null,t.request?{request:t.request}:null)}function jk(t,e,r){return Ay(Ff(t,e,r))}function Ty(t,e){const r=Ff(t,e),n=jk.bind(null,r);return Object.assign(n,{DEFAULTS:r,defaults:Ty.bind(null,r),merge:Ff.bind(null,r),parse:Ay})}const Vk=`octokit-endpoint.js/6.0.12 ${au()}`,Gk=Ty(null,{method:"GET",baseUrl:"https://api.github.com",headers:{accept:"application/vnd.github.v3+json","user-agent":Vk},mediaType:{format:"",previews:[]}});var Kk=__webpack_require__(3672),Zk=__webpack_require__.n(Kk);class ky extends Error{constructor(e){super(e);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="Deprecation"}}var Xk=__webpack_require__(447),Iy=__webpack_require__.n(Xk);const Qk=Iy()(t=>console.warn(t)),Yk=Iy()(t=>console.warn(t));class zn extends Error{constructor(e,r,n){super(e);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="HttpError",this.status=r;let i;"headers"in n&&typeof n.headers!="undefined"&&(i=n.headers),"response"in n&&(this.response=n.response,i=n.response.headers);const o=Object.assign({},n.request);n.request.headers.authorization&&(o.headers=Object.assign({},n.request.headers,{authorization:n.request.headers.authorization.replace(/ .*$/," [REDACTED]")})),o.url=o.url.replace(/\bclient_secret=\w+/g,"client_secret=[REDACTED]").replace(/\baccess_token=\w+/g,"access_token=[REDACTED]"),this.request=o,Object.defineProperty(this,"code",{get(){return Qk(new ky("[@octokit/request-error] `error.code` is deprecated, use `error.status`.")),r}}),Object.defineProperty(this,"headers",{get(){return Yk(new ky("[@octokit/request-error] `error.headers` is deprecated, use `error.response.headers`.")),i||{}}})}}const Jk="5.6.1";function eI(t){return t.arrayBuffer()}function Dy(t){const e=t.request&&t.request.log?t.request.log:console;(xy(t.body)||Array.isArray(t.body))&&(t.body=JSON.stringify(t.body));let r={},n,i;return(t.request&&t.request.fetch||Zk())(t.url,Object.assign({method:t.method,body:t.body,headers:t.headers,redirect:t.redirect},t.request)).then(async a=>{i=a.url,n=a.status;for(const s of a.headers)r[s[0]]=s[1];if("deprecation"in r){const s=r.link&&r.link.match(/<([^>]+)>; rel="deprecation"/),c=s&&s.pop();e.warn(`[@octokit/request] "${t.method} ${t.url}" is deprecated. It is scheduled to be removed on ${r.sunset}${c?`. See ${c}`:""}`)}if(!(n===204||n===205)){if(t.method==="HEAD"){if(n<400)return;throw new zn(a.statusText,n,{response:{url:i,status:n,headers:r,data:void 0},request:t})}if(n===304)throw new zn("Not modified",n,{response:{url:i,status:n,headers:r,data:await $f(a)},request:t});if(n>=400){const s=await $f(a);throw new zn(tI(s),n,{response:{url:i,status:n,headers:r,data:s},request:t})}return $f(a)}}).then(a=>({status:n,url:i,headers:r,data:a})).catch(a=>{throw a instanceof zn?a:new zn(a.message,500,{request:t})})}async function $f(t){const e=t.headers.get("content-type");return/application\/json/.test(e)?t.json():!e||/^text\/|charset=utf-8$/.test(e)?t.text():eI(t)}function tI(t){return typeof t=="string"?t:"message"in t?Array.isArray(t.errors)?`${t.message}: ${t.errors.map(JSON.stringify).join(", ")}`:t.message:`Unknown error: ${JSON.stringify(t)}`}function Mf(t,e){const r=t.defaults(e);return Object.assign(function(i,o){const a=r.merge(i,o);if(!a.request||!a.request.hook)return Dy(r.parse(a));const s=(c,l)=>Dy(r.parse(r.merge(c,l)));return Object.assign(s,{endpoint:r,defaults:Mf.bind(null,r)}),a.request.hook(s,a)},{endpoint:r,defaults:Mf.bind(null,r)})}const su=Mf(Gk,{headers:{"user-agent":`octokit-request.js/${Jk} ${au()}`}}),rI="4.8.0";function nI(t){return`Request failed due to following response errors:
`+t.errors.map(e=>` - ${e.message}`).join(`
`)}class tc extends Error{constructor(e,r,n){super(nI(n));this.request=e,this.headers=r,this.response=n,this.name="GraphqlResponseError",this.errors=n.errors,this.data=n.data,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}const iI=["method","baseUrl","url","headers","request","query","mediaType"],oI=["query","method","url"],Py=/\/api\/v3\/?$/;function aI(t,e,r){if(r){if(typeof e=="string"&&"query"in r)return Promise.reject(new Error('[@octokit/graphql] "query" cannot be used as variable name'));for(const a in r)if(!!oI.includes(a))return Promise.reject(new Error(`[@octokit/graphql] "${a}" cannot be used as variable name`))}const n=typeof e=="string"?Object.assign({query:e},r):e,i=Object.keys(n).reduce((a,s)=>iI.includes(s)?(a[s]=n[s],a):(a.variables||(a.variables={}),a.variables[s]=n[s],a),{}),o=n.baseUrl||t.endpoint.DEFAULTS.baseUrl;return Py.test(o)&&(i.url=o.replace(Py,"/api/graphql")),t(i).then(a=>{if(a.data.errors){const s={};for(const c of Object.keys(a.headers))s[c]=a.headers[c];throw new tc(i,s,a.data)}return a.data.data})}function Bf(t,e){const r=t.defaults(e);return Object.assign((i,o)=>aI(r,i,o),{defaults:Bf.bind(null,r),endpoint:su.endpoint})}const OD=Bf(su,{headers:{"user-agent":`octokit-graphql.js/${rI} ${au()}`},method:"POST",url:"/graphql"});function sI(t){return Bf(t,{method:"POST",url:"/graphql"})}const cI=/^v1\./,lI=/^ghs_/,uI=/^ghu_/;async function dI(t){const e=t.split(/\./).length===3,r=cI.test(t)||lI.test(t),n=uI.test(t);return{type:"token",token:t,tokenType:e?"app":r?"installation":n?"user-to-server":"oauth"}}function hI(t){return t.split(/\./).length===3?`bearer ${t}`:`token ${t}`}async function fI(t,e,r,n){const i=e.endpoint.merge(r,n);return i.headers.authorization=hI(t),e(i)}const pI=function(e){if(!e)throw new Error("[@octokit/auth-token] No token passed to createTokenAuth");if(typeof e!="string")throw new Error("[@octokit/auth-token] Token passed to createTokenAuth is not a string");return e=e.replace(/^(token|bearer) +/i,""),Object.assign(dI.bind(null,e),{hook:fI.bind(null,e)})},Fy="3.5.1";class cu{constructor(e={}){const r=new Mk.Collection,n={baseUrl:su.endpoint.DEFAULTS.baseUrl,headers:{},request:Object.assign({},e.request,{hook:r.bind(null,"request")}),mediaType:{previews:[],format:""}};if(n.headers["user-agent"]=[e.userAgent,`octokit-core.js/${Fy} ${au()}`].filter(Boolean).join(" "),e.baseUrl&&(n.baseUrl=e.baseUrl),e.previews&&(n.mediaType.previews=e.previews),e.timeZone&&(n.headers["time-zone"]=e.timeZone),this.request=su.defaults(n),this.graphql=sI(this.request).defaults(n),this.log=Object.assign({debug:()=>{},info:()=>{},warn:console.warn.bind(console),error:console.error.bind(console)},e.log),this.hook=r,e.authStrategy){const{authStrategy:o,...a}=e,s=o(Object.assign({request:this.request,log:this.log,octokit:this,octokitOptions:a},e.auth));r.wrap("request",s.hook),this.auth=s}else if(!e.auth)this.auth=async()=>({type:"unauthenticated"});else{const o=pI(e.auth);r.wrap("request",o.hook),this.auth=o}this.constructor.plugins.forEach(o=>{Object.assign(this,o(this,e))})}static defaults(e){return class extends this{constructor(...n){const i=n[0]||{};if(typeof e=="function"){super(e(i));return}super(Object.assign({},e,i,i.userAgent&&e.userAgent?{userAgent:`${i.userAgent} ${e.userAgent}`}:null))}}}static plugin(...e){var r;const n=this.plugins;return r=class extends this{},r.plugins=n.concat(e.filter(o=>!n.includes(o))),r}}cu.VERSION=Fy,cu.plugins=[];function gI(t,e){return t.reduce((n,i)=>{const o=e(i),a=n.get(o);return a===void 0?n.set(o,[i]):a.push(i),n},new Map)}function mI(t){let e=0;for(const r of t){if(r===0)return!0;if(e++,e>8e3)break}return!1}function Of(t,e,r=n=>n){return[...t.reduce((i,o)=>{const a=e(o),s=i.get(a);if(s===void 0)i.set(a,o);else{const c=r(s,o);c!==void 0&&i.set(a,c)}return i},new Map).values()]}function Uf(t){const e="$memoize$";return function(...r){return this.hasOwnProperty(e)||Object.defineProperty(this,e,{configurable:!1,enumerable:!1,writable:!1,value:t.apply(this,r)}),this[e]}}class Ny{constructor(e,r){this.path=e,this.relativePath=r}}class vI{constructor(){this.root=new Ny("","")}get(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;for(const i of e.split("/")){const o=(r=n.children)==null?void 0:r.get(i);if(o===void 0)return;n=o}return n.path===e?n.data:void 0}getChildren(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;if(e)for(const i of e.split("/")){const o=(r=n.children)==null?void 0:r.get(i);if(o===void 0)return[];n=o}return n.children===void 0?[]:[...n.children.values()].map(i=>[i.relativePath,i.data])}getDescendants(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;const i=[];if(e)for(const o of e.split("/")){const a=(r=n.children)==null?void 0:r.get(o);if(a===void 0)return i;n=a}if(n.children!==void 0){let o=function(a,s,c){for(const l of a.values()){const u=`${s?`${s}/`:""}${l.relativePath}`;l.data&&c.push([u,l.data]),l.children!==void 0&&o(l.children,u,c)}};o(n.children,"",i)}return i}has(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;for(const i of e.split("/")){const o=(r=n.children)==null?void 0:r.get(i);if(o===void 0)return!1;n=o}return n.path===e}set(e,r){var n;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let i=this.root,o="";for(const a of e.split("/")){let s=(n=i.children)==null?void 0:n.get(a);o=`${o?`${o}/`:""}${a}`,s===void 0&&(i.children===void 0&&(i.children=new Map),s=new Ny(o,a),i.children.set(a,s)),i=s}i.data=r}}class $y{constructor(e,r,n,i,o){if(this.rootUri=e,this.sha=r,this.timestamp=n,this.provider=i,this.trie=new vI,this._hasEntireTree=!1,this._isContentCached=!1,i===void 0)return;const a=[i];i.onDidTriggerContentCaching!==void 0&&i.tryCachingContent!==void 0&&a.push(i.onDidTriggerContentCaching(s=>{(!s||we(s.rootUri)===we(this.rootUri)&&s.sha===this.sha)&&!this.loading&&this.hasEntireTree&&!this.isContentCached&&i.tryCachingContent(this.trie.get.bind(this.trie)).then(c=>this._isContentCached=c,()=>this._isContentCached=!0)})),this._loading=this.load(o==null?void 0:o.path,o==null?void 0:o.recursive).then(s=>{var c;return this._hasEntireTree=(c=s==null?void 0:s.recursive)!=null?c:!1,this._hasEntireTree&&setTimeout(()=>{var l;return void((l=i.tryCachingContent)==null?void 0:l.call(i,this.trie.get.bind(this.trie)).then(u=>this._isContentCached=u,()=>this._isContentCached=!0))},0),this._loading=void 0,this.preloading=void 0,this.treeSha=s==null?void 0:s.sha,this.treeSha}),(o==null?void 0:o.preload)&&(this.preloading=new Map([["",this.load("")],[".vscode",this.load(".vscode")]])),this.disposable=d.Disposable.from(...a)}get hasEntireTree(){return this._hasEntireTree}get isContentCached(){return this._isContentCached}get loading(){return this._loading!==void 0}get permissions(){var e;return(e=this.provider)==null?void 0:e.permissions}dispose(){var e;(e=this.disposable)==null||e.dispose()}async get(e){var r;if(e==="")return{mode:"040000",sha:this.treeSha,stat:{type:d.FileType.Directory,size:0,ctime:0,mtime:(r=this.timestamp)!=null?r:Date.now(),permissions:await this.permissions},getContent:void 0};let n=this.trie.get(e);return n!==void 0||(await this.ensureLoaded(e),n=this.trie.get(e)),n}async getChildren(e,r){await this.ensureLoaded(e,!0);const n=(r==null?void 0:r.recursive)?this.trie.getDescendants(e):this.trie.getChildren(e);return(r==null?void 0:r.filter)===void 0?n:n.filter(([,i])=>i.stat.type===r.filter)}async getTreeSha(){return await this.waitUntilLoaded(),this.treeSha}async waitUntilLoaded(){this._loading!==void 0&&await this._loading}async ensureLoaded(e,r=!1){if(this._loading!==void 0){let i;if(this.preloading!==void 0)if(r)i=this.preloading.get(e);else{const o=kS(this.preloading,([a])=>e.startsWith(a)&&e.lastIndexOf("/")===(a?a.length:-1));i=o==null?void 0:o[1]}await(i!=null?i:this._loading)}if(this.hasEntireTree||e==="")return;let n=this.trie.get(e);if(n)return r&&(n==null?void 0:n.loadChildren)?n.loadChildren():void 0;if(await this.ensureLoaded(e.substr(0,e.lastIndexOf("/")),!0),n=this.trie.get(e),r&&(n==null?void 0:n.loadChildren))return n.loadChildren()}async load(e,r=!1){var n;if(((n=this.provider)==null?void 0:n.getTree)===void 0)return;const i=new $e(`FileTree.load(${this.sha}:${e})`);let o;try{i.logStep("Tree query");const a=await this.provider.getTree(e,r);if(a===void 0)return;if(a.truncated){Z.warn(`Loading file tree for path=${e} was truncated`),i.logStep("Fixing directories",{message:`: Tree=${a.sha};`,suffix:" \u2022 Fixing directories..."});for(const[c,l]of this.trie.getDescendants(""))l.stat.type===d.FileType.Directory&&(l.loadChildren=Uf(()=>this.load(c).then(()=>l.loadChildren=void 0)));return o=` \u2022 Tree=${a.sha} \u2022 Truncated`,{sha:a.sha,recursive:!1}}let s;this.permissions!==void 0&&(i.logStep("Permissions query",{message:`: Tree=${a.sha};`,suffix:" \u2022 Waiting for permissions..."}),s=await this.permissions),i.logStep("Filling trie",{suffix:" \u2022 Filling trie..."});for(let{path:c,item:l}of a.tree)if(c!==void 0){switch(c=e?`${e}/${c}`:c,l.stat.permissions=s,l.stat.type){case d.FileType.File:l.getContent=Uf(()=>this.provider.getContent(l));break;case d.FileType.Directory:r||(l.loadChildren=Uf(()=>this.load(c).then(()=>l.loadChildren=void 0)));break}this.trie.set(c,l)}return o=` \u2022 Tree=${a.sha}`,{sha:a.sha,recursive:r}}catch(a){o=`\u2022 Loading for path=${e} failed; ${String(a)}`;return}finally{i.stop(o?{suffix:o}:void 0)}}}var wI=__webpack_require__(7769);const yI="github-pr-owner-number";function bI(t){return`branch.${t}.${yI}`}const _I=(0,C.loadMessageBundle)(),My=new TextDecoder;class xI{constructor(e,r,n,i,o,a){this.providerService=e,this.rootUri=r,this.sourceControl=n,this.metadata=i,this.changeStore=o,this.github=a,this._onDidChangeSelection=new d.EventEmitter,this._onDidChangeState=new d.EventEmitter,this._objects=new Map,this.disposable=d.Disposable.from(this.sourceControl.onDidChangeSelection(()=>this._onDidChangeSelection.fire()),this.providerService.onDidRefresh(l=>{const u=we(this.rootUri);!l.some(f=>we(f)===u)||this.updateState(this.metadata)}),this.providerService.onDidChangeRepository(async({repository:l})=>{we(this.rootUri)===we(l.uri)&&this.updateState(await l.getMetadata())}),this.changeStore.onDidChange(()=>this.updateState(this.metadata)),this._onDidChangeSelection,this._onDidChangeState),this._inputBox={get value(){return n.inputBox.value},set value(l){n.inputBox.value=l}},this._ui={get selected(){return n.selected},onDidChange:this._onDidChangeSelection.event};const{repo:{owner:s,name:c}}=i;this.remote={name:"origin",fetchUrl:`https://github.com/${s}/${c}.git`,isReadOnly:i.accessLevel<$t.Write},this.remotes=[this.remote],this._state={HEAD:this.getHEADFromMetadata(i),mergeChanges:[],indexChanges:[],workingTreeChanges:[],onDidChange:this._onDidChangeState.event,rebaseCommit:void 0,refs:[],remotes:this.remotes,submodules:[]},this.updateState(i)}dispose(){this.disposable.dispose()}get inputBox(){return this._inputBox}get state(){return this._state}get ui(){return this._ui}getHEADFromMetadata(e){switch(e.HEAD.type){case Le.Branch:return{type:Nn.Head,commit:e.HEAD.sha,name:e.HEAD.branch.name,upstream:{name:e.HEAD.branch.name,remote:this.remote.name}};case Le.RemoteBranch:{const r=e.HEAD.branch.remote.repo.owner,n=e.HEAD.branch.remote.accessLevel<$t.Write,i=this.remotes.findIndex(o=>o.name===r);return this.remotes.splice(i===-1?this.remotes.length:i,i===-1?0:1,{name:r,fetchUrl:`https://github.com/${e.HEAD.branch.remote.repo.owner}/${e.HEAD.branch.remote.repo.name}.git`,pushUrl:n?void 0:`https://github.com/${e.HEAD.branch.remote.repo.owner}/${e.HEAD.branch.remote.repo.name}.git`,isReadOnly:n}),{type:Nn.RemoteHead,commit:e.HEAD.sha,name:e.HEAD.branch.name,upstream:{name:e.HEAD.branch.name,remote:e.HEAD.branch.remote.repo.owner}}}case Le.Tag:return{type:Nn.Tag,name:e.HEAD.detached.name,commit:e.HEAD.sha};case Le.Commit:return{type:Nn.Head,commit:e.HEAD.sha}}}async updateState(e){this.metadata=e;const r=await this.changeStore.getGroupedChanges(this.rootUri,{predicate:s=>s.fileType===d.FileType.File}),n=r.conflicts.map(s=>({uri:s.uri,status:Lf(s.type),originalUri:s.uri,renameUri:s.uri})),i=r.staged.map(s=>({uri:s.uri,status:Lf(s.type),originalUri:s.uri,renameUri:s.uri})),o=r.working.map(s=>({uri:s.uri,status:Lf(s.type),originalUri:s.uri,renameUri:s.uri})),a=Je.get("staging.enabled");this._state={...this._state,HEAD:this.getHEADFromMetadata(e),mergeChanges:n,indexChanges:a?i:[],workingTreeChanges:a?o:[...i,...o]},this._onDidChangeState.fire()}getConfigs(){return Promise.resolve([])}getConfig(e){return this.metadata.HEAD.branch&&this.metadata.pullRequest&&e===bI(this.metadata.HEAD.branch.name)?Promise.resolve(`${this.metadata.repo.owner}#${this.metadata.repo.name}#${this.metadata.pullRequest.id}`):Promise.resolve("")}setConfig(e,r){return Promise.resolve("")}getGlobalConfig(e){throw new Error("Method not implemented.")}async getObjectDetails(e,r){const n=new $e(`IGit.getObjectDetails(${e}, ${r})`);try{return await this.github.getObjectDetails(this.rootUri,e,this.pathToRelativePath(r))}finally{n.stop()}}async detectObjectType(e){var r;const n=new $e(`IGit.detectObjectType(${e})`);try{const i=await this.github.getBlobContent(this.metadata.repo,e);if(!mI(i))return{mimetype:"text/plain"};const a=await(0,wI.fromBuffer)(i);return{mimetype:(r=a==null?void 0:a.mime)!=null?r:"application/octet-stream"}}finally{n.stop()}}async buffer(e,r){const n=new $e(`IGit.buffer(${e}, ${r})`);try{return await this.github.getFileContent(this.rootUri,e,this.pathToRelativePath(r))}finally{n.stop()}}async show(e,r){const n=new $e(`IGit.show(${e}, ${r})`);try{const i=await this.github.getFileContent(this.rootUri,e,this.pathToRelativePath(r));return My.decode(i)}finally{n.stop()}}async getCommit(e){const r=new $e(`IGit.getCommit(${e})`);try{const n=await this.github.getCommit(this.rootUri,e);if(n===void 0)throw new Error(`Unable to find commit for ref "${e}"`);return n}finally{r.stop()}}clean(e){return this._objects.clear(),Promise.resolve()}async apply(e,r){const n=new $e(`IGit.apply(reverse=${r})`);try{return await this.changeStore.applyPatch(this.rootUri,e,r?{reverse:!0}:void 0)}finally{n.stop()}}async diff(e){const r=new $e(`IGit.diff(${e})`);try{return await this.changeStore.createPatch(this.rootUri,void 0,e?{staged:!0}:void 0)}finally{r.stop()}}diffWithHEAD(e){return e?this.diffBetween("","HEAD",e):this.diffBetween("","HEAD")}diffWith(e,r){return r?this.diffBetween("",e,r):this.diffBetween("",e)}diffIndexWithHEAD(e){return e?this.diffBetween("~","HEAD",e):this.diffBetween("~","HEAD")}diffIndexWith(e,r){return r?this.diffBetween("~",e,r):this.diffBetween("~",e)}async diffBetween(e,r,n){if(!n)throw new Error("Method not implemented.");const i=new $e(`IGit.diffBetween(${e}, ${r}, ${n})`);try{const[o,a]=await Promise.all([this.getContent(e,n),this.getContent(r,n)]);return Pu(n,o,a)}finally{i.stop()}}async diffBlobs(e,r){const n=new $e(`IGit.diffBlobs(${e}, ${r})`);try{const i=await this.getBlobContent(e),o=await this.getBlobContent(r),a=Pu("untitled",i,o);return Promise.resolve(a)}finally{n.stop()}}async getBlobContent(e){const r=new $e(`IGit.getBlobContent(${e})`);try{const n=this._objects.get(e);if(n)return this._objects.delete(e),n;const{repo:i}=this.providerService.getVirtualUriMetadata(this.rootUri),o=await this.github.getBlobContent(i,e);return My.decode(o)}finally{r.stop()}}async getContent(e,r){const n=new $e(`IGit.getContent(${e}, ${r})`);try{const i=this.pathToRelativeUri(r);if(e===""||e==="~"){const o=await this.changeStore.getChange(i);if(o!==void 0&&(e===""||o.staged))return this.changeStore.getContent(i);e="HEAD"}return await this.show(e==="HEAD"?this.metadata.HEAD.sha:e,r)}finally{n.stop()}}async hashObject(e){const r=new $e("IGit.hashObject");try{const n=ku(await ja(e));return this._objects.set(n,e),n}finally{r.stop()}}async createBranch(e,r,n){const i=new $e(`IGit.createBranch(${e}, ${r}, ${n})`);try{n||(n=this.metadata.HEAD.sha);const o=await this.github.createBranch(this.rootUri,e,n);r&&await this.checkout(o)}finally{i.stop()}}deleteBranch(e,r){throw new Error("Method not implemented.")}async getBranch(e){const r=new $e(`IGit.getBranch(${e})`);try{const{branches:n}=await this.github.getBranches(this.rootUri,{query:e,limit:1}),[i]=n;if(i===void 0)throw new Error(`Unable to find branch named "${e}"`);return{type:i.type,name:i.name,commit:i.commit,remote:this.remote.name,upstream:{name:i.name,remote:i.commitUrl}}}finally{r.stop()}}async getBranches(e){var r,n;const i=(n=(r=e.contains)!=null?r:e.pattern)!=null?n:"",o=new $e(`IGit.getBranches(${i})`);try{const{branches:a}=await this.github.getBranches(this.rootUri,{query:i,limit:e.count});if(a.length===0)throw new Error(`Unable to find branches for "${i}"`);return a.map(s=>({type:s.type,name:s.name,commit:s.commit}))}finally{o.stop()}}setBranchUpstream(e,r){throw new Error("Method not implemented.")}getMergeBase(e,r){throw new Error("Method not implemented.")}async status(){}async checkout(e){const r=new $e(`IGit.checkout(${e})`);try{if(await this.github.repositoryObjectExists(this.rootUri,e)){const i=await this.github.switchTo(this.rootUri,e,{openInNewWindow:!1});throw i!==void 0&&await nn(i),new Error("User aborted")}const n=/pr\/(?<remote>.+)\/(?<num>\d+)/.exec(e);if(n==null?void 0:n.groups){const{num:i}=n.groups,{provider:o,repo:a}=this.providerService.getVirtualUriMetadata(this.rootUri),s=this.providerService.getRemoteUri(o.id,{repo:a,pullRequest:{id:i}});if(s!==void 0){const c=await this.providerService.createWorkspaceForRemoteUrl(s.toString());c!==void 0&&await nn(c)}}throw new Error("User aborted")}finally{r.stop()}}addRemote(e,r){var n;let i;const o=this.remotes.findIndex(a=>a.name===e);return o!==-1&&([i]=this.remotes.splice(o,1)),this.remotes.push({name:e,fetchUrl:r,isReadOnly:(n=i==null?void 0:i.isReadOnly)!=null?n:!1}),Promise.resolve()}removeRemote(e){const r=this.remotes.findIndex(n=>n.name===e);return r!==-1&&this.remotes.splice(r,1),Promise.resolve()}renameRemote(e,r){const n=this.remotes.findIndex(o=>o.name===e);if(n===-1)return Promise.resolve();const[i]=this.remotes.splice(n,1);return this.remotes.push({...i,name:r}),Promise.resolve()}async fetch(e,r,n){const i=new $e("IGit.fetch");try{return this.github.fetch(this.rootUri)}finally{i.stop()}}async pull(e){const r=new $e("IGit.pull");try{return this.github.sync(this.rootUri,this.changeStore,{conflictResolution:Zr.Merge})}finally{r.stop()}}push(e,r,n){return Promise.resolve()}blame(e){throw new Error("Method not implemented.")}async log(e){if((e==null?void 0:e.maxEntries)!==1||(e==null?void 0:e.path)!==void 0)throw new Error("The specified log options are not yet supported.");return[await this.getCommit(this.metadata.HEAD.sha)]}async commit(e,r){const n=new $e("IGit.commit");try{if((r==null?void 0:r.amend)!==void 0||(r==null?void 0:r.empty)!==void 0||(r==null?void 0:r.signCommit)!==void 0||(r==null?void 0:r.signoff)!==void 0)throw new Error("The specified commit options are not yet supported.");const i=(await this.providerService.getCommitOperations(this.rootUri,this.changeStore,{staged:(r==null?void 0:r.all)===!1})).filter(o=>o.fileType===d.FileType.File);if(!i.length){d.window.showInformationMessage(_I("no changes to commit","There are no changes to commit."));return}if(Je.getUseNewCommitApi())await this.github.createAndPushCommit(this.rootUri,e,i,void 0);else{const o=await this.github.createCommit(this.rootUri,e,i);await this.github.pushCommit(this.rootUri,o)}}finally{n.stop()}}pathToRelativePath(e){return this.providerService.getRelativeFilePath(this.rootUri,this.pathToRelativeUri(e))}pathToRelativeUri(e){return Ma(this.rootUri,EI(e))}}const SI=/^\/?([a-zA-Z])(?::\/)(.*)$/,CI=/\\/g;function EI(t){t=d.Uri.file(t).fsPath.replace(CI,"/");const e=SI.exec(t);return e!==null&&([,,t]=e),t.startsWith("/")?t:`/${t}`}function Lf(t){switch(t){case rt.Changed:return Cs.MODIFIED;case rt.Created:return Cs.INTENT_TO_ADD;case rt.Deleted:return Cs.DELETED}}var RI=Object.defineProperty,AI=Object.getOwnPropertyDescriptor,By=(t,e,r,n)=>{for(var i=n>1?void 0:n?AI(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&RI(e,r,i),i};const rc=(0,C.loadMessageBundle)(),Oy=/^(?:https:\/\/)?github\.(?:com|dev)\/(?<owner>[^/]+)\/(?<repo>[^/?#]+)(?:|\.git|\/tree\/(?<tree>[^?#]+)|\/blob\/(?<blob>[^?#]+)|\/commit\/(?<commit>[0-9a-f]{40})|\/pull\/(?<pull>[0-9]+))?(?<extra>[^?#]*)(?:\?(?<query>[^#]*))?(?:#(?<fragment>.*))?$/i,Uy=/(?<remoteOwner>[^/:]+)\/?(?<remoteRepo>[^/:]+)?:(?<remoteRef>.*)/,Hf=["repo","workflow"],lu=1,Ly=Object.freeze({id:Ur.GitHub,name:"GitHub"});function Aa(t){const{scheme:e,metadata:r}=Pt.decodeAuthority(t,a=>{if(a.v!==void 0)return a;if(typeof a.pr=="string")return{v:lu,ref:{type:Ue.PullRequest,id:a.pr},idx:a.idx};if(typeof a.ref=="string")return{v:lu,ref:{type:Ue.Tree,id:a.ref},idx:a.idx}}),[,n,i,...o]=t.path.split("/");return{scheme:e,provider:Ly,name:`${n}/${i}`,repo:{owner:n,name:i},path:o.join("/")||"",ref:r==null?void 0:r.ref,idx:r==null?void 0:r.idx}}function TI(t,e){const{repo:r}=e!=null?e:Aa(t);return t.with({path:`/${r.owner}/${r.name}`,query:"",fragment:""})}function qf(t,e,r){const{repo:{owner:n,name:i}}=t instanceof d.Uri?Aa(t):t;return d.Uri.parse(`github://${Pt.encodeAuthority("github",{v:lu,ref:{type:Ue.Commit,id:e}})}/${n}/${i}/${r}`)}class Wf{constructor(e,r){this.providerService=e,this.tarPit=r,this.fileTreeCache=new Map,this.disposable=d.Disposable.from(e.onDidChangeRepository(n=>{n.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([n.repository.uri])}),e.onDidRefresh(n=>this.onRefreshOrRepositoryChanged(n)))}get isReadonly(){return!1}get scheme(){return"github"}dispose(){this.disposable.dispose()}onRefreshOrRepositoryChanged(e){e=e.filter(r=>Pt.getProviderId(r)===this.scheme),e.length!==0&&(this.fileTreeCache.forEach(r=>r.dispose()),this.fileTreeCache.clear())}async ensureAuthenticated(e=!1){const r=new $e("GitHub.ensureAuthenticated");try{if(this._session===void 0){async function n(){try{return await d.authentication.getSession("github",Hf,{createIfNone:!0,forceNewSession:e})}catch{try{const o=await d.authentication.getSession("github",Hf,{createIfNone:!1});if(o!==void 0)return o}catch{}return new Promise(o=>{async function a(){const c=await d.authentication.getSession("github",Hf,{createIfNone:!0});c!==void 0&&o(c)}const s=d.authentication.onDidChangeSessions(async c=>{c.provider.id==="github"&&(s.dispose(),await a())})})}}this._session=await n();const i=d.authentication.onDidChangeSessions(o=>{if(this._session===void 0){i.dispose();return}o.provider.id==="github"&&(this.clearAuthenticationSession(),i.dispose())})}return this._session}finally{r.stop()}}async getAuthentication(e){const r=await this.ensureAuthenticated();return{provider:Ly,session:r,getRichNavigationHeaders:()=>({"X-Git-GitHub":`Bearer ${r.accessToken}`})}}clearAuthenticationSession(){this._session=void 0,this._octokit=void 0,this._octokitDefaults=void 0}async reauthenticate(){this.clearAuthenticationSession(),await this.ensureAuthenticated(!0)}async octokit(e){if(this._octokitDefaults===void 0){const n=await this.ensureAuthenticated();if(si){async function i(o,a){if(a.headers!==void 0){const{"user-agent":s,...c}=a.headers;s&&(a.headers=c)}return on(o,a)}this._octokitDefaults=cu.defaults({auth:`token ${n.accessToken}`,request:{fetch:i}})}else this._octokitDefaults=cu.defaults({auth:`token ${n.accessToken}`})}const r=new this._octokitDefaults(e);return(Z.logLevel===Rt.Debug||Z.isDebugging)&&r.hook.wrap("request",async(n,i)=>{var o;const a=new $e(`[GITHUB] ${i.method} ${i.url}`,{log:!1});try{return await n(i)}finally{let s;try{if(typeof i.query=="string"){const c=/(^[^({\n]+)/.exec(i.query);s=` ${(o=c==null?void 0:c[1].trim())!=null?o:i.query}`}}catch{}a.stop({message:s})}}),r}async graphql(e,r){this._octokit===void 0&&(this._octokit=await this.octokit());try{return await this._octokit.graphql(e,r)}catch(n){throw this.handleRequestErrors(n),n}}async request(e,r){this._octokit===void 0&&(this._octokit=await this.octokit());try{return await this._octokit.request(e,r)}catch(n){throw this.handleRequestErrors(n),n}}handleRequestErrors(e){var r,n;if(e instanceof zn)switch(e.status){case 500:return e.response&&Tr.showGitHubStatus500Message(),!0;case 401:return Tr.showStatus401Message(()=>void this.reauthenticate()),!0;case 403:return Tr.showStatus403Message(()=>void this.reauthenticate()),!0}else if(e instanceof tc&&((n=(r=e.errors)==null?void 0:r[0])==null?void 0:n.type)==="FORBIDDEN")return Tr.showStatus403Message(()=>void this.reauthenticate()),!0;return!1}createIGitRepository(e,r,n,i){return new xI(this.providerService,e,r,n,i,this)}async createMetadata(e,r){var n,i,o,a,s,c;const l=new $e(`GitHub.createMetadata(${e.toString()}, ${r})`);let u;try{let{provider:f,name:h,repo:{owner:p,name:b},ref:y}=Aa(e);(!y||y.type===Ue.Commit&&/HEAD/i.test(y.id))&&(y={type:Ue.Commit,id:"HEAD"});const w=this.providerService.isInWorkspace(e);let _,S;Je.get("experimental.prefetch")&&w&&(r?_=r:(y.type===Ue.Commit||y.type===Ue.Tree)&&(_=y.id),_&&(l.log({suffix:` \u2022 Prefetching tree for ${_}...`}),this.getFileTree(e,void 0,{cache:!0,recursive:!0,prefetched:{metadata:new Promise(J=>S=J),repo:{owner:p,name:b},HEAD:{sha:_},timestamp:Date.now()}})));const I=await this.getRepositoryInfo(p,b,w,y.type===Ue.PullRequest?{pr:Number(y.id)}:{ref:y.id});if(I===void 0)throw u=" \u2022 Aborted; Unable to get repository info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let D;if(r)D=r;else if(y.type===Ue.Commit||y.type===Ue.Tree&&I.ref===void 0)D=y.id;else if(D=(i=(n=I.ref)==null?void 0:n.sha)!=null?i:I.defaultBranch.sha,D===void 0)throw u=" \u2022 Aborted; Unable to get repository revision",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository revision`);let O;if(((o=I.ref)==null?void 0:o.prefix)==="refs/heads/")O={type:Le.Branch,name:I.ref.name,sha:D,branch:{name:I.ref.name,sha:I.ref.sha}};else if(((a=I.ref)==null?void 0:a.prefix)==="refs/remotes/"){if(!I.ref.remote)throw u=" \u2022 Aborted; Unable to get remote info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get remote info`);O={type:Le.RemoteBranch,name:`${I.ref.remote.repo.owner}${I.ref.remote.repo.name!==b?`/${I.ref.remote.repo.name}`:""}:${I.ref.name}`,sha:D,branch:{name:I.ref.name,sha:I.ref.sha,remote:I.ref.remote}}}else((s=I.ref)==null?void 0:s.prefix)==="refs/tags/"?O={type:Le.Tag,name:I.ref.name,sha:D,detached:{type:Le.Tag,name:I.ref.name}}:O={type:Le.Commit,name:fr(D),sha:D,detached:{type:Le.Commit,name:fr(D)}};if(_!==void 0&&_!==O.sha){const J=this.asFileTreeKey(e,_),G=this.fileTreeCache.get(J);G&&!yi(_)&&O.sha===((c=O.branch)==null?void 0:c.sha)?(l.log({suffix:` \u2022 Updating prefetched tree for ${_}, since HEAD was resolved; HEAD=${O.sha}`}),this.fileTreeCache.set(this.asFileTreeKey(e,O.sha),G),this.fileTreeCache.delete(J)):(l.log({suffix:` \u2022 Removing prefetched tree for ${_}, since the HEAD changed; HEAD=${O.sha}`}),this.fileTreeCache.delete(J),G==null||G.dispose())}const te={version:Ba.schemaVersion,timestamp:Date.now(),provider:f,name:h,repo:I.repo,user:I.user,accessLevel:I.accessLevel,HEAD:O,defaultBranch:I.defaultBranch,pullRequest:I.pullRequest};return u=` \u2022 HEAD=${O.sha}`,S==null||S(te),te}finally{l.stop(u?{suffix:u}:void 0)}}getMetadata(e){return this.providerService.getMetadata(e)}getRemoteWorkspaceSourceProviders(){return[{name:"GitHub",icon:"$(github)",label:rc("open repo from","Open Repository from {0}","GitHub"),placeholder:rc("pick repo","Choose a repository"),provideSources:async(e,r)=>{e=e!=null?e:"";let n;const i=e==null?void 0:e.indexOf("/");return i!==-1&&(n=e.substring(0,i),e=e.substr(i+1)),(await this.searchRepositoriesQuery(e,{...r,user:n})).map(a=>({name:a.repoWithOwner,icon:"$(repo)",description:`${a.fork?`$(repo-forked) ${a.fork}`:""}${a.stars>0?`${a.fork?" \u2022 ":""}$(star-full) ${a.stars}`:""}`,detail:a.description,url:a.url}))}},{name:"GitHub",icon:"$(github)",label:rc("open pr from","Open Pull Request from {0}","GitHub"),placeholder:rc("pick pr","Choose a pull request"),provideSources:async(e,r)=>{e=e!=null?e:"";let n;const i=e==null?void 0:e.indexOf("/");return i!==-1&&(n=e.substring(0,i),e=e.substr(i+1)),(await this.searchPullRequestsQuery(e,{user:n})).map(a=>({name:a.title,icon:"$(git-pull-request)",description:a.reasons.length!==0?a.reasons.sort().join(", "):void 0,detail:`${a.repoWithOwner} #${a.number}`,url:a.url}))}}]}canOpenRemoteUrl(e){const r=Oy.exec(e);if((r==null?void 0:r.groups)===void 0)return;const{blob:n,commit:i,pull:o,tree:a}=r.groups;return o?Vr.PullRequest:i?Vr.Commit:a?Vr.Branch:n?Vr.File:Vr.Repository}async createWorkspaceForRemoteUrl(e,r=Tt.CurrentWindow){const n=Oy.exec(e);if((n==null?void 0:n.groups)===void 0)return;let{owner:i,repo:o,blob:a,commit:s,pull:c,tree:l,fragment:u}=n.groups;const f=await this.validateOwnerAndRepoAndSplitRefFromPath(i,o,l!=null?l:a);if(f===void 0)return;let h,p;if({owner:i,repo:o,ref:p,path:h}=f,l||a){if(h&&u&&a){const w=/L(?<start>\d+)(?:-L(?<end>\d+))?/.exec(u);if(w==null?void 0:w.groups){const{start:_,end:S}=w.groups;h+=`:${_}${S!==void 0?`-${S}`:""}`}}}else s?p={type:Ue.Commit,id:s}:c&&(p={type:Ue.PullRequest,id:c});const b=this.providerService.createVirtualUri(Ur.GitHub,{repo:{owner:i,name:o},ref:p});return{name:(await this.getMetadata(b)).name,uri:b,location:r,filesToOpen:h?[h]:void 0}}createVirtualUri(e,{repo:r,ref:n,idx:i},o){const a=n!==void 0||i!==void 0?{v:lu}:void 0;return a&&(n&&(a.ref={...n,type:n.type===Ue.Branch||n.type===Ue.Tag?Ue.Tree:n.type}),i&&(a.idx=i)),e.with({authority:Pt.encodeAuthority("github",a),path:`/${r.owner}/${r.name}${(o==null?void 0:o.startsWith("/"))?o:o?`/${o}`:""}`})}getRemoteUri(e){const r=`https://github.com/${e.repo.owner}/${e.repo.name}`;return e.pullRequest?d.Uri.parse(`${r}/pull/${e.pullRequest.id}`):e.sha?d.Uri.parse(`${r}/commit/${e.sha}`):e.branch?d.Uri.parse(`${r}/tree/${e.branch}`):e.tag?d.Uri.parse(`${r}/tree/${e.tag}`):e.clone?d.Uri.parse(`${r}.git`):d.Uri.parse(r)}getProviderRootUri(e){return TI(e)}getRelativeFilePath(e,r){const{path:n}=Aa(e),{path:i}=Aa(Ma(e,r));return n.length!==0&&i!==n&&i.startsWith(n)?i.slice(n.length+1):i}getVirtualUriMetadata(e){const{provider:r,name:n,repo:i,ref:o}=Aa(e);return{provider:r,name:n,repo:i,ref:o}}async getModeRefType(e,r){const{HEAD:n,pullRequest:i}=await(r!=null?r:this.getMetadata(e));switch(n.type){case Le.Branch:return i!==void 0?q.PullRequestBranch:q.Branch;case Le.RemoteBranch:return i!==void 0?q.PullRequestRemoteBranch:q.RemoteBranch;case Le.Tag:return q.Tag;case Le.Commit:return q.Commit}}async createBranch(e,r,n,i){try{const{repo:{owner:o,name:a}}=i!=null?i:await this.getMetadata(e);return r.startsWith("refs/heads/")||(r=`refs/heads/${r}`),(await this.request("POST /repos/{owner}/{repo}/git/refs",{owner:o,repo:a,ref:r,sha:n})).data.ref.substr(11)}catch(o){throw o instanceof zn&&o.status===422?o.message==="Reference already exists"?new La(o,!0):new La(o,!1):(Z.error(o),o)}}async createAndPushCommit(e,r,n,i,o){var a;const s=new $e(`GitHub.createAndPushCommit(${e.toString()}${o?`, fork=${o.repo.owner}/${o.repo.name}`:""})`);if(n=n.filter(l=>l.fileType===d.FileType.File),n.length===0)throw s.stop({message:"Aborted; No changes to commit"}),new $o("No changes to commit");let c;try{const l=await this.getMetadata(e);let u;if(i!==void 0)u=i;else{if(l.HEAD.detached&&!l.HEAD.branch)throw new Zi("Unable to commit; no current branch");u=l.HEAD.branch.name}let f;if(o)f=`${o.repo.owner}/${o.repo.name}`;else if(l.HEAD.type===Le.RemoteBranch&&l.HEAD.branch.remote.accessLevel>=$t.Write){const{owner:_,name:S}=l.HEAD.branch.remote.repo;f=`${_}/${S}`}else f=`${l.repo.owner}/${l.repo.name}`;const h=[],p=[];for(const _ of n)switch(_.type){case rt.Created:case rt.Changed:h.push({path:_.path,contents:_c(await _.content)});break;case rt.Deleted:p.push({path:_.path});break}const b={branch:{branchName:u,repositoryNameWithOwner:f},message:{headline:r},fileChanges:{additions:h,deletions:p},expectedHeadOid:l.HEAD.sha},y=`mutation($commitInput: CreateCommitOnBranchInput!) {
	createCommitOnBranch(input: $commitInput) {
		commit {
			oid
		}
		ref {
			name
		}
	}
}`,w=await this.graphql(y,{commitInput:b});if(c=w==null?void 0:w.createCommitOnBranch.commit.oid,!c)throw new vc;return i===void 0&&!l.HEAD.detached&&c!==void 0&&await this.fastForwardTo(e,c,l),c}catch(l){if(l instanceof tc){const u=(a=l.errors)==null?void 0:a[0];if((u==null?void 0:u.type)==="STALE_DATA"&&u.message.includes("Pull and try again"))throw new Ha(l)}throw Z.error(l),l}finally{s.stop(c?{message:`: Created and pushed commit ${c}`}:void 0)}}async createCommit(e,r,n,i){const o=new $e(`GitHub.createCommit(${e.toString()}${i?`, fork=${i.repo.owner}/${i.repo.name}`:""})`);if(n=n.filter(s=>s.fileType===d.FileType.File),n.length===0)throw o.stop({message:"Aborted; No changes to commit"}),new $o("No changes to commit");let a;try{const s=await this.getMetadata(e);let c,l,u;i?({repo:{owner:c,name:l}}=i,u=await this.getFileTree(this.createVirtualUri(e,i),s.HEAD.sha)):s.HEAD.type===Le.RemoteBranch&&s.HEAD.branch.remote.accessLevel>=$t.Write?({owner:c,name:l}=s.HEAD.branch.remote.accessLevel===$t.WriteToPullRequest?s.repo:s.HEAD.branch.remote.repo,u=await this.getFileTree(this.createVirtualUri(e,{repo:s.HEAD.branch.remote.repo}),s.HEAD.sha)):({repo:{owner:c,name:l}}=s,u=await this.getFileTree(e,s.HEAD.sha));const f=await u.getTreeSha();if(!yi(f))throw new Error(`Unable to create commit based on tree sha ${f}`);o.logStep("Creating Blobs",{message:`: Committing ${n.length} changes onto commit ${s.HEAD.sha} based on tree ${f}`,suffix:" \u2022 Creating blobs..."});const h=[];async function p(_){var S;try{const I=await this.request("POST /repos/{owner}/{repo}/git/blobs",{owner:c,repo:l,encoding:"base64",content:_c(await _.content),mediaType:{format:"raw"}});let D;if(_.type===rt.Changed){const O=await u.get(_.path);D=(S=O==null?void 0:O.mode)!=null?S:"100644"}else D="100644";h.push({path:_.path,mode:D,type:"blob",sha:I.data.sha})}catch(I){throw Z.error(I,`Failed to create blob for ${_.path}`),I}}const b=[];for(const _ of n)switch(_.type){case rt.Created:case rt.Changed:{b.push(p.call(this,_));break}case rt.Deleted:{h.push({path:_.path,mode:"100644",type:"blob",sha:null});break}}await Promise.all(b),o.logStep("Creating tree",{message:`: Created ${b.length} blobs;`,suffix:` \u2022 Creating tree based on ${f}...`});const y=await this.request("POST /repos/{owner}/{repo}/git/trees",{owner:c,repo:l,base_tree:f,tree:h});return o.logStep("Creating commit",{message:`: Created tree ${y.data.sha};`,suffix:" \u2022 Creating commit..."}),a=(await this.request("POST /repos/{owner}/{repo}/git/commits",{owner:c,repo:l,message:r,tree:y.data.sha,parents:[s.HEAD.sha]})).data.sha,a}catch(s){throw Z.error(s),s}finally{o.stop(a?{message:`: Created commit ${a}`}:void 0)}}async createPullRequest(e,r,n,i,o){var a,s,c;const l=new $e(`GitHub.createPullRequest(${e.toString()}, ${r}${o?`, fork=${o.repo.owner}/${o.repo.name}`:""})`);try{const{repo:{owner:u,name:f},HEAD:{branch:h},defaultBranch:p}=await this.getMetadata(e),b=await this.request("POST /repos/{owner}/{repo}/pulls",{owner:u,repo:f,base:`refs/heads/${(a=h==null?void 0:h.name)!=null?a:p.name}`,head:o?`${o.repo.owner}:${r}`:r,title:n,draft:(s=i==null?void 0:i.draft)!=null?s:!1,maintainer_can_modify:(c=i==null?void 0:i.canMaintainerModify)!=null?c:!0});return{id:b.data.number.toString(),uri:d.Uri.parse(b.data.html_url)}}catch(u){throw Z.error(u),u}finally{l.stop()}}async fetch(e,r){const{fetched:n,metadata:i}=await this.fetchCore(e,!1,r);n&&await this.providerService.updateMetadata(e,i)}async fetchCore(e,r,n){var i,o,a,s,c,l,u,f,h;const{force:p,to:b}={...n,force:r||(n==null?void 0:n.force)},y=new $e(`GitHub.fetch(${e.toString()}, force=${p}, to=${b})`);let w;try{const _=await this.getMetadata(e);if(_.HEAD.detached)return w=" \u2022 Skipped; detached HEAD",{fetched:!1,metadata:_};const S=await this.getBranchTips(e);if(!S)throw w=" \u2022 Unable to fetch branch tips",new Xi(r);if(!p&&!b&&((i=S.defaultBranch)==null?void 0:i.sha)!==void 0&&S.defaultBranch.sha===_.defaultBranch.sha&&((o=S.branch)==null?void 0:o.sha)!==void 0&&S.branch.sha===_.HEAD.branch.sha&&(_.HEAD.sha===_.HEAD.branch.sha||_.state!==void 0))return w=" \u2022 No changes detected",{fetched:!1,metadata:_};let I;if(((a=S.defaultBranch)==null?void 0:a.sha)!==void 0&&S.defaultBranch.sha!==_.defaultBranch.sha&&(I={defaultBranch:{..._.defaultBranch,sha:S.defaultBranch.sha}}),((s=S.branch)==null?void 0:s.sha)===void 0){if(w=" \u2022 Unable to find branch tip",p)throw new Xi(r);return I!==void 0?{fetched:!0,metadata:{..._,...I}}:{fetched:!1,metadata:_}}if(S.branch.sha!==_.HEAD.branch.sha&&(I={...I,HEAD:{..._.HEAD,branch:{..._.HEAD.branch,sha:S.branch.sha},detached:void 0}}),S.branch.sha===((c=n==null?void 0:n.to)!=null?c:_.HEAD.sha))return w=" \u2022 Up to date",_.state!==void 0||I!==void 0?{fetched:!0,metadata:{..._,...I,state:void 0}}:{fetched:!1,metadata:_};y.logStep("Fetching upstream changes");try{const D=await this.getAheadBehindState(e,_,{base:(l=n==null?void 0:n.to)!=null?l:_.HEAD.sha,head:(h=(f=(u=I==null?void 0:I.HEAD)==null?void 0:u.branch)==null?void 0:f.sha)!=null?h:_.HEAD.branch.sha});return w=` \u2022 Changes detected; ${D==null?void 0:D.behind} commits behind`,{fetched:!0,metadata:{..._,...I,state:D?{ahead:D.ahead,behind:D.behind,incomingChanges:D.incomingChanges}:void 0}}}catch(D){if(w=` \u2022 Failed fetching upstream changes; ${String(D)}`,p)throw new Xi(r);return I!==void 0?{fetched:!0,metadata:{..._,...I}}:{fetched:!1,metadata:_}}}finally{y.stop(w?{suffix:w}:void 0)}}async fork(e){try{const{repo:{owner:r,name:n}}=await this.getMetadata(e),i=await this.request("POST /repos/{owner}/{repo}/forks",{owner:r,repo:n});let o;for(;;){try{if(o=await this.getRepositoryInfo(i.data.owner.login,i.data.name,!1),o!==void 0)break}catch{}await new Promise(a=>setTimeout(a,250))}return{name:`${i.data.owner.login}/${i.data.name}`,repo:{owner:i.data.owner.login,name:i.data.name},url:i.data.url}}catch(r){throw Z.error(r),r}}async getBranches(e,r){var n,i,o;try{const{repo:{owner:a,name:s}}=await this.getMetadata(e),c=`query getBranches(
	$owner: String!
	$repo: String!
	$branchQuery: String!
	$cursor: String
	$limit: Int = 100
) {
	repository(owner: $owner, name: $repo) {
		refs(query: $branchQuery, refPrefix: "refs/heads/", first: $limit, after: $cursor) {
			pageInfo {
				endCursor
				hasNextPage
			}
			nodes {
				name
				target {
					oid
				}
			}
		}
	}
}`,l=await this.graphql(c,{owner:a,repo:s,branchQuery:(n=r==null?void 0:r.query)!=null?n:"",cursor:r==null?void 0:r.cursor,limit:Math.min(100,(i=r==null?void 0:r.limit)!=null?i:100)});if(l===void 0)return{branches:[]};const u=(o=l.repository)==null?void 0:o.refs;if(u===void 0)return{branches:[]};const f=u.nodes.map(h=>({type:Nn.Head,name:h.name,commit:h.target.oid,commitUrl:h.target.commitUrl}));return{paging:{cursor:u.pageInfo.endCursor,more:u.pageInfo.hasNextPage},branches:f}}catch(a){return{branches:[]}}}async getCommit(e,r){var n;try{const{HEAD:i,repo:{owner:o,name:a}}=await this.getMetadata(e),s=`query getCommit(
	$owner: String!
	$repo: String!
	$ref: GitObjectID!
) {
	repository(name: $repo owner: $owner) {
		object(oid: $ref) {
			...on Commit {
				oid
				message
				parents(first: 100) {
					nodes {
						oid
					}
				}
				author {
					date
					email
					name
				}
				committer {
					date
				}
			}
		}
	}
}`;r.toUpperCase()==="HEAD"&&(r=i.sha);const c=await this.graphql(s,{owner:o,repo:a,ref:r});if(c===void 0)return;const l=(n=c.repository)==null?void 0:n.object;return l===void 0?void 0:{hash:l.oid,message:l.message,parents:l.parents.nodes.map(u=>u.oid),authorDate:new Date(l.author.date),authorEmail:l.author.email,authorName:l.author.name,commitDate:new Date(l.committer.date)}}catch(i){return}}async getCommits(e,r){var n,i,o;try{const{HEAD:a,repo:{owner:s,name:c}}=await this.getMetadata(e),l=`query getCommits(
	$owner: String!
	$repo: String!
	$ref: GitObjectID!
	$path: String
	$cursor: String
	$limit: Int = 100
) {
	repository(name: $repo, owner: $owner) {
		object(oid: $ref) {
			... on Commit {
				history(first: $limit, path: $path, after: $cursor) {
					pageInfo {
						endCursor
						hasNextPage
					}
					nodes {
						... on Commit {
							...commit
						}
					}
				}
			}
		}
	}
}

fragment commit on Commit {
	oid
	message
	parents(first: 100) {
		nodes {
			oid
		}
	}
	author {
		date
		email
		name
	}
	committer {
		date
	}
}
`;let u=r==null?void 0:r.ref;(u==null?void 0:u.toUpperCase())==="HEAD"&&(u=a.sha);const f=await this.graphql(l,{owner:s,repo:c,ref:u,cursor:r==null?void 0:r.cursor,path:r==null?void 0:r.path,limit:Math.min(100,(n=r==null?void 0:r.limit)!=null?n:100)});if(f===void 0)return;const h=(o=(i=f.repository)==null?void 0:i.object)==null?void 0:o.history;if(h===void 0)return;const p=h.nodes.map(b=>({hash:b.oid,message:b.message,parents:b.parents.nodes.map(y=>y.oid),authorDate:new Date(b.author.date),authorEmail:b.author.email,authorName:b.author.name,commitDate:new Date(b.committer.date)}));return{paging:{cursor:h.pageInfo.endCursor,more:h.pageInfo.hasNextPage},commits:p}}catch(a){return}}async getBlobContent(e,r){try{const n=await this.request("GET /repos/{owner}/{repo}/git/blobs/{file_sha}",{owner:e.owner,repo:e.name,file_sha:r});return OS(n.data.content)}catch(n){throw Z.logLevel===Rt.Debug&&Z.error(n),n}}async getFileContent(e,r,n){try{let i;if(r&&n&&!this.hasFileTree(e,r)){const o=this.providerService.getProviderRootUri(e);n.startsWith("/")&&(n=n.slice(1));let a=(0,$k.dirname)(n);(a==="."||a==="/")&&(a=""),i=await(await this.getFileTree(o,r,{path:a,cache:!1,recursive:!1})).get(n)}else{const[o,{path:a}]=await Promise.all([this.getFileTree(e,r),n?{path:void 0}:this.providerService.getMetadata(e)]);i=await o.get(n!=null?n:a)}if((i==null?void 0:i.sha)===void 0)throw d.FileSystemError.FileNotFound(e);return await i.getContent()}catch(i){throw Z.logLevel===Rt.Debug&&Z.error(i),i}}async getFileList(e,r,n){const i=new $e(`GitHub.getFileList(${e.toString()}${n?`, ${n}`:""})`);try{const{repo:{owner:o,name:a},HEAD:{sha:s}}=await this.getMetadata(e),c=await this.request("GET /repos/{owner}/{repo}/git/tree-file-list/{treeish}",{owner:o,repo:a,treeish:`${n!=null?n:s}${r?`:${r}`:""}`});return c.status!==200?[]:c.data}catch(o){return Z.error(o),[]}finally{i.stop()}}hasFileTree(e,r){return r?this.fileTreeCache.has(this.asFileTreeKey(e,r)):this.getMetadata(e).then(n=>this.fileTreeCache.has(this.asFileTreeKey(e,n.HEAD.sha)))}async getFileTree(e,r,n){var i,o,a,s,c;const l=this.providerService.isInWorkspace(e);let u=(i=n==null?void 0:n.cache)!=null?i:l,f,h,p;if(u||!r){const _=(a=(o=n==null?void 0:n.prefetched)==null?void 0:o.metadata)!=null?a:this.getMetadata(e);f=l?this.getFileTreePermissions(e,_):void 0;let S;({repo:h,HEAD:{sha:S},timestamp:p}=(s=n==null?void 0:n.prefetched)!=null?s:await _),r&&S!==r?(u=!1,p=Date.now()):r=S}else({repo:h}=(c=n==null?void 0:n.prefetched)!=null?c:this.providerService.getVirtualUriMetadata(e)),p=Date.now();const b=this.asFileTreeKey(e,r),y=this.providerService.getProviderRootUri(e),w=new $e(`GitHub.getFileTree(${b}): ${e.toString()}`,{log:!1,logLevel:Rt.Debug});try{let _=function(){var I;const D=new $e(`GitHub.createFileTree(${b})`);let O,te;u&&l&&(O=new d.EventEmitter,te=d.Disposable.from(this.tarPit.onDidChangeIndexingEnablement(()=>O.fire()),this.tarPit.onDidDownloadTar(G=>O.fire({rootUri:this.providerService.getProviderRootUri(G.rootUri),sha:G.sha}))));const J={dispose:()=>te==null?void 0:te.dispose(),permissions:f,getContent:G=>this.getBlobContent(h,G.sha),getTree:async(G,ue)=>{try{const re=await this.request("GET /repos/{owner}/{repo}/git/trees/{tree_sha}",{owner:h.owner,repo:h.name,recursive:ue?"1":void 0,tree_sha:`${r}${G?`:${G}`:""}`});return re.data.truncated?{sha:re.data.sha,truncated:!0}:{sha:re.data.sha,truncated:!1,tree:Wa(re.data.tree,ae=>{var ye;return{path:ae.path,item:{mode:ae.mode,sha:ae.sha,stat:{type:II(ae.type),size:(ye=ae.size)!=null?ye:0,ctime:0,mtime:p,permissions:void 0}}}})}}catch(re){if(re instanceof zn&&re.status===404)return;throw re}},onDidTriggerContentCaching:O==null?void 0:O.event,tryCachingContent:u&&l?async G=>{const ue=Je.get("experimental.fs.useTars");if(ue!=="always"&&ue!=="ifAvailable")return!1;const re=new $e(`FileTree.loadAllContent(${r})`);let ae;try{let ye;if(ue==="ifAvailable"){if(re.logStep("Tar cache query"),ye=await this.tarPit.getCachedTar(y,r),ye===void 0)return ae=" \u2022 No cached Tar",!1}else re.logStep("Tar query"),ye=await this.tarPit.getTar(y,r);re.logStep("Updating content",{suffix:" \u2022 Updating content..."});for(const dt of ye.entries){const ne=G(dt.header.fullFileName);if(ne===void 0)continue;const Se=dt.dataAsBytes;ne.getContent=()=>Se}return!0}catch(ye){return ae=` \u2022 Failed ${String(ye)}`,!1}finally{re.stop(ae?{suffix:ae}:void 0)}}:void 0};try{return new $y(y,r,p,J,{path:n==null?void 0:n.path,recursive:(I=n==null?void 0:n.recursive)!=null?I:u,preload:u||(n==null?void 0:n.recursive)})}catch(G){return Z.error(G),new $y(y,r,p,void 0)}finally{D.stop()}},S=this.fileTreeCache.get(b);return S!==void 0||(S=_.call(this),u&&this.fileTreeCache.set(b,S)),S}finally{w.stop()}}async getFileTreePermissions(e,r){if(this.providerService.getModeConfig(e,await this.getModeRefType(e,r)).display===N.Edit)return;const i=await this.providerService.getIndexMetadata(e);return wc.isActive(i)?d.FilePermission.Readonly:void 0}async getFork(e){var r,n,i;try{const{repo:{owner:o,name:a}}=await this.getMetadata(e),s=`query getFork(
	$owner: String!
	$repo: String!
) {
	repository(owner: $owner, name: $repo) {
		forks(affiliations: OWNER, first: 1) {
			nodes {
				owner {
					login
				}
				name
				url
			}
		}
	}
}`,c=await this.graphql(s,{owner:o,repo:a});if(c===void 0)return;const[l]=(i=(n=(r=c.repository)==null?void 0:r.forks)==null?void 0:n.nodes)!=null?i:[];return l===void 0?void 0:{name:`${l.owner.login}/${l.name}`,repo:{owner:l.owner.login,name:l.name},url:l.url}}catch(o){return}}async getIncomingChanges(e){var r,n;return(n=(r=(await this.getMetadata(e)).state)==null?void 0:r.incomingChanges)!=null?n:[]}async compareCommits(e,r){const n=await this.getMetadata(e),i=await this.getAheadBehindState(e,n,{base:r.base,head:r.compare});return i==null?void 0:i.incomingChanges}async getAheadBehindState(e,r,n){var i,o,a,s,c;const{base:l,head:u}={base:r.HEAD.sha,head:(i=r.HEAD.branch)==null?void 0:i.sha,...n},f=new $e(`GitHub.getAheadBehindState(${e.toString()}, base=${l}, head=${u})`);let h,p;try{if(!u){h=` \u2022 Skipped; Unsupported HEAD type (${r.HEAD.type})`;return}const b=await this.request("GET /repos/{owner}/{repo}/compare/{base}...{head}",{owner:r.repo.owner,repo:r.repo.name,base:l,head:u}),y=[];for(const w of(o=b.data.files)!=null?o:[])switch(w.status){case"added":case"copied":y.push({uri:d.Uri.joinPath(e,w.filename),type:rt.Created});break;case"removed":y.push({uri:d.Uri.joinPath(e,w.filename),type:rt.Deleted});break;case"modified":y.push({uri:d.Uri.joinPath(e,w.filename),type:rt.Changed});break;case"renamed":y.push({uri:d.Uri.joinPath(e,w.filename),type:rt.Created}),y.push({uri:d.Uri.joinPath(e,w.previous_filename),type:rt.Deleted});break;default:Z.warn(`GitHub.getAheadBehindState(${e.toString()}, base=${l}, head=${u}): Unknown file status encountered '${w.status}'`);break}return p={ahead:(a=b.data.behind_by)!=null?a:0,behind:(s=b.data.ahead_by)!=null?s:0,incomingChanges:y},p}catch(b){throw h=` \u2022 Failed; ${String(b)}`,Z.error(b),b}finally{f.stop({suffix:h!=null?h:` \u2022 ${(c=p==null?void 0:p.behind)!=null?c:0} commits behind`})}}async getObjectDetails(e,r,n){var i;try{const o=await this.getFileTree(e,r);n?n=this.providerService.getRelativeFilePath(e,this.providerService.createRelativeUri(e,n)):{path:n}=await this.providerService.getMetadata(e);const a=await o.get(n);if((a==null?void 0:a.mode)===void 0||(a==null?void 0:a.sha)===void 0)throw new Error(`Cannot get details of ${n} in ${r}`);return{mode:a.mode,object:a.sha,size:(i=a.stat.size)!=null?i:0}}catch(o){throw Z.error(o),o}}async getPullRequest(e,r){const{repo:{owner:n,name:i}}=await this.getMetadata(e);return this.getPullRequestCore(n,i,r)}async getPullRequestCore(e,r,n){var i,o,a,s,c,l,u;try{const f=`query getPullRequest(
	$owner: String!
	$repo: String!
	$pr: Int!
) {
	repository(name: $repo, owner: $owner) {
		pullRequest(number: $pr) {
			author {
				login
				avatarUrl
				url
			}
			permalink
			number
			title
			state
			updatedAt
			closedAt
			mergedAt
			repository {
				name
				owner {
					login
				}
			}
			baseRef {
				name
			}
			baseRefName
			baseRefOid
			baseRepository {
				name
				owner {
					login
				}
			}
			headRef {
				name
			}
			headRefName
			headRefOid
			headRepository {
				name
				owner {
					login
				}
			}
			headRepositoryOwner {
				login
			}
		}
	}
}`,h=await this.graphql(f,{owner:e,repo:r,number:Number(n)}),p=(i=h==null?void 0:h.repository)==null?void 0:i.pullRequest;return p?{author:{name:p.author.login,avatarUrl:p.author.avatarUrl,url:p.author.url},closedAt:p.closedAt?new Date(p.closedAt):void 0,mergedAt:p.mergedAt?new Date(p.mergedAt):void 0,id:p.number.toString(),repo:{name:p.repository.name,owner:p.repository.owner.login},state:zf(p.state),title:p.title,updatedAt:new Date(p.updatedAt),url:p.permalink,refs:{base:{owner:p.baseRepository.owner.login,repo:p.baseRepository.name,branch:p.baseRefName,sha:p.baseRefOid,exists:p.baseRef!=null},head:{owner:(c=(s=(o=p.headRepository)==null?void 0:o.owner.login)!=null?s:(a=p.headRepositoryOwner)==null?void 0:a.login)!=null?c:"<unknown>",repo:(u=(l=p.headRepository)==null?void 0:l.name)!=null?u:p.baseRepository.name,branch:p.headRefName,sha:p.headRefOid,exists:p.headRef!=null}}}:void 0}catch(f){Z.error(f);return}}async getPullRequestForBranch(e,r,n){var i,o,a,s,c;try{const{repo:{owner:l,name:u}}=await this.getMetadata(e),f=`query getPullRequestForBranch(
	$owner: String!
	$repo: String!
	$branch: String!
	$maxCount: Int!
	$states: [PullRequestState!]
) {
	repository(name: $repo, owner: $owner) {
		refs(query: $branch, refPrefix: "refs/heads/", first: 1) {
			nodes {
				associatedPullRequests(first: $maxCount, orderBy: {field: UPDATED_AT, direction: DESC}, states: $states) {
					nodes {
						author {
							login
							avatarUrl
							url
						}
						permalink
						number
						title
						state
						updatedAt
						closedAt
						mergedAt
						repository {
							isFork
							name
							owner {
								login
							}
						}
					}
				}
			}
		}
	}
}`,h=await this.graphql(f,{owner:l,repo:u,branch:r,maxCount:(i=n==null?void 0:n.maxCount)!=null?i:1,states:kI(n==null?void 0:n.include)}),p=(c=(s=(a=(o=h==null?void 0:h.repository)==null?void 0:o.refs.nodes[0])==null?void 0:a.associatedPullRequests)==null?void 0:s.nodes)==null?void 0:c.filter(y=>!y.repository.isFork||y.repository.owner.login===l);if(p==null||p.length===0)return;p.length>1&&p.sort((y,w)=>(y.repository.owner.login===l?-1:1)-(w.repository.owner.login===l?-1:1)||(y.state==="OPEN"?-1:1)-(w.state==="OPEN"?-1:1)||new Date(w.updatedAt).getTime()-new Date(y.updatedAt).getTime());const[b]=p;return{author:{name:b.author.login,avatarUrl:b.author.avatarUrl,url:b.author.url},closedAt:b.closedAt?new Date(b.closedAt):void 0,mergedAt:b.mergedAt?new Date(b.mergedAt):void 0,id:b.number.toString(),repo:{name:b.repository.name,owner:b.repository.owner.login},state:zf(b.state),title:b.title,updatedAt:new Date(b.updatedAt),url:b.permalink}}catch(l){Z.error(l);return}}async getTags(e,r){var n,i,o;try{const{repo:{owner:a,name:s}}=await this.getMetadata(e),c=`query getTags(
	$owner: String!
	$repo: String!
	$tagQuery: String!
	$cursor: String
	$limit: Int = 100
) {
	repository(owner: $owner, name: $repo) {
		refs(query: $tagQuery, refPrefix: "refs/tags/", first: $limit, after: $cursor, orderBy: { field: TAG_COMMIT_DATE, direction: DESC }) {
			pageInfo {
				endCursor
				hasNextPage
			}
			nodes {
				name
				target {
					oid
				}
			}
		}
	}
}`,l=await this.graphql(c,{owner:a,repo:s,tagQuery:(n=r==null?void 0:r.query)!=null?n:"",cursor:r==null?void 0:r.cursor,limit:Math.min(100,(i=r==null?void 0:r.limit)!=null?i:100)});if(l===void 0)return{tags:[]};const u=(o=l.repository)==null?void 0:o.refs;if(u===void 0)return{tags:[]};const f=u.nodes.map(h=>({type:Nn.Tag,name:h.name,commit:h.target.oid,commitUrl:h.target.commitUrl}));return{paging:{cursor:u.pageInfo.endCursor,more:u.pageInfo.hasNextPage},tags:f}}catch(a){return{tags:[]}}}async getTarGz(e){var r;const{repo:{owner:n,name:i},HEAD:{sha:o}}=await this.getMetadata(e),a=await this.ensureAuthenticated();try{if(si){const l=Je.get("search.download.corsProxy")||void 0;if(typeof l=="string")throw Error("Error: using outdated `search.download.corsProxy` setting. Please update to new object based configuration.");const u=(r=l==null?void 0:l["github.com"])!=null?r:"vscode.dev";if(u){const f=`https://${u}/indexes/github2/${n}/${i}/${o}`,p=await(await on(f,{headers:{"x-proxy-authorization":`Bearer ${a.accessToken}`},credentials:"include"})).text(),b=await on(p);return new Uint8Array(await b.arrayBuffer())}}const s=`https://api.github.com/repos/${n}/${i}/tarball/${o}`,c=await on(s,{headers:{Authorization:`Bearer ${a.accessToken}`}});return new Uint8Array(await c.arrayBuffer())}catch(s){throw Z.error(s),s}}async pushCommit(e,r,n,i){const o=new $e(`GitHub.pushCommit(${e.toString()}, sha=${r}${n?`, ref=${n}`:""}${i?`, fork=${i.repo.owner}/${i.repo.name}`:""})`);let a;try{const s=await this.getMetadata(e);let c,l;if(i?{repo:{owner:c,name:l}}=i:s.HEAD.type===Le.RemoteBranch&&s.HEAD.branch.remote.accessLevel>=$t.Write?{owner:c,name:l}=s.HEAD.branch.remote.repo:{repo:{owner:c,name:l}}=s,n===void 0&&s.HEAD.detached)throw new Zi("Unable to commit; no current branch");(n==null?void 0:n.startsWith("refs/heads/"))&&(n=n.substr(11));const u=await this.request("PATCH /repos/{owner}/{repo}/git/refs/{ref}",{owner:c,repo:l,ref:`heads/${n!=null?n:s.HEAD.branch.name}`,sha:r});return n===void 0&&!s.HEAD.detached&&await this.fastForwardTo(e,r,s),a=u.data.ref,a}catch(s){throw s instanceof zn&&s.status===422&&s.message.includes("Update is not a fast forward")?new Ha(s):(Z.error(s),s)}finally{o.stop(a?{message:`: Pushed commit to ${a}`}:void 0)}}async queryRepositoryObject(e,r,n,i){var o,a;try{const{repo:{owner:s,name:c},HEAD:{sha:l},path:u}=await this.providerService.getMetadata(e),f=`query ${r}(
	$owner: String!
	$repo: String!
	$expression: String
) {
	repository(owner: $owner, name: $repo) {
		object(expression: $expression) {
			${n}
		}
	}
}`,h=await this.graphql(f,{owner:s,repo:c,expression:i!=null?i:`${l}:${u}`});return(a=(o=h==null?void 0:h.repository)==null?void 0:o.object)!=null?a:void 0}catch(s){Z.error(s);return}}async repositoryObjectExists(e,r){return await this.queryRepositoryObject(e,"exists","			__typename",r)!==void 0}async searchPullRequestsQuery(e,r){try{let n=function(s,c){return{number:s.number,title:s.title,repoWithOwner:s.repository.nameWithOwner,reasons:c?[c]:[],url:s.url}};const i=`query searchPullRequests(
	$authored: String!
	$assigned: String!
	$reviewRequested: String!
	$mentioned: String!
) {
	viewer {
		repositories(first: 100, orderBy: { field: STARGAZERS, direction: DESC }) {
			nodes {
				pullRequests(first: 100, states: OPEN, orderBy: { field: UPDATED_AT, direction: DESC }) {
					nodes {
						number
						title
						url
						repository {
							nameWithOwner
						}
					}
				}
			}
		}
	}
	authored: search(first: 100, query: $authored, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	assigned: search(first: 100, query: $assigned, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	reviewRequested: search(first: 100, query: $reviewRequested, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	mentioned: search(first: 100, query: $mentioned, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
}`;e=e.trim(),(r==null?void 0:r.user)&&(e+=` user:${r.user}`);const o=await this.graphql(i,{authored:(e?`${e} is:pr is:open archived:false author:@me`:"is:pr is:open archived:false author:@me").trim(),assigned:(e?`${e} is:pr is:open archived:false assignee:@me`:"is:pr is:open archived:false assignee:@me").trim(),reviewRequested:(e?`${e} is:pr is:open archived:false review-requested:@me`:"is:pr is:open archived:false review-requested:@me").trim(),mentioned:(e?`${e} is:pr is:open archived:false mentions:@me`:"is:pr is:open archived:false mentions:@me").trim()});return o===void 0?[]:Of([...o.assigned.nodes.map(s=>n(s,"assigned")),...o.reviewRequested.nodes.map(s=>n(s,"review requested")),...o.mentioned.nodes.map(s=>n(s,"mentioned")),...o.authored.nodes.map(s=>n(s,"authored")),...$p(o.viewer.repositories.nodes,s=>s.pullRequests.nodes.map(c=>n(c)))],s=>s.url,(s,c)=>(c.reasons.length!==0&&s.reasons.push(...c.reasons),s))}catch(n){return[]}}async searchRepositoriesQuery(e,r){try{const n=`query searchRepositories(
	$search: String!
) {
	viewer {
		repositories(first: 100, orderBy: { field: UPDATED_AT, direction: DESC }) {
			nodes {
				nameWithOwner
				description
				url
				parent {
					nameWithOwner
				}
				stargazerCount
			}
		}
	}
	search(first: 100, query: $search, type: REPOSITORY) {
		nodes {
			...on Repository {
				nameWithOwner
				description
				url
				parent {
					nameWithOwner
				}
				stargazerCount
			}
		}
	}
}`;(r==null?void 0:r.user)&&(e+=` user:${r.user}`),(r==null?void 0:r.sort)&&(e+=` sort:${r.sort}`),e+=" fork:true";const i=await this.graphql(n,{search:e.trim()});return i===void 0?[]:Of((r==null?void 0:r.user)?[...i.search.nodes,...i.viewer.repositories.nodes]:[...i.viewer.repositories.nodes,...i.search.nodes],a=>a.url).map(a=>{var s,c,l;return{repoWithOwner:a.nameWithOwner,description:(s=a.description)!=null?s:void 0,url:a.url,fork:(l=(c=a.parent)==null?void 0:c.nameWithOwner)!=null?l:void 0,stars:a.stargazerCount}})}catch(n){return[]}}async searchCodeQuery(e,r,n){var i,o,a;const{repo:{owner:s,name:c},HEAD:l,defaultBranch:u}=await this.getMetadata(r),f=[];((i=l.branch)==null?void 0:i.name)!==u.name&&f.push(rc("Cant search branch","Unable to search {0} without index, falling back to {1}.",(a=(o=l.branch)==null?void 0:o.name)!=null?a:l.detached.name,u.name));try{const p=await(await this.octokit({request:{headers:{authorization:`Bearer ${(await this.ensureAuthenticated()).accessToken}`,accept:"application/vnd.github.v3.text-match+json"}}})).request("GET /search/code",{q:`${e} repo:${s}/${c}`}),b=new d.Range(0,0,0,0),y=[];let w=0,_;for(const S of p.data.items)for(const I of S.text_matches){if(w++,n.maxResults!==void 0&&w>n.maxResults)return{matches:y,limitHit:!0};_={path:S.path,ranges:[],preview:I.fragment,matches:[]};for(const D of I.matches){let O=0,te=0,J=0;for(let G=0;G<D.indices[1];G++)G===D.indices[0]&&(te=J),I.fragment[G]===`
`?(O++,J=0):J++;_.ranges.push(b),_.matches.push(new d.Range(O,te,O,J))}y.push(_)}return{matches:y,limitHit:!1,warnings:f}}catch(h){return{matches:[],limitHit:!0}}}async switchTo(e,r,n){const{name:i,repo:o,HEAD:{branch:a}}=await this.getMetadata(e);let s;if(!(r!==void 0&&(typeof r=="string"?(r==null?void 0:r.startsWith("refs/heads/"))?(s={type:Ue.Tree,id:r.substr(11)},r=r.substr(11)):(r==null?void 0:r.startsWith("refs/tags/"))?s={type:Ue.Tree,id:r.substr(10)}:s={type:Ue.Tree,id:r}:s={...r,type:r.type===Ue.Branch||r.type===Ue.Tag?Ue.Tree:r.type},(a==null?void 0:a.name)===s.id)))return{name:i,uri:this.providerService.createVirtualUri(e,{repo:o,ref:s}),location:(n==null?void 0:n.openInNewWindow)?Tt.NewWindow:Tt.CurrentWindow}}async sync(e,r,n){var i,o,a,s,c,l;const u=new $e(`GitHub.sync(${e.toString()}, resolution=${n.conflictResolution}, to=${n.to})`);let f;try{const{metadata:h}=await this.fetchCore(e,!0,{to:n.to});if(h.HEAD.detached){f=" \u2022 Skipped; detached HEAD";return}if(((o=(i=h==null?void 0:h.state)==null?void 0:i.behind)!=null?o:0)>0&&await r.hasChanges(e)){u.logStep("Fetching upstream changes");const p=[],b=(s=(a=h.state)==null?void 0:a.incomingChanges)!=null?s:[];if(b.length>0){const y=await r.getChanges(e);for(const w of y){const _=this.providerService.getRelativeFilePath(e,w.uri),S=b.find(I=>I.uri.path===_);if(S!==void 0){p.push({path:_,current:w,incomingType:S.type});break}}}if(p.length>0)switch(n.conflictResolution){case Zr.KeepCurrent:u.logStep("Syncing (keep) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (keep) upstream changes..."});for(const y of p)await r.keep(y.current.uri,{type:y.incomingType,providerUri:qf(h,h.HEAD.branch.sha,y.path)});break;case Zr.DiscardCurrent:u.logStep("Syncing (discard) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (discard) upstream changes..."});for(const y of p)await r.discard(y.current.uri);break;case Zr.Merge:u.logStep("Syncing (merge) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (merge) upstream changes..."});for(const y of p)await r.merge(y.current.uri,{type:y.incomingType,providerUri:qf(h,h.HEAD.branch.sha,y.path)},{providerUri:qf(h,h.HEAD.sha,y.path)});break;case Zr.Abort:default:throw u.logStep("Syncing (abort) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (abort) upstream changes..."}),await this.providerService.updateMetadata(e,h),new qa}}f=` \u2022 to=${(c=n.to)!=null?c:h.HEAD.branch.sha}`,await this.fastForwardTo(e,(l=n.to)!=null?l:h.HEAD.branch.sha,h)}finally{u.stop(f?{suffix:f}:void 0)}}async fastForwardTo(e,r,n){if(n.HEAD.detached)throw new Zi("Unable to fast-forward; no current branch");if(n.HEAD.sha===r&&n.state===void 0)return;const i=this.asFileTreeKey(e,n.HEAD.sha),o=this.fileTreeCache.get(i);this.fileTreeCache.delete(i),o==null||o.dispose(),Z.log(`Fast forward to ${r}; rootUri=${e.toString()}`),await this.providerService.updateMetadata(e,{...n,HEAD:{...n.HEAD,detached:void 0,sha:r},state:r!==n.HEAD.branch.sha?n.state:void 0,timestamp:Date.now()}),r!==n.HEAD.branch.sha&&n.state===void 0&&await this.fetchCore(e,!1,{to:r})}async getBranchTips(e,r){try{const{repo:{owner:n,name:i},HEAD:o}=await this.getMetadata(e);r===void 0&&(o.type===Le.RemoteBranch?r=`${o.branch.remote.repo.owner}/${o.branch.remote.repo.name}:refs/heads/${o.branch.name}`:r=o.branch?`refs/heads/${o.branch.name}`:"");const a=Uy.exec(r);if(a==null?void 0:a.groups)return this.getRemoteBranchTips(n,i,r);const s=`query getBranchTips(
	$owner: String!
	$repo: String!
	$ref: String!
) {
	repository(owner: $owner, name: $repo) {
		defaultBranchRef {
			target {
				oid
			}
		}
		ref(qualifiedName: $ref) {
			target {
				oid
			}
		}
	}
}`,c=await this.graphql(s,{owner:n,repo:i,ref:r});if((c==null?void 0:c.repository)==null)return;const{defaultBranchRef:l,ref:u}=c.repository;return!l&&!u?void 0:{defaultBranch:l?{sha:l.target.oid}:void 0,branch:u?{sha:u.target.oid}:void 0}}catch(n){return}}async getRemoteBranchTips(e,r,n){try{const i=Uy.exec(n);if((i==null?void 0:i.groups)==null)return;let{remoteOwner:o,remoteRepo:a,remoteRef:s}=i.groups;a||(a=r);const c=`query getRemoteBranchTips(
	$owner: String!
	$repo: String!
	$remoteOwner: String!
	$remoteRepo: String!
	$remoteRef: String!
) {
	repository(owner: $owner, name: $repo) {
		defaultBranchRef {
			target {
				oid
			}
		}
	}
	remote: repository(owner: $remoteOwner, name: $remoteRepo) {
		ref(qualifiedName: $remoteRef) {
			target {
				oid
			}
		}
	}
}`,l=await this.graphql(c,{owner:e,repo:r,remoteOwner:o,remoteRepo:a,remoteRef:s});if((l==null?void 0:l.repository)==null||(l==null?void 0:l.remote)==null)return;const{repository:{defaultBranchRef:u},remote:{ref:f}}=l;return!u&&!f?void 0:{defaultBranch:u?{sha:u.target.oid}:void 0,branch:f?{sha:f.target.oid}:void 0}}catch(i){return}}async getRepositoryInfo(e,r,n,i){var o,a,s,c,l,u,f,h,p,b,y,w,_,S,I,D;try{const O=`number
title
state
maintainerCanModify
baseRef { name }
baseRefName
baseRefOid
baseRepository {
	name
	owner { login }
	defaultBranchRef {
		name
		target { oid }
	}
	viewerPermission
}
headRef { name }
headRefName
headRefOid
headRepository {
	name
	owner { login }
	defaultBranchRef {
		name
		target { oid }
	}
	viewerPermission
}
mergeCommit { oid }
`,te=`query getRepository(
	$owner: String!
	$repo: String!
	$ref: String = ""
	$has_pr: Boolean!
	$pr: Int = 0
) {
	viewer { login }
	repository(owner: $owner, name: $repo) {
		name
		owner { login }
		defaultBranchRef {
			name
			target { oid }
		}
		ref(qualifiedName: $ref) {
			name
			prefix
			target { oid }
		}
		viewerPermission
		pullRequest(number: $pr) @include(if: $has_pr) {
			${O}
		}
	}
}`;let J,G;try{const ye=await this.graphql(te,{owner:e,repo:r,ref:(i==null?void 0:i.ref)!=="HEAD"?i==null?void 0:i.ref:void 0,has_pr:Boolean(i==null?void 0:i.pr),pr:(o=i==null?void 0:i.pr)!=null?o:0});if((ye==null?void 0:ye.repository)==null)return;({repository:G,viewer:{login:J}}=ye)}catch(ye){if((i==null?void 0:i.pr)&&ye instanceof tc&&((s=(a=ye.errors)==null?void 0:a[0])==null?void 0:s.type)==="NOT_FOUND"&&((c=ye.errors[0])==null?void 0:c.message.includes("Could not resolve to a PullRequest"))){({repository:G,viewer:{login:J}}=ye.data);try{const dt=await this.graphql(`query getPullRequestFromParentRepository(
	$owner: String!
	$repo: String!
	$pr: Int!
) {
	repository(owner: $owner, name: $repo) {
		parent {
			pullRequest(number: $pr) {
				${O}
			}
		}
	}
}`,{owner:e,repo:r,pr:i==null?void 0:i.pr});if(((u=(l=dt==null?void 0:dt.repository)==null?void 0:l.parent)==null?void 0:u.pullRequest)==null)throw ye;G.pullRequest=dt.repository.parent.pullRequest}catch{throw ye}}else throw ye}const ue=(f=G.defaultBranchRef)!=null?f:void 0;if((ue==null?void 0:ue.name)==null)return;const re=G.pullRequest;let ae;if(G==null?void 0:G.ref)ae={prefix:G.ref.prefix,name:G.ref.name,sha:G.ref.target.oid};else if(re==null?void 0:re.headRef){let ye=jf(re.headRepository.viewerPermission);ye<$t.Write&&re.maintainerCanModify&&jf(G.viewerPermission)>=$t.Write&&(ye=$t.WriteToPullRequest),ae=re.headRepository.owner.login===e?{prefix:"refs/heads/",name:re==null?void 0:re.headRef.name,sha:(p=(h=re.mergeCommit)==null?void 0:h.oid)!=null?p:re==null?void 0:re.headRefOid}:{prefix:"refs/remotes/",name:re==null?void 0:re.headRef.name,sha:(y=(b=re.mergeCommit)==null?void 0:b.oid)!=null?y:re==null?void 0:re.headRefOid,remote:{name:`${re.headRepository.owner.login}/${re.headRepository.name}`,accessLevel:ye,repo:{owner:re.headRepository.owner.login,name:re.headRepository.name}}}}else(re==null?void 0:re.baseRef)?(ae={prefix:"refs/heads/",name:re==null?void 0:re.baseRef.name,sha:(_=(w=re.mergeCommit)==null?void 0:w.oid)!=null?_:re==null?void 0:re.baseRefOid},n&&(Z.log("Did not find a headRef for PR, falling back to baseRef",re.baseRef),Tr.showPullRequestHeadNotFoundMessage(`${e}/${r}`,`#${i==null?void 0:i.pr}`))):(i==null?void 0:i.ref)==="HEAD"&&(ae={prefix:"refs/heads/",name:ue.name,sha:ue.target.oid});return{user:J,repo:{owner:G.owner.login,name:G.name},accessLevel:jf(G.viewerPermission),ref:ae,defaultBranch:{name:ue.name,sha:ue.target.oid},pullRequest:re?{id:re.number.toString(),state:zf(re.state),title:re.title}:void 0}}catch(O){if(O instanceof tc)switch((I=(S=O.errors)==null?void 0:S[0])==null?void 0:I.type){case"NOT_FOUND":{if((i==null?void 0:i.pr)&&((D=O.errors[0])==null?void 0:D.message.includes("Could not resolve to a PullRequest"))){const J=new gc(O,`${e}/${r}`,`#${i==null?void 0:i.pr}`);throw n&&Tr.showPullRequestNotFoundMessage(J.name,J.id),J}const te=new Ua(O,`${e}/${r}`);throw n&&Tr.showRepositoryNotFoundMessage(te.name),te}case"FORBIDDEN":{const te=new Oa(O,`${e}/${r}`);throw n&&Tr.showRepositoryForbiddenMessage(te.name),te}}Z.error(O,`Failed to get repository info for '${e}/${r}'`),!this.handleRequestErrors(O)&&n&&Tr.showUnableToOpenRepositoryMessage(O);return}}async validateOwnerAndRepoAndSplitRefFromPath(e,r,n){try{const i=await this.request(`GET /repos/{owner}/{repo}/git/extract-ref/${n!=null?n:"HEAD"}`,{owner:e,repo:r});return[e,r]=i.data.name_with_owner.split("/"),n?{owner:e,repo:r,ref:{type:Ue.Tree,id:i.data.ref},path:i.data.path}:{owner:e,repo:r}}catch(i){if(i instanceof zn)switch(i.status){case 401:throw new _n(i,()=>void this.reauthenticate());case 403:throw new Oa(i,`${e}/${r}`);case 404:throw new Ua(i,`${e}/${r}`);case 409:throw new mc(i,`${e}/${r}`)}return}}asFileTreeKey(e,r){return`${Vn(this.providerService.getProviderRootUri(e))}:${r}`}}By([vr()],Wf.prototype,"ensureAuthenticated",1),By([vr()],Wf.prototype,"octokit",1);function zf(t){switch(t){case"OPEN":return bi.Open;case"CLOSED":return bi.Closed;case"MERGED":return bi.Merged}}function kI(t){if(t!==void 0)return t.map(e=>{switch(e){case bi.Open:return"OPEN";case bi.Closed:return"CLOSED";case bi.Merged:return"MERGED"}})}var To;(function(t){t.ADMIN="ADMIN",t.MAINTAIN="MAINTAIN",t.WRITE="WRITE",t.TRIAGE="TRIAGE",t.READ="READ",t.NONE="NONE"})(To||(To={}));function jf(t){switch(t){case To.ADMIN:return $t.Admin;case To.MAINTAIN:return $t.Maintain;case To.WRITE:return $t.Write;case To.TRIAGE:return $t.Triage;case To.READ:return $t.Read;default:return $t.None}}function II(t){switch(t&&(t=t.toLocaleLowerCase()),t){case"blob":return d.FileType.File;case"tree":return d.FileType.Directory;default:return d.FileType.Unknown}}const Hy=class{constructor(t,e,r){this.providerService=t,this.storageService=e,this.changeStore=r,this.lock=new Ac("PendingRepositoryOpenActions"),this.disposable=d.Disposable.from(t.onDidChangeRepositories(n=>n.added.length&&this.onRepositoriesOpened(n.added)))}dispose(){this.disposable.dispose()}async onRepositoriesOpened(t){for(const e of t){const r=await this.getAndDelete(e);(r==null?void 0:r.applyChangeset)&&await this.applyPendingChangeset(e,r.applyChangeset),(r==null?void 0:r.filesToOpen)&&this.openPendingFiles(e.uri,r.filesToOpen),this.fetchOrSync(e)}}async fetchOrSync(t){await this.changeStore.hasChanges(t.uri)?await this.providerService.fetch(t.uri):await this.providerService.sync(t.uri,this.changeStore,{reason:"invoked"})}async get(t){return this.lock.synchronizeRead(()=>this.getCore(t.uri),"PendingRepositoryOpenActions.get")}async getAndDelete(t){Z.debug(`RepositoryOpenActionsService.getAndDelete(${t.uri.toString()})`);try{return await this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t.uri);if(r!==void 0)return await this.storeCore(t.uri,void 0),r},"PendingRepositoryOpenActions.getAndDelete")}catch(e){Z.error(e,`Failed to get pending actions for ${t.uri.toString()}`);return}}async openPendingFiles(t,e){if(e.length!==0){Z.log(`RepositoryOpenActionsService.openPendingFiles(${t.toString()})`,e.join(","));for(let r of e){const n=/:(?<start>\d+)(?:-(?<end>\d+))?$/.exec(r);let i,o;(n==null?void 0:n.groups)!==void 0&&(i=Number(n.groups.start),isNaN(i)&&(i=void 0),o=Number(n.groups.end),isNaN(o)&&(o=void 0),r=r.substring(0,n.index));const a=d.Uri.joinPath(t,r);let s;try{s=await d.workspace.fs.stat(a)}catch{}if((s==null?void 0:s.type)===d.FileType.Directory)d.commands.executeCommand("revealInExplorer",a);else{let c;i!==void 0&&(c={selection:new d.Range(Number(i)-1,0,o!=null?o:i,0)}),d.commands.executeCommand("vscode.open",a,c)}}}}setChangesetToApply(t,e){return Z.log(`RepositoryOpenActionsService.setChangesetToApply(${t.toString()})`),this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t);await this.storeCore(t,{...r,applyChangeset:e})},"PendingRepositoryOpenActions.setChangesetToApply")}setPendingFilesToOpen(t,e){return Z.log(`RepositoryOpenActionsService.setPendingFilesToOpen(${t.toString()})`,e.length),this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t);await this.storeCore(t,{...r,filesToOpen:e})},"PendingRepositoryOpenActions.setPendingFilesToOpen")}async applyPendingChangeset(t,e){Z.log(`RepositoryOpenActionsService.applyPendingChangeset(${t.uri.toString()})`);try{await this.changeStore.applyChangeset(t.uri,e,{save:!0})}catch(r){Z.error(r,`Failed to apply pending changeset for ${t.uri.toString()}`)}}async getCore(t){return this.fromStorage(await this.storageService.get(this.getStorageKey(t)))}storeCore(t,e){return e===void 0||e.applyChangeset===void 0&&(e.filesToOpen===void 0||e.filesToOpen.length===0)?this.storageService.delete(this.getStorageKey(t)):this.storageService.store(this.getStorageKey(t),this.toStorage(e))}getStorageKey(t){return`actions/${we(t)}`}fromStorage(t){if(!!t)try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&pc(n)?d.Uri.from(n):n);return{filesToOpen:e.filesToOpen,applyChangeset:e.applyChangeset}}catch(e){return Z.error(e,"Failed to deserialize pending repository actions"),{}}}toStorage(t){const e={schemaVersion:Hy.storageSchemaVersion,...t};return JSON.stringify(e)}};let qy=Hy;qy.storageSchemaVersion=1;const ln=(0,C.loadMessageBundle)();class DI{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChangeFileDecorations=new d.EventEmitter,this._decorations=new Map,this.disposable=d.Disposable.from(d.window.registerFileDecorationProvider(this),e.onDidChangeRepository(this.onRefresh,this),e.onDidRefresh(this.onRefresh,this),r.onDidChange(this.onUrisChanged,this))}get onDidChangeFileDecorations(){return this._onDidChangeFileDecorations.event}dispose(){this.disposable.dispose(),this._decorations.clear()}onRefresh(){this._decorations.clear(),setTimeout(()=>this._onDidChangeFileDecorations.fire(void 0),0)}onUrisChanged(e){const r=e.map(({uri:n})=>(this._decorations.delete(we(n)),n));setTimeout(()=>this._onDidChangeFileDecorations.fire(r),0)}async provideFileDecoration(e,r){if(e.scheme!==Pt.scheme)return;const n=we(e);let i=this._decorations.get(n);if(i!==void 0)return i!=null?i:void 0;const o=await this.providerService.getIncomingChanges(this.providerService.getVirtualRootUri(e));let a;o.length>0&&(a=o.find(c=>we(c.uri)===n));const s=await this.changeStore.getChange(e);if(s===void 0){if(a!==void 0)switch(a.type){case rt.Created:i={badge:"\u2193A",color:new d.ThemeColor("remoteHub.decorations.incomingAddedForegroundColor"),tooltip:ln("decoration tooltip incoming change added","Pending Incoming Changes (Added)")};break;case rt.Deleted:i={badge:"\u2193D",color:new d.ThemeColor("remoteHub.decorations.incomingDeletedForegroundColor"),tooltip:ln("decoration tooltip incoming change deleted","Pending Incoming Changes (Deleted)")};break;case rt.Changed:i={badge:"\u2193M",color:new d.ThemeColor("remoteHub.decorations.incomingModifiedForegroundColor"),tooltip:ln("decoration tooltip incoming change modified","Pending Incoming Changes (Modified)")};break;default:i={badge:"\u2193~",color:new d.ThemeColor("remoteHub.decorations.incomingModifiedForegroundColor"),tooltip:ln("decoration tooltip incoming change","Pending Incoming Changes")};break}return this._decorations.set(n,i!=null?i:null),i}if(s.conflicts)i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.conflictForegroundColor"),tooltip:ln("decoration tooltip conflicts","Merge Conflicts ({0})",AC(s.conflicts.status))};else if(a!==void 0)switch(a.type){case rt.Created:i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ln("decoration tooltip possible conflict added","Possible Merge Conflicts (Added)")};break;case rt.Deleted:i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ln("decoration tooltip possible conflict deleted","Possible Merge Conflicts (Deleted)")};break;case rt.Changed:i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ln("decoration tooltip possible conflict","Possible Merge Conflicts")};break;default:i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ln("decoration tooltip possible conflict","Possible Merge Conflicts")}}else switch(s.type){case rt.Created:i={badge:"A",color:new d.ThemeColor("remoteHub.decorations.addedForegroundColor"),tooltip:ln("decoration tooltip added","Added")};break;case rt.Changed:i={badge:"M",color:new d.ThemeColor("remoteHub.decorations.modifiedForegroundColor"),tooltip:ln("decoration tooltip modified","Modified")};break;case rt.Deleted:i={badge:"D",color:new d.ThemeColor("remoteHub.decorations.deletedForegroundColor"),tooltip:ln("decoration tooltip deleted","Deleted")};break}return this._decorations.set(n,i!=null?i:null),i}}class ko{constructor(e){this.command=e}get label(){return this.command.title}async execute(){var e;return void await d.commands.executeCommand(this.command.command,...(e=this.command.arguments)!=null?e:[])}}var uu;(function(t){async function e(r,n,i,o,a,s){let c;Array.isArray(a)?c=a:s===void 0&&(c=[],s=a);const l=d.window.createQuickPick(),u=new Fh(500),f=[u],{defaultBranch:h,HEAD:p}=await r.getMetadata(n);async function b(I){var D;const[O,te,J]=await Promise.all([r.getBranches(n,{query:I,limit:100}),r.getTags(n,{query:I,limit:100}),r.getSnapshots(n)]),G=new Set,ue=new Set;for(const ae of J)G.add(ae.hash),ue.add(ae.branch.name);const re=((s==null?void 0:s.filterBranches)?O.branches.filter(s==null?void 0:s.filterBranches):O.branches).filter(ae=>ae.name!==h.name);return[...c,...((D=p.branch)==null?void 0:D.name)!==h.name?[{label:`$(git-branch) ${h.name} (default)`,description:`\u2022$(git-commit) ${fr(h.sha)}${ue.has(h.name)||G.has(h.sha)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,alwaysShow:!0,type:Ue.Branch,name:void 0,sha:h.sha}]:[],...re.map(ae=>({label:`$(git-branch) ${ae.name}`,description:`\u2022$(git-commit) ${fr(ae.commit)}${ue.has(ae.name)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,type:Ue.Branch,name:ae.name,sha:ae.commit})),...te.tags.map(ae=>({label:`$(tag) ${ae.name}`,description:`\u2022$(git-commit) ${fr(ae.commit)}${G.has(ae.commit)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,type:Ue.Tag,name:ae.name,sha:ae.commit}))]}const y=b(void 0);let w,_=!1;async function S(I){w=void 0;const D=l.activeItems;l.items=I!=null?I:await y,_&&D.length!==0&&(l.activeItems=l.items.filter(O=>D.some(te=>te.label===O.label))),l.busy=!1}try{return await new Promise(D=>{var O;f.push(l.onDidHide(()=>D(void 0)),l.onDidChangeValue(te=>{if(_=!1,te=te.trim(),(s==null?void 0:s.allowResetToSha)&&p.branch&&yi(te)){S([{label:`Reset $(git-branch) ${p.branch.name} to $(git-commit) ${te}`,name:p.branch.name,sha:te,type:Ue.Branch}]);return}l.busy=!0;const J=u.debounce(te?()=>b(te):()=>y);w===void 0&&(w=J.then(async G=>S(G)))}),l.onDidAccept(()=>{if(l.activeItems.length!==0){const[te]=l.activeItems;D(te)}})),l.title=o,l.placeholder=i,l.matchOnDescription=!0,l.ignoreFocusOut=(O=s==null?void 0:s.ignoreFocusOut)!=null?O:!0,l.busy=!0,l.show(),w=u.debounce(async()=>y,0).then(te=>S(te))})}finally{l.dispose(),f.forEach(I=>void I.dispose())}}t.show=e})(uu||(uu={}));function Vf(t,e){switch(t){case Le.Branch:case Le.RemoteBranch:return e?"$(git-pull-request)":"$(git-branch)";case Le.Tag:return"$(tag)";case Le.Commit:return"$(git-commit)"}}function PI(t){switch(t){case vt.Active:return"$(layers-active)";case vt.Match:return"$(layers-dot)";case vt.Indexed:return"$(layers)"}}function FI(t,e){switch(t){case Le.Branch:case Le.RemoteBranch:return e?new d.ThemeIcon("git-pull-request"):new d.ThemeIcon("git-branch");case Le.Tag:return new d.ThemeIcon("tag");case Le.Commit:return new d.ThemeIcon("git-commit")}}const de=(0,C.loadMessageBundle)(),NI=new TextDecoder;class $I{constructor(e,r,n,i){this.providerService=e,this.changeStore=r,this.openActionsService=n,this.telemetryService=i,this._onDidCloseRepository=new d.EventEmitter,this._onDidOpenRepository=new d.EventEmitter,this._onDidChangeState=new d.EventEmitter,this._scmProviders=[],this._state="uninitialized",this.disposable=d.Disposable.from(Je.onDidChange(this.onConfigurationChanged,this),this.providerService.onDidChangeRepositories(this.onRepositoriesChanged,this),this.providerService.onDidChangeRepository(async({repository:a})=>{const s=this.getScmProvider(this.providerService.getVirtualUri(a.uri));s!==void 0&&await this.updateStatusBarCommands(s,void 0)}),this.providerService.onDidSyncRepository(async({repository:a,syncing:s})=>{const c=this.getScmProvider(this.providerService.getVirtualUri(a.uri));c!==void 0&&await this.updateStatusBarCommands(c,{syncing:s})}),this.providerService.onDidRefresh(a=>{for(const s of a)this.update(s)}),this.changeStore.onDidChange(a=>this.update(a[0].rootUri)),...this.registerCommands());const o=this.providerService.repositories;this.onRepositoriesChanged({added:o,removed:[]})}get onDidCloseRepository(){return this._onDidCloseRepository.event}get onDidOpenRepository(){return this._onDidOpenRepository.event}get onDidChangeState(){return this._onDidChangeState.event}get repositories(){return this._scmProviders.map(e=>e.repository).filter(e=>Boolean(e))}dispose(){var e;(e=this.disposable)==null||e.dispose()}get staging(){return this._staging===void 0&&(this._staging=Je.get("staging")),this._staging}get state(){return this._state}refresh(){for(const e of this._scmProviders)this.update(e.sourceControl.rootUri)}onConfigurationChanged(e){Je.changed(e,"staging")&&(this._staging=void 0,Je.changed(e,"staging.enabled")&&this.refresh()),Je.changed(e,"commitDirectlyWarning")&&this.refresh()}async onRepositoriesChanged(e){if(e.added.length)for(const r of e.added){const n=await this.update(r.uri);(n==null?void 0:n.repository)&&this._onDidOpenRepository.fire(n.repository)}if(e.removed.length)for(const r of e.removed){const n=this._scmProviders.findIndex(i=>we(i.sourceControl.rootUri)===we(r.uri));if(n!==-1){const i=this._scmProviders[n];i.repository&&this._onDidCloseRepository.fire(i.repository),i.sourceControl.dispose(),this._scmProviders.splice(n,1)}}this._state!=="initialized"&&(this._state="initialized",this._onDidChangeState.fire(this._state)),Di(ci.HasWriteableScmProvider,this._scmProviders.some(r=>!r.isReadonly))}registerCommands(){return[d.commands.registerCommand("remoteHub.createPullRequest",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.createPullRequest"),void this.createPullRequest(e)}),d.commands.registerCommand("remoteHub.createDraftPullRequest",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.createDraftPullRequest"),void this.createPullRequest(e,{draft:!0})}),d.commands.registerCommand("remoteHub.commit",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.commit"),void this.commitChanges(e)}),d.commands.registerCommand("remoteHub.discardAllChanges",async e=>{if(Wy(e)){const o=e.resourceStates.filter(nc);if(o.length!==0){if(await Kf(o))for(const a of o)await this.changeStore.discard(a.resourceUri);else this.telemetryService.sendEvent("command.discardAllChanges.abort",{reason:"aborted"});return}}const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)===void 0)return;this.telemetryService.sendEvent("command.discardAllChanges");const n=await this.changeStore.getChanges(r.rootUri);await Kf(n)?await this.changeStore.discardAll(r.rootUri):this.telemetryService.sendEvent("command.discardAllChanges.abort",{reason:"aborted"})}),d.commands.registerCommand("remoteHub.discardChanges",async e=>{!nc(e)||(this.telemetryService.sendEvent("command.discardChanges"),await Kf([e])?await this.changeStore.discard(e.resourceUri):this.telemetryService.sendEvent("command.discardChanges.abort",{reason:"aborted"}))}),d.commands.registerCommand("remoteHub.stageAllChanges",async e=>{const r=this.getSourceControlFrom(e);(r==null?void 0:r.rootUri)!==void 0&&(this.telemetryService.sendEvent("command.stageAllChanges"),await this.changeStore.stageAll(r.rootUri))}),d.commands.registerCommand("remoteHub.stageChanges",e=>{if(!!nc(e))return this.telemetryService.sendEvent("command.stageChanges"),void this.changeStore.stage(e.resourceUri)}),d.commands.registerCommand("remoteHub.unstageAllChanges",e=>{const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)!==void 0)return this.telemetryService.sendEvent("command.unstageAllChanges"),void this.changeStore.unstageAll(r.rootUri)}),d.commands.registerCommand("remoteHub.unstageChanges",e=>{if(!!nc(e))return this.telemetryService.sendEvent("command.unstageChanges"),void this.changeStore.unstage(e.resourceUri)}),d.commands.registerCommand("remoteHub.keepChanges",e=>{if(!!nc(e))return this.telemetryService.sendEvent("command.keepChanges"),void this.changeStore.keep(e.resourceUri)}),d.commands.registerCommand("remoteHub.openChanges",e=>{var r;const{command:n}=e;if(!!n)return this.telemetryService.sendEvent("command.openChanges"),void d.commands.executeCommand(n.command,...(r=n.arguments)!=null?r:[])}),d.commands.registerCommand("remoteHub.openFile",e=>{var r;if(Gf(e)){const i=this.changeStore.resolveOpenCommand(e.resourceUri,{preserveFocus:!1,preview:!1,viewColumn:d.ViewColumn.Active});return this.telemetryService.sendEvent("command.openFile"),void d.commands.executeCommand(i.command,...(r=i.arguments)!=null?r:[])}const n=d.window.activeTextEditor;if(!!n)return this.telemetryService.sendEvent("command.openFile"),void d.window.showTextDocument(n.document)}),d.commands.registerCommand("remoteHub.createBranch",async e=>{await Mh("remoteHub.createBranchFrom",{...e,fromSha:"HEAD"})}),d.commands.registerCommand("remoteHub.createBranchFrom",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await ic(this._scmProviders,de("choose repo for create branch placeholder","Choose which repository to create a new branch on"),de("choose repo for create branch title","Create Branch"));if(n===void 0)return;this.telemetryService.sendEvent("command.createBranchFrom");const i=await this.providerService.getMetadata(n);if(i.accessLevel<$t.Write){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"no permissions"}),d.window.showErrorMessage(de("no permissions to create branch ","You don't have access to create branches on this repository."));return}let o;if(e==null?void 0:e.fromSha)o=e.fromSha,o==="HEAD"&&(o=i.HEAD.sha);else{const h=await uu.show(this.providerService,n,de("choose branch for create placeholder","Choose which branch to create the new branch from"),de("choose branch for create title","Create Branch \u2022 {0}",i.name));if(!h){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"abandoned branch picker"});return}o=h.sha}let a;try{a=await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>du(this.providerService,n,o,de("create branch","Please provide a new branch name"),de("create branch placeholder","New branch name"),de("create branch title","Create Branch \u2022 {0}",i.name)))}catch(h){Z.error(h),d.window.showErrorMessage(de("unable to create branch","Unable to create the new branch."));return}if(!a){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"abandoned branch name prompt"});return}const s=await this.providerService.switchTo(n,{type:Ue.Branch,id:a});if(!s)return;const c=await this.changeStore.createChangeset(n);c&&await this.openActionsService.setChangesetToApply(s.uri,c);const l=de("switch to branch prompt open","Switch to Branch"),u=de("switch to branch prompt open in new window","Open in New Window"),f=await d.window.showInformationMessage(de("switch to branch prompt",`Created new branch '{0}'.

Any uncommitted changes will be applied to the new branch.

Do you want to switch to the new branch?`,a),{modal:!0,useCustom:!0},l,u);!f||(s.location=f===u?Tt.NewWindow:Tt.CurrentWindow,await nn(s,{skipChangesPrompt:!0}))}),d.commands.registerCommand("remoteHub.applyPatch",async e=>{if(e=this.getSourceControlFrom(e),(e==null?void 0:e.rootUri)===void 0)return;this.telemetryService.sendEvent("command.applyPatch");let r;const n=d.window.activeTextEditor;if((n==null?void 0:n.document.languageId)!=="diff"){const i=await d.window.showOpenDialog({openLabel:de("open patch","Open Patch"),title:de("open patch","Open Patch"),canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Diff:["diff"],Patch:["*","patch"]}});if(i===void 0||i.length===0)return;r=NI.decode(await d.workspace.fs.readFile(i[0]))}else r=n.document.getText();try{await this.changeStore.applyPatch(e.rootUri,r)}catch{d.window.showErrorMessage(de("invalid patch file","Invalid patch file"))}}),d.commands.registerCommand("remoteHub.exportPatch",async e=>{const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)===void 0)return;let n;Gf(e)&&(n=e.resourceUri),this.telemetryService.sendEvent("command.exportPatch");const i=await this.changeStore.createPatch(r.rootUri,n),o=await d.workspace.openTextDocument({language:"diff",content:i});await d.window.showTextDocument(o)}),d.commands.registerCommand("remoteHub.switchToBranch",async e=>{var r,n;const i=(r=e==null?void 0:e.uri)!=null?r:await ic(this._scmProviders,de("choose repo for switch branch placeholder","Choose which repository to switch branches on"),de("choose repo for switch branch title","Switch to Branch or Tag"));if(i===void 0)return;this.telemetryService.sendEvent("command.switchToBranch");const o=[],a=await this.providerService.getMetadata(i);if(e==null?void 0:e.commands)switch(a.accessLevel>=$t.Write&&o.push(new ko(yn({command:"remoteHub.createBranch",title:de("create branch command","$(add) Create New Branch..."),arguments:[{uri:i}]})),new ko(yn({command:"remoteHub.createBranchFrom",title:de("create branch from command","$(add) Create New Branch from..."),arguments:[{uri:i}]}))),a.HEAD.type){case Le.Branch:o.push(new ko(yn({command:"remoteHub.openOnRemote",title:de("open branch on remote command","$(globe) Open Branch on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,branch:a.HEAD.branch.name}]})));break;case Le.RemoteBranch:o.push(new ko(yn({command:"remoteHub.openOnRemote",title:de("open remote branch on remote command","$(globe) Open Remote Branch on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.HEAD.branch.remote.repo,branch:a.HEAD.branch.name}]})));break;case Le.Tag:o.push(new ko(yn({command:"remoteHub.openOnRemote",title:de("open tag on remote command","$(globe) Open Tag on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,branch:a.HEAD.detached.name}]})));break;case Le.Commit:o.push(new ko(yn({command:"remoteHub.openOnRemote",title:de("open commit on remote command","$(globe) Open Commit on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,sha:a.HEAD.sha}]})));break}const s=(n=a.HEAD.branch)==null?void 0:n.name,c=Boolean(s&&!await this.changeStore.hasChanges(i)),l=await uu.show(this.providerService,i,de("choose switch branch placeholder","Choose which branch to switch to"),de("choose switch branch title","Switch to Branch or Tag \u2022 {0}",a.name),o,{allowResetToSha:c,filterBranches:s?u=>u.name!==s:void 0,ignoreFocusOut:!1});if(!l){this.telemetryService.sendEvent("command.switchToBranch.abort",{reason:"abandoned branch picker"});return}return l instanceof ko?void l.execute():c&&l.type===Ue.Branch&&l.name===s&&l.sha?d.window.withProgress({location:d.ProgressLocation.SourceControl},async()=>{try{await this.providerService.sync(i,this.changeStore,{to:l.sha})}catch(u){Z.error(u),d.window.showErrorMessage(de("reset failed","Unable to reset the repository to commit '{0}'.",fr(l.sha)))}}):void d.window.withProgress({location:d.ProgressLocation.SourceControl},async()=>{const u=await this.providerService.switchTo(i,l.name?{type:l.type,id:l.name}:void 0);if(u!==void 0)return nn(u)})}),d.commands.registerCommand("remoteHub.fetch",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await ic(this._scmProviders,de("choose repo for fetch placeholder","Choose which repository to fetch"),de("choose repo for fetch title","Fetch Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.fetch");try{await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.providerService.fetch(n,{force:!0}))}catch(i){d.window.showErrorMessage(de("fetch failed","Unable to fetch repository"))}}}),d.commands.registerCommand("remoteHub.fetchAll",async e=>{const r=this.providerService.repositories;if(r.length===0)return;(e==null?void 0:e.automated)||this.telemetryService.sendEvent("command.fetchAll"),(await d.window.withProgress({location:d.ProgressLocation.SourceControl},async()=>{const i=[];for(const o of r)try{await this.providerService.fetch(o.uri)}catch(a){i.push(a)}return i})).length&&!(e==null?void 0:e.automated)&&d.window.showErrorMessage(r.length?de("fetch all failed","Unable to fetch repositories"):de("fetch failed","Unable to fetch repository"))}),d.commands.registerCommand("remoteHub.pull",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await ic(this._scmProviders,de("choose repo for pull placeholder","Choose which repository to pull"),de("choose repo for pull title","Pull Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.pull");try{await this.sync(n,{pull:!0})}catch{}}}),d.commands.registerCommand("remoteHub.sync",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await ic(this._scmProviders,de("choose repo for sync placeholder","Choose which repository to sync"),de("choose repo for sync title","Synchronize Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.sync");try{await this.sync(n)}catch{}}}),d.commands.registerCommand("remoteHub.disableCommitDirectlyWarning",()=>{this.telemetryService.sendEvent("command.disableCommitDirectlyWarning"),Je.updateEffective("commitDirectlyWarning",B.Off)})]}async sync(e,{pull:r,...n}={pull:!1}){this.telemetryService.sendEvent("sync");try{await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.providerService.sync(e,this.changeStore,n))}catch(i){if(i instanceof qa){const o={title:de("sync confirm","Continue")},a={title:de("sync cancel","Cancel"),isCloseAffordance:!0};await d.window.showWarningMessage(r?de("sync pull",`Pulling in changes may cause conflicts with your uncommitted changes as one of more of those files has changed since you started editing.

Do you want to continue pulling in changes.`):de("sync",`Syncing changes may cause conflicts with your uncommitted changes as one of more of those files has changed since you started editing.

Do you want to continue syncing changes?`),{modal:!0,useCustom:!0},o,a)===o?await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.providerService.sync(e,this.changeStore,{conflictResolution:Zr.Merge})):this.telemetryService.sendEvent("sync.abort",{reason:"abandoned"})}else throw Z.error(i),this.telemetryService.sendException(i),d.window.showErrorMessage(de("sync failed","Unable to sync the repository.")),i}}async commitChanges(e){try{await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.commitChangesCore(e))}catch(r){if(r instanceof $o){d.window.showInformationMessage(de("no changes to commit","There are no changes to commit."));return}Z.error(r),d.window.showErrorMessage(de("commit unable","Unable to commit.")),this.telemetryService.sendException(r)}}async commitChangesCore(e){const r=e.rootUri;this.telemetryService.sendEvent("commit",{staging:String(this.staging.enabled)});const n=new $e(`VirtualSourceControl.commitChanges(${r.toString()})`);let i;try{const o=await this.providerService.getMetadata(r);let a,s;const c=this.staging.enabled?this.staging.smart?"auto":!0:!1;for(;;){const u=e.inputBox.value;if(await this.changeStore.hasMergeConflicts(r)){e.inputBox.showValidationMessage(de("commit resolve conflicts","You must resolve any pending conflicts before committing."),d.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("commit.abort",{reason:"aborted conflicts"}),i=": Aborted; Unresolved conflicts";return}const f=await this.providerService.getCommitOperations(r,this.changeStore,{staged:c});if(f.length===0){e.inputBox.showValidationMessage(this.staging.enabled?de("commit no staged changes","There are no staged changes to commit."):de("commit no changes","There are no changes to commit."),d.SourceControlInputBoxValidationType.Information),this.telemetryService.sendEvent("commit.abort",{reason:this.staging.enabled?"aborted no staged changes":"aborted no changes"}),i=`: Aborted; No ${this.staging.enabled?"staged ":""}changes`;return}if(!u){e.inputBox.showValidationMessage(de("specify commit message","You must specify a commit message before committing."),d.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("commit.abort",{reason:"aborted no message"}),i=": Aborted; No message";return}let h,p;if(o.HEAD.type===Le.RemoteBranch?(p=o.HEAD.branch.remote.accessLevel<$t.Write,h=p&&o.accessLevel<$t.Write):(h=o.accessLevel<$t.Write,p=h),s===void 0&&h&&(s=await this.providerService.getFork(r),s===void 0)){const b={title:de("fork confirm","Fork Repository")},y={title:de("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showInformationMessage(de("fork","You\u2019re trying to make changes in a project you don\u2019t have write access to. Do you want to create a fork of this project to commit your proposed changes to?"),{modal:!0,useCustom:!0},b,y)!==b){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned fork prompt"}),i=": Aborted; Abandoned fork prompt";return}if(s=await d.window.withProgress({location:d.ProgressLocation.Notification,title:de("fork progress","Forking {0}...",o.name)},()=>this.providerService.fork(r)),s===void 0){d.window.showErrorMessage(de("unable to fork","Unable to fork repository.")),this.telemetryService.sendEvent("commit.abort",{reason:"aborted fork failed"}),i=": Aborted; Fork failed";return}}if(s||p){if(s===void 0){const y={title:de("remote branch create branch prompt confirm","Commit to New Branch")},w={title:de("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showErrorMessage(de("remote branch create branch prompt",`You\u2019re trying to make changes to a branch you don\u2019t have write access to.

Do you want to commit your changes to a new branch?`),{modal:!0,useCustom:!0},y,w)!==y){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned remote branch prompt"}),i=": Aborted; Abandoned commit to new branch prompt";return}}let b=0;try{const y=await this.providerService.getBranches(s?this.providerService.createVirtualUri(r,s):r,{query:"patch-"});for(const w of y.branches){const _=/^patch-(?<num>\d+)$/.exec(w.name);if(_==null?void 0:_.groups){const S=Number(_.groups.num);S>b&&(b=S)}}}catch{}if(a=await du(this.providerService,r,o.HEAD.sha,de("create new branch prompt","Create a new branch to commit your changes to"),de("create new branch placeholder","New branch name"),de("create new branch title","Commit \u2022 Create Branch \u2022 {0}",s?s.name:o.name),s,`patch-${b+1}`),!a){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned create branch prompt"}),i=": Aborted; Abandoned create branch prompt";return}}try{if(Je.getUseNewCommitApi())await this.providerService.createAndPushCommit(r,u,f,a,s);else{n.logStep("Creating commit");const b=await this.providerService.createCommit(r,u,f,s);n.logStep("Pushing",{message:`: Created commit ${b}`,suffix:" \u2022 Pushing..."}),await this.providerService.pushCommit(r,b,a,s)}}catch(b){if(b instanceof Zi){const y={title:de("detached head prompt confirm","Commit to New Branch")},w={title:de("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showErrorMessage(de("detached head prompt",`Unable to commit your changes because you are not currently on a branch.

Do you want to commit your changes to a new branch?`),{modal:!0},y,w)!==y){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned detached head prompt"}),i=": Aborted; Abandoned commit to new branch prompt (detached head)";return}if(a=await du(this.providerService,r,o.HEAD.sha,de("create new branch prompt","Create a new branch to commit your changes to"),de("create new branch placeholder","New branch name"),de("create new branch title","Commit \u2022 Create Branch \u2022 {0}",s?s.name:o.name),s),!a){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned detached head create branch prompt"}),i=": Aborted; Abandoned create branch prompt (detached head)";return}continue}else if(b instanceof Ha){const y={title:de("push conflicts prompt pull","Pull")},w={title:de("push conflicts prompt sync","Sync (Pull & Push)")},_={title:de("cancel","Cancel"),isCloseAffordance:!0},S=await d.window.showErrorMessage(de("push conflicts prompt",`Changes have been committed since you started editing, so you must merge those changes before you can commit.

Do you want to pull or sync (pull and automatically push) your changes?`),{modal:!0},y,w,_);if(S!==y&&S!==w){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned conflicts prompt"}),i=": Aborted; Abandoned merge changes prompt";return}if(await this.sync(r,{pull:S===y,conflictResolution:Zr.Merge}),S===y){i=': Aborted; Chose "pull" from merge changes prompt';return}continue}else throw Z.error(b),i=`: Aborted; ${String(b)}`,b}break}if(e.inputBox.value="",s?await this.changeStore.discardAll(r,{staged:c}):await this.changeStore.acceptAll(r,{staged:c}),tp(Io.HasCommitted,!0),!s&&!a)return;async function l(){if(s){const p={title:de("commit to fork confirm","Switch to Fork")},b={title:de("cancel","Cancel"),isCloseAffordance:!0},y=await d.window.showInformationMessage(de("commit to fork","Committed changes to your fork of {0}. Do you want to switch to your fork to continue making changes?",o.name),{modal:!0,useCustom:!0},p,b);if(this.telemetryService.sendEvent("commit.switchToFork",{confirm:String(y===p)}),y===p){let w;a!==void 0?w={type:Ue.Branch,id:a}:o.HEAD.branch!==void 0&&(w={type:Ue.Branch,id:o.HEAD.branch.name}),nn({name:s.name,uri:this.providerService.createVirtualUri(r,{repo:s.repo,ref:w}),location:Tt.CurrentWindow})}return}const u={title:de("commit to new branch confirm","Switch to Branch")},f={title:de("cancel","Cancel"),isCloseAffordance:!0},h=await d.window.showInformationMessage(de("commit to new branch","Committed changes to new branch '{0}'. Do you want to switch to the new branch to continue making changes?",a),{modal:!0,useCustom:!0},u,f);this.telemetryService.sendEvent("commit.switchToBranch",{confirm:String(h===u)}),h===u&&nn({name:o.name,uri:this.providerService.createVirtualUri(r,{repo:o.repo,ref:a?{type:Ue.Branch,id:a}:void 0}),location:Tt.CurrentWindow})}l.call(this)}finally{n.stop(i?{message:i}:void 0)}}async createPullRequest(e,r){try{await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.createPullRequestCore(e,r))}catch(n){if(n instanceof $o){d.window.showInformationMessage(de("no changes to commit","There are no changes to commit."));return}if(n instanceof vc){d.window.showErrorMessage(de("commit unable","Unable to commit."));return}Z.error(n),d.window.showErrorMessage(de("unable to open pr","Unable to open a pull request.")),this.telemetryService.sendException(n)}}async createPullRequestCore(e,r){var n,i;const o=e.rootUri,a=(n=r==null?void 0:r.draft)!=null?n:!1;this.telemetryService.sendEvent("createPullRequest",{draft:String(a),staging:String(this.staging.enabled)});const s=new $e(`VirtualSourceControl.createPullRequest(${o.toString()})`);let c;try{let l=function(){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned branch prompt"}),c=": Aborted; Abandoned commit to new branch prompt"},u;const f=this.staging.enabled?this.staging.smart?"auto":!0:!1;if(!(r==null?void 0:r.sha)){if(await this.changeStore.hasMergeConflicts(o)){e.inputBox.showValidationMessage(de("commit resolve conflicts","You must resolve any pending conflicts before committing."),d.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted conflicts"}),c=": Aborted; Unresolved conflicts";return}if(u=await this.providerService.getCommitOperations(o,this.changeStore,{staged:this.staging.enabled?this.staging.smart?"auto":!0:!1}),u.length===0){e.inputBox.showValidationMessage(this.staging.enabled?de("commit no staged changes","There are no staged changes to commit."):de("commit no changes","There are no changes to commit."),d.SourceControlInputBoxValidationType.Information),this.telemetryService.sendEvent("createPullRequest.abort",{reason:this.staging.enabled?"aborted no staged changes":"aborted no changes"}),c=`: Aborted; No ${this.staging.enabled?"staged ":""}changes`;return}}const h=e.inputBox.value;if(!h){e.inputBox.showValidationMessage(de("specify commit message","You must specify a commit message before committing."),d.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted no message"}),c=": Aborted; No message";return}const p=await this.providerService.getMetadata(o);let b,y;p.HEAD.type===Le.RemoteBranch?(y=p.HEAD.branch.remote.accessLevel<$t.Write,b=y&&p.accessLevel<$t.Write):(b=p.accessLevel<$t.Write,y=b);let w=r==null?void 0:r.fork;if(w===void 0&&b&&(w=await this.providerService.getFork(o),w===void 0)){const te={title:de("fork confirm","Fork Repository")},J={title:de("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showInformationMessage(de("fork",`You\u2019re trying to make changes in a project you don\u2019t have write access to.

Do you want to create a fork of this project to commit your proposed changes to?`),{modal:!0,useCustom:!0},te,J)!==te){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned fork prompt"}),c=": Aborted; Abandoned fork prompt";return}if(w=await d.window.withProgress({location:d.ProgressLocation.Notification,title:de("fork progress","Forking {0}...",p.name)},()=>this.providerService.fork(o)),w===void 0){d.window.showErrorMessage(de("unable to fork","Unable to fork repository.")),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted fork failed"}),c=": Aborted; Fork failed";return}}const _=await d.window.showInputBox({ignoreFocusOut:!0,placeHolder:de("create pr placeholder","Pull request title"),prompt:de("create pr prompt","Enter a title for the new pull request"),title:de("create pr title","New Pull Request"),value:h});if(!_){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned title prompt"}),c=": Aborted; Abandoned title prompt";return}async function S(te){let J=0;try{const G=await this.providerService.getBranches(w?this.providerService.createVirtualUri(o,w):o,{query:"patch-"});for(const ue of G.branches){const re=/^patch-(?<num>\d+)$/.exec(ue.name);if(re==null?void 0:re.groups){const ae=Number(re.groups.num);ae>J&&(J=ae)}}}catch{}return du(this.providerService,o,te,de("create pr branch prompt","Create a new branch for this pull request"),de("create pr branch placeholder","New branch name"),de("create pr branch title","New Pull Request \u2022 Create Branch \u2022 {0}",w?w.name:p.name),w,`patch-${J+1}`)}let I;if(Je.getUseNewCommitApi()){if(I=await S.call(this,p.HEAD.sha),!I){l.call(this);return}(u==null?void 0:u.length)&&await this.providerService.createAndPushCommit(o,h,u,I,w)}else{let te;if((u==null?void 0:u.length)?(te=await this.providerService.createCommit(o,h,u,w),s.log({message:`: Created commit ${te}`})):(te=(i=r==null?void 0:r.sha)!=null?i:p.HEAD.sha,s.log({message:`: Using commit ${te}`})),I=await S.call(this,te),!I){l.call(this);return}}const D=await this.providerService.createPullRequest(o,I,_,{draft:a},w);e.inputBox.value="",(u==null?void 0:u.length)&&(w?await this.changeStore.discardAll(o,{staged:f}):await this.changeStore.acceptAll(o,{staged:f}));async function O(){const te={title:de("created pr notification confirm","Switch to Pull Request")},J={title:de("cancel","Cancel"),isCloseAffordance:!0},G=await d.window.showInformationMessage(de("created pr notification",'Created [Pull Request #{0}]({1} "Open Pull Request #{0} on {2}") for {3}. Do you want to switch to the new pull request?',D.id,D.uri.toString(!0),p.provider.name,p.name),{modal:!0,useCustom:!0},te,J);this.telemetryService.sendEvent("createPullRequest.switchToPullRequest",{confirm:String(G===te)}),G===te&&nn({name:p.name,uri:this.providerService.createVirtualUri(o,{repo:p.repo,ref:{type:Ue.PullRequest,id:D.id}}),location:Tt.CurrentWindow})}O.call(this)}finally{s.stop(c?{message:c}:void 0)}}async update(e){const r=d.workspace.getWorkspaceFolder(e);if(r===void 0)return;const n=await this.createOrUpdateScmProvider(e,r.name),i=await this.changeStore.getGroupedChanges(e,{predicate:c=>c.fileType===d.FileType.File}),o=await Promise.all(i.conflicts.map(async c=>({type:c.type,resourceUri:c.uri,command:await this.changeStore.resolveDiffCommand(c.uri,c.conflicts.incomingUri,de("diff title with conflicts","{0} (Incoming Changes \u2194 Current Changes)",Or(c.uri)))}))),a=await Promise.all(i.staged.map(async c=>({type:c.type,resourceUri:c.uri,command:await this.changeStore.resolveDiffCommand(c.uri,this.providerService.getProviderUri(c.uri),de("diff title index","{0} (Index)",Or(c.uri)))}))),s=await Promise.all(i.working.map(async c=>({type:c.type,resourceUri:c.uri,decorations:{strikeThrough:c.type===rt.Deleted},command:await this.changeStore.resolveDiffCommand(c.uri,this.providerService.getProviderUri(c.uri),de("diff title working","{0} (Working Tree)",Or(c.uri)))})));return this.ensureMergeConflictsGroup(n).resourceStates=o,this.ensureStagedChangesGroup(n).resourceStates=this.staging.enabled?a:[],this.ensureWorkingChangesGroup(n).resourceStates=this.staging.enabled?s:[...a,...s],n}async createOrUpdateScmProvider(e,r){const n=await this.providerService.getMetadata(e),i=this.providerService.isReadonly(e);let o;const a=n.HEAD.branch?n.HEAD.name:void 0;let s=this.getScmProvider(e);if(s===void 0){r=n.name,o=d.scm.createSourceControl(`remoteHub:${n.provider.id}`,r,e),o.quickDiffProvider={provideOriginalResource:l=>this.providerService.getProviderUri(l)};const c=this.providerService.createIGitRepository(e,o,n,this.changeStore);s={id:n.provider.id,name:n.provider.name,sourceControl:o,groups:[],repository:c,isReadonly:i},this.ensureMergeConflictsGroup(s),this.ensureStagedChangesGroup(s),this.ensureWorkingChangesGroup(s),this._scmProviders.push(s)}else o=s.sourceControl;return n.accessLevel>=$t.Write?(o.acceptInputCommand={command:"remoteHub.commit",title:de("scm input accept command title commit","Commit"),arguments:[o]},a?o.inputBox.placeholder=de("scm input placeholder commit","Message (Ctrl+Enter to commit directly to '{0}' on {1})",a,n.provider.name):o.inputBox.placeholder=de("scm input placeholder commit","Message (Ctrl+Enter to commit directly to {0})",n.provider.name),Je.get("commitDirectlyWarning")===B.Off?o.inputBox.validateInput=void 0:o.inputBox.validateInput=c=>{if(Je.get("commitDirectlyWarning")===B.Auto&&Jy(Io.HasCommitted))return;const l=new d.MarkdownString(a?de("scm input validation commit branch directly","Your changes will be committed directly to the '{0}' branch on {1}.",a,n.provider.name):de("scm input validation commit directly","Your changes will be committed directly to {0}.",n.provider.name));return l.isTrusted=!0,l.appendMarkdown(`&nbsp; [${de("scm input validation action","Don't show again")}](command:remoteHub.disableCommitDirectlyWarning '${de("scm input validation action tip","Hide")}')`),{message:l,type:d.SourceControlInputBoxValidationType.Information}}):i?(o.acceptInputCommand=void 0,o.inputBox.placeholder=de("scm input readonly placeholder","Committing is not available for readonly repositories.")):(o.acceptInputCommand={command:"remoteHub.createPullRequest",title:de("scm input accept command title pr","Create a Pull Request"),arguments:[o]},o.inputBox.placeholder=de("scm input placeholder pr","Message (Ctrl+Enter to create a pull request for '{0}'",r)),await this.updateStatusBarCommands(s,{syncing:!1},n),s}async updateStatusBarCommands(e,r,n){var i,o,a;const s=e.sourceControl.rootUri;n=n!=null?n:await this.providerService.getMetadata(s);const{HEAD:c}=n,l=await this.providerService.getIndexMetadata(s),u=(l==null?void 0:l.type)===vt.Active,f=(l==null?void 0:l.type)===vt.Active,h=vt.hasIndex(l==null?void 0:l.type),p=await this.changeStore.hasChanges(s),b=Vf(c.type),y=[];if(y.push(yn({command:"remoteHub.switchToBranch",title:`${b} ${c.name}${p?"*":""}`,tooltip:`${fr(c.sha)}`,arguments:[{uri:s,commands:!0}]})),c.detached||((r==null?void 0:r.syncing)?y.push(yn({command:"",title:"$(sync~spin)",tooltip:de("sync command syncing","Syncing Changes..."),arguments:[]})):y.push(yn({command:"remoteHub.sync",title:`$(sync)${((o=(i=n.state)==null?void 0:i.behind)!=null?o:0)>0?` ${(a=n.state)==null?void 0:a.behind}\u2193`:""}`,tooltip:u||f?de("sync index","Sync to latest indexed commit"):de("sync command","Sync (Pull & Push)"),arguments:[{uri:s}]}))),n.pullRequest&&y.push(yn({command:"remoteHub.openOnRemote",title:`$(git-pull-request) ${n.pullRequest.id}`,tooltip:de("scm statusbar command open pr",`Open Pull Request #{0} on {1}

{2}`,n.pullRequest.id,n.provider.name,n.pullRequest.title),arguments:[{provider:n.provider,repo:n.repo,pullRequest:{id:n.pullRequest.id}}]})),h){const w=this.providerService.getIndexProvider(s);w&&y.push(...await w.getStatusBarContributions(s))}e.sourceControl.statusBarCommands=y}ensureMergeConflictsGroup(e){const r="conflicts";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,de("scm group conflicts","Merge Conflicts")),n.hideWhenEmpty=!0,e.groups.push(n)),n}ensureStagedChangesGroup(e){const r="staged";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,de("scm group staged","Staged Changes")),n.hideWhenEmpty=!0,e.groups.push(n)),n}ensureWorkingChangesGroup(e){const r="changes";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,de("scm group changes","Changes")),e.groups.push(n)),n}getScmProvider(e){const r=we(e);return this._scmProviders.find(n=>we(n.sourceControl.rootUri)===r)}getSourceControlFrom(e){if(e===void 0){if(this._scmProviders.length!==1)return;e=this._scmProviders[0].sourceControl}let r;if(MI(e))r=e;else if(Wy(e)){const n=e,i=this._scmProviders.find(o=>o.groups.includes(n));r=i==null?void 0:i.sourceControl}else if(Gf(e)){const n=e,i=this._scmProviders.find(o=>o.groups.some(a=>a.resourceStates.includes(n)));r=i==null?void 0:i.sourceControl}else{if(this._scmProviders.length!==1)return;r=this._scmProviders[0].sourceControl}return r}}function MI(t){return"rootUri"in t&&"inputBox"in t}function Wy(t){return t!==void 0&&"id"in t&&"label"in t&&"resourceStates"in t&&Array.isArray(t.resourceStates)}function Gf(t){return t!==void 0&&"resourceUri"in t&&t.resourceUri instanceof d.Uri}function nc(t){return"type"in t}async function Kf(t){var e,r,n;if(t.length===0)return!0;let i,o=de("discard","Discard Changes");if(t.length===1){const s=t[0];s.type===rt.Created?(i=de("confirm delete",`Are you sure you want to DELETE {0}?
This is IRREVERSIBLE!
This file will be FOREVER LOST.`,Or((e=s.resourceUri)!=null?e:s.uri)),o=de("delete file","Delete file")):s.type===rt.Deleted?(o=de("restore file","Restore file"),i=de("confirm restore","Are you sure you want to restore {0}?",Or((r=s.resourceUri)!=null?r:s.uri))):i=de("confirm discard","Are you sure you want to discard changes in {0}?",Or((n=s.resourceUri)!=null?n:s.uri))}else t.every(s=>s.type===rt.Created)?i=de("confirm delete multiple",`Are you sure you want to DELETE {0} files?
This is IRREVERSIBLE!
These files will be FOREVER LOST.`,t.length):t.every(s=>s.type===rt.Deleted)?(o=de("restore files","Restore files"),i=de("confirm restore multiple","Are you sure you want to restore {0} files?",t.length)):i=de("confirm discard multiple","Are you sure you want to discard changes in {0} files?",t.length);return await d.window.showWarningMessage(i,{modal:!0,useCustom:!0},o)===o}async function ic(t,e,r){if(t.length===0)return;if(t.length===1)return t[0].sourceControl.rootUri;const n=await d.window.showQuickPick(t.map(({sourceControl:i})=>({label:i.label,uri:i.rootUri})),{placeHolder:e,title:r});if(!!n)return n.uri}async function du(t,e,r,n,i,o,a,s){const c=new Set;let l;const u=d.window.createInputBox();u.ignoreFocusOut=!0;try{return await new Promise((f,h)=>{l=d.Disposable.from(u.onDidHide(()=>f(void 0)),u.onDidChangeValue(p=>{if(p=p.trim(),!p){u.validationMessage=de("scm create branch prompt validation missing name","Please enter a valid branch name");return}if(c.has(p)){u.validationMessage=de("scm create branch prompt validation already exists","Branch '{0}' already exists",p);return}if(!RS(p)){u.validationMessage=de("scm create branch prompt validation invalid name","'{0}' isn't a valid branch name",p);return}u.validationMessage=void 0}),u.onDidAccept(async()=>{const p=u.value;try{u.enabled=!1,u.busy=!0;const b=await t.createBranch(e,p,r,a);f(b)}catch(b){if(b instanceof La){u.enabled=!0,u.busy=!1,u.validationMessage=b.duplicate?de("scm create branch prompt validation already exists","Branch '{0}' already exists",p):de("scm create branch prompt validation invalid","Invalid branch name '{0}'",p),c.add(p);return}h(b)}})),u.prompt=n,u.placeholder=i,u.title=o,s&&(u.value=s),u.show()})}finally{u.dispose(),l==null||l.dispose()}}class Zf{constructor(e,r){this.memento=e,this.scope=r,this._onDidChange=new d.EventEmitter}get onDidChange(){return this._onDidChange.event}async get(e){const r=this.getScoped(e),n=new $e(`MementoStorage.get(${e}): scopedKey=${r}`,{logLevel:Rt.Debug});try{return await Promise.resolve(this.memento.get(r))}finally{n.stop()}}async getKeys(e){const r=this.getScoped(e),n=new $e(`MementoStorage.getKeys(${e}): scopedPrefix=${r}`,{logLevel:Rt.Debug});try{let i=this.getKeysCore(e);if(this.scope!==void 0){const o=this.scope.length+1;i=i.map(a=>a.substr(o))}return await Promise.resolve(i)}finally{n.stop()}}getKeysCore(e){let r=this.memento.keys();return e&&(r=r.filter(n=>n.startsWith(e))),r}async store(e,r){const n=this.getScoped(e),i=new $e(`MementoStorage.store(${e}): scopedKey=${n}`,{logLevel:Rt.Debug});try{return await this.storeCore(e,n,r)}finally{i.stop()}}async storeCore(e,r,n){await this.memento.update(r,n),this._onDidChange.fire({key:e})}async delete(e){const r=this.getScoped(e),n=new $e(`MementoStorage.delete(${e}): scopedKey=${r}`,{logLevel:Rt.Debug});try{return await this.storeCore(e,r,void 0)}finally{n.stop()}}async deleteKeys(e){const r=this.getScoped(e),n=new $e(`MementoStorage.deleteKeys(${e}): scopedPrefix=${r}`,{logLevel:Rt.Debug});try{const i=[],o=this.scope!==void 0?this.scope.length+1:0,a=this.getKeysCore(r);for(const s of a){const c=o!==0?s.substr(o):s;Z.debug(`MementoStorage.deleteKeys(${e}): Deleting key=${c}, scopedKey=${s}`);try{await this.storeCore(c,s,void 0)}catch(l){Z.debug(`MementoStorage.deleteKeys(${e}): Failed to delete key=${c}, scopedKey=${s}`),i.push(c)}}if(i.length)throw new Error(`Failed to delete keys: ${i.join(", ")}`)}finally{n.stop()}}with(e){return new Zf(this.memento,e)}getScoped(e){return`${this.scope!==void 0?`${this.scope}/`:""}${e!=null?e:""}`}}class Xf{constructor(e,r){this.storageUri=e,this.scope=r,this._onDidChange=new d.EventEmitter}get onDidChange(){return this._onDidChange.event}async get(e){const r=this.getScoped(e),n=new $e(`ExtFileStorageService.get(${e}): scopedKey=${r}`,{logLevel:Rt.Debug});try{return await d.workspace.fs.readFile(d.Uri.joinPath(this.storageUri,r))}catch(i){return}finally{n.stop()}}async store(e,r){const n=this.getScoped(e),i=new $e(`ExtFileStorageService.store(${e}): scopedKey=${n}`,{logLevel:Rt.Debug});try{return await this.storeCore(e,n,r)}finally{i.stop()}}async storeCore(e,r,n){await d.workspace.fs.writeFile(d.Uri.joinPath(this.storageUri,r),n),this._onDidChange.fire({key:e})}async delete(e){const r=this.getScoped(e),n=new $e(`ExtFileStorageService.delete(${e}): scopedKey=${r}`,{logLevel:Rt.Debug});try{return await d.workspace.fs.delete(d.Uri.joinPath(this.storageUri,r))}finally{n.stop()}}with(e){return new Xf(this.storageUri,e)}getScoped(e){return`${this.scope!==void 0?`${this.scope}/`:""}${e}`}}const Kt=(0,C.loadMessageBundle)();class mi extends d.TimelineItem{static is(e){return e instanceof mi}constructor(e,r,n,i,{dateType:o,showAuthor:a,dateFormatter:s}){var c;const l=n.message.indexOf(`
`),u=l!==-1?`${n.message.substring(0,l)} \u2026`:n.message,f=o==="authored"?n.authorDate:n.commitDate;super(u,(c=f==null?void 0:f.getTime())!=null?c:0);this.id=n.hash,this.contextValue=`vscode-vfs:${r}:file:commit`,this.command=i,a&&(this.description=n.authorName),this.detail=Kt("timeline item detail",`{0} ({1}) \u2014 {2}
{3}

{4}`,n.authorName,n.authorEmail,fr(n.hash),s.format(f),n.message),this.iconPath=new d.ThemeIcon("git-commit"),this.rootUri=e,this.providerId=r,this.hash=n.hash,this.parents=n.parents,this.message=n.message}}class Ta extends d.TimelineItem{static is(e){return e instanceof Ta}constructor(e,r,n,i,o,{dateFormatter:a,staged:s}){const c=s?Kt("timeline staged changes","Staged Changes"):Kt("timeline uncommitted changes","Uncommitted Changes");super(c,n.timestamp);this.id=s?"index":"working",this.contextValue=`vscode-vfs:${r}:file:${this.id}`,this.command=o,this.iconPath=new d.ThemeIcon("git-commit"),s?this.detail=Kt("timeline index detail",`{0}  \u2014 {1}
{2}

{3}`,Kt("timeline you","You"),Kt("timeline index","Index"),a.format(new Date(n.timestamp)),sg(n.type)):this.detail=Kt("timeline working detail",`{0}  \u2014 {1}
{2}

{3}`,Kt("timeline you","You"),Kt("timeline working","Working Tree"),a.format(new Date(n.timestamp)),sg(n.type)),this.rootUri=e,this.providerId=r,this.hash=s?"~":"",this.parents=i,this.message=c}}class BI{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChange=new d.EventEmitter,this.id="github-file-history",this.label=Kt("timeline.source","GitHub File History"),this.debouncer=new Fh(500),this.disposable=d.Disposable.from(this.debouncer,e.onDidChangeProviders(this.onProvidersChanged,this),e.onDidChangeRepositories(this.onRepositoriesChanged,this),e.onDidChangeRepository(this.onRepositoryChanged,this),e.onDidRefresh(this.onRefresh,this),r.onDidChange(this.onUrisChanged,this),Je.onDidChangeAny(this.onConfigurationChanged,this),...this.registerCommands()),e.hasProviders&&this.ensureProviderRegistration()}get onDidChange(){return this._onDidChange.event}dispose(){var e;(e=this.providerDisposable)==null||e.dispose(),this.disposable.dispose()}onConfigurationChanged(e){(e.affectsConfiguration("git.timeline.date")||e.affectsConfiguration("git.timeline.showAuthor"))&&this.fireChanged()}onProvidersChanged(e){this.ensureProviderRegistration(),this.fireChanged()}onRefresh(e){if(this.rootUri===void 0)return;const r=we(this.rootUri);!e.some(n=>we(n)===r)||this.fireChanged()}onRepositoriesChanged(e){if(this.rootUri===void 0)return;const r=we(this.rootUri);(e.added.some(n=>we(n.uri)===r)||e.removed.some(n=>we(n.uri)===r))&&this.fireChanged()}onRepositoryChanged(e){this.rootUri===void 0||we(this.rootUri)!==we(e.repository.uri)||this.fireChanged()}onUrisChanged(e){if(this.rootUri===void 0)return;const r=we(this.rootUri);e.some(n=>we(n.rootUri)===r)&&this.fireChanged()}async provideTimeline(e,r,n){var i;try{this.rootUri=this.providerService.getVirtualRootUri(e);for(const b of this.providerService.repositories)if(b.uri.path===this.rootUri.path){this.rootUri=b.uri;break}const o=this.providerService.getRelativeFilePath(this.rootUri,e),a=await this.providerService.getMetadata(this.rootUri);if(!a||n.isCancellationRequested)return{items:[]};const s=await this.providerService.getCommits(this.rootUri,{ref:a.HEAD.sha,path:o||void 0,cursor:r.cursor,limit:typeof r.limit=="number"?r.limit:void 0});if(s===void 0||s.commits.length===0||n.isCancellationRequested)return{items:[]};const c=((i=s.paging)==null?void 0:i.more)?{cursor:s.paging.cursor}:void 0,l=new Intl.DateTimeFormat(d.env.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}),u=Je.getAny("git.timeline.date",void 0,"committed"),f=Je.getAny("git.timeline.showAuthor",void 0,!0),h=s.commits.map(b=>new mi(this.rootUri,a.provider.id,b,this.resolveDiffCommand(b,a,e,o),{dateType:u,showAuthor:f,dateFormatter:l})),p=r.cursor===void 0?await this.changeStore.getChange(e):void 0;if(p){const b=Boolean(p.staged&&Je.get("staging.enabled")),y=new Ta(this.rootUri,a.provider.id,p,[s.commits[0].hash],await this.changeStore.resolveDiffCommand(p.uri,this.providerService.getProviderUri(p.uri),b?Kt("diff title index","{0} (Index)",Or(p.uri)):Kt("diff title working","{0} (Working Tree)",Or(p.uri))),{dateFormatter:l,staged:b});h.splice(0,0,y)}return{items:h,paging:c}}catch(o){return Z.error(o),{items:[]}}}ensureProviderRegistration(){this.providerDisposable===void 0&&(this.providerDisposable=d.workspace.registerTimelineProvider([Pt.scheme,...this.providerService.registeredProviders.map(e=>e.id)],this))}fireChanged(){this.debouncer.debounce(()=>this._onDidChange.fire(void 0))}registerCommands(){let e;return[d.commands.registerCommand("remoteHub.timeline.copyCommitId",(r,n,i)=>{!mi.is(r)||d.env.clipboard.writeText(r.hash)}),d.commands.registerCommand("remoteHub.timeline.copyCommitMessage",(r,n,i)=>{!mi.is(r)||d.env.clipboard.writeText(r.message)}),d.commands.registerCommand("remoteHub.timeline.openDiff",async(r,n,i)=>{var o;!mi.is(r)&&!Ta.is(r)||r.command!==void 0&&await d.commands.executeCommand(r.command.command,...(o=r.command.arguments)!=null?o:[])}),d.commands.registerCommand("remoteHub.timeline.openOnGitHub",async(r,n,i)=>{if(!mi.is(r))return;const o=await this.providerService.getMetadata(r.rootUri);await Mh("remoteHub.openOnRemote",{provider:o.provider,repo:o.repo,sha:r.hash})}),d.commands.registerCommand("remoteHub.timeline.selectForCompare",async(r,n,i)=>{!n||!mi.is(r)&&!Ta.is(r)||(e={uri:n,left:r},await d.commands.executeCommand("setContext","remoteHub.timeline.selectedForCompare",!0))}),d.commands.registerCommand("remoteHub.timeline.compareWithSelected",async(r,n,i)=>{if(!n||!e||!mi.is(r)&&!Ta.is(r)||we(n)!==we(e.uri))return;const{left:o}=e,a=this.providerService.getRelativeFilePath(r.rootUri,n),s=await this.providerService.getMetadata(r.rootUri),c=Or(n),l=o.parents[0];let u;l===void 0?u=Kt("timeline diff title ref","{0} ({1})",c,fr(r.hash)):o.hash===""?u=Kt("timeline diff title working","{0} (Working Tree)",c):o.hash==="~"?u=Kt("timeline diff title index","{0} (Index)",c):u=Kt("timeline diff title ref","{0} ({1})",c,fr(o.hash));let f=o.hash===""||o.hash==="~"?n:this.providerService.createProviderUri(n,{repo:s.repo,ref:{type:Ue.Commit,id:l!=null?l:"0000000000000000000000000000000000000000"}},a);l===void 0&&(f=f.with({query:"~"}));const h=r.parents[0];let p;h===void 0?p=Kt("timeline diff title ref","{0} ({1})",c,fr(r.hash)):h==="~"&&r.hash===""?p=Kt("timeline diff title working","{0} (Working Tree)",c):r.hash==="~"?p=Kt("timeline diff title index","{0} (Index)",c):p=Kt("timeline diff title ref","{0} ({1})",c,fr(r.hash));const b=Kt("timeline diff title","{0} \u27F7 {1}",u,p),y=r.hash===""||r.hash==="~"?n:this.providerService.createProviderUri(n,{repo:s.repo,ref:{type:Ue.Commit,id:r.hash}},a);await d.commands.executeCommand("vscode.diff",f,y,b)})]}resolveDiffCommand(e,r,n,i,o){const a=Or(n),s=e.parents[0];let c;s===void 0?c=Kt("timeline diff title ref","{0} ({1})",a,fr(e.hash)):e.hash===""?c=Kt("timeline diff title working","{0} (Working Tree)",a):e.hash==="~"?c=Kt("timeline diff title index","{0} (Index)",a):c=Kt("timeline diff title refs","{0} ({1}) \u27F7  {0} ({2})",a,fr(s),fr(e.hash));let l=this.providerService.createProviderUri(n,{repo:r.repo,ref:{type:Ue.Commit,id:s!=null?s:"0000000000000000000000000000000000000000"}},i);s===void 0&&(l=l.with({query:"~"}));const u=e.hash===""||e.hash==="~"?n:this.providerService.createProviderUri(n,{repo:r.repo,ref:{type:Ue.Commit,id:e.hash}},i);return{command:"vscode.diff",title:"Open Comparison",arguments:[l,u,c,o]}}}class OI{constructor(e,r){this.providerService=e,this.telemetryService=r,this.disposable=d.window.registerUriHandler(this)}dispose(){this.disposable.dispose()}async handleUri(e){var r;const n=new $e(`RemoteUriHandler.handleUri(${e.path}, ${e.toString()})`);try{switch(e.path){case"/open":{this.telemetryService.sendEvent("handleUri.open");let i,o;for(const s of e.query.split("&")){const[c,l]=s.split("=");switch(c){case"url":i=decodeURIComponent(l);break;case"location":o=l===Tt.CurrentWindow?Tt.CurrentWindow:Tt.NewWindow;break}}if(!i){n.log({message:": Unable to find url parameter"}),this.telemetryService.sendEvent("handleUri.open.abort",{reason:"aborted url not found"});return}i=i.trim(),o=o!=null?o:Tt.NewWindow;const a=await this.providerService.createWorkspaceForRemoteUrl(i,void 0,o);if(!a){n.log({message:`: Unable to open workspace for ${i}`}),this.telemetryService.sendEvent("handleUri.open.abort",{reason:"aborted invalid url"});return}n.log({message:`: Opening ${i} in ${o}`}),nn(a);break}case"/open-files":{let i;for(const a of e.query.split("&")){const[s,c]=a.split("=");if(s==="url"){i=decodeURIComponent(c);break}}if(!i){n.log({message:": Unable to find url parameter"});return}i=i.trim();const o=await this.providerService.createWorkspaceForRemoteUrl(i);if(!o){n.log({message:`: Unable to open files/folders for ${i}`});return}o.filesToOpen?(n.log({message:`: Opening files/folders for ${i}`}),await((r=pu())==null?void 0:r.openPendingFiles(o.uri,o.filesToOpen))):n.log({message:`: No files/folders found to open for ${i}`});break}case"/login":{Yv.fire(e);break}default:{n.log({message:`: Unknown Uri ${e.toString()}`});break}}}finally{n.stop()}}}const Wr=(0,C.loadMessageBundle)(),oc=class{constructor(t,e,r,n){this.providerService=t,this.storageService=e,this.changeStore=r,this.workspaceId=n,this._onDidChange=new d.EventEmitter,this.cache=new Map,this.lock=new Ac("WorkspaceRepositories"),this.disposable=d.Disposable.from(this.providerService.onDidChangeRepositories(this.onRepositoriesChanged,this),this.providerService.onDidChangeRepository(this.onRepositoryChanged,this),this.changeStore.onDidChange(this.onChangeStoreChanged,this))}get onDidChange(){return this._onDidChange.event}dispose(){this.disposable.dispose()}async exportDebugInfo(){const t=await d.workspace.openTextDocument({language:"json",content:`Remote Repositories

${this.toStorage(await this.getCore())}`});return void d.window.showTextDocument(t)}onChangeStoreChanged(t){const e=Of(t.map(r=>r.rootUri),r=>we(r)).map(r=>this.providerService.getRepository(r)).filter(r=>Boolean(r));this.addOrUpdate(e)}onRepositoriesChanged(t){this.addOrUpdate(t.added)}onRepositoryChanged(t){this.addOrUpdate([t.repository])}async get(t){let e=await this.lock.synchronizeRead(async()=>{let r=this.cache.get("workspaceRepositories");return r===void 0&&(r=[...(await this.getCore()).values()].sort((n,i)=>i.timestamp-n.timestamp),this.cache.set("workspaceRepositories",r)),r},"WorkspaceRepositories.get");if(t){const r=we(t);e=e.filter(n=>we(n.canonicalUri)===r)}return e}async getCore(){return this.fromStorage(await this.storageService.get(oc.storageKey))}async getByCanonicalUri(){let t=this.cache.get("groupedWorkspaceRepositories");return t===void 0&&(t=gI(await this.get(),e=>we(e.canonicalUri)),this.cache.set("groupedWorkspaceRepositories",t)),t}async getRecents(t=10){return(await this.get()).slice(0,t)}async getRemoteWorkspaceSourceProvider(t){const e=await this.getRecents();if(e.length!==0)return{name:"Recents",label:"Open Recent Repository",icon:"$(history)",placeholder:Wr("pick","Choose a recent repository"),provideSources:function(r,n){return e.filter(i=>i.provider.id===t).map(i=>({name:i.name,icon:"$(repo)",description:Rs(i.timestamp,{ago:!0}),detail:`${i.provider.name}${i.pullRequest?`\xA0\xA0\u2022\xA0\xA0$(git-pull-request) Pull Request #${i.pullRequest.id}`:""}${Pt.isCanonicalUri(i.uri)?"":`\xA0\xA0\u2022\xA0\xA0${Vf(i.ref.type)} ${i.ref.name}`}\xA0\xA0\u2022\xA0\xA0${jy(i.changes)}${i.idx?`\xA0\xA0\u2022\xA0\xA0${PI(i.idx.type)}`:""}`,workspace:{uri:i.uri,name:i.name,location:Tt.CurrentWindow}}))}}}refresh(){this.cache.clear()}async remove(t){await this.lock.synchronizeWrite(async()=>{const e=await this.getCore(),r=`${t.workspaceId}/${we(t.uri)}`,n=e.get(r);if(n===void 0)return;const i=this.changeStore.getScopedChangeStore(n),o=await i.getChanges(n.uri);if(o.length!==0){const a={title:Wr("remove remote repo prompt confirm","Yes")},s={title:Wr("remove remote repo prompt cancel","No"),isCloseAffordance:!0};if(await d.window.showWarningMessage(o.length===1?Wr("remove remote repo prompt file changed",`This repository contains 1 file with uncommitted changes.

Removing it will cause those changes to be FOREVER LOST.
This is IRREVERSIBLE!

Are you sure you still want to remove it?`):Wr("remove remote repo prompt files changes",`This repository contains {0} files with uncommitted changes.

Removing it will cause those changes to be FOREVER LOST.
This is IRREVERSIBLE!

Are you sure you still want to remove it?`,o.length),{modal:!0,useCustom:!0},a,s)!==a)return;await i.discardAll(n.uri)}this.cache.clear(),e.delete(r);try{await this.storageService.store(oc.storageKey,this.toStorage(e))}catch(a){throw Z.error(a,"Failed to save workspace repositories"),a}},"WorkspaceRepositories.remove"),this._onDidChange.fire()}async addOrUpdate(t){await this.lock.synchronizeWrite(async()=>{this.cache.clear();const e=await this.getCore();for(const r of t){const[{HEAD:n,pullRequest:i},o]=await Promise.all([r.getMetadata(),r.getIndexMetadata()]),a=await this.changeStore.getChanges(r.uri);e.set(`${this.workspaceId}/${we(r.uri)}`,{workspaceId:this.workspaceId,uri:r.uri,canonicalUri:r.canonicalUri,name:r.name,provider:r.provider,ref:{type:n.type,name:n.name},idx:(o==null?void 0:o.type)&&vt.hasIndex(o.type)?{type:o.type}:void 0,pullRequest:i?{id:i.id}:void 0,changes:LI(a),timestamp:Date.now()})}try{await this.storageService.store(oc.storageKey,this.toStorage(e))}catch(r){throw Z.error(r,"Failed to save workspace repositories"),r}},"WorkspaceRepositories.addOrUpdate"),this._onDidChange.fire()}fromStorage(t){if(!t)return new Map;try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&pc(n)?d.Uri.from(n):n);return new Map(e.workspaceRepositories)}catch(e){return Z.error(e,"Failed to deserialize workspace repositories"),new Map}}toStorage(t){const e={schemaVersion:oc.storageSchemaVersion,workspaceRepositories:[...t]};return JSON.stringify(e)}};let Qf=oc;Qf.storageKey="workspaceRepositories",Qf.storageSchemaVersion=1;function zy(t){return t!==void 0&&(t.added!==0||t.changed!==0||t.deleted!==0)}function UI(t){return zy(t.changes)}function LI(t){let e=0,r=0,n=0;for(const i of t)switch(i.type){case rt.Created:e++;break;case rt.Changed:r++;break;case rt.Deleted:n++;break}return e||r||n?{added:e,changed:r,deleted:n,timestamp:Date.now()}:void 0}function jy(t,{compact:e=!0,preamble:r,separator:n=", ",short:i=!1,single:o=!1}={}){if(!zy(t))return Wr("no changes","No changes");const{added:a,changed:s,deleted:c}=t;if(o){const u=a+s+c;return u===1?Wr("summary change","{0} change",u):Wr("changes changes","{0} changes",u)}let l=`${r!=null?r:""}`;return(a||!e)&&(l+=i?`+${a}`:a===1?Wr("file added","{0} file added",a):Wr("files added","{0} files added",a),(s||c||!e)&&(l+=n)),(s||!e)&&(l+=i?`~${s}`:s===1?Wr("file changed","{0} file changed",s):Wr("files changed","{0} files changed",s),(c||!e)&&(l+=n)),(c||!e)&&(l+=i?`-${c}`:c===1?Wr("file deleted","{0} file deleted",c):Wr("files deleted","{0} files deleted",c)),l}var HI=Object.defineProperty,qI=Object.getOwnPropertyDescriptor,WI=(t,e,r,n)=>{for(var i=n>1?void 0:n?qI(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&HI(e,r,i),i},ka;(function(t){t.Change="remoteHub:viewItem:change",t.WorkspaceRepository="remoteHub:viewItem:workspaceRepository",t.WorkspaceRepositories="remoteHub:viewItem:workspaceRepositories",t.Message="remoteHub:viewItem:message"})(ka||(ka={}));const Vy=class{constructor(t,e){this.view=t,this.parent=e,this.splatted=!1}static is(t){return t instanceof Vy}get id(){}toString(){return`${Z.toLoggableName(this)}${this.id!==void 0?`(${this.id})`:""}`}getParent(){var t,e;return((t=this.parent)==null?void 0:t.splatted)?(e=this.parent)==null?void 0:e.getParent():this.parent}triggerChange(t=!1,e=!1,r){return this.splatted&&this.parent!==void 0&&this.parent!==r?this.parent.triggerChange(t,e):this.view.refreshNode(this,t,e)}};let Ia=Vy;WI([vr((t=!1,e=!1,r)=>JSON.stringify([t,e,r==null?void 0:r.toString()]))],Ia.prototype,"triggerChange",1);class zI{constructor(e,r,n,i){this.id=e,this.name=r,this.providerService=n,this.telemetryService=i,this._onDidChangeTreeData=new d.EventEmitter,this.disposables=[];const o=!1;if(Z.isDebugging&&o){const a=this.getTreeItem;this.getTreeItem=async function(s){var c;const l=await a.apply(this,[s]),u=s.getParent();return l.tooltip===void 0&&(l.tooltip=new d.MarkdownString(l.label!==void 0&&typeof l.label!="string"?l.label.label:(c=l.label)!=null?c:"")),typeof l.tooltip=="string"?l.tooltip=`${l.tooltip}

---
context: ${l.contextValue}
node: ${s.toString()}${u!==void 0?`
parent: ${u.toString()}`:""}`:l.tooltip.appendMarkdown(`

---

context: \`${l.contextValue}\`\\
node: \`${s.toString()}\`${u!==void 0?`\\
parent: \`${u.toString()}\``:""}`),l}}this.disposables.push(...this.registerCommands()),this.initialize({showCollapseAll:this.showCollapseAll}),setTimeout(()=>this.onConfigurationChanged(),0)}get onDidChangeTreeData(){return this._onDidChangeTreeData.event}get showCollapseAll(){return!0}filterConfigurationChanged(e){return!!Je.changed(e,`views.${this.configKey}`)}dispose(){d.Disposable.from(...this.disposables).dispose()}get title(){return this._title}set title(e){this._title=e,this.tree!==void 0&&(this.tree.title=e)}get description(){return this._description}set description(e){this._description=e,this.tree!==void 0&&(this.tree.description=e)}get message(){return this._message}set message(e){this._message=e,this.tree!==void 0&&(this.tree.message=e)}getQualifiedCommand(e){return`${this.id}.${e}`}onConfigurationChanged(e){e!==void 0&&this.root!==void 0&&this.refresh(!0)}initialize(e={}){this.tree=d.window.createTreeView(this.id,{...e,treeDataProvider:this}),this.disposables.push(Je.onDidChange(r=>{!this.filterConfigurationChanged(r)||(this._config=void 0,this.onConfigurationChanged(r))},this),this.tree),this._title=this.tree.title}ensureRoot(e=!1){return(this.root===void 0||e)&&(this.telemetryService.sendEvent("view.open",{view:this.id}),this.root=this.getRoot()),this.root}getChildren(e){return e!==void 0?e.getChildren():this.ensureRoot().getChildren()}getParent(e){return e.getParent()}getTreeItem(e){return e.getTreeItem()}get selection(){return this.tree===void 0||this.root===void 0?[]:this.tree.selection}get visible(){return this.tree!==void 0?this.tree.visible:!1}async refresh(e=!1){var r,n;await((n=(r=this.root)==null?void 0:r.refresh)==null?void 0:n.call(r,e)),this.triggerNodeChange()}async refreshNode(e,r=!1,n=!1){var i;const o=await((i=e.refresh)==null?void 0:i.call(e,r));!n&&o===!0||this.triggerNodeChange(e)}async reveal(e,r){if(this.tree!==void 0)try{await this.tree.reveal(e,r)}catch(n){Z.error(n)}}async show(){try{await d.commands.executeCommand(`${this.id}.focus`)}catch(e){Z.error(e)}}triggerNodeChange(e){this._onDidChangeTreeData.fire(e!==void 0&&e!==this.root?e:void 0)}get config(){return this._config===void 0&&(this._config=Je.get("views")[this.configKey]),this._config}}class jI extends Ia{constructor(e,r,n,i,o,a,s){super(e,r);this._message=n,this._description=i,this._tooltip=o,this._iconPath=a,this._contextValue=s}getChildren(){return[]}getTreeItem(){var e;const r=new d.TreeItem(this._message,d.TreeItemCollapsibleState.None);return r.contextValue=(e=this._contextValue)!=null?e:ka.Message,r.description=this._description,r.tooltip=this._tooltip,r.iconPath=this._iconPath,r}}var VI=Object.defineProperty,GI=Object.getOwnPropertyDescriptor,Yf=(t,e,r,n)=>{for(var i=n>1?void 0:n?GI(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&VI(e,r,i),i};const sr=(0,C.loadMessageBundle)(),Gy=class extends Ia{constructor(t,e,r,n,i,o,a){super(t,e);this.changeStore=r,this.canonical=n,this.workspaceRepository=i,this.operation=o,this.canApplyChanges=a}static getId(t,e,r){return`${ac.getId(t,e)}:${this.key}(${r.uri.toString()})`}get id(){return Gy.getId(this.canonical.uri,this.workspaceRepository,this.operation)}getChildren(){return[]}async getTreeItem(){const t=this.view.providerService.getRelativeFilePath(this.workspaceRepository.uri,this.operation.uri),e=new d.TreeItem(t,d.TreeItemCollapsibleState.None);return e.id=this.id,e.contextValue=`${ka.Change}${this.canApplyChanges?"+apply":""}`,e.resourceUri=this.view.changeStore.getScopedUri(this.operation.uri,this.workspaceRepository),e.command=await this.getDiffCommand(t,!0),e}async getDiffCommand(t,e=!1){if(e||this._command===void 0){const r=Boolean(this.operation.staged&&Je.get("staging.enabled"));if(this.workspaceRepository.workspaceId===this.view.workspaceId){const n=this.view.providerService.getProviderUri(this.operation.uri);this._command=await this.changeStore.resolveDiffCommand(this.operation.uri,n,r?sr("diff title index","{0} (Index)",Or(this.operation.uri),this.workspaceRepository.ref.name):sr("diff title working","{0} (Working Tree)",Or(this.operation.uri),this.workspaceRepository.ref.name))}else{const{repo:n}=this.view.providerService.getVirtualUriMetadata(this.workspaceRepository.uri),i=this.view.providerService.createProviderUri(this.operation.uri,{repo:n,ref:{type:Ue.Commit,id:this.operation.revision}},t);this._command=await this.changeStore.resolveDiffCommand(this.operation.uri,i,r?sr("diff title changeset index","{0} (Index of {1})",Or(this.operation.uri),this.workspaceRepository.ref.name):sr("diff title changeset working","{0} (Working Tree of {1})",Or(this.operation.uri),this.workspaceRepository.ref.name))}}return this._command}async openChanges(){var t;const e=await this.getDiffCommand(this.view.providerService.getRelativeFilePath(this.workspaceRepository.uri,this.operation.uri));await d.commands.executeCommand(e.command,...(t=e.arguments)!=null?t:[])}async openFile(){const t=this.view.changeStore.getScopedUri(this.operation.uri,this.workspaceRepository.workspaceId);await d.window.showTextDocument(t)}async applyChanges(){const t=await this.view.getRepositoryToApplyChangesetTo(this.workspaceRepository);if(t!==void 0)try{await this.view.changeStore.applyChangeset(t.uri,this.workspaceRepository,this.operation)}catch(e){d.window.showErrorMessage(String(e))}}};let Ky=Gy;Ky.key=":changes";const Zy=class extends Ia{constructor(t,e,r,n,i){super(t,e);this.canonical=r,this.workspaceRepository=n,this.root=i}static getId(t,e){return`${hu.getId(t)}:${this.key}(${e.workspaceId}/${e.uri.toString()})`}get id(){return Zy.getId(this.canonical.uri,this.workspaceRepository)}get name(){return this.workspaceRepository.name}get uri(){return this.workspaceRepository.uri}canApplyChanges(){if(!this.canonical.hasActive||d.workspace.getWorkspaceFolder(this.workspaceRepository.uri)!==void 0)return!1;const{changes:e}=this.workspaceRepository;return e!==void 0&&(e.added!==0||e.changed!==0||e.deleted!==0)}async getChildren(){if(this._children===void 0){const t=this.view.changeStore.getScopedChangeStore(this.workspaceRepository),e=await t.getChanges(this.workspaceRepository.uri);this._children=e.map(r=>new Ky(this.view,this,t,this.canonical,this.workspaceRepository,r,this.canApplyChanges()))}return this._children}getTreeItem(){const t=this.workspaceRepository.workspaceId===this.view.workspaceId,e=UI(this.workspaceRepository),r=Pt.isCanonicalUri(this.workspaceRepository.uri)?sr("repositories view repository default ref","{0} (default)",this.workspaceRepository.ref.name):this.workspaceRepository.ref.name,n=new d.TreeItem(this.root?this.canonical.name:r,e?d.TreeItemCollapsibleState.Collapsed:d.TreeItemCollapsibleState.None);return n.id=this.id,n.contextValue=`${ka.WorkspaceRepository}${t?"+active":""}${this.canApplyChanges()?"+apply":""}`,n.description=`${this.root?`${this.workspaceRepository.ref.name}\xA0\xA0\u2022\xA0\xA0`:""}${Rs(this.workspaceRepository.timestamp,{ago:!0})}`,n.iconPath=t?new d.ThemeIcon("check"):this.root?Yy(this.canonical.provider.id):FI(this.workspaceRepository.ref.type,this.workspaceRepository.pullRequest),n.tooltip=new d.MarkdownString(void 0,!0).appendMarkdown(sr("repositories view repository tooltip",`{0}{1}\\
{2} {3} {4}{5}\\
Last accessed {6}

{7}
`,this.canonical.name,this.workspaceRepository.pullRequest?sr("pull request",`\\
Pull request {0} #{1}`,"$(git-pull-request)",this.workspaceRepository.pullRequest.id):"",ZI(this.workspaceRepository.ref.type),Vf(this.workspaceRepository.ref.type),r,t?` \u2014 _${sr("repositories view repository tooltip active","Active")}_ `:"",Rs(this.workspaceRepository.timestamp,{ago:!0}),jy(this.workspaceRepository.changes,{preamble:`${sr("repositories view has changes","Has Uncommitted Changes")}\\
`}))),e&&(n.resourceUri=d.Uri.parse("remotehub-view://wsrepo/changes")),n}refresh(t=!1){t&&(this._children=void 0)}async applyAllChanges(){const t=await this.view.getRepositoryToApplyChangesetTo(this.workspaceRepository);if(t!==void 0)try{await this.view.changeStore.applyChangeset(t.uri,this.workspaceRepository)}catch(e){d.window.showErrorMessage(String(e))}}remove(){return this.view.workspaceRepositories.remove(this.workspaceRepository)}};let ac=Zy;ac.key=":wsrepo",Yf([vr()],ac.prototype,"refresh",1);const Xy=class extends Ia{constructor(t,e,r,n){super(t,e);this.canonical=r,this.workspaceRepositories=n}static getId(t){return`remoteHub${this.key}(${t.toString()})`}get id(){return Xy.getId(this.canonical.uri)}get name(){return this.canonical.name}get uri(){return this.canonical.uri}getChildren(){if(this.children===void 0){const t=this.workspaceRepositories;if(t.length===0)return this.view.message=void 0,[new jI(this.view,this,sr("repositories view message empty","No GitHub repositories could be found."))];this.view.message=void 0,this.children=t.map(e=>new ac(this.view,this,this.canonical,e,!1))}return this.children}getTreeItem(){const t=this.workspaceRepositories.some(r=>r.workspaceId===this.view.workspaceId),e=new d.TreeItem(this.canonical.name,t?d.TreeItemCollapsibleState.Expanded:d.TreeItemCollapsibleState.Collapsed);return e.contextValue=ka.WorkspaceRepositories,e.iconPath=Yy(this.canonical.provider.id),e}refresh(t=!1){t&&(this.children=void 0)}};let hu=Xy;hu.key=":wsrepos",Yf([vr()],hu.prototype,"refresh",1);class Qy extends Ia{constructor(e){super(e);this.splatted=!0}async getChildren(){if(this.children===void 0){const e=await this.view.workspaceRepositories.getByCanonicalUri();if(e.size===0)return this.view.message=sr("repositories view message empty","No GitHub repositories could be found."),[];this.view.message=void 0;const r=[];for(const[n,i]of e){const o=d.Uri.parse(n);try{const{name:a,provider:s}=this.view.providerService.getVirtualUriMetadata(o),c={uri:o,name:a,provider:s,hasActive:i.some(l=>l.workspaceId===this.view.workspaceId)};i.length===1?r.push(new ac(this.view,this,c,i[0],!0)):r.push(new hu(this.view,this,c,i))}catch(a){if(a instanceof wi)continue;Z.error(a)}}this.children=r}return this.children}getTreeItem(){return new d.TreeItem("Repositories",d.TreeItemCollapsibleState.Expanded)}refresh(e=!1){e&&(this.children=void 0)}}Yf([vr()],Qy.prototype,"refresh",1);class KI extends zI{constructor(e,r,n,i,o){super("remoteHub.views.workspaceRepositories",sr("remote view title","GitHub Repositories"),e,o);this.workspaceRepositories=r,this.changeStore=n,this.workspaceId=i,this.configKey="workspaceRepositories",this.disposables.push(this.workspaceRepositories.onDidChange(this.onRepositoriesChanged,this),d.window.registerFileDecorationProvider({provideFileDecoration:(a,s)=>{if(!(a.scheme!=="remotehub-view"||a.authority!=="wsrepo"||!a.path.includes("/changes")))return{badge:"\u25CF",color:new d.ThemeColor("remoteHub.decorations.workspaceRepositoriesView.hasUncommittedChangesForegroundColor"),tooltip:sr("repositories view decoration has changes","Has Uncommitted Changes")}}}))}getRoot(){return new Qy(this)}onRepositoriesChanged(){this.refresh(!0)}registerCommands(){return[d.commands.registerCommand(this.getQualifiedCommand("refresh"),()=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.refresh"),this.workspaceRepositories.refresh(),void this.refresh(!0)),this),d.commands.registerCommand(this.getQualifiedCommand("open"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.open"),nn({name:e.name,uri:e.uri,location:Tt.CurrentWindow})),this),d.commands.registerCommand(this.getQualifiedCommand("openInNewWindow"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openInNewWindow"),nn({name:e.name,uri:e.uri,location:Tt.NewWindow})),this),d.commands.registerCommand(this.getQualifiedCommand("applyAllChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.applyAllChanges"),e.applyAllChanges()),this),d.commands.registerCommand(this.getQualifiedCommand("remove"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.remove"),e.remove()),this),d.commands.registerCommand(this.getQualifiedCommand("openChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openChanges"),e.openChanges()),this),d.commands.registerCommand(this.getQualifiedCommand("openFile"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openFile"),e.openFile()),this),d.commands.registerCommand(this.getQualifiedCommand("applyChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.applyChanges"),e.applyChanges()),this)]}async getRepositoryToApplyChangesetTo(e){const r=we(this.providerService.getVirtualCanonicalRootUri(e.uri)),n=this.providerService.repositories.filter(o=>we(o.canonicalUri)===r);return await XI(n,sr("apply changeset pick repository placeholder","Choose a repository to apply the changeset to"))}}function ZI(t,e){switch(t){case Le.Branch:return e?sr("type pr branch","Pull Request #{0}",e.id):sr("type branch","Branch");case Le.RemoteBranch:return e?sr("type pr remote branch","Pull Request #{0}",e.id):sr("type remote branch","Remote Branch");case Le.Tag:return sr("type tag","Tag");case Le.Commit:return sr("type commit","Commit")}}function Yy(t){switch(t){case Ur.GitHub:return new d.ThemeIcon("github");case Ur.AzureRepos:return new d.ThemeIcon("azure");default:return new d.ThemeIcon("vm")}}async function XI(t,e){if(t.length!==0){if(t.length>1){const r=await d.window.showQuickPick(t.map(n=>({label:n.name,description:n.provider.name,repository:n})),{placeHolder:e});return r?r.repository:void 0}return t[0]}}const Jf=(0,C.loadMessageBundle)();let fu;function pu(){return fu}var Io;(function(t){t.HasCommitted="has:committed",t.Version="version"})(Io||(Io={}));let ep;function Jy(t){return ep.globalState.get(t)}async function tp(t,e){return ep.globalState.update(t,e)}let eb=!1;function tb(){return eb}async function QI(t){ep=t,Pp.configure(t),Z.configure(t,Je.get("logLevel")),$e.start("Time to root directory",{log:!1});const e=t.extension.packageJSON.displayName;if(t.extension.id==="GitHub.remotehub-insiders"){eb=!0;const o=d.extensions.getExtension("GitHub.remotehub");if(o!==void 0){const a=o.packageJSON.displayName;Z.warn(`${e} was NOT activated because ${a} is also enabled`),setTimeout(()=>void d.window.showErrorMessage(Jf("more than one version enabled warning","{0} cannot be used while {1} is also enabled. Please ensure that only one version is enabled.",e,a),Jf("ok","OK")),0);return}}const r=Dh.configure(t),n=new _s(t),i=t.extension.packageJSON.version;await tp(Io.Version,i),await t.workspaceState.update(Io.Version,i);try{const o=new Zf(t.globalState),a=o.with(r),s=new Xf(t.globalStorageUri,r),c=new Ba(a),l=new Pt(c,n),u=new Ka(l,a,s,n,r);u.getWorkspacesWithChanges(),fu=new qy(l,o,u);const f=new $I(l,u,fu,n),h=new Ak(t.globalStorageUri,l),p=new CR(l),b=new Qf(l,o,u,r);return t.subscriptions.push(Je.onDidChange(y=>{!Je.changed(y,"logLevel")||(Z.logLevel=Je.get("logLevel"))}),l.onDidChangeRepositories(async y=>{for(const w of y.added)try{const _=await w.getMetadata(),{HEAD:S,defaultBranch:I,name:D,provider:O,pullRequest:te}=_,J=S.name.replace(/\//g,"\u2009\u2215\u2009");let G=" ";if(te!==void 0)G=` ($(git-pull-request) ${te.id}) `;else if(S.type===Le.Tag)G=` ($(tag) ${J}) `;else if(S.type===Le.Commit)G=` ($(git-commit) ${J}) `;else if(S.type===Le.Branch||S.type===Le.RemoteBranch){const re=S.branch.name.replace(/\//g,"\u2009\u2215\u2009"),ae=S.branch.name===I.name,ye=await w.getIndexMetadata();ae?(ye==null?void 0:ye.type)===vt.Active&&(G=" ($(layers-active)) "):(ye==null?void 0:ye.type)===vt.Active?G=Jf("indexed tip with branch"," ({0} - {1}) ",re,"$(layers-active)"):G=` (${re})`}const ue={uri:w.uri,type:"folder",label:`${D}${G}[${O.name}]`};d.commands.executeCommand("_workbench.addToRecentlyOpened",ue)}catch(_){Z.error(_,"Failed to add repository to recently opened")}}),new DI(l,u),new WE,new Hl(l,u),new BI(l,u),new OI(l,n),...qE(l,u,b,t.extension.id,n),...tD(l,u),...YI(l,u,f,h,t),new KI(l,b,u,r,n),h,b,f,fu,u,l,n),n.sendEvent("activate"),Promise.resolve(p)}catch(o){throw Z.error(o),o}}function YI(t,e,r,n,i){const o=rb()?new SR(t):void 0;return[JI(t,e,o,r,n),...Je.get("azureRepos.enabled")?[new mo(i),eD(t,e,o)]:[]]}function JI(t,e,r,n,i){const o=new Wf(t,i),a=new ou(t,o,e,i);async function s(){var l;try{let u=(l=d.extensions.getExtension("GitHub.vscode-pull-request-github"))!=null?l:d.extensions.getExtension("GitHub.vscode-pull-request-github-insiders");u||(Z.log("[ GHPR] Not currently installed or enabled; waiting..."),await new Promise(w=>{const _=d.extensions.onDidChange(()=>{var S;u=(S=d.extensions.getExtension("GitHub.vscode-pull-request-github"))!=null?S:d.extensions.getExtension("GitHub.vscode-pull-request-github-insiders"),u&&(_.dispose(),w())})})),Z.log("[ GHPR] Registering..."),Di(ci.HasPullRequestExtension,!0);const f=await u.activate();if(!f)throw new Error("Unable to get registration api");const h=f.registerGitProvider(n),p=t.onDidChangeRepositories(w=>b(w));async function b(w){const _=w.added.filter(S=>S.provider.id===Ur.GitHub);if(_.length!==0){Z.log("[ GHPR] Checking for opened PRs...");for(const S of _){const I=await t.getBestRemoteUri(S.uri,Gr.PullRequest);if(!!I){p.dispose(),Z.log("[ GHPR] Opened PR found; preloading"),d.commands.executeCommand("github.api.preloadPullRequest",I.toString());return}}Z.log("[ GHPR] No opened PRs found")}}Z.log("[ GHPR] Registration complete");const y=t.repositories;return y.length&&b({added:y,removed:[]}),d.Disposable.from(h,p)}catch(u){return Z.error(u,"[ GHPR] Registration failed;"),{dispose:()=>{}}}}const c=s();return d.Disposable.from(t.register(Ur.GitHub,"GitHub",o,a,r),o,a,{dispose:async()=>{var l;return void((l=await c)==null?void 0:l.dispose())}})}function eD(t,e,r){const n=new a0(t),i=new kl(t,n,e);return d.Disposable.from(t.register(Ur.AzureRepos,"Azure Repos",n,i,r),n,i)}function tD(t,e){if(!rb())return[];const r=new gR(t,e);return[r,r.register(new X0),...X0.createStatus()]}function rb(){return d.env.uiKind===d.UIKind.Desktop||Je.get("richNavigation.enabled")===!0}})(),module.exports=__webpack_exports__})();
