(()=>{var __webpack_modules__={879:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.ByteStream=void 0;class B{constructor(N){this.bytes=N,this.byteIndexCurrent=0}hasMoreBytes(){return this.byteIndexCurrent<this.bytes.length}readBytes(N){const $=this.byteIndexCurrent;return this.byteIndexCurrent+=N,this.bytes.slice($,this.byteIndexCurrent)}readByte(){let N=this.bytes[this.byteIndexCurrent];return this.byteIndexCurrent++,N}readString(N){let $="";for(let q=0;q<N;q++){const W=this.readByte();W!=0&&($+=String.fromCharCode(W))}return $}}C.ByteStream=B},7106:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.ChunkSize=C.HeaderSizeInBytes=C.FileNameMaxLength=void 0,C.FileNameMaxLength=99,C.HeaderSizeInBytes=500,C.ChunkSize=512},5759:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TarFile=void 0;const A=B(879),N=B(7106),$=B(4108),q=B(3335);class W{constructor(m){this.entries=m}static fromBytes(m){const E=new A.ByteStream(m),R=[],_=N.ChunkSize;let k=0;for(;E.hasMoreBytes()==!0;){const F=E.readBytes(_);let Q=!0;for(let he=0;he<F.length;he++)if(F[he]!=0){Q=!1;break}if(Q==!0){if(k++,k==2)break}else{k=0;const he=$.TarFileEntry.fromBytes(F,E);R.push(he)}}let H=new W(R);return H.consolidateLongPathEntries(),H}consolidateLongPathEntries(){var m;const E=q.TarFileTypeFlag.Instances().LongFilePath.name,R=this.entries;for(let _=0;_<R.length;_++){const k=R[_];if(((m=k.header.typeFlag)===null||m===void 0?void 0:m.name)==E){const H=R[_+1];H.header.fileName=k.dataAsBytes.reduce((F,Q)=>F+=String.fromCharCode(Q),""),H.header.fileName=H.header.fileName.replace(/\0/g,""),R.splice(_,1),_--}}}}C.TarFile=W},4108:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TarFileEntry=void 0;const A=B(7106),N=B(2895);class ${constructor(W,P){this.header=W,this.dataAsBytes=P}static fromBytes(W,P){const m=A.ChunkSize,E=N.TarFileEntryHeader.fromBytes(W),R=E.fileSizeInBytes,k=Math.ceil(R/m)*m,H=P.readBytes(k).slice(0,R);return new $(E,H)}}C.TarFileEntry=$},2895:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TarFileEntryHeader=void 0;const A=B(879),N=B(3335);class ${constructor(W,P,m,E,R,_,k,H,F,Q,he,be,j,Z,X,L){this.fileName=W,this.fileMode=P,this.userIDOfOwner=m,this.userIDOfGroup=E,this.fileSizeInBytes=R,this.timeModifiedInUnixFormat=_,this.checksum=k,this.typeFlag=H,this.nameOfLinkedFile=F,this.uStarIndicator=Q,this.uStarVersion=he,this.userNameOfOwner=be,this.groupNameOfOwner=j,this.deviceNumberMajor=Z,this.deviceNumberMinor=X,this.filenamePrefix=L,this.fullFileName=L.length?L.endsWith("/")?L+W:L+"/"+W:W}static fromBytes(W){const P=new A.ByteStream(W),m=P.readString(100).trim(),E=P.readString(8),R=P.readString(8),_=P.readString(8),k=P.readString(12),H=P.readBytes(12),F=P.readString(8),Q=P.readString(1),he=P.readString(100),be=P.readString(6),j=P.readString(2),Z=P.readString(32),X=P.readString(32),L=P.readString(8),z=P.readString(8),ee=P.readString(155),ae=P.readBytes(12),ie=parseInt(k.trim(),8),ce=parseInt(F,8),ge=N.TarFileTypeFlag.Instances()._All,Te="_"+Q,Be=ge[Te];return new $(m,E,R,_,ie,H,ce,Be,he,be,j,Z,X,L,z,ee)}}C.TarFileEntryHeader=$},3335:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TarFileTypeFlag=void 0;class B{constructor($,q){this.value=$,this.id="_"+this.value,this.name=q}static Instances(){return B._instances==null&&(B._instances=new A),B._instances}}C.TarFileTypeFlag=B;class A{constructor(){this.Normal=new B("0","Normal"),this.HardLink=new B("1","Hard Link"),this.SymbolicLink=new B("2","Symbolic Link"),this.CharacterSpecial=new B("3","Character Special"),this.BlockSpecial=new B("4","Block Special"),this.Directory=new B("5","Directory"),this.FIFO=new B("6","FIFO"),this.ContiguousFile=new B("7","Contiguous File"),this.LongFilePath=new B("L","././@LongLink"),this._All=[this.Normal,this.HardLink,this.SymbolicLink,this.CharacterSpecial,this.BlockSpecial,this.Directory,this.FIFO,this.ContiguousFile,this.LongFilePath];for(let $=0;$<this._All.length;$++){const q=this._All[$];this._All[q.id]=q}}}},5790:(d,C,B)=>{"use strict";var A;A={value:!0},C.t9=A=A=A=void 0;const N=B(5759);A={enumerable:!0,get:function(){return N.TarFile}};const $=B(4108);A={enumerable:!0,get:function(){return $.TarFileEntry}};const q=B(2895);A={enumerable:!0,get:function(){return q.TarFileEntryHeader}},C.t9=W=>N.TarFile.fromBytes(W)},3672:(d,C)=>{"use strict";var B=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof A!="undefined")return A;throw new Error("unable to locate global object")},A=B();d.exports=C=A.fetch,A.fetch&&(C.default=A.fetch.bind(A)),C.Headers=A.Headers,C.Request=A.Request,C.Response=A.Response},9742:(d,C)=>{"use strict";C.byteLength=m,C.toByteArray=R,C.fromByteArray=H;for(var B=[],A=[],N=typeof Uint8Array!="undefined"?Uint8Array:Array,$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q=0,W=$.length;q<W;++q)B[q]=$[q],A[$.charCodeAt(q)]=q;A["-".charCodeAt(0)]=62,A["_".charCodeAt(0)]=63;function P(F){var Q=F.length;if(Q%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var he=F.indexOf("=");he===-1&&(he=Q);var be=he===Q?0:4-he%4;return[he,be]}function m(F){var Q=P(F),he=Q[0],be=Q[1];return(he+be)*3/4-be}function E(F,Q,he){return(Q+he)*3/4-he}function R(F){var Q,he=P(F),be=he[0],j=he[1],Z=new N(E(F,be,j)),X=0,L=j>0?be-4:be,z;for(z=0;z<L;z+=4)Q=A[F.charCodeAt(z)]<<18|A[F.charCodeAt(z+1)]<<12|A[F.charCodeAt(z+2)]<<6|A[F.charCodeAt(z+3)],Z[X++]=Q>>16&255,Z[X++]=Q>>8&255,Z[X++]=Q&255;return j===2&&(Q=A[F.charCodeAt(z)]<<2|A[F.charCodeAt(z+1)]>>4,Z[X++]=Q&255),j===1&&(Q=A[F.charCodeAt(z)]<<10|A[F.charCodeAt(z+1)]<<4|A[F.charCodeAt(z+2)]>>2,Z[X++]=Q>>8&255,Z[X++]=Q&255),Z}function _(F){return B[F>>18&63]+B[F>>12&63]+B[F>>6&63]+B[F&63]}function k(F,Q,he){for(var be,j=[],Z=Q;Z<he;Z+=3)be=(F[Z]<<16&16711680)+(F[Z+1]<<8&65280)+(F[Z+2]&255),j.push(_(be));return j.join("")}function H(F){for(var Q,he=F.length,be=he%3,j=[],Z=16383,X=0,L=he-be;X<L;X+=Z)j.push(k(F,X,X+Z>L?L:X+Z));return be===1?(Q=F[he-1],j.push(B[Q>>2]+B[Q<<4&63]+"==")):be===2&&(Q=(F[he-2]<<8)+F[he-1],j.push(B[Q>>10]+B[Q>>4&63]+B[Q<<2&63]+"=")),j.join("")}},5186:(d,C,B)=>{var A=B(3698),N=B(2505),$=B(6417),q=Function.bind,W=q.bind(q);function P(k,H,F){var Q=W($,null).apply(null,F?[H,F]:[H]);k.api={remove:Q},k.remove=Q,["before","error","after","wrap"].forEach(function(he){var be=F?[H,he,F]:[H,he];k[he]=k.api[he]=W(N,null).apply(null,be)})}function m(){var k="h",H={registry:{}},F=A.bind(null,H,k);return P(F,H,k),F}function E(){var k={registry:{}},H=A.bind(null,k);return P(H,k),H}var R=!1;function _(){return R||(console.warn('[before-after-hook]: "Hook()" repurposing warning, use "Hook.Collection()". Read more: https://git.io/upgrade-before-after-hook-to-1.4'),R=!0),E()}_.Singular=m.bind(),_.Collection=E.bind(),d.exports=_,d.exports.Hook=_,d.exports.Singular=_.Singular,d.exports.Collection=_.Collection},2505:d=>{d.exports=C;function C(B,A,N,$){var q=$;B.registry[N]||(B.registry[N]=[]),A==="before"&&($=function(W,P){return Promise.resolve().then(q.bind(null,P)).then(W.bind(null,P))}),A==="after"&&($=function(W,P){var m;return Promise.resolve().then(W.bind(null,P)).then(function(E){return m=E,q(m,P)}).then(function(){return m})}),A==="error"&&($=function(W,P){return Promise.resolve().then(W.bind(null,P)).catch(function(m){return q(m,P)})}),B.registry[N].push({hook:$,orig:q})}},3698:d=>{d.exports=C;function C(B,A,N,$){if(typeof N!="function")throw new Error("method for before hook must be a function");return $||($={}),Array.isArray(A)?A.reverse().reduce(function(q,W){return C.bind(null,B,W,q,$)},N)():Promise.resolve().then(function(){return B.registry[A]?B.registry[A].reduce(function(q,W){return W.hook.bind(null,q,$)},N)():N($)})}},6417:d=>{d.exports=C;function C(B,A,N){if(!!B.registry[A]){var $=B.registry[A].map(function(q){return q.orig}).indexOf(N);$!==-1&&B.registry[A].splice($,1)}}},6744:(d,C,B)=>{"use strict";const A=B(3349),N=B(7529),$=B(8050),q=B(4339),W=(P,m={})=>{let E=[];if(Array.isArray(P))for(let R of P){let _=W.create(R,m);Array.isArray(_)?E.push(..._):E.push(_)}else E=[].concat(W.create(P,m));return m&&m.expand===!0&&m.nodupes===!0&&(E=[...new Set(E)]),E};W.parse=(P,m={})=>q(P,m),W.stringify=(P,m={})=>A(typeof P=="string"?W.parse(P,m):P,m),W.compile=(P,m={})=>(typeof P=="string"&&(P=W.parse(P,m)),N(P,m)),W.expand=(P,m={})=>{typeof P=="string"&&(P=W.parse(P,m));let E=$(P,m);return m.noempty===!0&&(E=E.filter(Boolean)),m.nodupes===!0&&(E=[...new Set(E)]),E},W.create=(P,m={})=>P===""||P.length<3?[P]:m.expand!==!0?W.compile(P,m):W.expand(P,m),d.exports=W},7529:(d,C,B)=>{"use strict";const A=B(2664),N=B(3083),$=(q,W={})=>{let P=(m,E={})=>{let R=N.isInvalidBrace(E),_=m.invalid===!0&&W.escapeInvalid===!0,k=R===!0||_===!0,H=W.escapeInvalid===!0?"\\":"",F="";if(m.isOpen===!0||m.isClose===!0)return H+m.value;if(m.type==="open")return k?H+m.value:"(";if(m.type==="close")return k?H+m.value:")";if(m.type==="comma")return m.prev.type==="comma"?"":k?m.value:"|";if(m.value)return m.value;if(m.nodes&&m.ranges>0){let Q=N.reduce(m.nodes),he=A(...Q,{...W,wrap:!1,toRegex:!0});if(he.length!==0)return Q.length>1&&he.length>1?`(${he})`:he}if(m.nodes)for(let Q of m.nodes)F+=P(Q,m);return F};return P(q)};d.exports=$},6611:d=>{"use strict";d.exports={MAX_LENGTH:1024*64,CHAR_0:"0",CHAR_9:"9",CHAR_UPPERCASE_A:"A",CHAR_LOWERCASE_A:"a",CHAR_UPPERCASE_Z:"Z",CHAR_LOWERCASE_Z:"z",CHAR_LEFT_PARENTHESES:"(",CHAR_RIGHT_PARENTHESES:")",CHAR_ASTERISK:"*",CHAR_AMPERSAND:"&",CHAR_AT:"@",CHAR_BACKSLASH:"\\",CHAR_BACKTICK:"`",CHAR_CARRIAGE_RETURN:"\r",CHAR_CIRCUMFLEX_ACCENT:"^",CHAR_COLON:":",CHAR_COMMA:",",CHAR_DOLLAR:"$",CHAR_DOT:".",CHAR_DOUBLE_QUOTE:'"',CHAR_EQUAL:"=",CHAR_EXCLAMATION_MARK:"!",CHAR_FORM_FEED:"\f",CHAR_FORWARD_SLASH:"/",CHAR_HASH:"#",CHAR_HYPHEN_MINUS:"-",CHAR_LEFT_ANGLE_BRACKET:"<",CHAR_LEFT_CURLY_BRACE:"{",CHAR_LEFT_SQUARE_BRACKET:"[",CHAR_LINE_FEED:`
`,CHAR_NO_BREAK_SPACE:"\xA0",CHAR_PERCENT:"%",CHAR_PLUS:"+",CHAR_QUESTION_MARK:"?",CHAR_RIGHT_ANGLE_BRACKET:">",CHAR_RIGHT_CURLY_BRACE:"}",CHAR_RIGHT_SQUARE_BRACKET:"]",CHAR_SEMICOLON:";",CHAR_SINGLE_QUOTE:"'",CHAR_SPACE:" ",CHAR_TAB:"	",CHAR_UNDERSCORE:"_",CHAR_VERTICAL_LINE:"|",CHAR_ZERO_WIDTH_NOBREAK_SPACE:"\uFEFF"}},8050:(d,C,B)=>{"use strict";const A=B(2664),N=B(3349),$=B(3083),q=(P="",m="",E=!1)=>{let R=[];if(P=[].concat(P),m=[].concat(m),!m.length)return P;if(!P.length)return E?$.flatten(m).map(_=>`{${_}}`):m;for(let _ of P)if(Array.isArray(_))for(let k of _)R.push(q(k,m,E));else for(let k of m)E===!0&&typeof k=="string"&&(k=`{${k}}`),R.push(Array.isArray(k)?q(_,k,E):_+k);return $.flatten(R)},W=(P,m={})=>{let E=m.rangeLimit===void 0?1e3:m.rangeLimit,R=(_,k={})=>{_.queue=[];let H=k,F=k.queue;for(;H.type!=="brace"&&H.type!=="root"&&H.parent;)H=H.parent,F=H.queue;if(_.invalid||_.dollar){F.push(q(F.pop(),N(_,m)));return}if(_.type==="brace"&&_.invalid!==!0&&_.nodes.length===2){F.push(q(F.pop(),["{}"]));return}if(_.nodes&&_.ranges>0){let j=$.reduce(_.nodes);if($.exceedsLimit(...j,m.step,E))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let Z=A(...j,m);Z.length===0&&(Z=N(_,m)),F.push(q(F.pop(),Z)),_.nodes=[];return}let Q=$.encloseBrace(_),he=_.queue,be=_;for(;be.type!=="brace"&&be.type!=="root"&&be.parent;)be=be.parent,he=be.queue;for(let j=0;j<_.nodes.length;j++){let Z=_.nodes[j];if(Z.type==="comma"&&_.type==="brace"){j===1&&he.push(""),he.push("");continue}if(Z.type==="close"){F.push(q(F.pop(),he,Q));continue}if(Z.value&&Z.type!=="open"){he.push(q(he.pop(),Z.value));continue}Z.nodes&&R(Z,_)}return he};return $.flatten(R(P))};d.exports=W},4339:(d,C,B)=>{"use strict";const A=B(3349),{MAX_LENGTH:N,CHAR_BACKSLASH:$,CHAR_BACKTICK:q,CHAR_COMMA:W,CHAR_DOT:P,CHAR_LEFT_PARENTHESES:m,CHAR_RIGHT_PARENTHESES:E,CHAR_LEFT_CURLY_BRACE:R,CHAR_RIGHT_CURLY_BRACE:_,CHAR_LEFT_SQUARE_BRACKET:k,CHAR_RIGHT_SQUARE_BRACKET:H,CHAR_DOUBLE_QUOTE:F,CHAR_SINGLE_QUOTE:Q,CHAR_NO_BREAK_SPACE:he,CHAR_ZERO_WIDTH_NOBREAK_SPACE:be}=B(6611),j=(Z,X={})=>{if(typeof Z!="string")throw new TypeError("Expected a string");let L=X||{},z=typeof L.maxLength=="number"?Math.min(N,L.maxLength):N;if(Z.length>z)throw new SyntaxError(`Input length (${Z.length}), exceeds max characters (${z})`);let ee={type:"root",input:Z,nodes:[]},ae=[ee],ie=ee,ce=ee,ge=0,Te=Z.length,Be=0,He=0,ye,Je={};const ot=()=>Z[Be++],We=De=>{if(De.type==="text"&&ce.type==="dot"&&(ce.type="text"),ce&&ce.type==="text"&&De.type==="text"){ce.value+=De.value;return}return ie.nodes.push(De),De.parent=ie,De.prev=ce,ce=De,De};for(We({type:"bos"});Be<Te;)if(ie=ae[ae.length-1],ye=ot(),!(ye===be||ye===he)){if(ye===$){We({type:"text",value:(X.keepEscaping?ye:"")+ot()});continue}if(ye===H){We({type:"text",value:"\\"+ye});continue}if(ye===k){ge++;let De=!0,Ge;for(;Be<Te&&(Ge=ot());){if(ye+=Ge,Ge===k){ge++;continue}if(Ge===$){ye+=ot();continue}if(Ge===H&&(ge--,ge===0))break}We({type:"text",value:ye});continue}if(ye===m){ie=We({type:"paren",nodes:[]}),ae.push(ie),We({type:"text",value:ye});continue}if(ye===E){if(ie.type!=="paren"){We({type:"text",value:ye});continue}ie=ae.pop(),We({type:"text",value:ye}),ie=ae[ae.length-1];continue}if(ye===F||ye===Q||ye===q){let De=ye,Ge;for(X.keepQuotes!==!0&&(ye="");Be<Te&&(Ge=ot());){if(Ge===$){ye+=Ge+ot();continue}if(Ge===De){X.keepQuotes===!0&&(ye+=Ge);break}ye+=Ge}We({type:"text",value:ye});continue}if(ye===R){He++;let De=ce.value&&ce.value.slice(-1)==="$"||ie.dollar===!0;ie=We({type:"brace",open:!0,close:!1,dollar:De,depth:He,commas:0,ranges:0,nodes:[]}),ae.push(ie),We({type:"open",value:ye});continue}if(ye===_){if(ie.type!=="brace"){We({type:"text",value:ye});continue}let De="close";ie=ae.pop(),ie.close=!0,We({type:De,value:ye}),He--,ie=ae[ae.length-1];continue}if(ye===W&&He>0){if(ie.ranges>0){ie.ranges=0;let De=ie.nodes.shift();ie.nodes=[De,{type:"text",value:A(ie)}]}We({type:"comma",value:ye}),ie.commas++;continue}if(ye===P&&He>0&&ie.commas===0){let De=ie.nodes;if(He===0||De.length===0){We({type:"text",value:ye});continue}if(ce.type==="dot"){if(ie.range=[],ce.value+=ye,ce.type="range",ie.nodes.length!==3&&ie.nodes.length!==5){ie.invalid=!0,ie.ranges=0,ce.type="text";continue}ie.ranges++,ie.args=[];continue}if(ce.type==="range"){De.pop();let Ge=De[De.length-1];Ge.value+=ce.value+ye,ce=Ge,ie.ranges--;continue}We({type:"dot",value:ye});continue}We({type:"text",value:ye})}do if(ie=ae.pop(),ie.type!=="root"){ie.nodes.forEach(at=>{at.nodes||(at.type==="open"&&(at.isOpen=!0),at.type==="close"&&(at.isClose=!0),at.nodes||(at.type="text"),at.invalid=!0)});let De=ae[ae.length-1],Ge=De.nodes.indexOf(ie);De.nodes.splice(Ge,1,...ie.nodes)}while(ae.length>0);return We({type:"eos"}),ee};d.exports=j},3349:(d,C,B)=>{"use strict";const A=B(3083);d.exports=(N,$={})=>{let q=(W,P={})=>{let m=$.escapeInvalid&&A.isInvalidBrace(P),E=W.invalid===!0&&$.escapeInvalid===!0,R="";if(W.value)return(m||E)&&A.isOpenOrClose(W)?"\\"+W.value:W.value;if(W.value)return W.value;if(W.nodes)for(let _ of W.nodes)R+=q(_);return R};return q(N)}},3083:(d,C)=>{"use strict";C.isInteger=B=>typeof B=="number"?Number.isInteger(B):typeof B=="string"&&B.trim()!==""?Number.isInteger(Number(B)):!1,C.find=(B,A)=>B.nodes.find(N=>N.type===A),C.exceedsLimit=(B,A,N=1,$)=>$===!1||!C.isInteger(B)||!C.isInteger(A)?!1:(Number(A)-Number(B))/Number(N)>=$,C.escapeNode=(B,A=0,N)=>{let $=B.nodes[A];!$||(N&&$.type===N||$.type==="open"||$.type==="close")&&$.escaped!==!0&&($.value="\\"+$.value,$.escaped=!0)},C.encloseBrace=B=>B.type!=="brace"?!1:B.commas>>0+B.ranges>>0==0?(B.invalid=!0,!0):!1,C.isInvalidBrace=B=>B.type!=="brace"?!1:B.invalid===!0||B.dollar?!0:B.commas>>0+B.ranges>>0==0||B.open!==!0||B.close!==!0?(B.invalid=!0,!0):!1,C.isOpenOrClose=B=>B.type==="open"||B.type==="close"?!0:B.open===!0||B.close===!0,C.reduce=B=>B.reduce((A,N)=>(N.type==="text"&&A.push(N.value),N.type==="range"&&(N.type="text"),A),[]),C.flatten=(...B)=>{const A=[],N=$=>{for(let q=0;q<$.length;q++){let W=$[q];Array.isArray(W)?N(W,A):W!==void 0&&A.push(W)}return A};return N(B),A}},8764:(d,C,B)=>{"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const A=B(9742),N=B(645),$=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;C.Buffer=m,C.SlowBuffer=Z,C.INSPECT_MAX_BYTES=50;const q=2147483647;C.kMaxLength=q,m.TYPED_ARRAY_SUPPORT=W(),!m.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function W(){try{const T=new Uint8Array(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,Uint8Array.prototype),Object.setPrototypeOf(T,g),T.foo()===42}catch(T){return!1}}Object.defineProperty(m.prototype,"parent",{enumerable:!0,get:function(){if(!!m.isBuffer(this))return this.buffer}}),Object.defineProperty(m.prototype,"offset",{enumerable:!0,get:function(){if(!!m.isBuffer(this))return this.byteOffset}});function P(T){if(T>q)throw new RangeError('The value "'+T+'" is invalid for option "size"');const g=new Uint8Array(T);return Object.setPrototypeOf(g,m.prototype),g}function m(T,g,v){if(typeof T=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return k(T)}return E(T,g,v)}m.poolSize=8192;function E(T,g,v){if(typeof T=="string")return H(T,g);if(ArrayBuffer.isView(T))return Q(T);if(T==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof T);if(Ee(T,ArrayBuffer)||T&&Ee(T.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(Ee(T,SharedArrayBuffer)||T&&Ee(T.buffer,SharedArrayBuffer)))return he(T,g,v);if(typeof T=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=T.valueOf&&T.valueOf();if(M!=null&&M!==T)return m.from(M,g,v);const V=be(T);if(V)return V;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof T[Symbol.toPrimitive]=="function")return m.from(T[Symbol.toPrimitive]("string"),g,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof T)}m.from=function(T,g,v){return E(T,g,v)},Object.setPrototypeOf(m.prototype,Uint8Array.prototype),Object.setPrototypeOf(m,Uint8Array);function R(T){if(typeof T!="number")throw new TypeError('"size" argument must be of type number');if(T<0)throw new RangeError('The value "'+T+'" is invalid for option "size"')}function _(T,g,v){return R(T),T<=0?P(T):g!==void 0?typeof v=="string"?P(T).fill(g,v):P(T).fill(g):P(T)}m.alloc=function(T,g,v){return _(T,g,v)};function k(T){return R(T),P(T<0?0:j(T)|0)}m.allocUnsafe=function(T){return k(T)},m.allocUnsafeSlow=function(T){return k(T)};function H(T,g){if((typeof g!="string"||g==="")&&(g="utf8"),!m.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const v=X(T,g)|0;let M=P(v);const V=M.write(T,g);return V!==v&&(M=M.slice(0,V)),M}function F(T){const g=T.length<0?0:j(T.length)|0,v=P(g);for(let M=0;M<g;M+=1)v[M]=T[M]&255;return v}function Q(T){if(Ee(T,Uint8Array)){const g=new Uint8Array(T);return he(g.buffer,g.byteOffset,g.byteLength)}return F(T)}function he(T,g,v){if(g<0||T.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(T.byteLength<g+(v||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&v===void 0?M=new Uint8Array(T):v===void 0?M=new Uint8Array(T,g):M=new Uint8Array(T,g,v),Object.setPrototypeOf(M,m.prototype),M}function be(T){if(m.isBuffer(T)){const g=j(T.length)|0,v=P(g);return v.length===0||T.copy(v,0,0,g),v}if(T.length!==void 0)return typeof T.length!="number"||it(T.length)?P(0):F(T);if(T.type==="Buffer"&&Array.isArray(T.data))return F(T.data)}function j(T){if(T>=q)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+q.toString(16)+" bytes");return T|0}function Z(T){return+T!=T&&(T=0),m.alloc(+T)}m.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==m.prototype},m.compare=function(g,v){if(Ee(g,Uint8Array)&&(g=m.from(g,g.offset,g.byteLength)),Ee(v,Uint8Array)&&(v=m.from(v,v.offset,v.byteLength)),!m.isBuffer(g)||!m.isBuffer(v))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===v)return 0;let M=g.length,V=v.length;for(let oe=0,me=Math.min(M,V);oe<me;++oe)if(g[oe]!==v[oe]){M=g[oe],V=v[oe];break}return M<V?-1:V<M?1:0},m.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},m.concat=function(g,v){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return m.alloc(0);let M;if(v===void 0)for(v=0,M=0;M<g.length;++M)v+=g[M].length;const V=m.allocUnsafe(v);let oe=0;for(M=0;M<g.length;++M){let me=g[M];if(Ee(me,Uint8Array))oe+me.length>V.length?(m.isBuffer(me)||(me=m.from(me)),me.copy(V,oe)):Uint8Array.prototype.set.call(V,me,oe);else if(m.isBuffer(me))me.copy(V,oe);else throw new TypeError('"list" argument must be an Array of Buffers');oe+=me.length}return V};function X(T,g){if(m.isBuffer(T))return T.length;if(ArrayBuffer.isView(T)||Ee(T,ArrayBuffer))return T.byteLength;if(typeof T!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof T);const v=T.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&v===0)return 0;let V=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return Xe(T).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v*2;case"hex":return v>>>1;case"base64":return Me(T).length;default:if(V)return M?-1:Xe(T).length;g=(""+g).toLowerCase(),V=!0}}m.byteLength=X;function L(T,g,v){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((v===void 0||v>this.length)&&(v=this.length),v<=0)||(v>>>=0,g>>>=0,v<=g))return"";for(T||(T="utf8");;)switch(T){case"hex":return Ge(this,g,v);case"utf8":case"utf-8":return ye(this,g,v);case"ascii":return We(this,g,v);case"latin1":case"binary":return De(this,g,v);case"base64":return He(this,g,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return at(this,g,v);default:if(M)throw new TypeError("Unknown encoding: "+T);T=(T+"").toLowerCase(),M=!0}}m.prototype._isBuffer=!0;function z(T,g,v){const M=T[g];T[g]=T[v],T[v]=M}m.prototype.swap16=function(){const g=this.length;if(g%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let v=0;v<g;v+=2)z(this,v,v+1);return this},m.prototype.swap32=function(){const g=this.length;if(g%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let v=0;v<g;v+=4)z(this,v,v+3),z(this,v+1,v+2);return this},m.prototype.swap64=function(){const g=this.length;if(g%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let v=0;v<g;v+=8)z(this,v,v+7),z(this,v+1,v+6),z(this,v+2,v+5),z(this,v+3,v+4);return this},m.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?ye(this,0,g):L.apply(this,arguments)},m.prototype.toLocaleString=m.prototype.toString,m.prototype.equals=function(g){if(!m.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:m.compare(this,g)===0},m.prototype.inspect=function(){let g="";const v=C.INSPECT_MAX_BYTES;return g=this.toString("hex",0,v).replace(/(.{2})/g,"$1 ").trim(),this.length>v&&(g+=" ... "),"<Buffer "+g+">"},$&&(m.prototype[$]=m.prototype.inspect),m.prototype.compare=function(g,v,M,V,oe){if(Ee(g,Uint8Array)&&(g=m.from(g,g.offset,g.byteLength)),!m.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(v===void 0&&(v=0),M===void 0&&(M=g?g.length:0),V===void 0&&(V=0),oe===void 0&&(oe=this.length),v<0||M>g.length||V<0||oe>this.length)throw new RangeError("out of range index");if(V>=oe&&v>=M)return 0;if(V>=oe)return-1;if(v>=M)return 1;if(v>>>=0,M>>>=0,V>>>=0,oe>>>=0,this===g)return 0;let me=oe-V,ft=M-v;const Dt=Math.min(me,ft),qt=this.slice(V,oe),Xt=g.slice(v,M);for(let Ft=0;Ft<Dt;++Ft)if(qt[Ft]!==Xt[Ft]){me=qt[Ft],ft=Xt[Ft];break}return me<ft?-1:ft<me?1:0};function ee(T,g,v,M,V){if(T.length===0)return-1;if(typeof v=="string"?(M=v,v=0):v>2147483647?v=2147483647:v<-2147483648&&(v=-2147483648),v=+v,it(v)&&(v=V?0:T.length-1),v<0&&(v=T.length+v),v>=T.length){if(V)return-1;v=T.length-1}else if(v<0)if(V)v=0;else return-1;if(typeof g=="string"&&(g=m.from(g,M)),m.isBuffer(g))return g.length===0?-1:ae(T,g,v,M,V);if(typeof g=="number")return g=g&255,typeof Uint8Array.prototype.indexOf=="function"?V?Uint8Array.prototype.indexOf.call(T,g,v):Uint8Array.prototype.lastIndexOf.call(T,g,v):ae(T,[g],v,M,V);throw new TypeError("val must be string, number or Buffer")}function ae(T,g,v,M,V){let oe=1,me=T.length,ft=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(T.length<2||g.length<2)return-1;oe=2,me/=2,ft/=2,v/=2}function Dt(Xt,Ft){return oe===1?Xt[Ft]:Xt.readUInt16BE(Ft*oe)}let qt;if(V){let Xt=-1;for(qt=v;qt<me;qt++)if(Dt(T,qt)===Dt(g,Xt===-1?0:qt-Xt)){if(Xt===-1&&(Xt=qt),qt-Xt+1===ft)return Xt*oe}else Xt!==-1&&(qt-=qt-Xt),Xt=-1}else for(v+ft>me&&(v=me-ft),qt=v;qt>=0;qt--){let Xt=!0;for(let Ft=0;Ft<ft;Ft++)if(Dt(T,qt+Ft)!==Dt(g,Ft)){Xt=!1;break}if(Xt)return qt}return-1}m.prototype.includes=function(g,v,M){return this.indexOf(g,v,M)!==-1},m.prototype.indexOf=function(g,v,M){return ee(this,g,v,M,!0)},m.prototype.lastIndexOf=function(g,v,M){return ee(this,g,v,M,!1)};function ie(T,g,v,M){v=Number(v)||0;const V=T.length-v;M?(M=Number(M),M>V&&(M=V)):M=V;const oe=g.length;M>oe/2&&(M=oe/2);let me;for(me=0;me<M;++me){const ft=parseInt(g.substr(me*2,2),16);if(it(ft))return me;T[v+me]=ft}return me}function ce(T,g,v,M){return mt(Xe(g,T.length-v),T,v,M)}function ge(T,g,v,M){return mt(Ot(g),T,v,M)}function Te(T,g,v,M){return mt(Me(g),T,v,M)}function Be(T,g,v,M){return mt(ji(g,T.length-v),T,v,M)}m.prototype.write=function(g,v,M,V){if(v===void 0)V="utf8",M=this.length,v=0;else if(M===void 0&&typeof v=="string")V=v,M=this.length,v=0;else if(isFinite(v))v=v>>>0,isFinite(M)?(M=M>>>0,V===void 0&&(V="utf8")):(V=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const oe=this.length-v;if((M===void 0||M>oe)&&(M=oe),g.length>0&&(M<0||v<0)||v>this.length)throw new RangeError("Attempt to write outside buffer bounds");V||(V="utf8");let me=!1;for(;;)switch(V){case"hex":return ie(this,g,v,M);case"utf8":case"utf-8":return ce(this,g,v,M);case"ascii":case"latin1":case"binary":return ge(this,g,v,M);case"base64":return Te(this,g,v,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Be(this,g,v,M);default:if(me)throw new TypeError("Unknown encoding: "+V);V=(""+V).toLowerCase(),me=!0}},m.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function He(T,g,v){return g===0&&v===T.length?A.fromByteArray(T):A.fromByteArray(T.slice(g,v))}function ye(T,g,v){v=Math.min(T.length,v);const M=[];let V=g;for(;V<v;){const oe=T[V];let me=null,ft=oe>239?4:oe>223?3:oe>191?2:1;if(V+ft<=v){let Dt,qt,Xt,Ft;switch(ft){case 1:oe<128&&(me=oe);break;case 2:Dt=T[V+1],(Dt&192)==128&&(Ft=(oe&31)<<6|Dt&63,Ft>127&&(me=Ft));break;case 3:Dt=T[V+1],qt=T[V+2],(Dt&192)==128&&(qt&192)==128&&(Ft=(oe&15)<<12|(Dt&63)<<6|qt&63,Ft>2047&&(Ft<55296||Ft>57343)&&(me=Ft));break;case 4:Dt=T[V+1],qt=T[V+2],Xt=T[V+3],(Dt&192)==128&&(qt&192)==128&&(Xt&192)==128&&(Ft=(oe&15)<<18|(Dt&63)<<12|(qt&63)<<6|Xt&63,Ft>65535&&Ft<1114112&&(me=Ft))}}me===null?(me=65533,ft=1):me>65535&&(me-=65536,M.push(me>>>10&1023|55296),me=56320|me&1023),M.push(me),V+=ft}return ot(M)}const Je=4096;function ot(T){const g=T.length;if(g<=Je)return String.fromCharCode.apply(String,T);let v="",M=0;for(;M<g;)v+=String.fromCharCode.apply(String,T.slice(M,M+=Je));return v}function We(T,g,v){let M="";v=Math.min(T.length,v);for(let V=g;V<v;++V)M+=String.fromCharCode(T[V]&127);return M}function De(T,g,v){let M="";v=Math.min(T.length,v);for(let V=g;V<v;++V)M+=String.fromCharCode(T[V]);return M}function Ge(T,g,v){const M=T.length;(!g||g<0)&&(g=0),(!v||v<0||v>M)&&(v=M);let V="";for(let oe=g;oe<v;++oe)V+=jt[T[oe]];return V}function at(T,g,v){const M=T.slice(g,v);let V="";for(let oe=0;oe<M.length-1;oe+=2)V+=String.fromCharCode(M[oe]+M[oe+1]*256);return V}m.prototype.slice=function(g,v){const M=this.length;g=~~g,v=v===void 0?M:~~v,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),v<0?(v+=M,v<0&&(v=0)):v>M&&(v=M),v<g&&(v=g);const V=this.subarray(g,v);return Object.setPrototypeOf(V,m.prototype),V};function je(T,g,v){if(T%1!=0||T<0)throw new RangeError("offset is not uint");if(T+g>v)throw new RangeError("Trying to access beyond buffer length")}m.prototype.readUintLE=m.prototype.readUIntLE=function(g,v,M){g=g>>>0,v=v>>>0,M||je(g,v,this.length);let V=this[g],oe=1,me=0;for(;++me<v&&(oe*=256);)V+=this[g+me]*oe;return V},m.prototype.readUintBE=m.prototype.readUIntBE=function(g,v,M){g=g>>>0,v=v>>>0,M||je(g,v,this.length);let V=this[g+--v],oe=1;for(;v>0&&(oe*=256);)V+=this[g+--v]*oe;return V},m.prototype.readUint8=m.prototype.readUInt8=function(g,v){return g=g>>>0,v||je(g,1,this.length),this[g]},m.prototype.readUint16LE=m.prototype.readUInt16LE=function(g,v){return g=g>>>0,v||je(g,2,this.length),this[g]|this[g+1]<<8},m.prototype.readUint16BE=m.prototype.readUInt16BE=function(g,v){return g=g>>>0,v||je(g,2,this.length),this[g]<<8|this[g+1]},m.prototype.readUint32LE=m.prototype.readUInt32LE=function(g,v){return g=g>>>0,v||je(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},m.prototype.readUint32BE=m.prototype.readUInt32BE=function(g,v){return g=g>>>0,v||je(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},m.prototype.readBigUInt64LE=Ht(function(g){g=g>>>0,It(g,"offset");const v=this[g],M=this[g+7];(v===void 0||M===void 0)&&zr(g,this.length-8);const V=v+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,oe=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(V)+(BigInt(oe)<<BigInt(32))}),m.prototype.readBigUInt64BE=Ht(function(g){g=g>>>0,It(g,"offset");const v=this[g],M=this[g+7];(v===void 0||M===void 0)&&zr(g,this.length-8);const V=v*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],oe=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(V)<<BigInt(32))+BigInt(oe)}),m.prototype.readIntLE=function(g,v,M){g=g>>>0,v=v>>>0,M||je(g,v,this.length);let V=this[g],oe=1,me=0;for(;++me<v&&(oe*=256);)V+=this[g+me]*oe;return oe*=128,V>=oe&&(V-=Math.pow(2,8*v)),V},m.prototype.readIntBE=function(g,v,M){g=g>>>0,v=v>>>0,M||je(g,v,this.length);let V=v,oe=1,me=this[g+--V];for(;V>0&&(oe*=256);)me+=this[g+--V]*oe;return oe*=128,me>=oe&&(me-=Math.pow(2,8*v)),me},m.prototype.readInt8=function(g,v){return g=g>>>0,v||je(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},m.prototype.readInt16LE=function(g,v){g=g>>>0,v||je(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},m.prototype.readInt16BE=function(g,v){g=g>>>0,v||je(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},m.prototype.readInt32LE=function(g,v){return g=g>>>0,v||je(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},m.prototype.readInt32BE=function(g,v){return g=g>>>0,v||je(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},m.prototype.readBigInt64LE=Ht(function(g){g=g>>>0,It(g,"offset");const v=this[g],M=this[g+7];(v===void 0||M===void 0)&&zr(g,this.length-8);const V=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(V)<<BigInt(32))+BigInt(v+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),m.prototype.readBigInt64BE=Ht(function(g){g=g>>>0,It(g,"offset");const v=this[g],M=this[g+7];(v===void 0||M===void 0)&&zr(g,this.length-8);const V=(v<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(V)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),m.prototype.readFloatLE=function(g,v){return g=g>>>0,v||je(g,4,this.length),N.read(this,g,!0,23,4)},m.prototype.readFloatBE=function(g,v){return g=g>>>0,v||je(g,4,this.length),N.read(this,g,!1,23,4)},m.prototype.readDoubleLE=function(g,v){return g=g>>>0,v||je(g,8,this.length),N.read(this,g,!0,52,8)},m.prototype.readDoubleBE=function(g,v){return g=g>>>0,v||je(g,8,this.length),N.read(this,g,!1,52,8)};function Y(T,g,v,M,V,oe){if(!m.isBuffer(T))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>V||g<oe)throw new RangeError('"value" argument is out of bounds');if(v+M>T.length)throw new RangeError("Index out of range")}m.prototype.writeUintLE=m.prototype.writeUIntLE=function(g,v,M,V){if(g=+g,v=v>>>0,M=M>>>0,!V){const ft=Math.pow(2,8*M)-1;Y(this,g,v,M,ft,0)}let oe=1,me=0;for(this[v]=g&255;++me<M&&(oe*=256);)this[v+me]=g/oe&255;return v+M},m.prototype.writeUintBE=m.prototype.writeUIntBE=function(g,v,M,V){if(g=+g,v=v>>>0,M=M>>>0,!V){const ft=Math.pow(2,8*M)-1;Y(this,g,v,M,ft,0)}let oe=M-1,me=1;for(this[v+oe]=g&255;--oe>=0&&(me*=256);)this[v+oe]=g/me&255;return v+M},m.prototype.writeUint8=m.prototype.writeUInt8=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,1,255,0),this[v]=g&255,v+1},m.prototype.writeUint16LE=m.prototype.writeUInt16LE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,2,65535,0),this[v]=g&255,this[v+1]=g>>>8,v+2},m.prototype.writeUint16BE=m.prototype.writeUInt16BE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,2,65535,0),this[v]=g>>>8,this[v+1]=g&255,v+2},m.prototype.writeUint32LE=m.prototype.writeUInt32LE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,4,4294967295,0),this[v+3]=g>>>24,this[v+2]=g>>>16,this[v+1]=g>>>8,this[v]=g&255,v+4},m.prototype.writeUint32BE=m.prototype.writeUInt32BE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,4,4294967295,0),this[v]=g>>>24,this[v+1]=g>>>16,this[v+2]=g>>>8,this[v+3]=g&255,v+4};function ht(T,g,v,M,V){kt(g,M,V,T,v,7);let oe=Number(g&BigInt(4294967295));T[v++]=oe,oe=oe>>8,T[v++]=oe,oe=oe>>8,T[v++]=oe,oe=oe>>8,T[v++]=oe;let me=Number(g>>BigInt(32)&BigInt(4294967295));return T[v++]=me,me=me>>8,T[v++]=me,me=me>>8,T[v++]=me,me=me>>8,T[v++]=me,v}function st(T,g,v,M,V){kt(g,M,V,T,v,7);let oe=Number(g&BigInt(4294967295));T[v+7]=oe,oe=oe>>8,T[v+6]=oe,oe=oe>>8,T[v+5]=oe,oe=oe>>8,T[v+4]=oe;let me=Number(g>>BigInt(32)&BigInt(4294967295));return T[v+3]=me,me=me>>8,T[v+2]=me,me=me>>8,T[v+1]=me,me=me>>8,T[v]=me,v+8}m.prototype.writeBigUInt64LE=Ht(function(g,v=0){return ht(this,g,v,BigInt(0),BigInt("0xffffffffffffffff"))}),m.prototype.writeBigUInt64BE=Ht(function(g,v=0){return st(this,g,v,BigInt(0),BigInt("0xffffffffffffffff"))}),m.prototype.writeIntLE=function(g,v,M,V){if(g=+g,v=v>>>0,!V){const Dt=Math.pow(2,8*M-1);Y(this,g,v,M,Dt-1,-Dt)}let oe=0,me=1,ft=0;for(this[v]=g&255;++oe<M&&(me*=256);)g<0&&ft===0&&this[v+oe-1]!==0&&(ft=1),this[v+oe]=(g/me>>0)-ft&255;return v+M},m.prototype.writeIntBE=function(g,v,M,V){if(g=+g,v=v>>>0,!V){const Dt=Math.pow(2,8*M-1);Y(this,g,v,M,Dt-1,-Dt)}let oe=M-1,me=1,ft=0;for(this[v+oe]=g&255;--oe>=0&&(me*=256);)g<0&&ft===0&&this[v+oe+1]!==0&&(ft=1),this[v+oe]=(g/me>>0)-ft&255;return v+M},m.prototype.writeInt8=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,1,127,-128),g<0&&(g=255+g+1),this[v]=g&255,v+1},m.prototype.writeInt16LE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,2,32767,-32768),this[v]=g&255,this[v+1]=g>>>8,v+2},m.prototype.writeInt16BE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,2,32767,-32768),this[v]=g>>>8,this[v+1]=g&255,v+2},m.prototype.writeInt32LE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,4,2147483647,-2147483648),this[v]=g&255,this[v+1]=g>>>8,this[v+2]=g>>>16,this[v+3]=g>>>24,v+4},m.prototype.writeInt32BE=function(g,v,M){return g=+g,v=v>>>0,M||Y(this,g,v,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[v]=g>>>24,this[v+1]=g>>>16,this[v+2]=g>>>8,this[v+3]=g&255,v+4},m.prototype.writeBigInt64LE=Ht(function(g,v=0){return ht(this,g,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),m.prototype.writeBigInt64BE=Ht(function(g,v=0){return st(this,g,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ct(T,g,v,M,V,oe){if(v+M>T.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("Index out of range")}function fe(T,g,v,M,V){return g=+g,v=v>>>0,V||ct(T,g,v,4,34028234663852886e22,-34028234663852886e22),N.write(T,g,v,M,23,4),v+4}m.prototype.writeFloatLE=function(g,v,M){return fe(this,g,v,!0,M)},m.prototype.writeFloatBE=function(g,v,M){return fe(this,g,v,!1,M)};function pe(T,g,v,M,V){return g=+g,v=v>>>0,V||ct(T,g,v,8,17976931348623157e292,-17976931348623157e292),N.write(T,g,v,M,52,8),v+8}m.prototype.writeDoubleLE=function(g,v,M){return pe(this,g,v,!0,M)},m.prototype.writeDoubleBE=function(g,v,M){return pe(this,g,v,!1,M)},m.prototype.copy=function(g,v,M,V){if(!m.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!V&&V!==0&&(V=this.length),v>=g.length&&(v=g.length),v||(v=0),V>0&&V<M&&(V=M),V===M||g.length===0||this.length===0)return 0;if(v<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(V<0)throw new RangeError("sourceEnd out of bounds");V>this.length&&(V=this.length),g.length-v<V-M&&(V=g.length-v+M);const oe=V-M;return this===g&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(v,M,V):Uint8Array.prototype.set.call(g,this.subarray(M,V),v),oe},m.prototype.fill=function(g,v,M,V){if(typeof g=="string"){if(typeof v=="string"?(V=v,v=0,M=this.length):typeof M=="string"&&(V=M,M=this.length),V!==void 0&&typeof V!="string")throw new TypeError("encoding must be a string");if(typeof V=="string"&&!m.isEncoding(V))throw new TypeError("Unknown encoding: "+V);if(g.length===1){const me=g.charCodeAt(0);(V==="utf8"&&me<128||V==="latin1")&&(g=me)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(v<0||this.length<v||this.length<M)throw new RangeError("Out of range index");if(M<=v)return this;v=v>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let oe;if(typeof g=="number")for(oe=v;oe<M;++oe)this[oe]=g;else{const me=m.isBuffer(g)?g:m.from(g,V),ft=me.length;if(ft===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(oe=0;oe<M-v;++oe)this[oe+v]=me[oe%ft]}return this};const qe={};function Qe(T,g,v){qe[T]=class extends v{constructor(){super();Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${T}]`,this.stack,delete this.name}get code(){return T}set code(V){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:V,writable:!0})}toString(){return`${this.name} [${T}]: ${this.message}`}}}Qe("ERR_BUFFER_OUT_OF_BOUNDS",function(T){return T?`${T} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Qe("ERR_INVALID_ARG_TYPE",function(T,g){return`The "${T}" argument must be of type number. Received type ${typeof g}`},TypeError),Qe("ERR_OUT_OF_RANGE",function(T,g,v){let M=`The value of "${T}" is out of range.`,V=v;return Number.isInteger(v)&&Math.abs(v)>2**32?V=_t(String(v)):typeof v=="bigint"&&(V=String(v),(v>BigInt(2)**BigInt(32)||v<-(BigInt(2)**BigInt(32)))&&(V=_t(V)),V+="n"),M+=` It must be ${g}. Received ${V}`,M},RangeError);function _t(T){let g="",v=T.length;const M=T[0]==="-"?1:0;for(;v>=M+4;v-=3)g=`_${T.slice(v-3,v)}${g}`;return`${T.slice(0,v)}${g}`}function vr(T,g,v){It(g,"offset"),(T[g]===void 0||T[g+v]===void 0)&&zr(g,T.length-(v+1))}function kt(T,g,v,M,V,oe){if(T>v||T<g){const me=typeof g=="bigint"?"n":"";let ft;throw oe>3?g===0||g===BigInt(0)?ft=`>= 0${me} and < 2${me} ** ${(oe+1)*8}${me}`:ft=`>= -(2${me} ** ${(oe+1)*8-1}${me}) and < 2 ** ${(oe+1)*8-1}${me}`:ft=`>= ${g}${me} and <= ${v}${me}`,new qe.ERR_OUT_OF_RANGE("value",ft,T)}vr(M,V,oe)}function It(T,g){if(typeof T!="number")throw new qe.ERR_INVALID_ARG_TYPE(g,"number",T)}function zr(T,g,v){throw Math.floor(T)!==T?(It(T,v),new qe.ERR_OUT_OF_RANGE(v||"offset","an integer",T)):g<0?new qe.ERR_BUFFER_OUT_OF_BOUNDS:new qe.ERR_OUT_OF_RANGE(v||"offset",`>= ${v?1:0} and <= ${g}`,T)}const Fr=/[^+/0-9A-Za-z-_]/g;function tr(T){if(T=T.split("=")[0],T=T.trim().replace(Fr,""),T.length<2)return"";for(;T.length%4!=0;)T=T+"=";return T}function Xe(T,g){g=g||1/0;let v;const M=T.length;let V=null;const oe=[];for(let me=0;me<M;++me){if(v=T.charCodeAt(me),v>55295&&v<57344){if(!V){if(v>56319){(g-=3)>-1&&oe.push(239,191,189);continue}else if(me+1===M){(g-=3)>-1&&oe.push(239,191,189);continue}V=v;continue}if(v<56320){(g-=3)>-1&&oe.push(239,191,189),V=v;continue}v=(V-55296<<10|v-56320)+65536}else V&&(g-=3)>-1&&oe.push(239,191,189);if(V=null,v<128){if((g-=1)<0)break;oe.push(v)}else if(v<2048){if((g-=2)<0)break;oe.push(v>>6|192,v&63|128)}else if(v<65536){if((g-=3)<0)break;oe.push(v>>12|224,v>>6&63|128,v&63|128)}else if(v<1114112){if((g-=4)<0)break;oe.push(v>>18|240,v>>12&63|128,v>>6&63|128,v&63|128)}else throw new Error("Invalid code point")}return oe}function Ot(T){const g=[];for(let v=0;v<T.length;++v)g.push(T.charCodeAt(v)&255);return g}function ji(T,g){let v,M,V;const oe=[];for(let me=0;me<T.length&&!((g-=2)<0);++me)v=T.charCodeAt(me),M=v>>8,V=v%256,oe.push(V),oe.push(M);return oe}function Me(T){return A.toByteArray(tr(T))}function mt(T,g,v,M){let V;for(V=0;V<M&&!(V+v>=g.length||V>=T.length);++V)g[V+v]=T[V];return V}function Ee(T,g){return T instanceof g||T!=null&&T.constructor!=null&&T.constructor.name!=null&&T.constructor.name===g.name}function it(T){return T!==T}const jt=function(){const T="0123456789abcdef",g=new Array(256);for(let v=0;v<16;++v){const M=v*16;for(let V=0;V<16;++V)g[M+V]=T[v]+T[V]}return g}();function Ht(T){return typeof BigInt=="undefined"?Zt:T}function Zt(){throw new Error("BigInt not supported")}},1:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var Buffer=__webpack_require__(8764).Buffer;const Token=__webpack_require__(3416),strtok3=__webpack_require__(5849),{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=__webpack_require__(6188),supported=__webpack_require__(9898),minimumBytes=4100;async function fromStream(d){const C=await strtok3.fromStream(d);try{return await fromTokenizer(C)}finally{await C.close()}}async function fromBuffer(d){if(!(d instanceof Uint8Array||d instanceof ArrayBuffer||Buffer.isBuffer(d)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof d}\``);const C=d instanceof Buffer?d:Buffer.from(d);if(!(C&&C.length>1))return;const B=strtok3.fromBuffer(C);return fromTokenizer(B)}function _check(d,C,B){B={offset:0,...B};for(const[A,N]of C.entries())if(B.mask){if(N!==(B.mask[A]&d[A+B.offset]))return!1}else if(N!==d[A+B.offset])return!1;return!0}async function fromTokenizer(d){try{return _fromTokenizer(d)}catch(C){if(!(C instanceof strtok3.EndOfStreamError))throw C}}async function _fromTokenizer(d){let C=Buffer.alloc(minimumBytes);const B=12,A=($,q)=>_check(C,$,q),N=($,q)=>A(stringToBytes($),q);if(d.fileInfo.size||(d.fileInfo.size=Number.MAX_SAFE_INTEGER),await d.peekBuffer(C,{length:B,mayBeLess:!0}),A([66,77]))return{ext:"bmp",mime:"image/bmp"};if(A([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(A([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(A([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(A([37,33]))return await d.peekBuffer(C,{length:24,mayBeLess:!0}),N("PS-Adobe-",{offset:2})&&N(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(A([31,160])||A([31,157]))return{ext:"Z",mime:"application/x-compress"};if(A([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(A([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(A([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(A([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(N("ID3")){await d.ignore(6);const $=await d.readToken(uint32SyncSafeToken);return d.position+$>d.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await d.ignore($),fromTokenizer(d))}if(N("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((C[0]===67||C[0]===70)&&A([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(A([71,73,70]))return{ext:"gif",mime:"image/gif"};if(N("FLIF"))return{ext:"flif",mime:"image/flif"};if(N("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(N("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(N("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(N("FORM"))return{ext:"aif",mime:"audio/aiff"};if(N("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(A([80,75,3,4])){try{for(;d.position+30<d.fileInfo.size;){await d.readBuffer(C,{length:30});const $={compressedSize:C.readUInt32LE(18),uncompressedSize:C.readUInt32LE(22),filenameLength:C.readUInt16LE(26),extraFieldLength:C.readUInt16LE(28)};if($.filename=await d.readToken(new Token.StringType($.filenameLength,"utf-8")),await d.ignore($.extraFieldLength),$.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if($.filename.endsWith(".rels")||$.filename.endsWith(".xml"))switch($.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if($.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if($.filename.startsWith("3D/")&&$.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if($.filename==="mimetype"&&$.compressedSize===$.uncompressedSize)switch(await d.readToken(new Token.StringType($.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}if($.compressedSize===0){let q=-1;for(;q<0&&d.position<d.fileInfo.size;)await d.peekBuffer(C,{mayBeLess:!0}),q=C.indexOf("504B0304",0,"hex"),await d.ignore(q>=0?q:C.length)}else await d.ignore($.compressedSize)}}catch($){if(!($ instanceof strtok3.EndOfStreamError))throw $}return{ext:"zip",mime:"application/zip"}}if(N("OggS")){await d.ignore(28);const $=Buffer.alloc(8);return await d.readBuffer($),_check($,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check($,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check($,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check($,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check($,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check($,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(A([80,75])&&(C[2]===3||C[2]===5||C[2]===7)&&(C[3]===4||C[3]===6||C[3]===8))return{ext:"zip",mime:"application/zip"};if(N("ftyp",{offset:4})&&(C[8]&96)!=0){const $=C.toString("binary",8,12).replace("\0"," ").trim();switch($){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return $.startsWith("3g")?$.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(N("MThd"))return{ext:"mid",mime:"audio/midi"};if(N("wOFF")&&(A([0,1,0,0],{offset:4})||N("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(N("wOF2")&&(A([0,1,0,0],{offset:4})||N("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(A([212,195,178,161])||A([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(N("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(N("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(N("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(A([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(N("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(N("%PDF")){await d.ignore(1350);const $=10*1024*1024,q=Buffer.alloc(Math.min($,d.fileInfo.size));return await d.readBuffer(q,{mayBeLess:!0}),q.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(A([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(A([73,73,42,0]))return N("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:A([28,0,254,0],{offset:8})||A([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:A([8,0,0,0],{offset:4})&&(A([45,0,254,0],{offset:8})||A([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(C=Buffer.alloc(24),await d.peekBuffer(C),(A([16,251,134,1],{offset:4})||A([8,0,0,0],{offset:4}))&&A([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(A([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(N("MAC "))return{ext:"ape",mime:"audio/ape"};if(A([26,69,223,163])){async function $(){const E=await d.peekNumber(Token.UINT8);let R=128,_=0;for(;(E&R)==0;)++_,R>>=1;const k=Buffer.alloc(_+1);return await d.readBuffer(k),k}async function q(){const E=await $(),R=await $();R[0]^=128>>R.length-1;const _=Math.min(6,R.length);return{id:E.readUIntBE(0,E.length),len:R.readUIntBE(R.length-_,_)}}async function W(E,R){for(;R>0;){const _=await q();if(_.id===17026)return d.readToken(new Token.StringType(_.len,"utf-8"));await d.ignore(_.len),--R}}const P=await q();switch(await W(1,P.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(A([82,73,70,70])){if(A([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(A([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(A([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(N("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(A([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(N("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(N("MSCF")||N("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(A([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(A([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(A([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(A([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(N("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(N("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(A([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(N("IMPM"))return{ext:"it",mime:"audio/x-it"};if(N("-lh0-",{offset:2})||N("-lh1-",{offset:2})||N("-lh2-",{offset:2})||N("-lh3-",{offset:2})||N("-lh4-",{offset:2})||N("-lh5-",{offset:2})||N("-lh6-",{offset:2})||N("-lh7-",{offset:2})||N("-lzs-",{offset:2})||N("-lz4-",{offset:2})||N("-lz5-",{offset:2})||N("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(A([0,0,1,186])){if(A([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(A([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(N("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(A([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(N("<?xml "))return{ext:"xml",mime:"application/xml"};if(A([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(A([82,97,114,33,26,7])&&(C[6]===0||C[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(N("solid "))return{ext:"stl",mime:"model/stl"};if(N("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(N("!<arch>"))return await d.ignore(8),await d.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(A([137,80,78,71,13,10,26,10])){await d.ignore(8);async function $(){return{length:await d.readToken(Token.INT32_BE),type:await d.readToken(new Token.StringType(4,"binary"))}}do{const q=await $();if(q.length<0)return;switch(q.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await d.ignore(q.length+4)}}while(d.position+8<d.fileInfo.size);return{ext:"png",mime:"image/png"}}if(A([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(A([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(A([102,114,101,101],{offset:4})||A([109,100,97,116],{offset:4})||A([109,111,111,118],{offset:4})||A([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(A([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(N("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(A([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(A([48,38,178,117,142,102,207,17,166,217])){async function $(){const q=Buffer.alloc(16);return await d.readBuffer(q),{id:q,size:Number(await d.readToken(Token.UINT64_LE))}}for(await d.ignore(30);d.position+24<d.fileInfo.size;){const q=await $();let W=q.size-24;if(_check(q.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const P=Buffer.alloc(16);if(W-=await d.readBuffer(P),_check(P,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(P,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await d.ignore(W)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(A([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((A([126,16,4])||A([126,24,4]))&&A([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(A([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(A([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await d.ignore(20),await d.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(A([255,10])||A([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(A([0,0,1,186])||A([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(A([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(A([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(A([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(A([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await d.peekBuffer(C,{length:Math.min(256,d.fileInfo.size),mayBeLess:!0}),N("BEGIN:")){if(N("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(N("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(N("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(N("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(N("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(A([4,0,0,0])&&C.length>=16){const $=C.readUInt32LE(12);if($>12&&C.length>=$+16)try{const q=C.slice(16,$+16).toString();if(JSON.parse(q).files)return{ext:"asar",mime:"application/x-asar"}}catch(q){}}if(A([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(N("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(A([71],{offset:4})&&(A([71],{offset:192})||A([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(A([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(A([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(A([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(A([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(A([76,80],{offset:34})&&(A([0,0,1],{offset:8})||A([1,0,2],{offset:8})||A([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(A([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await d.peekBuffer(C,{length:Math.min(512,d.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(C))return{ext:"tar",mime:"application/x-tar"};if(A([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(N("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(C.length>=2&&A([255,224],{offset:0,mask:[255,224]})){if(A([16],{offset:1,mask:[22]}))return A([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(A([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(A([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(A([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const d=new stream.PassThrough;let C;stream.pipeline?C=stream.pipeline(readableStream,d,()=>{}):C=readableStream.pipe(d);const B=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const A=await fromBuffer(B);d.fileType=A}catch(A){reject(A)}resolve(C)})}),fileType={fromStream,fromTokenizer,fromBuffer,stream};Object.defineProperty(fileType,"extensions",{get(){return new Set(supported.extensions)}}),Object.defineProperty(fileType,"mimeTypes",{get(){return new Set(supported.mimeTypes)}}),module.exports=fileType},7769:(d,C,B)=>{"use strict";const A=B(6597),N=B(1);async function $(W){const P=await A.fromFile(W);try{return await N.fromTokenizer(P)}finally{await P.close()}}const q={fromFile:$};Object.assign(q,N),Object.defineProperty(q,"extensions",{get(){return N.extensions}}),Object.defineProperty(q,"mimeTypes",{get(){return N.mimeTypes}}),d.exports=q},9898:d=>{"use strict";d.exports={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]}},6188:(d,C)=>{"use strict";C.stringToBytes=B=>[...B].map(A=>A.charCodeAt(0)),C.tarHeaderChecksumMatches=(B,A=0)=>{const N=parseInt(B.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(N))return!1;let $=8*32;for(let q=A;q<A+148;q++)$+=B[q];for(let q=A+156;q<A+512;q++)$+=B[q];return N===$},C.uint32SyncSafeToken={get:(B,A)=>B[A+3]&127|B[A+2]<<7|B[A+1]<<14|B[A]<<21,len:4}},2664:(d,C,B)=>{"use strict";/*!
 * fill-range <https://github.com/jonschlinkert/fill-range>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Licensed under the MIT License.
 */const A=B(1932),N=B(5702),$=L=>L!==null&&typeof L=="object"&&!Array.isArray(L),q=L=>z=>L===!0?Number(z):String(z),W=L=>typeof L=="number"||typeof L=="string"&&L!=="",P=L=>Number.isInteger(+L),m=L=>{let z=`${L}`,ee=-1;if(z[0]==="-"&&(z=z.slice(1)),z==="0")return!1;for(;z[++ee]==="0";);return ee>0},E=(L,z,ee)=>typeof L=="string"||typeof z=="string"?!0:ee.stringify===!0,R=(L,z,ee)=>{if(z>0){let ae=L[0]==="-"?"-":"";ae&&(L=L.slice(1)),L=ae+L.padStart(ae?z-1:z,"0")}return ee===!1?String(L):L},_=(L,z)=>{let ee=L[0]==="-"?"-":"";for(ee&&(L=L.slice(1),z--);L.length<z;)L="0"+L;return ee?"-"+L:L},k=(L,z)=>{L.negatives.sort((ge,Te)=>ge<Te?-1:ge>Te?1:0),L.positives.sort((ge,Te)=>ge<Te?-1:ge>Te?1:0);let ee=z.capture?"":"?:",ae="",ie="",ce;return L.positives.length&&(ae=L.positives.join("|")),L.negatives.length&&(ie=`-(${ee}${L.negatives.join("|")})`),ae&&ie?ce=`${ae}|${ie}`:ce=ae||ie,z.wrap?`(${ee}${ce})`:ce},H=(L,z,ee,ae)=>{if(ee)return N(L,z,{wrap:!1,...ae});let ie=String.fromCharCode(L);if(L===z)return ie;let ce=String.fromCharCode(z);return`[${ie}-${ce}]`},F=(L,z,ee)=>{if(Array.isArray(L)){let ae=ee.wrap===!0,ie=ee.capture?"":"?:";return ae?`(${ie}${L.join("|")})`:L.join("|")}return N(L,z,ee)},Q=(...L)=>new RangeError("Invalid range arguments: "+A.inspect(...L)),he=(L,z,ee)=>{if(ee.strictRanges===!0)throw Q([L,z]);return[]},be=(L,z)=>{if(z.strictRanges===!0)throw new TypeError(`Expected step "${L}" to be a number`);return[]},j=(L,z,ee=1,ae={})=>{let ie=Number(L),ce=Number(z);if(!Number.isInteger(ie)||!Number.isInteger(ce)){if(ae.strictRanges===!0)throw Q([L,z]);return[]}ie===0&&(ie=0),ce===0&&(ce=0);let ge=ie>ce,Te=String(L),Be=String(z),He=String(ee);ee=Math.max(Math.abs(ee),1);let ye=m(Te)||m(Be)||m(He),Je=ye?Math.max(Te.length,Be.length,He.length):0,ot=ye===!1&&E(L,z,ae)===!1,We=ae.transform||q(ot);if(ae.toRegex&&ee===1)return H(_(L,Je),_(z,Je),!0,ae);let De={negatives:[],positives:[]},Ge=Y=>De[Y<0?"negatives":"positives"].push(Math.abs(Y)),at=[],je=0;for(;ge?ie>=ce:ie<=ce;)ae.toRegex===!0&&ee>1?Ge(ie):at.push(R(We(ie,je),Je,ot)),ie=ge?ie-ee:ie+ee,je++;return ae.toRegex===!0?ee>1?k(De,ae):F(at,null,{wrap:!1,...ae}):at},Z=(L,z,ee=1,ae={})=>{if(!P(L)&&L.length>1||!P(z)&&z.length>1)return he(L,z,ae);let ie=ae.transform||(ot=>String.fromCharCode(ot)),ce=`${L}`.charCodeAt(0),ge=`${z}`.charCodeAt(0),Te=ce>ge,Be=Math.min(ce,ge),He=Math.max(ce,ge);if(ae.toRegex&&ee===1)return H(Be,He,!1,ae);let ye=[],Je=0;for(;Te?ce>=ge:ce<=ge;)ye.push(ie(ce,Je)),ce=Te?ce-ee:ce+ee,Je++;return ae.toRegex===!0?F(ye,null,{wrap:!1,options:ae}):ye},X=(L,z,ee,ae={})=>{if(z==null&&W(L))return[L];if(!W(L)||!W(z))return he(L,z,ae);if(typeof ee=="function")return X(L,z,1,{transform:ee});if($(ee))return X(L,z,0,ee);let ie={...ae};return ie.capture===!0&&(ie.wrap=!0),ee=ee||ie.step||1,P(ee)?P(L)&&P(z)?j(L,z,ee,ie):Z(L,z,Math.max(Math.abs(ee),1),ie):ee!=null&&!$(ee)?be(ee,ie):X(L,z,1,ee)};d.exports=X},7360:function(d,C){var B,A,N;(function($,q){A=[],B=q,N=typeof B=="function"?B.apply(C,A):B,N!==void 0&&(d.exports=N)})(this,function(){function q(j){var Z={single:function(X,L,z){if(!X||(Q(X)||(X=Z.getPreparedSearch(X)),!L))return null;Q(L)||(L=Z.getPrepared(L));var ee=z&&z.allowTypo!==void 0?z.allowTypo:j&&j.allowTypo!==void 0?j.allowTypo:!0,ae=ee?Z.algorithm:Z.algorithmNoTypo;return ae(X,L,X[0])},go:function(X,L,z){if(!X)return E;X=Z.prepareSearch(X);var ee=X[0],ae=z&&z.threshold||j&&j.threshold||-9007199254740991,ie=z&&z.limit||j&&j.limit||9007199254740991,ce=z&&z.allowTypo!==void 0?z.allowTypo:j&&j.allowTypo!==void 0?j.allowTypo:!0,ge=ce?Z.algorithm:Z.algorithmNoTypo,Te=0,Be=0,He=L.length;if(z&&z.keys)for(var ye=z.scoreFn||H,Je=z.keys,ot=Je.length,We=He-1;We>=0;--We){for(var De=L[We],Ge=new Array(ot),at=ot-1;at>=0;--at){var je=Je[at],Y=F(De,je);if(!Y){Ge[at]=null;continue}Q(Y)||(Y=Z.getPrepared(Y)),Ge[at]=ge(X,Y,ee)}Ge.obj=De;var ht=ye(Ge);ht!==null&&(ht<ae||(Ge.score=ht,Te<ie?(be.add(Ge),++Te):(++Be,ht>be.peek().score&&be.replaceTop(Ge))))}else if(z&&z.key)for(var je=z.key,We=He-1;We>=0;--We){var De=L[We],Y=F(De,je);if(!!Y){Q(Y)||(Y=Z.getPrepared(Y));var st=ge(X,Y,ee);st!==null&&(st.score<ae||(st={target:st.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:st.score,indexes:st.indexes,obj:De},Te<ie?(be.add(st),++Te):(++Be,st.score>be.peek().score&&be.replaceTop(st))))}}else for(var We=He-1;We>=0;--We){var Y=L[We];if(!!Y){Q(Y)||(Y=Z.getPrepared(Y));var st=ge(X,Y,ee);st!==null&&(st.score<ae||(Te<ie?(be.add(st),++Te):(++Be,st.score>be.peek().score&&be.replaceTop(st))))}}if(Te===0)return E;for(var ct=new Array(Te),We=Te-1;We>=0;--We)ct[We]=be.poll();return ct.total=Te+Be,ct},goAsync:function(X,L,z){var ee=!1,ae=new Promise(function(ie,ce){if(!X)return ie(E);X=Z.prepareSearch(X);var ge=X[0],Te=he(),Be=L.length-1,He=z&&z.threshold||j&&j.threshold||-9007199254740991,ye=z&&z.limit||j&&j.limit||9007199254740991,Je=z&&z.allowTypo!==void 0?z.allowTypo:j&&j.allowTypo!==void 0?j.allowTypo:!0,ot=Je?Z.algorithm:Z.algorithmNoTypo,We=0,De=0;function Ge(){if(ee)return ce("canceled");var at=Date.now();if(z&&z.keys)for(var je=z.scoreFn||H,Y=z.keys,ht=Y.length;Be>=0;--Be){for(var st=L[Be],ct=new Array(ht),fe=ht-1;fe>=0;--fe){var pe=Y[fe],qe=F(st,pe);if(!qe){ct[fe]=null;continue}Q(qe)||(qe=Z.getPrepared(qe)),ct[fe]=ot(X,qe,ge)}ct.obj=st;var Qe=je(ct);if(Qe!==null&&!(Qe<He)&&(ct.score=Qe,We<ye?(Te.add(ct),++We):(++De,Qe>Te.peek().score&&Te.replaceTop(ct)),Be%1e3==0&&Date.now()-at>=10)){W?setImmediate(Ge):setTimeout(Ge);return}}else if(z&&z.key)for(var pe=z.key;Be>=0;--Be){var st=L[Be],qe=F(st,pe);if(!!qe){Q(qe)||(qe=Z.getPrepared(qe));var _t=ot(X,qe,ge);if(_t!==null&&!(_t.score<He)&&(_t={target:_t.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:_t.score,indexes:_t.indexes,obj:st},We<ye?(Te.add(_t),++We):(++De,_t.score>Te.peek().score&&Te.replaceTop(_t)),Be%1e3==0&&Date.now()-at>=10)){W?setImmediate(Ge):setTimeout(Ge);return}}}else for(;Be>=0;--Be){var qe=L[Be];if(!!qe){Q(qe)||(qe=Z.getPrepared(qe));var _t=ot(X,qe,ge);if(_t!==null&&!(_t.score<He)&&(We<ye?(Te.add(_t),++We):(++De,_t.score>Te.peek().score&&Te.replaceTop(_t)),Be%1e3==0&&Date.now()-at>=10)){W?setImmediate(Ge):setTimeout(Ge);return}}}if(We===0)return ie(E);for(var vr=new Array(We),kt=We-1;kt>=0;--kt)vr[kt]=Te.poll();vr.total=We+De,ie(vr)}W?setImmediate(Ge):Ge()});return ae.cancel=function(){ee=!0},ae},highlight:function(X,L,z){if(X===null)return null;L===void 0&&(L="<b>"),z===void 0&&(z="</b>");for(var ee="",ae=0,ie=!1,ce=X.target,ge=ce.length,Te=X.indexes,Be=0;Be<ge;++Be){var He=ce[Be];if(Te[ae]===Be){if(++ae,ie||(ie=!0,ee+=L),ae===Te.length){ee+=He+z+ce.substr(Be+1);break}}else ie&&(ie=!1,ee+=z);ee+=He}return ee},prepare:function(X){if(!!X)return{target:X,_targetLowerCodes:Z.prepareLowerCodes(X),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(X){if(!!X)return{target:X,_targetLowerCodes:Z.prepareLowerCodes(X),_nextBeginningIndexes:Z.prepareNextBeginningIndexes(X),score:null,indexes:null,obj:null}},prepareSearch:function(X){if(!!X)return Z.prepareLowerCodes(X)},getPrepared:function(X){if(X.length>999)return Z.prepare(X);var L=P.get(X);return L!==void 0||(L=Z.prepare(X),P.set(X,L)),L},getPreparedSearch:function(X){if(X.length>999)return Z.prepareSearch(X);var L=m.get(X);return L!==void 0||(L=Z.prepareSearch(X),m.set(X,L)),L},algorithm:function(X,L,z){for(var ee=L._targetLowerCodes,ae=X.length,ie=ee.length,ce=0,ge=0,Te=0,Be=0;;){var He=z===ee[ge];if(He){if(R[Be++]=ge,++ce,ce===ae)break;z=X[Te===0?ce:Te===ce?ce+1:Te===ce-1?ce-1:ce]}if(++ge,ge>=ie)for(;;){if(ce<=1)return null;if(Te===0){--ce;var ye=X[ce];if(z===ye)continue;Te=ce}else{if(Te===1)return null;--Te,ce=Te,z=X[ce+1];var ye=X[ce];if(z===ye)continue}Be=ce,ge=R[Be-1]+1;break}}var ce=0,Je=0,ot=!1,We=0,De=L._nextBeginningIndexes;De===null&&(De=L._nextBeginningIndexes=Z.prepareNextBeginningIndexes(L.target));var Ge=ge=R[0]===0?0:De[R[0]-1];if(ge!==ie)for(;;)if(ge>=ie){if(ce<=0){if(++Je,Je>ae-2)break;if(X[Je]===X[Je+1])continue;ge=Ge;continue}--ce;var at=_[--We];ge=De[at]}else{var He=X[Je===0?ce:Je===ce?ce+1:Je===ce-1?ce-1:ce]===ee[ge];if(He){if(_[We++]=ge,++ce,ce===ae){ot=!0;break}++ge}else ge=De[ge]}{if(ot)var je=_,Y=We;else var je=R,Y=Be;for(var ht=0,st=-1,ct=0;ct<ae;++ct){var ge=je[ct];st!==ge-1&&(ht-=ge),st=ge}ot?Je!==0&&(ht+=-20):(ht*=1e3,Te!==0&&(ht+=-20)),ht-=ie-ae,L.score=ht,L.indexes=new Array(Y);for(var ct=Y-1;ct>=0;--ct)L.indexes[ct]=je[ct];return L}},algorithmNoTypo:function(X,L,z){for(var ee=L._targetLowerCodes,ae=X.length,ie=ee.length,ce=0,ge=0,Te=0;;){var Be=z===ee[ge];if(Be){if(R[Te++]=ge,++ce,ce===ae)break;z=X[ce]}if(++ge,ge>=ie)return null}var ce=0,He=!1,ye=0,Je=L._nextBeginningIndexes;Je===null&&(Je=L._nextBeginningIndexes=Z.prepareNextBeginningIndexes(L.target));var ot=ge=R[0]===0?0:Je[R[0]-1];if(ge!==ie)for(;;)if(ge>=ie){if(ce<=0)break;--ce;var We=_[--ye];ge=Je[We]}else{var Be=X[ce]===ee[ge];if(Be){if(_[ye++]=ge,++ce,ce===ae){He=!0;break}++ge}else ge=Je[ge]}{if(He)var De=_,Ge=ye;else var De=R,Ge=Te;for(var at=0,je=-1,Y=0;Y<ae;++Y){var ge=De[Y];je!==ge-1&&(at-=ge),je=ge}He||(at*=1e3),at-=ie-ae,L.score=at,L.indexes=new Array(Ge);for(var Y=Ge-1;Y>=0;--Y)L.indexes[Y]=De[Y];return L}},prepareLowerCodes:function(X){for(var L=X.length,z=[],ee=X.toLowerCase(),ae=0;ae<L;++ae)z[ae]=ee.charCodeAt(ae);return z},prepareBeginningIndexes:function(X){for(var L=X.length,z=[],ee=0,ae=!1,ie=!1,ce=0;ce<L;++ce){var ge=X.charCodeAt(ce),Te=ge>=65&&ge<=90,Be=Te||ge>=97&&ge<=122||ge>=48&&ge<=57,He=Te&&!ae||!ie||!Be;ae=Te,ie=Be,He&&(z[ee++]=ce)}return z},prepareNextBeginningIndexes:function(X){for(var L=X.length,z=Z.prepareBeginningIndexes(X),ee=[],ae=z[0],ie=0,ce=0;ce<L;++ce)ae>ce?ee[ce]=ae:(ae=z[++ie],ee[ce]=ae===void 0?L:ae);return ee},cleanup:k,new:q};return Z}var W=typeof window=="undefined",P=new Map,m=new Map,E=[];E.total=0;var R=[],_=[];function k(){P.clear(),m.clear(),R=[],_=[]}function H(j){for(var Z=-9007199254740991,X=j.length-1;X>=0;--X){var L=j[X];if(L!==null){var z=L.score;z>Z&&(Z=z)}}return Z===-9007199254740991?null:Z}function F(j,Z){var X=j[Z];if(X!==void 0)return X;var L=Z;Array.isArray(Z)||(L=Z.split("."));for(var z=L.length,ee=-1;j&&++ee<z;)j=j[L[ee]];return j}function Q(j){return typeof j=="object"}var he=function(){var j=[],Z=0,X={};function L(){for(var z=0,ee=j[z],ae=1;ae<Z;){var ie=ae+1;z=ae,ie<Z&&j[ie].score<j[ae].score&&(z=ie),j[z-1>>1]=j[z],ae=1+(z<<1)}for(var ce=z-1>>1;z>0&&ee.score<j[ce].score;ce=(z=ce)-1>>1)j[z]=j[ce];j[z]=ee}return X.add=function(z){var ee=Z;j[Z++]=z;for(var ae=ee-1>>1;ee>0&&z.score<j[ae].score;ae=(ee=ae)-1>>1)j[ee]=j[ae];j[ee]=z},X.poll=function(){if(Z!==0){var z=j[0];return j[0]=j[--Z],L(),z}},X.peek=function(z){if(Z!==0)return j[0]},X.replaceTop=function(z){j[0]=z,L()},X},be=he();return q()})},645:(d,C)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */C.read=function(B,A,N,$,q){var W,P,m=q*8-$-1,E=(1<<m)-1,R=E>>1,_=-7,k=N?q-1:0,H=N?-1:1,F=B[A+k];for(k+=H,W=F&(1<<-_)-1,F>>=-_,_+=m;_>0;W=W*256+B[A+k],k+=H,_-=8);for(P=W&(1<<-_)-1,W>>=-_,_+=$;_>0;P=P*256+B[A+k],k+=H,_-=8);if(W===0)W=1-R;else{if(W===E)return P?NaN:(F?-1:1)*(1/0);P=P+Math.pow(2,$),W=W-R}return(F?-1:1)*P*Math.pow(2,W-$)},C.write=function(B,A,N,$,q,W){var P,m,E,R=W*8-q-1,_=(1<<R)-1,k=_>>1,H=q===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=$?0:W-1,Q=$?1:-1,he=A<0||A===0&&1/A<0?1:0;for(A=Math.abs(A),isNaN(A)||A===1/0?(m=isNaN(A)?1:0,P=_):(P=Math.floor(Math.log(A)/Math.LN2),A*(E=Math.pow(2,-P))<1&&(P--,E*=2),P+k>=1?A+=H/E:A+=H*Math.pow(2,1-k),A*E>=2&&(P++,E/=2),P+k>=_?(m=0,P=_):P+k>=1?(m=(A*E-1)*Math.pow(2,q),P=P+k):(m=A*Math.pow(2,k-1)*Math.pow(2,q),P=0));q>=8;B[N+F]=m&255,F+=Q,m/=256,q-=8);for(P=P<<q|m,R+=q;R>0;B[N+F]=P&255,F+=Q,P/=256,R-=8);B[N+F-Q]|=he*128}},9924:d=>{"use strict";/*!
 * is-number <https://github.com/jonschlinkert/is-number>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */d.exports=function(C){return typeof C=="number"?C-C==0:typeof C=="string"&&C.trim()!==""?Number.isFinite?Number.isFinite(+C):isFinite(+C):!1}},850:(d,C,B)=>{"use strict";const A=B(7170),N=B(6744),$=B(9444),q=B(8702),W=m=>m===""||m==="./",P=(m,E,R)=>{E=[].concat(E),m=[].concat(m);let _=new Set,k=new Set,H=new Set,F=0,Q=j=>{H.add(j.output),R&&R.onResult&&R.onResult(j)};for(let j=0;j<E.length;j++){let Z=$(String(E[j]),{...R,onResult:Q},!0),X=Z.state.negated||Z.state.negatedExtglob;X&&F++;for(let L of m){let z=Z(L,!0);!(X?!z.isMatch:z.isMatch)||(X?_.add(z.output):(_.delete(z.output),k.add(z.output)))}}let be=(F===E.length?[...H]:[...k]).filter(j=>!_.has(j));if(R&&be.length===0){if(R.failglob===!0)throw new Error(`No matches found for "${E.join(", ")}"`);if(R.nonull===!0||R.nullglob===!0)return R.unescape?E.map(j=>j.replace(/\\/g,"")):E}return be};P.match=P,P.matcher=(m,E)=>$(m,E),P.isMatch=(m,E,R)=>$(E,R)(m),P.any=P.isMatch,P.not=(m,E,R={})=>{E=[].concat(E).map(String);let _=new Set,k=[],F=P(m,E,{...R,onResult:Q=>{R.onResult&&R.onResult(Q),k.push(Q.output)}});for(let Q of k)F.includes(Q)||_.add(Q);return[..._]},P.contains=(m,E,R)=>{if(typeof m!="string")throw new TypeError(`Expected a string: "${A.inspect(m)}"`);if(Array.isArray(E))return E.some(_=>P.contains(m,_,R));if(typeof E=="string"){if(W(m)||W(E))return!1;if(m.includes(E)||m.startsWith("./")&&m.slice(2).includes(E))return!0}return P.isMatch(m,E,{...R,contains:!0})},P.matchKeys=(m,E,R)=>{if(!q.isObject(m))throw new TypeError("Expected the first argument to be an object");let _=P(Object.keys(m),E,R),k={};for(let H of _)k[H]=m[H];return k},P.some=(m,E,R)=>{let _=[].concat(m);for(let k of[].concat(E)){let H=$(String(k),R);if(_.some(F=>H(F)))return!0}return!1},P.every=(m,E,R)=>{let _=[].concat(m);for(let k of[].concat(E)){let H=$(String(k),R);if(!_.every(F=>H(F)))return!1}return!0},P.all=(m,E,R)=>{if(typeof m!="string")throw new TypeError(`Expected a string: "${A.inspect(m)}"`);return[].concat(E).every(_=>$(_,R)(m))},P.capture=(m,E,R)=>{let _=q.isWindows(R),H=$.makeRe(String(m),{...R,capture:!0}).exec(_?q.toPosixSlashes(E):E);if(H)return H.slice(1).map(F=>F===void 0?"":F)},P.makeRe=(...m)=>$.makeRe(...m),P.scan=(...m)=>$.scan(...m),P.parse=(m,E)=>{let R=[];for(let _ of[].concat(m||[]))for(let k of N(String(_),E))R.push($.parse(k,E));return R},P.braces=(m,E)=>{if(typeof m!="string")throw new TypeError("Expected a string");return E&&E.nobrace===!0||!/\{.*\}/.test(m)?[m]:N(m,E)},P.braceExpand=(m,E)=>{if(typeof m!="string")throw new TypeError("Expected a string");return P.braces(m,{...E,expand:!0})},d.exports=P},778:(d,C,B)=>{var A=B(2479);d.exports=A(N),d.exports.strict=A($),N.proto=N(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return N(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return $(this)},configurable:!0})});function N(q){var W=function(){return W.called?W.value:(W.called=!0,W.value=q.apply(this,arguments))};return W.called=!1,W}function $(q){var W=function(){if(W.called)throw new Error(W.onceError);return W.called=!0,W.value=q.apply(this,arguments)},P=q.name||"Function wrapped with `once`";return W.onceError=P+" shouldn't be called more than once",W.called=!1,W}},6470:(d,C,B)=>{"use strict";var A=B(4155);function N(P){if(typeof P!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(P))}function $(P,m){for(var E="",R=0,_=-1,k=0,H,F=0;F<=P.length;++F){if(F<P.length)H=P.charCodeAt(F);else{if(H===47)break;H=47}if(H===47){if(!(_===F-1||k===1))if(_!==F-1&&k===2){if(E.length<2||R!==2||E.charCodeAt(E.length-1)!==46||E.charCodeAt(E.length-2)!==46){if(E.length>2){var Q=E.lastIndexOf("/");if(Q!==E.length-1){Q===-1?(E="",R=0):(E=E.slice(0,Q),R=E.length-1-E.lastIndexOf("/")),_=F,k=0;continue}}else if(E.length===2||E.length===1){E="",R=0,_=F,k=0;continue}}m&&(E.length>0?E+="/..":E="..",R=2)}else E.length>0?E+="/"+P.slice(_+1,F):E=P.slice(_+1,F),R=F-_-1;_=F,k=0}else H===46&&k!==-1?++k:k=-1}return E}function q(P,m){var E=m.dir||m.root,R=m.base||(m.name||"")+(m.ext||"");return E?E===m.root?E+R:E+P+R:R}var W={resolve:function(){for(var m="",E=!1,R,_=arguments.length-1;_>=-1&&!E;_--){var k;_>=0?k=arguments[_]:(R===void 0&&(R=A.cwd()),k=R),N(k),k.length!==0&&(m=k+"/"+m,E=k.charCodeAt(0)===47)}return m=$(m,!E),E?m.length>0?"/"+m:"/":m.length>0?m:"."},normalize:function(m){if(N(m),m.length===0)return".";var E=m.charCodeAt(0)===47,R=m.charCodeAt(m.length-1)===47;return m=$(m,!E),m.length===0&&!E&&(m="."),m.length>0&&R&&(m+="/"),E?"/"+m:m},isAbsolute:function(m){return N(m),m.length>0&&m.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var m,E=0;E<arguments.length;++E){var R=arguments[E];N(R),R.length>0&&(m===void 0?m=R:m+="/"+R)}return m===void 0?".":W.normalize(m)},relative:function(m,E){if(N(m),N(E),m===E||(m=W.resolve(m),E=W.resolve(E),m===E))return"";for(var R=1;R<m.length&&m.charCodeAt(R)===47;++R);for(var _=m.length,k=_-R,H=1;H<E.length&&E.charCodeAt(H)===47;++H);for(var F=E.length,Q=F-H,he=k<Q?k:Q,be=-1,j=0;j<=he;++j){if(j===he){if(Q>he){if(E.charCodeAt(H+j)===47)return E.slice(H+j+1);if(j===0)return E.slice(H+j)}else k>he&&(m.charCodeAt(R+j)===47?be=j:j===0&&(be=0));break}var Z=m.charCodeAt(R+j),X=E.charCodeAt(H+j);if(Z!==X)break;Z===47&&(be=j)}var L="";for(j=R+be+1;j<=_;++j)(j===_||m.charCodeAt(j)===47)&&(L.length===0?L+="..":L+="/..");return L.length>0?L+E.slice(H+be):(H+=be,E.charCodeAt(H)===47&&++H,E.slice(H))},_makeLong:function(m){return m},dirname:function(m){if(N(m),m.length===0)return".";for(var E=m.charCodeAt(0),R=E===47,_=-1,k=!0,H=m.length-1;H>=1;--H)if(E=m.charCodeAt(H),E===47){if(!k){_=H;break}}else k=!1;return _===-1?R?"/":".":R&&_===1?"//":m.slice(0,_)},basename:function(m,E){if(E!==void 0&&typeof E!="string")throw new TypeError('"ext" argument must be a string');N(m);var R=0,_=-1,k=!0,H;if(E!==void 0&&E.length>0&&E.length<=m.length){if(E.length===m.length&&E===m)return"";var F=E.length-1,Q=-1;for(H=m.length-1;H>=0;--H){var he=m.charCodeAt(H);if(he===47){if(!k){R=H+1;break}}else Q===-1&&(k=!1,Q=H+1),F>=0&&(he===E.charCodeAt(F)?--F==-1&&(_=H):(F=-1,_=Q))}return R===_?_=Q:_===-1&&(_=m.length),m.slice(R,_)}else{for(H=m.length-1;H>=0;--H)if(m.charCodeAt(H)===47){if(!k){R=H+1;break}}else _===-1&&(k=!1,_=H+1);return _===-1?"":m.slice(R,_)}},extname:function(m){N(m);for(var E=-1,R=0,_=-1,k=!0,H=0,F=m.length-1;F>=0;--F){var Q=m.charCodeAt(F);if(Q===47){if(!k){R=F+1;break}continue}_===-1&&(k=!1,_=F+1),Q===46?E===-1?E=F:H!==1&&(H=1):E!==-1&&(H=-1)}return E===-1||_===-1||H===0||H===1&&E===_-1&&E===R+1?"":m.slice(E,_)},format:function(m){if(m===null||typeof m!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof m);return q("/",m)},parse:function(m){N(m);var E={root:"",dir:"",base:"",ext:"",name:""};if(m.length===0)return E;var R=m.charCodeAt(0),_=R===47,k;_?(E.root="/",k=1):k=0;for(var H=-1,F=0,Q=-1,he=!0,be=m.length-1,j=0;be>=k;--be){if(R=m.charCodeAt(be),R===47){if(!he){F=be+1;break}continue}Q===-1&&(he=!1,Q=be+1),R===46?H===-1?H=be:j!==1&&(j=1):H!==-1&&(j=-1)}return H===-1||Q===-1||j===0||j===1&&H===Q-1&&H===F+1?Q!==-1&&(F===0&&_?E.base=E.name=m.slice(1,Q):E.base=E.name=m.slice(F,Q)):(F===0&&_?(E.name=m.slice(1,H),E.base=m.slice(1,Q)):(E.name=m.slice(F,H),E.base=m.slice(F,Q)),E.ext=m.slice(H,Q)),F>0?E.dir=m.slice(0,F-1):_&&(E.dir="/"),E},sep:"/",delimiter:":",win32:null,posix:null};W.posix=W,d.exports=W},7279:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.EndOfStreamError=C.defaultMessages=void 0,C.defaultMessages="End-Of-Stream";class B extends Error{constructor(){super(C.defaultMessages)}}C.EndOfStreamError=B},5167:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.StreamReader=C.EndOfStreamError=void 0;const A=B(7279);var N=B(7279);Object.defineProperty(C,"EndOfStreamError",{enumerable:!0,get:function(){return N.EndOfStreamError}});class ${constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((m,E)=>{this.reject=E,this.resolve=m})}}const q=1*1024*1024;class W{constructor(m){if(this.s=m,this.request=null,this.endOfStream=!1,this.peekQueue=[],!m.read||!m.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new A.EndOfStreamError)),this.s.once("error",E=>this.reject(E)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(m,E,R){const _=await this.read(m,E,R);return this.peekQueue.push(m.subarray(E,E+_)),_}async read(m,E,R){if(R===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new A.EndOfStreamError;let _=R,k=0;for(;this.peekQueue.length>0&&_>0;){const H=this.peekQueue.pop();if(!H)throw new Error("peekData should be defined");const F=Math.min(H.length,_);m.set(H.subarray(0,F),E+k),k+=F,_-=F,F<H.length&&this.peekQueue.push(H.subarray(F))}for(;_>0&&!this.endOfStream;){const H=Math.min(_,q),F=await this._read(m,E+k,H);if(k+=F,F<H)break;_-=F}return k}async _read(m,E,R){if(this.request)throw new Error("Concurrent read operation?");const _=this.s.read(R);return _?(m.set(_,E),_.length):(this.request={buffer:m,offset:E,length:R,deferred:new $},this.s.once("readable",()=>{this.tryRead()}),this.request.deferred.promise)}tryRead(){if(!this.request)throw new Error("this.request should be defined");const m=this.s.read(this.request.length);m?(this.request.buffer.set(m,this.request.offset),this.request.deferred.resolve(m.length),this.request=null):this.s.once("readable",()=>{this.tryRead()})}reject(m){this.endOfStream=!0,this.request&&(this.request.deferred.reject(m),this.request=null)}}C.StreamReader=W},9444:(d,C,B)=>{"use strict";d.exports=B(6087)},1006:(d,C,B)=>{"use strict";const A=B(6470),N="\\\\/",$=`[^${N}]`,q="\\.",W="\\+",P="\\?",m="\\/",E="(?=.)",R="[^/]",_=`(?:${m}|$)`,k=`(?:^|${m})`,H=`${q}{1,2}${_}`,F=`(?!${q})`,Q=`(?!${k}${H})`,he=`(?!${q}{0,1}${_})`,be=`(?!${H})`,j=`[^.${m}]`,Z=`${R}*?`,X={DOT_LITERAL:q,PLUS_LITERAL:W,QMARK_LITERAL:P,SLASH_LITERAL:m,ONE_CHAR:E,QMARK:R,END_ANCHOR:_,DOTS_SLASH:H,NO_DOT:F,NO_DOTS:Q,NO_DOT_SLASH:he,NO_DOTS_SLASH:be,QMARK_NO_DOT:j,STAR:Z,START_ANCHOR:k},L={...X,SLASH_LITERAL:`[${N}]`,QMARK:$,STAR:`${$}*?`,DOTS_SLASH:`${q}{1,2}(?:[${N}]|$)`,NO_DOT:`(?!${q})`,NO_DOTS:`(?!(?:^|[${N}])${q}{1,2}(?:[${N}]|$))`,NO_DOT_SLASH:`(?!${q}{0,1}(?:[${N}]|$))`,NO_DOTS_SLASH:`(?!${q}{1,2}(?:[${N}]|$))`,QMARK_NO_DOT:`[^.${N}]`,START_ANCHOR:`(?:^|[${N}])`,END_ANCHOR:`(?:[${N}]|$)`},z={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};d.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:z,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:A.sep,extglobChars(ee){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${ee.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(ee){return ee===!0?L:X}}},3376:(d,C,B)=>{"use strict";const A=B(1006),N=B(8702),{MAX_LENGTH:$,POSIX_REGEX_SOURCE:q,REGEX_NON_SPECIAL_CHARS:W,REGEX_SPECIAL_CHARS_BACKREF:P,REPLACEMENTS:m}=A,E=(k,H)=>{if(typeof H.expandRange=="function")return H.expandRange(...k,H);k.sort();const F=`[${k.join("-")}]`;try{new RegExp(F)}catch(Q){return k.map(he=>N.escapeRegex(he)).join("..")}return F},R=(k,H)=>`Missing ${k}: "${H}" - use "\\\\${H}" to match literal characters`,_=(k,H)=>{if(typeof k!="string")throw new TypeError("Expected a string");k=m[k]||k;const F={...H},Q=typeof F.maxLength=="number"?Math.min($,F.maxLength):$;let he=k.length;if(he>Q)throw new SyntaxError(`Input length: ${he}, exceeds maximum allowed length: ${Q}`);const be={type:"bos",value:"",output:F.prepend||""},j=[be],Z=F.capture?"":"?:",X=N.isWindows(H),L=A.globChars(X),z=A.extglobChars(L),{DOT_LITERAL:ee,PLUS_LITERAL:ae,SLASH_LITERAL:ie,ONE_CHAR:ce,DOTS_SLASH:ge,NO_DOT:Te,NO_DOT_SLASH:Be,NO_DOTS_SLASH:He,QMARK:ye,QMARK_NO_DOT:Je,STAR:ot,START_ANCHOR:We}=L,De=Me=>`(${Z}(?:(?!${We}${Me.dot?ge:ee}).)*?)`,Ge=F.dot?"":Te,at=F.dot?ye:Je;let je=F.bash===!0?De(F):ot;F.capture&&(je=`(${je})`),typeof F.noext=="boolean"&&(F.noextglob=F.noext);const Y={input:k,index:-1,start:0,dot:F.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:j};k=N.removePrefix(k,Y),he=k.length;const ht=[],st=[],ct=[];let fe=be,pe;const qe=()=>Y.index===he-1,Qe=Y.peek=(Me=1)=>k[Y.index+Me],_t=Y.advance=()=>k[++Y.index]||"",vr=()=>k.slice(Y.index+1),kt=(Me="",mt=0)=>{Y.consumed+=Me,Y.index+=mt},It=Me=>{Y.output+=Me.output!=null?Me.output:Me.value,kt(Me.value)},zr=()=>{let Me=1;for(;Qe()==="!"&&(Qe(2)!=="("||Qe(3)==="?");)_t(),Y.start++,Me++;return Me%2==0?!1:(Y.negated=!0,Y.start++,!0)},Fr=Me=>{Y[Me]++,ct.push(Me)},tr=Me=>{Y[Me]--,ct.pop()},Xe=Me=>{if(fe.type==="globstar"){const mt=Y.braces>0&&(Me.type==="comma"||Me.type==="brace"),Ee=Me.extglob===!0||ht.length&&(Me.type==="pipe"||Me.type==="paren");Me.type!=="slash"&&Me.type!=="paren"&&!mt&&!Ee&&(Y.output=Y.output.slice(0,-fe.output.length),fe.type="star",fe.value="*",fe.output=je,Y.output+=fe.output)}if(ht.length&&Me.type!=="paren"&&(ht[ht.length-1].inner+=Me.value),(Me.value||Me.output)&&It(Me),fe&&fe.type==="text"&&Me.type==="text"){fe.value+=Me.value,fe.output=(fe.output||"")+Me.value;return}Me.prev=fe,j.push(Me),fe=Me},Ot=(Me,mt)=>{const Ee={...z[mt],conditions:1,inner:""};Ee.prev=fe,Ee.parens=Y.parens,Ee.output=Y.output;const it=(F.capture?"(":"")+Ee.open;Fr("parens"),Xe({type:Me,value:mt,output:Y.output?"":ce}),Xe({type:"paren",extglob:!0,value:_t(),output:it}),ht.push(Ee)},ji=Me=>{let mt=Me.close+(F.capture?")":""),Ee;if(Me.type==="negate"){let it=je;Me.inner&&Me.inner.length>1&&Me.inner.includes("/")&&(it=De(F)),(it!==je||qe()||/^\)+$/.test(vr()))&&(mt=Me.close=`)$))${it}`),Me.inner.includes("*")&&(Ee=vr())&&/^\.[^\\/.]+$/.test(Ee)&&(mt=Me.close=`)${Ee})${it})`),Me.prev.type==="bos"&&(Y.negatedExtglob=!0)}Xe({type:"paren",extglob:!0,value:pe,output:mt}),tr("parens")};if(F.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(k)){let Me=!1,mt=k.replace(P,(Ee,it,jt,Ht,Zt,T)=>Ht==="\\"?(Me=!0,Ee):Ht==="?"?it?it+Ht+(Zt?ye.repeat(Zt.length):""):T===0?at+(Zt?ye.repeat(Zt.length):""):ye.repeat(jt.length):Ht==="."?ee.repeat(jt.length):Ht==="*"?it?it+Ht+(Zt?je:""):je:it?Ee:`\\${Ee}`);return Me===!0&&(F.unescape===!0?mt=mt.replace(/\\/g,""):mt=mt.replace(/\\+/g,Ee=>Ee.length%2==0?"\\\\":Ee?"\\":"")),mt===k&&F.contains===!0?(Y.output=k,Y):(Y.output=N.wrapOutput(mt,Y,H),Y)}for(;!qe();){if(pe=_t(),pe==="\0")continue;if(pe==="\\"){const Ee=Qe();if(Ee==="/"&&F.bash!==!0||Ee==="."||Ee===";")continue;if(!Ee){pe+="\\",Xe({type:"text",value:pe});continue}const it=/^\\+/.exec(vr());let jt=0;if(it&&it[0].length>2&&(jt=it[0].length,Y.index+=jt,jt%2!=0&&(pe+="\\")),F.unescape===!0?pe=_t():pe+=_t(),Y.brackets===0){Xe({type:"text",value:pe});continue}}if(Y.brackets>0&&(pe!=="]"||fe.value==="["||fe.value==="[^")){if(F.posix!==!1&&pe===":"){const Ee=fe.value.slice(1);if(Ee.includes("[")&&(fe.posix=!0,Ee.includes(":"))){const it=fe.value.lastIndexOf("["),jt=fe.value.slice(0,it),Ht=fe.value.slice(it+2),Zt=q[Ht];if(Zt){fe.value=jt+Zt,Y.backtrack=!0,_t(),!be.output&&j.indexOf(fe)===1&&(be.output=ce);continue}}}(pe==="["&&Qe()!==":"||pe==="-"&&Qe()==="]")&&(pe=`\\${pe}`),pe==="]"&&(fe.value==="["||fe.value==="[^")&&(pe=`\\${pe}`),F.posix===!0&&pe==="!"&&fe.value==="["&&(pe="^"),fe.value+=pe,It({value:pe});continue}if(Y.quotes===1&&pe!=='"'){pe=N.escapeRegex(pe),fe.value+=pe,It({value:pe});continue}if(pe==='"'){Y.quotes=Y.quotes===1?0:1,F.keepQuotes===!0&&Xe({type:"text",value:pe});continue}if(pe==="("){Fr("parens"),Xe({type:"paren",value:pe});continue}if(pe===")"){if(Y.parens===0&&F.strictBrackets===!0)throw new SyntaxError(R("opening","("));const Ee=ht[ht.length-1];if(Ee&&Y.parens===Ee.parens+1){ji(ht.pop());continue}Xe({type:"paren",value:pe,output:Y.parens?")":"\\)"}),tr("parens");continue}if(pe==="["){if(F.nobracket===!0||!vr().includes("]")){if(F.nobracket!==!0&&F.strictBrackets===!0)throw new SyntaxError(R("closing","]"));pe=`\\${pe}`}else Fr("brackets");Xe({type:"bracket",value:pe});continue}if(pe==="]"){if(F.nobracket===!0||fe&&fe.type==="bracket"&&fe.value.length===1){Xe({type:"text",value:pe,output:`\\${pe}`});continue}if(Y.brackets===0){if(F.strictBrackets===!0)throw new SyntaxError(R("opening","["));Xe({type:"text",value:pe,output:`\\${pe}`});continue}tr("brackets");const Ee=fe.value.slice(1);if(fe.posix!==!0&&Ee[0]==="^"&&!Ee.includes("/")&&(pe=`/${pe}`),fe.value+=pe,It({value:pe}),F.literalBrackets===!1||N.hasRegexChars(Ee))continue;const it=N.escapeRegex(fe.value);if(Y.output=Y.output.slice(0,-fe.value.length),F.literalBrackets===!0){Y.output+=it,fe.value=it;continue}fe.value=`(${Z}${it}|${fe.value})`,Y.output+=fe.value;continue}if(pe==="{"&&F.nobrace!==!0){Fr("braces");const Ee={type:"brace",value:pe,output:"(",outputIndex:Y.output.length,tokensIndex:Y.tokens.length};st.push(Ee),Xe(Ee);continue}if(pe==="}"){const Ee=st[st.length-1];if(F.nobrace===!0||!Ee){Xe({type:"text",value:pe,output:pe});continue}let it=")";if(Ee.dots===!0){const jt=j.slice(),Ht=[];for(let Zt=jt.length-1;Zt>=0&&(j.pop(),jt[Zt].type!=="brace");Zt--)jt[Zt].type!=="dots"&&Ht.unshift(jt[Zt].value);it=E(Ht,F),Y.backtrack=!0}if(Ee.comma!==!0&&Ee.dots!==!0){const jt=Y.output.slice(0,Ee.outputIndex),Ht=Y.tokens.slice(Ee.tokensIndex);Ee.value=Ee.output="\\{",pe=it="\\}",Y.output=jt;for(const Zt of Ht)Y.output+=Zt.output||Zt.value}Xe({type:"brace",value:pe,output:it}),tr("braces"),st.pop();continue}if(pe==="|"){ht.length>0&&ht[ht.length-1].conditions++,Xe({type:"text",value:pe});continue}if(pe===","){let Ee=pe;const it=st[st.length-1];it&&ct[ct.length-1]==="braces"&&(it.comma=!0,Ee="|"),Xe({type:"comma",value:pe,output:Ee});continue}if(pe==="/"){if(fe.type==="dot"&&Y.index===Y.start+1){Y.start=Y.index+1,Y.consumed="",Y.output="",j.pop(),fe=be;continue}Xe({type:"slash",value:pe,output:ie});continue}if(pe==="."){if(Y.braces>0&&fe.type==="dot"){fe.value==="."&&(fe.output=ee);const Ee=st[st.length-1];fe.type="dots",fe.output+=pe,fe.value+=pe,Ee.dots=!0;continue}if(Y.braces+Y.parens===0&&fe.type!=="bos"&&fe.type!=="slash"){Xe({type:"text",value:pe,output:ee});continue}Xe({type:"dot",value:pe,output:ee});continue}if(pe==="?"){if(!(fe&&fe.value==="(")&&F.noextglob!==!0&&Qe()==="("&&Qe(2)!=="?"){Ot("qmark",pe);continue}if(fe&&fe.type==="paren"){const it=Qe();let jt=pe;if(it==="<"&&!N.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(fe.value==="("&&!/[!=<:]/.test(it)||it==="<"&&!/<([!=]|\w+>)/.test(vr()))&&(jt=`\\${pe}`),Xe({type:"text",value:pe,output:jt});continue}if(F.dot!==!0&&(fe.type==="slash"||fe.type==="bos")){Xe({type:"qmark",value:pe,output:Je});continue}Xe({type:"qmark",value:pe,output:ye});continue}if(pe==="!"){if(F.noextglob!==!0&&Qe()==="("&&(Qe(2)!=="?"||!/[!=<:]/.test(Qe(3)))){Ot("negate",pe);continue}if(F.nonegate!==!0&&Y.index===0){zr();continue}}if(pe==="+"){if(F.noextglob!==!0&&Qe()==="("&&Qe(2)!=="?"){Ot("plus",pe);continue}if(fe&&fe.value==="("||F.regex===!1){Xe({type:"plus",value:pe,output:ae});continue}if(fe&&(fe.type==="bracket"||fe.type==="paren"||fe.type==="brace")||Y.parens>0){Xe({type:"plus",value:pe});continue}Xe({type:"plus",value:ae});continue}if(pe==="@"){if(F.noextglob!==!0&&Qe()==="("&&Qe(2)!=="?"){Xe({type:"at",extglob:!0,value:pe,output:""});continue}Xe({type:"text",value:pe});continue}if(pe!=="*"){(pe==="$"||pe==="^")&&(pe=`\\${pe}`);const Ee=W.exec(vr());Ee&&(pe+=Ee[0],Y.index+=Ee[0].length),Xe({type:"text",value:pe});continue}if(fe&&(fe.type==="globstar"||fe.star===!0)){fe.type="star",fe.star=!0,fe.value+=pe,fe.output=je,Y.backtrack=!0,Y.globstar=!0,kt(pe);continue}let Me=vr();if(F.noextglob!==!0&&/^\([^?]/.test(Me)){Ot("star",pe);continue}if(fe.type==="star"){if(F.noglobstar===!0){kt(pe);continue}const Ee=fe.prev,it=Ee.prev,jt=Ee.type==="slash"||Ee.type==="bos",Ht=it&&(it.type==="star"||it.type==="globstar");if(F.bash===!0&&(!jt||Me[0]&&Me[0]!=="/")){Xe({type:"star",value:pe,output:""});continue}const Zt=Y.braces>0&&(Ee.type==="comma"||Ee.type==="brace"),T=ht.length&&(Ee.type==="pipe"||Ee.type==="paren");if(!jt&&Ee.type!=="paren"&&!Zt&&!T){Xe({type:"star",value:pe,output:""});continue}for(;Me.slice(0,3)==="/**";){const g=k[Y.index+4];if(g&&g!=="/")break;Me=Me.slice(3),kt("/**",3)}if(Ee.type==="bos"&&qe()){fe.type="globstar",fe.value+=pe,fe.output=De(F),Y.output=fe.output,Y.globstar=!0,kt(pe);continue}if(Ee.type==="slash"&&Ee.prev.type!=="bos"&&!Ht&&qe()){Y.output=Y.output.slice(0,-(Ee.output+fe.output).length),Ee.output=`(?:${Ee.output}`,fe.type="globstar",fe.output=De(F)+(F.strictSlashes?")":"|$)"),fe.value+=pe,Y.globstar=!0,Y.output+=Ee.output+fe.output,kt(pe);continue}if(Ee.type==="slash"&&Ee.prev.type!=="bos"&&Me[0]==="/"){const g=Me[1]!==void 0?"|$":"";Y.output=Y.output.slice(0,-(Ee.output+fe.output).length),Ee.output=`(?:${Ee.output}`,fe.type="globstar",fe.output=`${De(F)}${ie}|${ie}${g})`,fe.value+=pe,Y.output+=Ee.output+fe.output,Y.globstar=!0,kt(pe+_t()),Xe({type:"slash",value:"/",output:""});continue}if(Ee.type==="bos"&&Me[0]==="/"){fe.type="globstar",fe.value+=pe,fe.output=`(?:^|${ie}|${De(F)}${ie})`,Y.output=fe.output,Y.globstar=!0,kt(pe+_t()),Xe({type:"slash",value:"/",output:""});continue}Y.output=Y.output.slice(0,-fe.output.length),fe.type="globstar",fe.output=De(F),fe.value+=pe,Y.output+=fe.output,Y.globstar=!0,kt(pe);continue}const mt={type:"star",value:pe,output:je};if(F.bash===!0){mt.output=".*?",(fe.type==="bos"||fe.type==="slash")&&(mt.output=Ge+mt.output),Xe(mt);continue}if(fe&&(fe.type==="bracket"||fe.type==="paren")&&F.regex===!0){mt.output=pe,Xe(mt);continue}(Y.index===Y.start||fe.type==="slash"||fe.type==="dot")&&(fe.type==="dot"?(Y.output+=Be,fe.output+=Be):F.dot===!0?(Y.output+=He,fe.output+=He):(Y.output+=Ge,fe.output+=Ge),Qe()!=="*"&&(Y.output+=ce,fe.output+=ce)),Xe(mt)}for(;Y.brackets>0;){if(F.strictBrackets===!0)throw new SyntaxError(R("closing","]"));Y.output=N.escapeLast(Y.output,"["),tr("brackets")}for(;Y.parens>0;){if(F.strictBrackets===!0)throw new SyntaxError(R("closing",")"));Y.output=N.escapeLast(Y.output,"("),tr("parens")}for(;Y.braces>0;){if(F.strictBrackets===!0)throw new SyntaxError(R("closing","}"));Y.output=N.escapeLast(Y.output,"{"),tr("braces")}if(F.strictSlashes!==!0&&(fe.type==="star"||fe.type==="bracket")&&Xe({type:"maybe_slash",value:"",output:`${ie}?`}),Y.backtrack===!0){Y.output="";for(const Me of Y.tokens)Y.output+=Me.output!=null?Me.output:Me.value,Me.suffix&&(Y.output+=Me.suffix)}return Y};_.fastpaths=(k,H)=>{const F={...H},Q=typeof F.maxLength=="number"?Math.min($,F.maxLength):$,he=k.length;if(he>Q)throw new SyntaxError(`Input length: ${he}, exceeds maximum allowed length: ${Q}`);k=m[k]||k;const be=N.isWindows(H),{DOT_LITERAL:j,SLASH_LITERAL:Z,ONE_CHAR:X,DOTS_SLASH:L,NO_DOT:z,NO_DOTS:ee,NO_DOTS_SLASH:ae,STAR:ie,START_ANCHOR:ce}=A.globChars(be),ge=F.dot?ee:z,Te=F.dot?ae:z,Be=F.capture?"":"?:",He={negated:!1,prefix:""};let ye=F.bash===!0?".*?":ie;F.capture&&(ye=`(${ye})`);const Je=Ge=>Ge.noglobstar===!0?ye:`(${Be}(?:(?!${ce}${Ge.dot?L:j}).)*?)`,ot=Ge=>{switch(Ge){case"*":return`${ge}${X}${ye}`;case".*":return`${j}${X}${ye}`;case"*.*":return`${ge}${ye}${j}${X}${ye}`;case"*/*":return`${ge}${ye}${Z}${X}${Te}${ye}`;case"**":return ge+Je(F);case"**/*":return`(?:${ge}${Je(F)}${Z})?${Te}${X}${ye}`;case"**/*.*":return`(?:${ge}${Je(F)}${Z})?${Te}${ye}${j}${X}${ye}`;case"**/.*":return`(?:${ge}${Je(F)}${Z})?${j}${X}${ye}`;default:{const at=/^(.*?)\.(\w+)$/.exec(Ge);if(!at)return;const je=ot(at[1]);return je?je+j+at[2]:void 0}}},We=N.removePrefix(k,He);let De=ot(We);return De&&F.strictSlashes!==!0&&(De+=`${Z}?`),De},d.exports=_},6087:(d,C,B)=>{"use strict";const A=B(6470),N=B(3921),$=B(3376),q=B(8702),W=B(1006),P=E=>E&&typeof E=="object"&&!Array.isArray(E),m=(E,R,_=!1)=>{if(Array.isArray(E)){const Z=E.map(L=>m(L,R,_));return L=>{for(const z of Z){const ee=z(L);if(ee)return ee}return!1}}const k=P(E)&&E.tokens&&E.input;if(E===""||typeof E!="string"&&!k)throw new TypeError("Expected pattern to be a non-empty string");const H=R||{},F=q.isWindows(R),Q=k?m.compileRe(E,R):m.makeRe(E,R,!1,!0),he=Q.state;delete Q.state;let be=()=>!1;if(H.ignore){const Z={...R,ignore:null,onMatch:null,onResult:null};be=m(H.ignore,Z,_)}const j=(Z,X=!1)=>{const{isMatch:L,match:z,output:ee}=m.test(Z,Q,R,{glob:E,posix:F}),ae={glob:E,state:he,regex:Q,posix:F,input:Z,output:ee,match:z,isMatch:L};return typeof H.onResult=="function"&&H.onResult(ae),L===!1?(ae.isMatch=!1,X?ae:!1):be(Z)?(typeof H.onIgnore=="function"&&H.onIgnore(ae),ae.isMatch=!1,X?ae:!1):(typeof H.onMatch=="function"&&H.onMatch(ae),X?ae:!0)};return _&&(j.state=he),j};m.test=(E,R,_,{glob:k,posix:H}={})=>{if(typeof E!="string")throw new TypeError("Expected input to be a string");if(E==="")return{isMatch:!1,output:""};const F=_||{},Q=F.format||(H?q.toPosixSlashes:null);let he=E===k,be=he&&Q?Q(E):E;return he===!1&&(be=Q?Q(E):E,he=be===k),(he===!1||F.capture===!0)&&(F.matchBase===!0||F.basename===!0?he=m.matchBase(E,R,_,H):he=R.exec(be)),{isMatch:Boolean(he),match:he,output:be}},m.matchBase=(E,R,_,k=q.isWindows(_))=>(R instanceof RegExp?R:m.makeRe(R,_)).test(A.basename(E)),m.isMatch=(E,R,_)=>m(R,_)(E),m.parse=(E,R)=>Array.isArray(E)?E.map(_=>m.parse(_,R)):$(E,{...R,fastpaths:!1}),m.scan=(E,R)=>N(E,R),m.compileRe=(E,R,_=!1,k=!1)=>{if(_===!0)return E.output;const H=R||{},F=H.contains?"":"^",Q=H.contains?"":"$";let he=`${F}(?:${E.output})${Q}`;E&&E.negated===!0&&(he=`^(?!${he}).*$`);const be=m.toRegex(he,R);return k===!0&&(be.state=E),be},m.makeRe=(E,R={},_=!1,k=!1)=>{if(!E||typeof E!="string")throw new TypeError("Expected a non-empty string");let H={negated:!1,fastpaths:!0};return R.fastpaths!==!1&&(E[0]==="."||E[0]==="*")&&(H.output=$.fastpaths(E,R)),H.output||(H=$(E,R)),m.compileRe(H,R,_,k)},m.toRegex=(E,R)=>{try{const _=R||{};return new RegExp(E,_.flags||(_.nocase?"i":""))}catch(_){if(R&&R.debug===!0)throw _;return/$^/}},m.constants=W,d.exports=m},3921:(d,C,B)=>{"use strict";const A=B(8702),{CHAR_ASTERISK:N,CHAR_AT:$,CHAR_BACKWARD_SLASH:q,CHAR_COMMA:W,CHAR_DOT:P,CHAR_EXCLAMATION_MARK:m,CHAR_FORWARD_SLASH:E,CHAR_LEFT_CURLY_BRACE:R,CHAR_LEFT_PARENTHESES:_,CHAR_LEFT_SQUARE_BRACKET:k,CHAR_PLUS:H,CHAR_QUESTION_MARK:F,CHAR_RIGHT_CURLY_BRACE:Q,CHAR_RIGHT_PARENTHESES:he,CHAR_RIGHT_SQUARE_BRACKET:be}=B(1006),j=L=>L===E||L===q,Z=L=>{L.isPrefix!==!0&&(L.depth=L.isGlobstar?1/0:1)},X=(L,z)=>{const ee=z||{},ae=L.length-1,ie=ee.parts===!0||ee.scanToEnd===!0,ce=[],ge=[],Te=[];let Be=L,He=-1,ye=0,Je=0,ot=!1,We=!1,De=!1,Ge=!1,at=!1,je=!1,Y=!1,ht=!1,st=!1,ct=!1,fe=0,pe,qe,Qe={value:"",depth:0,isGlob:!1};const _t=()=>He>=ae,vr=()=>Be.charCodeAt(He+1),kt=()=>(pe=qe,Be.charCodeAt(++He));for(;He<ae;){qe=kt();let Xe;if(qe===q){Y=Qe.backslashes=!0,qe=kt(),qe===R&&(je=!0);continue}if(je===!0||qe===R){for(fe++;_t()!==!0&&(qe=kt());){if(qe===q){Y=Qe.backslashes=!0,kt();continue}if(qe===R){fe++;continue}if(je!==!0&&qe===P&&(qe=kt())===P){if(ot=Qe.isBrace=!0,De=Qe.isGlob=!0,ct=!0,ie===!0)continue;break}if(je!==!0&&qe===W){if(ot=Qe.isBrace=!0,De=Qe.isGlob=!0,ct=!0,ie===!0)continue;break}if(qe===Q&&(fe--,fe===0)){je=!1,ot=Qe.isBrace=!0,ct=!0;break}}if(ie===!0)continue;break}if(qe===E){if(ce.push(He),ge.push(Qe),Qe={value:"",depth:0,isGlob:!1},ct===!0)continue;if(pe===P&&He===ye+1){ye+=2;continue}Je=He+1;continue}if(ee.noext!==!0&&(qe===H||qe===$||qe===N||qe===F||qe===m)===!0&&vr()===_){if(De=Qe.isGlob=!0,Ge=Qe.isExtglob=!0,ct=!0,qe===m&&He===ye&&(st=!0),ie===!0){for(;_t()!==!0&&(qe=kt());){if(qe===q){Y=Qe.backslashes=!0,qe=kt();continue}if(qe===he){De=Qe.isGlob=!0,ct=!0;break}}continue}break}if(qe===N){if(pe===N&&(at=Qe.isGlobstar=!0),De=Qe.isGlob=!0,ct=!0,ie===!0)continue;break}if(qe===F){if(De=Qe.isGlob=!0,ct=!0,ie===!0)continue;break}if(qe===k){for(;_t()!==!0&&(Xe=kt());){if(Xe===q){Y=Qe.backslashes=!0,kt();continue}if(Xe===be){We=Qe.isBracket=!0,De=Qe.isGlob=!0,ct=!0;break}}if(ie===!0)continue;break}if(ee.nonegate!==!0&&qe===m&&He===ye){ht=Qe.negated=!0,ye++;continue}if(ee.noparen!==!0&&qe===_){if(De=Qe.isGlob=!0,ie===!0){for(;_t()!==!0&&(qe=kt());){if(qe===_){Y=Qe.backslashes=!0,qe=kt();continue}if(qe===he){ct=!0;break}}continue}break}if(De===!0){if(ct=!0,ie===!0)continue;break}}ee.noext===!0&&(Ge=!1,De=!1);let It=Be,zr="",Fr="";ye>0&&(zr=Be.slice(0,ye),Be=Be.slice(ye),Je-=ye),It&&De===!0&&Je>0?(It=Be.slice(0,Je),Fr=Be.slice(Je)):De===!0?(It="",Fr=Be):It=Be,It&&It!==""&&It!=="/"&&It!==Be&&j(It.charCodeAt(It.length-1))&&(It=It.slice(0,-1)),ee.unescape===!0&&(Fr&&(Fr=A.removeBackslashes(Fr)),It&&Y===!0&&(It=A.removeBackslashes(It)));const tr={prefix:zr,input:L,start:ye,base:It,glob:Fr,isBrace:ot,isBracket:We,isGlob:De,isExtglob:Ge,isGlobstar:at,negated:ht,negatedExtglob:st};if(ee.tokens===!0&&(tr.maxDepth=0,j(qe)||ge.push(Qe),tr.tokens=ge),ee.parts===!0||ee.tokens===!0){let Xe;for(let Ot=0;Ot<ce.length;Ot++){const ji=Xe?Xe+1:ye,Me=ce[Ot],mt=L.slice(ji,Me);ee.tokens&&(Ot===0&&ye!==0?(ge[Ot].isPrefix=!0,ge[Ot].value=zr):ge[Ot].value=mt,Z(ge[Ot]),tr.maxDepth+=ge[Ot].depth),(Ot!==0||mt!=="")&&Te.push(mt),Xe=Me}if(Xe&&Xe+1<L.length){const Ot=L.slice(Xe+1);Te.push(Ot),ee.tokens&&(ge[ge.length-1].value=Ot,Z(ge[ge.length-1]),tr.maxDepth+=ge[ge.length-1].depth)}tr.slashes=ce,tr.parts=Te}return tr};d.exports=X},8702:(d,C,B)=>{"use strict";var A=B(4155);const N=B(6470),$=A.platform==="win32",{REGEX_BACKSLASH:q,REGEX_REMOVE_BACKSLASH:W,REGEX_SPECIAL_CHARS:P,REGEX_SPECIAL_CHARS_GLOBAL:m}=B(1006);C.isObject=E=>E!==null&&typeof E=="object"&&!Array.isArray(E),C.hasRegexChars=E=>P.test(E),C.isRegexChar=E=>E.length===1&&C.hasRegexChars(E),C.escapeRegex=E=>E.replace(m,"\\$1"),C.toPosixSlashes=E=>E.replace(q,"/"),C.removeBackslashes=E=>E.replace(W,R=>R==="\\"?"":R),C.supportsLookbehinds=()=>{const E=A.version.slice(1).split(".").map(Number);return E.length===3&&E[0]>=9||E[0]===8&&E[1]>=10},C.isWindows=E=>E&&typeof E.windows=="boolean"?E.windows:$===!0||N.sep==="\\",C.escapeLast=(E,R,_)=>{const k=E.lastIndexOf(R,_);return k===-1?E:E[k-1]==="\\"?C.escapeLast(E,R,k-1):`${E.slice(0,k)}\\${E.slice(k)}`},C.removePrefix=(E,R={})=>{let _=E;return _.startsWith("./")&&(_=_.slice(2),R.prefix="./"),_},C.wrapOutput=(E,R={},_={})=>{const k=_.contains?"":"^",H=_.contains?"":"$";let F=`${k}(?:${E})${H}`;return R.negated===!0&&(F=`(?:^(?!${F}).*$)`),F}},4155:d=>{var C=d.exports={},B,A;function N(){throw new Error("setTimeout has not been defined")}function $(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?B=setTimeout:B=N}catch(Q){B=N}try{typeof clearTimeout=="function"?A=clearTimeout:A=$}catch(Q){A=$}})();function q(Q){if(B===setTimeout)return setTimeout(Q,0);if((B===N||!B)&&setTimeout)return B=setTimeout,setTimeout(Q,0);try{return B(Q,0)}catch(he){try{return B.call(null,Q,0)}catch(be){return B.call(this,Q,0)}}}function W(Q){if(A===clearTimeout)return clearTimeout(Q);if((A===$||!A)&&clearTimeout)return A=clearTimeout,clearTimeout(Q);try{return A(Q)}catch(he){try{return A.call(null,Q)}catch(be){return A.call(this,Q)}}}var P=[],m=!1,E,R=-1;function _(){!m||!E||(m=!1,E.length?P=E.concat(P):R=-1,P.length&&k())}function k(){if(!m){var Q=q(_);m=!0;for(var he=P.length;he;){for(E=P,P=[];++R<he;)E&&E[R].run();R=-1,he=P.length}E=null,m=!1,W(Q)}}C.nextTick=function(Q){var he=new Array(arguments.length-1);if(arguments.length>1)for(var be=1;be<arguments.length;be++)he[be-1]=arguments[be];P.push(new H(Q,he)),P.length===1&&!m&&q(k)};function H(Q,he){this.fun=Q,this.array=he}H.prototype.run=function(){this.fun.apply(null,this.array)},C.title="browser",C.browser=!0,C.env={},C.argv=[],C.version="",C.versions={};function F(){}C.on=F,C.addListener=F,C.once=F,C.off=F,C.removeListener=F,C.removeAllListeners=F,C.emit=F,C.prependListener=F,C.prependOnceListener=F,C.listeners=function(Q){return[]},C.binding=function(Q){throw new Error("process.binding is not supported")},C.cwd=function(){return"/"},C.chdir=function(Q){throw new Error("process.chdir is not supported")},C.umask=function(){return 0}},842:(d,C,B)=>{"use strict";var A=B(8764).Buffer;Object.defineProperty(C,"__esModule",{value:!0}),C.AbstractTokenizer=void 0;const N=B(5167);class ${constructor(W){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=W||{}}async readToken(W,P=this.position){const m=A.alloc(W.len);if(await this.readBuffer(m,{position:P})<W.len)throw new N.EndOfStreamError;return W.get(m,0)}async peekToken(W,P=this.position){const m=A.alloc(W.len);if(await this.peekBuffer(m,{position:P})<W.len)throw new N.EndOfStreamError;return W.get(m,0)}async readNumber(W){if(await this.readBuffer(this.numBuffer,{length:W.len})<W.len)throw new N.EndOfStreamError;return W.get(this.numBuffer,0)}async peekNumber(W){if(await this.peekBuffer(this.numBuffer,{length:W.len})<W.len)throw new N.EndOfStreamError;return W.get(this.numBuffer,0)}async ignore(W){if(this.fileInfo.size!==void 0){const P=this.fileInfo.size-this.position;if(W>P)return this.position+=P,P}return this.position+=W,W}async close(){}normalizeOptions(W,P){if(P&&P.position!==void 0&&P.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return P?{mayBeLess:P.mayBeLess===!0,offset:P.offset?P.offset:0,length:P.length?P.length:W.length-(P.offset?P.offset:0),position:P.position?P.position:this.position}:{mayBeLess:!1,offset:0,length:W.length,position:this.position}}}C.AbstractTokenizer=$},1945:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BufferTokenizer=void 0;const A=B(5167),N=B(842);class $ extends N.AbstractTokenizer{constructor(W,P){super(P);this.uint8Array=W,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:W.length}async readBuffer(W,P){if(P&&P.position){if(P.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=P.position}const m=await this.peekBuffer(W,P);return this.position+=m,m}async peekBuffer(W,P){const m=this.normalizeOptions(W,P),E=Math.min(this.uint8Array.length-m.position,m.length);if(!m.mayBeLess&&E<m.length)throw new A.EndOfStreamError;return W.set(this.uint8Array.subarray(m.position,m.position+E),m.offset),E}async close(){}}C.BufferTokenizer=$},7859:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.fromFile=C.FileTokenizer=void 0;const A=B(842),N=B(5167),$=B(7209);class q extends A.AbstractTokenizer{constructor(m,E){super(E);this.fd=m}async readBuffer(m,E){const R=this.normalizeOptions(m,E);this.position=R.position;const _=await $.read(this.fd,m,R.offset,R.length,R.position);if(this.position+=_.bytesRead,_.bytesRead<R.length&&(!E||!E.mayBeLess))throw new N.EndOfStreamError;return _.bytesRead}async peekBuffer(m,E){const R=this.normalizeOptions(m,E),_=await $.read(this.fd,m,R.offset,R.length,R.position);if(!R.mayBeLess&&_.bytesRead<R.length)throw new N.EndOfStreamError;return _.bytesRead}async close(){return $.close(this.fd)}}C.FileTokenizer=q;async function W(P){const m=await $.stat(P);if(!m.isFile)throw new Error(`File not a file: ${P}`);const E=await $.open(P,"r");return new q(E,{path:P,size:m.size})}C.fromFile=W},7209:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.readFile=C.writeFileSync=C.writeFile=C.read=C.open=C.close=C.stat=C.createReadStream=C.pathExists=void 0;const A=B(4059);C.pathExists=A.existsSync,C.createReadStream=A.createReadStream;async function N(R){return new Promise((_,k)=>{A.stat(R,(H,F)=>{H?k(H):_(F)})})}C.stat=N;async function $(R){return new Promise((_,k)=>{A.close(R,H=>{H?k(H):_()})})}C.close=$;async function q(R,_){return new Promise((k,H)=>{A.open(R,_,(F,Q)=>{F?H(F):k(Q)})})}C.open=q;async function W(R,_,k,H,F){return new Promise((Q,he)=>{A.read(R,_,k,H,F,(be,j,Z)=>{be?he(be):Q({bytesRead:j,buffer:Z})})})}C.read=W;async function P(R,_){return new Promise((k,H)=>{A.writeFile(R,_,F=>{F?H(F):k()})})}C.writeFile=P;function m(R,_){A.writeFileSync(R,_)}C.writeFileSync=m;async function E(R){return new Promise((_,k)=>{A.readFile(R,(H,F)=>{H?k(H):_(F)})})}C.readFile=E},599:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.ReadStreamTokenizer=void 0;const A=B(842),N=B(5167),$=256e3;class q extends A.AbstractTokenizer{constructor(P,m){super(m);this.streamReader=new N.StreamReader(P)}async getFileInfo(){return this.fileInfo}async readBuffer(P,m){const E=this.normalizeOptions(P,m),R=E.position-this.position;if(R>0)return await this.ignore(R),this.readBuffer(P,m);if(R<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(E.length===0)return 0;const _=await this.streamReader.read(P,E.offset,E.length);if(this.position+=_,(!m||!m.mayBeLess)&&_<E.length)throw new N.EndOfStreamError;return _}async peekBuffer(P,m){const E=this.normalizeOptions(P,m);let R=0;if(E.position){const _=E.position-this.position;if(_>0){const k=new Uint8Array(E.length+_);return R=await this.peekBuffer(k,{mayBeLess:E.mayBeLess}),P.set(k.subarray(_),E.offset),R-_}else if(_<0)throw new Error("Cannot peek from a negative offset in a stream")}if(E.length>0){try{R=await this.streamReader.peek(P,E.offset,E.length)}catch(_){if(m&&m.mayBeLess&&_ instanceof N.EndOfStreamError)return 0;throw _}if(!E.mayBeLess&&R<E.length)throw new N.EndOfStreamError}return R}async ignore(P){const m=Math.min($,P),E=new Uint8Array(m);let R=0;for(;R<P;){const _=P-R,k=await this.readBuffer(E,{length:Math.min(m,_)});if(k<0)return k;R+=k}return R}}C.ReadStreamTokenizer=q},5849:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.fromBuffer=C.fromStream=C.EndOfStreamError=void 0;const A=B(599),N=B(1945);var $=B(5167);Object.defineProperty(C,"EndOfStreamError",{enumerable:!0,get:function(){return $.EndOfStreamError}});function q(P,m){return m=m||{},new A.ReadStreamTokenizer(P,m)}C.fromStream=q;function W(P,m){return new N.BufferTokenizer(P,m)}C.fromBuffer=W},6597:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.fromStream=C.fromBuffer=C.EndOfStreamError=C.fromFile=void 0;const A=B(7209),N=B(5849);var $=B(7859);Object.defineProperty(C,"fromFile",{enumerable:!0,get:function(){return $.fromFile}});var q=B(5849);Object.defineProperty(C,"EndOfStreamError",{enumerable:!0,get:function(){return q.EndOfStreamError}}),Object.defineProperty(C,"fromBuffer",{enumerable:!0,get:function(){return q.fromBuffer}});async function W(P,m){if(m=m||{},P.path){const E=await A.stat(P.path);m.path=P.path,m.size=E.size}return N.fromStream(P,m)}C.fromStream=W},5702:(d,C,B)=>{"use strict";/*!
 * to-regex-range <https://github.com/micromatch/to-regex-range>
 *
 * Copyright (c) 2015-present, Jon Schlinkert.
 * Released under the MIT License.
 */const A=B(9924),N=(j,Z,X)=>{if(A(j)===!1)throw new TypeError("toRegexRange: expected the first argument to be a number");if(Z===void 0||j===Z)return String(j);if(A(Z)===!1)throw new TypeError("toRegexRange: expected the second argument to be a number.");let L={relaxZeros:!0,...X};typeof L.strictZeros=="boolean"&&(L.relaxZeros=L.strictZeros===!1);let z=String(L.relaxZeros),ee=String(L.shorthand),ae=String(L.capture),ie=String(L.wrap),ce=j+":"+Z+"="+z+ee+ae+ie;if(N.cache.hasOwnProperty(ce))return N.cache[ce].result;let ge=Math.min(j,Z),Te=Math.max(j,Z);if(Math.abs(ge-Te)===1){let ot=j+"|"+Z;return L.capture?`(${ot})`:L.wrap===!1?ot:`(?:${ot})`}let Be=he(j)||he(Z),He={min:j,max:Z,a:ge,b:Te},ye=[],Je=[];if(Be&&(He.isPadded=Be,He.maxLen=String(He.max).length),ge<0){let ot=Te<0?Math.abs(Te):1;Je=P(ot,Math.abs(ge),He,L),ge=He.a=0}return Te>=0&&(ye=P(ge,Te,He,L)),He.negatives=Je,He.positives=ye,He.result=$(Je,ye,L),L.capture===!0?He.result=`(${He.result})`:L.wrap!==!1&&ye.length+Je.length>1&&(He.result=`(?:${He.result})`),N.cache[ce]=He,He.result};function $(j,Z,X){let L=m(j,Z,"-",!1,X)||[],z=m(Z,j,"",!1,X)||[],ee=m(j,Z,"-?",!0,X)||[];return L.concat(ee).concat(z).join("|")}function q(j,Z){let X=1,L=1,z=k(j,X),ee=new Set([Z]);for(;j<=z&&z<=Z;)ee.add(z),X+=1,z=k(j,X);for(z=H(Z+1,L)-1;j<z&&z<=Z;)ee.add(z),L+=1,z=H(Z+1,L)-1;return ee=[...ee],ee.sort(R),ee}function W(j,Z,X){if(j===Z)return{pattern:j,count:[],digits:0};let L=E(j,Z),z=L.length,ee="",ae=0;for(let ie=0;ie<z;ie++){let[ce,ge]=L[ie];ce===ge?ee+=ce:ce!=="0"||ge!=="9"?ee+=Q(ce,ge,X):ae++}return ae&&(ee+=X.shorthand===!0?"\\d":"[0-9]"),{pattern:ee,count:[ae],digits:z}}function P(j,Z,X,L){let z=q(j,Z),ee=[],ae=j,ie;for(let ce=0;ce<z.length;ce++){let ge=z[ce],Te=W(String(ae),String(ge),L),Be="";if(!X.isPadded&&ie&&ie.pattern===Te.pattern){ie.count.length>1&&ie.count.pop(),ie.count.push(Te.count[0]),ie.string=ie.pattern+F(ie.count),ae=ge+1;continue}X.isPadded&&(Be=be(ge,X,L)),Te.string=Be+Te.pattern+F(Te.count),ee.push(Te),ae=ge+1,ie=Te}return ee}function m(j,Z,X,L,z){let ee=[];for(let ae of j){let{string:ie}=ae;!L&&!_(Z,"string",ie)&&ee.push(X+ie),L&&_(Z,"string",ie)&&ee.push(X+ie)}return ee}function E(j,Z){let X=[];for(let L=0;L<j.length;L++)X.push([j[L],Z[L]]);return X}function R(j,Z){return j>Z?1:Z>j?-1:0}function _(j,Z,X){return j.some(L=>L[Z]===X)}function k(j,Z){return Number(String(j).slice(0,-Z)+"9".repeat(Z))}function H(j,Z){return j-j%Math.pow(10,Z)}function F(j){let[Z=0,X=""]=j;return X||Z>1?`{${Z+(X?","+X:"")}}`:""}function Q(j,Z,X){return`[${j}${Z-j==1?"":"-"}${Z}]`}function he(j){return/^-?(0+)\d/.test(j)}function be(j,Z,X){if(!Z.isPadded)return j;let L=Math.abs(Z.maxLen-String(j).length),z=X.relaxZeros!==!1;switch(L){case 0:return"";case 1:return z?"0?":"0";case 2:return z?"0{0,2}":"00";default:return z?`0{0,${L}}`:`0{${L}}`}}N.cache={},N.clearCache=()=>N.cache={},d.exports=N},3416:(d,C,B)=>{"use strict";var A=B(8764).Buffer;Object.defineProperty(C,"__esModule",{value:!0}),C.AnsiStringType=C.StringType=C.BufferType=C.Uint8ArrayType=C.IgnoreType=C.Float80_LE=C.Float80_BE=C.Float64_LE=C.Float64_BE=C.Float32_LE=C.Float32_BE=C.Float16_LE=C.Float16_BE=C.INT64_BE=C.UINT64_BE=C.INT64_LE=C.UINT64_LE=C.INT32_LE=C.INT32_BE=C.INT24_BE=C.INT24_LE=C.INT16_LE=C.INT16_BE=C.INT8=C.UINT32_BE=C.UINT32_LE=C.UINT24_BE=C.UINT24_LE=C.UINT16_BE=C.UINT16_LE=C.UINT8=void 0;const N=B(645);function $(R){return new DataView(R.buffer,R.byteOffset)}C.UINT8={len:1,get(R,_){return $(R).getUint8(_)},put(R,_,k){return $(R).setUint8(_,k),_+1}},C.UINT16_LE={len:2,get(R,_){return $(R).getUint16(_,!0)},put(R,_,k){return $(R).setUint16(_,k,!0),_+2}},C.UINT16_BE={len:2,get(R,_){return $(R).getUint16(_)},put(R,_,k){return $(R).setUint16(_,k),_+2}},C.UINT24_LE={len:3,get(R,_){const k=$(R);return k.getUint8(_)+(k.getUint16(_+1,!0)<<8)},put(R,_,k){const H=$(R);return H.setUint8(_,k&255),H.setUint16(_+1,k>>8,!0),_+3}},C.UINT24_BE={len:3,get(R,_){const k=$(R);return(k.getUint16(_)<<8)+k.getUint8(_+2)},put(R,_,k){const H=$(R);return H.setUint16(_,k>>8),H.setUint8(_+2,k&255),_+3}},C.UINT32_LE={len:4,get(R,_){return $(R).getUint32(_,!0)},put(R,_,k){return $(R).setUint32(_,k,!0),_+4}},C.UINT32_BE={len:4,get(R,_){return $(R).getUint32(_)},put(R,_,k){return $(R).setUint32(_,k),_+4}},C.INT8={len:1,get(R,_){return $(R).getInt8(_)},put(R,_,k){return $(R).setInt8(_,k),_+2}},C.INT16_BE={len:2,get(R,_){return $(R).getInt16(_)},put(R,_,k){return $(R).setInt16(_,k),_+2}},C.INT16_LE={len:2,get(R,_){return $(R).getInt16(_,!0)},put(R,_,k){return $(R).setInt16(_,k,!0),_+2}},C.INT24_LE={len:3,get(R,_){const k=C.UINT24_LE.get(R,_);return k>8388607?k-16777216:k},put(R,_,k){const H=$(R);return H.setUint8(_,k&255),H.setUint16(_+1,k>>8,!0),_+3}},C.INT24_BE={len:3,get(R,_){const k=C.UINT24_BE.get(R,_);return k>8388607?k-16777216:k},put(R,_,k){const H=$(R);return H.setUint16(_,k>>8),H.setUint8(_+2,k&255),_+3}},C.INT32_BE={len:4,get(R,_){return $(R).getInt32(_)},put(R,_,k){return $(R).setInt32(_,k),_+4}},C.INT32_LE={len:4,get(R,_){return $(R).getInt32(_,!0)},put(R,_,k){return $(R).setInt32(_,k,!0),_+4}},C.UINT64_LE={len:8,get(R,_){return $(R).getBigUint64(_,!0)},put(R,_,k){return $(R).setBigUint64(_,k,!0),_+8}},C.INT64_LE={len:8,get(R,_){return $(R).getBigInt64(_,!0)},put(R,_,k){return $(R).setBigInt64(_,k,!0),_+8}},C.UINT64_BE={len:8,get(R,_){return $(R).getBigUint64(_)},put(R,_,k){return $(R).setBigUint64(_,k),_+8}},C.INT64_BE={len:8,get(R,_){return $(R).getBigInt64(_)},put(R,_,k){return $(R).setBigInt64(_,k),_+8}},C.Float16_BE={len:2,get(R,_){return N.read(R,_,!1,10,this.len)},put(R,_,k){return N.write(R,k,_,!1,10,this.len),_+this.len}},C.Float16_LE={len:2,get(R,_){return N.read(R,_,!0,10,this.len)},put(R,_,k){return N.write(R,k,_,!0,10,this.len),_+this.len}},C.Float32_BE={len:4,get(R,_){return $(R).getFloat32(_)},put(R,_,k){return $(R).setFloat32(_,k),_+4}},C.Float32_LE={len:4,get(R,_){return $(R).getFloat32(_,!0)},put(R,_,k){return $(R).setFloat32(_,k,!0),_+4}},C.Float64_BE={len:8,get(R,_){return $(R).getFloat64(_)},put(R,_,k){return $(R).setFloat64(_,k),_+8}},C.Float64_LE={len:8,get(R,_){return $(R).getFloat64(_,!0)},put(R,_,k){return $(R).setFloat64(_,k,!0),_+8}},C.Float80_BE={len:10,get(R,_){return N.read(R,_,!1,63,this.len)},put(R,_,k){return N.write(R,k,_,!1,63,this.len),_+this.len}},C.Float80_LE={len:10,get(R,_){return N.read(R,_,!0,63,this.len)},put(R,_,k){return N.write(R,k,_,!0,63,this.len),_+this.len}};class q{constructor(_){this.len=_}get(_,k){}}C.IgnoreType=q;class W{constructor(_){this.len=_}get(_,k){return _.subarray(k,k+this.len)}}C.Uint8ArrayType=W;class P{constructor(_){this.len=_}get(_,k){return _.slice(k,k+this.len)}}C.BufferType=P;class m{constructor(_,k){this.len=_,this.encoding=k}get(_,k){return A.from(_).toString(this.encoding,k,k+this.len)}}C.StringType=m;class E{constructor(_){this.len=_}static decode(_,k,H){let F="";for(let Q=k;Q<H;++Q)F+=E.codePointToString(E.singleByteDecoder(_[Q]));return F}static inRange(_,k,H){return k<=_&&_<=H}static codePointToString(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}static singleByteDecoder(_){if(E.inRange(_,0,127))return _;const k=E.windows1252[_-128];if(k===null)throw Error("invaliding encoding");return k}get(_,k=0){return E.decode(_,k,k+this.len)}}C.AnsiStringType=E,E.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]},5102:()=>{},189:function(d,C,B){"use strict";var A=this&&this.__spreadArrays||function(){for(var m=0,E=0,R=arguments.length;E<R;E++)m+=arguments[E].length;for(var _=Array(m),k=0,E=0;E<R;E++)for(var H=arguments[E],F=0,Q=H.length;F<Q;F++,k++)_[k]=H[F];return _};Object.defineProperty(C,"__esModule",{value:!0}),C.config=C.loadMessageBundle=void 0;var N=B(1926),$=B(800),q=B(800);Object.defineProperty(C,"MessageFormat",{enumerable:!0,get:function(){return q.MessageFormat}}),Object.defineProperty(C,"BundleFormat",{enumerable:!0,get:function(){return q.BundleFormat}});function W(m){return function(E,R){for(var _=[],k=2;k<arguments.length;k++)_[k-2]=arguments[k];if(typeof E=="number")throw new Error("Browser implementation does currently not support externalized strings.");return $.localize.apply(void 0,A([E,R],_))}}C.loadMessageBundle=W;function P(m){return $.setPseudo((m==null?void 0:m.locale.toLowerCase())==="pseudo"),W}C.config=P,N.default.install(Object.freeze({loadMessageBundle:W,config:P}))},800:(d,C,B)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.config=C.loadMessageBundle=C.localize=C.format=C.setPseudo=C.isPseudo=C.isDefined=C.BundleFormat=C.MessageFormat=void 0;var A=B(1926),N;(function(k){k.file="file",k.bundle="bundle",k.both="both"})(N=C.MessageFormat||(C.MessageFormat={}));var $;(function(k){k.standalone="standalone",k.languagePack="languagePack"})($=C.BundleFormat||(C.BundleFormat={}));var q;(function(k){function H(F){var Q=F;return Q&&W(Q.key)&&W(Q.comment)}k.is=H})(q||(q={}));function W(k){return typeof k!="undefined"}C.isDefined=W,C.isPseudo=!1;function P(k){C.isPseudo=k}C.setPseudo=P;function m(k,H){var F;return C.isPseudo&&(k="\uFF3B"+k.replace(/[aouei]/g,"$&$&")+"\uFF3D"),H.length===0?F=k:F=k.replace(/\{(\d+)\}/g,function(Q,he){var be=he[0],j=H[be],Z=Q;return typeof j=="string"?Z=j:(typeof j=="number"||typeof j=="boolean"||j===void 0||j===null)&&(Z=String(j)),Z}),F}C.format=m;function E(k,H){for(var F=[],Q=2;Q<arguments.length;Q++)F[Q-2]=arguments[Q];return m(H,F)}C.localize=E;function R(k){return A.default().loadMessageBundle(k)}C.loadMessageBundle=R;function _(k){return A.default().config(k)}C.config=_},1926:(d,C)=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});var B;function A(){if(B===void 0)throw new Error("No runtime abstraction layer installed");return B}(function(N){function $(q){if(q===void 0)throw new Error("No runtime abstraction layer provided");B=q}N.install=$})(A||(A={})),C.default=A},6822:(d,C,B)=>{"use strict";d.exports=B(189)},2479:d=>{d.exports=C;function C(B,A){if(B&&A)return C(B)(A);if(typeof B!="function")throw new TypeError("need wrapper function");return Object.keys(B).forEach(function($){N[$]=B[$]}),N;function N(){for(var $=new Array(arguments.length),q=0;q<$.length;q++)$[q]=arguments[q];var W=B.apply(this,$),P=$[$.length-1];return typeof W=="function"&&W!==P&&Object.keys(P).forEach(function(m){W[m]=P[m]}),W}}},1932:()=>{},7170:()=>{},4059:()=>{}},__webpack_module_cache__={};function __webpack_require__(d){var C=__webpack_module_cache__[d];if(C!==void 0)return C.exports;var B=__webpack_module_cache__[d]={exports:{}};return __webpack_modules__[d].call(B.exports,B,B.exports,__webpack_require__),B.exports}(()=>{__webpack_require__.n=d=>{var C=d&&d.__esModule?()=>d.default:()=>d;return __webpack_require__.d(C,{a:C}),C}})(),(()=>{__webpack_require__.d=(d,C)=>{for(var B in C)__webpack_require__.o(C,B)&&!__webpack_require__.o(d,B)&&Object.defineProperty(d,B,{enumerable:!0,get:C[B]})}})(),(()=>{__webpack_require__.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(d){if(typeof window=="object")return window}}()})(),(()=>{__webpack_require__.o=(d,C)=>Object.prototype.hasOwnProperty.call(d,C)})(),(()=>{__webpack_require__.r=d=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})}})();var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{StateKeys:()=>Io,activate:()=>QI,getOpenActionsService:()=>pu,getState:()=>Yy,isInsiders:()=>eb,updateState:()=>ep});const d=require("vscode");var C=__webpack_require__(189),B;(function(t){t.Off="off",t.Auto="auto",t.Always="always"})(B||(B={}));var A;(function(t){t.None="none",t.Latest="latest",t.Match="match",t.TipPlusLatest="tip+latest"})(A||(A={})),function(t){function e(r){return r===t.None||r===t.Latest||r===t.Match||r===t.TipPlusLatest?r:t.None}t.sanitize=e}(A||(A={}));var N;(function(t){t.Browse="browse",t.Edit="edit"})(N||(N={})),function(t){function e(n){return n===t.Browse||n===t.Edit?n:t.Edit}t.sanitize=e;function r(n){return n===t.Browse?t.Edit:t.Browse}t.toggle=r}(N||(N={}));var $;(function(t){function e(r,n){return r.display===n.display&&r.index===n.index}t.equals=e})($||($={}));var q;(function(t){t.Branch="branch",t.RemoteBranch="remoteBranch",t.PullRequestBranch="pullRequestBranch",t.PullRequestRemoteBranch="pullRequestRemoteBranch",t.Tag="tag",t.Commit="commit"})(q||(q={}));var W;(function(t){const e=new Map([[q.Branch,A.None],[q.RemoteBranch,A.None],[q.PullRequestBranch,A.Match],[q.PullRequestRemoteBranch,A.Match],[q.Commit,A.Match],[q.Tag,A.Match]]),r=new Map([[q.Branch,N.Edit],[q.RemoteBranch,N.Edit],[q.PullRequestBranch,N.Browse],[q.PullRequestRemoteBranch,N.Browse],[q.Commit,N.Browse],[q.Tag,N.Browse]]);function n(i){var o,a;return{display:(o=r.get(i))!=null?o:N.Edit,index:(a=e.get(i))!=null?a:A.None}}t.getDefault=n})(W||(W={}));const P=null;function m(){this.__data__=[],this.size=0}const E=m;function R(t,e){return t===e||t!==t&&e!==e}const _=R;function k(t,e){for(var r=t.length;r--;)if(_(t[r][0],e))return r;return-1}const H=k;var F=Array.prototype,Q=F.splice;function he(t){var e=this.__data__,r=H(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Q.call(e,r,1),--this.size,!0}const be=he;function j(t){var e=this.__data__,r=H(e,t);return r<0?void 0:e[r][1]}const Z=j;function X(t){return H(this.__data__,t)>-1}const L=X;function z(t,e){var r=this.__data__,n=H(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}const ee=z;function ae(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ae.prototype.clear=E,ae.prototype.delete=be,ae.prototype.get=Z,ae.prototype.has=L,ae.prototype.set=ee;const ie=ae;function ce(){this.__data__=new ie,this.size=0}const ge=ce;function Te(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}const Be=Te;function He(t){return this.__data__.get(t)}const ye=He;function Je(t){return this.__data__.has(t)}const ot=Je;var We=typeof global=="object"&&global&&global.Object===Object&&global;const De=We;var Ge=typeof self=="object"&&self&&self.Object===Object&&self,at=De||Ge||Function("return this")();const je=at;var Y=je.Symbol;const ht=Y;var st=Object.prototype,ct=st.hasOwnProperty,fe=st.toString,pe=ht?ht.toStringTag:void 0;function qe(t){var e=ct.call(t,pe),r=t[pe];try{t[pe]=void 0;var n=!0}catch(o){}var i=fe.call(t);return n&&(e?t[pe]=r:delete t[pe]),i}const Qe=qe;var _t=Object.prototype,vr=_t.toString;function kt(t){return vr.call(t)}const It=kt;var zr="[object Null]",Fr="[object Undefined]",tr=ht?ht.toStringTag:void 0;function Xe(t){return t==null?t===void 0?Fr:zr:tr&&tr in Object(t)?Qe(t):It(t)}const Ot=Xe;function ji(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}const Me=ji;var mt="[object AsyncFunction]",Ee="[object Function]",it="[object GeneratorFunction]",jt="[object Proxy]";function Ht(t){if(!Me(t))return!1;var e=Ot(t);return e==Ee||e==it||e==mt||e==jt}const Zt=Ht;var T=je["__core-js_shared__"];const g=T;var v=function(){var t=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function M(t){return!!v&&v in t}const V=M;var oe=Function.prototype,me=oe.toString;function ft(t){if(t!=null){try{return me.call(t)}catch(e){}try{return t+""}catch(e){}}return""}const Dt=ft;var qt=/[\\^$.*+?()[\]{}|]/g,Xt=/^\[object .+?Constructor\]$/,Ft=Function.prototype,rb=Object.prototype,nb=Ft.toString,ib=rb.hasOwnProperty,ob=RegExp("^"+nb.call(ib).replace(qt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ab(t){if(!Me(t)||V(t))return!1;var e=Zt(t)?ob:Xt;return e.test(Dt(t))}const sb=ab;function cb(t,e){return t==null?void 0:t[e]}const lb=cb;function ub(t,e){var r=lb(t,e);return sb(r)?r:void 0}const Do=ub;var db=Do(je,"Map");const Pa=db;var hb=Do(Object,"create");const Fa=hb;function fb(){this.__data__=Fa?Fa(null):{},this.size=0}const pb=fb;function gb(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}const mb=gb;var vb="__lodash_hash_undefined__",wb=Object.prototype,yb=wb.hasOwnProperty;function bb(t){var e=this.__data__;if(Fa){var r=e[t];return r===vb?void 0:r}return yb.call(e,t)?e[t]:void 0}const _b=bb;var xb=Object.prototype,Sb=xb.hasOwnProperty;function Cb(t){var e=this.__data__;return Fa?e[t]!==void 0:Sb.call(e,t)}const Eb=Cb;var Rb="__lodash_hash_undefined__";function Tb(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Fa&&e===void 0?Rb:e,this}const Ab=Tb;function Po(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Po.prototype.clear=pb,Po.prototype.delete=mb,Po.prototype.get=_b,Po.prototype.has=Eb,Po.prototype.set=Ab;const np=Po;function kb(){this.size=0,this.__data__={hash:new np,map:new(Pa||ie),string:new np}}const Ib=kb;function Db(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}const Pb=Db;function Fb(t,e){var r=t.__data__;return Pb(e)?r[typeof e=="string"?"string":"hash"]:r.map}const lc=Fb;function Nb(t){var e=lc(this,t).delete(t);return this.size-=e?1:0,e}const $b=Nb;function Mb(t){return lc(this,t).get(t)}const Bb=Mb;function Ob(t){return lc(this,t).has(t)}const Ub=Ob;function Lb(t,e){var r=lc(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}const Hb=Lb;function Fo(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Fo.prototype.clear=Ib,Fo.prototype.delete=$b,Fo.prototype.get=Bb,Fo.prototype.has=Ub,Fo.prototype.set=Hb;const ip=Fo;var qb=200;function Wb(t,e){var r=this.__data__;if(r instanceof ie){var n=r.__data__;if(!Pa||n.length<qb-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new ip(n)}return r.set(t,e),this.size=r.size,this}const zb=Wb;function No(t){var e=this.__data__=new ie(t);this.size=e.size}No.prototype.clear=ge,No.prototype.delete=Be,No.prototype.get=ye,No.prototype.has=ot,No.prototype.set=zb;const mu=No;var jb="__lodash_hash_undefined__";function Vb(t){return this.__data__.set(t,jb),this}const Gb=Vb;function Kb(t){return this.__data__.has(t)}const Zb=Kb;function uc(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new ip;++e<r;)this.add(t[e])}uc.prototype.add=uc.prototype.push=Gb,uc.prototype.has=Zb;const Xb=uc;function Qb(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}const Yb=Qb;function Jb(t,e){return t.has(e)}const e_=Jb;var t_=1,r_=2;function n_(t,e,r,n,i,o){var a=r&t_,s=t.length,c=e.length;if(s!=c&&!(a&&c>s))return!1;var l=o.get(t),u=o.get(e);if(l&&u)return l==e&&u==t;var h=-1,f=!0,p=r&r_?new Xb:void 0;for(o.set(t,e),o.set(e,t);++h<s;){var b=t[h],w=e[h];if(n)var y=a?n(w,b,h,e,t,o):n(b,w,h,t,e,o);if(y!==void 0){if(y)continue;f=!1;break}if(p){if(!Yb(e,function(x,S){if(!e_(p,S)&&(b===x||i(b,x,r,n,o)))return p.push(S)})){f=!1;break}}else if(!(b===w||i(b,w,r,n,o))){f=!1;break}}return o.delete(t),o.delete(e),f}const op=n_;var i_=je.Uint8Array;const ap=i_;function o_(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}const a_=o_;function s_(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}const c_=s_;var l_=1,u_=2,d_="[object Boolean]",h_="[object Date]",f_="[object Error]",p_="[object Map]",g_="[object Number]",m_="[object RegExp]",v_="[object Set]",w_="[object String]",y_="[object Symbol]",b_="[object ArrayBuffer]",__="[object DataView]",sp=ht?ht.prototype:void 0,vu=sp?sp.valueOf:void 0;function x_(t,e,r,n,i,o,a){switch(r){case __:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case b_:return!(t.byteLength!=e.byteLength||!o(new ap(t),new ap(e)));case d_:case h_:case g_:return _(+t,+e);case f_:return t.name==e.name&&t.message==e.message;case m_:case w_:return t==e+"";case p_:var s=a_;case v_:var c=n&l_;if(s||(s=c_),t.size!=e.size&&!c)return!1;var l=a.get(t);if(l)return l==e;n|=u_,a.set(t,e);var u=op(s(t),s(e),n,i,o,a);return a.delete(t),u;case y_:if(vu)return vu.call(t)==vu.call(e)}return!1}const S_=x_;function C_(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}const E_=C_;var R_=Array.isArray;const dc=R_;function T_(t,e,r){var n=e(t);return dc(t)?n:E_(n,r(t))}const A_=T_;function k_(t,e){for(var r=-1,n=t==null?0:t.length,i=0,o=[];++r<n;){var a=t[r];e(a,r,t)&&(o[i++]=a)}return o}const I_=k_;function D_(){return[]}const P_=D_;var F_=Object.prototype,N_=F_.propertyIsEnumerable,cp=Object.getOwnPropertySymbols,$_=cp?function(t){return t==null?[]:(t=Object(t),I_(cp(t),function(e){return N_.call(t,e)}))}:P_;const M_=$_;function B_(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}const O_=B_;function U_(t){return t!=null&&typeof t=="object"}const Na=U_;var L_="[object Arguments]";function H_(t){return Na(t)&&Ot(t)==L_}const lp=H_;var up=Object.prototype,q_=up.hasOwnProperty,W_=up.propertyIsEnumerable,z_=lp(function(){return arguments}())?lp:function(t){return Na(t)&&q_.call(t,"callee")&&!W_.call(t,"callee")};const j_=z_;function V_(){return!1}const G_=V_;var dp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,hp=dp&&typeof module=="object"&&module&&!module.nodeType&&module,K_=hp&&hp.exports===dp,fp=K_?je.Buffer:void 0,Z_=fp?fp.isBuffer:void 0,X_=Z_||G_;const wu=X_;var Q_=9007199254740991,Y_=/^(?:0|[1-9]\d*)$/;function J_(t,e){var r=typeof t;return e=e==null?Q_:e,!!e&&(r=="number"||r!="symbol"&&Y_.test(t))&&t>-1&&t%1==0&&t<e}const ex=J_;var tx=9007199254740991;function rx(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=tx}const pp=rx;var nx="[object Arguments]",ix="[object Array]",ox="[object Boolean]",ax="[object Date]",sx="[object Error]",cx="[object Function]",lx="[object Map]",ux="[object Number]",dx="[object Object]",hx="[object RegExp]",fx="[object Set]",px="[object String]",gx="[object WeakMap]",mx="[object ArrayBuffer]",vx="[object DataView]",wx="[object Float32Array]",yx="[object Float64Array]",bx="[object Int8Array]",_x="[object Int16Array]",xx="[object Int32Array]",Sx="[object Uint8Array]",Cx="[object Uint8ClampedArray]",Ex="[object Uint16Array]",Rx="[object Uint32Array]",Vt={};Vt[wx]=Vt[yx]=Vt[bx]=Vt[_x]=Vt[xx]=Vt[Sx]=Vt[Cx]=Vt[Ex]=Vt[Rx]=!0,Vt[nx]=Vt[ix]=Vt[mx]=Vt[ox]=Vt[vx]=Vt[ax]=Vt[sx]=Vt[cx]=Vt[lx]=Vt[ux]=Vt[dx]=Vt[hx]=Vt[fx]=Vt[px]=Vt[gx]=!1;function Tx(t){return Na(t)&&pp(t.length)&&!!Vt[Ot(t)]}const Ax=Tx;function kx(t){return function(e){return t(e)}}const Ix=kx;var gp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,$a=gp&&typeof module=="object"&&module&&!module.nodeType&&module,Dx=$a&&$a.exports===gp,yu=Dx&&De.process,Px=function(){try{var t=$a&&$a.require&&$a.require("util").types;return t||yu&&yu.binding&&yu.binding("util")}catch(e){}}();const mp=Px;var vp=mp&&mp.isTypedArray,Fx=vp?Ix(vp):Ax;const wp=Fx;var Nx=Object.prototype,$x=Nx.hasOwnProperty;function Mx(t,e){var r=dc(t),n=!r&&j_(t),i=!r&&!n&&wu(t),o=!r&&!n&&!i&&wp(t),a=r||n||i||o,s=a?O_(t.length,String):[],c=s.length;for(var l in t)(e||$x.call(t,l))&&!(a&&(l=="length"||i&&(l=="offset"||l=="parent")||o&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ex(l,c)))&&s.push(l);return s}const Bx=Mx;var Ox=Object.prototype;function Ux(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Ox;return t===r}const Lx=Ux;function Hx(t,e){return function(r){return t(e(r))}}var qx=Hx(Object.keys,Object);const Wx=qx;var zx=Object.prototype,jx=zx.hasOwnProperty;function Vx(t){if(!Lx(t))return Wx(t);var e=[];for(var r in Object(t))jx.call(t,r)&&r!="constructor"&&e.push(r);return e}const Gx=Vx;function Kx(t){return t!=null&&pp(t.length)&&!Zt(t)}const Zx=Kx;function Xx(t){return Zx(t)?Bx(t):Gx(t)}const Qx=Xx;function Yx(t){return A_(t,Qx,M_)}const yp=Yx;var Jx=1,eS=Object.prototype,tS=eS.hasOwnProperty;function rS(t,e,r,n,i,o){var a=r&Jx,s=yp(t),c=s.length,l=yp(e),u=l.length;if(c!=u&&!a)return!1;for(var h=c;h--;){var f=s[h];if(!(a?f in e:tS.call(e,f)))return!1}var p=o.get(t),b=o.get(e);if(p&&b)return p==e&&b==t;var w=!0;o.set(t,e),o.set(e,t);for(var y=a;++h<c;){f=s[h];var x=t[f],S=e[f];if(n)var I=a?n(S,x,f,e,t,o):n(x,S,f,t,e,o);if(!(I===void 0?x===S||i(x,S,r,n,o):I)){w=!1;break}y||(y=f=="constructor")}if(w&&!y){var D=t.constructor,U=e.constructor;D!=U&&"constructor"in t&&"constructor"in e&&!(typeof D=="function"&&D instanceof D&&typeof U=="function"&&U instanceof U)&&(w=!1)}return o.delete(t),o.delete(e),w}const nS=rS;var iS=Do(je,"DataView");const bu=iS;var oS=Do(je,"Promise");const _u=oS;var aS=Do(je,"Set");const xu=aS;var sS=Do(je,"WeakMap");const Su=sS;var bp="[object Map]",cS="[object Object]",_p="[object Promise]",xp="[object Set]",Sp="[object WeakMap]",Cp="[object DataView]",lS=Dt(bu),uS=Dt(Pa),dS=Dt(_u),hS=Dt(xu),fS=Dt(Su),Vi=Ot;(bu&&Vi(new bu(new ArrayBuffer(1)))!=Cp||Pa&&Vi(new Pa)!=bp||_u&&Vi(_u.resolve())!=_p||xu&&Vi(new xu)!=xp||Su&&Vi(new Su)!=Sp)&&(Vi=function(t){var e=Ot(t),r=e==cS?t.constructor:void 0,n=r?Dt(r):"";if(n)switch(n){case lS:return Cp;case uS:return bp;case dS:return _p;case hS:return xp;case fS:return Sp}return e});const Ep=Vi;var pS=1,Rp="[object Arguments]",Tp="[object Array]",hc="[object Object]",gS=Object.prototype,Ap=gS.hasOwnProperty;function mS(t,e,r,n,i,o){var a=dc(t),s=dc(e),c=a?Tp:Ep(t),l=s?Tp:Ep(e);c=c==Rp?hc:c,l=l==Rp?hc:l;var u=c==hc,h=l==hc,f=c==l;if(f&&wu(t)){if(!wu(e))return!1;a=!0,u=!1}if(f&&!u)return o||(o=new mu),a||wp(t)?op(t,e,r,n,i,o):S_(t,e,c,r,n,i,o);if(!(r&pS)){var p=u&&Ap.call(t,"__wrapped__"),b=h&&Ap.call(e,"__wrapped__");if(p||b){var w=p?t.value():t,y=b?e.value():e;return o||(o=new mu),i(w,y,r,n,o)}}return f?(o||(o=new mu),nS(t,e,r,n,i,o)):!1}const vS=mS;function kp(t,e,r,n,i){return t===e?!0:t==null||e==null||!Na(t)&&!Na(e)?t!==t&&e!==e:vS(t,e,r,n,kp,i)}const wS=kp;function yS(t,e){return wS(t,e)}const bS=yS,Vn="remoteHub",Cu="modes",Ip="indexMemento";class Dp{constructor(){this._onDidChange=new d.EventEmitter,this._onDidChangeAny=new d.EventEmitter,this.memoryState=new Map}static configure(e){Ye.state=e.workspaceState,e.subscriptions.push(d.workspace.onDidChangeConfiguration(Ye.onConfigurationChanged,Ye))}get onDidChange(){return this._onDidChange.event}get onDidChangeAny(){return this._onDidChangeAny.event}onConfigurationChanged(e){if(!e.affectsConfiguration(Vn)){this._onDidChangeAny.fire(e);return}this._onDidChangeAny.fire(e),this._onDidChange.fire(e)}set state(e){if(this._state=e,this.modes=this._state.get(Cu),this.modes===void 0&&(this.modes=Object.create(null)),this.memoryState.size!==0){for(const r of this.memoryState.entries())this.modes[r[0]]=r[1];this._state.update(Cu,this.modes).then(()=>{this.memoryState.clear()},void 0)}this.indexMemento=this._state.get(Ip),this.indexMemento===void 0&&(this.indexMemento=Object.create(null))}get(e,r,n){return n===void 0?d.workspace.getConfiguration(e===void 0?void 0:Vn,r).get(e===void 0?Vn:e):d.workspace.getConfiguration(e===void 0?void 0:Vn,r).get(e===void 0?Vn:e,n)}getMode(e,r,n){const i=e.toString(),o=this.modes!==void 0?this.modes[i]:void 0;if(o!==void 0)return{display:N.sanitize(o.display),index:A.sanitize(o.index)};if(this.memoryState.get(i),!n)return W.getDefault(r)}setMode(e,r){return this._state===void 0||this.modes===void 0?(this.memoryState.set(e.toString(),r),Promise.resolve()):(this.modes[e.toString()]=r,this._state.update(Cu,this.modes))}getIndexMemento(e){if(this.indexMemento!==void 0)return this.indexMemento[e.toString()]}setIndexMemento(e,r){return this.indexMemento===void 0||this._state===void 0?Promise.resolve():(this.indexMemento[e.toString()]=r,this._state.update(Ip,this.indexMemento))}getAny(e,r,n){return n===void 0?d.workspace.getConfiguration(void 0,r).get(e):d.workspace.getConfiguration(void 0,r).get(e,n)}changed(e,r,n){var i;return(i=e==null?void 0:e.affectsConfiguration(`${Vn}.${r}`,n))!=null?i:!0}inspect(e,r){return d.workspace.getConfiguration(e===void 0?void 0:Vn,r).inspect(e===void 0?Vn:e)}inspectAny(e,r){return d.workspace.getConfiguration(void 0,r).inspect(e)}async migrate(e,r,n){const i=Ye.inspect(e);if(i===void 0)return!1;let o=!1;return i.globalValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.globalValue):i.globalValue,d.ConfigurationTarget.Global),o=!0),i.workspaceValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceValue):i.workspaceValue,d.ConfigurationTarget.Workspace),o=!0),i.workspaceFolderValue!==void 0&&(await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceFolderValue):i.workspaceFolderValue,d.ConfigurationTarget.WorkspaceFolder),o=!0),!o&&n.fallbackValue!==void 0&&(await this.update(r,n.fallbackValue,d.ConfigurationTarget.Global),o=!0),o}async migrateIfMissing(e,r,n){const i=Ye.inspect(e);if(i===void 0)return;const o=Ye.inspect(r);i.globalValue!==void 0&&(o===void 0||o.globalValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.globalValue):i.globalValue,d.ConfigurationTarget.Global),i.workspaceValue!==void 0&&(o===void 0||o.workspaceValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceValue):i.workspaceValue,d.ConfigurationTarget.Workspace),i.workspaceFolderValue!==void 0&&(o===void 0||o.workspaceFolderValue===void 0)&&await this.update(r,n.migrationFn!=null?n.migrationFn(i.workspaceFolderValue):i.workspaceFolderValue,d.ConfigurationTarget.WorkspaceFolder)}name(e){return e}update(e,r,n){return d.workspace.getConfiguration(Vn).update(e,r,n)}updateAny(e,r,n,i){return d.workspace.getConfiguration(void 0,n===d.ConfigurationTarget.Global?void 0:i).update(e,r,n)}updateEffective(e,r){const n=Ye.inspect(e);return n.workspaceFolderValue!==void 0?r===n.workspaceFolderValue?Promise.resolve(void 0):Ye.update(e,r,d.ConfigurationTarget.WorkspaceFolder):n.workspaceValue!==void 0?r===n.workspaceValue?Promise.resolve(void 0):Ye.update(e,r,d.ConfigurationTarget.Workspace):n.globalValue===r||n.globalValue===void 0&&r===n.defaultValue?Promise.resolve(void 0):Ye.update(e,bS(r,n.defaultValue)?void 0:r,d.ConfigurationTarget.Global)}getUseNewCommitApi(){let e=this.get("experimental.useNewCommitApi");return e===null&&(e=eb()),e}}const Ye=new Dp,jr="";var Rt;(function(t){t.Off="off",t.Error="error",t.Warn="warn",t.Info="info",t.Debug="debug"})(Rt||(Rt={}));var Pp;(function(t){t[t.Off=0]="Off",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"})(Pp||(Pp={}));const _S="GitHub Repositories",fc="[RemoteHub]",Gi=class{static configure(t,e){this._isDebugging=t.extensionMode===d.ExtensionMode.Development,this.logLevel=e}static enabled(t){return this.level>=this.toOrderedLevel(t)}static get logLevel(){return this._logLevel}static set logLevel(t){var e,r;this._logLevel=t,this.level=this.toOrderedLevel(t),t===Rt.Off?((e=this.output)==null||e.dispose(),this.output=void 0):this.output=(r=this.output)!=null?r:d.window.createOutputChannel(_S)}static toOrderedLevel(t){switch(t){case Rt.Off:return 0;case Rt.Error:return 1;case Rt.Warn:return 2;case Rt.Info:return 3;case Rt.Debug:return 4}}static get isDebugging(){return this._isDebugging}static debug(t,...e){Gi.isDebugging&&console.log(this.timestamp,fc,t!=null?t:jr,...e),!(this.output===void 0||this.level<4)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:jr}${this.toLoggableParams(!0,e)}`)}static error(t,e,...r){if(!(this.level<1&&!Gi.isDebugging)){if(e===void 0){const n=t instanceof Error?t.stack:void 0;if(n){const i=/.*\s*?at\s(.+?)\s/.exec(n);i!==null&&(e=i[1])}}Gi.isDebugging&&console.error(this.timestamp,fc,e!=null?e:jr,...r,t),!(this.output===void 0||this.level<1)&&this.output.appendLine(`${this.timestamp} ${e!=null?e:jr}${this.toLoggableParams(!1,r)}
${String(t)}`)}}static log(t,...e){Gi.isDebugging&&console.log(this.timestamp,fc,t!=null?t:jr,...e),!(this.output===void 0||this.level<3)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:jr}${this.toLoggableParams(!1,e)}`)}static warn(t,...e){Gi.isDebugging&&console.warn(this.timestamp,fc,t!=null?t:jr,...e),!(this.output===void 0||this.level<2)&&this.output.appendLine(`${this.timestamp} ${t!=null?t:jr}${this.toLoggableParams(!1,e)}`)}static showOutputChannel(){var t;(t=this.output)==null||t.show()}static toLoggable(t,e){if(typeof t!="object")return String(t);if(t instanceof d.Uri)return`Uri(${t.toString(!0)})`;try{return JSON.stringify(t,e)}catch{return"<error>"}}static toLoggableName(t){var e,r,n;let i;if(typeof t=="function"){if(t.prototype===void 0||t.prototype.constructor===void 0)return t.name;i=(e=t.prototype.constructor.name)!=null?e:jr}else i=(n=(r=t.constructor)==null?void 0:r.name)!=null?n:jr;const o=i.indexOf("_");return o===-1?i:i.substr(o+1)}static get timestamp(){const t=new Date;return`[${t.toISOString().replace(/T/," ").replace(/\..+/,jr)}:${`00${t.getUTCMilliseconds()}`.slice(-3)}]`}static toLoggableParams(t,e){if(e.length===0||t&&this.level<4&&!Gi.isDebugging)return jr;const r=e.map(n=>this.toLoggable(n)).join(", ");return r.length!==0?` \u2014 ${r}`:jr}};let K=Gi;K.level=0,K._logLevel=Rt.Off;const Fp=47;function we(t){if(t===void 0)return;const e=t.path.endsWith("/");return!e&&!t.fragment?t.toString():t.with({path:e?t.path.slice(0,-1):t.path,fragment:""}).toString()}function Gn(t){if(t===void 0)return;const e=t.path.endsWith("/");return!e&&!t.query&&!t.fragment?t.toString():t.with({path:e?t.path.slice(0,-1):t.path,query:"",fragment:""}).toString()}function Eu(t,e){return`${(e==null?void 0:e.excludeScheme)?"":`${t.scheme}-`}${t.authority}${t.path.endsWith("/")?t.path.slice(0,-1):t.path}`}function Ur(t){const e=t.path;let r=0,n=-1,i=!0;for(let o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===Fp){if(!i){r=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":e.slice(r,n)}function iD(t){const e=t.path;if(e.length===1)return"/";let r,n=-1,i=!0;for(let o=e.length-1;o>=1;--o)if(r=e.charCodeAt(o),r===Fp){if(!i){n=o;break}}else i=!1;return n===-1?"/":e.slice(0,n)}function xS(t){const e=t.path.lastIndexOf("/");return e===-1?t.with({path:"/"}):t.with({path:t.path.substring(0,e)})}function Ma(t,e){const r=typeof e=="string"?e:e.path;return r.startsWith(t.path)?d.Uri.joinPath(t,r.substr(t.path.length)):d.Uri.joinPath(t,r)}function pc(t,e){return typeof e=="string"?(e.startsWith("/")||(e=`/${e}`),Kn(t,e)&&t.path.substr(e.length+(e.endsWith("/")?0:1)).split("/").length===1):Kn(t,e)&&t.path.substr(e.path.length+(e.path.endsWith("/")?0:1)).split("/").length===1}function Kn(t,e){return typeof e=="string"?(e.startsWith("/")||(e=`/${e}`),e.length===1||t.path.startsWith(e.endsWith("/")?e:`${e}/`)):e.scheme===t.scheme&&e.authority===t.authority&&(e.path.length===1||t.path.startsWith(e.path.endsWith("/")?e.path:`${e.path}/`))}function gc(t){return t&&typeof t=="object"&&"scheme"in t}const Ru=class{constructor(t){this.storageService=t,this._onDidChange=new d.EventEmitter,this.cache=new Map}get onDidChange(){return this._onDidChange.event}async delete(t){const e=we(t),r=this.cache.has(e);this.cache.delete(e);try{await this.storageService.delete(this.getStorageKey(e))}catch(n){throw K.error(n,`Failed to delete repository metadata for ${e}`),n}!r||setTimeout(()=>this._onDidChange.fire({uri:t}),0)}async get(t){this.assertMatchingScheme(t);const e=we(t),r=this.cache.get(e);if(r!==void 0)return r;let n;try{n=this.fromStorage(await this.storageService.get(this.getStorageKey(e)))}catch(i){throw K.error(i,`Failed to get repository metadata for ${e}`),i}return n?this.cache.set(e,{revision:n}):this.cache.delete(e),{revision:n}}async set(t,e,r,n){this.assertMatchingScheme(t);const i=(await this.get(t)).revision!==e?"revision":void 0,o=we(t);if(r!==void 0&&!this.validate(r))throw new Error(`Metadata validation failed for ${t.toString()}`);const a={revision:e,cachedMetadata:r};this.cache.set(o,a);try{await this.storageService.store(this.getStorageKey(o),this.toStorage(e))}catch(s){throw this.cache.delete(o),K.error(s,`Failed to save repository metadata for ${o}`),s}(n==null?void 0:n.silent)||setTimeout(()=>this._onDidChange.fire({uri:t,reason:i}),0)}refresh(){this.cache.clear()}validate(t){var e,r,n,i,o,a,s,c;return typeof t.version=="number"&&t.version>=Ru.schemaVersion&&typeof t.timestamp=="number"&&typeof((e=t.provider)==null?void 0:e.id)=="string"&&typeof t.provider.name=="string"&&typeof t.name=="string"&&t.repo&&typeof t.user=="string"&&typeof t.accessLevel=="number"&&typeof((r=t.HEAD)==null?void 0:r.type)=="number"&&typeof((n=t.HEAD)==null?void 0:n.name)=="string"&&typeof((i=t.HEAD)==null?void 0:i.sha)=="string"&&(typeof((o=t.HEAD.detached)==null?void 0:o.name)=="string"&&typeof((a=t.HEAD.detached)==null?void 0:a.type)=="number"||typeof((s=t.HEAD.branch)==null?void 0:s.name)=="string")&&typeof((c=t.defaultBranch)==null?void 0:c.name)=="string"&&typeof t.defaultBranch.sha=="string"}assertMatchingScheme(t){if(t.scheme!==Pt.scheme)throw new Error(`Uri scheme '${t.scheme}' must match configured scheme '${Pt.scheme}'; uri=${t.toString()}`)}getStorageKey(t){return`metadata/${t}`}fromStorage(t){if(!t)return;const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&gc(n)?d.Uri.from(n):n);return e==null?void 0:e.revision}toStorage(t){const e={schemaVersion:Ru.storageSchemaVersion,revision:t};return JSON.stringify(e)}};let Ba=Ru;Ba.schemaVersion=6,Ba.storageSchemaVersion=1;var $t;(function(t){t[t.Admin=100]="Admin",t[t.Maintain=40]="Maintain",t[t.WriteToPullRequest=31]="WriteToPullRequest",t[t.Write=30]="Write",t[t.Triage=20]="Triage",t[t.Read=10]="Read",t[t.None=0]="None"})($t||($t={}));var Le;(function(t){t[t.Branch=0]="Branch",t[t.RemoteBranch=1]="RemoteBranch",t[t.Tag=2]="Tag",t[t.Commit=3]="Commit"})(Le||(Le={}));class _n extends Error{constructor(e,r){super(typeof e=="string"?e:e.message);this.reauthenticate=r;var n;this.original=typeof e!="string"?e:void 0,(n=Error.captureStackTrace)==null||n.call(Error,this,_n)}}class mc extends Error{constructor(e,r,n){super(e.message);this.original=e,this.name=r,this.id=n;var i;(i=Error.captureStackTrace)==null||i.call(Error,this,mc)}}class Oa extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,Oa)}}class Ua extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,Ua)}}class vc extends Error{constructor(e,r){super(e.message);this.original=e,this.name=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,vc)}}class Ki extends Error{constructor(e){super(e);var r;(r=Error.captureStackTrace)==null||r.call(Error,this,Ki)}}class La extends Error{constructor(e,r){super(e.message);this.original=e,this.duplicate=r;var n;(n=Error.captureStackTrace)==null||n.call(Error,this,La)}}class Ha extends Error{constructor(e){super(e.message);this.original=e;var r;(r=Error.captureStackTrace)==null||r.call(Error,this,Ha)}}class $o extends Error{constructor(e){super(e);var r;(r=Error.captureStackTrace)==null||r.call(Error,this,$o)}}class Zi extends Error{constructor(e=!1){super(e?"Unable to sync the repository":"Unable to fetch the repository");var r;(r=Error.captureStackTrace)==null||r.call(Error,this,Zi)}}class qa extends Error{constructor(){super("Sync operation will result in conflicts");var e;(e=Error.captureStackTrace)==null||e.call(Error,this,qa)}}class wc extends Error{constructor(){super("Failed to create and push commit");var e;(e=Error.captureStackTrace)==null||e.call(Error,this,wc)}}class yi extends Error{constructor(e){var r;const n=typeof e=="string"?e:Pt.getProviderId(e);super(`No provider registered with ${n}`);this.id=n,(r=Error.captureStackTrace)==null||r.call(Error,this,yi)}}const SS=/^[0-9a-f]{40}$/i;function Zn(t){return t!==void 0&&SS.test(t)}const CS=/^[^/](?!.*\/\.)(?!.*\.\.)(?!.*\/\/)(?!.*@\{)[^\000-\037\177 ~^:?*[\\]+[^./]$/;function ES(t){return CS.test(t)}function pr(t){return t===""||t==="~"||t==="HEAD"?t:t.endsWith("^")?`${t.substr(0,7)}^`:t.substr(0,7)}var Ue;(function(t){t[t.Branch=0]="Branch",t[t.Tag=1]="Tag",t[t.Commit=2]="Commit",t[t.PullRequest=3]="PullRequest",t[t.Tree=4]="Tree"})(Ue||(Ue={}));var wr;(function(t){t.GitHub="github",t.AzureRepos="azurerepos"})(wr||(wr={}));class RS{constructor(e,r,n,i,o){this.providerService=e,this.uri=r,this.id=n,this.name=i,this.provider={id:o.id,name:o.name}}get canonicalUri(){return this.providerService.getVirtualCanonicalRootUri(this.uri)}createRelativeUri(e){return this.providerService.createRelativeUri(this.uri,e)}async getMetadata(){const e=await this.providerService.getMetadata(this.uri);if(!e)throw new Error(`Unable to find metadata for ${this.uri.toString()}`);return e}async getIndexMetadata(){return this.providerService.getIndexMetadata(this.uri)}getUriMetadata(){return this.providerService.getVirtualUriMetadata(this.uri)}}var Vr;(function(t){t[t.Repository=0]="Repository",t[t.PullRequest=1]="PullRequest",t[t.Branch=2]="Branch",t[t.Commit=3]="Commit",t[t.File=4]="File"})(Vr||(Vr={}));var Gr;(function(t){t[t.Clone=-1]="Clone",t[t.Repository=0]="Repository",t[t.PullRequest=1]="PullRequest",t[t.Branch=2]="Branch",t[t.Commit=3]="Commit",t[t.Tag=4]="Tag"})(Gr||(Gr={}));var bi;(function(t){t[t.Open=0]="Open",t[t.Closed=1]="Closed",t[t.Merged=2]="Merged"})(bi||(bi={}));var xt;(function(t){t[t.NotIndexed=0]="NotIndexed",t[t.Indexed=1]="Indexed",t[t.Match=2]="Match",t[t.Active=3]="Active"})(xt||(xt={})),function(t){function e(r){return r!==void 0&&(r===t.Indexed||r===t.Match||r===t.Active)}t.hasIndex=e}(xt||(xt={}));var yc;(function(t){function e(r){return r!==void 0&&r.type===3}t.isActive=e})(yc||(yc={}));var Kr;(function(t){t[t.Latest=1]="Latest",t[t.SHA=2]="SHA"})(Kr||(Kr={}));var Xi;(function(t){function e(r){const n=Pt.decodeAuthority(r).metadata;if(!(n===void 0||n.idx===void 0)){if(n.idx==="latest")return{type:1};if(Zn(n.idx))return{type:2,sha:n.idx}}}t.decode=e})(Xi||(Xi={}));function*Np(t,e){for(const r of t)yield*e(r)}function*TS(t,e){for(const r of t)e(r)&&(yield r)}function*bc(t,e){for(const r of t){const n=e(r);n!=null&&(yield n)}}function AS(t,e){for(const r of t)if(e(r))return r}function kS(t,e){let r="";const n=t[Symbol.iterator]();let i=n.next();if(i.done)return r;for(;;){const o=i.value.toString();if(i=n.next(),i.done){r+=o;break}r+=o,r+=e}return r}function*Wa(t,e){for(const r of t)yield e(r)}function oD(t,e){for(const r of t)if(e(r))return!0;return!1}function*IS(...t){for(const e of t)for(const r of e)yield r}function*DS(t){const e=new Set;for(const r of t)e.has(r)||(e.add(r),yield r)}const PS="";function FS(...t){if(t.length===1){const e=t[0];return e===void 0?PS:typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"||e instanceof Error?String(e):e instanceof d.Uri?e.toString():JSON.stringify(e)}return JSON.stringify(t)}function xn(t){return(e,r,n)=>{let i;if(typeof n.value=="function"?i=n.value:typeof n.get=="function"&&(i=n.get),i===void 0)throw new Error("Not supported");const o=`$serialize$${r}`;n.value=function(...a){const s=a.length===0?o:`${o}$${(t!=null?t:FS)(...a)}`;Object.prototype.hasOwnProperty.call(this,s)||Object.defineProperty(this,s,{configurable:!1,enumerable:!1,writable:!0,value:void 0});let c=this[s];const l=()=>i.apply(this,a);return c===void 0?c=l():c=c.then(l,l),this[s]=c,c}}}function za(t){const e=performance.now()*.001;let r=Math.floor(e),n=Math.floor(e%1*1e9);return t!==void 0&&(r=r-t[0],n=n-t[1],n<0&&(r--,n+=1e9)),[r,n]}let Tu=0;function NS(){return Tu===Number.MAX_SAFE_INTEGER&&(Tu=0),++Tu}const Qi=class{constructor(t,e,...r){this.context=t,this.instance=`[${NS().toString().padStart(5)}] `;var n,i,o,a,s,c;let l;if(typeof(e==null?void 0:e.log)=="boolean"?l=e.log?{}:void 0:l=(n=e==null?void 0:e.log)!=null?n:{},this.logLevel=(i=e==null?void 0:e.logLevel)!=null?i:Rt.Info,this.time=za(),l){if(!K.enabled(this.logLevel))return;r.length?_c(this.logLevel,`${this.instance}${(o=l.prefix)!=null?o:""}${t}${(a=l.message)!=null?a:""}`,...r):_c(this.logLevel,`${this.instance}${(s=l.prefix)!=null?s:""}${t}${(c=l.message)!=null?c:""}`)}}log(t){this.logCore(this.context,t,!1)}logStep(t,e){(!t||e)&&this.logCore(this.context,e,!1),this.step=t?{time:za(),label:t}:void 0}restart(t){this.logCore(this.context,t,!0),this.step=void 0,this.time=za()}stop(t){this.restart(t)}logCore(t,e,r){var n,i,o,a,s,c,l;if(!K.enabled(this.logLevel))return;let u="";if(this.step){const[b,w]=za(this.step.time),y=b*1e3+Math.floor(w/1e6);u=`${this.step.label?`${this.step.label} took `:""}${y} ms`}if(!r){_c(this.logLevel,`${this.instance}${(n=e==null?void 0:e.prefix)!=null?n:""}${t}${(i=e==null?void 0:e.message)!=null?i:""}${u?` ${u}`:""}${(o=e==null?void 0:e.suffix)!=null?o:""}`);return}const[h,f]=za(this.time),p=h*1e3+Math.floor(f/1e6);_c(p>500?Rt.Warn:this.logLevel,`${this.instance}${(a=e==null?void 0:e.prefix)!=null?a:""}${t}${(s=e==null?void 0:e.message)!=null?s:""}${(c=e==null?void 0:e.took)!=null?c:" took "}${p} ms${u?` (${u})`:""}${(l=e==null?void 0:e.suffix)!=null?l:""}`)}static start(t,e,...r){var n;(n=Qi.watches.get(t))==null||n.log(),Qi.watches.set(t,new Qi(t,e,...r))}static log(t,e){var r;(r=Qi.watches.get(t))==null||r.log(e)}static stop(t,e){var r;(r=Qi.watches.get(t))==null||r.stop(e),Qi.watches.delete(t)}};let $e=Qi;$e.watches=new Map;function _c(t,e,...r){switch(t){case Rt.Warn:K.warn(e,...r);break;case Rt.Info:K.log(e,...r);break;default:K.debug(e,...r);break}}const $S=new TextDecoder,MS=new TextEncoder;async function ja(t){const e=typeof t=="string"?MS.encode(t):t;let r;if(globalThis.crypto.subtle)r=await globalThis.crypto.subtle.digest({name:"sha-1"},e);else{const n=new Op;n.update(e),r=n.digest()}return globalThis.btoa(encodeURIComponent($S.decode(r)))}var $p;(function(t){t[t.BLOCK_SIZE=64]="BLOCK_SIZE"})($p||($p={}));function Au(t,e,r=32){const n=r-e,i=~((1<<n)-1);return(t<<e|(i&t)>>>n)>>>0}function Mp(t,e=0,r=t.byteLength,n=0){for(let i=0;i<r;i++)t[e+i]=n}const Bp=class{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(64+3),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._finished=!1}update(t){const e=this._buff;let r=this._buffLen,n=0;const i=t.byteLength;for(;n<i;){const o=Math.min(64-r,i-n);for(let a=0;a<o;a++)e[r++]=t[n++];r>=64&&(this._step(),r-=64,this._totalLen+=64)}this._buffLen=r}digest(){this._finished||(this._finished=!0,this._totalLen+=this._buffLen,this._wrapUp());const t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this._h0,!1),e.setUint32(4,this._h1,!1),e.setUint32(8,this._h2,!1),e.setUint32(12,this._h3,!1),e.setUint32(16,this._h4,!1),t}_wrapUp(){this._buff[this._buffLen++]=128,Mp(this._buff,this._buffLen),this._buffLen>56&&(this._step(),Mp(this._buff));const t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){const t=Bp._bigBlock32,e=this._buffDV;for(let u=0;u<64;u+=4)t.setUint32(u,e.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)t.setUint32(u,Au(t.getUint32(u-12,!1)^t.getUint32(u-32,!1)^t.getUint32(u-56,!1)^t.getUint32(u-64,!1),1),!1);let r=this._h0,n=this._h1,i=this._h2,o=this._h3,a=this._h4,s,c,l;for(let u=0;u<80;u++)u<20?(s=n&i|~n&o,c=1518500249):u<40?(s=n^i^o,c=1859775393):u<60?(s=n&i|n&o|i&o,c=2400959708):(s=n^i^o,c=3395469782),l=Au(r,5)+s+a+c+t.getUint32(u*4,!1)&4294967295,a=o,o=i,i=Au(n,30),n=r,r=l;this._h0=this._h0+r&4294967295,this._h1=this._h1+n&4294967295,this._h2=this._h2+i&4294967295,this._h3=this._h3+o&4294967295,this._h4=this._h4+a&4294967295}};let Op=Bp;Op._bigBlock32=new DataView(new ArrayBuffer(320));function BS(t){const e=globalThis.atob(t),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.charCodeAt(i);return n}const{fromCharCode:OS}=String;function xc(t){let e;if(typeof t=="string")e=t;else{e="";for(let r=0,{length:n}=t;r<n;r++)e+=OS(t[r])}return globalThis.btoa(e)}const US=new TextDecoder,LS=new TextEncoder,HS=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function ku(t){const e=LS.encode(t),r=new Array(e.length);for(let n=0;n<e.length;++n)r[n]=HS[e[n]];return r.join("")}function Up(t){const e=t.match(/(\w{2})/g);if(e===null)return"";const r=new Uint8Array(e.map(n=>parseInt(n,16)));return US.decode(r)}function qS(t,e){if(t===e)return-1;let r=0;for(;t[r]===e[r];)r++;return r}var aD=__webpack_require__(5102),WS=Object.defineProperty,zS=Object.getOwnPropertyDescriptor,jS=(t,e,r,n)=>{for(var i=n>1?void 0:n?zS(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&WS(e,r,i),i},Zr;(function(t){t[t.Abort=0]="Abort",t[t.KeepCurrent=1]="KeepCurrent",t[t.DiscardCurrent=2]="DiscardCurrent",t[t.Merge=3]="Merge"})(Zr||(Zr={}));const rr=class{constructor(t,e){this.metadataStore=t,this.telemetryService=e,this._providers=new Map,this._onDidChangeProviders=new d.EventEmitter,this._repositories=new Map,this._onDidChangeRepositories=new d.EventEmitter,this._onDidChangeRepository=new d.EventEmitter,this._onDidSyncRepository=new d.EventEmitter,this._onDidRefresh=new d.EventEmitter,this._onWillRefresh=new d.EventEmitter,this.pendingMetadataRequests=new Map,this.disposable=d.Disposable.from(d.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this),t.onDidChange(r=>this.onMetadataChanged(r)))}get onDidChangeProviders(){return this._onDidChangeProviders.event}get onDidChangeRepositories(){return this._onDidChangeRepositories.event}get onDidChangeRepository(){return this._onDidChangeRepository.event}get onDidSyncRepository(){return this._onDidSyncRepository.event}get onDidRefresh(){return this._onDidRefresh.event}get onWillRefresh(){return this._onWillRefresh.event}dispose(){this.disposable.dispose(),this._providers.clear(),this._repositories.clear()}onMetadataChanged(t){const e=this._repositories.get(we(t.uri));!e||(K.log(`VirtualProviderService.onMetadataChanged(${t.uri.toString()}, reason=${t.reason}): Firing onDidChangeRepository...`),this._onDidChangeRepository.fire({repository:e,reason:t.reason==="revision"?"HEAD":void 0}))}onWorkspaceFoldersChanged(t){if(t.added.length)for(const e of t.added){const r=we(e.uri);if(e.uri.scheme!==rr.scheme||this._repositories.has(r))continue;const n=this.getProvider(e.uri);if(!n)continue;this._repositories.set(r,null);const{repo:i,name:o}=this.getVirtualUriMetadata(e.uri),a=new RS(this,e.uri,i,o,n);this._repositories.set(r,a),this._onDidChangeRepositories.fire({added:[a],removed:[]}),this.telemetryService.sendEvent("repository.opened",{provider:n.id,repositories:this._repositories.size.toString()})}if(t.removed.length)for(const e of t.removed){const r=we(e.uri);if(e.uri.scheme!==rr.scheme||!this._repositories.has(r))continue;const n=this._repositories.get(r);this._repositories.delete(r),n&&(this._onDidChangeRepositories.fire({added:[],removed:[n]}),this.telemetryService.sendEvent("repository.closed",{repositories:this._repositories.size.toString()}))}ui(Nn.HasVirtualFolders,this._repositories.size!==0),ui(Nn.VirtualFolderProviders,kS(DS(Wa(this.getRepositories(),e=>e.provider.id)),","))}get hasProviders(){return this._providers.size!==0}get registeredProviders(){return[...Wa(this._providers.values(),t=>({id:t.id,name:t.name}))]}get repositories(){return[...this.getRepositories()]}register(t,e,r,n,i){var o;if(this._providers.has(t))throw new Error(`Provider '${t}' has already been registered`);const a={id:t,name:e,provider:r,fs:n,index:i};return this._providers.set(t,a),this._onDidChangeProviders.fire({added:[a],removed:[]}),this.telemetryService.sendEvent("provider.registered",{provider:t}),this.onWorkspaceFoldersChanged({added:(o=d.workspace.workspaceFolders)!=null?o:[],removed:[]}),{dispose:()=>{this._providers.delete(t);const s=[];for(const[c,l]of[...this._repositories])(l==null?void 0:l.provider.id)===t&&(this._repositories.delete(c),s.push(l));this._onDidChangeRepositories.fire({added:[],removed:s}),this._onDidChangeProviders.fire({added:[],removed:[a]})}}}refresh(){if(this._providers.size===0)return;const t=[],e=[];for(const r of this._providers.values())t.push(...Wa(this.getRepositories(r.id),n=>n.uri)),r.index!==void 0&&e.push(r.index);this._onWillRefresh.fire(t),this.metadataStore.refresh(),e.forEach(r=>r.refresh(t)),this._onDidRefresh.fire(t)}getRegisteredProvider(t){const e=this.getProvider(t);return e?{id:e.id,name:e.name}:void 0}getRepository(t,e){const r=d.workspace.getWorkspaceFolder(t);if(!r||r.uri.scheme!==rr.scheme)return;const n=this._repositories.get(we(r.uri));if(!(e!==void 0&&(n==null?void 0:n.provider.id)!==e))return n!=null?n:void 0}getRepositories(t){return TS(this._repositories.values(),e=>e!==null&&(!t||e.provider.id===t))}getOpenUris(t,e){const r=new Map,n=d.workspace.textDocuments;if(n.length===0)return r;for(const i of n)i.uri.scheme===t&&e.some(o=>Kn(i.uri,o))&&r.set(we(i.uri),i.uri);return r}hasProvider(t,e){const r=typeof t=="string"?t:rr.getProviderId(t),n=this._providers.get(r);return e!==void 0&&(n==null?void 0:n.id)!==e?!1:n!==void 0}isReadonly(t){var e;return Boolean((e=this.getProvider(t))==null?void 0:e.provider.isReadonly)}getProvider(t){const e=typeof t=="string"?t:rr.getProviderId(t);return this._providers.get(e)}getRepositoryProvider(t){var e;const r=(e=this.getProvider(t))==null?void 0:e.provider;if(r)return r;throw new yi(t)}getFileSystemProvider(t){var e;const r=(e=this.getProvider(t))==null?void 0:e.fs;if(r)return r;throw new yi(t)}getRemoteWorkspaceSourceProviders(t){var e,r,n,i;return t?(i=(n=(e=this.getProvider(t))==null?void 0:(r=e.provider).getRemoteWorkspaceSourceProviders)==null?void 0:n.call(r))!=null?i:[]:[...Np(this._providers.values(),o=>{var a,s,c;return(c=(s=(a=o.provider).getRemoteWorkspaceSourceProviders)==null?void 0:s.call(a))!=null?c:[]})]}isInWorkspace(t){return this.getVirtualWorkspaceUri(t)!==void 0}getAuthentication(t){const e=this.getProvider(t);if(!e)throw new yi(t);return e==null?void 0:e.provider.getAuthentication(t)}canOpenRemoteUrl(t,e){if(e){const r=this.getProvider(e),n=r==null?void 0:r.provider.canOpenRemoteUrl(t);return n!==void 0?{provider:r,urlType:n}:void 0}for(const r of this._providers.values()){const n=r.provider.canOpenRemoteUrl(t);if(n!==void 0)return{provider:r,urlType:n}}}async createWorkspaceForRemoteUrl(t,e,r=At.CurrentWindow){var n;const i=this.canOpenRemoteUrl(t,e);return(n=i==null?void 0:i.provider)==null?void 0:n.provider.createWorkspaceForRemoteUrl(t,r)}createProviderUri(t,e,r){return this.getProviderUri(this.getRepositoryProvider(t).createVirtualUri(rr.baseVirtualWorkspaceUri,e,r))}createRelativeProviderUri(t,e){return this.getProviderUri(this.createRelativeUri(t,e))}createRelativeUri(t,e){const r=this.getProviderRootUri(t);let n=`${r.path}/`;n.endsWith("/")&&(n=n.slice(0,-1));const i=r.with({path:`${r.path}/${e.startsWith("/")?e.substr(1):e}`});return t.scheme===rr.scheme?this.getVirtualUri(i):i}createRelativeVirtualUri(t,e){return this.getVirtualUri(this.createRelativeUri(t,e))}createVirtualUri(t,e,r){return this.getRepositoryProvider(t).createVirtualUri(rr.baseVirtualWorkspaceUri,e,r)}async getBestRemoteUri(t,e){const{provider:r,repo:n,ref:i}=this.getVirtualUriMetadata(t);if(e===Gr.Repository)return this.getRemoteUri(r.id,{repo:n});if(e===Gr.Clone)return this.getRemoteUri(r.id,{repo:n,clone:!0});if(e===Gr.PullRequest||e===void 0&&(i==null?void 0:i.type)===Ue.PullRequest){if((i==null?void 0:i.type)===Ue.PullRequest)return this.getRemoteUri(r.id,{repo:n,pullRequest:{id:i.id}});const{pullRequest:o}=await this.getMetadata(t);if(e===Gr.PullRequest&&o)return this.getRemoteUri(r.id,{repo:n,pullRequest:{id:o.id}})}if(e===Gr.Branch||e===void 0&&(i==null?void 0:i.type)===Ue.Branch){if((i==null?void 0:i.type)===Ue.Branch)return this.getRemoteUri(r.id,{repo:n,branch:i.id});const{HEAD:o}=await this.getMetadata(t);if(o.type===Le.Branch||o.type===Le.RemoteBranch&&e===Gr.Branch)return this.getRemoteUri(r.id,{repo:n,branch:o.branch.name})}if(e===Gr.Tag||e===void 0&&(i==null?void 0:i.type)===Ue.Tag){if((i==null?void 0:i.type)===Ue.Tag)return this.getRemoteUri(r.id,{repo:n,tag:i.id});const{HEAD:o}=await this.getMetadata(t);if(o.type===Le.Tag)return this.getRemoteUri(r.id,{repo:n,tag:o.detached.name})}if(e===Gr.Commit||e===void 0&&((i==null?void 0:i.type)===Ue.Commit||(i==null?void 0:i.type)===Ue.Tree&&Zn(i.id))){if((i==null?void 0:i.type)===Ue.Commit||(i==null?void 0:i.type)===Ue.Tree&&Zn(i.id))return this.getRemoteUri(r.id,{repo:n,sha:i.id});const{HEAD:o}=await this.getMetadata(t);if(e===Gr.Commit||o.type===Le.Commit)return this.getRemoteUri(r.id,{repo:n,sha:o.sha})}if(e===void 0)return this.getRemoteUri(r.id,{repo:n})}getCanonicalUri(t){let{authority:e}=t;const r=e.indexOf(rr.authoritySeparator);return r!==-1&&(e=e.substr(0,r)),t.with({authority:e})}getRemoteUri(t,e){var r,n;return(n=(r=this.getRepositoryProvider(t)).getRemoteUri)==null?void 0:n.call(r,e)}getProviderUri(t){return t.scheme!==rr.scheme?t:t.with({scheme:rr.getProviderId(t)})}getProviderRootUri(t){return t=this.getProviderUri(t),this.getRepositoryProvider(t).getProviderRootUri(t)}getRelativeFilePath(t,e){return e=this.getProviderUri(e!=null?e:t),this.getRepositoryProvider(e).getRelativeFilePath(t,e)}getVirtualUriMetadata(t){return this.getRepositoryProvider(t).getVirtualUriMetadata(t)}getVirtualUri(t){return t.scheme===rr.scheme?t:t.with({scheme:rr.scheme})}getVirtualCanonicalRootUri(t){const e=this.getVirtualUri(this.getProviderRootUri(t));let{authority:r}=e;const n=r.indexOf(rr.authoritySeparator);return n!==-1&&(r=r.substr(0,n)),e.with({authority:r})}getVirtualRootUri(t){return this.getVirtualUri(this.getProviderRootUri(t))}getVirtualWorkspaceUri(t){var e;return(e=d.workspace.getWorkspaceFolder(this.getVirtualUri(t)))==null?void 0:e.uri}createIGitRepository(t,e,r,n){var i,o;return(o=(i=this.getRepositoryProvider(t)).createIGitRepository)==null?void 0:o.call(i,t,e,r,n)}async getCommitOperations(t,e,r){let n;return(r==null?void 0:r.staged)?(n=await e.getStagedChanges(t),n.length===0&&r.staged==="auto"&&(n=await e.getChanges(t))):n=await e.getChanges(t),n.map(o=>{const a=this.getRelativeFilePath(t,o.uri);switch(o.type){case rt.Created:return{type:o.type,path:a,fileType:o.fileType,content:e.readFile(o.uri).then(s=>s!=null?s:new Uint8Array)};case rt.Changed:return{type:o.type,path:a,fileType:o.fileType,content:e.readFile(o.uri).then(s=>s!=null?s:new Uint8Array)};case rt.Deleted:return{type:o.type,path:a,fileType:o.fileType,content:void 0}}})}async getMetadata(t){return{...await this.getMetadataCore(this.getVirtualRootUri(t)),path:this.getRelativeFilePath(t,t)}}async getIndexMetadata(t){const e=this.getProvider(t);return(e==null?void 0:e.index)?e.index.getIndexMetadata(t):void 0}getModeConfig(t,e,r){return Ye.getMode(this.getVirtualRootUri(t),e,Boolean(r))}async getModeRefType(t,e){return t=this.getVirtualRootUri(t),this.getRepositoryProvider(t).getModeRefType(t,e)}getIndexProvider(t){var e;return(e=this.getProvider(t))==null?void 0:e.index}async getMetadataCore(t){const e=we(t);let r=this.pendingMetadataRequests.get(e);if(r)return r;let{revision:n,cachedMetadata:i}=await this.metadataStore.get(t);if(i!==void 0)return i;const o=this.getProvider(t);if(!o)throw new yi(t);const a=Xi.decode(t);(a==null?void 0:a.type)===Kr.SHA&&(n=a.sha),r=o.provider.createMetadata(t,n),this.pendingMetadataRequests.set(e,r);try{const s=await r;return await this.updateMetadataCore(t,s,{silent:!0}),s}finally{this.pendingMetadataRequests.delete(e)}}async updateMetadata(t,e){const r=new $e(`VirtualProviderService.updateMetadata(${t.toString()})`,{},e.HEAD.sha);try{await this.metadataStore.set(this.getVirtualUri(t),e.HEAD.sha,e)}finally{r.stop()}}updateMetadataCore(t,e,r){return this.metadataStore.set(this.getVirtualUri(t),e.HEAD.sha,e,r)}async clone(t){const e=await this.getBestRemoteUri(t,Gr.Clone);if(!e)throw new Error("No url found for clone");if(li)return void d.env.openExternal(d.Uri.parse(`${d.env.uriScheme}://vscode.git/clone?url=${encodeURIComponent(e.toString(!0))}`));try{const r=d.extensions.getExtension("vscode.git");if(r)await(r==null?void 0:r.activate()),await d.commands.executeCommand("git.clone",e.toString(!0));else throw new Error("Git extension not found")}catch(r){K.error(r,"Unable to clone repository")}}createBranch(t,e,r,n){return this.getRepositoryProvider(t).createBranch(t,e,r,n)}createCommit(t,e,r,n){return this.getRepositoryProvider(t).createCommit(t,e,r,n)}createAndPushCommit(t,e,r,n,i){return this.getRepositoryProvider(t).createAndPushCommit(t,e,r,n,i)}createPullRequest(t,e,r,n,i){return this.getRepositoryProvider(t).createPullRequest(t,e,r,n,i)}fetch(t,e){return this.getRepositoryProvider(t).fetch(t,e)}fork(t){return this.getRepositoryProvider(t).fork(t)}getBranches(t,e){return this.getRepositoryProvider(t).getBranches(t,e)}getCommit(t,e){return this.getRepositoryProvider(t).getCommit(t,e)}getCommits(t,e){var r;return(r=this.getRepositoryProvider(t))==null?void 0:r.getCommits(t,e)}compareCommits(t,e){var r;return(r=this.getRepositoryProvider(t))==null?void 0:r.compareCommits(t,e)}getFileContent(t,e,r){return this.getRepositoryProvider(t).getFileContent(t,e,r)}getFork(t){return this.getRepositoryProvider(t).getFork(t)}async getIncomingChanges(t){var e,r,n;return(n=(r=(e=this.getRepositoryProvider(t)).getIncomingChanges)==null?void 0:r.call(e,t))!=null?n:[]}getPullRequest(t,e){return this.getRepositoryProvider(t).getPullRequest(t,e)}getTags(t,e){return this.getRepositoryProvider(t).getTags(t,e)}getSnapshots(t,e){var r,n;return(n=(r=this.getIndexProvider(t))==null?void 0:r.getSnapshots(t,e))!=null?n:Promise.resolve([])}async getTarGz(t){var e,r;return(r=(e=this.getRepositoryProvider(t)).getTarGz)==null?void 0:r.call(e,t)}pushCommit(t,e,r,n){return this.getRepositoryProvider(t).pushCommit(t,e,r,n)}switchTo(t,e,r){return this.getRepositoryProvider(t).switchTo(t,e,r)}async sync(t,e,r){const n=this._repositories.get(we(t));n&&this._onDidSyncRepository.fire({repository:n,syncing:!0});try{const i=this.getProvider(t);if(i===void 0)throw new yi(t);let{to:o,reason:a,...s}=r!=null?r:{};return o===void 0&&i.index&&(o=await i.index.resolveIndexRef(t,a==="user")),await i.provider.sync(t,e,{conflictResolution:0,...s,to:o})}finally{n&&this._onDidSyncRepository.fire({repository:n,syncing:!1})}}stat(t){return this.getFileSystemProvider(t).stat(t)}readDirectory(t){return this.getFileSystemProvider(t).readDirectory(t)}readFile(t){return this.getFileSystemProvider(t).readFile(t)}watch(t,e){return this.getFileSystemProvider(t).watch(t,e)}provideFileSearchResults(t,e,r){return this.getFileSystemProvider(e.folder).provideFileSearchResults(t,e,r)}provideTextSearchResults(t,e,r,n){return this.getFileSystemProvider(e.folder).provideTextSearchResults(t,e,r,n)}static decodeAuthority(t,e){const[r,n]=t.authority.split(rr.authoritySeparator);let i;if(n)try{const o=JSON.parse(Up(n));i=e?e(o):o}catch{}return{scheme:r,metadata:i}}static encodeAuthority(t,e){const r=e?`${rr.authoritySeparator}${ku(JSON.stringify(e))}`:"";return`${t}${r}`}static getProviderId(t){const{authority:e}=t,r=e.indexOf(rr.authoritySeparator);return r!==-1?e.substr(0,r):e}static isCanonicalUri(t){return t.authority.indexOf(rr.authoritySeparator)===-1}};let Pt=rr;Pt.scheme="vscode-vfs",Pt.authoritySeparator="+",Pt.baseVirtualWorkspaceUri=d.Uri.parse(`${rr.scheme}://`),jS([xn()],Pt.prototype,"getMetadataCore",1);function Xn(){}Xn.prototype={diff:function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n.callback;typeof n=="function"&&(i=n,n={}),this.options=n;var o=this;function a(w){return i?(setTimeout(function(){i(void 0,w)},0),!0):w}e=this.castInput(e),r=this.castInput(r),e=this.removeEmpty(this.tokenize(e)),r=this.removeEmpty(this.tokenize(r));var s=r.length,c=e.length,l=1,u=s+c,h=[{newPos:-1,components:[]}],f=this.extractCommon(h[0],r,e,0);if(h[0].newPos+1>=s&&f+1>=c)return a([{value:this.join(r),count:r.length}]);function p(){for(var w=-1*l;w<=l;w+=2){var y=void 0,x=h[w-1],S=h[w+1],I=(S?S.newPos:0)-w;x&&(h[w-1]=void 0);var D=x&&x.newPos+1<s,U=S&&0<=I&&I<c;if(!D&&!U){h[w]=void 0;continue}if(!D||U&&x.newPos<S.newPos?(y=GS(S),o.pushComponent(y.components,void 0,!0)):(y=x,y.newPos++,o.pushComponent(y.components,!0,void 0)),I=o.extractCommon(y,r,e,w),y.newPos+1>=s&&I+1>=c)return a(VS(o,y.components,r,e,o.useLongestToken));h[w]=y}l++}if(i)(function w(){setTimeout(function(){if(l>u)return i();p()||w()},0)})();else for(;l<=u;){var b=p();if(b)return b}},pushComponent:function(e,r,n){var i=e[e.length-1];i&&i.added===r&&i.removed===n?e[e.length-1]={count:i.count+1,added:r,removed:n}:e.push({count:1,added:r,removed:n})},extractCommon:function(e,r,n,i){for(var o=r.length,a=n.length,s=e.newPos,c=s-i,l=0;s+1<o&&c+1<a&&this.equals(r[s+1],n[c+1]);)s++,c++,l++;return l&&e.components.push({count:l}),e.newPos=s,c},equals:function(e,r){return this.options.comparator?this.options.comparator(e,r):e===r||this.options.ignoreCase&&e.toLowerCase()===r.toLowerCase()},removeEmpty:function(e){for(var r=[],n=0;n<e.length;n++)e[n]&&r.push(e[n]);return r},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function VS(t,e,r,n,i){for(var o=0,a=e.length,s=0,c=0;o<a;o++){var l=e[o];if(l.removed){if(l.value=t.join(n.slice(c,c+l.count)),c+=l.count,o&&e[o-1].added){var h=e[o-1];e[o-1]=e[o],e[o]=h}}else{if(!l.added&&i){var u=r.slice(s,s+l.count);u=u.map(function(p,b){var w=n[c+b];return w.length>p.length?w:p}),l.value=t.join(u)}else l.value=t.join(r.slice(s,s+l.count));s+=l.count,l.added||(c+=l.count)}}var f=e[a-1];return a>1&&typeof f.value=="string"&&(f.added||f.removed)&&t.equals("",f.value)&&(e[a-2].value+=f.value,e.pop()),e}function GS(t){return{newPos:t.newPos,components:t.components.slice(0)}}var KS=new Xn;function sD(t,e,r){return KS.diff(t,e,r)}function Lp(t,e){if(typeof t=="function")e.callback=t;else if(t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var Hp=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,qp=/\S/,Sc=new Xn;Sc.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!qp.test(t)&&!qp.test(e)},Sc.tokenize=function(t){for(var e=t.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),r=0;r<e.length-1;r++)!e[r+1]&&e[r+2]&&Hp.test(e[r])&&Hp.test(e[r+2])&&(e[r]+=e[r+2],e.splice(r+1,2),r--);return e};function cD(t,e,r){return r=Lp(r,{ignoreWhitespace:!0}),Sc.diff(t,e,r)}function lD(t,e,r){return Sc.diff(t,e,r)}var Cc=new Xn;Cc.tokenize=function(t){var e=[],r=t.split(/(\n|\r\n)/);r[r.length-1]||r.pop();for(var n=0;n<r.length;n++){var i=r[n];n%2&&!this.options.newlineIsToken?e[e.length-1]+=i:(this.options.ignoreWhitespace&&(i=i.trim()),e.push(i))}return e};function ZS(t,e,r){return Cc.diff(t,e,r)}function uD(t,e,r){var n=Lp(r,{ignoreWhitespace:!0});return Cc.diff(t,e,n)}var Wp=new Xn;Wp.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};function dD(t,e,r){return Wp.diff(t,e,r)}var zp=new Xn;zp.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function hD(t,e,r){return zp.diff(t,e,r)}function Ec(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ec=function(e){return typeof e}:Ec=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ec(t)}function Qn(t){return XS(t)||QS(t)||YS(t)||JS()}function XS(t){if(Array.isArray(t))return Iu(t)}function QS(t){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(t))return Array.from(t)}function YS(t,e){if(!!t){if(typeof t=="string")return Iu(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Iu(t,e)}}function Iu(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function JS(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var eC=Object.prototype.toString,Mo=new Xn;Mo.useLongestToken=!0,Mo.tokenize=Cc.tokenize,Mo.castInput=function(t){var e=this.options,r=e.undefinedReplacement,n=e.stringifyReplacer,i=n===void 0?function(o,a){return typeof a=="undefined"?r:a}:n;return typeof t=="string"?t:JSON.stringify(Du(t,null,null,i),i,"  ")},Mo.equals=function(t,e){return Xn.prototype.equals.call(Mo,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function fD(t,e,r){return Mo.diff(t,e,r)}function Du(t,e,r,n,i){e=e||[],r=r||[],n&&(t=n(i,t));var o;for(o=0;o<e.length;o+=1)if(e[o]===t)return r[o];var a;if(eC.call(t)==="[object Array]"){for(e.push(t),a=new Array(t.length),r.push(a),o=0;o<t.length;o+=1)a[o]=Du(t[o],e,r,n,i);return e.pop(),r.pop(),a}if(t&&t.toJSON&&(t=t.toJSON()),Ec(t)==="object"&&t!==null){e.push(t),a={},r.push(a);var s=[],c;for(c in t)t.hasOwnProperty(c)&&s.push(c);for(s.sort(),o=0;o<s.length;o+=1)c=s[o],a[c]=Du(t[c],e,r,n,c);e.pop(),r.pop()}else a=t;return a}var Rc=new Xn;Rc.tokenize=function(t){return t.slice()},Rc.join=Rc.removeEmpty=function(t){return t};function pD(t,e,r){return Rc.diff(t,e,r)}function Va(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.split(/\r\n|[\n\v\f\r\x85]/),n=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],i=[],o=0;function a(){var l={};for(i.push(l);o<r.length;){var u=r[o];if(/^(\-\-\-|\+\+\+|@@)\s/.test(u))break;var h=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(u);h&&(l.index=h[1]),o++}for(s(l),s(l),l.hunks=[];o<r.length;){var f=r[o];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(f))break;if(/^@@/.test(f))l.hunks.push(c());else{if(f&&e.strict)throw new Error("Unknown line "+(o+1)+" "+JSON.stringify(f));o++}}}function s(l){var u=/^(---|\+\+\+)\s+(.*)$/.exec(r[o]);if(u){var h=u[1]==="---"?"old":"new",f=u[2].split("	",2),p=f[0].replace(/\\\\/g,"\\");/^".*"$/.test(p)&&(p=p.substr(1,p.length-2)),l[h+"FileName"]=p,l[h+"Header"]=(f[1]||"").trim(),o++}}function c(){var l=o,u=r[o++],h=u.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),f={oldStart:+h[1],oldLines:typeof h[2]=="undefined"?1:+h[2],newStart:+h[3],newLines:typeof h[4]=="undefined"?1:+h[4],lines:[],linedelimiters:[]};f.oldLines===0&&(f.oldStart+=1),f.newLines===0&&(f.newStart+=1);for(var p=0,b=0;o<r.length&&!(r[o].indexOf("--- ")===0&&o+2<r.length&&r[o+1].indexOf("+++ ")===0&&r[o+2].indexOf("@@")===0);o++){var w=r[o].length==0&&o!=r.length-1?" ":r[o][0];if(w==="+"||w==="-"||w===" "||w==="\\")f.lines.push(r[o]),f.linedelimiters.push(n[o]||`
`),w==="+"?p++:w==="-"?b++:w===" "&&(p++,b++);else break}if(!p&&f.newLines===1&&(f.newLines=0),!b&&f.oldLines===1&&(f.oldLines=0),e.strict){if(p!==f.newLines)throw new Error("Added line count did not match for hunk at line "+(l+1));if(b!==f.oldLines)throw new Error("Removed line count did not match for hunk at line "+(l+1))}return f}for(;o<r.length;)a();return i}function tC(t,e,r){var n=!0,i=!1,o=!1,a=1;return function s(){if(n&&!o){if(i?a++:n=!1,t+a<=r)return a;o=!0}if(!i)return o||(n=!0),e<=t-a?-a++:(i=!0,s())}}function jp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string"&&(e=Va(e)),Array.isArray(e)){if(e.length>1)throw new Error("applyPatch only works with a single input.");e=e[0]}var n=t.split(/\r\n|[\n\v\f\r\x85]/),i=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],o=e.hunks,a=r.compareLine||function(Se,ke,Ae,ze){return ke===ze},s=0,c=r.fuzzFactor||0,l=0,u=0,h,f;function p(Se,ke){for(var Ae=0;Ae<Se.lines.length;Ae++){var ze=Se.lines[Ae],Ze=ze.length>0?ze[0]:" ",nt=ze.length>0?ze.substr(1):ze;if(Ze===" "||Ze==="-"){if(!a(ke+1,n[ke],Ze,nt)&&(s++,s>c))return!1;ke++}}return!0}for(var b=0;b<o.length;b++){for(var w=o[b],y=n.length-w.oldLines,x=0,S=u+w.oldStart-1,I=tC(S,l,y);x!==void 0;x=I())if(p(w,S+x)){w.offset=u+=x;break}if(x===void 0)return!1;l=w.offset+w.oldStart+w.oldLines}for(var D=0,U=0;U<o.length;U++){var te=o[U],J=te.oldStart+te.offset+D-1;D+=te.newLines-te.oldLines;for(var G=0;G<te.lines.length;G++){var ue=te.lines[G],re=ue.length>0?ue[0]:" ",se=ue.length>0?ue.substr(1):ue,xe=te.linedelimiters[G];if(re===" ")J++;else if(re==="-")n.splice(J,1),i.splice(J,1);else if(re==="+")n.splice(J,0,se),i.splice(J,0,xe),J++;else if(re==="\\"){var dt=te.lines[G-1]?te.lines[G-1][0]:null;dt==="+"?h=!0:dt==="-"&&(f=!0)}}}if(h)for(;!n[n.length-1];)n.pop(),i.pop();else f&&(n.push(""),i.push(`
`));for(var ne=0;ne<n.length-1;ne++)n[ne]=n[ne]+i[ne];return n.join("")}function gD(t,e){typeof t=="string"&&(t=Va(t));var r=0;function n(){var i=t[r++];if(!i)return e.complete();e.loadFile(i,function(o,a){if(o)return e.complete(o);var s=jp(a,i,e);e.patched(i,s,function(c){if(c)return e.complete(c);n()})})}n()}function Vp(t,e,r,n,i,o,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var s=ZS(r,n,a);s.push({value:"",lines:[]});function c(x){return x.map(function(S){return" "+S})}for(var l=[],u=0,h=0,f=[],p=1,b=1,w=function(S){var I=s[S],D=I.lines||I.value.replace(/\n$/,"").split(`
`);if(I.lines=D,I.added||I.removed){var U;if(!u){var te=s[S-1];u=p,h=b,te&&(f=a.context>0?c(te.lines.slice(-a.context)):[],u-=f.length,h-=f.length)}(U=f).push.apply(U,Qn(D.map(function(ne){return(I.added?"+":"-")+ne}))),I.added?b+=D.length:p+=D.length}else{if(u)if(D.length<=a.context*2&&S<s.length-2){var J;(J=f).push.apply(J,Qn(c(D)))}else{var G,ue=Math.min(D.length,a.context);(G=f).push.apply(G,Qn(c(D.slice(0,ue))));var re={oldStart:u,oldLines:p-u+ue,newStart:h,newLines:b-h+ue,lines:f};if(S>=s.length-2&&D.length<=a.context){var se=/\n$/.test(r),xe=/\n$/.test(n),dt=D.length==0&&f.length>re.oldLines;!se&&dt&&r.length>0&&f.splice(re.oldLines,0,"\\ No newline at end of file"),(!se&&!dt||!xe)&&f.push("\\ No newline at end of file")}l.push(re),u=0,h=0,f=[]}p+=D.length,b+=D.length}},y=0;y<s.length;y++)w(y);return{oldFileName:t,newFileName:e,oldHeader:i,newHeader:o,hunks:l}}function rC(t){var e=[];t.oldFileName==t.newFileName&&e.push("Index: "+t.oldFileName),e.push("==================================================================="),e.push("--- "+t.oldFileName+(typeof t.oldHeader=="undefined"?"":"	"+t.oldHeader)),e.push("+++ "+t.newFileName+(typeof t.newHeader=="undefined"?"":"	"+t.newHeader));for(var r=0;r<t.hunks.length;r++){var n=t.hunks[r];n.oldLines===0&&(n.oldStart-=1),n.newLines===0&&(n.newStart-=1),e.push("@@ -"+n.oldStart+","+n.oldLines+" +"+n.newStart+","+n.newLines+" @@"),e.push.apply(e,n.lines)}return e.join(`
`)+`
`}function nC(t,e,r,n,i,o,a){return rC(Vp(t,e,r,n,i,o,a))}function Pu(t,e,r,n,i,o){return nC(t,t,e,r,n,i,o)}function iC(t,e){return t.length!==e.length?!1:Fu(t,e)}function Fu(t,e){if(e.length>t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function oC(t){var e=$u(t.lines),r=e.oldLines,n=e.newLines;r!==void 0?t.oldLines=r:delete t.oldLines,n!==void 0?t.newLines=n:delete t.newLines}function mD(t,e,r){t=Gp(t,r),e=Gp(e,r);var n={};(t.index||e.index)&&(n.index=t.index||e.index),(t.newFileName||e.newFileName)&&(Kp(t)?Kp(e)?(n.oldFileName=Tc(n,t.oldFileName,e.oldFileName),n.newFileName=Tc(n,t.newFileName,e.newFileName),n.oldHeader=Tc(n,t.oldHeader,e.oldHeader),n.newHeader=Tc(n,t.newHeader,e.newHeader)):(n.oldFileName=t.oldFileName,n.newFileName=t.newFileName,n.oldHeader=t.oldHeader,n.newHeader=t.newHeader):(n.oldFileName=e.oldFileName||t.oldFileName,n.newFileName=e.newFileName||t.newFileName,n.oldHeader=e.oldHeader||t.oldHeader,n.newHeader=e.newHeader||t.newHeader)),n.hunks=[];for(var i=0,o=0,a=0,s=0;i<t.hunks.length||o<e.hunks.length;){var c=t.hunks[i]||{oldStart:1/0},l=e.hunks[o]||{oldStart:1/0};if(Zp(c,l))n.hunks.push(Xp(c,a)),i++,s+=c.newLines-c.oldLines;else if(Zp(l,c))n.hunks.push(Xp(l,s)),o++,a+=l.newLines-l.oldLines;else{var u={oldStart:Math.min(c.oldStart,l.oldStart),oldLines:0,newStart:Math.min(c.newStart+a,l.oldStart+s),newLines:0,lines:[]};aC(u,c.oldStart,c.lines,l.oldStart,l.lines),o++,i++,n.hunks.push(u)}}return n}function Gp(t,e){if(typeof t=="string"){if(/^@@/m.test(t)||/^Index:/m.test(t))return Va(t)[0];if(!e)throw new Error("Must provide a base reference or pass in a patch");return Vp(void 0,void 0,e,t)}return t}function Kp(t){return t.newFileName&&t.newFileName!==t.oldFileName}function Tc(t,e,r){return e===r?e:(t.conflict=!0,{mine:e,theirs:r})}function Zp(t,e){return t.oldStart<e.oldStart&&t.oldStart+t.oldLines<e.oldStart}function Xp(t,e){return{oldStart:t.oldStart,oldLines:t.oldLines,newStart:t.newStart+e,newLines:t.newLines,lines:t.lines}}function aC(t,e,r,n,i){var o={offset:e,lines:r,index:0},a={offset:n,lines:i,index:0};for(Yp(t,o,a),Yp(t,a,o);o.index<o.lines.length&&a.index<a.lines.length;){var s=o.lines[o.index],c=a.lines[a.index];if((s[0]==="-"||s[0]==="+")&&(c[0]==="-"||c[0]==="+"))sC(t,o,a);else if(s[0]==="+"&&c[0]===" "){var l;(l=t.lines).push.apply(l,Qn(Yi(o)))}else if(c[0]==="+"&&s[0]===" "){var u;(u=t.lines).push.apply(u,Qn(Yi(a)))}else s[0]==="-"&&c[0]===" "?Qp(t,o,a):c[0]==="-"&&s[0]===" "?Qp(t,a,o,!0):s===c?(t.lines.push(s),o.index++,a.index++):Nu(t,Yi(o),Yi(a))}Jp(t,o),Jp(t,a),oC(t)}function sC(t,e,r){var n=Yi(e),i=Yi(r);if(eg(n)&&eg(i)){if(Fu(n,i)&&tg(r,n,n.length-i.length)){var o;(o=t.lines).push.apply(o,Qn(n));return}else if(Fu(i,n)&&tg(e,i,i.length-n.length)){var a;(a=t.lines).push.apply(a,Qn(i));return}}else if(iC(n,i)){var s;(s=t.lines).push.apply(s,Qn(n));return}Nu(t,n,i)}function Qp(t,e,r,n){var i=Yi(e),o=cC(r,i);if(o.merged){var a;(a=t.lines).push.apply(a,Qn(o.merged))}else Nu(t,n?o:i,n?i:o)}function Nu(t,e,r){t.conflict=!0,t.lines.push({conflict:!0,mine:e,theirs:r})}function Yp(t,e,r){for(;e.offset<r.offset&&e.index<e.lines.length;){var n=e.lines[e.index++];t.lines.push(n),e.offset++}}function Jp(t,e){for(;e.index<e.lines.length;){var r=e.lines[e.index++];t.lines.push(r)}}function Yi(t){for(var e=[],r=t.lines[t.index][0];t.index<t.lines.length;){var n=t.lines[t.index];if(r==="-"&&n[0]==="+"&&(r="+"),r===n[0])e.push(n),t.index++;else break}return e}function cC(t,e){for(var r=[],n=[],i=0,o=!1,a=!1;i<e.length&&t.index<t.lines.length;){var s=t.lines[t.index],c=e[i];if(c[0]==="+")break;if(o=o||s[0]!==" ",n.push(c),i++,s[0]==="+")for(a=!0;s[0]==="+";)r.push(s),s=t.lines[++t.index];c.substr(1)===s.substr(1)?(r.push(s),t.index++):a=!0}if((e[i]||"")[0]==="+"&&o&&(a=!0),a)return r;for(;i<e.length;)n.push(e[i++]);return{merged:n,changes:r}}function eg(t){return t.reduce(function(e,r){return e&&r[0]==="-"},!0)}function tg(t,e,r){for(var n=0;n<r;n++){var i=e[e.length-r+n].substr(1);if(t.lines[t.index+n]!==" "+i)return!1}return t.index+=r,!0}function $u(t){var e=0,r=0;return t.forEach(function(n){if(typeof n!="string"){var i=$u(n.mine),o=$u(n.theirs);e!==void 0&&(i.oldLines===o.oldLines?e+=i.oldLines:e=void 0),r!==void 0&&(i.newLines===o.newLines?r+=i.newLines:r=void 0)}else r!==void 0&&(n[0]==="+"||n[0]===" ")&&r++,e!==void 0&&(n[0]==="-"||n[0]===" ")&&e++}),{oldLines:e,newLines:r}}function vD(t){for(var e=[],r,n,i=0;i<t.length;i++)r=t[i],r.added?n=1:r.removed?n=-1:n=0,e.push([n,r.value]);return e}function wD(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];n.added?e.push("<ins>"):n.removed&&e.push("<del>"),e.push(lC(n.value)),n.added?e.push("</ins>"):n.removed&&e.push("</del>")}return e.join("")}function lC(t){var e=t;return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e}function Mu(t,e){let r={};for(let o=0;o<e.length;o++){const a=e[o];r[a]?r[a].push(o):r[a]=[o]}let i=[{buffer1index:-1,buffer2index:-1,chain:null}];for(let o=0;o<t.length;o++){const a=t[o],s=r[a]||[];let c=0,l=i[0];for(let u=0;u<s.length;u++){const h=s[u];let f;for(f=c;f<i.length&&!(i[f].buffer2index<h&&(f===i.length-1||i[f+1].buffer2index>h));f++);if(f<i.length){const p={buffer1index:o,buffer2index:h,chain:i[f]};if(c===i.length?i.push(l):i[c]=l,c=f+1,l=p,c===i.length)break}}i[c]=l}return i[i.length-1]}function uC(t,e){const r=Mu(t,e);let n=[],i=t.length,o=e.length,a={common:[]};function s(){a.common.length&&(a.common.reverse(),n.push(a),a={common:[]})}for(let c=r;c!==null;c=c.chain){let l={buffer1:[],buffer2:[]};for(;--i>c.buffer1index;)l.buffer1.push(t[i]);for(;--o>c.buffer2index;)l.buffer2.push(e[o]);(l.buffer1.length||l.buffer2.length)&&(s(),l.buffer1.reverse(),l.buffer2.reverse(),n.push(l)),i>=0&&a.common.push(t[i])}return s(),n.reverse(),n}function rg(t,e){const r=Mu(t,e);let n=[],i=t.length,o=e.length;for(let a=r;a!==null;a=a.chain){const s=i-a.buffer1index-1,c=o-a.buffer2index-1;i=a.buffer1index,o=a.buffer2index,(s||c)&&n.push({buffer1:[i+1,s],buffer1Content:t.slice(i+1,i+1+s),buffer2:[o+1,c],buffer2Content:e.slice(o+1,o+1+c)})}return n.reverse(),n}function yD(t,e){const r=Mu(t,e);let n=[],i=t.length,o=e.length;function a(s,c,l){let u=[];for(let h=0;h<l;h++)u.push(s[c+h]);return{offset:c,length:l,chunk:u}}for(let s=r;s!==null;s=s.chain){const c=i-s.buffer1index-1,l=o-s.buffer2index-1;i=s.buffer1index,o=s.buffer2index,(c||l)&&n.push({buffer1:a(t,s.buffer1index+1,c),buffer2:a(e,s.buffer2index+1,l)})}return n.reverse(),n}function dC(t,e,r){let n=[];function i(c,l){n.push({ab:l,oStart:c.buffer1[0],oLength:c.buffer1[1],abStart:c.buffer2[0],abLength:c.buffer2[1]})}rg(e,t).forEach(c=>i(c,"a")),rg(e,r).forEach(c=>i(c,"b")),n.sort((c,l)=>c.oStart-l.oStart);let o=[],a=0;function s(c){c>a&&(o.push({stable:!0,buffer:"o",bufferStart:a,bufferLength:c-a,bufferContent:e.slice(a,c)}),a=c)}for(;n.length;){let c=n.shift(),l=c.oStart,u=c.oStart+c.oLength,h=[c];for(s(l);n.length;){const f=n[0],p=f.oStart;if(p>u)break;u=Math.max(u,p+f.oLength),h.push(n.shift())}if(h.length===1){if(c.abLength>0){const f=c.ab==="a"?t:r;o.push({stable:!0,buffer:c.ab,bufferStart:c.abStart,bufferLength:c.abLength,bufferContent:f.slice(c.abStart,c.abStart+c.abLength)})}}else{let f={a:[t.length,-1,e.length,-1],b:[r.length,-1,e.length,-1]};for(;h.length;){c=h.shift();const S=c.oStart,I=S+c.oLength,D=c.abStart,U=D+c.abLength;let te=f[c.ab];te[0]=Math.min(D,te[0]),te[1]=Math.max(U,te[1]),te[2]=Math.min(S,te[2]),te[3]=Math.max(I,te[3])}const p=f.a[0]+(l-f.a[2]),b=f.a[1]+(u-f.a[3]),w=f.b[0]+(l-f.b[2]),y=f.b[1]+(u-f.b[3]);let x={stable:!1,aStart:p,aLength:b-p,aContent:t.slice(p,b),oStart:l,oLength:u-l,oContent:e.slice(l,u),bStart:w,bLength:y-w,bContent:r.slice(w,y)};o.push(x)}a=u}return s(e.length),o}function Bu(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},n);const o=typeof t=="string",a=typeof e=="string",s=typeof r=="string";o&&(t=t.split(n.stringSeparator)),a&&(e=e.split(n.stringSeparator)),s&&(r=r.split(n.stringSeparator));let c=[];const l=dC(t,e,r);let u=[];function h(){u.length&&c.push({ok:u}),u=[]}function f(p,b){if(p.length!==b.length)return!1;for(let w=0;w<p.length;w++)if(p[w]!==b[w])return!1;return!0}return l.forEach(p=>{p.stable?u.push(...p.bufferContent):n.excludeFalseConflicts&&f(p.aContent,p.bContent)?u.push(...p.aContent):(h(),c.push({conflict:{a:p.aContent,aIndex:p.aStart,o:p.oContent,oIndex:p.oStart,b:p.bContent,bIndex:p.bStart}}))}),h(),c}function bD(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/,label:{}},n);const o=Bu(t,e,r,n);let a=!1,s=[];return o.forEach(c=>{c.ok?s=s.concat(c.ok):c.conflict&&(a=!0,s.push(`<<<<<<<${n.label.a?` ${n.label.a}`:""}`),s=s.concat(c.conflict.a),s.push(`|||||||${n.label.o?` ${n.label.o}`:""}`),s=s.concat(c.conflict.o),s.push("======="),s=s.concat(c.conflict.b),s.push(`>>>>>>>${n.label.b?` ${n.label.b}`:""}`))}),{conflict:a,result:s}}function hC(t,e,r,n){n=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},n);const o=Bu(t,e,r,n);let a=!1,s=[];for(let c=0;c<o.length;c++){const l=o[c];l.ok?s=s.concat(l.ok):(a=!0,s=s.concat([`
<<<<<<<<<
`],l.conflict.a,[`
=========
`],l.conflict.b,[`
>>>>>>>>>
`]))}return{conflict:a,result:s}}function _D(t,e,r,n){n=Object.assign({excludeFalseConflicts:!1,stringSeparator:/\s+/},n);const o=Bu(t,e,r,n);let a=!1,s=[];for(let c=0;c<o.length;c++){const l=o[c];if(l.ok)s=s.concat(l.ok);else{const u=uC(l.conflict.a,l.conflict.b);for(let h=0;h<u.length;h++){let f=u[h];f.common?s=s.concat(f.common):(a=!0,s=s.concat([`
<<<<<<<<<
`],f.buffer1,[`
=========
`],f.buffer2,[`
>>>>>>>>>
`]))}}}return{conflict:a,result:s}}function xD(t,e){let r=[],n=0;function i(o){for(;n<o;)r.push(t[n]),n++}for(let o=0;o<e.length;o++){let a=e[o];i(a.buffer1.offset);for(let s=0;s<a.buffer2.chunk.length;s++)r.push(a.buffer2.chunk[s]);n+=a.buffer1.length}return i(t.length),r}function SD(t){return t.map(e=>({buffer1:{offset:e.buffer1.offset,length:e.buffer1.length},buffer2:{chunk:e.buffer2.chunk}}))}function CD(t){return t.map(e=>({buffer1:e.buffer2,buffer2:e.buffer1}))}function ng(t,e,r){return jp(t,e,r)}function fC(t,e){const r=[];for(const n of Va(t,e))r.push({...n,oldFileName:n.newFileName,oldHeader:n.newHeader,newFileName:n.oldFileName,newHeader:n.oldHeader,hunks:n.hunks.map(i=>({...i,oldLines:i.newLines,oldStart:i.newStart,newLines:i.oldLines,newStart:i.oldStart,lines:i.lines.map(o=>o[0]==="-"?`+${o.slice(1)}`:o[0]==="+"?`-${o.slice(1)}`:o)}))}),r.push(n);return r}function ig(t,e,r){let n=`
`;const i=t.match(/(?:\r?\n)/g);if(i!==null&&i.length!==0){const c=i.filter(l=>l===`\r
`).length;n=c>i.length-c?`\r
`:`
`}const o=hC(t,e,r,{excludeFalseConflicts:!0,stringSeparator:/\r?\n/}),a=o.result;let s=!1;if(o.conflict){let c;const l=[];let u=0;for(const p of a)p===`
<<<<<<<<<
`?c={start:u,separator:u,end:u}:p===`
=========
`?c.separator=u:p===`
>>>>>>>>>
`&&(c.end=u,l.push(c)),u++;let h=0,f=0;for(const p of l)a.splice(p.start-h,1),h++,f=p.end-p.separator+1,a.splice(p.separator-h,f),h+=f;l.length&&(s=!0)}return{conflicts:s,mergedContent:a.join(n)}}function pC(t){return t!==void 0&&typeof t.then=="function"}const gC="";function mC(...t){if(t.length===1){const e=t[0];return e===void 0?gC:typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"||e instanceof Error?String(e):e instanceof d.Uri?e.toString():JSON.stringify(e)}return JSON.stringify(t)}function yr(t){return(e,r,n)=>{let i;if(typeof n.value=="function"?i=n.value:typeof n.get=="function"&&(i=n.get),i===void 0)throw new Error("Not supported");const o=`$gate$${r}`;n.value=function(...a){const s=a.length===0?o:`${o}$${(t!=null?t:mC)(...a)}`;Object.prototype.hasOwnProperty.call(this,s)||Object.defineProperty(this,s,{configurable:!1,enumerable:!1,writable:!0,value:void 0});let c=this[s];if(c===void 0){let l;try{if(l=i.apply(this,a),l==null||!pC(l))return l;this[s]=c=l.then(u=>(this[s]=void 0,u)).catch(u=>{throw this[s]=void 0,u})}catch(u){throw this[s]=void 0,u}}return c}}}let Ou=0;function vC(){return Ou===Number.MAX_SAFE_INTEGER&&(Ou=0),String(++Ou)}class wC{constructor(){this.id=vC()}async synchronize(e){let r;const n=this.promise;this.promise=new Promise(i=>r=i),await n;try{return await e()}finally{r()}}}class Ac{constructor(e){this.lock=new wC,this.readers=new Set,this.counter=0,this._id=e!=null?e:this.lock.id}get id(){return this._id}getNextCounter(){return this.counter===Number.MAX_SAFE_INTEGER&&(this.counter=0),++this.counter}async synchronizeRead(e,r){let n;const i=new $e(`Reader(${this.getNextCounter()}|${this.id})`,{log:{prefix:"(A) ",message:r?` \u2022 ${r}`:""},logLevel:Rt.Debug});let o;await this.lock.synchronize(async()=>{this.writer&&await this.writer,o=new Promise(a=>n=a),this.readers.add(o)}),i.restart({prefix:"(L) ",suffix:r?` \u2022 ${r}`:"",took:" waited for "});try{return await e()}finally{i.stop({prefix:"(U) ",suffix:r?` \u2022 ${r}`:"",took:" locked for "}),o!==void 0&&this.readers.delete(o),n()}}async synchronizeWrite(e,r){let n;const i=new $e(`Writer(${this.getNextCounter()}|${this.id})`,{log:{prefix:"(A) ",message:r?` \u2022 ${r}`:""},logLevel:Rt.Debug});await this.lock.synchronize(async()=>{if(this.writer&&await this.writer,this.readers.size){const o=[...this.readers];this.readers.clear(),await Promise.all(o)}this.writer=new Promise(o=>n=o)}),i.restart({prefix:"(L) ",suffix:r?` \u2022 ${r}`:"",took:" waited for "});try{return await e()}finally{i.stop({prefix:"(U) ",suffix:r?` \u2022 ${r}`:"",took:" locked for "}),n(),this.writer=void 0}}}class yC{constructor(){this.locks=new Map}async synchronizeRead(e,r,n){let i=this.locks.get(e);return i===void 0&&(i=new Ac(String(e)),this.locks.set(e,i)),i.synchronizeRead(r,n)}async synchronizeWrite(e,r,n){let i=this.locks.get(e);return i===void 0&&(i=new Ac(String(e)),this.locks.set(e,i)),i.synchronizeWrite(r,n)}}var bC=Object.defineProperty,_C=Object.getOwnPropertyDescriptor,xC=(t,e,r,n)=>{for(var i=n>1?void 0:n?_C(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&bC(e,r,i),i};const Yr=(0,C.loadMessageBundle)(),SC=d.FileSystemError.FileNotFound().code,og=`===================================================================
`,Sn=new TextDecoder,CC=new TextEncoder;var rt;(function(t){t[t.Changed=1]="Changed",t[t.Created=2]="Created",t[t.Deleted=3]="Deleted"})(rt||(rt={}));function EC(t){return t&&"type"in t&&"uri"in t&&"uri"in t&&"fileType"in t&&"revision"in t&&"timestamp"in t}function Ga(t,e,r){return{type:t.type,rootUri:e,uri:r!=null?r:t.uri}}const Bo=class{constructor(t,e,r,n,i,o){this.providerService=t,this.storageService=e,this.fileStorageService=r,this.telemetryService=n,this.workspaceId=i,this._onDidChange=new d.EventEmitter,this.cache=new Map,this.lock=new yC,this.scopedStores=new Map,o===void 0&&(Bo._instance=this,this.disposable=d.Disposable.from(this.providerService.onDidRefresh(()=>this.cache.clear())))}static get instance(){return this._instance}get onDidChange(){return this._onDidChange.event}dispose(){var t;(t=this.disposable)==null||t.dispose()}async exportDebugInfo(t){var e;async function r(n){const i=await d.workspace.openTextDocument({language:"json",content:`ChangeStore Operations for ${n.toString(!0)}

${this.toStorage(await this.getWorkingOperations(n))}`});return void d.window.showTextDocument(i)}if(t===void 0)for(const n of(e=d.workspace.workspaceFolders)!=null?e:[])await r.call(this,n.uri);else return r.call(this,t)}async getWorkspaceProvidersWithChanges(){var t,e;const r=new Map;for(const n of(t=d.workspace.workspaceFolders)!=null?t:[])if(n.uri.scheme===Pt.scheme&&await this.hasChanges(n.uri)){const i=(e=this.providerService.getRepository(n.uri))==null?void 0:e.provider;if(!i)continue;r.set(i.id,i)}return[...r.values()]}async getWorkspacesWithChanges(){var t;const e=new $e("ChangeStore.getWorkspacesWithChanges()");try{const r=[];for(const n of(t=d.workspace.workspaceFolders)!=null?t:[])n.uri.scheme===Pt.scheme&&await this.hasChanges(n.uri)&&r.push(n.uri);return r.length>0?r:void 0}finally{e.stop()}}async acceptAll(t,e){const r=`ChangeStore.acceptAll(${t.toString()}, ${e==null?void 0:e.staged})`;K.log(r);const n=[];await this.lock.synchronizeWrite(we(t),async()=>{const i=await this.getWorkingOperations(t),o=[];let a=[];const s=(e==null?void 0:e.staged)&&!(e.staged==="auto"&&!i.some(c=>c.staged));for(const c of i){if(s&&!c.staged){a.push(c);continue}c.fileType===d.FileType.File&&await this.discardWorkingContent(t,c.uri);let l;if(c.type===2&&c.fileType===d.FileType.Directory&&(i.some(u=>pc(u.uri,c.uri))||(l={type:3,rootUri:t,uri:c.uri})),n.push(l!=null?l:Ga(c,t)),c.type===2){let u=c.uri;for(;;){const{parent:h}=this.findParent(u,i,f=>f.type===2);if(h){o.push(h),u=h.uri;continue}break}}}a.length>0&&o.length>0&&(a=a.filter(c=>o.includes(c)?(n.push(Ga(c,t)),!1):!0)),await this.saveWorkingOperations(t,a)},r),n.length!==0&&this._onDidChange.fire(n)}async discard(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.discard(${t.toString()})`;K.log(r);const n=[];await this.lock.synchronizeWrite(we(e),async()=>this.discardCore(e,t,n),r),n.length!==0&&this._onDidChange.fire(n)}async discardCore(t,e,r){K.debug(`ChangeStore.discardCore(${e.toString()})`);const n=await this.getWorkingOperations(t);if(n.length===0)return;const i=Gn(e),o=n.findIndex(c=>Gn(c.uri)===i);if(o===-1)return;const[a]=n.splice(o,1);let s;switch(a.type){case 2:s=3;break;case 3:s=2;break;default:s=a.type;break}if(r.push({type:s,rootUri:t,uri:e}),a.type===2){let c=a.uri;for(;;){const{parent:l,parentIndex:u}=this.findNewParentWithOnlyChild(c,n);if(l){n.splice(u,1),r.push({type:3,rootUri:t,uri:l.uri}),c=l.uri;continue}break}}await this.saveWorkingOperations(t,n),a.fileType===d.FileType.File&&await this.discardWorkingContent(t,e)}async discardAll(t,e){const r=this.getUriScope(t);if(r)return this.getScopedChangeStore(r).discardAll(t,e);const n=`ChangeStore.discardAll(${t.toString()}, ${e==null?void 0:e.staged})`;K.log(n);const i=[];await this.lock.synchronizeWrite(we(t),async()=>{const o=await this.getWorkingOperations(t),a=[];let s=[];const c=(e==null?void 0:e.staged)&&!(e.staged==="auto"&&!o.some(l=>l.staged));for(const l of o){if(c&&!l.staged){s.push(l);continue}l.fileType===d.FileType.File&&await this.discardWorkingContent(t,l.uri);let u;switch(l.type){case 2:u=3;break;case 3:u=2;break;default:u=l.type;break}if(i.push({type:u,rootUri:t,uri:l.uri}),l.type===2){let h=l.uri;for(;;){const{parent:f}=this.findNewParentWithOnlyChild(h,o);if(f){a.push(f),h=f.uri;continue}break}}}s.length>0&&a.length>0&&(s=s.filter(l=>a.includes(l)?(i.push({type:3,rootUri:t,uri:l.uri}),!1):!0)),await this.saveWorkingOperations(t,s)},n),i.length!==0&&this._onDidChange.fire(i)}async stage(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.stage(${t.toString()})`;K.log(r);const n=[];await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e);i!==void 0&&await this.spliceOperation(t,o,{...i,staged:!0,timestamp:Date.now()},n)},r),n.length!==0&&this._onDidChange.fire(n)}async stageAll(t){const e=`ChangeStore.stageAll(${t.toString()})`;K.log(e);const r=[];await this.lock.synchronizeWrite(we(t),async()=>{const n=(await this.getWorkingOperations(t)).map(i=>({...i,staged:!0,timestamp:Date.now()}));n.length!==0&&(await this.saveWorkingOperations(t,n),r.push(...n.map(i=>Ga(i,t))))},e),r.length!==0&&this._onDidChange.fire(r)}async unstage(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=`ChangeStore.unstage(${t.toString()})`;K.log(r);const n=[];await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e);i!==void 0&&await this.spliceOperation(t,o,{...i,staged:!1,timestamp:Date.now()},n)},r),n.length!==0&&this._onDidChange.fire(n)}async unstageAll(t){const e=`ChangeStore.unstageAll(${t.toString()})`;K.log(e);const r=[];await this.lock.synchronizeWrite(we(t),async()=>{const n=(await this.getWorkingOperations(t)).map(i=>({...i,staged:!1,timestamp:Date.now()}));n.length!==0&&(await this.saveWorkingOperations(t,n),r.push(...n.map(i=>Ga(i,t))))},e),r.length!==0&&this._onDidChange.fire(r)}async hasChanges(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).hasChanges(t);const r=we(t),n=this.cache.get(r);return n!==void 0?n.length!==0:this.lock.synchronizeRead(r,async()=>(await this.getWorkingOperations(t)).length!==0,`ChangeStore.hasChanges(${t.toString()})`)}maybeHasChanges(t,e){const r=this.getUriScope(t);if(r)return this.getScopedChangeStore(r).maybeHasChanges(t,e);const n=this.cache.get(we(t));if(n===void 0)return;if(n.length===0)return!1;if(e===void 0)return!0;const i=Gn(e);return n.some(o=>Gn(o.uri)===i)}async hasMergeConflicts(t){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).some(e=>e.conflicts!==void 0),`ChangeStore.hasMergeConflicts(${t.toString()})`)}async hasStagedChanges(t){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).some(e=>e.staged&&e.conflicts===void 0),`ChangeStore.hasStagedChanges(${t.toString()})`)}async hasWorkingChanges(t){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).some(e=>!e.staged&&e.conflicts===void 0),`ChangeStore.hasWorkingChanges(${t.toString()})`)}async getChange(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).getChange(t);const r=this.providerService.getVirtualRootUri(t);if(r!==void 0)return this.lock.synchronizeRead(we(r),async()=>{const{operation:n}=await this.getWorkingOperation(t,r);return n},`ChangeStore.getChange(${t.toString()})`)}async getChanges(t,e){const r=this.getUriScope(t);return r?this.getScopedChangeStore(r).getChanges(t,e):this.lock.synchronizeRead(we(t),async()=>{let n=await this.getWorkingOperations(t);if((e==null?void 0:e.excludeConflicts)||(e==null?void 0:e.predicate)){const{excludeConflicts:i,predicate:o}=e;n=n.filter(a=>{var s;return(!i||a.conflicts===void 0)&&((s=o==null?void 0:o(a))!=null?s:!0)})}return n},`ChangeStore.getChanges(${t.toString()})`)}async getGroupedChanges(t,e){const r=this.getUriScope(t);return r?this.getScopedChangeStore(r).getGroupedChanges(t,e):this.lock.synchronizeRead(we(t),async()=>{var n,i;const o=await this.getWorkingOperations(t),a={conflicts:[],staged:[],working:[]};for(const s of o)!((i=(n=e==null?void 0:e.predicate)==null?void 0:n.call(e,s))!=null?i:!0)||(s.conflicts?a.conflicts.push(s):s.staged?a.staged.push(s):a.working.push(s));return a},`ChangeStore.getChangesByType(${t.toString()})`)}async getContent(t){const e=this.providerService.getVirtualRootUri(t);if(e===void 0)throw new Error(`Unable to find content for ${t.toString()}; Repository not found`);const r=we(e),n=this.cache.get(r);if((n==null?void 0:n.length)===0)throw new Error(`Unable to find content for ${t.toString()}`);return this.lock.synchronizeRead(r,async()=>{const i=Sn.decode(await this.getWorkingContent(e,t));if(i!==void 0)return i;throw new Error(`Unable to find content for ${t.toString()}`)},`ChangeStore.getContent(${t.toString()}}`)}async getMergeConflicts(t,e){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,o;return n.conflicts!==void 0&&((o=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?o:!0)}),`ChangeStore.getMergeConflicts(${t.toString()})`)}async getStagedChanges(t,e){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,o;return n.staged&&n.conflicts===void 0&&((o=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?o:!0)}),`ChangeStore.getStagedChanges(${t.toString()})`)}async getWorkingChanges(t,e){return this.lock.synchronizeRead(we(t),async()=>(await this.getWorkingOperations(t)).filter(n=>{var i,o;return!n.staged&&n.conflicts===void 0&&((o=(i=e==null?void 0:e.predicate)==null?void 0:i.call(e,n))!=null?o:!0)}),`ChangeStore.getWorkingChanges(${t.toString()})`)}async applyChangeset(t,e,r,n){var i;let o;EC(r)?o=r:n=n!=null?n:r,K.log(`ChangeStore.applyChangeset${t.toString()}`,e.workspaceId,e.uri,o==null?void 0:o.uri,n==null?void 0:n.save);const a=this.getScopedChangeStore(e.workspaceId),s=(i=e.patch)!=null?i:await a.createPatch(e.uri,o==null?void 0:o.uri);await this.applyPatchCore(t,s,{...n,getIncomingContent:async c=>{const l=this.getScopedUri(this.providerService.createRelativeVirtualUri(e.uri,c),e.workspaceId);return Sn.decode(await d.workspace.fs.readFile(l))},merge:async(c,l,u)=>{try{const h=this.providerService.getProviderUri(c),f=Sn.decode(await d.workspace.fs.readFile(h)),p=this.getScopedUri(this.providerService.createRelativeVirtualUri(e.uri,l),e.workspaceId),b=Sn.decode(await d.workspace.fs.readFile(p));return{...ig(u,f,b),baseUri:h,incomingUri:p}}catch(h){throw new Error(`Unable to apply patch to ${l}: ${String(h)}`)}}})}async applyPatch(t,e,r){if(K.log(`ChangeStore.applyPatch(${t.toString()})`,r==null?void 0:r.save),!e.startsWith("diff --"))throw new Error("Invalid patch");return this.applyPatchCore(t,e,r)}async applyPatchCore(t,e,r={}){const n=`ChangeStore.applyPatchCore(${t.toString()})`;K.debug(n,r==null?void 0:r.save);const i=new d.WorkspaceEdit,o=[],a=new Map;async function s(f){var p;const b=we(f),w=d.workspace.textDocuments.find(y=>we(y.uri)===b);return(p=w==null?void 0:w.getText())!=null?p:Sn.decode(await d.workspace.fs.readFile(f))}async function c(f){try{const p=await d.workspace.fs.stat(f);return Boolean(p)}catch{return!1}}async function l(f,p,b){let w=ng("",b,{fuzzFactor:0});if(w===!1){if(!r.getIncomingContent)throw new Error(`Unable to apply patch to ${p}`);w=await r.getIncomingContent(p)}i.createFile(f,{overwrite:!0}),i.replace(f,new d.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),w)}async function u(f,p,b,w){const y=await s(f);let x=ng(y,b,{fuzzFactor:1});if(x===!1){if(r.merge===void 0)throw new Error(`Unable to apply patch to ${p}; Resulted in conflicts`);const S={title:Yr("apply patch failed prompt confirm","Merge")},I={title:Yr("apply patch failed prompt cancel","Skip File"),isCloseAffordance:!0};if(await d.window.showWarningMessage(Yr("apply patch failed prompt",`Unable to apply changes to '{0}'.

Do you want to retry by merging the files?`,p),{modal:!0,useCustom:!0},S,I)!==S)return;const U=await r.merge(f,p,y);x=U.mergedContent,U.conflicts&&a.set(we(f),{type:w,baseUri:U.baseUri,incomingUri:U.incomingUri})}i.replace(f,new d.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),x)}const h=(r==null?void 0:r.reverse)?fC(e,{}):Va(e,{});for(const f of h)if(f.oldFileName==="/dev/null"){if(!f.newFileName)continue;const p=f.newFileName.startsWith("b/")?f.newFileName.substr(2):f.newFileName,b=this.providerService.createRelativeVirtualUri(t,p);o.push(we(b)),!await c(b)?await l(b,p,f):await u(b,p,f,2)}else if(f.newFileName==="/dev/null"){if(!f.oldFileName)continue;const p=f.oldFileName.startsWith("a/")?f.oldFileName.substr(2):f.oldFileName,b=this.providerService.createRelativeVirtualUri(t,p);await c(b)&&i.deleteFile(b)}else if(f.oldFileName===f.newFileName){if(!f.newFileName)continue;const p=this.providerService.createRelativeVirtualUri(t,f.newFileName);o.push(we(p)),!await c(p)?await l(p,f.newFileName,f):await u(p,f.newFileName,f,1)}else throw new Error(`Unable to apply patch to ${f.oldFileName}; Renames aren't currently supported`);if(await d.workspace.applyEdit(i),r.save&&o.length)for(const f of o){const p=d.workspace.textDocuments.find(b=>we(b.uri)===f);await(p==null?void 0:p.save())}a.size&&setTimeout(async()=>{const f=[];await this.lock.synchronizeWrite(we(t),async()=>{const p=await this.getWorkingOperations(t);if(p.length===0)return;let b=-1;for(const w of p){b++;const y=a.get(we(w.uri));y!==void 0&&await this.spliceOperation(w.uri,b,{...w,conflicts:{baseUri:y.baseUri,incomingUri:y.incomingUri,status:[w.type,y.type]},timestamp:Date.now()},f)}},n),f.length!==0&&this._onDidChange.fire(f)},0)}async createChangeset(t){K.log(`ChangeStore.createChangeset${t.toString()})`);const e=await this.createPatch(t);return e?{workspaceId:this.workspaceId,uri:t,patch:e}:void 0}async createPatch(t,e,r){if(K.log(`ChangeStore.createPatch${t.toString()})`,e),e===void 0){let o=await this.getWorkingOperations(t);if((r==null?void 0:r.staged)&&(o=o.filter(s=>s.staged)),o.length===0)return"";const a=[];for(const s of o){const c=await this.createPatchCore(t,s);a.push(c)}return a.join("")}const{operation:n}=await this.getWorkingOperation(e,t);if(n===void 0)throw new Error(`Unable to create patch for ${e.toString()}`);return(r==null?void 0:r.staged)&&n.staged?"":await this.createPatchCore(t,n)}async createPatchCore(t,e){const r=this.providerService.getRelativeFilePath(t,e.uri),n=`diff --git a/${r} b/${r}`;if(e.type===2){let c=await this.getContent(e.uri),l;!c.endsWith(`
`)&&!c.endsWith(`\r
`)?l=`
\\ No newline at end of file`:l="";let u=0;return c=c.replace(/\r?\n/g,h=>(u++,`${h}+`)),`${n}
new file mode 100644
--- /dev/null
+++ b/${r}
@@ -0,0 +1,${u} @@
+${c}${l}`}if(e.type===3){let c=Sn.decode(await d.workspace.fs.readFile(this.providerService.getProviderUri(e.uri))),l=0;return c=c.replace(/\r?\n/g,u=>(l++,`${u}-`)),`${n}
deleted file mode 100644
--- a/${r}
+++ /dev/null
@@ -1,${l} +0,0 @@
-${c}`}const i=await this.getContent(e.uri),o=Sn.decode(await d.workspace.fs.readFile(this.providerService.getProviderUri(e.uri))),a=Pu(r,o,i),s=a.indexOf(og);return`${n}
${a.substr(s+og.length)}`}async keep(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return;const n=`ChangeStore.keep(${t.toString()})`;K.log(n,e);const i=[];await this.lock.synchronizeWrite(we(r),async()=>{const{operation:o,index:a}=await this.getWorkingOperation(t,r);if(o===void 0)return;if(e===void 0&&o.conflicts){const[,c]=o.conflicts.status;switch(c){case 1:switch(o.type){case 1:case 2:case 3:await this.spliceOperation(t,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break}break;case 2:switch(o.type){case 1:case 3:await this.spliceOperation(t,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break;case 2:await this.spliceOperation(t,a,{...o,type:1,size:o.size,hash:o.hash,originalHash:o.originalHash,conflicts:void 0,timestamp:Date.now()},i);break}break;case 3:switch(o.type){case 3:await this.discardCore(r,t,i);break;case 1:await this.spliceOperation(t,a,{...o,type:2,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);break;case 2:await this.spliceOperation(t,a,{...o,conflicts:void 0,timestamp:Date.now()},i);break}break}return}if(e===void 0)return;switch(e.type){case 1:switch(o.type){case 3:await this.spliceOperation(t,a,{...o,type:3,size:void 0,hash:void 0,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);return;case 2:break;case 1:break}break;case 2:switch(o.type){case 1:case 3:return;case 2:break}break;case 3:switch(o.type){case 3:return this.discardCore(r,t,i);case 1:await this.spliceOperation(t,a,{...o,type:2,originalHash:void 0,conflicts:void 0,timestamp:Date.now()},i);return;case 2:return}}const s=e!==void 0?await d.workspace.fs.readFile(e.providerUri):void 0;await this.spliceOperation(t,a,{...o,type:1,originalHash:s!==void 0?await ja(s):o.originalHash,conflicts:void 0,timestamp:Date.now()},i)},n),i.length!==0&&this._onDidChange.fire(i)}async merge(t,e,r){const n=this.providerService.getVirtualWorkspaceUri(t);if(n===void 0)return;const i=`ChangeStore.merge(${t.toString()})`;K.log(i,e,r);const o=[];await this.lock.synchronizeWrite(we(n),async()=>{const{operation:a,index:s}=await this.getWorkingOperation(t,n);if(a===void 0)return;switch(e.type){case 1:switch(a.type){case 3:return void this.spliceOperation(t,s,{...a,type:3,size:void 0,hash:void 0,originalHash:void 0,conflicts:{baseUri:r.providerUri,incomingUri:e.providerUri,status:[a.type,e.type]},timestamp:Date.now()},o);case 2:break;case 1:break}break;case 2:switch(a.type){case 3:case 1:return;case 2:break}break;case 3:switch(a.type){case 3:return this.discardCore(n,t,o);case 1:return void this.spliceOperation(t,s,{...a,type:2,originalHash:void 0,conflicts:{baseUri:void 0,incomingUri:e.providerUri,status:[a.type,e.type]},timestamp:Date.now()},o);case 2:return}}const c=await this.getWorkingContent(n,t),l=await d.workspace.fs.readFile(r.providerUri),u=await d.workspace.fs.readFile(e.providerUri),h=ig(Sn.decode(c),Sn.decode(l),Sn.decode(u));await this.writeFileCore(n,t,o,CC.encode(h.mergedContent),u!=null?u:new Uint8Array(0),h.conflicts?{baseUri:r.providerUri,incomingUri:e.providerUri,status:[a.type,e.type]}:void 0)},i),o.length!==0&&this._onDidChange.fire(o)}async resolveDiffCommand(t,e,r,n){let i;const o=this.providerService.getVirtualRootUri(t);return o!==void 0&&({operation:i}=await this.getWorkingOperation(t,o)),(i==null?void 0:i.type)===3?this.resolveOpenCommand(e):((i==null?void 0:i.type)===2&&(e=e.with({query:"~"})),{command:"vscode.diff",title:"Open Changes",arguments:[e,t,r,n]})}resolveOpenCommand(t,e){return{command:"vscode.open",title:"Open File",arguments:[t,e]}}getScopedUri(t,e){const r=typeof e=="string"?e:e.workspaceId;return r===this.workspaceId?t:t.with({fragment:r})}getUriScope(t){return t.fragment||void 0}getScopedChangeStore(t){const e=typeof t=="string"?t:t.workspaceId;K.log(`ChangeStore.getScopedChangeStore(${e})`);let r=this.scopedStores.get(e);return r===void 0&&(r=e===this.workspaceId?new Bo.ScopedChangeStore(this,e,this.workspaceId):new Bo.ScopedChangeStore(new Bo(this.providerService,this.storageService.with(e),this.fileStorageService.with(e),this.telemetryService,this.workspaceId,e),e,this.workspaceId),this.scopedStores.set(e,r)),r}async stat(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).stat(t);const r=this.providerService.getVirtualRootUri(t);if(r===void 0)return;const n=we(r),i=this.cache.get(n);if((i==null?void 0:i.length)!==0)return this.lock.synchronizeRead(n,async()=>{var o;const{operation:a}=await this.getWorkingOperation(t,r);if(a!==void 0){if(a.type===3)throw d.FileSystemError.FileNotFound(`The ${a.fileType===d.FileType.Directory?"folder":"file"} has been deleted.`);return{type:a.fileType,size:(o=a.size)!=null?o:0,ctime:0,mtime:a.timestamp}}},`ChangeStore.stat(${t.toString()}`)}async readFile(t){const e=this.getUriScope(t);if(e)return this.getScopedChangeStore(e).readFile(t);const r=new $e(`ChangeStore.readFile(${t.toString()})`);try{const n=this.providerService.getVirtualRootUri(t);if(n===void 0)return;const i=we(n),o=this.cache.get(i);return(o==null?void 0:o.length)===0?void 0:await this.lock.synchronizeRead(i,()=>{const a=this.cache.get(i);if((a==null?void 0:a.length)===0){r.log({message:": Not found; no operations"});return}return this.getWorkingContent(n,t)},r.context)}finally{r.stop()}}async createDirectory(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new $e(`ChangeStore.createDirectory(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e),a=await this.providerService.getMetadata(t);await this.spliceOperation(t,o,i===void 0?{type:2,uri:t,fileType:d.FileType.Directory,revision:a.HEAD.sha,timestamp:Date.now(),size:0,hash:"",originalHash:void 0}:{...i,timestamp:Date.now()},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async deleteDirectory(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new $e(`ChangeStore.deleteDirectory(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e);if((i==null?void 0:i.type)===2)return this.discardCore(e,t,n);const a=await this.providerService.getMetadata(t);await this.spliceOperation(t,o,{type:3,uri:t,fileType:d.FileType.Directory,revision:a.HEAD.sha,timestamp:Date.now(),size:void 0,hash:void 0,originalHash:void 0},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}async updateDirectoryEntries(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return e;const n=new $e(`ChangeStore.updateDirectoryEntries(${t.toString()})`,{},e.length);try{const i=we(r),o=this.cache.get(i);return(o==null?void 0:o.length)===0?e:await this.lock.synchronizeRead(i,async()=>{const{path:a}=Ma(r,t),s=await this.getWorkingOperations(r);for(const c of s)switch(c.type){case 1:break;case 2:{if(pc(c.uri,a)){const l=this.providerService.getRelativeFilePath(t,c.uri);e.push([l,c.fileType])}break}case 3:{if(pc(c.uri,a)){const l=this.providerService.getRelativeFilePath(t,c.uri),u=e.findIndex(([h])=>h===l);u!==-1&&e.splice(u,1)}break}}return e},n.context)}finally{n.stop()}}async writeFile(t,e,r,n){const i=this.providerService.getVirtualWorkspaceUri(t);if(i===void 0)return;const o=new $e(`ChangeStore.writeFile(${t.toString()})`,{},e.length,n);try{const a=[];if(await this.lock.synchronizeWrite(we(i),async()=>this.writeFileCore(i,t,a,e,r,n),o.context),a.length===0)return;this._onDidChange.fire(a)}finally{o.stop()}}async writeFileCore(t,e,r,n,i,o){const a=new $e(`ChangeStore.writeFileCore(${e.toString()})`,{},n.length,o);try{const[{operation:s,index:c},l,u]=await Promise.all([this.getWorkingOperation(e,t),ja(n),ja(i)]);if(l===u&&(s==null?void 0:s.type)===1)return this.discardCore(t,e,r);if(l===(s==null?void 0:s.hash)&&u===(s==null?void 0:s.originalHash))return;const[{HEAD:h}]=await Promise.all([this.providerService.getMetadata(e),this.saveWorkingContent(t,e,n)]);await this.spliceOperation(e,c,s===void 0?{type:1,uri:e,fileType:d.FileType.File,revision:h.sha,timestamp:Date.now(),size:n.byteLength,hash:l,originalHash:u,conflicts:o,staged:!1}:{...s,revision:h.sha,timestamp:Date.now(),size:n.byteLength,hash:l,originalHash:u,conflicts:o,staged:!1},r)}finally{a.stop()}}async createFile(t,e){const r=this.providerService.getVirtualWorkspaceUri(t);if(r===void 0)return;const n=new $e(`ChangeStore.createFile(${t.toString()})`,{},e.length);try{const i=[];if(await this.lock.synchronizeWrite(we(r),async()=>{const[{operation:o,index:a},s,c]=await Promise.all([this.getWorkingOperation(t,r),ja(e),this.providerService.getMetadata(t),this.saveWorkingContent(r,t,e)]);await this.spliceOperation(t,a,o===void 0?{type:2,uri:t,fileType:d.FileType.File,revision:c.HEAD.sha,timestamp:Date.now(),size:e.byteLength,hash:s,originalHash:s}:{...o,type:2,revision:c.HEAD.sha,timestamp:Date.now(),size:e.byteLength,hash:s},i)},n.context),i.length===0)return;this._onDidChange.fire(i)}finally{n.stop()}}async deleteFile(t){const e=this.providerService.getVirtualWorkspaceUri(t);if(e===void 0)return;const r=new $e(`ChangeStore.deleteFile(${t.toString()})`);try{const n=[];if(await this.lock.synchronizeWrite(we(e),async()=>{const{operation:i,index:o}=await this.getWorkingOperation(t,e);if((i==null?void 0:i.type)===2)return this.discardCore(e,t,n);const[a]=await Promise.all([this.providerService.getMetadata(t),this.discardWorkingContent(e,t)]);await this.spliceOperation(t,o,{type:3,uri:t,fileType:d.FileType.File,revision:a.HEAD.sha,timestamp:Date.now(),size:void 0,hash:void 0,originalHash:void 0},n)},r.context),n.length===0)return;this._onDidChange.fire(n)}finally{r.stop()}}findParent(t,e,r){const n=xS(t),{operation:i,index:o}=this.findWorkingOperation(n,e);return i!==void 0&&r(i,e)?{parent:i,parentIndex:o}:{parent:void 0,parentIndex:-1}}findNewParentWithOnlyChild(t,e){const r=Gn(t);return this.findParent(t,e,(n,i)=>n.type===2&&!i.some(o=>pc(o.uri,n.uri)&&Gn(o.uri)!==r))}async getWorkingOperation(t,e){return this.findWorkingOperation(t,await this.getWorkingOperations(e))}findWorkingOperation(t,e){if(e.length===0)return{operation:void 0,index:-1};const r=Gn(t);let n=-1;const i=e.find((o,a)=>Gn(o.uri)!==r?!1:(n=a,!0));return i===void 0?{operation:void 0,index:-1}:{operation:i,index:n}}async getWorkingOperations(t){const e=we(t);let r=this.cache.get(e);return r===void 0&&(r=this.fromStorage(await this.storageService.get(this.getOperationsStorageKey(e))),this.cache.set(e,r)),r}async saveWorkingOperations(t,e){K.debug(`ChangeStore.saveWorkingOperations(${t.toString()})`,e.length);const r=we(t);this.cache.set(r,e);try{await this.storageService.store(this.getOperationsStorageKey(r),this.toStorage(e))}catch(n){throw this.cache.delete(r),K.error(n,`Failed to save repository changes for ${r}`),n}}getOperationsStorageKey(t){return`operations/${t}`}async getWorkingContent(t,e){try{return await this.fileStorageService.get(this.getFileStorageKey(t,e))}catch(r){throw K.error(r),this.telemetryService.sendException(r),r}}async discardWorkingContent(t,e){K.debug(`ChangeStore.discardWorkingContent(${e.toString()})`);try{return await this.fileStorageService.delete(this.getFileStorageKey(t,e))}catch(r){if(r instanceof d.FileSystemError&&r.code===SC)return;throw K.error(r),this.telemetryService.sendException(r),r}}async saveWorkingContent(t,e,r){K.debug(`ChangeStore.saveWorkingContent(${e.toString()})`,r.length);try{return await this.fileStorageService.store(this.getFileStorageKey(t,e),r)}catch(n){throw K.error(n),this.telemetryService.sendException(n),n}}getFileStorageKey(t,e){return`changestore/${Eu(e)}`}async spliceOperation(t,e,r,n){const i=this.providerService.getVirtualWorkspaceUri(t);if(i===void 0)return;const o=await this.getWorkingOperations(i);e!==-1?o.splice(e,1,r):o.push(r),await this.saveWorkingOperations(i,o),n.push(Ga(r,i,t))}fromStorage(t){if(!t)return[];try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&gc(n)?typeof n=="string"?d.Uri.parse(n):d.Uri.from(n):n);return Array.isArray(e)?e:e.operations}catch(e){throw K.error(e,"Failed to deserialize ChangeStore operations"),e}}toStorage(t){const e={schemaVersion:Bo.operationsStorageSchemaVersion,operations:t};return JSON.stringify(e)}};let Ka=Bo;Ka.operationsStorageSchemaVersion=1,Ka.ScopedChangeStore=class{constructor(t,e,r){this.changeStore=t,this.scope=e,this.workspaceId=r}createPatch(t,e,r){return this.changeStore.createPatch(this.stripUriScope(t),this.stripUriScope(e),r)}discardAll(t,e){return this.changeStore.discardAll(this.stripUriScope(t),e)}getChange(t){return this.changeStore.getChange(this.stripUriScope(t))}getChanges(t,e){return this.changeStore.getChanges(this.stripUriScope(t),e)}async getGroupedChanges(t,e){return this.changeStore.getGroupedChanges(this.stripUriScope(t),e)}hasChanges(t){return this.changeStore.hasChanges(this.stripUriScope(t))}maybeHasChanges(t,e){return this.changeStore.maybeHasChanges(this.stripUriScope(t),this.stripUriScope(e))}async stat(t){const r=this.changeStore.getUriScope(t)!==this.workspaceId,n=await this.changeStore.stat(this.stripUriScope(t));return n!==void 0&&r&&(n.permissions=d.FilePermission.Readonly),n}readFile(t){return this.changeStore.readFile(this.stripUriScope(t))}resolveDiffCommand(t,e,r,n){return this.changeStore.resolveDiffCommand(this.changeStore.getScopedUri(t,this.scope),this.changeStore.getScopedUri(e,this.scope),r,n)}stripUriScope(t){return t===void 0||!t.fragment?t:t.with({fragment:""})}},xC([yr()],Ka.prototype,"getWorkingOperations",1);function ag(t){switch(t){case 1:return Yr("change type changed","Modified");case 2:return Yr("change type created","Added");case 3:return Yr("change type deleted","Deleted")}}function RC(t){const[e,r]=t;switch(e){case 1:switch(r){case 1:case 2:return Yr("conflict status changed both","Modified by Both");case 3:return Yr("conflict status deleted them","Deleted by Incoming")}break;case 2:switch(r){case 1:case 2:return Yr("conflict status created both","Added by Both");case 3:return Yr("conflict status deleted them","Deleted by Incoming")}break;case 3:switch(r){case 1:case 2:return Yr("conflict status deleted us","Deleted by Current");case 3:return Yr("conflict status deleted both","Deleted by Both")}break}}class sg extends Error{constructor(e){super(e);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="Deprecation"}}var TC=__webpack_require__(778),cg=__webpack_require__.n(TC);const AC=cg()(t=>console.warn(t)),kC=cg()(t=>console.warn(t));class Cn extends Error{constructor(e,r,n){super(e);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="HttpError",this.status=r;let i;"headers"in n&&typeof n.headers!="undefined"&&(i=n.headers),"response"in n&&(this.response=n.response,i=n.response.headers);const o=Object.assign({},n.request);n.request.headers.authorization&&(o.headers=Object.assign({},n.request.headers,{authorization:n.request.headers.authorization.replace(/ .*$/," [REDACTED]")})),o.url=o.url.replace(/\bclient_secret=\w+/g,"client_secret=[REDACTED]").replace(/\baccess_token=\w+/g,"access_token=[REDACTED]"),this.request=o,Object.defineProperty(this,"code",{get(){return AC(new sg("[@octokit/request-error] `error.code` is deprecated, use `error.status`.")),r}}),Object.defineProperty(this,"headers",{get(){return kC(new sg("[@octokit/request-error] `error.headers` is deprecated, use `error.response.headers`.")),i||{}}})}}var lg=Object.defineProperty,IC=t=>lg(t,"__esModule",{value:!0}),_e=(t,e)=>()=>(t&&(e=t(t=0)),e),DC=(t,e)=>{IC(t);for(var r in e)lg(t,r,{get:e[r],enumerable:!0})},ug,PC=_e(()=>{ug={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5}}),Oo,En,Yn,Xr,kc,Jn,Ic,Dc,dg,hg,Za,Uu=_e(()=>{Oo="function",En="object",Yn="undefined",Xr="prototype",kc="hasOwnProperty",Jn=Object,Ic=Jn[Xr],Dc=Jn.assign,dg=Jn.create,hg=Jn.defineProperty,Za=Ic[kc]});function Uo(){return typeof globalThis!==Yn&&globalThis?globalThis:typeof self!==Yn&&self?self:typeof window!==Yn&&window?window:typeof __webpack_require__.g!==Yn&&__webpack_require__.g?__webpack_require__.g:null}function Lu(t){throw new TypeError(t)}function Pc(t){var e=dg;if(e)return e(t);if(t==null)return{};var r=typeof t;r!==En&&r!==Oo&&Lu("Object prototype may only be an Object:"+t);function n(){}return n[Xr]=t,new n}var fg=_e(()=>{Uu()});function Nt(t,e){typeof e!==Oo&&e!==null&&Lu("Class extends value "+String(e)+" is not a constructor or null"),Fc(t,e);function r(){this.constructor=t}t[Xr]=e===null?Pc(e):(r[Xr]=e[Xr],new r)}var FC,NC,pg,Lo,Fc,$C=_e(()=>{Uu(),fg(),FC=(Uo()||{}).Symbol,NC=(Uo()||{}).Reflect,pg=function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Ic[kc].call(e,i)&&(t[i]=e[i])}return t},Lo=Dc||pg,Fc=function(t,e){return Fc=Jn.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n[kc](i)&&(r[i]=n[i])},Fc(t,e)}}),MC=_e(()=>{}),Ut=_e(()=>{Uu(),fg(),$C(),MC()});function _i(t,e){return t&&Ja[Rn].hasOwnProperty.call(t,e)}function gg(t){return t&&(t===Ja[Rn]||t===Array[Rn])}function Hu(t){return gg(t)||t===Function[Rn]}function Ji(t){if(t){if(qo)return qo(t);var e=t[vg]||t[Rn]||(t[Xa]?t[Xa][Rn]:null);if(e)return e}return null}function Nc(t,e){var r=[],n=Ja.getOwnPropertyNames;if(n)r=n(t);else for(var i in t)typeof i=="string"&&_i(t,i)&&r.push(i);if(r&&r.length>0)for(var o=0;o<r.length;o++)e(r[o])}function qu(t,e,r){return e!==Xa&&typeof t[e]===Qa&&(r||_i(t,e))}function $c(t){throw new TypeError("DynamicProto: "+t)}function BC(t){var e={};return Nc(t,function(r){!e[r]&&qu(t,r,!1)&&(e[r]=t[r])}),e}function Wu(t,e){for(var r=t.length-1;r>=0;r--)if(t[r]===e)return!0;return!1}function OC(t,e,r,n){function i(c,l,u){var h=l[u];if(h[Mc]&&n){var f=c[Ya]||{};f[Ho]!==!1&&(h=(f[l[eo]]||{})[u]||h)}return function(){return h.apply(c,arguments)}}var o={};Nc(r,function(c){o[c]=i(e,r,c)});for(var a=Ji(t),s=[];a&&!Hu(a)&&!Wu(s,a);)Nc(a,function(c){!o[c]&&qu(a,c,!qo)&&(o[c]=i(e,a,c))}),s.push(a),a=Ji(a);return o}function UC(t,e,r,n){var i=null;if(t&&_i(r,eo)){var o=t[Ya]||{};if(i=(o[r[eo]]||{})[e],i||$c("Missing ["+e+"] "+Qa),!i[Bc]&&o[Ho]!==!1){for(var a=!_i(t,e),s=Ji(t),c=[];a&&s&&!Hu(s)&&!Wu(c,s);){var l=s[e];if(l){a=l===n;break}c.push(s),s=Ji(s)}try{a&&(t[e]=i),i[Bc]=1}catch(u){o[Ho]=!1}}}return i}function LC(t,e,r){var n=e[t];return n===r&&(n=Ji(e)[t]),typeof n!==Qa&&$c("["+t+"] is not a "+Qa),n}function HC(t,e,r,n,i){function o(c,l){var u=function(){var h=UC(this,l,c,u)||LC(l,c,u);return h.apply(this,arguments)};return u[Mc]=1,u}if(!gg(t)){var a=r[Ya]=r[Ya]||{},s=a[e]=a[e]||{};a[Ho]!==!1&&(a[Ho]=!!i),Nc(r,function(c){qu(r,c,!1)&&r[c]!==n[c]&&(s[c]=r[c],delete r[c],(!_i(t,c)||t[c]&&!t[c][Mc])&&(t[c]=o(t,c)))})}}function qC(t,e){if(qo)for(var r=[],n=Ji(e);n&&!Hu(n)&&!Wu(r,n);){if(n===t)return!0;r.push(n),n=Ji(n)}return!1}function zu(t,e){return _i(t,Rn)?t.name||e||Gu:((t||{})[Xa]||{}).name||e||Gu}function ju(t,e,r,n){_i(t,Rn)||$c("theClass is an invalid class definition.");var i=t[Rn];qC(i,e)||$c("["+zu(t)+"] is not in class hierarchy of ["+zu(e)+"]");var o=null;_i(i,eo)?o=i[eo]:(o=mg+zu(t,"_")+"$"+Zu,Zu++,i[eo]=o);var a=ju[Vu],s=!!a[Oc];s&&n&&n[Oc]!==void 0&&(s=!!n[Oc]);var c=BC(e),l=OC(i,e,c,s);r(e,l);var u=!!qo&&!!a[Ku];u&&n&&(u=!!n[Ku]),HC(i,o,e,c,u!==!1)}var Xa,Rn,Qa,Ya,Mc,eo,mg,Bc,Ho,Vu,Gu,vg,Oc,Ku,Ja,qo,Zu,wg,nr,gr=_e(()=>{Xa="constructor",Rn="prototype",Qa="function",Ya="_dynInstFuncs",Mc="_isDynProxy",eo="_dynClass",mg="_dynCls$",Bc="_dynInstChk",Ho=Bc,Vu="_dfOpts",Gu="_unknown_",vg="__proto__",Oc="useBaseInst",Ku="setInstFuncs",Ja=Object,qo=Ja.getPrototypeOf,Zu=0,wg={setInstFuncs:!0,useBaseInst:!0},ju[Vu]=wg,nr=ju}),Pe,Re,Uc=_e(()=>{(function(t){t[t.CRITICAL=1]="CRITICAL",t[t.WARNING=2]="WARNING"})(Pe||(Pe={})),Re={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103}});function Xu(t){return Ic.toString.call(t)}function WC(t,e){return typeof t===e}function Nr(t){return t===void 0||typeof t===Yn}function Fe(t){return t===null||Nr(t)}function zC(t){return!Fe(t)}function Qu(t,e){return t&&Za.call(t,e)}function to(t){return typeof t===En}function St(t){return typeof t===Oo}function es(t,e,r,n){n===void 0&&(n=!1);var i=!1;if(!Fe(t))try{Fe(t[id])?Fe(t[nd])||(t[nd](rd+e,r),i=!0):(t[id](e,r,n),i=!0)}catch(o){}return i}function yg(t,e,r,n){if(n===void 0&&(n=!1),!Fe(t))try{Fe(t[ad])?Fe(t[od])||t[od](rd+e,r):t[ad](e,r,n)}catch(i){}}function jC(t){var e=t,r=/([^\w\d_$])/g;return r.test(t)&&(e=t.replace(r,"_")),e}function sr(t,e){if(t)for(var r in t)Za.call(t,r)&&e.call(t,r,t[r])}function VC(t,e){if(t&&e){var r=e.length,n=t.length;if(t===e)return!0;if(n>=r){for(var i=n-1,o=r-1;o>=0;o--){if(t[i]!=e[o])return!1;i--}return!0}}return!1}function Er(t,e){return t&&e?t.indexOf(e)!==-1:!1}function Yu(t){return Xu(t)==="[object Date]"}function ei(t){return Xu(t)==="[object Array]"}function Lc(t){return Xu(t)==="[object Error]"}function pt(t){return typeof t=="string"}function Ju(t){return typeof t=="number"}function ed(t){return typeof t=="boolean"}function xi(t){if(Yu(t)){var e=function(r){var n=String(r);return n.length===1&&(n="0"+n),n};return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"."+String((t.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}function gt(t,e,r){for(var n=t.length,i=0;i<n&&!(i in t&&e.call(r||t,t[i],i,t)===-1);i++);}function ts(t,e,r){for(var n=t.length,i=r||0,o=Math.max(i>=0?i:n-Math.abs(i),0);o<n;o++)if(o in t&&t[o]===e)return o;return-1}function rs(t,e,r){for(var n=t.length,i=r||t,o=new Array(n),a=0;a<n;a++)a in t&&(o[a]=e.call(i,t[a],t));return o}function bg(t,e,r){var n=t.length,i=0,o;if(arguments.length>=3)o=arguments[2];else{for(;i<n&&!(i in t);)i++;o=t[i++]}for(;i<n;)i in t&&(o=e(o,t[i],i,t)),i++;return o}function br(t){return typeof t!="string"?t:t.replace(/^\s+|\s+$/g,"")}function ro(t){var e=typeof t;e!==Oo&&(e!==En||t===null)&&Lu("objKeys called on non-object");var r=[];for(var n in t)t&&Za.call(t,n)&&r.push(n);if(Cg)for(var i=Hc.length,o=0;o<i;o++)t&&Za.call(t,Hc[o])&&r.push(Hc[o]);return r}function Wo(t,e,r,n){if(sd)try{var i={enumerable:!0,configurable:!0};return r&&(i.get=r),n&&(i.set=n),sd(t,e,i),!0}catch(o){}return!1}function Jr(){var t=Date;return t.now?t.now():new t().getTime()}function Tt(t){return Lc(t)?t.name:""}function Ct(t,e,r,n,i){var o=r;return t&&(o=t[e],o!==r&&(!i||i(o))&&(!n||n(r))&&(o=r,t[e]=o)),o}function Rr(t,e,r){var n;return t?(n=t[e],!n&&Fe(n)&&(n=Nr(r)?{}:r,t[e]=n)):n=Nr(r)?{}:r,n}function _g(t){return!t}function td(t){return!!t}function Tn(t){throw new Error(t)}function xg(t,e,r){if(t&&e&&t!==e&&to(t)&&to(e)){var n=function(o){if(pt(o)){var a=e[o];St(a)?(!r||r(o,!0,e,t))&&(t[o]=function(s){return function(){var c=arguments;return e[s].apply(e,c)}}(o)):(!r||r(o,!1,e,t))&&(Qu(t,o)&&delete t[o],Wo(t,o,function(){return e[o]},function(s){e[o]=s})||(t[o]=a))}};for(var i in e)n(i)}return t}function GC(t){return function(){function e(){var r=this;t&&sr(t,function(n,i){r[n]=i})}return e}()}function Sg(t){return t&&(t=Jn(Dc?Dc({},t):t)),t}var rd,nd,id,od,ad,sd,KC,ZC,Cg,Hc,Tr=_e(()=>{Ut(),rd="on",nd="attachEvent",id="addEventListener",od="detachEvent",ad="removeEventListener",sd=hg,KC=Jn.freeze,ZC=Jn.seal,Cg=!{toString:null}.propertyIsEnumerable("toString"),Hc=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]});function Ar(t){var e=Uo();return e&&e[t]?e[t]:t===ld&&qc()?window:null}function qc(){return Boolean(typeof window===En&&window)}function ns(){return qc()?window:Ar(ld)}function Eg(){return Boolean(typeof document===En&&document)}function An(){return Eg()?document:Ar(Rg)}function XC(){return Boolean(typeof navigator===En&&navigator)}function kn(){return XC()?navigator:Ar(Tg)}function QC(){return Boolean(typeof history===En&&history)}function YC(){return QC()?history:Ar(Ag)}function no(t){if(t&&$g){var e=Ar("__mockLocation");if(e)return e}return typeof location===En&&location?location:Ar(kg)}function JC(){return typeof console!==Yn?console:Ar(Ig)}function ti(){return Ar(Dg)}function zo(){return Boolean(typeof JSON===En&&JSON||Ar(ud)!==null)}function hn(){return zo()?JSON||Ar(ud):null}function e1(){return Ar(Pg)}function t1(){return Ar(Fg)}function r1(){var t=kn();return t&&t.product?t.product===Ng:!1}function Wc(){var t=kn();if(t&&(t.userAgent!==Gc||Vc===null)){Gc=t.userAgent;var e=(Gc||"").toLowerCase();Vc=Er(e,zc)||Er(e,jc)}return Vc}function cd(t){if(t===void 0&&(t=null),!t){var e=kn()||{};t=e?(e.userAgent||"").toLowerCase():""}var r=(t||"").toLowerCase();if(Er(r,zc))return parseInt(r.split(zc)[1]);if(Er(r,jc)){var n=parseInt(r.split(jc)[1]);if(n)return n+4}return null}function lt(t){var e=Object[Xr].toString.call(t),r="";return e==="[object Error]"?r="{ stack: '"+t.stack+"', message: '"+t.message+"', name: '"+t.name+"'":zo()&&(r=hn().stringify(t)),e+r}var ld,Rg,Tg,Ag,kg,Ig,Dg,ud,Pg,Fg,Ng,zc,jc,Vc,Gc,$g,is=_e(()=>{Ut(),Tr(),ld="window",Rg="document",Tg="navigator",Ag="history",kg="location",Ig="console",Dg="performance",ud="JSON",Pg="crypto",Fg="msCrypto",Ng="ReactNative",zc="msie",jc="trident/",Vc=null,Gc=null,$g=!1});function Mg(t){return t?'"'+t.replace(/\"/g,"")+'"':""}function Kc(t,e){return(t||{}).logger||new dd(e)}var Bg,Og,Ug,jo,dd,hd=_e(()=>{Uc(),is(),gr(),Tr(),Bg="AI (Internal): ",Og="AI: ",Ug="AITR_",jo=function(){function t(e,r,n,i){n===void 0&&(n=!1);var o=this;o.messageId=e,o.message=(n?Og:Bg)+e;var a="";zo()&&(a=hn().stringify(i));var s=(r?" message:"+Mg(r):"")+(i?" props:"+Mg(a):"");o.message+=s}return t.dataType="MessageData",t}(),dd=function(){function t(e){this.identifier="DiagnosticLogger",this.queue=[];var r=0,n={};nr(t,this,function(i){Fe(e)&&(e={}),i.consoleLoggingLevel=function(){return o("loggingLevelConsole",0)},i.telemetryLoggingLevel=function(){return o("loggingLevelTelemetry",1)},i.maxInternalMessageLimit=function(){return o("maxMessageLimit",25)},i.enableDebugExceptions=function(){return o("enableDebugExceptions",!1)},i.throwInternal=function(s,c,l,u,h){h===void 0&&(h=!1);var f=new jo(c,l,h,u);if(i.enableDebugExceptions())throw f;if(!Nr(f.message)){var p=i.consoleLoggingLevel();if(h){var b=+f.messageId;!n[b]&&p>=Pe.WARNING&&(i.warnToConsole(f.message),n[b]=!0)}else p>=Pe.WARNING&&i.warnToConsole(f.message);i.logInternalMessage(s,f)}},i.warnToConsole=function(s){var c=JC();if(c){var l="log";c.warn&&(l="warn"),St(c[l])&&c[l](s)}},i.resetInternalMessageCount=function(){r=0,n={}},i.logInternalMessage=function(s,c){if(!a()){var l=!0,u=Ug+c.messageId;if(n[u]?l=!1:n[u]=!0,l&&(s<=i.telemetryLoggingLevel()&&(i.queue.push(c),r++),r===i.maxInternalMessageLimit())){var h="Internal events throttle limit per PageView reached for this app.",f=new jo(Re.MessageLimitPerPVExceeded,h,!1);i.queue.push(f),i.warnToConsole(h)}}};function o(s,c){var l=e[s];return Fe(l)?c:l}function a(){return r>=i.maxInternalMessageLimit()}})}return t}()});function Vo(t,e,r,n,i){if(t){var o=t;if(St(o.getPerfMgr)&&(o=o.getPerfMgr()),o){var a=void 0,s=o.getCtx(Zc);try{if(a=o.create(e(),n,i),a){if(s&&a.setCtx&&(a.setCtx(Go.ParentContextKey,s),s.getCtx&&s.setCtx)){var c=s.getCtx(Go.ChildrenContextKey);c||(c=[],s.setCtx(Go.ChildrenContextKey,c)),c.push(a)}return o.setCtx(Zc,a),r(a)}}catch(l){a&&a.setCtx&&a.setCtx("exception",l)}finally{a&&o.fire(a),o.setCtx(Zc,s)}}}return r()}var io,Go,fd,Zc,Xc=_e(()=>{gr(),Tr(),io="ctx",Go=function(){function t(e,r,n){var i=this,o=!1;if(i.start=Jr(),i.name=e,i.isAsync=n,i.isChildEvt=function(){return!1},St(r)){var a;o=Wo(i,"payload",function(){return!a&&St(r)&&(a=r(),r=null),a})}i.getCtx=function(s){return s?s===t.ParentContextKey||s===t.ChildrenContextKey?i[s]:(i[io]||{})[s]:null},i.setCtx=function(s,c){if(s)if(s===t.ParentContextKey)i[s]||(i.isChildEvt=function(){return!0}),i[s]=c;else if(s===t.ChildrenContextKey)i[s]=c;else{var l=i[io]=i[io]||{};l[s]=c}},i.complete=function(){var s=0,c=i.getCtx(t.ChildrenContextKey);if(ei(c))for(var l=0;l<c.length;l++){var u=c[l];u&&(s+=u.time)}i.time=Jr()-i.start,i.exTime=i.time-s,i.complete=function(){},!o&&St(r)&&(i.payload=r())}}return t.ParentContextKey="parent",t.ChildrenContextKey="childEvts",t}(),fd=function(){function t(e){this.ctx={},nr(t,this,function(r){r.create=function(n,i,o){return new Go(n,i,o)},r.fire=function(n){n&&(n.complete(),e&&e.perfEvent(n))},r.setCtx=function(n,i){if(n){var o=r[io]=r[io]||{};o[n]=i}},r.getCtx=function(n){return(r[io]||{})[n]}})}return t}(),Zc="CoreUtils.doPerf"}),Lg,n1=_e(()=>{Xc(),Uc(),Tr(),Lg=function(){function t(e,r){var n=this,i=null,o=St(e.processTelemetry),a=St(e.setNextPlugin);n._hasRun=!1,n.getPlugin=function(){return e},n.getNext=function(){return i},n.setNext=function(s){i=s},n.processTelemetry=function(s,c){c||(c=r);var l=e?e.identifier:"TelemetryPluginChain";Vo(c?c.core():null,function(){return l+":processTelemetry"},function(){if(e&&o){n._hasRun=!0;try{c.setNext(i),a&&e.setNextPlugin(i),i&&(i._hasRun=!1),e.processTelemetry(s,c)}catch(h){var u=i&&i._hasRun;(!i||!u)&&c.diagLog().throwInternal(Pe.CRITICAL,Re.PluginException,"Plugin ["+e.identifier+"] failed during processTelemetry - "+h),i&&!u&&i.processTelemetry(s,c)}}else i&&(n._hasRun=!0,i.processTelemetry(s,c))},function(){return{item:s}},!s.sync)}}return t}()});function pd(t,e){var r=[];if(t&&t.length>0)for(var n=null,i=0;i<t.length;i++){var o=t[i];if(o&&St(o.processTelemetry)){var a=new Lg(o,e);r.push(a),n&&n.setNext(a),n=a}}return r.length>0?r[0]:null}function i1(t,e,r){var n=[],i=!r;if(t)for(;t;){var o=t.getPlugin();(i||o===r)&&(i=!0,n.push(o)),t=t.getNext()}return i||n.push(r),pd(n,e)}function o1(t,e,r){var n=t,i=!1;return r&&t&&(n=[],gt(t,function(o){(i||o===r)&&(i=!0,n.push(o))})),r&&!i&&(n||(n=[]),n.push(r)),pd(n,e)}var oo,gd=_e(()=>{hd(),n1(),Tr(),oo=function(){function t(e,r,n,i){var o=this,a=null;i!==null&&(e&&St(e.getPlugin)?a=i1(e,o,i||e.getPlugin()):i?a=o1(e,o,i):Nr(i)&&(a=pd(e,o))),o.core=function(){return n},o.diagLog=function(){return Kc(n,r)},o.getCfg=function(){return r},o.getExtCfg=function(s,c){c===void 0&&(c={});var l;if(r){var u=r.extensionConfig;u&&s&&(l=u[s])}return l||c},o.getConfig=function(s,c,l){l===void 0&&(l=!1);var u,h=o.getExtCfg(s,null);return h&&!Fe(h[c])?u=h[c]:r&&!Fe(r[c])&&(u=r[c]),Fe(u)?l:u},o.hasNext=function(){return a!=null},o.getNext=function(){return a},o.setNext=function(s){a=s},o.processNext=function(s){var c=a;c&&(a=c.getNext(),c.processTelemetry(s,o))},o.createNew=function(s,c){return s===void 0&&(s=null),new t(s||a,r,n,c)}}return t}()}),Hg,md,qg=_e(()=>{Hg="iKey",md="extensionConfig"}),os,ao,Wg=_e(()=>{gd(),Tr(),qg(),os="getPlugin",ao=function(){function t(){var e=this,r=!1,n=null,i=null;e.core=null,e.diagLog=function(o){return e._getTelCtx(o).diagLog()},e.isInitialized=function(){return r},e.setInitialized=function(o){r=o},e.setNextPlugin=function(o){i=o},e.processNext=function(o,a){a?a.processNext(o):i&&St(i.processTelemetry)&&i.processTelemetry(o,null)},e._getTelCtx=function(o){o===void 0&&(o=null);var a=o;if(!a){var s=n||new oo(null,{},e.core);i&&i[os]?a=s.createNew(null,i[os]):a=s.createNew(null,i)}return a},e._baseTelInit=function(o,a,s,c){o&&Ct(o,md,[],null,Fe),!c&&a&&(c=a.getProcessTelContext().getNext());var l=i;i&&i[os]&&(l=i[os]()),e.core=a,n=new oo(c,o,a,l),r=!0}}return t.prototype.initialize=function(e,r,n,i){this._baseTelInit(e,r,n,i)},t}()});function vd(t,e){for(var r=[],n=null,i=t.getNext();i;){var o=i.getPlugin();o&&(n&&St(n[yd])&&St(o[Qc])&&n[yd](o),(!St(o[bd])||!o[bd]())&&r.push(o),n=o,i=i.getNext())}gt(r,function(a){a.initialize(t.getCfg(),t.core(),e,t.getNext())})}function zg(t){return t.sort(function(e,r){var n=0,i=St(r[Qc]);return St(e[Qc])?n=i?e[wd]-r[wd]:1:i&&(n=-1),n})}var Qc,wd,yd,bd,jg=_e(()=>{Tr(),Qc="processTelemetry",wd="priority",yd="setNextPlugin",bd="isInitialized"}),Yc,Vg,Gg,a1=_e(()=>{Ut(),gr(),Wg(),gd(),jg(),Tr(),Yc=500,Vg="Channel has invalid priority",Gg=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.identifier="ChannelControllerPlugin",r.priority=Yc;var n;nr(e,r,function(s,c){s.setNextPlugin=function(l){},s.processTelemetry=function(l,u){n&&gt(n,function(h){if(h.length>0){var f=r._getTelCtx(u).createNew(h);f.processNext(l)}})},s.getChannelControls=function(){return n},s.initialize=function(l,u,h){s.isInitialized()||(c.initialize(l,u,h),a((l||{}).channels,h),gt(n,function(f){return vd(new oo(f,l,u),h)}))}});function i(s){gt(s,function(c){c.priority<Yc&&Tn(Vg+c.identifier)})}function o(s){s&&s.length>0&&(s=s.sort(function(c,l){return c.priority-l.priority}),i(s),n.push(s))}function a(s,c){if(n=[],s&&gt(s,function(u){return o(u)}),c){var l=[];gt(c,function(u){u.priority>Yc&&l.push(u)}),o(l)}}return r}return e._staticInit=function(){var r=e.prototype;Wo(r,"ChannelControls",r.getChannelControls),Wo(r,"channelQueue",r.getChannelControls)}(),e}(ao)});function Kg(t,e){var r=as[ri]||cs[ri];return r||(r=as[ri]=as(t,e),cs[ri]=r),r}function Jc(t){return t?t.isEnabled():!0}function s1(t){var e=t.cookieCfg=t.cookieCfg||{};if(Ct(e,"domain",t.cookieDomain,zC,Fe),Ct(e,"path",t.cookiePath||"/",null,Fe),Fe(e[rl])){var r=void 0;Nr(t[Cd])||(r=!t[Cd]),Nr(t[Ed])||(r=!t[Ed]),e[rl]=r}return e}function _d(t,e){var r;if(t)r=t.getCookieMgr();else if(e){var n=e.cookieCfg;n[ri]?r=n[ri]:r=as(e)}return r||(r=Kg(e,(t||{}).logger)),r}function as(t,e){var r=s1(t||cs),n=r.path||"/",i=r.domain,o=r[rl]!==!1,a={isEnabled:function(){var s=o&&Zg(e),c=cs[ri];return s&&c&&a!==c&&(s=Jc(c)),s},setEnabled:function(s){o=s!==!1},set:function(s,c,l,u,h){if(Jc(a)){var f={},p=br(c||en),b=p.indexOf(";");if(b!==-1&&(p=br(c.substring(0,b)),f=Xg(c.substring(b+1))),Ct(f,"domain",u||i,td,Nr),!Fe(l)){var w=Wc();if(Nr(f[tl])){var y=Jr(),x=y+l*1e3;if(x>0){var S=new Date;S.setTime(x),Ct(f,tl,Qg(S,w?xd:Sd)||Qg(S,w?xd:Sd)||en,td)}}w||Ct(f,"max-age",en+l,null,Nr)}var I=no();I&&I.protocol==="https:"&&(Ct(f,"secure",null,null,Nr),nl===null&&(nl=!em((kn()||{}).userAgent)),nl&&Ct(f,"SameSite","None",null,Nr)),Ct(f,"path",h||n,null,Nr);var D=r.setCookie||Jg;D(s,Yg(p,f))}},get:function(s){var c=en;return Jc(a)&&(c=(r.getCookie||c1)(s)),c},del:function(s,c){Jc(a)&&a.purge(s,c)},purge:function(s,c){if(Zg(e)){var l=(h={},h.path=c||"/",h[tl]="Thu, 01 Jan 1970 00:00:01 GMT",h);Wc()||(l["max-age"]="0");var u=r.delCookie||Jg;u(s,Yg(en,l))}var h}};return a[ri]=a,a}function Zg(t){if(ss===null){ss=!1;try{var e=Ko||{};ss=e[el]!==void 0}catch(r){t&&t.throwInternal(Pe.WARNING,Re.CannotAccessCookie,"Cannot access document.cookie - "+Tt(r),{exception:lt(r)})}}return ss}function Xg(t){var e={};if(t&&t.length){var r=br(t).split(";");gt(r,function(n){if(n=br(n||en),n){var i=n.indexOf("=");i===-1?e[n]=null:e[br(n.substring(0,i))]=br(n.substring(i+1))}})}return e}function Qg(t,e){return St(t[e])?t[e]():null}function Yg(t,e){var r=t||en;return sr(e,function(n,i){r+="; "+n+(Fe(i)?en:"="+i)}),r}function c1(t){var e=en;if(Ko){var r=Ko[el]||en;Rd!==r&&(Td=Xg(r),Rd=r),e=br(Td[t]||en)}return e}function Jg(t,e){Ko&&(Ko[el]=t+"="+e)}function em(t){return pt(t)?!!(Er(t,"CPU iPhone OS 12")||Er(t,"iPad; CPU OS 12")||Er(t,"Macintosh; Intel Mac OS X 10_14")&&Er(t,"Version/")&&Er(t,"Safari")||Er(t,"Macintosh; Intel Mac OS X 10_14")&&VC(t,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||Er(t,"Chrome/5")||Er(t,"Chrome/6")||Er(t,"UnrealEngine")&&!Er(t,"Chrome")||Er(t,"UCBrowser/12")||Er(t,"UCBrowser/11")):!1}var xd,Sd,el,tl,rl,Cd,Ed,ri,en,ss,nl,Rd,Ko,Td,cs,Ad=_e(()=>{Uc(),is(),Tr(),xd="toGMTString",Sd="toUTCString",el="cookie",tl="expires",rl="enabled",Cd="isCookieUseDisabled",Ed="disableCookiesUsage",ri="_ckMgr",en="",ss=null,nl=null,Rd=null,Ko=An(),Td={},cs={}}),tm,kd,Id,rm=_e(()=>{Ut(),gr(),a1(),gd(),jg(),Xc(),Ad(),Tr(),qg(),tm="Extensions must provide callback to initialize",kd="_notificationManager",Id=function(){function t(){var e=!1,r,n,i,o,a;nr(t,this,function(s){s._extensions=new Array,n=new Gg,s.logger=Pc({throwInternal:function(c,l,u,h,f){f===void 0&&(f=!1)},warnToConsole:function(c){},resetInternalMessageCount:function(){}}),r=[],s.isInitialized=function(){return e},s.initialize=function(c,l,u,h){s.isInitialized()&&Tn("Core should not be initialized more than once"),(!c||Fe(c.instrumentationKey))&&Tn("Please provide instrumentation key"),i=h,s[kd]=h,s.config=c||{},c.extensions=Fe(c.extensions)?[]:c.extensions;var f=Rr(c,md);f.NotificationManager=h,u&&(s.logger=u);var p=[];p.push.apply(p,l.concat(c.extensions)),p=zg(p);var b=[],w=[],y={};gt(p,function(x){(Fe(x)||Fe(x.initialize))&&Tn(tm);var S=x.priority,I=x.identifier;x&&S&&(Fe(y[S])?y[S]=I:u.warnToConsole("Two extensions have same priority #"+S+" - "+y[S]+", "+I)),!S||S<n.priority?b.push(x):w.push(x)}),p.push(n),b.push(n),p=zg(p),s._extensions=p,vd(new oo([n],c,s),p),vd(new oo(b,c,s),p),s._extensions=b,s.getTransmissionControls().length===0&&Tn("No channels available"),e=!0,s.releaseQueue()},s.getTransmissionControls=function(){return n.getChannelControls()},s.track=function(c){Ct(c,Hg,s.config.instrumentationKey,null,_g),Ct(c,"time",xi(new Date),null,_g),Ct(c,"ver","4.0",null,Fe),s.isInitialized()?s.getProcessTelContext().processNext(c):r.push(c)},s.getProcessTelContext=function(){var c=s._extensions,l=c;return(!c||c.length===0)&&(l=[n]),new oo(l,s.config,s)},s.getNotifyMgr=function(){return i||(i=Pc({addNotificationListener:function(c){},removeNotificationListener:function(c){},eventsSent:function(c){},eventsDiscarded:function(c,l){},eventsSendRequest:function(c,l){}}),s[kd]=i),i},s.getCookieMgr=function(){return a||(a=as(s.config,s.logger)),a},s.setCookieMgr=function(c){a=c},s.getPerfMgr=function(){return o||s.config&&s.config.enablePerfMgr&&(o=new fd(s.getNotifyMgr())),o},s.setPerfMgr=function(c){o=c},s.eventCnt=function(){return r.length},s.releaseQueue=function(){r.length>0&&(gt(r,function(c){s.getProcessTelContext().processNext(c)}),r=[])}})}return t}()}),Dd,nm=_e(()=>{gr(),Tr(),Dd=function(){function t(e){this.listeners=[];var r=!!(e||{}).perfEvtsSendAll;nr(t,this,function(n){n.addNotificationListener=function(i){n.listeners.push(i)},n.removeNotificationListener=function(i){for(var o=ts(n.listeners,i);o>-1;)n.listeners.splice(o,1),o=ts(n.listeners,i)},n.eventsSent=function(i){gt(n.listeners,function(o){o&&o.eventsSent&&setTimeout(function(){return o.eventsSent(i)},0)})},n.eventsDiscarded=function(i,o){gt(n.listeners,function(a){a&&a.eventsDiscarded&&setTimeout(function(){return a.eventsDiscarded(i,o)},0)})},n.eventsSendRequest=function(i,o){gt(n.listeners,function(a){if(a&&a.eventsSendRequest)if(o)setTimeout(function(){return a.eventsSendRequest(i,o)},0);else try{a.eventsSendRequest(i,o)}catch(s){}})},n.perfEvent=function(i){i&&(r||!i.isChildEvt())&&gt(n.listeners,function(o){if(o&&o.perfEvent)if(i.isAsync)setTimeout(function(){return o.perfEvent(i)},0);else try{o.perfEvent(i)}catch(a){}})}})}return t}()}),Pd,l1=_e(()=>{Ut(),rm(),PC(),nm(),Xc(),hd(),gr(),Tr(),Pd=function(t){Nt(e,t);function e(){var r=t.call(this)||this;return nr(e,r,function(n,i){n.initialize=function(s,c,l,u){i.initialize(s,c,l||new dd(s),u||new Dd(s))},n.track=function(s){Vo(n.getPerfMgr(),function(){return"AppInsightsCore:track"},function(){s===null&&(a(s),Tn("Invalid telemetry item")),o(s),i.track(s)},function(){return{item:s}},!s.sync)},n.addNotificationListener=function(s){var c=n.getNotifyMgr();c&&c.addNotificationListener(s)},n.removeNotificationListener=function(s){var c=n.getNotifyMgr();c&&c.removeNotificationListener(s)},n.pollInternalLogs=function(s){var c=n.config.diagnosticLogInterval;return(!c||!(c>0))&&(c=1e4),setInterval(function(){var l=n.logger?n.logger.queue:[];gt(l,function(u){var h={name:s||"InternalMessageId: "+u.messageId,iKey:n.config.instrumentationKey,time:xi(new Date),baseType:jo.dataType,baseData:{message:u.message}};n.track(h)}),l.length=0},c)};function o(s){if(Fe(s.name))throw a(s),Error("telemetry name required")}function a(s){var c=n.getNotifyMgr();c&&c.eventsDiscarded([s],ug.InvalidEvent)}}),r}return e}(Id)});function im(t){t<0&&(t>>>=0),Zo=123456789+t&ni,Xo=987654321-t&ni,Nd=!0}function om(){try{var t=Jr()&2147483647;im((Math.random()*Fd^t)+t)}catch(e){}}function am(t){return t>0?Math.floor(so()/ni*(t+1))>>>0:0}function so(t){var e,r=e1()||t1();return r&&r.getRandomValues?e=r.getRandomValues(new Uint32Array(1))[0]&ni:Wc()?(Nd||om(),e=sm()&ni):e=Math.floor(Fd*Math.random()|0),t||(e>>>=0),e}function u1(t){t?im(t):om()}function sm(t){Xo=36969*(Xo&65535)+(Xo>>16)&ni,Zo=18e3*(Zo&65535)+(Zo>>16)&ni;var e=(Xo<<16)+(Zo&65535)>>>0&ni|0;return t||(e>>>=0),e}var Fd,ni,Nd,Zo,Xo,cm=_e(()=>{is(),Tr(),Fd=4294967296,ni=4294967295,Nd=!1,Zo=123456789,Xo=987654321});function co(t,e){var r=!1,n=ns();n&&(r=es(n,t,e),r=es(n.body,t,e)||r);var i=An();return i&&(r=us.Attach(i,t,e)||r),r}function d1(){function t(){return am(15)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(um,function(e){var r=t()|0,n=e==="x"?r:r&3|8;return n.toString(16)})}function h1(){var t=ti();return t&&t.now?t.now():Jr()}function il(t){t===void 0&&(t=22);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=so()>>>0,n=0,i="";i.length<t;)n++,i+=e.charAt(r&63),r>>>=6,n===5&&(r=(so()<<2&4294967295|r&3)>>>0,n=0);return i}function In(){for(var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],e="",r,n=0;n<4;n++)r=so(),e+=t[r&15]+t[r>>4&15]+t[r>>8&15]+t[r>>12&15]+t[r>>16&15]+t[r>>20&15]+t[r>>24&15]+t[r>>28&15];var i=t[8+(so()&3)|0];return e.substr(0,8)+e.substr(9,4)+"4"+e.substr(13,3)+i+e.substr(16,3)+e.substr(19,12)}function Qo(t,e){var r=Kg(t,e),n=ol._canUseCookies;return Yo===null&&(Yo=[],ls=n,Wo(ol,"_canUseCookies",function(){return ls},function(i){ls=i,gt(Yo,function(o){o.setEnabled(i)})})),ts(Yo,r)===-1&&Yo.push(r),ed(n)&&r.setEnabled(n),ed(ls)&&r.setEnabled(ls),r}function lm(){Qo().setEnabled(!1)}function f1(t){return Qo(null,t).isEnabled()}function p1(t,e){return Qo(null,t).get(e)}function g1(t,e,r,n){Qo(null,t).set(e,r,null,n)}function m1(t,e){return Qo(null,t).del(e)}var Yo,ls,ol,um,us,v1=_e(()=>{Ut(),Ad(),is(),Tr(),cm(),Yo=null,ol={_canUseCookies:void 0,isTypeof:WC,isUndefined:Nr,isNullOrUndefined:Fe,hasOwnProperty:Qu,isFunction:St,isObject:to,isDate:Yu,isArray:ei,isError:Lc,isString:pt,isNumber:Ju,isBoolean:ed,toISOString:xi,arrForEach:gt,arrIndexOf:ts,arrMap:rs,arrReduce:bg,strTrim:br,objCreate:Pc,objKeys:ro,objDefineAccessors:Wo,addEventHandler:co,dateNow:Jr,isIE:Wc,disableCookies:lm,newGuid:d1,perfNow:h1,newId:il,randomValue:am,random32:so,mwcRandomSeed:u1,mwcRandom32:sm,generateW3CId:In},um=/[xy]/g,us={Attach:es,AttachEvent:es,Detach:yg,DetachEvent:yg}});function $d(t,e){if(t)for(var r=0;r<t.length&&!e(t[r],r);r++);}function Md(t,e,r,n,i){i>=0&&i<=2&&$d(t,function(o,a){var s=o.cbks,c=s[Ud[i]];if(c){e.ctx=function(){var h=n[a]=n[a]||{};return h};try{c.apply(e.inst,r)}catch(h){var l=e.err;try{var u=s[Ud[2]];u&&(e.err=h,u.apply(e.inst,r))}catch(f){}finally{e.err=l}}}})}function w1(t){return function(){var e=this,r=arguments,n=t.h,i={name:t.n,inst:e,ctx:null,set:c},o=[],a=s([i],r);function s(u,h){return $d(h,function(f){u.push(f)}),u}function c(u,h){r=s([],r),r[u]=h,a=s([i],r)}Md(n,i,a,o,0);var l=t.f;try{i.rslt=l.apply(e,r)}catch(u){throw i.err=u,Md(n,i,a,o,3),u}return Md(n,i,a,o,1),i.rslt}}function y1(t){if(t){if(Ld)return Ld(t);var e=t[hm]||t[Xr]||t[fm];if(e)return e}return null}function dm(t,e,r){var n=null;return t&&(Qu(t,e)?n=t:r&&(n=dm(y1(t),e,!1))),n}function b1(t,e,r){return t?Bd(t[Xr],e,r,!1):null}function Bd(t,e,r,n){if(n===void 0&&(n=!0),t&&e&&r){var i=dm(t,e,n);if(i){var o=i[e];if(typeof o===Oo){var a=o[Od];if(!a){a={i:0,n:e,f:o,h:[]};var s=w1(a);s[Od]=a,i[e]=s}var c={id:a.i,cbks:r,rm:function(){var l=this.id;$d(a.h,function(u,h){if(u.id===l)return a.h.splice(h,1),1})}};return a.i++,a.h.push(c),c}}}return null}var Od,Ud,hm,fm,Ld,_1=_e(()=>{Ut(),Tr(),Od="_aiHooks",Ud=["req","rsp","hkErr","fnErr"],hm="__proto__",fm="constructor",Ld=Object.getPrototypeOf}),vt=_e(()=>{l1(),rm(),Wg(),cm(),v1(),Tr(),is(),Ut(),nm(),Xc(),hd(),Uc(),_1(),Ad()}),Wt,pm=_e(()=>{Wt={requestContextHeader:"Request-Context",requestContextTargetKey:"appId",requestContextAppIdFormat:"appId=cid-v1:",requestIdHeader:"Request-Id",traceParentHeader:"traceparent",traceStateHeader:"tracestate",sdkContextHeader:"Sdk-Context",sdkContextHeaderAppIdRequest:"appId",requestContextHeaderLowerCase:"request-context"}});function Hd(t,e,r){var n=e.length,i=gm(t,e);if(i.length!==n){for(var o=0,a=i;r[a]!==void 0;)o++,a=i.substring(0,150-3)+wm(o);i=a}return i}function gm(t,e){var r;return e&&(e=br(e.toString()),e.length>150&&(r=e.substring(0,150),t.throwInternal(Pe.WARNING,Re.NameTooLong,"name is too long.  It has been truncated to "+150+" characters.",{name:e},!0))),r||e}function $r(t,e,r){r===void 0&&(r=1024);var n;return e&&(r=r||1024,e=br(e),e.toString().length>r&&(n=e.toString().substring(0,r),t.throwInternal(Pe.WARNING,Re.StringValueTooLong,"string value is too long. It has been truncated to "+r+" characters.",{value:e},!0))),n||e}function ds(t,e){return Wd(t,e,2048,Re.UrlTooLong)}function qd(t,e){var r;return e&&e.length>32768&&(r=e.substring(0,32768),t.throwInternal(Pe.WARNING,Re.MessageTruncated,"message is too long, it has been truncated to "+32768+" characters.",{message:e},!0)),r||e}function mm(t,e){var r;if(e){var n=""+e;n.length>32768&&(r=n.substring(0,32768),t.throwInternal(Pe.WARNING,Re.ExceptionTruncated,"exception is too long, it has been truncated to "+32768+" characters.",{exception:e},!0))}return r||e}function Si(t,e){if(e){var r={};sr(e,function(n,i){if(to(i)&&zo())try{i=hn().stringify(i)}catch(o){t.throwInternal(Pe.WARNING,Re.CannotSerializeObjectNonSerializable,"custom property is not valid",{exception:o},!0)}i=$r(t,i,8192),n=Hd(t,n,r),r[n]=i}),e=r}return e}function Ci(t,e){if(e){var r={};sr(e,function(n,i){n=Hd(t,n,r),r[n]=i}),e=r}return e}function vm(t,e){return e&&Wd(t,e,128,Re.IdTooLong).toString()}function Wd(t,e,r,n){var i;return e&&(e=br(e),e.length>r&&(i=e.substring(0,r),t.throwInternal(Pe.WARNING,n,"input is too long, it has been truncated to "+r+" characters.",{data:e},!0))),i||e}function wm(t){var e="00"+t;return e.substr(e.length-3)}var ym,fn=_e(()=>{vt(),ym={MAX_NAME_LENGTH:150,MAX_ID_LENGTH:128,MAX_PROPERTY_LENGTH:8192,MAX_STRING_LENGTH:1024,MAX_URL_LENGTH:2048,MAX_MESSAGE_LENGTH:32768,MAX_EXCEPTION_LENGTH:32768,sanitizeKeyAndAddUniqueness:Hd,sanitizeKey:gm,sanitizeString:$r,sanitizeUrl:ds,sanitizeMessage:qd,sanitizeException:mm,sanitizeProperties:Si,sanitizeMeasurements:Ci,sanitizeId:vm,sanitizeInput:Wd,padNumber:wm,trim:br}});function Jo(t){var e=null;if(St(Event))e=new Event(t);else{var r=An();r&&r.createEvent&&(e=r.createEvent("Event"),e.initEvent(t,!0,!0))}return e}var bm=_e(()=>{vt()});function Mt(t,e){return e===void 0&&(e=!1),t==null?e:t.toString().toLowerCase()==="true"}function ii(t){(isNaN(t)||t<0)&&(t=0),t=Math.round(t);var e=""+t%1e3,r=""+Math.floor(t/1e3)%60,n=""+Math.floor(t/(1e3*60))%60,i=""+Math.floor(t/(1e3*60*60))%24,o=Math.floor(t/(1e3*60*60*24));return e=e.length===1?"00"+e:e.length===2?"0"+e:e,r=r.length<2?"0"+r:r,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i,(o>0?o+".":"")+i+":"+n+":"+r+"."+e}function zd(){var t=kn();return"sendBeacon"in t&&t.sendBeacon}function _m(t,e){var r=null;return gt(t,function(n){if(n.identifier===e)return r=n,-1}),r}function xm(t,e,r,n,i){return!i&&pt(t)&&(t==="Script error."||t==="Script error")}var al=_e(()=>{vt()}),lo,sl,ea,cl,jd,tn,pn=_e(()=>{lo="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",sl="sampleRate",ea="ProcessLegacy",cl="http.method",jd="https://dc.services.visualstudio.com",tn="not_specified"}),uo,gn,Sm=_e(()=>{(function(t){t[t.LocalStorage=0]="LocalStorage",t[t.SessionStorage=1]="SessionStorage"})(uo||(uo={})),function(t){t[t.AI=0]="AI",t[t.AI_AND_W3C=1]="AI_AND_W3C",t[t.W3C=2]="W3C"}(gn||(gn={}))});function Vd(){return Kd()?ll(uo.LocalStorage):null}function ll(t){try{if(Fe(Uo()))return null;var e=new Date,r=Ar(t===uo.LocalStorage?"localStorage":"sessionStorage");r.setItem(e.toString(),e.toString());var n=r.getItem(e.toString())!==e.toString();if(r.removeItem(e.toString()),!n)return r}catch(i){}return null}function Gd(){return ta()?ll(uo.SessionStorage):null}function Cm(){Ei=!1,Ri=!1}function Kd(){return Ei===void 0&&(Ei=!!ll(uo.LocalStorage)),Ei}function Em(t,e){var r=Vd();if(r!==null)try{return r.getItem(e)}catch(n){Ei=!1,t.throwInternal(Pe.WARNING,Re.BrowserCannotReadLocalStorage,"Browser failed read of local storage. "+Tt(n),{exception:lt(n)})}return null}function Rm(t,e,r){var n=Vd();if(n!==null)try{return n.setItem(e,r),!0}catch(i){Ei=!1,t.throwInternal(Pe.WARNING,Re.BrowserCannotWriteLocalStorage,"Browser failed write to local storage. "+Tt(i),{exception:lt(i)})}return!1}function Tm(t,e){var r=Vd();if(r!==null)try{return r.removeItem(e),!0}catch(n){Ei=!1,t.throwInternal(Pe.WARNING,Re.BrowserFailedRemovalFromLocalStorage,"Browser failed removal of local storage item. "+Tt(n),{exception:lt(n)})}return!1}function ta(){return Ri===void 0&&(Ri=!!ll(uo.SessionStorage)),Ri}function x1(){var t=[];return ta()&&sr(Ar("sessionStorage"),function(e){t.push(e)}),t}function ul(t,e){var r=Gd();if(r!==null)try{return r.getItem(e)}catch(n){Ri=!1,t.throwInternal(Pe.WARNING,Re.BrowserCannotReadSessionStorage,"Browser failed read of session storage. "+Tt(n),{exception:lt(n)})}return null}function dl(t,e,r){var n=Gd();if(n!==null)try{return n.setItem(e,r),!0}catch(i){Ri=!1,t.throwInternal(Pe.WARNING,Re.BrowserCannotWriteSessionStorage,"Browser failed write to session storage. "+Tt(i),{exception:lt(i)})}return!1}function Am(t,e){var r=Gd();if(r!==null)try{return r.removeItem(e),!0}catch(n){Ri=!1,t.throwInternal(Pe.WARNING,Re.BrowserFailedRemovalFromSessionStorage,"Browser failed removal of session storage item. "+Tt(n),{exception:lt(n)})}return!1}var Ei,Ri,km=_e(()=>{vt(),Sm(),Ei=void 0,Ri=void 0});function hs(t){var e=Qd,r=Fm,n=r[e];return Xd.createElement?r[e]||(n=r[e]=Xd.createElement("a")):n={host:Pm(t,!0)},n.href=t,e++,e>=r.length&&(e=0),Qd=e,n}function Im(t){var e,r=hs(t);return r&&(e=r.href),e}function S1(t){var e,r=hs(t);return r&&(e=r.pathname),e}function Dm(t,e){return t?t.toUpperCase()+" "+e:e}function Pm(t,e){var r=Zd(t,e)||"";if(r){var n=r.match(/(www[0-9]?\.)?(.[^/:]+)(\:[\d]+)?/i);if(n!=null&&n.length>3&&pt(n[2])&&n[2].length>0)return n[2]+(n[3]||"")}return r}function Zd(t,e){var r=null;if(t){var n=t.match(/(\w*):\/\/(.[^/:]+)(\:[\d]+)?/i);if(n!=null&&n.length>2&&pt(n[2])&&n[2].length>0&&(r=n[2]||"",e&&n.length>2)){var i=(n[1]||"").toLowerCase(),o=n[3]||"";(i==="http"&&o===":80"||i==="https"&&o===":443")&&(o=""),r+=o}}return r}var Xd,Qd,Fm,Nm=_e(()=>{vt(),Xd=An()||{},Qd=0,Fm=[null,null,null,null,null]});function hl(t){return $m.indexOf(t.toLowerCase())!==-1}function C1(t,e,r,n){var i,o=n,a=n;if(e&&e.length>0){var s=hs(e);if(i=s.host,!o)if(s.pathname!=null){var c=s.pathname.length===0?"/":s.pathname;c.charAt(0)!=="/"&&(c="/"+c),a=s.pathname,o=$r(t,r?r+" "+c:c)}else o=$r(t,e)}else i=n,o=n;return{target:i,name:o,data:a}}function fs(){var t=ti();if(t&&t.now&&t.timing){var e=t.now()+t.timing.navigationStart;if(e>0)return e}return Jr()}function Mr(t,e){var r=null;return t!==0&&e!==0&&!Fe(t)&&!Fe(e)&&(r=e-t),r}var $m,Yd,Mm,Ti,Bm,Om=_e(()=>{vt(),pm(),fn(),bm(),al(),pn(),km(),Nm(),$m=["https://dc.services.visualstudio.com/v2/track","https://breeze.aimon.applicationinsights.io/v2/track","https://dc-int.services.visualstudio.com/v2/track"],Yd={NotSpecified:tn,createDomEvent:Jo,disableStorage:Cm,isInternalApplicationInsightsEndpoint:hl,canUseLocalStorage:Kd,getStorage:Em,setStorage:Rm,removeStorage:Tm,canUseSessionStorage:ta,getSessionStorageKeys:x1,getSessionStorage:ul,setSessionStorage:dl,removeSessionStorage:Am,disableCookies:lm,canUseCookies:f1,disallowsSameSiteNone:em,setCookie:g1,stringToBoolOrDefault:Mt,getCookie:p1,deleteCookie:m1,trim:br,newId:il,random32:function(){return so(!0)},generateW3CId:In,isArray:ei,isError:Lc,isDate:Yu,toISOStringForIE8:xi,getIEVersion:cd,msToTimeSpan:ii,isCrossOriginError:xm,dump:lt,getExceptionName:Tt,addEventHandler:es,IsBeaconApiSupported:zd,getExtension:_m},Mm={parseUrl:hs,getAbsoluteUrl:Im,getPathName:S1,getCompleteUrl:Dm,parseHost:Pm,parseFullHost:Zd},Ti={correlationIdPrefix:"cid-v1:",canIncludeCorrelationHeader:function(t,e,r){if(!e||t&&t.disableCorrelationHeaders)return!1;if(t&&t.correlationHeaderExcludePatterns){for(var n=0;n<t.correlationHeaderExcludePatterns.length;n++)if(t.correlationHeaderExcludePatterns[n].test(e))return!1}var i=hs(e).host.toLowerCase();if(i&&(i.indexOf(":443")!==-1||i.indexOf(":80")!==-1)&&(i=(Zd(e,!0)||"").toLowerCase()),(!t||!t.enableCorsCorrelation)&&i&&i!==r)return!1;var o=t&&t.correlationHeaderDomains;if(o){var a;if(gt(o,function(l){var u=new RegExp(l.toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));a=a||u.test(i)}),!a)return!1}var s=t&&t.correlationHeaderExcludedDomains;if(!s||s.length===0)return!0;for(var n=0;n<s.length;n++){var c=new RegExp(s[n].toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));if(c.test(i))return!1}return i&&i.length>0},getCorrelationContext:function(t){if(t){var e=Ti.getCorrelationContextValue(t,Wt.requestContextTargetKey);if(e&&e!==Ti.correlationIdPrefix)return e}},getCorrelationContextValue:function(t,e){if(t)for(var r=t.split(","),n=0;n<r.length;++n){var i=r[n].split("=");if(i.length===2&&i[0]===e)return i[1]}}},Bm={Now:fs,GetDuration:Mr}});function Um(t){if(!t)return{};var e=t.split(Lm),r=bg(e,function(i,o){var a=o.split(Hm);if(a.length===2){var s=a[0].toLowerCase(),c=a[1];i[s]=c}return i},{});if(ro(r).length>0){if(r.endpointsuffix){var n=r.location?r.location+".":"";r.ingestionendpoint=r.ingestionendpoint||"https://"+n+"dc."+r.endpointsuffix}r.ingestionendpoint=r.ingestionendpoint||jd}return r}var Lm,Hm,qm,E1=_e(()=>{pn(),vt(),Lm=";",Hm="=",qm={parse:Um}}),Jd,Wm=_e(()=>{Jd=function(){function t(){}return t}()}),eh,zm=_e(()=>{Ut(),Wm(),eh=function(t){Nt(e,t);function e(){return t.call(this)||this}return e}(Jd)}),jm,R1=_e(()=>{jm=function(){function t(){this.ver=1,this.sampleRate=100,this.tags={}}return t}()}),th,T1=_e(()=>{Ut(),R1(),fn(),vt(),pn(),th=function(t){Nt(e,t);function e(r,n,i){var o=t.call(this)||this;return o.name=$r(r,i)||tn,o.data=n,o.time=xi(new Date),o.aiDataContract={time:1,iKey:1,name:1,sampleRate:function(){return o.sampleRate===100?4:1},tags:1,data:1},o}return e}(jm)}),rh,Vm=_e(()=>{rh=function(){function t(){this.ver=2,this.properties={},this.measurements={}}return t}()}),mn,A1=_e(()=>{Ut(),Vm(),fn(),pn(),mn=function(t){Nt(e,t);function e(r,n,i,o){var a=t.call(this)||this;return a.aiDataContract={ver:1,name:1,properties:0,measurements:0},a.name=$r(r,n)||tn,a.properties=Si(r,i),a.measurements=Ci(r,o),a}return e.envelopeType="Microsoft.ApplicationInsights.{0}.Event",e.dataType="EventData",e}(rh)}),Gm,k1=_e(()=>{Gm=function(){function t(){}return t}()}),Km,I1=_e(()=>{Km=function(){function t(){this.ver=2,this.exceptions=[],this.properties={},this.measurements={}}return t}()}),Zm,D1=_e(()=>{Zm=function(){function t(){this.hasFullStack=!0,this.parsedStack=[]}return t}()});function nh(t,e){var r=t;return r&&!pt(r)&&(JSON&&JSON.stringify?(r=JSON.stringify(t),e&&(!r||r==="{}")&&(St(t.toString)?r=t.toString():r=""+t)):r=""+t+" - (Missing JSON.stringify)"),r||""}function Xm(t,e){var r=t;return t&&(r=t[gl]||t[ah]||"",r&&!pt(r)&&(r=nh(r,!0)),t.filename&&(r=r+" @"+(t.filename||"")+":"+(t.lineno||"?")+":"+(t.colno||"?"))),e&&e!=="String"&&e!=="Object"&&e!=="Error"&&(r||"").indexOf(e)===-1&&(r=e+": "+r),r||""}function P1(t){return to(t)?"hasFullStack"in t&&"typeName"in t:!1}function F1(t){return to(t)?"ver"in t&&"exceptions"in t&&"properties"in t:!1}function Qm(t){return t&&t.src&&pt(t.src)&&t.obj&&ei(t.obj)}function ra(t){var e=t||"";pt(e)||(pt(e[Qr])?e=e[Qr]:e=""+e);var r=e.split(`
`);return{src:e,obj:r}}function N1(t){for(var e=[],r=t.split(`
`),n=0;n<r.length;n++){var i=r[n];r[n+1]&&(i+="@"+r[n+1],n++),e.push(i)}return{src:t,obj:e}}function Ym(t){var e=null;if(t)try{if(t[Qr])e=ra(t[Qr]);else if(t[ho]&&t[ho][Qr])e=ra(t[ho][Qr]);else if(t.exception&&t.exception[Qr])e=ra(t.exception[Qr]);else if(Qm(t))e=t;else if(Qm(t[pl]))e=t[pl];else if(window.opera&&t[gl])e=N1(t.message);else if(pt(t))e=ra(t);else{var r=t[gl]||t[ah]||"";pt(t[oh])&&(r&&(r+=`
`),r+=" from "+t[oh]),r&&(e=ra(r))}}catch(n){e=ra(n)}return e||{src:"",obj:null}}function $1(t){var e="";return t&&(t.obj?gt(t.obj,function(r){e+=r+`
`}):e=t.src||""),e}function M1(t){var e,r=t.obj;if(r&&r.length>0){e=[];var n=0,i=0;gt(r,function(b){var w=b.toString();if(ml.regex.test(w)){var y=new ml(w,n++);i+=y.sizeInBytes,e.push(y)}});var o=32*1024;if(i>o)for(var a=0,s=e.length-1,c=0,l=a,u=s;a<s;){var h=e[a].sizeInBytes,f=e[s].sizeInBytes;if(c+=h+f,c>o){var p=u-l+1;e.splice(l,p);break}l=a,u=s,a++,s--}}return e}function fl(t){var e="";if(t&&(e=t.typeName||t.name||"",!e))try{var r=/function (.{1,200})\(/,n=r.exec(t.constructor.toString());e=n&&n.length>1?n[1]:""}catch(i){}return e}function ih(t){if(t)try{if(!pt(t)){var e=fl(t),r=nh(t,!1);return(!r||r==="{}")&&(t[ho]&&(t=t[ho],e=fl(t)),r=nh(t,!0)),r.indexOf(e)!==0&&e!=="String"?e+":"+r:r}}catch(n){}return""+(t||"")}var Jm,ho,Qr,pl,oh,gl,ah,Br,sh,ml,B1=_e(()=>{Ut(),k1(),I1(),D1(),fn(),vt(),pn(),Jm="<no_method>",ho="error",Qr="stack",pl="stackDetails",oh="errorSrc",gl="message",ah="description",Br=function(t){Nt(e,t);function e(r,n,i,o,a,s){var c=t.call(this)||this;return c.aiDataContract={ver:1,exceptions:1,severityLevel:0,properties:0,measurements:0},F1(n)?(c.exceptions=n.exceptions,c.properties=n.properties,c.measurements=n.measurements,n.severityLevel&&(c.severityLevel=n.severityLevel),n.id&&(c.id=n.id),n.problemGroup&&(c.problemGroup=n.problemGroup),c.ver=2,Fe(n.isManual)||(c.isManual=n.isManual)):(i||(i={}),c.exceptions=[new sh(r,n,i)],c.properties=Si(r,i),c.measurements=Ci(r,o),a&&(c.severityLevel=a),s&&(c.id=s)),c}return e.CreateAutoException=function(r,n,i,o,a,s,c,l){var u=fl(a||s||r);return{message:Xm(r,u),url:n,lineNumber:i,columnNumber:o,error:ih(a||s||r),evt:ih(s||r),typeName:u,stackDetails:Ym(c||a||s),errorSrc:l}},e.CreateFromInterface=function(r,n,i,o){var a=n.exceptions&&rs(n.exceptions,function(c){return sh.CreateFromInterface(r,c)}),s=new e(r,Lo({},n,{exceptions:a}),i,o);return s},e.prototype.toInterface=function(){var r=this,n=r.exceptions,i=r.properties,o=r.measurements,a=r.severityLevel,s=r.ver,c=r.problemGroup,l=r.id,u=r.isManual,h=n instanceof Array&&rs(n,function(f){return f.toInterface()})||void 0;return{ver:"4.0",exceptions:h,severityLevel:a,properties:i,measurements:o,problemGroup:c,id:l,isManual:u}},e.CreateSimpleException=function(r,n,i,o,a,s){return{exceptions:[{hasFullStack:!0,message:r,stack:a,typeName:n}]}},e.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",e.dataType="ExceptionData",e.formatError=ih,e}(Km),sh=function(t){Nt(e,t);function e(r,n,i){var o=t.call(this)||this;if(o.aiDataContract={id:0,outerId:0,typeName:1,message:1,hasFullStack:0,stack:0,parsedStack:2},P1(n))o.typeName=n.typeName,o.message=n.message,o[Qr]=n[Qr],o.parsedStack=n.parsedStack,o.hasFullStack=n.hasFullStack;else{var a=n,s=a&&a.evt;Lc(a)||(a=a[ho]||s||a),o.typeName=$r(r,fl(a))||tn,o.message=qd(r,Xm(n||a,o.typeName))||tn;var c=n[pl]||Ym(n);o.parsedStack=M1(c),o[Qr]=mm(r,$1(c)),o.hasFullStack=ei(o.parsedStack)&&o.parsedStack.length>0,i&&(i.typeName=i.typeName||o.typeName)}return o}return e.prototype.toInterface=function(){var r=this.parsedStack instanceof Array&&rs(this.parsedStack,function(i){return i.toInterface()}),n={id:this.id,outerId:this.outerId,typeName:this.typeName,message:this.message,hasFullStack:this.hasFullStack,stack:this[Qr],parsedStack:r||void 0};return n},e.CreateFromInterface=function(r,n){var i=n.parsedStack instanceof Array&&rs(n.parsedStack,function(a){return ml.CreateFromInterface(a)})||n.parsedStack,o=new e(r,Lo({},n,{parsedStack:i}));return o},e}(Zm),ml=function(t){Nt(e,t);function e(r,n){var i=t.call(this)||this;if(i.sizeInBytes=0,i.aiDataContract={level:1,method:1,assembly:0,fileName:0,line:0},typeof r=="string"){var o=r;i.level=n,i.method=Jm,i.assembly=br(o),i.fileName="",i.line=0;var a=o.match(e.regex);a&&a.length>=5&&(i.method=br(a[2])||i.method,i.fileName=br(a[4]),i.line=parseInt(a[5])||0)}else i.level=r.level,i.method=r.method,i.assembly=r.assembly,i.fileName=r.fileName,i.line=r.line,i.sizeInBytes=0;return i.sizeInBytes+=i.method.length,i.sizeInBytes+=i.fileName.length,i.sizeInBytes+=i.assembly.length,i.sizeInBytes+=e.baseSize,i.sizeInBytes+=i.level.toString().length,i.sizeInBytes+=i.line.toString().length,i}return e.CreateFromInterface=function(r){return new e(r,null)},e.prototype.toInterface=function(){return{level:this.level,method:this.method,assembly:this.assembly,fileName:this.fileName,line:this.line}},e.regex=/^([\s]+at)?[\s]{0,50}([^\@\()]+?)[\s]{0,50}(\@|\()([^\(\n]+):([0-9]+):([0-9]+)(\)?)$/,e.baseSize=58,e}(Gm)}),ev,O1=_e(()=>{ev=function(){function t(){this.ver=2,this.metrics=[],this.properties={},this.measurements={}}return t}()}),ch,U1=_e(()=>{(function(t){t[t.Measurement=0]="Measurement",t[t.Aggregation=1]="Aggregation"})(ch||(ch={}))}),tv,L1=_e(()=>{U1(),tv=function(){function t(){this.kind=ch.Measurement}return t}()}),rv,H1=_e(()=>{Ut(),L1(),rv=function(t){Nt(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.aiDataContract={name:1,kind:0,value:1,count:0,min:0,max:0,stdDev:0},r}return e}(tv)}),Dn,q1=_e(()=>{Ut(),O1(),fn(),H1(),pn(),Dn=function(t){Nt(e,t);function e(r,n,i,o,a,s,c,l){var u=t.call(this)||this;u.aiDataContract={ver:1,metrics:1,properties:0};var h=new rv;return h.count=o>0?o:void 0,h.max=isNaN(s)||s===null?void 0:s,h.min=isNaN(a)||a===null?void 0:a,h.name=$r(r,n)||tn,h.value=i,u.metrics=[h],u.properties=Si(r,c),u.measurements=Ci(r,l),u}return e.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",e.dataType="MetricData",e}(ev)}),vl,lh=_e(()=>{Ut(),Vm(),vl=function(t){Nt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(rh)}),vn,W1=_e(()=>{Ut(),lh(),fn(),al(),pn(),vn=function(t){Nt(e,t);function e(r,n,i,o,a,s,c){var l=t.call(this)||this;return l.aiDataContract={ver:1,name:0,url:0,duration:0,properties:0,measurements:0,id:0},l.id=vm(r,c),l.url=ds(r,i),l.name=$r(r,n)||tn,isNaN(o)||(l.duration=ii(o)),l.properties=Si(r,a),l.measurements=Ci(r,s),l}return e.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",e.dataType="PageviewData",e}(vl)}),nv,z1=_e(()=>{nv=function(){function t(){this.ver=2,this.success=!0,this.properties={},this.measurements={}}return t}()}),Pn,j1=_e(()=>{Ut(),fn(),Om(),z1(),al(),Pn=function(t){Nt(e,t);function e(r,n,i,o,a,s,c,l,u,h,f,p){u===void 0&&(u="Ajax");var b=t.call(this)||this;b.aiDataContract={id:1,ver:1,name:0,resultCode:0,duration:0,success:0,data:0,target:0,type:0,properties:0,measurements:0,kind:0,value:0,count:0,min:0,max:0,stdDev:0,dependencyKind:0,dependencySource:0,commandName:0,dependencyTypeName:0},b.id=n,b.duration=ii(a),b.success=s,b.resultCode=c+"",b.type=$r(r,u);var w=C1(r,i,l,o);return b.data=ds(r,o)||w.data,b.target=$r(r,w.target),h&&(b.target=b.target+" | "+h),b.name=$r(r,w.name),b.properties=Si(r,f),b.measurements=Ci(r,p),b}return e.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",e.dataType="RemoteDependencyData",e}(nv)}),iv,V1=_e(()=>{iv=function(){function t(){this.ver=2,this.properties={},this.measurements={}}return t}()}),oi,G1=_e(()=>{Ut(),V1(),fn(),pn(),oi=function(t){Nt(e,t);function e(r,n,i,o,a){var s=t.call(this)||this;return s.aiDataContract={ver:1,message:1,severityLevel:0,properties:0},n=n||tn,s.message=qd(r,n),s.properties=Si(r,o),s.measurements=Ci(r,a),i&&(s.severityLevel=i),s}return e.envelopeType="Microsoft.ApplicationInsights.{0}.Message",e.dataType="MessageData",e}(iv)}),ov,K1=_e(()=>{Ut(),lh(),ov=function(t){Nt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(vl)}),ai,Z1=_e(()=>{Ut(),K1(),fn(),pn(),ai=function(t){Nt(e,t);function e(r,n,i,o,a,s,c){var l=t.call(this)||this;return l.aiDataContract={ver:1,name:0,url:0,duration:0,perfTotal:0,networkConnect:0,sentRequest:0,receivedResponse:0,domProcessing:0,properties:0,measurements:0},l.url=ds(r,i),l.name=$r(r,n)||tn,l.properties=Si(r,a),l.measurements=Ci(r,s),c&&(l.domProcessing=c.domProcessing,l.duration=c.duration,l.networkConnect=c.networkConnect,l.perfTotal=c.perfTotal,l.receivedResponse=c.receivedResponse,l.sentRequest=c.sentRequest),l}return e.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",e.dataType="PageviewPerformanceData",e}(ov)}),si,X1=_e(()=>{Ut(),zm(),si=function(t){Nt(e,t);function e(r,n){var i=t.call(this)||this;return i.aiDataContract={baseType:1,baseData:1},i.baseType=r,i.baseData=n,i}return e}(eh)}),ps,Q1=_e(()=>{(function(t){t[t.Verbose=0]="Verbose",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.Critical=4]="Critical"})(ps||(ps={}))}),av,Y1=_e(()=>{vt(),av=function(){function t(){}return t.getConfig=function(e,r,n,i){i===void 0&&(i=!1);var o;return n&&e.extensionConfig&&e.extensionConfig[n]&&!Fe(e.extensionConfig[n][r])?o=e.extensionConfig[n][r]:o=e[r],Fe(o)?i:o},t}()});function Ai(t){var e="ai."+t+".";return function(r){return e+r}}var na,ir,gs,fo,wl,ci,ki,ia,yl,sv=_e(()=>{Ut(),vt(),na=Ai("application"),ir=Ai("device"),gs=Ai("location"),fo=Ai("operation"),wl=Ai("session"),ci=Ai("user"),ki=Ai("cloud"),ia=Ai("internal"),yl=function(t){Nt(e,t);function e(){return t.call(this)||this}return e}(GC({applicationVersion:na("ver"),applicationBuild:na("build"),applicationTypeId:na("typeId"),applicationId:na("applicationId"),applicationLayer:na("layer"),deviceId:ir("id"),deviceIp:ir("ip"),deviceLanguage:ir("language"),deviceLocale:ir("locale"),deviceModel:ir("model"),deviceFriendlyName:ir("friendlyName"),deviceNetwork:ir("network"),deviceNetworkName:ir("networkName"),deviceOEMName:ir("oemName"),deviceOS:ir("os"),deviceOSVersion:ir("osVersion"),deviceRoleInstance:ir("roleInstance"),deviceRoleName:ir("roleName"),deviceScreenResolution:ir("screenResolution"),deviceType:ir("type"),deviceMachineName:ir("machineName"),deviceVMName:ir("vmName"),deviceBrowser:ir("browser"),deviceBrowserVersion:ir("browserVersion"),locationIp:gs("ip"),locationCountry:gs("country"),locationProvince:gs("province"),locationCity:gs("city"),operationId:fo("id"),operationName:fo("name"),operationParentId:fo("parentId"),operationRootId:fo("rootId"),operationSyntheticSource:fo("syntheticSource"),operationCorrelationVector:fo("correlationVector"),sessionId:wl("id"),sessionIsFirst:wl("isFirst"),sessionIsNew:wl("isNew"),userAccountAcquisitionDate:ci("accountAcquisitionDate"),userAccountId:ci("accountId"),userAgent:ci("userAgent"),userId:ci("id"),userStoreRegion:ci("storeRegion"),userAuthUserId:ci("authUserId"),userAnonymousUserAcquisitionDate:ci("anonUserAcquisitionDate"),userAuthenticatedUserAcquisitionDate:ci("authUserAcquisitionDate"),cloudName:ki("name"),cloudRole:ki("role"),cloudRoleVer:ki("roleVer"),cloudRoleInstance:ki("roleInstance"),cloudEnvironment:ki("environment"),cloudLocation:ki("location"),cloudDeploymentUnit:ki("deploymentUnit"),internalNodeName:ia("nodeName"),internalSdkVersion:ia("sdkVersion"),internalAgentVersion:ia("agentVersion"),internalSnippet:ia("snippet"),internalSdkSrc:ia("sdkSrc")}))}),Fn,J1=_e(()=>{fn(),vt(),pn(),Fn=function(){function t(){}return t.create=function(e,r,n,i,o,a){if(n=$r(i,n)||tn,Fe(e)||Fe(r)||Fe(n))throw Error("Input doesn't contain all required fields");var s={name:n,time:xi(new Date),iKey:"",ext:a||{},tags:[],data:{},baseType:r,baseData:e};return Fe(o)||sr(o,function(c,l){s.data[c]=l}),s},t}()}),Or,Lt,eE=_e(()=>{sv(),Or={UserExt:"user",DeviceExt:"device",TraceExt:"trace",WebExt:"web",AppExt:"app",OSExt:"os",SessionExt:"ses",SDKExt:"sdk"},Lt=new yl}),oa,bl,uh,cr=_e(()=>{Om(),E1(),pm(),pn(),zm(),Wm(),T1(),A1(),B1(),q1(),W1(),lh(),j1(),G1(),Z1(),X1(),Q1(),Y1(),sv(),fn(),J1(),eE(),Sm(),al(),bm(),km(),Nm(),oa="AppInsightsPropertiesPlugin",bl="AppInsightsChannelPlugin",uh="ApplicationInsightsAnalytics"}),cv,tE=_e(()=>{cr(),vt(),gr(),cv=function(){function t(e,r,n,i){nr(t,this,function(o){var a=null,s=[],c=!1,l;n&&(l=n.logger);function u(){n&&gt(n.getTransmissionControls(),function(f){gt(f,function(p){return p.flush(!0)})})}function h(f){s.push(f),a||(a=setInterval(function(){var p=s.slice(0),b=!1;s=[],gt(p,function(w){w()?b=!0:s.push(w)}),s.length===0&&(clearInterval(a),a=null),b&&u()},100))}o.trackPageView=function(f,p){var b=f.name;if(Fe(b)||typeof b!="string"){var w=An();b=f.name=w&&w.title||""}var y=f.uri;if(Fe(y)||typeof y!="string"){var x=no();y=f.uri=x&&x.href||""}if(!i.isPerformanceTimingSupported()){e.sendPageViewInternal(f,p),u(),l.throwInternal(Pe.WARNING,Re.NavigationTimingNotSupported,"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info.");return}var S=!1,I,D=i.getPerformanceTiming().navigationStart;D>0&&(I=Mr(D,+new Date),i.shouldCollectDuration(I)||(I=void 0));var U;!Fe(p)&&!Fe(p.duration)&&(U=p.duration),(r||!isNaN(U))&&(isNaN(U)&&(p||(p={}),p.duration=I),e.sendPageViewInternal(f,p),u(),S=!0);var te=6e4;p||(p={}),h(function(){var J=!1;try{if(i.isPerformanceTimingDataReady()){J=!0;var G={name:b,uri:y};i.populatePageViewPerformanceEvent(G),!G.isValid&&!S?(p.duration=I,e.sendPageViewInternal(f,p)):(S||(p.duration=G.durationMs,e.sendPageViewInternal(f,p)),c||(e.sendPageViewPerformanceInternal(G,p),c=!0))}else D>0&&Mr(D,+new Date)>te&&(J=!0,S||(p.duration=te,e.sendPageViewInternal(f,p)))}catch(ue){l.throwInternal(Pe.CRITICAL,Re.TrackPVFailedCalc,"trackPageView failed on page load calculation: "+Tt(ue),{exception:lt(ue)})}return J})}})}return t}()}),lv,uv,rE=_e(()=>{cr(),vt(),lv=function(){function t(e,r){this.prevPageVisitDataKeyName="prevPageVisitData",this.pageVisitTimeTrackingHandler=r,this._logger=e}return t.prototype.trackPreviousPageVisit=function(e,r){try{var n=this.restartPageVisitTimer(e,r);n&&this.pageVisitTimeTrackingHandler(n.pageName,n.pageUrl,n.pageVisitTime)}catch(i){this._logger.warnToConsole("Auto track page visit time failed, metric will not be collected: "+lt(i))}},t.prototype.restartPageVisitTimer=function(e,r){try{var n=this.stopPageVisitTimer();return this.startPageVisitTimer(e,r),n}catch(i){return this._logger.warnToConsole("Call to restart failed: "+lt(i)),null}},t.prototype.startPageVisitTimer=function(e,r){try{if(ta()){ul(this._logger,this.prevPageVisitDataKeyName)!=null&&Tn("Cannot call startPageVisit consecutively without first calling stopPageVisit");var n=new uv(e,r),i=hn().stringify(n);dl(this._logger,this.prevPageVisitDataKeyName,i)}}catch(o){this._logger.warnToConsole("Call to start failed: "+lt(o))}},t.prototype.stopPageVisitTimer=function(){try{if(ta()){var e=Jr(),r=ul(this._logger,this.prevPageVisitDataKeyName);if(r&&zo()){var n=hn().parse(r);return n.pageVisitTime=e-n.pageVisitStartTime,Am(this._logger,this.prevPageVisitDataKeyName),n}else return null}return null}catch(i){return this._logger.warnToConsole("Stop page visit timer failed: "+lt(i)),null}},t}(),uv=function(){function t(e,r){this.pageVisitStartTime=Jr(),this.pageName=e,this.pageUrl=r}return t}()}),dv,nE=_e(()=>{cr(),vt(),dv=function(){function t(e){this.MAX_DURATION_ALLOWED=36e5,e&&(this._logger=e.logger)}return t.prototype.populatePageViewPerformanceEvent=function(e){e.isValid=!1;var r=this.getPerformanceNavigationTiming(),n=this.getPerformanceTiming(),i=0,o=0,a=0,s=0,c=0;(r||n)&&(r?(i=r.duration,o=r.startTime===0?r.connectEnd:Mr(r.startTime,r.connectEnd),a=Mr(r.requestStart,r.responseStart),s=Mr(r.responseStart,r.responseEnd),c=Mr(r.responseEnd,r.loadEventEnd)):(i=Mr(n.navigationStart,n.loadEventEnd),o=Mr(n.navigationStart,n.connectEnd),a=Mr(n.requestStart,n.responseStart),s=Mr(n.responseStart,n.responseEnd),c=Mr(n.responseEnd,n.loadEventEnd)),i===0?this._logger.throwInternal(Pe.WARNING,Re.ErrorPVCalc,"error calculating page view performance.",{total:i,network:o,request:a,response:s,dom:c}):this.shouldCollectDuration(i,o,a,s,c)?i<Math.floor(o)+Math.floor(a)+Math.floor(s)+Math.floor(c)?this._logger.throwInternal(Pe.WARNING,Re.ClientPerformanceMathError,"client performance math error.",{total:i,network:o,request:a,response:s,dom:c}):(e.durationMs=i,e.perfTotal=e.duration=ii(i),e.networkConnect=ii(o),e.sentRequest=ii(a),e.receivedResponse=ii(s),e.domProcessing=ii(c),e.isValid=!0):this._logger.throwInternal(Pe.WARNING,Re.InvalidDurationValue,"Invalid page load duration value. Browser perf data won't be sent.",{total:i,network:o,request:a,response:s,dom:c}))},t.prototype.getPerformanceTiming=function(){return this.isPerformanceTimingSupported()?ti().timing:null},t.prototype.getPerformanceNavigationTiming=function(){return this.isPerformanceNavigationTimingSupported()?ti().getEntriesByType("navigation")[0]:null},t.prototype.isPerformanceNavigationTimingSupported=function(){var e=ti();return e&&e.getEntriesByType&&e.getEntriesByType("navigation").length>0},t.prototype.isPerformanceTimingSupported=function(){var e=ti();return e&&e.timing},t.prototype.isPerformanceTimingDataReady=function(){var e=ti(),r=e?e.timing:0;return r&&r.domainLookupStart>0&&r.navigationStart>0&&r.responseStart>0&&r.requestStart>0&&r.loadEventEnd>0&&r.responseEnd>0&&r.connectEnd>0&&r.domLoading>0},t.prototype.shouldCollectDuration=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=kn()||{},i=["googlebot","adsbot-google","apis-google","mediapartners-google"],o=n.userAgent,a=!1;if(o)for(var s=0;s<i.length;s++)a=a||o.toLowerCase().indexOf(i[s])!==-1;if(a)return!1;for(var s=0;s<e.length;s++)if(e[s]<0||e[s]>=this.MAX_DURATION_ALLOWED)return!1;return!0},t}()});function ms(t,e){t&&t.dispatchEvent&&e&&t.dispatchEvent(e)}var dh,_l,hh,fh,iE=_e(()=>{Ut(),cr(),vt(),tE(),rE(),nE(),gr(),dh="duration",_l="event",hh=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.identifier=uh,r.priority=180,r.autoRoutePVDelay=500;var n,i,o,a=0,s,c;return nr(e,r,function(l,u){var h=no(!0);s=h&&h.href||"",l.getCookieMgr=function(){return _d(l.core)},l.processTelemetry=function(y,x){Vo(l.core,function(){return l.identifier+":processTelemetry"},function(){var S=!1,I=l._telemetryInitializers.length;x=l._getTelCtx(x);for(var D=0;D<I;++D){var U=l._telemetryInitializers[D];if(U)try{if(U.apply(null,[y])===!1){S=!0;break}}catch(te){x.diagLog().throwInternal(Pe.CRITICAL,Re.TelemetryInitializerFailed,"One of telemetry initializers failed, telemetry item will not be sent: "+Tt(te),{exception:lt(te)},!0)}}S||l.processNext(y,x)},function(){return{item:y}},!y.sync)},l.trackEvent=function(y,x){try{var S=Fn.create(y,mn.dataType,mn.envelopeType,l.diagLog(),x);l.core.track(S)}catch(I){l.diagLog().throwInternal(Pe.WARNING,Re.TrackTraceFailed,"trackTrace failed, trace will not be collected: "+Tt(I),{exception:lt(I)})}},l.startTrackEvent=function(y){try{n.start(y)}catch(x){l.diagLog().throwInternal(Pe.CRITICAL,Re.StartTrackEventFailed,"startTrackEvent failed, event will not be collected: "+Tt(x),{exception:lt(x)})}},l.stopTrackEvent=function(y,x,S){try{n.stop(y,void 0,x)}catch(I){l.diagLog().throwInternal(Pe.CRITICAL,Re.StopTrackEventFailed,"stopTrackEvent failed, event will not be collected: "+Tt(I),{exception:lt(I)})}},l.trackTrace=function(y,x){try{var S=Fn.create(y,oi.dataType,oi.envelopeType,l.diagLog(),x);l.core.track(S)}catch(I){l.diagLog().throwInternal(Pe.WARNING,Re.TrackTraceFailed,"trackTrace failed, trace will not be collected: "+Tt(I),{exception:lt(I)})}},l.trackMetric=function(y,x){try{var S=Fn.create(y,Dn.dataType,Dn.envelopeType,l.diagLog(),x);l.core.track(S)}catch(I){l.diagLog().throwInternal(Pe.CRITICAL,Re.TrackMetricFailed,"trackMetric failed, metric will not be collected: "+Tt(I),{exception:lt(I)})}},l.trackPageView=function(y,x){try{var S=y||{};l._pageViewManager.trackPageView(S,Lo({},S.properties,S.measurements,x)),l.config.autoTrackPageVisitTime&&l._pageVisitTimeManager.trackPreviousPageVisit(S.name,S.uri)}catch(I){l.diagLog().throwInternal(Pe.CRITICAL,Re.TrackPVFailed,"trackPageView failed, page view will not be collected: "+Tt(I),{exception:lt(I)})}},l.sendPageViewInternal=function(y,x,S){var I=An();I&&(y.refUri=y.refUri===void 0?I.referrer:y.refUri);var D=Fn.create(y,vn.dataType,vn.envelopeType,l.diagLog(),x,S);l.core.track(D),a=0},l.sendPageViewPerformanceInternal=function(y,x,S){var I=Fn.create(y,ai.dataType,ai.envelopeType,l.diagLog(),x,S);l.core.track(I)},l.trackPageViewPerformance=function(y,x){try{l._pageViewPerformanceManager.populatePageViewPerformanceEvent(y),l.sendPageViewPerformanceInternal(y,x)}catch(S){l.diagLog().throwInternal(Pe.CRITICAL,Re.TrackPVFailed,"trackPageViewPerformance failed, page view will not be collected: "+Tt(S),{exception:lt(S)})}},l.startTrackPage=function(y){try{if(typeof y!="string"){var x=An();y=x&&x.title||""}i.start(y)}catch(S){l.diagLog().throwInternal(Pe.CRITICAL,Re.StartTrackFailed,"startTrackPage failed, page view may not be collected: "+Tt(S),{exception:lt(S)})}},l.stopTrackPage=function(y,x,S,I){try{if(typeof y!="string"){var D=An();y=D&&D.title||""}if(typeof x!="string"){var U=no();x=U&&U.href||""}i.stop(y,x,S,I),l.config.autoTrackPageVisitTime&&l._pageVisitTimeManager.trackPreviousPageVisit(y,x)}catch(te){l.diagLog().throwInternal(Pe.CRITICAL,Re.StopTrackFailed,"stopTrackPage failed, page view will not be collected: "+Tt(te),{exception:lt(te)})}},l.sendExceptionInternal=function(y,x,S){var I=y.exception||y.error||new Error(tn),D=new Br(l.diagLog(),I,y.properties||x,y.measurements,y.severityLevel,y.id).toInterface(),U=Fn.create(D,Br.dataType,Br.envelopeType,l.diagLog(),x,S);l.core.track(U)},l.trackException=function(y,x){try{l.sendExceptionInternal(y,x)}catch(S){l.diagLog().throwInternal(Pe.CRITICAL,Re.TrackExceptionFailed,"trackException failed, exception will not be collected: "+Tt(S),{exception:lt(S)})}},l._onerror=function(y){var x=y&&y.error,S=y&&y.evt;try{if(!S){var I=ns();I&&(S=I[_l])}var D=y&&y.url||(An()||{}).URL,U=y.errorSrc||"window.onerror@"+D+":"+(y.lineNumber||0)+":"+(y.columnNumber||0),te={errorSrc:U,url:D,lineNumber:y.lineNumber||0,columnNumber:y.columnNumber||0,message:y.message};xm(y.message,y.url,y.lineNumber,y.columnNumber,y.error)?w(Br.CreateAutoException("Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.",D,y.lineNumber||0,y.columnNumber||0,x,S,null,U),te):(y.errorSrc||(y.errorSrc=U),l.trackException({exception:y,severityLevel:ps.Error},te))}catch(G){var J=x?x.name+", "+x.message:"null";l.diagLog().throwInternal(Pe.CRITICAL,Re.ExceptionWhileLoggingError,"_onError threw exception while logging error, error will not be collected: "+Tt(G),{exception:lt(G),errorString:J})}},l.addTelemetryInitializer=function(y){l._telemetryInitializers.push(y)},l.initialize=function(y,x,S,I){if(!l.isInitialized()){if(Fe(x))throw Error("Error initializing");u.initialize(y,x,S,I),l.setInitialized(!1);var D=l._getTelCtx(),U=l.identifier;l.config=D.getExtCfg(U);var te=e.getDefaultConfig(y);te!==void 0&&sr(te,function(Ae,ze){l.config[Ae]=D.getConfig(U,Ae,ze),l.config[Ae]===void 0&&(l.config[Ae]=ze)}),l.config.isStorageUseDisabled&&Cm();var J={instrumentationKey:function(){return y.instrumentationKey},accountId:function(){return l.config.accountId||y.accountId},sessionRenewalMs:function(){return l.config.sessionRenewalMs||y.sessionRenewalMs},sessionExpirationMs:function(){return l.config.sessionExpirationMs||y.sessionExpirationMs},sampleRate:function(){return l.config.samplingPercentage||y.samplingPercentage},sdkExtension:function(){return l.config.sdkExtension||y.sdkExtension},isBrowserLinkTrackingEnabled:function(){return l.config.isBrowserLinkTrackingEnabled||y.isBrowserLinkTrackingEnabled},appId:function(){return l.config.appId||y.appId}};l._pageViewPerformanceManager=new dv(l.core),l._pageViewManager=new cv(r,l.config.overridePageViewDuration,l.core,l._pageViewPerformanceManager),l._pageVisitTimeManager=new lv(l.diagLog(),function(Ae,ze,Ze){return f(Ae,ze,Ze)}),l._telemetryInitializers=l._telemetryInitializers||[],p(J),n=new fh(l.diagLog(),"trackEvent"),n.action=function(Ae,ze,Ze,nt){nt||(nt={}),nt[dh]=Ze.toString(),l.trackEvent({name:Ae,properties:nt})},i=new fh(l.diagLog(),"trackPageView"),i.action=function(Ae,ze,Ze,nt,wt){Fe(nt)&&(nt={}),nt[dh]=Ze.toString();var Bt={name:Ae,uri:ze,properties:nt,measurements:wt};l.sendPageViewInternal(Bt,nt)};var G=ns(),ue=YC(),re=no(!0),se=r;if(l.config.disableExceptionTracking===!1&&!l.config.autoExceptionInstrumented&&G){var xe="onerror",dt=G[xe];G.onerror=function(Ae,ze,Ze,nt,wt){var Bt=G[_l],un=dt&&dt(Ae,ze,Ze,nt,wt);return un!==!0&&se._onerror(Br.CreateAutoException(Ae,ze,Ze,nt,wt,Bt)),un},l.config.autoExceptionInstrumented=!0}if(l.config.disableExceptionTracking===!1&&l.config.enableUnhandledPromiseRejectionTracking===!0&&!l.config.autoUnhandledPromiseInstrumented&&G){var ne="onunhandledrejection",Se=G[ne];G[ne]=function(Ae){var ze=G[_l],Ze=Se&&Se.call(G,Ae);return Ze!==!0&&se._onerror(Br.CreateAutoException(Ae.reason.toString(),re?re.href:"",0,0,Ae,ze)),Ze},l.config.autoUnhandledPromiseInstrumented=!0}if(l.config.enableAutoRouteTracking===!0&&ue&&St(ue.pushState)&&St(ue.replaceState)&&G&&typeof Event!="undefined"){var ke=r;gt(S,function(Ae){Ae.identifier===oa&&(o=Ae)}),ue.pushState=function(Ae){return function(){var ze=Ae.apply(this,arguments);return ms(G,Jo(ke.config.namePrefix+"pushState")),ms(G,Jo(ke.config.namePrefix+"locationchange")),ze}}(ue.pushState),ue.replaceState=function(Ae){return function(){var ze=Ae.apply(this,arguments);return ms(G,Jo(ke.config.namePrefix+"replaceState")),ms(G,Jo(ke.config.namePrefix+"locationchange")),ze}}(ue.replaceState),G.addEventListener&&(G.addEventListener(ke.config.namePrefix+"popstate",function(){ms(G,Jo(ke.config.namePrefix+"locationchange"))}),G.addEventListener(ke.config.namePrefix+"locationchange",function(){if(o&&o.context&&o.context.telemetryTrace){o.context.telemetryTrace.traceID=In();var Ae="_unknown_";re&&re.pathname&&(Ae=re.pathname+(re.hash||"")),o.context.telemetryTrace.name=Ae}c&&(s=c),c=re&&re.href||"",setTimeout(function(ze){ke.trackPageView({refUri:ze,properties:{duration:0}})}.bind(r,s),ke.autoRoutePVDelay)}))}l.setInitialized(!0)}};function f(y,x,S){var I={PageName:y,PageUrl:x};l.trackMetric({name:"PageVisitTime",average:S,max:S,min:S,sampleCount:1},I)}function p(y){if(!y.isBrowserLinkTrackingEnabled()){var x=["/browserLinkSignalR/","/__browserLink/"],S=function(I){if(I.baseType===Pn.dataType){var D=I.baseData;if(D){for(var U=0;U<x.length;U++)if(D.target&&D.target.indexOf(x[U])>=0)return!1}}return!0};b(S)}}function b(y){l._telemetryInitializers.push(y)}function w(y,x){var S=Fn.create(y,Br.dataType,Br.envelopeType,l.diagLog(),x);l.core.track(S)}}),r}return e.getDefaultConfig=function(r){return r||(r={}),r.sessionRenewalMs=30*60*1e3,r.sessionExpirationMs=24*60*60*1e3,r.disableExceptionTracking=Mt(r.disableExceptionTracking),r.autoTrackPageVisitTime=Mt(r.autoTrackPageVisitTime),r.overridePageViewDuration=Mt(r.overridePageViewDuration),r.enableUnhandledPromiseRejectionTracking=Mt(r.enableUnhandledPromiseRejectionTracking),(isNaN(r.samplingPercentage)||r.samplingPercentage<=0||r.samplingPercentage>=100)&&(r.samplingPercentage=100),r.isStorageUseDisabled=Mt(r.isStorageUseDisabled),r.isBrowserLinkTrackingEnabled=Mt(r.isBrowserLinkTrackingEnabled),r.enableAutoRouteTracking=Mt(r.enableAutoRouteTracking),r.namePrefix=r.namePrefix||"",r.enableDebug=Mt(r.enableDebug),r.disableFlushOnBeforeUnload=Mt(r.disableFlushOnBeforeUnload),r.disableFlushOnUnload=Mt(r.disableFlushOnUnload,r.disableFlushOnBeforeUnload),r},e.Version="2.6.4",e}(ao),fh=function(){function t(e,r){var n=this,i={};n.start=function(o){typeof i[o]!="undefined"&&e.throwInternal(Pe.WARNING,Re.StartCalledMoreThanOnce,"start was called more than once for this event without calling stop.",{name:o,key:o},!0),i[o]=+new Date},n.stop=function(o,a,s,c){var l=i[o];if(isNaN(l))e.throwInternal(Pe.WARNING,Re.StopCalledWithoutStart,"stop was called without a corresponding start.",{name:o,key:o},!0);else{var u=+new Date,h=Mr(l,u);n.action(o,a,h,s,c)}delete i[o],i[o]=void 0}}return t}()}),hv=_e(()=>{iE()}),fv,pv,oE=_e(()=>{cr(),vt(),gr(),fv=function(){function t(e){var r=[];nr(t,this,function(n){n.enqueue=function(i){r.push(i)},n.count=function(){return r.length},n.clear=function(){r.length=0},n.getItems=function(){return r.slice(0)},n.batchPayloads=function(i){if(i&&i.length>0){var o=e.emitLineDelimitedJson()?i.join(`
`):"["+i.join(",")+"]";return o}return null},n.markAsSent=function(i){n.clear()},n.clearSent=function(i){}})}return t}(),pv=function(){function t(e,r){var n=!1,i;nr(t,this,function(o){var a=l(t.BUFFER_KEY),s=l(t.SENT_BUFFER_KEY);i=a.concat(s),i.length>t.MAX_BUFFER_SIZE&&(i.length=t.MAX_BUFFER_SIZE),u(t.SENT_BUFFER_KEY,[]),u(t.BUFFER_KEY,i),o.enqueue=function(h){if(i.length>=t.MAX_BUFFER_SIZE){n||(e.throwInternal(Pe.WARNING,Re.SessionStorageBufferFull,"Maximum buffer size reached: "+i.length,!0),n=!0);return}i.push(h),u(t.BUFFER_KEY,i)},o.count=function(){return i.length},o.clear=function(){i=[],u(t.BUFFER_KEY,[]),u(t.SENT_BUFFER_KEY,[]),n=!1},o.getItems=function(){return i.slice(0)},o.batchPayloads=function(h){if(h&&h.length>0){var f=r.emitLineDelimitedJson()?h.join(`
`):"["+h.join(",")+"]";return f}return null},o.markAsSent=function(h){i=c(h,i),u(t.BUFFER_KEY,i);var f=l(t.SENT_BUFFER_KEY);f instanceof Array&&h instanceof Array&&(f=f.concat(h),f.length>t.MAX_BUFFER_SIZE&&(e.throwInternal(Pe.CRITICAL,Re.SessionStorageBufferFull,"Sent buffer reached its maximum size: "+f.length,!0),f.length=t.MAX_BUFFER_SIZE),u(t.SENT_BUFFER_KEY,f))},o.clearSent=function(h){var f=l(t.SENT_BUFFER_KEY);f=c(h,f),u(t.SENT_BUFFER_KEY,f)};function c(h,f){var p=[];return gt(f,function(b){!St(b)&&ts(h,b)===-1&&p.push(b)}),p}function l(h){var f=h;try{f=r.namePrefix&&r.namePrefix()?r.namePrefix()+"_"+f:f;var p=ul(e,f);if(p){var b=hn().parse(p);if(pt(b)&&(b=hn().parse(b)),b&&ei(b))return b}}catch(w){e.throwInternal(Pe.CRITICAL,Re.FailedToRestoreStorageBuffer," storage key: "+f+", "+Tt(w),{exception:lt(w)})}return[]}function u(h,f){var p=h;try{p=r.namePrefix&&r.namePrefix()?r.namePrefix()+"_"+p:p;var b=JSON.stringify(f);dl(e,p,b)}catch(w){dl(e,p,JSON.stringify([])),e.throwInternal(Pe.WARNING,Re.FailedToSetStorageBuffer," storage key: "+p+", "+Tt(w)+". Buffer cleared",{exception:lt(w)})}}})}return t.BUFFER_KEY="AI_buffer",t.SENT_BUFFER_KEY="AI_sentBuffer",t.MAX_BUFFER_SIZE=2e3,t}()});function or(t,e,r){return Ct(t,e,r,td)}var xl,Gt,lr,ph,Yt,gv,gh,mv,vv,wv,yv,bv,aE=_e(()=>{Ut(),cr(),vt(),xl="baseType",Gt="baseData",lr="properties",ph="true",Yt=function(){function t(){}return t.extractPropsAndMeasurements=function(e,r,n){Fe(e)||sr(e,function(i,o){Ju(o)?n[i]=o:pt(o)?r[i]=o:zo()&&(r[i]=hn().stringify(o))})},t.createEnvelope=function(e,r,n,i){var o=new th(e,i,r);or(o,"sampleRate",n[sl]),(n[Gt]||{}).startTime&&(o.time=xi(n[Gt].startTime)),o.iKey=n.iKey;var a=n.iKey.replace(/-/g,"");return o.name=o.name.replace("{0}",a),t.extractPartAExtensions(n,o),n.tags=n.tags||[],Sg(o)},t.extractPartAExtensions=function(e,r){var n=r.tags=r.tags||{},i=e.ext=e.ext||{},o=e.tags=e.tags||[],a=i.user;a&&(or(n,Lt.userAuthUserId,a.authId),or(n,Lt.userId,a.id||a.localId));var s=i.app;s&&or(n,Lt.sessionId,s.sesId);var c=i.device;c&&(or(n,Lt.deviceId,c.id||c.localId),or(n,Lt.deviceType,c.deviceClass),or(n,Lt.deviceIp,c.ip),or(n,Lt.deviceModel,c.model),or(n,Lt.deviceType,c.deviceType));var l=e.ext.web;if(l){or(n,Lt.deviceLanguage,l.browserLang),or(n,Lt.deviceBrowserVersion,l.browserVer),or(n,Lt.deviceBrowser,l.browser);var u=r.data=r.data||{},h=u[Gt]=u[Gt]||{},f=h[lr]=h[lr]||{};or(f,"domain",l.domain),or(f,"isManual",l.isManual?ph:null),or(f,"screenRes",l.screenRes),or(f,"userConsent",l.userConsent?ph:null)}var p=i.os;p&&or(n,Lt.deviceOS,p.name);var b=i.trace;b&&(or(n,Lt.operationParentId,b.parentID),or(n,Lt.operationName,b.name),or(n,Lt.operationId,b.traceID));for(var w={},y=o.length-1;y>=0;y--){var x=o[y];sr(x,function(I,D){w[I]=D}),o.splice(y,1)}sr(o,function(I,D){w[I]=D});var S=Lo({},n,w);S[Lt.internalSdkVersion]||(S[Lt.internalSdkVersion]="javascript:"+t.Version),r.tags=Sg(S)},t.prototype.Init=function(e,r){this._logger=e,Fe(r[Gt])&&this._logger.throwInternal(Pe.CRITICAL,Re.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.")},t.Version="2.6.4",t}(),gv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt].measurements||{},o=n[Gt][lr]||{};Yt.extractPropsAndMeasurements(n.data,o,i);var a=n[Gt];if(Fe(a))return r.warnToConsole("Invalid input for dependency data"),null;var s=a[lr]&&a[lr][cl]?a[lr][cl]:"GET",c=new Pn(r,a.id,a.target,a.name,a.duration,a.success,a.responseCode,s,a.type,a.correlationContext,o,i),l=new si(Pn.dataType,c);return Yt.createEnvelope(r,Pn.envelopeType,n,l)},e.DependencyEnvelopeCreator=new e,e}(Yt),gh=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i={},o={};n[xl]!==mn.dataType&&(i.baseTypeSource=n[xl]),n[xl]===mn.dataType?(i=n[Gt][lr]||{},o=n[Gt].measurements||{}):n[Gt]&&Yt.extractPropsAndMeasurements(n[Gt],i,o),Yt.extractPropsAndMeasurements(n.data,i,o);var a=n[Gt].name,s=new mn(r,a,i,o),c=new si(mn.dataType,s);return Yt.createEnvelope(r,mn.envelopeType,n,c)},e.EventEnvelopeCreator=new e,e}(Yt),mv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt].measurements||{},o=n[Gt][lr]||{};Yt.extractPropsAndMeasurements(n.data,o,i);var a=n[Gt],s=Br.CreateFromInterface(r,a,o,i),c=new si(Br.dataType,s);return Yt.createEnvelope(r,Br.envelopeType,n,c)},e.ExceptionEnvelopeCreator=new e,e}(Yt),vv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt],o=i[lr]||{},a=i.measurements||{};Yt.extractPropsAndMeasurements(n.data,o,a);var s=new Dn(r,i.name,i.average,i.sampleCount,i.min,i.max,o,a),c=new si(Dn.dataType,s);return Yt.createEnvelope(r,Dn.envelopeType,n,c)},e.MetricEnvelopeCreator=new e,e}(Yt),wv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i="duration",o,a=n[Gt];!Fe(a)&&!Fe(a[lr])&&!Fe(a[lr][i])?(o=a[lr][i],delete a[lr][i]):!Fe(n.data)&&!Fe(n.data[i])&&(o=n.data[i],delete n.data[i]);var s=n[Gt],c;((n.ext||{}).trace||{}).traceID&&(c=n.ext.trace.traceID);var l=s.id||c,u=s.name,h=s.uri,f=s[lr]||{},p=s.measurements||{};if(Fe(s.refUri)||(f.refUri=s.refUri),Fe(s.pageType)||(f.pageType=s.pageType),Fe(s.isLoggedIn)||(f.isLoggedIn=s.isLoggedIn.toString()),!Fe(s[lr])){var b=s[lr];sr(b,function(x,S){f[x]=S})}Yt.extractPropsAndMeasurements(n.data,f,p);var w=new vn(r,u,h,o,f,p,l),y=new si(vn.dataType,w);return Yt.createEnvelope(r,vn.envelopeType,n,y)},e.PageViewEnvelopeCreator=new e,e}(Yt),yv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt],o=i.name,a=i.uri||i.url,s=i[lr]||{},c=i.measurements||{};Yt.extractPropsAndMeasurements(n.data,s,c);var l=new ai(r,o,a,void 0,s,c,i),u=new si(ai.dataType,l);return Yt.createEnvelope(r,ai.envelopeType,n,u)},e.PageViewPerformanceEnvelopeCreator=new e,e}(Yt),bv=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.Create=function(r,n){t.prototype.Init.call(this,r,n);var i=n[Gt].message,o=n[Gt].severityLevel,a=n[Gt][lr]||{},s=n[Gt].measurements||{};Yt.extractPropsAndMeasurements(n.data,a,s);var c=new oi(r,i,o,a,s),l=new si(oi.dataType,c);return Yt.createEnvelope(r,oi.envelopeType,n,l)},e.TraceEnvelopeCreator=new e,e}(Yt)}),_v,sE=_e(()=>{vt(),gr(),_v=function(){function t(e){nr(t,this,function(r){r.serialize=function(a){var s=n(a,"root");try{return hn().stringify(s)}catch(c){e.throwInternal(Pe.CRITICAL,Re.CannotSerializeObject,c&&St(c.toString)?c.toString():"Error serializing object",null,!0)}};function n(a,s){var c="__aiCircularRefCheck",l={};if(!a)return e.throwInternal(Pe.CRITICAL,Re.CannotSerializeObject,"cannot serialize object because it is null or undefined",{name:s},!0),l;if(a[c])return e.throwInternal(Pe.WARNING,Re.CircularReferenceDetected,"Circular reference detected while serializing object",{name:s},!0),l;if(!a.aiDataContract){if(s==="measurements")l=o(a,"number",s);else if(s==="properties")l=o(a,"string",s);else if(s==="tags")l=o(a,"string",s);else if(ei(a))l=i(a,s);else{e.throwInternal(Pe.WARNING,Re.CannotSerializeObjectNonSerializable,"Attempting to serialize an object which does not implement ISerializable",{name:s},!0);try{hn().stringify(a),l=a}catch(u){e.throwInternal(Pe.CRITICAL,Re.CannotSerializeObject,u&&St(u.toString)?u.toString():"Error serializing object",null,!0)}}return l}return a[c]=!0,sr(a.aiDataContract,function(u,h){var f=St(h)?h()&1:h&1,p=St(h)?h()&4:h&4,b=h&2,w=a[u]!==void 0,y=to(a[u])&&a[u]!==null;if(f&&!w&&!b)e.throwInternal(Pe.CRITICAL,Re.MissingRequiredFieldSpecification,"Missing required field specification. The field is required but not present on source",{field:u,name:s});else if(!p){var x=void 0;y?b?x=i(a[u],u):x=n(a[u],u):x=a[u],x!==void 0&&(l[u]=x)}}),delete a[c],l}function i(a,s){var c;if(a)if(!ei(a))e.throwInternal(Pe.CRITICAL,Re.ItemNotInArray,`This field was specified as an array in the contract but the item is not an array.\r
`,{name:s},!0);else{c=[];for(var l=0;l<a.length;l++){var u=a[l],h=n(u,s+"["+l+"]");c.push(h)}}return c}function o(a,s,c){var l;return a&&(l={},sr(a,function(u,h){if(s==="string")h===void 0?l[u]="undefined":h===null?l[u]="null":h.toString?l[u]=h.toString():l[u]="invalid field: toString() is not defined.";else if(s==="number")if(h===void 0)l[u]="undefined";else if(h===null)l[u]="null";else{var f=parseFloat(h);isNaN(f)?l[u]="NaN":l[u]=f}else l[u]="invalid field: "+c+" is of unknown type.",e.throwInternal(Pe.CRITICAL,l[u],null,!0)})),l}})}return t}()}),xv,mh,cE=_e(()=>{vt(),gr(),xv=function(){function t(){var e=ns(),r=An(),n=!1,i=!0;nr(t,this,function(o){try{if(e&&us.Attach(e,"online",c)&&(us.Attach(e,"offline",l),n=!0),r){var a=r.body||r;Nr(a.ononline)||(a.ononline=c,a.onoffline=l,n=!0)}if(n){var s=kn();s&&!Fe(s.onLine)&&(i=s.onLine)}}catch(u){n=!1}o.isListening=n,o.isOnline=function(){var u=!0,h=kn();return n?u=i:h&&!Fe(h.onLine)&&(u=h.onLine),u},o.isOffline=function(){return!o.isOnline()};function c(){i=!0}function l(){i=!1}})}return t.Offline=new t,t}(),mh=xv.Offline}),Sv,lE=_e(()=>{Sv=function(){function t(){}return t.prototype.getHashCodeScore=function(e){var r=this.getHashCode(e)/t.INT_MAX_VALUE;return r*100},t.prototype.getHashCode=function(e){if(e==="")return 0;for(;e.length<t.MIN_INPUT_LENGTH;)e=e.concat(e);for(var r=5381,n=0;n<e.length;++n)r=(r<<5)+r+e.charCodeAt(n),r=r&r;return Math.abs(r)},t.INT_MAX_VALUE=2147483647,t.MIN_INPUT_LENGTH=8,t}()}),Cv,uE=_e(()=>{lE(),cr(),Cv=function(){function t(){this.hashCodeGeneragor=new Sv,this.keys=new yl}return t.prototype.getSamplingScore=function(e){var r=0;return e.tags&&e.tags[this.keys.userId]?r=this.hashCodeGeneragor.getHashCodeScore(e.tags[this.keys.userId]):e.ext&&e.ext.user&&e.ext.user.id?r=this.hashCodeGeneragor.getHashCodeScore(e.ext.user.id):e.tags&&e.tags[this.keys.operationId]?r=this.hashCodeGeneragor.getHashCodeScore(e.tags[this.keys.operationId]):e.ext&&e.ext.telemetryTrace&&e.ext.telemetryTrace.traceID?r=this.hashCodeGeneragor.getHashCodeScore(e.ext.telemetryTrace.traceID):r=Math.random()*100,r},t}()}),Ev,dE=_e(()=>{uE(),cr(),vt(),Ev=function(){function t(e,r){this.INT_MAX_VALUE=2147483647,this._logger=r||Kc(null),(e>100||e<0)&&(this._logger.throwInternal(Pe.WARNING,Re.SampleRateOutOfRange,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),e=100),this.sampleRate=e,this.samplingScoreGenerator=new Cv}return t.prototype.isSampledIn=function(e){var r=this.sampleRate,n=!1;return r==null||r>=100||e.baseType===Dn.dataType?!0:(n=this.samplingScoreGenerator.getSamplingScore(e)<r,n)},t}()});function Sl(t){try{return t.responseText}catch(e){}return null}var vh,hE=_e(()=>{Ut(),oE(),aE(),sE(),cr(),vt(),cE(),dE(),gr(),vh=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.priority=1001,r.identifier=bl,r._XMLHttpRequestSupported=!1;var n,i,o,a,s,c,l={};return nr(e,r,function(u,h){function f(){Tn("Method not implemented.")}u.pause=f,u.resume=f,u.flush=function(){try{u.triggerSend(!0,null,1)}catch(ne){u.diagLog().throwInternal(Pe.CRITICAL,Re.FlushFailed,"flush failed, telemetry will not be collected: "+Tt(ne),{exception:lt(ne)})}},u.onunloadFlush=function(){if((u._senderConfig.onunloadDisableBeacon()===!1||u._senderConfig.isBeaconApiDisabled()===!1)&&zd())try{u.triggerSend(!0,y,2)}catch(ne){u.diagLog().throwInternal(Pe.CRITICAL,Re.FailedToSendQueuedTelemetry,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+Tt(ne),{exception:lt(ne)})}else u.flush()},u.teardown=f,u.addHeader=function(ne,Se){l[ne]=Se},u.initialize=function(ne,Se,ke,Ae){h.initialize(ne,Se,ke,Ae);var ze=u._getTelCtx(),Ze=u.identifier;s=new _v(Se.logger),n=0,i=null,o=0,u._sender=null,c=0;var nt=e._getDefaultAppInsightsChannelConfig();if(u._senderConfig=e._getEmptyAppInsightsChannelConfig(),sr(nt,function(ve,Ie){u._senderConfig[ve]=function(){return ze.getConfig(Ze,ve,Ie())}}),u._buffer=u._senderConfig.enableSessionStorageBuffer()&&ta()?new pv(u.diagLog(),u._senderConfig):new fv(u._senderConfig),u._sample=new Ev(u._senderConfig.samplingPercentage(),u.diagLog()),dt(ne)||u.diagLog().throwInternal(Pe.CRITICAL,Re.InvalidInstrumentationKey,"Invalid Instrumentation key "+ne.instrumentationKey),!hl(u._senderConfig.endpointUrl())&&u._senderConfig.customHeaders()&&u._senderConfig.customHeaders().length>0&&gt(u._senderConfig.customHeaders(),function(ve){r.addHeader(ve.header,ve.value)}),!u._senderConfig.isBeaconApiDisabled()&&zd())u._sender=y;else{var wt=Ar("XMLHttpRequest");if(wt){var Bt=new wt;"withCredentials"in Bt?(u._sender=x,u._XMLHttpRequestSupported=!0):typeof XDomainRequest!==Yn&&(u._sender=ue)}else{var un=Ar("fetch");un&&(u._sender=S)}}},u.processTelemetry=function(ne,Se){Se=u._getTelCtx(Se);try{if(u._senderConfig.disableTelemetry())return;if(!ne){Se.diagLog().throwInternal(Pe.CRITICAL,Re.CannotSendEmptyTelemetry,"Cannot send empty telemetry");return}if(ne.baseData&&!ne.baseType){Se.diagLog().throwInternal(Pe.CRITICAL,Re.InvalidEvent,"Cannot send telemetry without baseData and baseType");return}if(ne.baseType||(ne.baseType="EventData"),!u._sender){Se.diagLog().throwInternal(Pe.CRITICAL,Re.SenderNotInitialized,"Sender was not initialized");return}if(p(ne))ne[sl]=u._sample.sampleRate;else{Se.diagLog().throwInternal(Pe.WARNING,Re.TelemetrySampledAndNotSent,"Telemetry item was sampled out and not sent",{SampleRate:u._sample.sampleRate});return}var ke=e.constructEnvelope(ne,u._senderConfig.instrumentationKey(),Se.diagLog());if(!ke){Se.diagLog().throwInternal(Pe.CRITICAL,Re.CreateEnvelopeError,"Unable to create an AppInsights envelope");return}var Ae=!1;if(ne.tags&&ne.tags[ea]&&(gt(ne.tags[ea],function(wt){try{wt&&wt(ke)===!1&&(Ae=!0,Se.diagLog().warnToConsole("Telemetry processor check returns false"))}catch(Bt){Se.diagLog().throwInternal(Pe.CRITICAL,Re.TelemetryInitializerFailed,"One of telemetry initializers failed, telemetry item will not be sent: "+Tt(Bt),{exception:lt(Bt)},!0)}}),delete ne.tags[ea]),Ae)return;var ze=s.serialize(ke),Ze=u._buffer.getItems(),nt=u._buffer.batchPayloads(Ze);nt&&nt.length+ze.length>u._senderConfig.maxBatchSizeInBytes()&&u.triggerSend(!0,null,10),u._buffer.enqueue(ze),te()}catch(wt){Se.diagLog().throwInternal(Pe.WARNING,Re.FailedAddingTelemetryToBuffer,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+Tt(wt),{exception:lt(wt)})}u.processNext(ne,Se)},u._xhrReadyStateChange=function(ne,Se,ke){ne.readyState===4&&b(ne.status,Se,ne.responseURL,ke,G(ne),Sl(ne)||ne.response)},u.triggerSend=function(ne,Se,ke){ne===void 0&&(ne=!0);try{if(u._senderConfig.disableTelemetry())u._buffer.clear();else{if(u._buffer.count()>0){var Ae=u._buffer.getItems();xe(ke||0,ne),Se?Se.call(r,Ae,ne):u._sender(Ae,ne)}o=+new Date}clearTimeout(a),a=null,i=null}catch(Ze){var ze=cd();(!ze||ze>9)&&u.diagLog().throwInternal(Pe.CRITICAL,Re.TransmissionFailed,"Telemetry transmission failed, some telemetry will be lost: "+Tt(Ze),{exception:lt(Ze)})}},u._onError=function(ne,Se,ke){u.diagLog().throwInternal(Pe.WARNING,Re.OnError,"Failed to send telemetry.",{message:Se}),u._buffer.clearSent(ne)},u._onPartialSuccess=function(ne,Se){for(var ke=[],Ae=[],ze=Se.errors.reverse(),Ze=0,nt=ze;Ze<nt.length;Ze++){var wt=nt[Ze],Bt=ne.splice(wt.index,1)[0];J(wt.statusCode)?Ae.push(Bt):ke.push(Bt)}ne.length>0&&u._onSuccess(ne,Se.itemsAccepted),ke.length>0&&u._onError(ke,G(null,["partial success",Se.itemsAccepted,"of",Se.itemsReceived].join(" "))),Ae.length>0&&(D(Ae),u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,"Partial success. Delivered: "+ne.length+", Failed: "+ke.length+". Will retry to send "+Ae.length+" our of "+Se.itemsReceived+" items"))},u._onSuccess=function(ne,Se){u._buffer.clearSent(ne)},u._xdrOnLoad=function(ne,Se){var ke=Sl(ne);if(ne&&(ke+""=="200"||ke===""))n=0,u._onSuccess(Se,0);else{var Ae=I(ke);Ae&&Ae.itemsReceived&&Ae.itemsReceived>Ae.itemsAccepted&&!u._senderConfig.isRetryDisabled()?u._onPartialSuccess(Se,Ae):u._onError(Se,re(ne))}};function p(ne){return u._sample.isSampledIn(ne)}function b(ne,Se,ke,Ae,ze,Ze){var nt=null;if(u._appId||(nt=I(Ze),nt&&nt.appId&&(u._appId=nt.appId)),(ne<200||ne>=300)&&ne!==0){if((ne===301||ne===307||ne===308)&&!w(ke)){u._onError(Se,ze);return}!u._senderConfig.isRetryDisabled()&&J(ne)?(D(Se),u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,". Response code "+ne+". Will retry to send "+Se.length+" items.")):u._onError(Se,ze)}else if(mh.isOffline()){if(!u._senderConfig.isRetryDisabled()){var wt=10;D(Se,wt),u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,". Offline - Response Code: "+ne+". Offline status: "+mh.isOffline()+". Will retry to send "+Se.length+" items.")}}else w(ke),ne===206?(nt||(nt=I(Ze)),nt&&!u._senderConfig.isRetryDisabled()?u._onPartialSuccess(Se,nt):u._onError(Se,ze)):(n=0,u._onSuccess(Se,Ae))}function w(ne){return c>=10?!1:!Fe(ne)&&ne!==""&&ne!==u._senderConfig.endpointUrl()?(u._senderConfig.endpointUrl=function(){return ne},++c,!0):!1}function y(ne,Se){var ke=u._senderConfig.endpointUrl(),Ae=u._buffer.batchPayloads(ne),ze=new Blob([Ae],{type:"text/plain;charset=UTF-8"}),Ze=kn().sendBeacon(ke,ze);Ze?(u._buffer.markAsSent(ne),u._onSuccess(ne,ne.length)):(x(ne,!0),u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,". Failed to send telemetry with Beacon API, retried with xhrSender."))}function x(ne,Se){var ke=new XMLHttpRequest,Ae=u._senderConfig.endpointUrl();try{ke[lo]=!0}catch(Ze){}ke.open("POST",Ae,Se),ke.setRequestHeader("Content-type","application/json"),hl(Ae)&&ke.setRequestHeader(Wt.sdkContextHeader,Wt.sdkContextHeaderAppIdRequest),gt(ro(l),function(Ze){ke.setRequestHeader(Ze,l[Ze])}),ke.onreadystatechange=function(){return u._xhrReadyStateChange(ke,ne,ne.length)},ke.onerror=function(Ze){return u._onError(ne,G(ke),Ze)};var ze=u._buffer.batchPayloads(ne);ke.send(ze),u._buffer.markAsSent(ne)}function S(ne,Se){var ke=u._senderConfig.endpointUrl(),Ae=u._buffer.batchPayloads(ne),ze=new Blob([Ae],{type:"text/plain;charset=UTF-8"}),Ze=new Headers;hl(ke)&&Ze.append(Wt.sdkContextHeader,Wt.sdkContextHeaderAppIdRequest),gt(ro(l),function(Bt){Ze.append(Bt,l[Bt])});var nt={method:"POST",headers:Ze,body:ze},wt=new Request(ke,nt);fetch(wt).then(function(Bt){if(Bt.ok)Bt.text().then(function(un){b(Bt.status,ne,Bt.url,ne.length,Bt.statusText,un)}),u._buffer.markAsSent(ne);else throw Error(Bt.statusText)}).catch(function(Bt){u._onError(ne,Bt.message)})}function I(ne){try{if(ne&&ne!==""){var Se=hn().parse(ne);if(Se&&Se.itemsReceived&&Se.itemsReceived>=Se.itemsAccepted&&Se.itemsReceived-Se.itemsAccepted===Se.errors.length)return Se}}catch(ke){u.diagLog().throwInternal(Pe.CRITICAL,Re.InvalidBackendResponse,"Cannot parse the response. "+Tt(ke),{response:ne})}return null}function D(ne,Se){if(Se===void 0&&(Se=1),!(!ne||ne.length===0)){u._buffer.clearSent(ne),n++;for(var ke=0,Ae=ne;ke<Ae.length;ke++){var ze=Ae[ke];u._buffer.enqueue(ze)}U(Se),te()}}function U(ne){var Se=10,ke;if(n<=1)ke=Se;else{var Ae=(Math.pow(2,n)-1)/2,ze=Math.floor(Math.random()*Ae*Se)+1;ze=ne*ze,ke=Math.max(Math.min(ze,3600),Se)}var Ze=Jr()+ke*1e3;i=Ze}function te(){if(!a){var ne=i?Math.max(0,i-Jr()):0,Se=Math.max(u._senderConfig.maxBatchInterval(),ne);a=setTimeout(function(){u.triggerSend(!0,null,1)},Se)}}function J(ne){return ne===408||ne===429||ne===500||ne===503}function G(ne,Se){return ne?"XMLHttpRequest,Status:"+ne.status+",Response:"+Sl(ne)||0||0:Se}function ue(ne,Se){var ke=ns(),Ae=new XDomainRequest;Ae.onload=function(){return u._xdrOnLoad(Ae,ne)},Ae.onerror=function(wt){return u._onError(ne,re(Ae),wt)};var ze=ke&&ke.location&&ke.location.protocol||"";if(u._senderConfig.endpointUrl().lastIndexOf(ze,0)!==0){u.diagLog().throwInternal(Pe.WARNING,Re.TransmissionFailed,". Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol."),u._buffer.clear();return}var Ze=u._senderConfig.endpointUrl().replace(/^(https?:)/,"");Ae.open("POST",Ze);var nt=u._buffer.batchPayloads(ne);Ae.send(nt),u._buffer.markAsSent(ne)}function re(ne,Se){return ne?"XDomainRequest,Response:"+Sl(ne)||0:Se}function se(){var ne="getNotifyMgr";return u.core[ne]?u.core[ne]():u.core._notificationManager}function xe(ne,Se){var ke=se();if(ke&&ke.eventsSendRequest)try{ke.eventsSendRequest(ne,Se)}catch(Ae){u.diagLog().throwInternal(Pe.CRITICAL,Re.NotificationException,"send request notification failed: "+Tt(Ae),{exception:lt(Ae)})}}function dt(ne){var Se=Fe(ne.disableInstrumentationKeyValidation)?!1:ne.disableInstrumentationKeyValidation;if(Se)return!0;var ke="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",Ae=new RegExp(ke);return Ae.test(ne.instrumentationKey)}}),r}return e.constructEnvelope=function(r,n,i){var o;switch(n!==r.iKey&&!Fe(n)?o=Lo({},r,{iKey:n}):o=r,o.baseType){case mn.dataType:return gh.EventEnvelopeCreator.Create(i,o);case oi.dataType:return bv.TraceEnvelopeCreator.Create(i,o);case vn.dataType:return wv.PageViewEnvelopeCreator.Create(i,o);case ai.dataType:return yv.PageViewPerformanceEnvelopeCreator.Create(i,o);case Br.dataType:return mv.ExceptionEnvelopeCreator.Create(i,o);case Dn.dataType:return vv.MetricEnvelopeCreator.Create(i,o);case Pn.dataType:return gv.DependencyEnvelopeCreator.Create(i,o);default:return gh.EventEnvelopeCreator.Create(i,o)}},e._getDefaultAppInsightsChannelConfig=function(){return{endpointUrl:function(){return"https://dc.services.visualstudio.com/v2/track"},emitLineDelimitedJson:function(){return!1},maxBatchInterval:function(){return 15e3},maxBatchSizeInBytes:function(){return 102400},disableTelemetry:function(){return!1},enableSessionStorageBuffer:function(){return!0},isRetryDisabled:function(){return!1},isBeaconApiDisabled:function(){return!0},onunloadDisableBeacon:function(){return!1},instrumentationKey:function(){},namePrefix:function(){},samplingPercentage:function(){return 100},customHeaders:function(){}}},e._getEmptyAppInsightsChannelConfig=function(){return{endpointUrl:void 0,emitLineDelimitedJson:void 0,maxBatchInterval:void 0,maxBatchSizeInBytes:void 0,disableTelemetry:void 0,enableSessionStorageBuffer:void 0,isRetryDisabled:void 0,isBeaconApiDisabled:void 0,onunloadDisableBeacon:void 0,instrumentationKey:void 0,namePrefix:void 0,samplingPercentage:void 0,customHeaders:void 0}},e}(ao)}),Rv=_e(()=>{hE()}),Tv,wh,Av,fE=_e(()=>{gr(),cr(),vt(),Tv="ai_session",wh=function(){function t(){}return t}(),Av=function(){function t(e,r){var n=this,i,o,a=Kc(r),s=_d(r);nr(t,n,function(c){e||(e={}),St(e.sessionExpirationMs)||(e.sessionExpirationMs=function(){return t.acquisitionSpan}),St(e.sessionRenewalMs)||(e.sessionRenewalMs=function(){return t.renewalSpan}),c.config=e;var l=c.config.sessionCookiePostfix&&c.config.sessionCookiePostfix()?c.config.sessionCookiePostfix():c.config.namePrefix&&c.config.namePrefix()?c.config.namePrefix():"";i=function(){return Tv+l},c.automaticSession=new wh,c.update=function(){var w=Jr(),y=!1,x=c.automaticSession;x.id||(y=!u(x,w));var S=c.config.sessionExpirationMs();if(!y&&S>0){var I=c.config.sessionRenewalMs(),D=w-x.acquisitionDate,U=w-x.renewalDate;y=D<0||U<0,y=y||D>S,y=y||U>I}y?f(w):(!o||w-o>t.cookieUpdateInterval)&&p(x,w)},c.backup=function(){var w=c.automaticSession;b(w.id,w.acquisitionDate,w.renewalDate)};function u(w,y){var x=!1,S=s.get(i());if(S&&St(S.split))x=h(w,S);else{var I=Em(a,i());I&&(x=h(w,I))}return x||!!w.id}function h(w,y){var x=!1,S=", session will be reset",I=y.split("|");if(I.length>=2)try{var D=+I[1]||0,U=+I[2]||0;isNaN(D)||D<=0?a.throwInternal(Pe.WARNING,Re.SessionRenewalDateIsZero,"AI session acquisition date is 0"+S):isNaN(U)||U<=0?a.throwInternal(Pe.WARNING,Re.SessionRenewalDateIsZero,"AI session renewal date is 0"+S):I[0]&&(w.id=I[0],w.acquisitionDate=D,w.renewalDate=U,x=!0)}catch(te){a.throwInternal(Pe.CRITICAL,Re.ErrorParsingAISessionCookie,"Error parsing ai_session value ["+(y||"")+"]"+S+" - "+Tt(te),{exception:lt(te)})}return x}function f(w){var y=c.config||{},x=(y.getNewId?y.getNewId():null)||il;c.automaticSession.id=x(y.idLength?y.idLength():22),c.automaticSession.acquisitionDate=w,p(c.automaticSession,w),Kd()||a.throwInternal(Pe.WARNING,Re.BrowserDoesNotSupportLocalStorage,"Browser does not support local storage. Session durations will be inaccurate.")}function p(w,y){var x=w.acquisitionDate;w.renewalDate=y;var S=c.config,I=S.sessionRenewalMs(),D=x+S.sessionExpirationMs()-y,U=[w.id,x,y],te=0;D<I?te=D/1e3:te=I/1e3;var J=S.cookieDomain?S.cookieDomain():null;s.set(i(),U.join("|"),S.sessionExpirationMs()>0?te:null,J),o=y}function b(w,y,x){Rm(a,i(),[w,y,x].join("|"))}})}return t.acquisitionSpan=864e5,t.renewalSpan=18e5,t.cookieUpdateInterval=6e4,t}()}),kv,pE=_e(()=>{kv=function(){function t(){}return t}()}),Iv,gE=_e(()=>{Iv=function(){function t(){this.id="browser",this.deviceClass="Browser"}return t}()}),Dv,Pv,mE=_e(()=>{Dv="2.6.4",Pv=function(){function t(e){this.sdkVersion=(e.sdkExtension&&e.sdkExtension()?e.sdkExtension()+"_":"")+"javascript:"+Dv}return t}()});function Fv(t){return!(typeof t!="string"||!t||t.match(/,|;|=| |\|/))}var Nv,vE=_e(()=>{gr(),cr(),vt(),Nv=function(){function t(e,r){this.isNewUser=!1;var n=Kc(r),i=_d(r),o;nr(t,this,function(a){a.config=e;var s=a.config.userCookiePostfix&&a.config.userCookiePostfix()?a.config.userCookiePostfix():"";o=function(){return t.userCookieName+s};var c=i.get(o());if(c){a.isNewUser=!1;var l=c.split(t.cookieSeparator);l.length>0&&(a.id=l[0])}if(!a.id){var u=e||{},h=(u.getNewId?u.getNewId():null)||il;a.id=h(u.idLength?e.idLength():22);var f=31536e3,p=xi(new Date);a.accountAcquisitionDate=p,a.isNewUser=!0;var b=[a.id,p];i.set(o(),b.join(t.cookieSeparator),f);var w=e.namePrefix&&e.namePrefix()?e.namePrefix()+"ai_session":"ai_session";Tm(n,w)}a.accountId=e.accountId?e.accountId():void 0;var y=i.get(t.authUserCookieName);if(y){y=decodeURI(y);var x=y.split(t.cookieSeparator);x[0]&&(a.authenticatedId=x[0]),x.length>1&&x[1]&&(a.accountId=x[1])}a.setAuthenticatedUserContext=function(S,I,D){D===void 0&&(D=!1);var U=!Fv(S)||I&&!Fv(I);if(U){n.throwInternal(Pe.WARNING,Re.SetAuthContextFailedAccountName,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0);return}a.authenticatedId=S;var te=a.authenticatedId;I&&(a.accountId=I,te=[a.authenticatedId,a.accountId].join(t.cookieSeparator)),D&&i.set(t.authUserCookieName,encodeURI(te))},a.clearAuthenticatedUserContext=function(){a.authenticatedId=null,a.accountId=null,i.del(t.authUserCookieName)}})}return t.cookieSeparator="|",t.userCookieName="ai_user",t.authUserCookieName="ai_authUser",t}()}),$v,wE=_e(()=>{$v=function(){function t(){}return t}()}),Mv,yE=_e(()=>{cr(),vt(),Mv=function(){function t(e,r,n,i){var o=this;o.traceID=e||In(),o.parentID=r,o.name=n;var a=no();!n&&a&&a.pathname&&(o.name=a.pathname),o.name=$r(i,o.name)}return t}()});function aa(t,e){t&&t[e]&&ro(t[e]).length===0&&delete t[e]}var vs,ws,Bv,bE=_e(()=>{gr(),vt(),fE(),cr(),pE(),gE(),mE(),vE(),wE(),yE(),vs="ext",ws="tags",Bv=function(){function t(e,r){var n=this,i=e.logger;this.appId=function(){return null},nr(t,this,function(o){o.application=new kv,o.internal=new Pv(r),qc()&&(o.sessionManager=new Av(r,e),o.device=new Iv,o.location=new $v,o.user=new Nv(r,e),o.telemetryTrace=new Mv(void 0,void 0,void 0,i),o.session=new wh),o.applySessionContext=function(a,s){var c=o.session,l=o.sessionManager;c&&pt(c.id)?Ct(Rr(a.ext,Or.AppExt),"sesId",c.id):l&&l.automaticSession&&Ct(Rr(a.ext,Or.AppExt),"sesId",l.automaticSession.id,pt)},o.applyOperatingSystemContxt=function(a,s){Ct(a.ext,Or.OSExt,o.os)},o.applyApplicationContext=function(a,s){var c=o.application;if(c){var l=Rr(a,ws);Ct(l,Lt.applicationVersion,c.ver,pt),Ct(l,Lt.applicationBuild,c.build,pt)}},o.applyDeviceContext=function(a,s){var c=o.device;if(c){var l=Rr(Rr(a,vs),Or.DeviceExt);Ct(l,"localId",c.id,pt),Ct(l,"ip",c.ip,pt),Ct(l,"model",c.model,pt),Ct(l,"deviceClass",c.deviceClass,pt)}},o.applyInternalContext=function(a,s){var c=o.internal;if(c){var l=Rr(a,ws);Ct(l,Lt.internalAgentVersion,c.agentVersion,pt),Ct(l,Lt.internalSdkVersion,c.sdkVersion,pt),(a.baseType===jo.dataType||a.baseType===vn.dataType)&&(Ct(l,Lt.internalSnippet,c.snippetVer,pt),Ct(l,Lt.internalSdkSrc,c.sdkSrc,pt))}},o.applyLocationContext=function(a,s){var c=n.location;c&&Ct(Rr(a,ws,[]),Lt.locationIp,c.ip,pt)},o.applyOperationContext=function(a,s){var c=o.telemetryTrace;if(c){var l=Rr(Rr(a,vs),Or.TraceExt,{traceID:void 0,parentID:void 0});Ct(l,"traceID",c.traceID,pt),Ct(l,"name",c.name,pt),Ct(l,"parentID",c.parentID,pt)}},o.applyWebContext=function(a,s){var c=n.web;c&&Ct(Rr(a,vs),Or.WebExt,c)},o.applyUserContext=function(a,s){var c=o.user;if(c){var l=Rr(a,ws,[]);Ct(l,Lt.userAccountId,c.accountId,pt);var u=Rr(Rr(a,vs),Or.UserExt);Ct(u,"id",c.id,pt),Ct(u,"authId",c.authenticatedId,pt)}},o.cleanUp=function(a,s){var c=a.ext;c&&(aa(c,Or.DeviceExt),aa(c,Or.UserExt),aa(c,Or.WebExt),aa(c,Or.OSExt),aa(c,Or.AppExt),aa(c,Or.TraceExt))}})}return t}()}),Ov,yh,_E=_e(()=>{Ut(),gr(),vt(),bE(),cr(),Ov=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.priority=110,r.identifier=oa;var n,i;return nr(e,r,function(o,a){o.initialize=function(c,l,u,h){a.initialize(c,l,u,h);var f=o._getTelCtx(),p=o.identifier,b=e.getDefaultConfig();i=i||{},sr(b,function(w,y){i[w]=function(){return f.getConfig(p,w,y())}}),o.context=new Bv(l,i),n=_m(u,bl),o.context.appId=function(){return n?n._appId:null},o._extConfig=i},o.processTelemetry=function(c,l){if(!Fe(c)){l=o._getTelCtx(l),c.name===vn.envelopeType&&l.diagLog().resetInternalMessageCount();var u=o.context||{};if(u.session&&typeof o.context.session.id!="string"&&u.sessionManager&&u.sessionManager.update(),s(c,l),u.user&&u.user.isNewUser){u.user.isNewUser=!1;var h=new jo(Re.SendBrowserInfoOnUserInit,(kn()||{}).userAgent||"");l.diagLog().logInternalMessage(Pe.CRITICAL,h)}o.processNext(c,l)}};function s(c,l){Rr(c,"tags",[]),Rr(c,"ext",{});var u=o.context;u.applySessionContext(c,l),u.applyApplicationContext(c,l),u.applyDeviceContext(c,l),u.applyOperationContext(c,l),u.applyUserContext(c,l),u.applyOperatingSystemContxt(c,l),u.applyWebContext(c,l),u.applyLocationContext(c,l),u.applyInternalContext(c,l),u.cleanUp(c,l)}}),r}return e.getDefaultConfig=function(){var r={instrumentationKey:function(){},accountId:function(){return null},sessionRenewalMs:function(){return 30*60*1e3},samplingPercentage:function(){return 100},sessionExpirationMs:function(){return 24*60*60*1e3},cookieDomain:function(){return null},sdkExtension:function(){return null},isBrowserLinkTrackingEnabled:function(){return!1},appId:function(){return null},namePrefix:function(){},sessionCookiePostfix:function(){},userCookiePostfix:function(){},idLength:function(){return 22},getNewId:function(){return null}};return r},e}(ao),yh=Ov}),Uv=_e(()=>{_E()});function Lv(t,e,r){var n=0,i=t[e],o=t[r];return i&&o&&(n=Mr(i,o)),n}function po(t,e,r,n,i){var o=0,a=Lv(r,n,i);return a&&(o=Ii(t,e,ii(a))),o}function Ii(t,e,r){var n="ajaxPerf",i=0;if(t&&e&&r){var o=t[n]=t[n]||{};o[e]=r,i=1}return i}function xE(t,e){var r=t.perfTiming,n=e[Lr]||{},i=0,o="name",a="Start",s="End",c="domainLookup",l="connect",u="redirect",h="request",f="response",p="duration",b="startTime",w=c+a,y=c+s,x=l+a,S=l+s,I=h+a,D=h+s,U=f+a,te=f+s,J=u+a,G=u=s,ue="transferSize",re="encodedBodySize",se="decodedBodySize",xe="serverTiming";if(r){i|=po(n,u,r,J,G),i|=po(n,c,r,w,y),i|=po(n,l,r,x,S),i|=po(n,h,r,I,D),i|=po(n,f,r,U,te),i|=po(n,"networkConnect",r,b,S),i|=po(n,"sentRequest",r,I,te);var dt=r[p];dt||(dt=Lv(r,b,te)||0),i|=Ii(n,p,dt),i|=Ii(n,"perfTotal",dt);var ne=r[xe];if(ne){var Se={};gt(ne,function(ke,Ae){var ze=jC(ke[o]||""+Ae),Ze=Se[ze]||{};sr(ke,function(nt,wt){(nt!==o&&pt(wt)||Ju(wt))&&(Ze[nt]&&(wt=Ze[nt]+";"+wt),(wt||!pt(wt))&&(Ze[nt]=wt))}),Se[ze]=Ze}),i|=Ii(n,xe,Se)}i|=Ii(n,ue,r[ue]),i|=Ii(n,re,r[re]),i|=Ii(n,se,r[se])}else t.perfMark&&(i|=Ii(n,"missing",t.perfAttempts));i&&(e[Lr]=n)}var Lr,Hv,bh,SE=_e(()=>{cr(),vt(),gr(),Lr="properties",Hv=function(){function t(){var e=this;e.openDone=!1,e.setRequestHeaderDone=!1,e.sendDone=!1,e.abortDone=!1,e.stateChangeAttached=!1}return t}(),bh=function(){function t(e,r,n){var i=this,o=n,a="responseText";i.perfMark=null,i.completed=!1,i.requestHeadersSize=null,i.requestHeaders=null,i.responseReceivingDuration=null,i.callbackDuration=null,i.ajaxTotalDuration=null,i.aborted=0,i.pageUrl=null,i.requestUrl=null,i.requestSize=0,i.method=null,i.status=null,i.requestSentTime=null,i.responseStartedTime=null,i.responseFinishedTime=null,i.callbackFinishedTime=null,i.endTime=null,i.xhrMonitoringState=new Hv,i.clientFailure=0,i.traceID=e,i.spanID=r,nr(t,i,function(s){s.getAbsoluteUrl=function(){return s.requestUrl?Im(s.requestUrl):null},s.getPathName=function(){return s.requestUrl?ds(o,Dm(s.method,s.requestUrl)):null},s.CreateTrackItem=function(c,l,u){if(s.ajaxTotalDuration=Math.round(Mr(s.requestSentTime,s.responseFinishedTime)*1e3)/1e3,s.ajaxTotalDuration<0)return null;var h=(w={id:"|"+s.traceID+"."+s.spanID,target:s.getAbsoluteUrl(),name:s.getPathName(),type:c,startTime:null,duration:s.ajaxTotalDuration,success:+s.status>=200&&+s.status<400,responseCode:+s.status,method:s.method},w[Lr]={HttpMethod:s.method},w);if(s.requestSentTime&&(h.startTime=new Date,h.startTime.setTime(s.requestSentTime)),xE(s,h),l&&ro(s.requestHeaders).length>0&&(h[Lr]=h[Lr]||{},h[Lr].requestHeaders=s.requestHeaders),u){var f=u();if(f){var p=f.correlationContext;if(p&&(h.correlationContext=p),f.headerMap&&ro(f.headerMap).length>0&&(h[Lr]=h[Lr]||{},h[Lr].responseHeaders=f.headerMap),s.status>=400){var b=f.type;h[Lr]=h[Lr]||{},(b===""||b==="text")&&(h[Lr][a]=f[a]?f.statusText+" - "+f[a]:f.statusText),b==="json"&&(h[Lr][a]=f.response?f.statusText+" - "+JSON.stringify(f.response):f.statusText)}}}return h;var w}})}return t}()}),CE,EE=_e(()=>{vt(),vt(),CE=function(){function t(){}return t.GetLength=function(e){var r=0;if(!Fe(e)){var n="";try{n=e.toString()}catch(i){}r=n.length,r=isNaN(r)?0:r}return r},t}()}),_h,RE=_e(()=>{vt(),_h=function(){function t(e,r){var n=this;n.traceFlag=t.DEFAULT_TRACE_FLAG,n.version=t.DEFAULT_VERSION,e&&t.isValidTraceId(e)?n.traceId=e:n.traceId=In(),r&&t.isValidSpanId(r)?n.spanId=r:n.spanId=In().substr(0,16)}return t.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&e!=="00000000000000000000000000000000"},t.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&e!=="0000000000000000"},t.prototype.toString=function(){var e=this;return e.version+"-"+e.traceId+"-"+e.spanId+"-"+e.traceFlag},t.DEFAULT_TRACE_FLAG="01",t.DEFAULT_VERSION="00",t}()});function TE(){var t=Uo();return!t||Fe(t.Request)||Fe(t.Request[Xr])||Fe(t[la])?null:t[la]}function AE(t){var e=!1;if(typeof XMLHttpRequest!==Yn&&!Fe(XMLHttpRequest)){var r=XMLHttpRequest[Xr];e=!Fe(r)&&!Fe(r.open)&&!Fe(r.send)&&!Fe(r.abort)}var n=cd();if(n&&n<9&&(e=!1),e)try{var i=new XMLHttpRequest;i[Hr]={};var o=XMLHttpRequest[Xr].open;XMLHttpRequest[Xr].open=o}catch(a){e=!1,ys(t,Re.FailedMonitorAjaxOpen,"Failed to enable XMLHttpRequest monitoring, extension is not supported",{exception:lt(a)})}return e}function Cl(t){var e="";try{!Fe(t)&&!Fe(t[Hr])&&!Fe(t[Hr].requestUrl)&&(e+="(url: '"+t[Hr].requestUrl+"')")}catch(r){}return e}function ys(t,e,r,n,i){t[ca]()[Sh](Pe.CRITICAL,e,r,n,i)}function El(t,e,r,n,i){t[ca]()[Sh](Pe.WARNING,e,r,n,i)}function bs(t,e,r){return function(n){ys(t,e,r,{ajaxDiagnosticsMessage:Cl(n.inst),exception:lt(n.err)})}}function sa(t,e){return t&&e?t.indexOf(e):-1}var xh,ca,Hr,Sh,la,Ch,Eh,kE=_e(()=>{Ut(),cr(),vt(),SE(),EE(),RE(),gr(),xh="ai.ajxmn.",ca="diagLog",Hr="ajaxData",Sh="throwInternal",la="fetch",Ch=0,Eh=function(t){Nt(e,t);function e(){var r=t.call(this)||this;r.identifier=e.identifier,r.priority=120;var n="trackDependencyDataInternal",i=no(),o=!1,a=!1,s=i&&i.host&&i.host.toLowerCase(),c=e.getEmptyConfig(),l=!1,u=0,h,f,p,b,w=!1,y=0,x=!1,S=[],I={},D;return nr(e,r,function(U,te){U.initialize=function(ve,Ie,Oe,Ne){if(!U.isInitialized()){te.initialize(ve,Ie,Oe,Ne);var Ve=U._getTelCtx(),tt=e.getDefaultConfig();sr(tt,function(Pr,wi){c[Pr]=Ve.getConfig(e.identifier,Pr,wi)});var et=c.distributedTracingMode;if(l=c.enableRequestHeaderTracking,w=c.enableAjaxPerfTracking,y=c.maxAjaxCallsPerView,x=c.enableResponseHeaderTracking,D=c.excludeRequestFromAutoTrackingPatterns,p=et===gn.AI||et===gn.AI_AND_W3C,f=et===gn.AI_AND_W3C||et===gn.W3C,w){var yt=ve.instrumentationKey||"unkwn";yt.length>5?b=xh+yt.substring(yt.length-5)+".":b=xh+yt+"."}if(c.disableAjaxTracking===!1&&re(),G(),Oe.length>0&&Oe){for(var zt=void 0,er=0;!zt&&er<Oe.length;)Oe[er]&&Oe[er].identifier===oa&&(zt=Oe[er]),er++;zt&&(h=zt.context)}}},U.teardown=function(){gt(S,function(ve){ve.rm()}),S=[],o=!1,a=!1,U.setInitialized(!1)},U.trackDependencyData=function(ve,Ie){U[n](ve,Ie)},U.includeCorrelationHeaders=function(ve,Ie,Oe,Ne){var Ve=U._currentWindowHost||s;if(Ie){if(Ti.canIncludeCorrelationHeader(c,ve.getAbsoluteUrl(),Ve)){if(Oe||(Oe={}),Oe.headers=new Headers(Oe.headers||(Ie instanceof Request?Ie.headers||{}:{})),p){var tt="|"+ve.traceID+"."+ve.spanID;Oe.headers.set(Wt.requestIdHeader,tt),l&&(ve.requestHeaders[Wt.requestIdHeader]=tt)}var et=c.appId||h&&h.appId();if(et&&(Oe.headers.set(Wt.requestContextHeader,Wt.requestContextAppIdFormat+et),l&&(ve.requestHeaders[Wt.requestContextHeader]=Wt.requestContextAppIdFormat+et)),f){var yt=new _h(ve.traceID,ve.spanID);Oe.headers.set(Wt.traceParentHeader,yt.toString()),l&&(ve.requestHeaders[Wt.traceParentHeader]=yt.toString())}}return Oe}else if(Ne){if(Ti.canIncludeCorrelationHeader(c,ve.getAbsoluteUrl(),Ve)){if(p){var tt="|"+ve.traceID+"."+ve.spanID;Ne.setRequestHeader(Wt.requestIdHeader,tt),l&&(ve.requestHeaders[Wt.requestIdHeader]=tt)}var et=c.appId||h&&h.appId();if(et&&(Ne.setRequestHeader(Wt.requestContextHeader,Wt.requestContextAppIdFormat+et),l&&(ve.requestHeaders[Wt.requestContextHeader]=Wt.requestContextAppIdFormat+et)),f){var yt=new _h(ve.traceID,ve.spanID);Ne.setRequestHeader(Wt.traceParentHeader,yt.toString()),l&&(ve.requestHeaders[Wt.traceParentHeader]=yt.toString())}}return Ne}},U[n]=function(ve,Ie,Oe){if(y===-1||u<y){(c.distributedTracingMode===gn.W3C||c.distributedTracingMode===gn.AI_AND_W3C)&&typeof ve.id=="string"&&ve.id[ve.id.length-1]!=="."&&(ve.id+="."),Fe(ve.startTime)&&(ve.startTime=new Date);var Ne=Fn.create(ve,Pn.dataType,Pn.envelopeType,U[ca](),Ie,Oe);U.core.track(Ne)}else u===y&&ys(U,Re.MaxAjaxPerPVExceeded,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++u};function J(ve){var Ie=!0;return(ve||c.ignoreHeaders)&&gt(c.ignoreHeaders,function(Oe){if(Oe.toLowerCase()===ve.toLowerCase())return Ie=!1,-1}),Ie}function G(){var ve=TE();if(ve){var Ie=Uo(),Oe=ve.polyfill;c.disableFetchTracking===!1?(S.push(Bd(Ie,la,{req:function(Ne,Ve,tt){var et;if(o&&!se(null,Ve,tt)&&!(Oe&&a)){var yt=Ne.ctx();et=nt(Ve,tt);var zt=U.includeCorrelationHeaders(et,Ve,tt);zt!==tt&&Ne.set(1,zt),yt.data=et}},rsp:function(Ne,Ve){var tt=Ne.ctx().data;tt&&(Ne.rslt=Ne.rslt.then(function(et){return Bt(Ne,(et||{}).status,et,tt,function(){var yt={statusText:et.statusText,headerMap:null,correlationContext:un(et)};if(x){var zt={};et.headers.forEach(function(er,Pr){J(Pr)&&(zt[Pr]=er)}),yt.headerMap=zt}return yt}),et}).catch(function(et){throw Bt(Ne,0,Ve,tt,null,{error:et.message}),et}))},hkErr:bs(U,Re.FailedMonitorAjaxOpen,"Failed to monitor Window.fetch, monitoring data for this fetch call may be incorrect.")})),o=!0):Oe&&S.push(Bd(Ie,la,{req:function(Ne,Ve,tt){se(null,Ve,tt)}})),Oe&&(Ie[la].polyfill=Oe)}}function ue(ve,Ie,Oe){S.push(b1(ve,Ie,Oe))}function re(){AE(U)&&!a&&(ue(XMLHttpRequest,"open",{req:function(ve,Ie,Oe,Ne){var Ve=ve.inst,tt=Ve[Hr];!se(Ve,Oe)&&xe(Ve,!0)&&(!tt||!tt.xhrMonitoringState.openDone)&&dt(Ve,Ie,Oe,Ne)},hkErr:bs(U,Re.FailedMonitorAjaxOpen,"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.")}),ue(XMLHttpRequest,"send",{req:function(ve,Ie){var Oe=ve.inst,Ne=Oe[Hr];xe(Oe)&&!Ne.xhrMonitoringState.sendDone&&(ze("xhr",Ne),Ne.requestSentTime=fs(),U.includeCorrelationHeaders(Ne,void 0,void 0,Oe),Ne.xhrMonitoringState.sendDone=!0)},hkErr:bs(U,Re.FailedMonitorAjaxSend,"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.")}),ue(XMLHttpRequest,"abort",{req:function(ve){var Ie=ve.inst,Oe=Ie[Hr];xe(Ie)&&!Oe.xhrMonitoringState.abortDone&&(Oe.aborted=1,Oe.xhrMonitoringState.abortDone=!0)},hkErr:bs(U,Re.FailedMonitorAjaxAbort,"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.")}),l&&ue(XMLHttpRequest,"setRequestHeader",{req:function(ve,Ie,Oe){var Ne=ve.inst;xe(Ne)&&J(Ie)&&(Ne[Hr].requestHeaders[Ie]=Oe)},hkErr:bs(U,Re.FailedMonitorAjaxSetRequestHeader,"Failed to monitor XMLHttpRequest.setRequestHeader, monitoring data for this ajax call may be incorrect.")}),a=!0)}function se(ve,Ie,Oe){var Ne=!1,Ve=((pt(Ie)?Ie:(Ie||{}).url||"")||"").toLowerCase();if(gt(D,function(yt){var zt=yt;pt(yt)&&(zt=new RegExp(yt)),Ne||(Ne=zt.test(Ve))}),Ne)return Ne;var tt=sa(Ve,"?"),et=sa(Ve,"#");return(tt===-1||et!==-1&&et<tt)&&(tt=et),tt!==-1&&(Ve=Ve.substring(0,tt)),Fe(ve)?Fe(Ie)||(Ne=(typeof Ie=="object"?Ie[lo]===!0:!1)||(Oe?Oe[lo]===!0:!1)):Ne=ve[lo]===!0||Ve[lo]===!0,Ne?I[Ve]||(I[Ve]=1):I[Ve]&&(Ne=!0),Ne}function xe(ve,Ie){var Oe=!0,Ne=a;return Fe(ve)||(Oe=Ie===!0||!Fe(ve[Hr])),Ne&&Oe}function dt(ve,Ie,Oe,Ne){var Ve=h&&h.telemetryTrace&&h.telemetryTrace.traceID||In(),tt=In().substr(0,16),et=new bh(Ve,tt,U[ca]());et.method=Ie,et.requestUrl=Oe,et.xhrMonitoringState.openDone=!0,et.requestHeaders={},et.async=Ne,ve[Hr]=et,ne(ve)}function ne(ve){ve[Hr].xhrMonitoringState.stateChangeAttached=us.Attach(ve,"readystatechange",function(){try{ve&&ve.readyState===4&&xe(ve)&&ke(ve)}catch(Oe){var Ie=lt(Oe);(!Ie||sa(Ie.toLowerCase(),"c00c023f")===-1)&&ys(U,Re.FailedMonitorAjaxRSC,"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:Cl(ve),exception:Ie})}})}function Se(ve){try{var Ie=ve.responseType;if(Ie===""||Ie==="text")return ve.responseText}catch(Oe){}return null}function ke(ve){var Ie=ve[Hr];Ie.responseFinishedTime=fs(),Ie.status=ve.status;function Oe(Ne,Ve){var tt=Ve||{};tt.ajaxDiagnosticsMessage=Cl(ve),Ne&&(tt.exception=lt(Ne)),El(U,Re.FailedMonitorAjaxDur,"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.",tt)}Ze("xmlhttprequest",Ie,function(){try{var Ne=Ie.CreateTrackItem("Ajax",l,function(){var Ve={statusText:ve.statusText,headerMap:null,correlationContext:Ae(ve),type:ve.responseType,responseText:Se(ve),response:ve.response};if(x){var tt=ve.getAllResponseHeaders();if(tt){var et=br(tt).split(/[\r\n]+/),yt={};gt(et,function(zt){var er=zt.split(": "),Pr=er.shift(),wi=er.join(": ");J(Pr)&&(yt[Pr]=wi)}),Ve.headerMap=yt}}return Ve});Ne?U[n](Ne):Oe(null,{requestSentTime:Ie.requestSentTime,responseFinishedTime:Ie.responseFinishedTime})}finally{try{ve[Hr]=null}catch(Ve){}}},function(Ne){Oe(Ne,null)})}function Ae(ve){try{var Ie=ve.getAllResponseHeaders();if(Ie!==null){var Oe=sa(Ie.toLowerCase(),Wt.requestContextHeaderLowerCase);if(Oe!==-1){var Ne=ve.getResponseHeader(Wt.requestContextHeader);return Ti.getCorrelationContext(Ne)}}}catch(Ve){El(U,Re.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{ajaxDiagnosticsMessage:Cl(ve),exception:lt(Ve)})}}function ze(ve,Ie){if(Ie.requestUrl&&b&&w){var Oe=ti();if(Oe&&St(Oe.mark)){Ch++;var Ne=b+ve+"#"+Ch;Oe.mark(Ne);var Ve=Oe.getEntriesByName(Ne);Ve&&Ve.length===1&&(Ie.perfMark=Ve[0])}}}function Ze(ve,Ie,Oe,Ne){var Ve=Ie.perfMark,tt=ti(),et=c.maxAjaxPerfLookupAttempts,yt=c.ajaxPerfLookupDelay,zt=Ie.requestUrl,er=0;(function Pr(){try{if(tt&&Ve){er++;for(var wi=null,gu=tt.getEntries(),Da=gu.length-1;Da>=0;Da--){var dn=gu[Da];if(dn){if(dn.entryType==="resource")dn.initiatorType===ve&&(sa(dn.name,zt)!==-1||sa(zt,dn.name)!==-1)&&(wi=dn);else if(dn.entryType==="mark"&&dn.name===Ve.name){Ie.perfTiming=wi;break}if(dn.startTime<Ve.startTime-1e3)break}}}!Ve||Ie.perfTiming||er>=et||Ie.async===!1?(Ve&&St(tt.clearMarks)&&tt.clearMarks(Ve.name),Ie.perfAttempts=er,Oe()):setTimeout(Pr,yt)}catch(tp){Ne(tp)}})()}function nt(ve,Ie){var Oe=h&&h.telemetryTrace&&h.telemetryTrace.traceID||In(),Ne=In().substr(0,16),Ve=new bh(Oe,Ne,U[ca]());Ve.requestSentTime=fs(),ve instanceof Request?Ve.requestUrl=ve?ve.url:"":Ve.requestUrl=ve;var tt="GET";Ie&&Ie.method?tt=Ie.method:ve&&ve instanceof Request&&(tt=ve.method),Ve.method=tt;var et={};if(l){var yt=new Headers((Ie?Ie.headers:0)||(ve instanceof Request?ve.headers||{}:{}));yt.forEach(function(zt,er){J(er)&&(et[er]=zt)})}return Ve.requestHeaders=et,ze("fetch",Ve),Ve}function wt(ve){var Ie="";try{Fe(ve)||(typeof ve=="string"?Ie+="(url: '"+ve+"')":Ie+="(url: '"+ve.url+"')")}catch(Oe){ys(U,Re.FailedMonitorAjaxOpen,"Failed to grab failed fetch diagnostics message",{exception:lt(Oe)})}return Ie}function Bt(ve,Ie,Oe,Ne,Ve,tt){if(!Ne)return;function et(yt,zt,er){var Pr=er||{};Pr.fetchDiagnosticsMessage=wt(Oe),zt&&(Pr.exception=lt(zt)),El(U,yt,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",Pr)}Ne.responseFinishedTime=fs(),Ne.status=Ie,Ze("fetch",Ne,function(){var yt=Ne.CreateTrackItem("Fetch",l,Ve);yt?U[n](yt):et(Re.FailedMonitorAjaxDur,null,{requestSentTime:Ne.requestSentTime,responseFinishedTime:Ne.responseFinishedTime})},function(yt){et(Re.FailedMonitorAjaxGetCorrelationHeader,yt,null)})}function un(ve){if(ve&&ve.headers)try{var Ie=ve.headers.get(Wt.requestContextHeader);return Ti.getCorrelationContext(Ie)}catch(Oe){El(U,Re.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{fetchDiagnosticsMessage:wt(ve),exception:lt(Oe)})}}}),r}return e.getDefaultConfig=function(){var r={maxAjaxCallsPerView:500,disableAjaxTracking:!1,disableFetchTracking:!0,excludeRequestFromAutoTrackingPatterns:void 0,disableCorrelationHeaders:!1,distributedTracingMode:gn.AI_AND_W3C,correlationHeaderExcludedDomains:["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],correlationHeaderDomains:void 0,correlationHeaderExcludePatterns:void 0,appId:void 0,enableCorsCorrelation:!1,enableRequestHeaderTracking:!1,enableResponseHeaderTracking:!1,enableAjaxErrorStatusText:!1,enableAjaxPerfTracking:!1,maxAjaxPerfLookupAttempts:3,ajaxPerfLookupDelay:25,ignoreHeaders:["Authorization","X-API-Key","WWW-Authenticate"]};return r},e.getEmptyConfig=function(){var r=this.getDefaultConfig();return sr(r,function(n){r[n]=void 0}),r},e.prototype.processTelemetry=function(r,n){this.processNext(r,n)},e.identifier="AjaxDependencyPlugin",e}(ao)}),qv=_e(()=>{kE()}),Rh,Th,Wv,zv,Ah,jv=_e(()=>{vt(),hv(),Rv(),Uv(),qv(),cr(),Th=["snippet","dependencies","properties","_snippetVersion","appInsightsNew","getSKUDefaults"],Wv={Default:0,Required:1,Array:2,Hidden:4},zv={__proto__:null,PropertiesPluginIdentifier:oa,BreezeChannelIdentifier:bl,AnalyticsPluginIdentifier:uh,Util:Yd,CorrelationIdHelper:Ti,UrlHelper:Mm,DateTimeUtils:Bm,ConnectionStringParser:qm,FieldType:Wv,RequestHeaders:Wt,DisabledPropertyName:lo,ProcessLegacy:ea,SampleRate:sl,HttpMethod:cl,DEFAULT_BREEZE_ENDPOINT:jd,AIData:eh,AIBase:Jd,Envelope:th,Event:mn,Exception:Br,Metric:Dn,PageView:vn,PageViewData:vl,RemoteDependencyData:Pn,Trace:oi,PageViewPerformance:ai,Data:si,SeverityLevel:ps,ConfigurationManager:av,ContextTagKeys:yl,DataSanitizer:ym,TelemetryItemCreator:Fn,CtxTagKeys:Lt,Extensions:Or,DistributedTracingModes:gn},Ah=function(){function t(e){var r=this;r._snippetVersion=""+(e.sv||e.version||""),e.queue=e.queue||[],e.version=e.version||2;var n=e.config||{};if(n.connectionString){var i=Um(n.connectionString),o=i.ingestionendpoint;n.endpointUrl=o?o+"/v2/track":n.endpointUrl,n.instrumentationKey=i.instrumentationkey||n.instrumentationKey}r.appInsights=new hh,r.properties=new yh,r.dependencies=new Eh,r.core=new Pd,r._sender=new vh,r.snippet=e,r.config=n,r.getSKUDefaults()}return t.prototype.getCookieMgr=function(){return this.appInsights.getCookieMgr()},t.prototype.trackEvent=function(e,r){this.appInsights.trackEvent(e,r)},t.prototype.trackPageView=function(e){var r=e||{};this.appInsights.trackPageView(r)},t.prototype.trackPageViewPerformance=function(e){var r=e||{};this.appInsights.trackPageViewPerformance(r)},t.prototype.trackException=function(e){e&&!e.exception&&e.error&&(e.exception=e.error),this.appInsights.trackException(e)},t.prototype._onerror=function(e){this.appInsights._onerror(e)},t.prototype.trackTrace=function(e,r){this.appInsights.trackTrace(e,r)},t.prototype.trackMetric=function(e,r){this.appInsights.trackMetric(e,r)},t.prototype.startTrackPage=function(e){this.appInsights.startTrackPage(e)},t.prototype.stopTrackPage=function(e,r,n,i){this.appInsights.stopTrackPage(e,r,n,i)},t.prototype.startTrackEvent=function(e){this.appInsights.startTrackEvent(e)},t.prototype.stopTrackEvent=function(e,r,n){this.appInsights.stopTrackEvent(e,r,n)},t.prototype.addTelemetryInitializer=function(e){return this.appInsights.addTelemetryInitializer(e)},t.prototype.setAuthenticatedUserContext=function(e,r,n){n===void 0&&(n=!1),this.properties.context.user.setAuthenticatedUserContext(e,r,n)},t.prototype.clearAuthenticatedUserContext=function(){this.properties.context.user.clearAuthenticatedUserContext()},t.prototype.trackDependencyData=function(e){this.dependencies.trackDependencyData(e)},t.prototype.flush=function(e){var r=this;e===void 0&&(e=!0),Vo(this.core,function(){return"AISKU.flush"},function(){gt(r.core.getTransmissionControls(),function(n){gt(n,function(i){i.flush(e)})})},null,e)},t.prototype.onunloadFlush=function(e){e===void 0&&(e=!0),gt(this.core.getTransmissionControls(),function(r){gt(r,function(n){n.onunloadFlush?n.onunloadFlush():n.flush(e)})})},t.prototype.loadAppInsights=function(e,r,n){var i=this;e===void 0&&(e=!1);var o=this;function a(s){if(s){var c="";Fe(o._snippetVersion)||(c+=o._snippetVersion),e&&(c+=".lg"),o.context&&o.context.internal&&(o.context.internal.snippetVer=c||"-"),sr(o,function(l,u){pt(l)&&!St(u)&&l&&l[0]!=="_"&&Th.indexOf(l)===-1&&(s[l]=u)})}}return e&&o.config.extensions&&o.config.extensions.length>0&&Tn("Extensions not allowed in legacy mode"),Vo(o.core,function(){return"AISKU.loadAppInsights"},function(){var s=[];s.push(o._sender),s.push(o.properties),s.push(o.dependencies),s.push(o.appInsights),o.core.initialize(o.config,s,r,n),o.context=o.properties.context,Rh&&o.context&&(o.context.internal.sdkSrc=Rh),a(o.snippet),o.emptyQueue(),o.pollInternalLogs(),o.addHousekeepingBeforeUnload(i)}),o},t.prototype.updateSnippetDefinitions=function(e){xg(e,this,function(r){return r&&Th.indexOf(r)===-1})},t.prototype.emptyQueue=function(){var e=this;try{if(ei(e.snippet.queue)){for(var r=e.snippet.queue.length,n=0;n<r;n++){var i=e.snippet.queue[n];i()}e.snippet.queue=void 0,delete e.snippet.queue}}catch(a){var o={};a&&St(a.toString)&&(o.exception=a.toString())}},t.prototype.pollInternalLogs=function(){this.core.pollInternalLogs()},t.prototype.addHousekeepingBeforeUnload=function(e){if(qc()||Eg()){var r=function(){e.onunloadFlush(!1),gt(e.appInsights.core._extensions,function(i){if(i.identifier===oa)return i&&i.context&&i.context._sessionManager&&i.context._sessionManager.backup(),-1})};if(!e.appInsights.config.disableFlushOnBeforeUnload){var n=co("beforeunload",r);n=co("unload",r)||n,n=co("pagehide",r)||n,n=co("visibilitychange",r)||n,!n&&!r1()&&e.appInsights.core.logger.throwInternal(Pe.CRITICAL,Re.FailedToAddHandlerForOnBeforeUnload,"Could not add handler for beforeunload and pagehide")}e.appInsights.config.disableFlushOnUnload||(co("pagehide",r),co("visibilitychange",r))}},t.prototype.getSender=function(){return this._sender},t.prototype.getSKUDefaults=function(){var e=this;e.config.diagnosticLogInterval=e.config.diagnosticLogInterval&&e.config.diagnosticLogInterval>0?e.config.diagnosticLogInterval:1e4},t}(),function(){var t=null,e=!1,r=["://js.monitor.azure.com/","://az416426.vo.msecnd.net/"];try{var n=(document||{}).currentScript;n&&(t=n.src)}catch(s){}if(t)try{var i=t.toLowerCase();if(i){for(var o="",a=0;a<r.length;a++)if(i.indexOf(r[a])!==-1){o="cdn"+(a+1),i.indexOf("/scripts/")===-1&&(i.indexOf("/next/")!==-1?o+="-next":i.indexOf("/beta/")!==-1&&(o+="-beta")),Rh=o+(e?".mod":"");break}}}catch(s){}}()}),Vv,Gv,IE=_e(()=>{cr(),vt(),Vv=["snippet","getDefaultConfig","_hasLegacyInitializers","_queue","_processLegacyInitializers"],Gv=function(){function t(e,r){this._hasLegacyInitializers=!1,this._queue=[],this.config=t.getDefaultConfig(e.config),this.appInsightsNew=r,this.context={addTelemetryInitializer:this.addTelemetryInitializers.bind(this)}}return t.getDefaultConfig=function(e){return e||(e={}),e.endpointUrl=e.endpointUrl||"https://dc.services.visualstudio.com/v2/track",e.sessionRenewalMs=30*60*1e3,e.sessionExpirationMs=24*60*60*1e3,e.maxBatchSizeInBytes=e.maxBatchSizeInBytes>0?e.maxBatchSizeInBytes:102400,e.maxBatchInterval=isNaN(e.maxBatchInterval)?15e3:e.maxBatchInterval,e.enableDebug=Mt(e.enableDebug),e.disableExceptionTracking=Mt(e.disableExceptionTracking),e.disableTelemetry=Mt(e.disableTelemetry),e.verboseLogging=Mt(e.verboseLogging),e.emitLineDelimitedJson=Mt(e.emitLineDelimitedJson),e.diagnosticLogInterval=e.diagnosticLogInterval||1e4,e.autoTrackPageVisitTime=Mt(e.autoTrackPageVisitTime),(isNaN(e.samplingPercentage)||e.samplingPercentage<=0||e.samplingPercentage>=100)&&(e.samplingPercentage=100),e.disableAjaxTracking=Mt(e.disableAjaxTracking),e.maxAjaxCallsPerView=isNaN(e.maxAjaxCallsPerView)?500:e.maxAjaxCallsPerView,e.isBeaconApiDisabled=Mt(e.isBeaconApiDisabled,!0),e.disableCorrelationHeaders=Mt(e.disableCorrelationHeaders),e.correlationHeaderExcludedDomains=e.correlationHeaderExcludedDomains||["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],e.disableFlushOnBeforeUnload=Mt(e.disableFlushOnBeforeUnload),e.disableFlushOnUnload=Mt(e.disableFlushOnUnload,e.disableFlushOnBeforeUnload),e.enableSessionStorageBuffer=Mt(e.enableSessionStorageBuffer,!0),e.isRetryDisabled=Mt(e.isRetryDisabled),e.isCookieUseDisabled=Mt(e.isCookieUseDisabled),e.isStorageUseDisabled=Mt(e.isStorageUseDisabled),e.isBrowserLinkTrackingEnabled=Mt(e.isBrowserLinkTrackingEnabled),e.enableCorsCorrelation=Mt(e.enableCorsCorrelation),e},t.prototype.addTelemetryInitializers=function(e){var r=this;this._hasLegacyInitializers||(this.appInsightsNew.addTelemetryInitializer(function(n){r._processLegacyInitializers(n)}),this._hasLegacyInitializers=!0),this._queue.push(e)},t.prototype.getCookieMgr=function(){return this.appInsightsNew.getCookieMgr()},t.prototype.startTrackPage=function(e){this.appInsightsNew.startTrackPage(e)},t.prototype.stopTrackPage=function(e,r,n,i){this.appInsightsNew.stopTrackPage(e,r,n)},t.prototype.trackPageView=function(e,r,n,i,o){var a={name:e,uri:r,properties:n,measurements:i};this.appInsightsNew.trackPageView(a)},t.prototype.trackEvent=function(e,r,n){this.appInsightsNew.trackEvent({name:e})},t.prototype.trackDependency=function(e,r,n,i,o,a,s){this.appInsightsNew.trackDependencyData({id:e,target:n,type:i,duration:o,properties:{HttpMethod:r},success:a,responseCode:s})},t.prototype.trackException=function(e,r,n,i,o){this.appInsightsNew.trackException({exception:e})},t.prototype.trackMetric=function(e,r,n,i,o,a){this.appInsightsNew.trackMetric({name:e,average:r,sampleCount:n,min:i,max:o})},t.prototype.trackTrace=function(e,r,n){this.appInsightsNew.trackTrace({message:e,severityLevel:n})},t.prototype.flush=function(e){this.appInsightsNew.flush(e)},t.prototype.setAuthenticatedUserContext=function(e,r,n){this.appInsightsNew.context.user.setAuthenticatedUserContext(e,r,n)},t.prototype.clearAuthenticatedUserContext=function(){this.appInsightsNew.context.user.clearAuthenticatedUserContext()},t.prototype._onerror=function(e,r,n,i,o){this.appInsightsNew._onerror({message:e,url:r,lineNumber:n,columnNumber:i,error:o})},t.prototype.startTrackEvent=function(e){this.appInsightsNew.startTrackEvent(e)},t.prototype.stopTrackEvent=function(e,r,n){this.appInsightsNew.stopTrackEvent(e,r,n)},t.prototype.downloadAndSetup=function(e){Tn("downloadAndSetup not implemented in web SKU")},t.prototype.updateSnippetDefinitions=function(e){xg(e,this,function(r){return r&&Vv.indexOf(r)===-1})},t.prototype.loadAppInsights=function(){var e=this;if(this.config.iKey){var r=this.trackPageView;this.trackPageView=function(o,a,s){r.apply(e,[null,o,a,s])}}var n="logPageView";typeof this.snippet[n]=="function"&&(this[n]=function(o,a,s){e.trackPageView(null,o,a,s)});var i="logEvent";return typeof this.snippet[i]=="function"&&(this[i]=function(o,a,s){e.trackEvent(o,a,s)}),this},t.prototype._processLegacyInitializers=function(e){return e.tags[ea]=this._queue,e},t}()}),Kv,DE=_e(()=>{IE(),jv(),vt(),Kv=function(){function t(){}return t.getAppInsights=function(e,r){var n=new Ah(e),i=r!==2;if(Qo(),r===2)return n.updateSnippetDefinitions(e),n.loadAppInsights(i),n;var o=new Gv(e,n);return o.updateSnippetDefinitions(e),n.loadAppInsights(i),o},t}()}),Zv={};DC(Zv,{AppInsightsCore:()=>Pd,ApplicationAnalytics:()=>hh,ApplicationInsights:()=>Ah,ApplicationInsightsContainer:()=>Kv,BaseCore:()=>Id,BaseTelemetryPlugin:()=>ao,CoreUtils:()=>ol,DependenciesPlugin:()=>Eh,DistributedTracingModes:()=>gn,Event:()=>mn,Exception:()=>Br,LoggingSeverity:()=>Pe,Metric:()=>Dn,NotificationManager:()=>Dd,PageView:()=>vn,PageViewPerformance:()=>ai,PerfEvent:()=>Go,PerfManager:()=>fd,PropertiesPlugin:()=>yh,RemoteDependencyData:()=>Pn,Sender:()=>vh,SeverityLevel:()=>ps,Telemetry:()=>zv,Trace:()=>oi,Util:()=>Yd,_InternalMessageId:()=>Re,doPerf:()=>Vo});var PE=_e(()=>{jv(),DE(),vt(),cr(),Rv(),hv(),Uv(),qv()}),rn;(function(t){t.ON="on",t.ERROR="error",t.OFF="off"})(rn||(rn={}));function kh(){let t="telemetry",e="enableTelemetry";return d.env.isTelemetryEnabled!==void 0?d.env.isTelemetryEnabled?rn.ON:rn.OFF:d.workspace.getConfiguration(t).get(e)?rn.ON:rn.OFF}var FE=class{constructor(t,e,r,n,i){this.extensionId=t,this.extensionVersion=e,this.telemetryAppender=r,this.osShim=n,this.firstParty=!1,this.userOptIn=!1,this.errorOptIn=!1,this.disposables=[],this.firstParty=!!i,this.updateUserOptStatus(),d.env.onDidChangeTelemetryEnabled!==void 0?(this.disposables.push(d.env.onDidChangeTelemetryEnabled(()=>this.updateUserOptStatus())),this.disposables.push(d.workspace.onDidChangeConfiguration(()=>this.updateUserOptStatus()))):this.disposables.push(d.workspace.onDidChangeConfiguration(()=>this.updateUserOptStatus()))}updateUserOptStatus(){let t=kh();this.userOptIn=t===rn.ON,this.errorOptIn=t===rn.ERROR||t===rn.ON,(this.userOptIn||this.errorOptIn)&&this.telemetryAppender.instantiateAppender()}cleanRemoteName(t){if(!t)return"none";let e="other";return["ssh-remote","dev-container","attached-container","wsl"].forEach(r=>{t.indexOf(`${r}+`)===0&&(e=r)}),e}get extension(){return this._extension===void 0&&(this._extension=d.extensions.getExtension(this.extensionId)),this._extension}cloneAndChange(t,e){if(t===null||typeof t!="object"||typeof e!="function")return t;let r={};for(let n in t)r[n]=e(n,t[n]);return r}shouldSendErrorTelemetry(){return this.errorOptIn===!1?!1:this.firstParty?this.cleanRemoteName(d.env.remoteName)!=="other"?!0:!(this.extension===void 0||this.extension.extensionKind===d.ExtensionKind.Workspace||d.env.uiKind===d.UIKind.Web):!0}getCommonProperties(){let t=Object.create(null);if(t["common.os"]=this.osShim.platform,t["common.platformversion"]=(this.osShim.release||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),t["common.extname"]=this.extensionId,t["common.extversion"]=this.extensionVersion,d&&d.env){switch(t["common.vscodemachineid"]=d.env.machineId,t["common.vscodesessionid"]=d.env.sessionId,t["common.vscodeversion"]=d.version,t["common.isnewappinstall"]=d.env.isNewAppInstall?d.env.isNewAppInstall.toString():"false",t["common.product"]=d.env.appHost,d.env.uiKind){case d.UIKind.Web:t["common.uikind"]="web";break;case d.UIKind.Desktop:t["common.uikind"]="desktop";break;default:t["common.uikind"]="unknown"}t["common.remotename"]=this.cleanRemoteName(d.env.remoteName)}return t}anonymizeFilePaths(t,e){let r;if(t==null)return"";let n=[];d.env.appRoot!==""&&n.push(new RegExp(d.env.appRoot.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi")),this.extension&&n.push(new RegExp(this.extension.extensionPath.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"));let i=t;if(e){let o=[];for(let l of n)for(;(r=l.exec(t))&&r;)o.push([r.index,l.lastIndex]);let a=/^[\\/]?(node_modules|node_modules\.asar)[\\/]/,s=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-._]+(\\\\|\\|\/))+[\w-._]*/g,c=0;for(i="";(r=s.exec(t))&&r;)r[0]&&!a.test(r[0])&&o.every(([l,u])=>r.index<l||r.index>=u)&&(i+=t.substring(c,r.index)+"<REDACTED: user-file-path>",c=s.lastIndex);c<t.length&&(i+=t.substr(c))}for(let o of n)i=i.replace(o,"");return i}removePropertiesWithPossibleUserInfo(t){if(typeof t!="object")return;let e=Object.create(null);for(let r of Object.keys(t)){let n=t[r];if(!n)continue;let i=/@[a-zA-Z0-9-.]+/;/\S*(key|token|sig|password|passwd|pwd)[="':\s]+\S*/.test(n.toLowerCase())?e[r]="<REDACTED: secret>":i.test(n)?e[r]="<REDACTED: email>":e[r]=n}return e}sendTelemetryEvent(t,e,r){if(this.userOptIn&&t!==""){e={...e,...this.getCommonProperties()};let n=this.cloneAndChange(e,(i,o)=>this.anonymizeFilePaths(o,this.firstParty));this.telemetryAppender.logEvent(`${this.extensionId}/${t}`,{properties:this.removePropertiesWithPossibleUserInfo(n),measurements:r})}}sendTelemetryErrorEvent(t,e,r,n){if(this.errorOptIn&&t!==""){e={...e,...this.getCommonProperties()};let i=this.cloneAndChange(e,(o,a)=>this.shouldSendErrorTelemetry()?this.anonymizeFilePaths(a,this.firstParty):n===void 0||n.indexOf(o)!==-1?"REDACTED":this.anonymizeFilePaths(a,this.firstParty));this.telemetryAppender.logEvent(`${this.extensionId}/${t}`,{properties:this.removePropertiesWithPossibleUserInfo(i),measurements:r})}}sendTelemetryException(t,e,r){if(this.shouldSendErrorTelemetry()&&this.errorOptIn&&t){e={...e,...this.getCommonProperties()};let n=this.cloneAndChange(e,(i,o)=>this.anonymizeFilePaths(o,this.firstParty));t.stack&&(t.stack=this.anonymizeFilePaths(t.stack,this.firstParty)),this.telemetryAppender.logException(t,{properties:this.removePropertiesWithPossibleUserInfo(n),measurements:r})}}dispose(){return this.telemetryAppender.flush(),Promise.all(this.disposables.map(t=>t.dispose()))}},NE=class{constructor(t){this._key=t,this._isInstantiated=!1,kh()!==rn.OFF&&this.instantiateAppender()}logEvent(t,e){!this._aiClient||this._aiClient.trackEvent({name:t},{...e.properties,...e.measurements})}logException(t,e){!this._aiClient||this._aiClient.trackException({exception:t,properties:{...e.properties,...e.measurements}})}flush(){return this._aiClient&&(this._aiClient.flush(),this._aiClient=void 0),Promise.resolve(void 0)}instantiateAppender(){this._isInstantiated||Promise.resolve().then(()=>(PE(),Zv)).then(t=>{let e;this._key&&this._key.indexOf("AIF-")===0&&(e="https://vortex.data.microsoft.com/collect/v1"),this._aiClient=new t.ApplicationInsights({config:{instrumentationKey:this._key,endpointUrl:e,disableAjaxTracking:!0,disableExceptionTracking:!0,disableFetchTracking:!0,disableCorrelationHeaders:!0,disableCookiesUsage:!0,autoTrackPageVisitTime:!1,emitLineDelimitedJson:!0,disableInstrumentationKeyValidation:!0}}),this._aiClient.loadAppInsights();let r=kh();e&&(r===rn.ON||r===rn.ERROR)&&fetch(e).catch(()=>this._aiClient=void 0),this._isInstantiated=!0})}},$E=class extends FE{constructor(t,e,r,n){let i=new NE(r);r&&r.indexOf("AIF-")===0&&(n=!0);super(t,e,i,{release:navigator.appVersion,platform:"web"},n)}};/*!
 * Microsoft Dynamic Proto Utility, 1.1.4
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */const Ih=class{constructor(t){this.sharedProperties={},Ih._instance=this,this.reporter=new $E(t.extension.id,t.extension.packageJSON.version,Ih.aiKey,!0)}static get instance(){return this._instance}dispose(){this.reporter.dispose()}sendEvent(t,e,r){this.reporter.sendTelemetryEvent(t,{...this.sharedProperties,...e},r)}sendErrorEvent(t,e,r){this.reporter.sendTelemetryErrorEvent(t,{...this.sharedProperties,...e},r)}sendException(t,e,r){this.reporter.sendTelemetryException(t,{...this.sharedProperties,...e},r)}setSharedProperty(t,e){this.sharedProperties[t]=e}};let _s=Ih;_s.aiKey="AIF-d9b70cd4-b9f9-4d70-929b-a071c400b217";function ME(t,e){d.env.appHost==="github.dev"&&d.env.isTelemetryEnabled&&(K.debug(`Executing ${t}`),e={...e,errorDetail:e.errorDetail instanceof Cn?e.errorDetail.status:void 0},d.commands.executeCommand(t,e).then(r=>{},r=>{K.debug(`Failed to execute ${t}`,r)}))}const Rl=(0,C.loadMessageBundle)();let li;var Dh;(function(t){function e(r){const n=UE(r);return li=d.env.uiKind===d.UIKind.Web,K.warn(`Running on the ${li?"web":"desktop"}${r.extensionRuntime!==d.ExtensionRuntime.Node?" in a webworker":""}; workspaceId=${n}; storageUri=${r.globalStorageUri.toString(!0)}`),n}t.configure=e})(Dh||(Dh={}));function BE(){var t,e;return(e=(t=d.workspace.workspaceFolders)==null?void 0:t.every(r=>r.uri.scheme===Pt.scheme))!=null?e:!1}var At;(function(t){t.CurrentWindow="currentWindow",t.NewWindow="newWindow",t.AddToWorkspace="addToWorkspace"})(At||(At={}));const OE=/\/workspaceStorage\/(?<id>[^/]+)/i;function UE(t){var e;if(t.storageUri===void 0)return"";const r=OE.exec(t.storageUri.path);let n;if((e=r==null?void 0:r.groups)==null?void 0:e.id)n=r.groups.id;else{n=t.storageUri.path;const i=qS(t.globalStorageUri.path,n),o=`/${t.extension.id}`;n.endsWith(o)?n=n.slice(i,-o.length):n=n.substr(i)}return/-[0-9]$/.test(n)?n.slice(0,-2):n}async function nn(t,e){var r,n,i,o,a;if(_s.instance.sendEvent("openWorkspace",{location:t.location}),t.location===At.AddToWorkspace){const c=(n=(r=d.workspace.workspaceFolders)==null?void 0:r.length)!=null?n:0;return void d.workspace.updateWorkspaceFolders(c,0,{uri:t.uri,name:t.name})}if(t.location===At.CurrentWindow&&!(e==null?void 0:e.skipChangesPrompt)){const c=await Ka.instance.getWorkspaceProvidersWithChanges();if(c.length){const l={title:Rl("continue","Continue")},u={title:Rl("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showWarningMessage(li?Rl("open folder uncommitted changes web",`You have uncommitted changes.

If you want to see your changes on {0} or from other browsers or machines, commit them before leaving this workspace. Otherwise, you can re-open this workspace anytime and pick up right where you left off.

Do you want to continue opening a new workspace?`,c.map(f=>f.name).join(", ")):Rl("open folder uncommitted changes",`You have uncommitted changes.

If you want to see your changes on {0} or from other machines, commit them before leaving this workspace. Otherwise, you can re-open this workspace anytime and pick up right where you left off.

Do you want to continue opening a new workspace?`,c.map(f=>f.name).join(", ")),{modal:!0,useCustom:!0},l,u)!==l){_s.instance.sendEvent("openWorkspace.abort",{reason:"abandoned uncommitted changes prompt"});return}}}const s=d.env.remoteName?!0:void 0;return t.filesToOpen&&(t.location===At.CurrentWindow&&s===void 0&&((i=d.workspace.workspaceFolders)==null?void 0:i.length)===1&&d.workspace.workspaceFolders[0].uri.toString()===t.uri.toString()?await((o=pu())==null?void 0:o.openPendingFiles(t.uri,t.filesToOpen)):await((a=pu())==null?void 0:a.setPendingFilesToOpen(t.uri,t.filesToOpen))),_s.instance.sendEvent("openWorkspace.success",{location:t.location,forceLocalWindow:String(s)}),void d.commands.executeCommand("vscode.openFolder",t.uri,{forceNewWindow:t.location===At.NewWindow,forceLocalWindow:s})}var Nn;(function(t){t.HasVirtualFolders="remoteHub:hasVirtualFolders",t.HasSearchIndexes="remoteHub:hasSearchIndexes",t.EnabledSomeSearchIndexes="remoteHub:enabledSomeSearchIndexes",t.EnabledAllSearchIndexes="remoteHub:enabledAllSearchIndexes",t.VirtualFolderProviders="remoteHub:virtualFolderProviders",t.HasPullRequestExtension="remoteHub:hasPullRequestExtension",t.HasWriteableScmProvider="remoteHub:hasWriteableScmProvider",t.HasRecentRepositories="remoteHub:hasRecentRepositories"})(Nn||(Nn={}));const Xv=new Map;function ua(t){return t==="isWeb"?li:t==="remoteName"?d.env.remoteName:t==="virtualWorkspace"?BE():t.startsWith("config.")?Ye.getAny(t.substr(7)):Xv.get(t)}function da(t){return t==="isWeb"||t==="remoteName"||t==="virtualWorkspace"||t.startsWith("config.")||t.startsWith("remoteHub:")||t.startsWith("continueOn:")}async function ui(t,e){Xv.set(t,e),!t.startsWith("continueOn:")&&await d.commands.executeCommand("setContext",t,e)}class LE{constructor(e){this.menuItem=e}get label(){return`${this.menuItem.icon?`${this.menuItem.icon} `:""}${this.menuItem.title}`}get description(){return this.menuItem.extension.builtin?"Built-in":this.menuItem.extension.name||this.menuItem.extension.id}async execute(e){return void await d.commands.executeCommand(this.menuItem.command,e)}}var Ph;(function(t){async function e(r,n,i){const o=HE(r).map(c=>new LE(c)),a=d.window.createQuickPick(),s=[];try{return await new Promise(l=>{s.push(a.onDidHide(()=>l(void 0)),a.onDidAccept(()=>{if(a.activeItems.length!==0){const[u]=a.activeItems;l(u)}})),a.title=i,a.placeholder=n,a.items=o,a.show()})}finally{a.dispose(),s.forEach(c=>void c.dispose())}}t.show=e})(Ph||(Ph={}));function HE(t){var e,r,n,i,o;const a=new Map,[,s]=t.split(".");for(const l of d.extensions.all){const{name:u,displayName:h,contributes:f}=l.packageJSON;if(!f)continue;const p=(r=(e=f.virtualWorkspaces)==null?void 0:e.menus)==null?void 0:r.continueOn;if(p==null?void 0:p.length){const b=new Map(((n=f.commands)!=null?n:[]).map(w=>[w.command,w]));for(const w of p){if(!w.command)continue;if(a.has(w.command)){K.warn(`Duplicate 'continueOn' menu command: ${w.command}`);continue}const y=b.get(w.command);if(!y){K.warn(`Unable to find 'continueOn' menu command: ${w.command}`);continue}if(!qE(w.when))continue;const x=(o=(i=w.group)==null?void 0:i.lastIndexOf("@"))!=null?o:-1;a.set(w.command,{extension:{id:u,name:h,builtin:u===s},command:y.command,title:y.title,icon:typeof y.icon=="string"?y.icon:void 0,group:x>0?w.group.substr(0,x):w.group,order:x>0?Number(w.group.substr(x+1)):0,category:y.category})}}}function c(l,u){const h=l.group,f=u.group;if(h!==f){if(!h)return 1;if(!f||h==="navigation")return-1;if(f==="navigation")return 1;const p=h.localeCompare(f);if(p!==0)return p}return l.order<u.order?-1:l.order>u.order?1:l.title.localeCompare(u.title)}return[...a.values()].sort(c)}function qE(t){return t?t.split("&&").every(e=>{const r=/^(?:(!)?(\S+)|(\S+)\s?(==|!=|=~)\s?(\S+))$/.exec(e.trim());if(!r)return!0;const[,n,i,o,a,s]=r;if(i){if(i==="false")return!1;if(!da(i))return!0;const c=ua(i);return n?!c:c}if(o&&a&&s)switch(a){case"==":return!da(o)||!da(s)||ua(o)==ua(s);case"!=":return!da(o)||!da(s)||ua(o)!=ua(s);case"=~":{if(!da(o))return!0;const c=ua(o);try{return new RegExp(s.slice(1,-1)).test(String(c!=null?c:""))}catch{return!1}}}return!0}):!0}class Fh{constructor(e){this.defaultDelay=e}dispose(){this.cancelTimeout()}debounce(e,r=this.defaultDelay){return this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((n,i)=>{this.resolver=n,this.rejecter=i}).then(()=>{if(this.completionPromise=void 0,this.resolver=void 0,this.task){const n=this.task;return this.task=void 0,n()}})),this.timeout=setTimeout(()=>{var n;this.timeout=void 0,(n=this.resolver)==null||n.call(this,void 0)},r),this.completionPromise}cancel(){var e;this.cancelTimeout(),this.completionPromise&&((e=this.rejecter)==null||e.call(this,new Error("Canceled")),this.completionPromise=void 0)}cancelTimeout(){this.timeout!==void 0&&(clearTimeout(this.timeout),this.timeout=void 0)}}const Di=(0,C.loadMessageBundle)(),Nh=Symbol("QuickPickGoBack");var $h;(function(t){async function e(r,n,i,o,a,s){const c=r.getRemoteWorkspaceSourceProviders();let l=[];c.length===0?l=[]:l=c.map(b=>new Qv(b));const u=await n.getRemoteWorkspaceSourceProvider();if(u){const b=await u.provideSources();l.push(...b.filter(w=>Ye.get("azureRepos.enabled")?!0:w.providerId===wr.GitHub).map(w=>({label:`${w.icon?`${w.icon} `:""}${w.name}`,description:w.description,detail:w.detail,url:w.url,workspace:w.url?void 0:w.workspace,buttons:[wn.OpenInNewWindow]})))}const h=d.window.createQuickPick();h.ignoreFocusOut=!0;const f=[];let p=i;try{for(;;){const b=await new Promise(w=>{f.push(h.onDidHide(()=>w(void 0)),h.onDidChangeValue(y=>{y=y.trim(),y.length===0?h.items=l:h.activeItems.length===0||h.activeItems[0]instanceof xs?h.items=[new xs(r,y),...l]:h.items=l}),h.onDidAccept(()=>{if(h.activeItems.length!==0){const[y]=h.activeItems;(!(y instanceof xs)||y.validate())&&w(y)}}),h.onDidChangeActive(()=>{if(p!==void 0||!(s==null?void 0:s.allowAddToWorkspace))return;const[y]=h.activeItems;let x=!0;if(y===void 0?x=Boolean(h.value):x=y instanceof xs,x){if(h.buttons.length===1)return;h.buttons=[wn.AddToWorkspace]}else{if(h.buttons.length===0)return;h.buttons=[]}}),h.onDidTriggerButton(y=>{if(y===wn.AddToWorkspace){const[x]=h.activeItems;if(!(x instanceof xs))return;x.validate()&&(p=At.AddToWorkspace,w(x))}}),h.onDidTriggerItemButton(y=>{switch(y.button){case wn.OpenInNewWindow:p=At.NewWindow,w(y.item);break;default:break}})),h.title=a,h.placeholder=o,h.matchOnDescription=!0,h.items=l,h.sortByLabel=!1,h.show()});if(b instanceof Qv){const w=await b.show(p,b.placeholder,a,s);if(w===Nh)continue;return w}return[b,p]}}finally{h.dispose(),f.forEach(b=>void b.dispose())}}t.show=e})($h||($h={}));class Qv{constructor(e){this.provider=e}get label(){return`${this.provider.icon?`${this.provider.icon} `:""}${this.provider.label}`}get placeholder(){return this.provider.placeholder}async show(e,r,n,i){const o=d.window.createQuickPick(),a=new Fh(500),s=[a];async function c(b,w,y){return(await b.provideSources(w,y)).map(S=>({label:`${S.icon?`${S.icon} `:""}${S.name}`,description:S.description,detail:S.detail,url:S.url,workspace:S.workspace,buttons:[wn.OpenInNewWindow]}))}const l=c(this.provider,void 0,{sort:"updated"});let u=e,h,f=!1;async function p(b){h=void 0;const w=o.activeItems;o.items=b!=null?b:await l,f&&w.length!==0&&(o.activeItems=o.items.filter(y=>w.some(x=>x.url===y.url))),o.busy=!1}try{const b=await new Promise(w=>{s.push(o.onDidHide(()=>w(void 0)),o.onDidChangeValue(y=>{f=!1,y=y.trim(),o.busy=!0;const x=a.debounce(y?()=>c(this.provider,y,{sort:"stars"}):()=>l);h===void 0&&(h=x.then(async S=>p(S)))}),o.onDidAccept(()=>{if(o.activeItems.length!==0){const[y]=o.activeItems;w(y)}}),o.onDidChangeActive(()=>{if(f=o.activeItems.length!==0,u!==void 0||!(i==null?void 0:i.allowAddToWorkspace))return;const[y]=o.activeItems;if(y===void 0){if(o.buttons.length===1)return;o.buttons=[d.QuickInputButtons.Back]}else{if(o.buttons.length===2)return;o.buttons=[d.QuickInputButtons.Back,wn.AddToWorkspace]}}),o.onDidTriggerButton(y=>{if(y===d.QuickInputButtons.Back){w(Nh);return}if(y===wn.AddToWorkspace){const[x]=o.activeItems;if(x===void 0)return;u=At.AddToWorkspace,w(x)}}),o.onDidTriggerItemButton(y=>{switch(y.button){case wn.OpenInNewWindow:u=At.NewWindow,w(y.item);break;default:break}})),o.title=n,o.placeholder=r,o.matchOnDetail=!0,o.ignoreFocusOut=!0,o.sortByLabel=!1,o.buttons=[d.QuickInputButtons.Back],o.busy=!0,o.show(),h=a.debounce(async()=>l,0).then(y=>p(y))});return b===Nh?b:[b,u]}finally{o.dispose(),s.forEach(b=>void b.dispose())}}}class xs{constructor(e,r){this.url=r,this.alwaysShow=!0,this.canOpenResult=e.canOpenRemoteUrl(r)}get buttons(){return[wn.OpenInNewWindow]}get label(){if(this.canOpenResult){const{provider:e,urlType:r}=this.canOpenResult;switch(r){case Vr.Branch:return Di("remote url picker open branch","Open Branch from {0} Repository",e.name);case Vr.Commit:return Di("remote url picker open commit","Open Commit from {0} Repository",e.name);case Vr.File:return Di("remote url picker open file","Open File from {0} Repository",e.name);case Vr.PullRequest:return Di("remote url picker open pull request","Open Pull Request from {0} Repository",e.name);default:return Di("remote url picker open repository","Open {0} Repository",e.name)}}return Di("remote url picker open unknown","Enter a Remote Url")}get description(){return this.url}validate(){return this.canOpenResult!==void 0}}var wn;(function(t){t.AddToWorkspace={iconPath:new d.ThemeIcon("plus"),tooltip:Di("remote url picker button add to workspace","Add to Workspace")},t.OpenInNewWindow={iconPath:new d.ThemeIcon("empty-window"),tooltip:Di("remote picker open in new window","Open in New Window")}})(wn||(wn={}));var WE=Object.defineProperty,zE=Object.getOwnPropertyDescriptor,di=(t,e,r,n)=>{for(var i=n>1?void 0:n?zE(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&WE(e,r,i),i};const Jt=(0,C.loadMessageBundle)();class $n{showGitHubStatus500Message(){return d.window.showErrorMessage(Jt("github 500 error notification","GitHub failed to respond and might be experiencing issues. Visit the [GitHub status page](https://githubstatus.com) for more information."),Jt("ok","OK")),Promise.resolve()}async showStatus401Message(e){if(!e)return void d.window.showErrorMessage(Jt("401 error notification","The provided credentials are either invalid or expired."),Jt("ok","OK"));const r=Jt("401 error notification confirm","Reauthenticate");await d.window.showErrorMessage(Jt("401 error notification with reauth","The provided credentials are either invalid or expired. Would you like to reauthenticate?"),r)===r&&e()}async showStatus403Message(e){if(!e)return void d.window.showErrorMessage(Jt("403 error notification","The provided credentials do not have the required access."),Jt("ok","OK"));const r=Jt("403 error notification confirm","Reauthenticate");await d.window.showErrorMessage(Jt("403 error notification with reauth","The provided credentials do not have the required access. Would you like to reauthenticate to grant additional access?"),r)===r&&e()}async showRepositoryEmptyMessage(e){const r=Jt("repository empty open","Open Repository");await d.window.showErrorMessage(Jt("repository empty","Repository '{0}' is empty and cannot be opened. Would you like to open another repository?",e),r)===r&&d.commands.executeCommand("remoteHub.openRepository")}async showPullRequestNotFoundMessage(e,r){const n=Jt("pull request not found open","Open Pull Request");await d.window.showErrorMessage(Jt("pull request not found","Unable to find pull request {1} on repository '{0}'. Would you like to open another pull request?",e,r),n)===n&&d.commands.executeCommand("remoteHub.openRepository")}async showPullRequestHeadNotFoundMessage(e,r){const n=Jt("pull request head not found ok","OK");await d.window.showWarningMessage(Jt("pull request head not found","Unable to find the source branch for pull request {1} on repository '{0}'.",e,r),n)}async showRepositoryForbiddenMessage(e){const r=Jt("repository forbidden open","Open Repository");await d.window.showErrorMessage(Jt("repository forbidden","You don't have access to repository '{0}'. Would you like to open another repository?",e),r)===r&&d.commands.executeCommand("remoteHub.openRepository")}async showRepositoryNotFoundMessage(e){const r=Jt("repository not found confirm","Open Repository");await d.window.showErrorMessage(Jt("repository not found","Unable to find repository '{0}'. Would you like to open another repository?",e),r)===r&&d.commands.executeCommand("remoteHub.openRepository")}async showUnableToOpenRepositoryMessage(e){const r=Jt("unable to open repo confirm","Open Repository");await d.window.showErrorMessage(Jt("unable to open repo","Unable to open repository. {0}. Would you like to open another repository?",String(e)),r)===r&&d.commands.executeCommand("remoteHub.openRepository")}}di([yr(()=>"")],$n.prototype,"showGitHubStatus500Message",1),di([yr(()=>"")],$n.prototype,"showStatus401Message",1),di([yr(()=>"")],$n.prototype,"showStatus403Message",1),di([yr()],$n.prototype,"showRepositoryEmptyMessage",1),di([yr()],$n.prototype,"showPullRequestNotFoundMessage",1),di([yr()],$n.prototype,"showPullRequestHeadNotFoundMessage",1),di([yr()],$n.prototype,"showRepositoryForbiddenMessage",1),di([yr()],$n.prototype,"showRepositoryNotFoundMessage",1),di([yr()],$n.prototype,"showUnableToOpenRepositoryMessage",1);const kr=new $n,ur=(0,C.loadMessageBundle)();function jE(t,e,r,n,i){async function o(s){const[c,l]=await $h.show(t,r,s,ur("open repo placeholder","Enter a remote url, or select a remote provider"),s===At.AddToWorkspace?ur("open repo title add to workspace","Add Remote Repository to Workspace"):ur("open repo title current window","Open Remote Repository"),{allowAddToWorkspace:!1});if(!c){i.sendEvent("openRepository.abort",{reason:"abandoned"});return}try{let u;if(c.workspace)u=c.workspace,u.location=l!=null?l:u.location;else if(u=await t.createWorkspaceForRemoteUrl(c.url,void 0,l!=null?l:s),!u){i.sendEvent("openRepository.abort",{reason:"aborted invalid url"});return}await nn(u)}catch(u){if(i.sendException(u),u instanceof _n){const{reauthenticate:h}=u;kr.showStatus401Message(()=>h());return}if(u instanceof Ua){kr.showRepositoryNotFoundMessage(u.name);return}if(u instanceof Oa){kr.showRepositoryForbiddenMessage(u.name);return}if(u instanceof vc){kr.showRepositoryEmptyMessage(u.name);return}if(u instanceof mc){kr.showPullRequestNotFoundMessage(u.name,u.id);return}K.error(u)}}async function a(s,c,l){if(l==null?void 0:l.workspaceFolder){const h=t.getRepository(l.workspaceFolder,c);if(h!==void 0)return h}const u=c?t.repositories.filter(h=>h.provider.id===c):t.repositories;if(u.length!==0){if(u.length>1){const h=await d.window.showQuickPick(u.map(f=>({label:f.name,description:f.provider.name,repository:f})),{placeHolder:s});return h?h.repository:void 0}return u[0]}}return[d.commands.registerCommand("remoteHub.openRepository",()=>(i.sendEvent("command.openRepository"),o())),d.commands.registerCommand("remoteHub.continueOn.openRepository",()=>(i.sendEvent("command.continueOn.openRepository"),o())),d.commands.registerCommand("remoteHub.addRepositoryToWorkspace",()=>{i.sendEvent("command.continueOn.openRepository")}),d.commands.registerCommand("remoteHub.continueOn.addRepositoryToWorkspace",()=>{i.sendEvent("command.continueOn.openRepository")}),d.commands.registerCommand("remoteHub.continueOn",async()=>{const s=await a(ur("continue on choose repository placeholder","Choose which repository to continue working on elsewhere"));if(s===void 0)return;i.sendEvent("command.continueOn");const c=await Ph.show(n,ur("continue on placeholder","Choose how you would like to continue working"),ur("continue on title","Continue '{0}' on",s.name));if(!c){i.sendEvent("command.continueOn.abort",{reason:"abandoned"});return}if(await e.hasChanges(s.uri)){const h={title:ur("continue","Continue")},f={title:ur("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showWarningMessage(ur("continue on uncommitted changes",`You have uncommitted changes.

Unless you commit those changes, you won't be able see them from elsewhere.`),{modal:!0,useCustom:!0},h,f)!==h){i.sendEvent("command.continueOn.abort",{reason:"abandoned uncommitted changes prompt"});return}}const l=t.getRemoteUri(s.provider.id,{repo:s.id}),{HEAD:u}=await s.getMetadata();await c.execute({provider:s.provider,workspaceFolder:s.uri,name:s.name,url:l==null?void 0:l.toString(!0),ref:u.name})}),d.commands.registerCommand("remoteHub.openOnDesktop",async s=>{if(!li)return;const c=await a(ur("continue on desktop choose repository placeholder","Choose which repository to open on the desktop"),void 0,s);if(c===void 0)return;const l=await t.getBestRemoteUri(c.uri);l!==void 0&&(i.sendEvent("command.openOnDesktop"),d.env.openExternal(d.Uri.parse(`${d.env.uriScheme}://${n}/open?url=${encodeURIComponent(l.toString(!0))}`)))}),d.commands.registerCommand("remoteHub.openOnWeb",async s=>{if(li)return;const c=await a(ur("continue on web choose repository placeholder","Choose which repository to open on the web"),void 0,s);if(c===void 0)return;const l=await t.getBestRemoteUri(c.uri);l!==void 0&&(i.sendEvent("command.openOnWeb"),d.env.openExternal(l))}),d.commands.registerCommand("remoteHub.goToRepository",async()=>{i.sendEvent("command.goToRepository");const s=await a(ur("open on remote choose repository placeholder","Choose which repository to open on the remote"));if(!s)return;const c={provider:s.provider,repo:s.id};return d.commands.executeCommand("remoteHub.openOnRemote",c)}),d.commands.registerCommand("remoteHub.openOnRemote",async s=>{i.sendEvent("command.openOnRemote");const{provider:c,...l}=s,u=t.getRemoteUri(c.id,l);if(u){await d.env.openExternal(u);return}d.window.showErrorMessage(ur("open on remote command provider not supported","Unable to open the resource on {0}",s.provider.name))}),d.commands.registerCommand("remoteHub.clone",async s=>{const c=await a(ur("clone placeholder","Choose which repository to clone"),void 0,s);if(c!==void 0){if(i.sendEvent("command.clone"),s===void 0&&await e.hasChanges(c.uri)){const l={title:ur("continue","Continue")},u={title:ur("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showWarningMessage(ur("clone uncommitted changes",`You have uncommitted changes.

Unless you commit those changes, you won't be able see them in your local clone.`),{modal:!0,useCustom:!0},l,u)!==l){i.sendEvent("command.clone.abort",{reason:"abandoned uncommitted changes prompt"});return}}await t.clone(c.uri)}}),d.commands.registerCommand("remoteHub.refresh",()=>void t.refresh()),d.commands.registerCommand("remoteHub.enableDebugLogging",()=>Ye.updateEffective("logLevel",Rt.Debug)),d.commands.registerCommand("remoteHub.disableDebugLogging",()=>Ye.updateEffective("logLevel",Rt.Warn)),d.commands.registerCommand("remoteHub.exportDebugInfo",async()=>{await r.exportDebugInfo(),await e.exportDebugInfo()}),d.commands.registerCommand("remoteHub.setContext",async(s,c)=>{if(!s.startsWith("continueOn:"))throw new Error("Key must start with 'continueOn:'");await ui(s,c)}),d.commands.registerCommand("remoteHub.notebook.continueOn",async()=>{const s={title:ur("continue on","Continue Working On...")};await d.window.showInformationMessage(ur("notebook continue on","Running notebook cells is not available in the web editor. To run this cell, you will need to continue in an environment that can run code, like a codespace or local VS Code."),{modal:!0},s)===s&&await d.commands.executeCommand("remoteHub.continueOn")})]}function yn(t){return t}async function Mh(t,e){return d.commands.executeCommand(t,e)}class VE{constructor(){this._timeout=0,this._disposable=Ye.onDidChange(this.onConfigurationChanged,this),this.maybeQueueFetch()}dispose(){this._disposable.dispose(),this._timeout&&clearTimeout(this._timeout)}get config(){var e;if(this._config===void 0){const r=Ye.get("autoFetch");this._config={enabled:(e=r.enabled)!=null?e:!0,interval:r.interval*1e3}}return this._config}onConfigurationChanged(e){!Ye.changed(e,"autoFetch")||(this._config=void 0,this.maybeQueueFetch())}async fetchAll(){try{await Mh("remoteHub.fetchAll",{automated:!0})}catch(e){K.error(e,"Autofetch failed")}this.maybeQueueFetch()}maybeQueueFetch(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),!!this.config.enabled&&(this._timeout=setTimeout(()=>this.fetchAll(),this.config.interval))}}var GE=__webpack_require__(8764),Tl,KE=new Uint8Array(16);function ZE(){if(!Tl&&(Tl=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Tl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tl(KE)}const XE=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function QE(t){return typeof t=="string"&&XE.test(t)}const YE=QE;for(var _r=[],Bh=0;Bh<256;++Bh)_r.push((Bh+256).toString(16).substr(1));function JE(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(_r[t[e+0]]+_r[t[e+1]]+_r[t[e+2]]+_r[t[e+3]]+"-"+_r[t[e+4]]+_r[t[e+5]]+"-"+_r[t[e+6]]+_r[t[e+7]]+"-"+_r[t[e+8]]+_r[t[e+9]]+"-"+_r[t[e+10]]+_r[t[e+11]]+_r[t[e+12]]+_r[t[e+13]]+_r[t[e+14]]+_r[t[e+15]]).toLowerCase();if(!YE(r))throw TypeError("Stringified UUID is invalid");return r}const eR=JE;function tR(t,e,r){t=t||{};var n=t.random||(t.rng||ZE)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return eR(n)}const rR=tR,on=globalThis.fetch;var nR="/";const iR=C.loadMessageBundle(__webpack_require__(6470).join(nR,"azure-devops\\azdoAuthHelper.ts")),oR="https://app.vssps.visualstudio.com/oauth2",Yv="https://prod.richnav.vsengsaas.visualstudio.com/api/v0.1/azDOAuth",aR="1BACBD12-21C6-46ED-899C-1FC50517FBAA",Ss=["vso.code"];function sR(t){return(t.query.includes("&")?t.query:decodeURIComponent(t.query)).split("&").reduce((r,n)=>{const i=n.split("=");return r[i[0]]=i[1],r},{})}const Pi=new d.EventEmitter,Jv=new d.EventEmitter,Al="Network failure",Cs="AzDO";class cR{constructor(e){this._tokens=[],this._refreshTimeouts=new Map,this._disposables=[],this._pendingStates=new Map,this._codeExchangePromises=new Map,this.secretStorage=e.secrets,this.extensionId=e.extension.id}async initialize(){const e=await this.secretStorage.get(Cs);if(e)try{const n=this.parseStoredData(e).map(async i=>{var o;if(!i.refreshToken)return Promise.resolve();try{await this.refreshToken(i.refreshToken,i.scope,i.id)}catch(a){a.message===Al?await this.handleRefreshNetworkError(i.id,i.refreshToken,i.scope)||(this._tokens.push({accessToken:void 0,refreshToken:i.refreshToken,account:{label:(o=i.account.label)!=null?o:i.account.displayName,id:i.account.id},scope:i.scope,sessionId:i.id}),this.pollForReconnect(i.id,i.refreshToken,i.scope)):await this.removeSession(i.id)}});await Promise.all(n)}catch(r){K.log("Failed to initialize stored data"),await this.clearSessions()}this._disposables.push(this.secretStorage.onDidChange(()=>this.checkForUpdates))}parseStoredData(e){return JSON.parse(e)}async storeTokenData(){const e=this._tokens.map(r=>({id:r.sessionId,refreshToken:r.refreshToken,scope:r.scope,account:r.account}));await this.secretStorage.store(Cs,JSON.stringify(e))}async checkForUpdates(){const e=[];let r=[];const n=await this.secretStorage.get(Cs);if(n)try{const i=this.parseStoredData(n);let o=i.map(async a=>{if(!this._tokens.some(c=>c.scope===a.scope&&c.sessionId===a.id)&&a.refreshToken)try{const c=await this.refreshToken(a.refreshToken,a.scope,a.id);e.push(this.convertToSessionSync(c))}catch(c){c.message===Al||await this.removeSession(a.id)}});o=o.concat(this._tokens.map(async a=>{i.some(c=>a.scope===c.scope&&a.sessionId===c.id)||(await this.removeSession(a.sessionId),r.push(this.convertToSessionSync(a)))})),await Promise.all(o)}catch(i){K.error(i),r=this._tokens.map(this.convertToSessionSync),this.clearSessions()}else this._tokens.length&&(r=this._tokens.map(this.convertToSessionSync),K.log("No stored keychain data, clearing local data"),this._tokens=[],this._refreshTimeouts.forEach(i=>{clearTimeout(i)}),this._refreshTimeouts.clear());(e.length||r.length)&&Pi.fire({added:e,removed:r,changed:[]})}convertToSessionSync(e){return{id:e.sessionId,accessToken:e.accessToken,account:e.account,scopes:e.scope.split(" ")}}async convertToSession(e){const r=await this.resolveAccessToken(e);return{id:e.sessionId,accessToken:r,account:e.account,scopes:e.scope.split(" ")}}async resolveAccessToken(e){if(e.accessToken&&(!e.expiresAt||e.expiresAt>Date.now()))return e.expiresAt?K.log(`Token available from cache, expires in ${e.expiresAt-Date.now()} milliseconds`):K.log("Token available from cache"),Promise.resolve(e.accessToken);try{K.log("Token expired or unavailable, trying refresh");const r=await this.refreshToken(e.refreshToken,e.scope,e.sessionId);if(r.accessToken)return r.accessToken;throw new Error("No access token returned.")}catch(r){throw new Error("Unavailable due to network problems")}}getTokenClaims(e){try{return JSON.parse(GE.Buffer.from(e.split(".")[1],"base64").toString())}catch(r){throw K.error(r),new Error("Unable to read token claims")}}get sessions(){return Promise.all(this._tokens.map(e=>this.convertToSession(e)))}async getSessions(e){if(!e)return this.sessions;const r=e.sort().join(" "),n=this._tokens.filter(i=>i.scope===r);return Promise.all(n.map(i=>this.convertToSession(i)))}createSession(e){return K.log("Logging in..."),this.loginWithoutLocalServer(e)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}isTestEnvironment(e){return/\.azurewebsites\.net$/.test(e.authority)||e.authority.startsWith("localhost:")}async loginWithoutLocalServer(e){var r;const n=await d.env.asExternalUri(d.Uri.parse(`${d.env.uriScheme}://${this.extensionId}/login`));if(this.isTestEnvironment(n)){const l=await d.window.showInputBox({prompt:'Azure Repos Personal Access Token (you must have "vso.code" in your scopes)',ignoreFocusOut:!0});if(!l)throw new Error("Sign in failed: No token provided");return{id:"test",accessToken:l,scopes:Ss,account:{id:"test",label:"Test Account"}}}const i=n.toString(),o=d.Uri.parse(`${oR}/authorize?client_id=${aR}&response_type=Assertion&state=${encodeURIComponent(i)}&scope=${encodeURIComponent(Ss.join(" "))}&redirect_uri=${encodeURIComponent(Yv)}`),a=new Promise((l,u)=>{const h=setTimeout(()=>{clearTimeout(h),u("Login timed out.")},1e3*60*5)}),s=(r=this._pendingStates.get(e))!=null?r:[];this._pendingStates.set(e,[...s,i]);let c=this._codeExchangePromises.get(e);return c||(c=this.handleCodeResponse(e),this._codeExchangePromises.set(e,c)),d.env.openExternal(o),Promise.race([c,a]).finally(()=>{this._pendingStates.delete(e),this._codeExchangePromises.delete(e)})}async handleCodeResponse(e){let r;return new Promise((n,i)=>{r=Jv.event(async o=>{try{K.log(`Received Uri: ${o.toString()}`);const a=sR(o);if(!a.accessInfo)throw new Error(`No access info found in query: ${JSON.stringify(a)}`);const s=JSON.parse(a.accessInfo),c=await this.getTokenFromResponse(s,e);this.setToken(c,e);const l=await this.convertToSession(c);n(l)}catch(a){K.error(a),i(a)}})}).then(n=>(r.dispose(),n)).catch(n=>{throw r.dispose(),n})}setToken(e,r){const n=this._tokens.findIndex(i=>i.sessionId===e.sessionId);return n>-1?this._tokens.splice(n,1,e):this._tokens.push(e),this.clearSessionTimeout(e.sessionId),e.expiresIn&&this._refreshTimeouts.set(e.sessionId,setTimeout(async()=>{try{const i=await this.refreshToken(e.refreshToken,r,e.sessionId);Pi.fire({added:[],removed:[],changed:[this.convertToSessionSync(i)]})}catch(i){i.message===Al?await this.handleRefreshNetworkError(e.sessionId,e.refreshToken,r)||this.pollForReconnect(e.sessionId,e.refreshToken,e.scope):(await this.removeSession(e.sessionId),Pi.fire({added:[],removed:[this.convertToSessionSync(e)],changed:[]}))}},1e3*(e.expiresIn-30))),this.storeTokenData()}async getTokenFromResponse(e,r,n){var i;const o=this.getTokenClaims(e.accessToken),a=await on("https://app.vssps.visualstudio.com/_apis/profile/profiles/me?api-version=6.0",{headers:{Authorization:`Bearer ${e.accessToken}`,"Content-Type":"application/json"}});let s;if(a.ok)s=(await a.json()).displayName;else{const c=await a.text();K.error(c),s="User"}return{expiresIn:e.expiresIn,expiresAt:e.expiresIn?Date.now()+e.expiresIn*1e3:void 0,accessToken:e.accessToken,refreshToken:e.refreshToken,scope:r,sessionId:n!=null?n:`${o.nameid}/${rR()}`,account:{label:s,id:`${o.nameid}/${(i=o.aui)!=null?i:""}`}}}async refreshToken(e,r,n){K.log("Refreshing token...");let i;try{const o=`${Yv}/refresh?refreshToken=${e}&isFromRemoteHub=true`;i=await on(o)}catch(o){throw K.error("Refreshing token failed"),new Error(Al)}try{if(i.ok){const o=await i.json(),a=await this.getTokenFromResponse({accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token},r,n);return this.setToken(a,r),K.log("Token refresh success"),a}throw new Error("Bad request.")}catch(o){throw await d.window.showErrorMessage(iR(0,null)),K.error(`Refreshing token failed: ${i.statusText}`),new Error("Refreshing token failed")}}clearSessionTimeout(e){const r=this._refreshTimeouts.get(e);r&&(clearTimeout(r),this._refreshTimeouts.delete(e))}removeInMemorySessionData(e){const r=this._tokens.findIndex(i=>i.sessionId===e);let n;return r>-1&&(n=this._tokens[r],this._tokens.splice(r,1)),this.clearSessionTimeout(e),n}pollForReconnect(e,r,n){this.clearSessionTimeout(e),this._refreshTimeouts.set(e,setTimeout(async()=>{try{const i=await this.refreshToken(r,n,e);Pi.fire({added:[],removed:[],changed:[this.convertToSessionSync(i)]})}catch(i){this.pollForReconnect(e,r,n)}},1e3*60*30))}handleRefreshNetworkError(e,r,n,i=1){return new Promise((o,a)=>{if(i===3)return K.error("Token refresh failed after 3 attempts"),o(!1);const s=5*i*i;this.clearSessionTimeout(e),this._refreshTimeouts.set(e,setTimeout(async()=>{try{const c=await this.refreshToken(r,n,e);return Pi.fire({added:[],removed:[],changed:[this.convertToSessionSync(c)]}),o(!0)}catch(c){return o(await this.handleRefreshNetworkError(e,r,n,i+1))}},1e3*s))})}async removeSession(e){K.log(`Logging out of session '${e}'`);const r=this.removeInMemorySessionData(e);let n;return r&&(n=this.convertToSessionSync(r)),this._tokens.length===0?await this.secretStorage.delete(Cs):this.storeTokenData(),n}async clearSessions(){K.log("Logging out of all sessions"),this._tokens=[],await this.secretStorage.delete(Cs),this._refreshTimeouts.forEach(e=>{clearTimeout(e)}),this._refreshTimeouts.clear()}}const e0=class{constructor(t){this.onDidChangeSessions=Pi.event,this.loginService=new cR(t),this.initializePromise=this.loginService.initialize(),this.disposable=d.authentication.registerAuthenticationProvider(e0.id,"Azure Repos",this)}dispose(){this.disposable.dispose()}async getSessions(t){return await this.initializePromise,this.loginService.getSessions(t)}async createSession(t){await this.initializePromise;const e=await this.loginService.createSession(t.sort().join(" "));return Pi.fire({added:[e],removed:[],changed:[]}),e}async removeSession(t){await this.initializePromise;const e=await this.loginService.removeSession(t);e&&Pi.fire({added:[],removed:[e],changed:[]})}};let go=e0;go.id="azurerepos";var ha=__webpack_require__(7360),Oh=__webpack_require__(850);function Uh(t,e,r){if(!(e==null?void 0:e.length)&&!(r==null?void 0:r.length))return new Set(t);let n;if(e==null?void 0:e.length){const i=new Set([...e,...e.map(a=>`${a}/**`)]),o=Oh(t,[...i],{dot:!0,nocase:!0});n=new Set(o)}if(r==null?void 0:r.length){const i=new Set([...r,...r.map(o=>`${o}/**`)]);if(n===void 0){const o=Oh.not(t,[...i],{dot:!0,nocase:!0});n=new Set(o)}else Oh(t,[...i],{dot:!0,nocase:!0}).forEach(n.delete,n)}return n}var lR=Object.defineProperty,uR=Object.getOwnPropertyDescriptor,Lh=(t,e,r,n)=>{for(var i=n>1?void 0:n?uR(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&lR(e,r,i),i};const dR=(0,C.loadMessageBundle)(),hR=d.FileSystemError.FileNotFound().code,fR=/(\/|\\)/g;class kl{constructor(e,r,n){this.providerService=e,this.azdo=r,this.changeStore=n,this._onDidChangeFile=new d.EventEmitter,this.contentCache=new Map,this.fileSearchCache=new Map,this.pendingUriRequests=new Map,this.pendingUriRequestsEventDelay=10,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.pathTypeMap={},this.disposable=d.Disposable.from(d.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0,isReadonly:!0}),d.workspace.registerFileSearchProvider(this.scheme,this),d.workspace.registerTextSearchProvider(this.scheme,this),d.workspace.onDidCloseTextDocument(i=>this.onTextDocumentClosed(i.uri)),e.onDidChangeRepository(i=>{i.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([i.repository.uri])}),e.onDidRefresh(i=>this.onRefreshOrRepositoryChanged(i)))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return this.azdo.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){if(e=e.filter(r=>Pt.getProviderId(r)===this.scheme).map(r=>this.providerService.getProviderUri(r)),e.length!==0){K.log(`AzDOFS.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.fileSearchCache.clear();for(const[r,n]of[...this.pendingUriRequests])e.some(i=>Kn(n.uri,i))&&(this.pendingUriRequests.delete(r),n.outdated=!0);for(const[r,{uri:n}]of[...this.contentCache])e.some(i=>Kn(n,i))&&this.contentCache.delete(r);this.updateOpenOrWatchedUris(e)}}onTextDocumentClosed(e){e.scheme===this.scheme&&this.contentCache.delete(we(e))}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,o]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(a=>Kn(o,a))&&(this.implicitlyWatchedUris.delete(i),r.set(i,o));K.debug(`AzDOFS.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(we(i),i);const n=[...r.values()].map(i=>({type:d.FileChangeType.Changed,uri:i}));setTimeout(()=>{K.debug(`AzDOFS.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=we(e);return this.watchedUris.set(n,e),{dispose:()=>{this.watchedUris.delete(n)}}}async stat(e){const r=we(e);this.implicitlyWatchedUris.set(r,e);const n={uri:e,outdated:!1};try{this.pendingUriRequests.set(`stat:${r}`,n);const i=await this.providerService.getMetadata(e),o=d.FilePermission.Readonly;if(!i.path)return{type:d.FileType.Directory,mtime:0,ctime:0,size:0,permissions:o};if(i.path in this.pathTypeMap||await this.updateWorkspaceItemMap(i,e.path,!0),i.path in this.pathTypeMap)return this.pathTypeMap[i.path]===d.FileType.Directory?{type:d.FileType.Directory,mtime:0,ctime:0,size:0,permissions:o}:{type:d.FileType.File,mtime:0,ctime:0,size:0,permissions:o};if(this.implicitlyWatchedUris.delete(r),e.query!=="~")throw d.FileSystemError.FileNotFound(e);return{type:d.FileType.File,size:0,ctime:0,mtime:Date.now(),permissions:d.FilePermission.Readonly}}finally{this.pendingUriRequests.delete(`stat:${r}`),(n==null?void 0:n.outdated)&&setTimeout(()=>{K.log(`AzDOFS.stat(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:d.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}async updateWorkspaceItemMap(e,r,n){const i=new Array,o=await this.azdo.getRepoItems(e,r,{recursionLevel:"OneLevel"});for(const a of o){const s=a.path.substring(1);if(s!==e.path||n){const c=a.isFolder===!0?d.FileType.Directory:d.FileType.File;this.pathTypeMap[s]=c,i.push([s,c])}}return i}async readDirectory(e){this.implicitlyWatchedUris.set(we(e),e);const r=this.providerService.getVirtualRootUri(e),n=await this.providerService.getMetadata(e);return(await this.updateWorkspaceItemMap(n,e.path,!1)).map(o=>[this.providerService.getRelativeFilePath(e,Ma(r,o[0])),o[1]])}createDirectory(e){throw d.FileSystemError.NoPermissions()}async readFile(e){var r;const n=we(e);this.implicitlyWatchedUris.set(n,e);let i=this.contentCache.get(n);if(i!==void 0)return i.content;const o={uri:e,outdated:!1};try{return this.pendingUriRequests.set(n,o),i={content:this.azdo.getFileContent(e),uri:e},this.contentCache.set(n,i),await i.content}catch(a){if(this.implicitlyWatchedUris.delete(n),i!==void 0&&i.content===((r=this.contentCache.get(n))==null?void 0:r.content)&&this.contentCache.delete(n),e.query==="~"&&a instanceof d.FileSystemError&&a.code===hR)return new Uint8Array(0);throw a}finally{this.pendingUriRequests.delete(n),(o==null?void 0:o.outdated)&&setTimeout(()=>{K.log(`AzDOFS.readFile(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:d.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}writeFile(e,r,n){throw d.FileSystemError.NoPermissions()}delete(e,r){throw d.FileSystemError.NoPermissions()}rename(e,r,n){throw d.FileSystemError.NoPermissions()}copy(e,r,n){throw d.FileSystemError.NoPermissions()}async provideFileSearchResults(e,{folder:r,maxResults:n,includes:i,excludes:o},a){const s=`${we(r)}|${JSON.stringify({includes:i,excludes:o})}`;let c=this.fileSearchCache.get(s);if(c===void 0){const u=await this.providerService.getMetadata(r),h=await this.azdo.getRepoItems(u,"",{recursionLevel:"Full"});let f=[];for(const p of h)p.isFolder||f.push(p.path);if(f.length===0||a.isCancellationRequested)return[];((i==null?void 0:i.length)||(o==null?void 0:o.length))&&(f=[...Uh(f,i,o)]),c=f.map(p=>ha.prepareSlow(p)),this.fileSearchCache.set(s,c)}let l;return e.pattern===""?l=c.map(u=>d.Uri.joinPath(r,u.target)):(l=ha.go(e.pattern.replace(fR,"/"),c,{allowTypo:!0,limit:n}).map(u=>d.Uri.joinPath(r,u.target)),ha.cleanup()),n!==void 0&&n!==0&&n<l.length&&(l=l.slice(0,n)),l}async provideTextSearchResults(e,r,n,i){const o=[];(e.isCaseSensitive||e.isRegExp||e.isWordMatch)&&o.push({text:dR("azdo flags not supported","Search flags are not supported."),type:d.TextSearchCompleteMessageType.Warning});const a=await this.azdo.searchCodeQuery(e.pattern,r.folder,{maxResults:r.maxResults,context:{before:r.beforeContext,after:r.afterContext}});if(a.warnings&&a.warnings.forEach(c=>{o.push({text:c,type:d.TextSearchCompleteMessageType.Warning})}),a===void 0)return{limitHit:!0,message:o};let s;for(const c of a.matches)s=d.Uri.joinPath(r.folder,c.path),n.report({uri:s,ranges:c.ranges,preview:{text:c.preview,matches:c.matches}});return{limitHit:!1,message:o}}}Lh([xn()],kl.prototype,"stat",1),Lh([xn()],kl.prototype,"readDirectory",1),Lh([xn()],kl.prototype,"readFile",1);var t0;(function(t){t[t.Force=0]="Force",t[t.ForceWithLease=1]="ForceWithLease"})(t0||(t0={}));var Mn;(function(t){t[t.Head=0]="Head",t[t.RemoteHead=1]="RemoteHead",t[t.Tag=2]="Tag"})(Mn||(Mn={}));var Es;(function(t){t[t.INDEX_MODIFIED=0]="INDEX_MODIFIED",t[t.INDEX_ADDED=1]="INDEX_ADDED",t[t.INDEX_DELETED=2]="INDEX_DELETED",t[t.INDEX_RENAMED=3]="INDEX_RENAMED",t[t.INDEX_COPIED=4]="INDEX_COPIED",t[t.MODIFIED=5]="MODIFIED",t[t.DELETED=6]="DELETED",t[t.UNTRACKED=7]="UNTRACKED",t[t.IGNORED=8]="IGNORED",t[t.INTENT_TO_ADD=9]="INTENT_TO_ADD",t[t.ADDED_BY_US=10]="ADDED_BY_US",t[t.ADDED_BY_THEM=11]="ADDED_BY_THEM",t[t.DELETED_BY_US=12]="DELETED_BY_US",t[t.DELETED_BY_THEM=13]="DELETED_BY_THEM",t[t.BOTH_ADDED=14]="BOTH_ADDED",t[t.BOTH_DELETED=15]="BOTH_DELETED",t[t.BOTH_MODIFIED=16]="BOTH_MODIFIED"})(Es||(Es={}));var r0;(function(t){t.BadConfigFile="BadConfigFile",t.AuthenticationFailed="AuthenticationFailed",t.NoUserNameConfigured="NoUserNameConfigured",t.NoUserEmailConfigured="NoUserEmailConfigured",t.NoRemoteRepositorySpecified="NoRemoteRepositorySpecified",t.NotAGitRepository="NotAGitRepository",t.NotAtRepositoryRoot="NotAtRepositoryRoot",t.Conflict="Conflict",t.StashConflict="StashConflict",t.UnmergedChanges="UnmergedChanges",t.PushRejected="PushRejected",t.RemoteConnectionError="RemoteConnectionError",t.DirtyWorkTree="DirtyWorkTree",t.CantOpenResource="CantOpenResource",t.GitNotFound="GitNotFound",t.CantCreatePipe="CantCreatePipe",t.PermissionDenied="PermissionDenied",t.CantAccessRemote="CantAccessRemote",t.RepositoryNotFound="RepositoryNotFound",t.RepositoryIsLocked="RepositoryIsLocked",t.BranchNotFullyMerged="BranchNotFullyMerged",t.NoRemoteReference="NoRemoteReference",t.InvalidBranchName="InvalidBranchName",t.BranchAlreadyExists="BranchAlreadyExists",t.NoLocalChanges="NoLocalChanges",t.NoStashFound="NoStashFound",t.LocalChangesOverwritten="LocalChangesOverwritten",t.NoUpstreamBranch="NoUpstreamBranch",t.IsInSubmodule="IsInSubmodule",t.WrongCase="WrongCase",t.CantLockRef="CantLockRef",t.CantRebaseMultipleBranches="CantRebaseMultipleBranches",t.PatchDoesNotApply="PatchDoesNotApply",t.NoPathFound="NoPathFound",t.UnknownPath="UnknownPath"})(r0||(r0={}));var pR=Object.defineProperty,gR=Object.getOwnPropertyDescriptor,mR=(t,e,r,n)=>{for(var i=n>1?void 0:n?gR(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&pR(e,r,i),i};const n0=/^https?:\/\/dev\.azure\.com(?:\/defaultcollection)?\/(?<organization>[^/]+)(?:\/(?<project>[^_/][^/]*))?(?:\/_git)?\/(?<repo>[^/?#]+)(?:\/commit\/(?<commit>[0-9a-f]{40})|\/pullrequest\/(?<pull>\d+))?/i,i0=1,o0=Object.freeze({id:wr.AzureRepos,name:"Azure Repos"});function mo(t){const{scheme:e,metadata:r}=Pt.decodeAuthority(t),[,n,i,o,...a]=t.path.split("/");return{scheme:e,provider:o0,name:`${n}/${i}/${o}`,repo:{organization:n,project:i,name:o},path:a.join("/")||"",ref:r==null?void 0:r.ref,idx:r==null?void 0:r.idx}}function vR(t,e){const{repo:r}=e!=null?e:mo(t);return t.with({path:`/${r.organization}/${r.project}/${r.name}`,query:"",fragment:""})}function Hh(t,e,r){const{repo:{organization:n,name:i}}=t instanceof d.Uri?mo(t):t;return d.Uri.parse(`azurerepos://${Pt.encodeAuthority("azurerepos",{v:i0,ref:{type:Ue.Commit,id:e}})}/${n}/${i}/${r}`)}class a0{constructor(e){this.providerService=e}get isReadonly(){return!0}get scheme(){return"azurerepos"}dispose(){}async ensureAuthenticated(e=!1){const r=new $e("AzDO.ensureAuthenticated");try{if(this._session===void 0){async function n(){try{return await d.authentication.getSession(go.id,Ss,{createIfNone:!0,forceNewSession:e})}catch{try{const o=await d.authentication.getSession(go.id,Ss,{createIfNone:!1});if(o!==void 0)return o}catch{}return new Promise(o=>{async function a(){const c=await d.authentication.getSession(go.id,Ss,{createIfNone:!0});c!==void 0&&o(c)}const s=d.authentication.onDidChangeSessions(async c=>{c.provider.id===go.id&&(s.dispose(),await a())})})}}this._session=await n();const i=d.authentication.onDidChangeSessions(o=>{if(this._session===void 0){i.dispose();return}o.provider.id===go.id&&(this.clearAuthenticationSession(),i.dispose())})}return this._session}finally{r.stop()}}async getAuthentication(e){const r=await this.ensureAuthenticated();return{provider:o0,session:r,getRichNavigationHeaders:()=>({"X-Git-AzureDevOps":`Basic ${this.getBase64AuthenticationSessionToken(r)}`})}}getBase64AuthenticationSessionToken(e){if(this._sessionTokenBase64===void 0){if(e===void 0)return this.ensureAuthenticated().then(r=>(this._sessionTokenBase64=xc(`PAT:${r.accessToken}`),this._sessionTokenBase64));this._sessionTokenBase64=xc(`PAT:${e.accessToken}`)}return this._sessionTokenBase64}clearAuthenticationSession(){this._session=void 0,this._sessionTokenBase64=void 0}async reauthenticate(){this.clearAuthenticationSession(),await this.ensureAuthenticated(!0)}async sendGetRequest(e,r,n,i){const a=`${n?`https://dev.azure.com/${e}/${n}/_apis/`:`https://dev.azure.com/${e}/_apis/`}${r}${i?`?${i}&`:"?"}api-version=5.1`;try{const s=await this.getBase64AuthenticationSessionToken();if(!s)throw new _n("Unauthenticated",()=>this.reauthenticate());const c=await on(a,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${s}`}});if(c.status===401)throw new _n("Unauthenticated",()=>this.reauthenticate());if(c.status===404)return;const l=await c.json();return l!=null?l:void 0}catch(s){throw K.error(s),s instanceof _n&&kr.showStatus401Message(s.reauthenticate),s}}async sendPostRequest(e,r){try{const n=await this.getBase64AuthenticationSessionToken();if(!n)throw new _n("Unauthenticated",()=>this.reauthenticate());const i=await on(e,{method:"POST",body:r,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${n}`}});if(i.status===401)throw new _n("Unauthenticated",()=>this.reauthenticate());const o=await i.json();return o!=null?o:void 0}catch(n){throw K.error(n),n instanceof _n&&kr.showStatus401Message(n.reauthenticate),n}}canOpenRemoteUrl(e){const r=n0.exec(e);if((r==null?void 0:r.groups)===void 0)return;const{commit:n}=r.groups;return n?Vr.Commit:Vr.Repository}async createWorkspaceForRemoteUrl(e,r=At.CurrentWindow){const n=n0.exec(e);if((n==null?void 0:n.groups)===void 0)return;const{organization:i,project:o,repo:a,commit:s}=n.groups;let c;s&&(c={type:Ue.Commit,id:s});const l=this.providerService.createVirtualUri(wr.AzureRepos,{repo:{organization:i,project:o!=null?o:a,name:a},ref:c});return{name:(await this.providerService.getMetadata(l)).name,uri:l,location:r}}createVirtualUri(e,{repo:r,ref:n,idx:i},o){if((n==null?void 0:n.type)===Ue.Tree)throw new Error(`Invalid ref type '${n.type}'`);const a=n!==void 0||i!==void 0?{v:i0}:void 0;return a&&(n&&(a.ref={type:n.type,id:n.id}),i&&(a.idx=i)),e.with({authority:Pt.encodeAuthority("azurerepos",a),path:`/${r.organization}/${r.project}/${r.name}${(o==null?void 0:o.startsWith("/"))?o:`/${o!=null?o:""}`}`})}getRemoteUri(e){const r=`https://dev.azure.com/${e.repo.organization}/${e.repo.project}/_git/${e.repo.name}`;return e.pullRequest?d.Uri.parse(r):e.branch?d.Uri.parse(`${r}?version=GB${e.branch}`):e.tag?d.Uri.parse(`${r}?version=GT${e.tag}`):e.sha?d.Uri.parse(`${r}/commit/${e.sha}`):d.Uri.parse(r)}getProviderRootUri(e){return vR(e)}getRelativeFilePath(e,r){const{path:n}=mo(e),{path:i}=mo(Ma(e,r));return n.length!==0&&i!==n&&i.startsWith(n)?i.slice(n.length+1):i}getVirtualUriMetadata(e){const{provider:r,name:n,repo:i,ref:o}=mo(e);return{provider:r,name:n,repo:i,ref:o}}async validateBranchOrTagCasing(e,r,n,i){const o=`git/repositories/${n}/refs`,a="includeLinks=true",s=await this.sendGetRequest(e,o,r,a);if((s==null?void 0:s.value)===void 0){K.warn("Could not get branches, might be incorrect auth token");return}const c=s.value;if(c.length===0)return i?{type:Ue.Branch,id:i}:void 0;const l=`refs/heads/${i.toLowerCase()}`,u=`refs/tags/${i.toLowerCase()}`;for(const h of c){const f=h.name;if(f.toLowerCase()==l)return{type:Ue.Branch,id:f.substr(11)};if(f.toLowerCase()==u)return{type:Ue.Tag,id:f.substr(10)}}}async getModeRefType(e,r){const{HEAD:n,pullRequest:i}=await(r!=null?r:this.getMetadata(e));switch(n.type){case Le.Branch:return i!==void 0?q.PullRequestBranch:q.Branch;case Le.RemoteBranch:return i!==void 0?q.PullRequestRemoteBranch:q.RemoteBranch;case Le.Tag:return q.Tag;case Le.Commit:return q.Commit}}async createMetadata(e,r){var n,i,o,a;const s=new $e(`AzDO.createMetadata(${e.toString()}, ${r})`);let c;try{let{provider:l,name:u,repo:{organization:h,project:f,name:p},ref:b}=mo(e);if(!b||b.type===Ue.Commit&&/HEAD/i.test(b.id))b={type:Ue.Commit,id:"HEAD"};else if((b.type===Ue.Branch||b.type===Ue.Tag)&&(b=await this.validateBranchOrTagCasing(h,f,p,b.id),b===void 0))throw new Error(`Cannot get metadata for Uri(${e.toString(!0)}); Unable to find the specified branch or tag`);const w=await this.getRepositoryInfo(h,f,p,b);if(w===void 0)throw c=" \u2022 Aborted; Unable to get repository info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let y;if(r)y=r;else if(b.type===Ue.Commit)y=b.id;else if(y=(i=(n=w.ref)==null?void 0:n.sha)!=null?i:w.defaultBranch.sha,y===void 0)throw c=" \u2022 Aborted; Unable to get repository revision",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let x;((o=w.ref)==null?void 0:o.prefix)==="refs/heads/"?x={type:Le.Branch,name:w.ref.name,sha:y,branch:{name:w.ref.name,sha:w.ref.sha}}:((a=w.ref)==null?void 0:a.prefix)==="refs/tags/"?x={type:Le.Tag,name:w.ref.name,sha:y,detached:{type:Le.Tag,name:w.ref.name}}:x={type:Le.Commit,name:pr(y),sha:y,detached:{type:Le.Commit,name:pr(y)}};const S={version:Ba.schemaVersion,timestamp:Date.now(),provider:l,name:u,repo:w.repo,user:w.user,accessLevel:w.accessLevel,HEAD:x,defaultBranch:w.defaultBranch,pullRequest:w.pullRequest};return c=` \u2022 HEAD=${x.sha}`,S}finally{s.stop(c?{suffix:c}:void 0)}}getMetadata(e){return this.providerService.getMetadata(e)}getRemoteWorkspaceSourceProviders(){return[]}async createBranch(e,r,n,i){throw new Error("Branch creation is currently not supported")}async createCommit(e,r,n,i){throw new Error("Commit creation is currently not supported")}async createAndPushCommit(e,r,n,i,o){throw new Error("Commit creation is currently not supported")}async createPullRequest(e,r,n,i,o){throw new Error("PR creation is currently not supported")}async fetch(e,r){const{fetched:n,metadata:i}=await this.fetchCore(e,!1,r);n&&await this.providerService.updateMetadata(e,i)}async fetchCore(e,r,n){var i,o,a,s;const{force:c,to:l}={...n,force:r||(n==null?void 0:n.force)},u=new $e(`AzDO.fetch(${e.toString()}, force=${c}, to=${l})`);let h;try{const f=await this.getMetadata(e);if(f.HEAD.detached)return h=" \u2022 Skipped; detached HEAD",{fetched:!1,metadata:f};if(f.HEAD.type===Le.RemoteBranch)return h=" \u2022 Skipped; remote branch",{fetched:!1,metadata:f};const p=await this.getBranchTips(e);if(!p)throw h=" \u2022 Unable to fetch branch tips",new Zi(r);if(!c&&!l&&((i=p.defaultBranch)==null?void 0:i.sha)!==void 0&&p.defaultBranch.sha===f.defaultBranch.sha&&((o=p.branch)==null?void 0:o.sha)!==void 0&&p.branch.sha===f.HEAD.branch.sha)return h=" \u2022 No changes detected",{fetched:!1,metadata:f};let b;if(((a=p.defaultBranch)==null?void 0:a.sha)!==void 0&&p.defaultBranch.sha!==f.defaultBranch.sha&&(b={defaultBranch:{...f.defaultBranch,sha:p.defaultBranch.sha}}),((s=p.branch)==null?void 0:s.sha)===void 0){if(h=" \u2022 Unable to find branch tip",c)throw new Zi(r);return b!==void 0?{fetched:!0,metadata:{...f,...b}}:{fetched:!1,metadata:f}}return p.branch.sha!==f.HEAD.branch.sha&&(b={...b,HEAD:{...f.HEAD,branch:{...f.HEAD.branch,sha:p.branch.sha},detached:void 0}}),p.branch.sha===f.HEAD.sha?(h=" \u2022 Up to date",f.state!==void 0||b!==void 0?{fetched:!0,metadata:{...f,...b,state:void 0}}:{fetched:!1,metadata:f}):b!==void 0?{fetched:!0,metadata:{...f,...b}}:{fetched:!1,metadata:f}}finally{u.stop(h?{suffix:h}:void 0)}}async fork(e){throw new Error("Forks are currently not supported")}async getBranches(e,r){try{const n=await this.getRefs(e,{...r,filter:"heads",filterContains:r==null?void 0:r.query});if(n.length===0)return{branches:[]};const i=[];for(const o of n)!o.name.startsWith("refs/heads/")||i.push({type:Mn.Head,name:o.name.substr(11),commit:o.objectId,commitUrl:o.url});return{branches:i}}catch(n){return{branches:[]}}}async getCommit(e,r){try{const{repo:{organization:n,project:i,name:o}}=await this.getMetadata(e),a=`git/repositories/${o}/commits/${r}`,s=await this.sendGetRequest(n,a,i);return s===void 0?void 0:{hash:s.commitId,message:s.comment,parents:s.parents,authorDate:new Date(s.author.date),authorEmail:s.author.email,authorName:s.author.name,commitDate:new Date(s.committer.date)}}catch(n){return}}async getCommits(e,r){var n,i;try{const{repo:{organization:o,project:a,name:s}}=await this.getMetadata(e),c=`git/repositories/${s}/commits`;let l=`searchCriteria.itemVersion.version=${(n=r==null?void 0:r.cursor)!=null?n:r==null?void 0:r.ref}&searchCriteria.itemVersion.versionType=commit`;(r==null?void 0:r.path)&&(l+=`&searchCriteria.itemPath=${r.path}`);const u=(i=r==null?void 0:r.limit)!=null?i:100;l+=`&searchCriteria.$top=${u+1}`;const h=await this.sendGetRequest(o,c,a,l);if((h==null?void 0:h.value)===void 0)return;const f=h.value.map((b,w)=>({hash:b.commitId,message:b.comment,parents:h.value[w+1]?[h.value[w+1].commitId]:[],authorDate:new Date(b.author.date),authorEmail:b.author.email,authorName:b.author.name,commitDate:new Date(b.committer.date)}));let p;return f.length>u&&(f.splice(f.length-1,1),p={cursor:f[f.length-1].hash,more:!0}),{commits:f,paging:p}}catch(o){return}}async getFileContent(e,r,n){var i,o;try{const{HEAD:a,repo:{organization:s,project:c,id:l},path:u}=await this.providerService.getMetadata(e);n=n!=null?n:u;const h=`git/repositories/${l}/items`;let f="";n&&(f+=`path=${n}&includeContent=true`),r||Zn((i=a.branch)==null?void 0:i.name)?f+=`&versionDescriptor.version=${r!=null?r:(o=a.branch)==null?void 0:o.name}&versionDescriptor.versionType=commit`:a.type===Le.Branch?f+=`&versionDescriptor.version=${a.branch.name}&versionDescriptor.versionType=branch`:a.type===Le.Tag&&(f+=`&versionDescriptor.version=${a.name}&versionDescriptor.versionType=tag`);const p=await this.sendGetRequest(s,h,c,f);if(p==null?void 0:p.content)return new TextEncoder().encode(p.content);throw d.FileSystemError.FileNotFound(e)}catch(a){throw K.logLevel===Rt.Debug&&K.error(a),a}}async getFork(e){throw new Error("Forks are currently not supported")}async getIncomingChanges(e){var r,n;return(n=(r=(await this.getMetadata(e)).state)==null?void 0:r.incomingChanges)!=null?n:[]}async compareCommits(e,r){throw new Error("Comparing commits is currently not supported")}async getObjectDetails(e,r,n){throw new Error("Not able to get object detail")}async getPullRequest(e,r){throw new Error("PRs are currently not supported")}async getRepoItems(e,r,n){const i=`git/repositories/${e.repo.name}/items`,[,,,,...o]=r.split("/");let a=`scopePath=${o.join("/")}&recursionLevel=${n.recursionLevel}&includeContentMetadata=true`;e.HEAD.type===Le.Commit?a+=`&versionDescriptor.version=${e.HEAD.sha}&versionDescriptor.versionType=commit`:e.HEAD.type===Le.Branch?a+=`&versionDescriptor.version=${e.HEAD.branch.name}&versionDescriptor.versionType=branch`:e.HEAD.type===Le.Tag&&(a+=`&versionDescriptor.version=${e.HEAD.name}&versionDescriptor.versionType=tag`);const s=await this.sendGetRequest(e.repo.organization,i,e.repo.project,a);return s&&Array.isArray(s==null?void 0:s.value)?s==null?void 0:s.value:(K.debug(`AzDOProvider.getRepoItems returned ${s===void 0?"empty":"invalid"} result ${s==null?void 0:s.value} for path ${r}`),[])}async getTags(e,r){try{const n=await this.getRefs(e,{...r,filter:"tags",filterContains:r==null?void 0:r.query});if(n.length===0)return{tags:[]};const i=[];for(const o of n)!o.name.startsWith("refs/tags/")||i.push({type:Mn.Tag,name:o.name.substr(10),commit:o.objectId,commitUrl:o.url});return{tags:i}}catch(n){return{tags:[]}}}async getTarGz(e,r){throw new Error("Getting zip is currently not supported")}async pushCommit(e,r,n,i){throw new Error("Commit pushing is not currently supported")}async getRefs(e,r){var n;const{repo:{organization:i,project:o,name:a}}=mo(e),s=`git/repositories/${a}/refs`;let c="includeLinks=true";(r==null?void 0:r.filter)&&(c+=`&filter=${r.filter}`),(r==null?void 0:r.filterContains)&&(c+=`&filterContains=${r.filterContains}`),(r==null?void 0:r.limit)&&(c+=`&$top=${r.limit}`);const l=await this.sendGetRequest(i,s,o,c);return(n=l==null?void 0:l.value)!=null?n:[]}async getItems(e){const r=await this.sendGetRequest(e,"projects");if(!r){K.warn("do something here");return}return r}async getProjects(e){const r=await this.getItems(e),n=[];return r==null||r.value.map(i=>n.push({label:i.name,description:i.description})),d.window.showQuickPick(n,{placeholder:"Select a Azure DevOps project",title:"Select a Azure DevOps project",ignoreFocusOut:!0})}async searchRepositoriesQuery(e,r){try{const n=await d.window.showInputBox({placeHolder:"Enter an Azure DevOps Organization",ignoreFocusOut:!0});if(!n)return[];const i=await this.getProjects(n),o=await this.sendGetRequest(n,"git/repositories",i.label);return o==null?void 0:o.value.map(a=>({name:a.name,description:void 0,url:a.webUrl,fork:void 0,stars:0}))}catch(n){throw K.error(n),n}}async searchCodeQuery(e,r,n){var i;const{repo:{organization:o,project:a,name:s},HEAD:c,defaultBranch:l}=await this.getMetadata(r),u=`https://almsearch.dev.azure.com/${o}/${a}/_apis/search/codesearchresults?api-version=6.1-preview.1`,h=c.branch?c.branch.name:l.name,f={searchText:e,$skip:0,$top:1e3,filters:{Project:[a],Repository:[s],Path:["/"],Branch:[h]},$orderBy:[{field:"filename",sortOrder:"ASC"}],includeSnippet:!0},p=await this.sendPostRequest(u,JSON.stringify(f)),b=new d.Range(0,0,0,0),w=[];let y;for(const x of(i=p==null?void 0:p.results)!=null?i:[])for(const S of x.matches.content){y={path:x.path,ranges:[],preview:"",matches:[]};const I=Math.max(0,S.line-1),D=S.charOffset,U=D+S.length;y.preview=S.codeSnippet?S.codeSnippet:`CharOffset: ${S.charOffset}, Type: ${S.type}`,y.ranges.push(new d.Range(I,D,I,U)),y.matches.push(b),w.push(y)}return{matches:w,limitHit:!1}}async switchTo(e,r,n){const{name:i,repo:o,HEAD:{branch:a}}=await this.getMetadata(e);let s;if(!(r!==void 0&&(typeof r=="string"?r.startsWith("refs/heads/")?s={type:Ue.Branch,id:r.substr(11)}:r.startsWith("refs/tags/")?s={type:Ue.Tag,id:r.substr(10)}:s={type:Ue.Branch,id:r}:s={...r,type:r.type===Ue.Tree?Ue.Branch:r.type},(a==null?void 0:a.name)===s.id)))return{name:i,uri:this.providerService.createVirtualUri(e,{repo:o,ref:s}),location:(n==null?void 0:n.openInNewWindow)?At.NewWindow:At.CurrentWindow}}async sync(e,r,n){var i,o,a,s,c,l;const u=new $e(`AzDO.sync(${e.toString()}, resolution=${n.conflictResolution}, to=${n.to})`);let h;try{const{metadata:f}=await this.fetchCore(e,!0,{to:n.to});if(f.HEAD.detached){h=" \u2022 Skipped; detached HEAD";return}if(((o=(i=f==null?void 0:f.state)==null?void 0:i.behind)!=null?o:0)>0&&await r.hasChanges(e)){u.logStep("Fetching upstream changes");const p=[],b=(s=(a=f.state)==null?void 0:a.incomingChanges)!=null?s:[];if(b.length>0){const w=await r.getChanges(e);for(const y of w){const x=this.providerService.getRelativeFilePath(e,y.uri),S=b.find(I=>I.uri.path===y.uri.path);if(S!==void 0){p.push({path:x,current:y,incomingType:S.type});break}}}if(p.length>0)switch(n.conflictResolution){case Zr.KeepCurrent:u.logStep("Syncing (keep) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (keep) upstream changes..."});for(const w of p)await r.keep(w.current.uri,{type:w.incomingType,providerUri:Hh(f,f.HEAD.branch.sha,w.path)});break;case Zr.DiscardCurrent:u.logStep("Syncing (discard) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (discard) upstream changes..."});for(const w of p)await r.discard(w.current.uri);break;case Zr.Merge:u.logStep("Syncing (merge) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (merge) upstream changes..."});for(const w of p)await r.merge(w.current.uri,{type:w.incomingType,providerUri:Hh(f,f.HEAD.branch.sha,w.path)},{providerUri:Hh(f,f.HEAD.sha,w.path)});break;case Zr.Abort:default:throw u.logStep("Syncing (abort) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (abort) upstream changes..."}),await this.providerService.updateMetadata(e,f),new qa}}h=` \u2022 to=${(c=n.to)!=null?c:f.HEAD.branch.sha}`,await this.fastForwardTo(e,(l=n.to)!=null?l:f.HEAD.branch.sha,f)}finally{u.stop(h?{suffix:h}:void 0)}}async fastForwardTo(e,r,n){if(n.HEAD.detached)throw new Ki("Unable to fast-forward; no current branch");n.HEAD.sha===r&&n.state===void 0||(K.log(`Fast forward to ${r}; rootUri=${e.toString()}`),await this.providerService.updateMetadata(e,{...n,HEAD:{...n.HEAD,detached:void 0,sha:r},state:void 0,timestamp:Date.now()}),r!==n.HEAD.branch.sha&&await this.fetchCore(e,!1,{to:r}))}async getBranchTips(e,r){try{const{repo:{organization:n,project:i,name:o},HEAD:{branch:a}}=await this.getMetadata(e);r===void 0?r=a?`heads/${a.name}`:"":r.startsWith("refs/")&&(r=r.slice(5));const s=`git/repositories/${o}/refs`,c=`includeLinks=true&filter=${r}`,l=await this.sendGetRequest(n,s,i,c),u=l==null?void 0:l.value;if(u===[])return;const h={target:{oid:u[0].objectId}},f=`git/repositories/${o}`,p=await this.sendGetRequest(n,f,i);let b=p==null?void 0:p.defaultBranch;b.startsWith("refs/")&&(b=b.slice(5));const w=`git/repositories/${o}/refs`,y=`includeLinks=true&filter=${b}`,x=await this.sendGetRequest(n,w,i,y),S=x==null?void 0:x.value;if(S===[])return;const I={target:{oid:S[0].objectId}};if(!I&&!h)return;const D=I?{sha:I.target.oid}:void 0,U=h?{sha:h.target.oid}:void 0;return{defaultBranch:D,branch:U}}catch(n){return}}async getRepositoryId(e,r,n){const i=`git/repositories/${n}`,o=await this.sendGetRequest(e,i,r);if(o){if(o.id)return o.id;throw new Error("Sign in page was returned for repoId. Check the token sent")}throw new Error("Can't get Repo Id")}async getRepositoryInfo(e,r,n,i){const o=await this.getRepositoryId(e,r,n),a=`git/repositories/${o}`,s=await this.sendGetRequest(e,a,r);if(!s)return;s.defaultBranch.startsWith("refs/heads/")&&(s.defaultBranch=s.defaultBranch.substr(11));const c=`git/repositories/${n}/stats/branches`,l=`name=${s.defaultBranch}`,u=await this.sendGetRequest(e,c,r,l);if(!u)return;let h=null;Zn(i.id)&&(h=i.id);const f={user:"jepetty",repo:{organization:e,project:r,name:n,id:o},accessLevel:$t.Read,defaultBranch:{name:u.name,sha:h||u.commit.commitId}};if(i.type===Ue.Branch){const p=`git/repositories/${n}/stats/branches`,b=`name=${i.id}`,w=await this.sendGetRequest(e,p,r,b);if(w)return{...f,ref:{name:w.name,sha:w.commit.commitId,prefix:"refs/heads/"}}}else if(i.type===Ue.Tag){const p=`git/repositories/${o}/items`,b=`versionDescriptor.version=${i.id}&versionDescriptor.versionType=tag`,w=await this.sendGetRequest(e,p,r,b);if(w&&w.value.length===1)return{...f,ref:{name:i.id,sha:w.value[0].commitId,prefix:"refs/tags/"}}}else{if(i.type===Ue.Commit)return i.id==="HEAD"&&(i.id=s.defaultBranch),{...f,ref:{name:i.id,sha:u.commit.commitId,prefix:"refs/heads/"}};throw new Error("Not supported yet :(")}}}mR([yr()],a0.prototype,"ensureAuthenticated",1);class wR{constructor(e,r){this.providerService=e,this.changeStore=r,this.providers=[],this.handledRepositories=new Set,this.services=new Map,this.disposable=d.Disposable.from(e.onDidChangeRepositories(n=>{for(const i of n.added)this.repositoryOpened(i);for(const i of n.removed)this.repositoryClosed(i)}));for(const n of this.providerService.repositories)this.repositoryOpened(n)}dispose(){this.disposable.dispose()}register(e){const r=this.providers.length;return this.providers.push(e),{dispose:()=>this.providers.splice(r,1)}}async repositoryOpened(e){const r=we(e.uri);if(!this.handledRepositories.has(r)){this.handledRepositories.add(r);for(const n of this.providers){const i=await n.createNavigationService(this.providerService,e,this.changeStore);if(i!==void 0){const o=i();this.services.set(r,{service:o});break}}}}repositoryClosed(e){const r=we(e.uri);this.handledRepositories.delete(r);const n=this.services.get(r);n!==void 0&&(n.service.dispose(),this.services.delete(we(e.uri)))}}/*! (c) Andrea Giammarchi - ISC */var Il={};try{(function(t,e){if(new t("q=%2B").get("q")!==e||new t({q:e}).get("q")!==e||new t([["q",e]]).get("q")!==e||new t(`q=
`).toString()!=="q=%0A"||new t({q:" &"}).toString()!=="q=+%26"||new t({q:"%zx"}).toString()!=="q=%25zx")throw t;Il.URLSearchParams=t})(URLSearchParams,"+")}catch(t){(function(e,r,n){"use strict";var i=e.create,o=e.defineProperty,a=/[!'\(\)~]|%20|%00/g,s=/%(?![0-9a-fA-F]{2})/g,c=/\+/g,l={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},u={append:function(S,I){b(this._ungap,S,I)},delete:function(S){delete this._ungap[S]},get:function(S){return this.has(S)?this._ungap[S][0]:null},getAll:function(S){return this.has(S)?this._ungap[S].slice(0):[]},has:function(S){return S in this._ungap},set:function(S,I){this._ungap[S]=[r(I)]},forEach:function(S,I){var D=this;for(var U in D._ungap)D._ungap[U].forEach(te,U);function te(J){S.call(I,J,r(U),D)}},toJSON:function(){return{}},toString:function(){var S=[];for(var I in this._ungap)for(var D=y(I),U=0,te=this._ungap[I];U<te.length;U++)S.push(D+"="+y(te[U]));return S.join("&")}};for(var h in u)o(f.prototype,h,{configurable:!0,writable:!0,value:u[h]});Il.URLSearchParams=f;function f(S){var I=i(null);switch(o(this,"_ungap",{value:I}),!0){case!S:break;case typeof S=="string":S.charAt(0)==="?"&&(S=S.slice(1));for(var D=S.split("&"),U=0,te=D.length;U<te;U++){var J=D[U],G=J.indexOf("=");-1<G?b(I,w(J.slice(0,G)),w(J.slice(G+1))):J.length&&b(I,w(J),"")}break;case n(S):for(var U=0,te=S.length;U<te;U++){var J=S[U];b(I,J[0],J[1])}break;case"forEach"in S:S.forEach(p,I);break;default:for(var ue in S)b(I,ue,S[ue])}}function p(S,I){b(this,I,S)}function b(S,I,D){var U=n(D)?D.join(","):D;I in S?S[I].push(U):S[I]=[U]}function w(S){return decodeURIComponent(S.replace(s,"%25").replace(c," "))}function y(S){return encodeURIComponent(S).replace(a,x)}function x(S){return l[S]}})(Object,String,Array.isArray)}(function(t){var e=!1;try{e=!!Symbol.iterator}catch(n){}"forEach"in t||(t.forEach=function(i,o){var a=this,s=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach(function(c){!c.length||c in s||(s[c]=a.getAll(c)).forEach(function(l){i.call(o,l,c,a)})})}),"keys"in t||(t.keys=function(){return r(this,function(i,o){this.push(o)})}),"values"in t||(t.values=function(){return r(this,function(i,o){this.push(i)})}),"entries"in t||(t.entries=function(){return r(this,function(i,o){this.push([o,i])})}),e&&!(Symbol.iterator in t)&&(t[Symbol.iterator]=t.entries),"sort"in t||(t.sort=function(){for(var i=this.entries(),o=i.next(),a=o.done,s=[],c=Object.create(null),l,u,h;!a;)h=o.value,u=h[0],s.push(u),u in c||(c[u]=[]),c[u].push(h[1]),o=i.next(),a=o.done;for(s.sort(),l=0;l<s.length;l++)this.delete(s[l]);for(l=0;l<s.length;l++)u=s[l],this.append(u,c[u].shift())});function r(n,i){var o=[];return n.forEach(i,o),e?o[Symbol.iterator]():{next:function(){var a=o.shift();return{done:a===void 0,value:a}}}}(function(n){var i=n.defineProperty,o=n.getOwnPropertyDescriptor,a=function(h){function f(w,y){t.append.call(this,w,y),w=this.toString(),h.set.call(this._usp,w?"?"+w:"")}function p(w){t.delete.call(this,w),w=this.toString(),h.set.call(this._usp,w?"?"+w:"")}function b(w,y){t.set.call(this,w,y),w=this.toString(),h.set.call(this._usp,w?"?"+w:"")}return function(w,y){return w.append=f,w.delete=p,w.set=b,i(w,"_usp",{configurable:!0,writable:!0,value:y})}},s=function(h){return function(f,p){return i(f,"_searchParams",{configurable:!0,writable:!0,value:h(p,f)}),p}},c=function(h){var f=h.append;h.append=t.append,URLSearchParams.call(h,h._usp.search.slice(1)),h.append=f},l=function(h,f){if(!(h instanceof f))throw new TypeError("'searchParams' accessed on an object that does not implement interface "+f.name)},u=function(h){var f=h.prototype,p=o(f,"searchParams"),b=o(f,"href"),w=o(f,"search"),y;!p&&w&&w.set&&(y=s(a(w)),n.defineProperties(f,{href:{get:function(){return b.get.call(this)},set:function(x){var S=this._searchParams;b.set.call(this,x),S&&c(S)}},search:{get:function(){return w.get.call(this)},set:function(x){var S=this._searchParams;w.set.call(this,x),S&&c(S)}},searchParams:{get:function(){return l(this,h),this._searchParams||y(this,new URLSearchParams(this.search.slice(1)))},set:function(x){l(this,h),y(this,x)}}}))};try{u(HTMLAnchorElement),/^function|object$/.test(typeof URL)&&URL.prototype&&u(URL)}catch(h){}})(Object)})(Il.URLSearchParams.prototype,Object);const s0=Il.URLSearchParams;var yR=__webpack_require__(6822);const Ke=(0,C.loadMessageBundle)(),qh=60,Wh=qh*60,Rs=Wh*24,c0=Rs*7,l0=Rs*30,u0=Rs*365;function Ts(t,e){typeof t!="number"&&(t=t.getTime());const r=Math.round((new Date().getTime()-t)/1e3);if(r<-30)return Ke("date.fromNow.in","in {0}",Ts(new Date().getTime()+r*1e3,{ago:!1,short:e==null?void 0:e.short}));if(r<30)return(e==null?void 0:e.ago)?(e==null?void 0:e.short)?Ke("date.fromNow.seconds.short.ago","secs ago"):Ke("date.fromNow.seconds.ago","A few seconds ago"):(e==null?void 0:e.short)?Ke("date.fromNow.now.short","now"):Ke("date.fromNow.now","Just now");let n;return r<qh?(n=r,(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.seconds.singular.short.ago","{0} sec ago",n):Ke("date.fromNow.seconds.singular.ago","{0} second ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.seconds.plural.short.ago","{0} secs ago",n):Ke("date.fromNow.seconds.plural.ago","{0} seconds ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.seconds.singular.short","{0} sec",n):Ke("date.fromNow.seconds.singular","{0} second",n):(e==null?void 0:e.short)?Ke("date.fromNow.seconds.plural.short","{0} secs",n):Ke("date.fromNow.seconds.plural","{0} seconds",n)):r<Wh?(n=Math.floor(r/qh),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.minutes.singular.short.ago","{0} min ago",n):Ke("date.fromNow.minutes.singular.ago","{0} minute ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.minutes.plural.short.ago","{0} mins ago",n):Ke("date.fromNow.minutes.plural.ago","{0} minutes ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.minutes.singular.short","{0} min",n):Ke("date.fromNow.minutes.singular","{0} minute",n):(e==null?void 0:e.short)?Ke("date.fromNow.minutes.plural.short","{0} mins",n):Ke("date.fromNow.minutes.plural","{0} minutes",n)):r<Rs?(n=Math.floor(r/Wh),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.hours.singular.short.ago","{0} hr ago",n):Ke("date.fromNow.hours.singular.ago","{0} hour ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.hours.plural.short.ago","{0} hrs ago",n):Ke("date.fromNow.hours.plural.ago","{0} hours ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.hours.singular.short","{0} hr",n):Ke("date.fromNow.hours.singular","{0} hour",n):(e==null?void 0:e.short)?Ke("date.fromNow.hours.plural.short","{0} hrs",n):Ke("date.fromNow.hours.plural","{0} hours",n)):r<c0?(n=Math.floor(r/Rs),(e==null?void 0:e.ago)?n===1?Ke("date.fromNow.days.singular.ago","{0} day ago",n):Ke("date.fromNow.days.plural.ago","{0} days ago",n):n===1?Ke("date.fromNow.days.singular","{0} day",n):Ke("date.fromNow.days.plural","{0} days",n)):r<l0?(n=Math.floor(r/c0),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.weeks.singular.short.ago","{0} wk ago",n):Ke("date.fromNow.weeks.singular.ago","{0} week ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.weeks.plural.short.ago","{0} wks ago",n):Ke("date.fromNow.weeks.plural.ago","{0} weeks ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.weeks.singular.short","{0} wk",n):Ke("date.fromNow.weeks.singular","{0} week",n):(e==null?void 0:e.short)?Ke("date.fromNow.weeks.plural.short","{0} wks",n):Ke("date.fromNow.weeks.plural","{0} weeks",n)):r<u0?(n=Math.floor(r/l0),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.months.singular.short.ago","{0} mo ago",n):Ke("date.fromNow.months.singular.ago","{0} month ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.months.plural.short.ago","{0} mos ago",n):Ke("date.fromNow.months.plural.ago","{0} months ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.months.singular.short","{0} mo",n):Ke("date.fromNow.months.singular","{0} month",n):(e==null?void 0:e.short)?Ke("date.fromNow.months.plural.short","{0} mos",n):Ke("date.fromNow.months.plural","{0} months",n)):(n=Math.floor(r/u0),(e==null?void 0:e.ago)?n===1?(e==null?void 0:e.short)?Ke("date.fromNow.years.singular.short.ago","{0} yr ago",n):Ke("date.fromNow.years.singular.ago","{0} year ago",n):(e==null?void 0:e.short)?Ke("date.fromNow.years.plural.short.ago","{0} yrs ago",n):Ke("date.fromNow.years.plural.ago","{0} years ago",n):n===1?(e==null?void 0:e.short)?Ke("date.fromNow.years.singular.short","{0} yr",n):Ke("date.fromNow.years.singular","{0} year",n):(e==null?void 0:e.short)?Ke("date.fromNow.years.plural.short","{0} yrs",n):Ke("date.fromNow.years.plural","{0} years",n))}var d0,Ir;(function(t){t.None=0,t.First=1,t.AsOld=t.First,t.Last=2,t.AsNew=t.Last})(Ir||(Ir={}));class bR{constructor(){this[d0]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return(e=this._head)==null?void 0:e.value}get last(){var e;return(e=this._tail)==null?void 0:e.value}has(e){return this._map.has(e)}get(e,r=Ir.None){const n=this._map.get(e);if(!!n)return r!==Ir.None&&this.touch(n,r),n.value}set(e,r,n=Ir.None){let i=this._map.get(e);if(i)i.value=r,n!==Ir.None&&this.touch(i,n);else{switch(i={key:e,value:r,next:void 0,previous:void 0},n){case Ir.None:this.addItemLast(i);break;case Ir.First:this.addItemFirst(i);break;case Ir.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return Boolean(this.remove(e))}remove(e){const r=this._map.get(e);if(!!r)return this._map.delete(e),this.removeItem(r),this._size--,r.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,r){const n=this._state;let i=this._head;for(;i;){if(r?e.bind(r)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:r.key,done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}values(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:r.value,done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}entries(){const e=this._state;let r=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){const i={value:[r.key,r.value],done:!1};return r=r.next,i}return{value:void 0,done:!0}}};return n}[(d0=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let r=this._head,n=this.size;for(;r&&n>e;)this._map.delete(r.key),r=r.next,n--;this._head=r,this._size=n,r&&(r.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const r=e.next,n=e.previous;if(!r||!n)throw new Error("Invalid list");r.previous=n,n.next=r}e.next=void 0,e.previous=void 0,this._state++}touch(e,r){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(r!==Ir.First&&r!==Ir.Last)){if(r===Ir.First){if(e===this._head)return;const n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(r===Ir.Last){if(e===this._tail)return;const n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){const e=[];return this.forEach((r,n)=>{e.push([n,r])}),e}fromJSON(e){this.clear();for(const[r,n]of e)this.set(r,n)}}class Fi extends bR{constructor(e,r=1){super();this._limit=e,this._ratio=Math.min(Math.max(0,r),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,r=Ir.AsNew){return super.get(e,r)}peek(e){return super.get(e,Ir.None)}set(e,r){return super.set(e,r,Ir.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}function _R(t,e,r){return new vo(new p0(t),new p0(e)).ComputeDiff(r).changes}class Ni{constructor(e,r,n,i){this.originalStart=e,this.originalLength=r,this.modifiedStart=n,this.modifiedLength=i}getOriginalEnd(){return this.originalStart+this.originalLength}getModifiedEnd(){return this.modifiedStart+this.modifiedLength}}var h0;(function(t){t[t.MAX_SAFE_SMALL_INTEGER=1073741824]="MAX_SAFE_SMALL_INTEGER",t[t.MIN_SAFE_SMALL_INTEGER=-1073741824]="MIN_SAFE_SMALL_INTEGER",t[t.MAX_UINT_8=255]="MAX_UINT_8",t[t.MAX_UINT_16=65535]="MAX_UINT_16",t[t.MAX_UINT_32=4294967295]="MAX_UINT_32",t[t.UNICODE_SUPPLEMENTARY_PLANE_BEGIN=65536]="UNICODE_SUPPLEMENTARY_PLANE_BEGIN"})(h0||(h0={}));function f0(t,e){return(e<<5)-e+t|0}function xR(t,e){e=f0(149417,e);for(let r=0,n=t.length;r<n;r++)e=f0(t.charCodeAt(r),e);return e}class p0{constructor(e){this.source=e}getElements(){const e=this.source,r=new Int32Array(e.length);for(let n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return r}}class fa{static Assert(e,r){if(!e)throw new Error(r)}}class pa{static Copy(e,r,n,i,o){for(let a=0;a<o;a++)n[i+a]=e[r+a]}static Copy2(e,r,n,i,o){for(let a=0;a<o;a++)n[i+a]=e[r+a]}}var g0;(function(t){t[t.MaxDifferencesHistory=1447]="MaxDifferencesHistory"})(g0||(g0={}));class m0{constructor(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}MarkNextChange(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new Ni(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824}AddOriginalElement(e,r){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,r),this.m_originalCount++}AddModifiedElement(e,r){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,r),this.m_modifiedCount++}getChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes}getReverseChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes}}class vo{constructor(e,r,n=null){this.ContinueProcessingPredicate=n,this._originalSequence=e,this._modifiedSequence=r;const[i,o,a]=vo._getElements(e),[s,c,l]=vo._getElements(r);this._hasStrings=a&&l,this._originalStringElements=i,this._originalElementsOrHash=o,this._modifiedStringElements=s,this._modifiedElementsOrHash=c,this.m_forwardHistory=[],this.m_reverseHistory=[]}static _isStringArray(e){return e.length>0&&typeof e[0]=="string"}static _getElements(e){const r=e.getElements();if(vo._isStringArray(r)){const n=new Int32Array(r.length);for(let i=0,o=r.length;i<o;i++)n[i]=xR(r[i],0);return[r,n,!0]}return r instanceof Int32Array?[[],r,!1]:[[],new Int32Array(r),!1]}ElementsAreEqual(e,r){return this._originalElementsOrHash[e]!==this._modifiedElementsOrHash[r]?!1:this._hasStrings?this._originalStringElements[e]===this._modifiedStringElements[r]:!0}ElementsAreStrictEqual(e,r){if(!this.ElementsAreEqual(e,r))return!1;const n=vo._getStrictElement(this._originalSequence,e),i=vo._getStrictElement(this._modifiedSequence,r);return n===i}static _getStrictElement(e,r){return typeof e.getStrictElement=="function"?e.getStrictElement(r):null}OriginalElementsAreEqual(e,r){return this._originalElementsOrHash[e]!==this._originalElementsOrHash[r]?!1:this._hasStrings?this._originalStringElements[e]===this._originalStringElements[r]:!0}ModifiedElementsAreEqual(e,r){return this._modifiedElementsOrHash[e]!==this._modifiedElementsOrHash[r]?!1:this._hasStrings?this._modifiedStringElements[e]===this._modifiedStringElements[r]:!0}ComputeDiff(e){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1,e)}_ComputeDiff(e,r,n,i,o){const a=[!1];let s=this.ComputeDiffRecursive(e,r,n,i,a);return o&&(s=this.PrettifyChanges(s)),{quitEarly:a[0],changes:s}}ComputeDiffRecursive(e,r,n,i,o){for(o[0]=!1;e<=r&&n<=i&&this.ElementsAreEqual(e,n);)e++,n++;for(;r>=e&&i>=n&&this.ElementsAreEqual(r,i);)r--,i--;if(e>r||n>i){let h;return n<=i?(fa.Assert(e===r+1,"originalStart should only be one more than originalEnd"),h=[new Ni(e,0,n,i-n+1)]):e<=r?(fa.Assert(n===i+1,"modifiedStart should only be one more than modifiedEnd"),h=[new Ni(e,r-e+1,n,0)]):(fa.Assert(e===r+1,"originalStart should only be one more than originalEnd"),fa.Assert(n===i+1,"modifiedStart should only be one more than modifiedEnd"),h=[]),h}const a=[0],s=[0],c=this.ComputeRecursionPoint(e,r,n,i,a,s,o),l=a[0],u=s[0];if(c!==null)return c;if(!o[0]){const h=this.ComputeDiffRecursive(e,l,n,u,o);let f=[];return o[0]?f=[new Ni(l+1,r-(l+1)+1,u+1,i-(u+1)+1)]:f=this.ComputeDiffRecursive(l+1,r,u+1,i,o),this.ConcatenateChanges(h,f)}return[new Ni(e,r-e+1,n,i-n+1)]}WALKTRACE(e,r,n,i,o,a,s,c,l,u,h,f,p,b,w,y,x,S){let I=null,D=null,U=new m0,te=r,J=n,G=p[0]-y[0]-i,ue=-1073741824,re=this.m_forwardHistory.length-1;do{const se=G+e;se===te||se<J&&l[se-1]<l[se+1]?(h=l[se+1],b=h-G-i,h<ue&&U.MarkNextChange(),ue=h,U.AddModifiedElement(h+1,b),G=se+1-e):(h=l[se-1]+1,b=h-G-i,h<ue&&U.MarkNextChange(),ue=h-1,U.AddOriginalElement(h,b+1),G=se-1-e),re>=0&&(l=this.m_forwardHistory[re],e=l[0],te=1,J=l.length-1)}while(--re>=-1);if(I=U.getReverseChanges(),S[0]){let se=p[0]+1,xe=y[0]+1;if(I!==null&&I.length>0){const dt=I[I.length-1];se=Math.max(se,dt.getOriginalEnd()),xe=Math.max(xe,dt.getModifiedEnd())}D=[new Ni(se,f-se+1,xe,w-xe+1)]}else{U=new m0,te=a,J=s,G=p[0]-y[0]-c,ue=1073741824,re=x?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{const se=G+o;se===te||se<J&&u[se-1]>=u[se+1]?(h=u[se+1]-1,b=h-G-c,h>ue&&U.MarkNextChange(),ue=h+1,U.AddOriginalElement(h+1,b+1),G=se+1-o):(h=u[se-1],b=h-G-c,h>ue&&U.MarkNextChange(),ue=h,U.AddModifiedElement(h+1,b+1),G=se-1-o),re>=0&&(u=this.m_reverseHistory[re],o=u[0],te=1,J=u.length-1)}while(--re>=-1);D=U.getChanges()}return this.ConcatenateChanges(I,D)}ComputeRecursionPoint(e,r,n,i,o,a,s){let c=0,l=0,u=0,h=0,f=0,p=0;e--,n--,o[0]=0,a[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];const b=r-e+(i-n),w=b+1,y=new Int32Array(w),x=new Int32Array(w),S=i-n,I=r-e,D=e-n,U=r-i,J=(I-S)%2==0;y[S]=e,x[I]=r,s[0]=!1;for(let G=1;G<=b/2+1;G++){let ue=0,re=0;u=this.ClipDiagonalBound(S-G,G,S,w),h=this.ClipDiagonalBound(S+G,G,S,w);for(let xe=u;xe<=h;xe+=2){xe===u||xe<h&&y[xe-1]<y[xe+1]?c=y[xe+1]:c=y[xe-1]+1,l=c-(xe-S)-D;const dt=c;for(;c<r&&l<i&&this.ElementsAreEqual(c+1,l+1);)c++,l++;if(y[xe]=c,c+l>ue+re&&(ue=c,re=l),!J&&Math.abs(xe-I)<=G-1&&c>=x[xe])return o[0]=c,a[0]=l,dt<=x[xe]&&1447>0&&G<=1447+1?this.WALKTRACE(S,u,h,D,I,f,p,U,y,x,c,r,o,l,i,a,J,s):null}const se=(ue-e+(re-n)-G)/2;if(this.ContinueProcessingPredicate!==null&&!this.ContinueProcessingPredicate(ue,se))return s[0]=!0,o[0]=ue,a[0]=re,se>0&&1447>0&&G<=1447+1?this.WALKTRACE(S,u,h,D,I,f,p,U,y,x,c,r,o,l,i,a,J,s):(e++,n++,[new Ni(e,r-e+1,n,i-n+1)]);f=this.ClipDiagonalBound(I-G,G,I,w),p=this.ClipDiagonalBound(I+G,G,I,w);for(let xe=f;xe<=p;xe+=2){xe===f||xe<p&&x[xe-1]>=x[xe+1]?c=x[xe+1]-1:c=x[xe-1],l=c-(xe-I)-U;const dt=c;for(;c>e&&l>n&&this.ElementsAreEqual(c,l);)c--,l--;if(x[xe]=c,J&&Math.abs(xe-S)<=G&&c<=y[xe])return o[0]=c,a[0]=l,dt>=y[xe]&&1447>0&&G<=1447+1?this.WALKTRACE(S,u,h,D,I,f,p,U,y,x,c,r,o,l,i,a,J,s):null}if(G<=1447){let xe=new Int32Array(h-u+2);xe[0]=S-u+1,pa.Copy2(y,u,xe,1,h-u+1),this.m_forwardHistory.push(xe),xe=new Int32Array(p-f+2),xe[0]=I-f+1,pa.Copy2(x,f,xe,1,p-f+1),this.m_reverseHistory.push(xe)}}return this.WALKTRACE(S,u,h,D,I,f,p,U,y,x,c,r,o,l,i,a,J,s)}PrettifyChanges(e){for(let r=0;r<e.length;r++){const n=e[r],i=r<e.length-1?e[r+1].originalStart:this._originalElementsOrHash.length,o=r<e.length-1?e[r+1].modifiedStart:this._modifiedElementsOrHash.length,a=n.originalLength>0,s=n.modifiedLength>0;for(;n.originalStart+n.originalLength<i&&n.modifiedStart+n.modifiedLength<o&&(!a||this.OriginalElementsAreEqual(n.originalStart,n.originalStart+n.originalLength))&&(!s||this.ModifiedElementsAreEqual(n.modifiedStart,n.modifiedStart+n.modifiedLength));){const l=this.ElementsAreStrictEqual(n.originalStart,n.modifiedStart);if(this.ElementsAreStrictEqual(n.originalStart+n.originalLength,n.modifiedStart+n.modifiedLength)&&!l)break;n.originalStart++,n.modifiedStart++}let c=[null];if(r<e.length-1&&this.ChangesOverlap(e[r],e[r+1],c)){e[r]=c[0],e.splice(r+1,1),r--;continue}}for(let r=e.length-1;r>=0;r--){const n=e[r];let i=0,o=0;if(r>0){const h=e[r-1];i=h.originalStart+h.originalLength,o=h.modifiedStart+h.modifiedLength}const a=n.originalLength>0,s=n.modifiedLength>0;let c=0,l=this._boundaryScore(n.originalStart,n.originalLength,n.modifiedStart,n.modifiedLength);for(let h=1;;h++){const f=n.originalStart-h,p=n.modifiedStart-h;if(f<i||p<o||a&&!this.OriginalElementsAreEqual(f,f+n.originalLength)||s&&!this.ModifiedElementsAreEqual(p,p+n.modifiedLength))break;const w=(f===i&&p===o?5:0)+this._boundaryScore(f,n.originalLength,p,n.modifiedLength);w>l&&(l=w,c=h)}n.originalStart-=c,n.modifiedStart-=c;const u=[null];if(r>0&&this.ChangesOverlap(e[r-1],e[r],u)){e[r-1]=u[0],e.splice(r,1),r++;continue}}if(this._hasStrings)for(let r=1,n=e.length;r<n;r++){const i=e[r-1],o=e[r],a=o.originalStart-i.originalStart-i.originalLength,s=i.originalStart,c=o.originalStart+o.originalLength,l=c-s,u=i.modifiedStart,h=o.modifiedStart+o.modifiedLength,f=h-u;if(a<5&&l<20&&f<20){const p=this._findBetterContiguousSequence(s,l,u,f,a);if(p){const[b,w]=p;(b!==i.originalStart+i.originalLength||w!==i.modifiedStart+i.modifiedLength)&&(i.originalLength=b-i.originalStart,i.modifiedLength=w-i.modifiedStart,o.originalStart=b+a,o.modifiedStart=w+a,o.originalLength=c-o.originalStart,o.modifiedLength=h-o.modifiedStart)}}}return e}_findBetterContiguousSequence(e,r,n,i,o){if(r<o||i<o)return null;const a=e+r-o+1,s=n+i-o+1;let c=0,l=0,u=0;for(let h=e;h<a;h++)for(let f=n;f<s;f++){const p=this._contiguousSequenceScore(h,f,o);p>0&&p>c&&(c=p,l=h,u=f)}return c>0?[l,u]:null}_contiguousSequenceScore(e,r,n){let i=0;for(let o=0;o<n;o++){if(!this.ElementsAreEqual(e+o,r+o))return 0;i+=this._originalStringElements[e+o].length}return i}_OriginalIsBoundary(e){return e<=0||e>=this._originalElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._originalStringElements[e])}_OriginalRegionIsBoundary(e,r){if(this._OriginalIsBoundary(e)||this._OriginalIsBoundary(e-1))return!0;if(r>0){const n=e+r;if(this._OriginalIsBoundary(n-1)||this._OriginalIsBoundary(n))return!0}return!1}_ModifiedIsBoundary(e){return e<=0||e>=this._modifiedElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._modifiedStringElements[e])}_ModifiedRegionIsBoundary(e,r){if(this._ModifiedIsBoundary(e)||this._ModifiedIsBoundary(e-1))return!0;if(r>0){const n=e+r;if(this._ModifiedIsBoundary(n-1)||this._ModifiedIsBoundary(n))return!0}return!1}_boundaryScore(e,r,n,i){const o=this._OriginalRegionIsBoundary(e,r)?1:0,a=this._ModifiedRegionIsBoundary(n,i)?1:0;return o+a}ConcatenateChanges(e,r){let n=[];if(e.length===0||r.length===0)return r.length>0?r:e;if(this.ChangesOverlap(e[e.length-1],r[0],n)){const i=new Array(e.length+r.length-1);return pa.Copy(e,0,i,0,e.length-1),i[e.length-1]=n[0],pa.Copy(r,1,i,e.length,r.length-1),i}else{const i=new Array(e.length+r.length);return pa.Copy(e,0,i,0,e.length),pa.Copy(r,0,i,e.length,r.length),i}}ChangesOverlap(e,r,n){if(fa.Assert(e.originalStart<=r.originalStart,"Left change is not less than or equal to right change"),fa.Assert(e.modifiedStart<=r.modifiedStart,"Left change is not less than or equal to right change"),e.originalStart+e.originalLength>=r.originalStart||e.modifiedStart+e.modifiedLength>=r.modifiedStart){const i=e.originalStart;let o=e.originalLength;const a=e.modifiedStart;let s=e.modifiedLength;return e.originalStart+e.originalLength>=r.originalStart&&(o=r.originalStart+r.originalLength-e.originalStart),e.modifiedStart+e.modifiedLength>=r.modifiedStart&&(s=r.modifiedStart+r.modifiedLength-e.modifiedStart),n[0]=new Ni(i,o,a,s),!0}else return n[0]=null,!1}ClipDiagonalBound(e,r,n,i){if(e>=0&&e<i)return e;const o=n,a=i-n-1,s=r%2==0;if(e<0){const c=o%2==0;return s===c?0:1}else{const c=a%2==0;return s===c?i-1:i-2}}}var zh;(function(t){function e(n,i){return n instanceof As?i:new d.Position(i.line,i.character)}t.makePosition=e;function r(n,i){return n instanceof As?i:new d.Range(i.start.line,i.start.character,i.end.line,i.end.character)}t.makeRange=r})(zh||(zh={}));var v0;(function(t){t[t.index2code=1]="index2code",t[t.code2Index=2]="code2Index"})(v0||(v0={}));const w0=class{constructor(t,e,r,n){this.diffCache=new Fi(32),this.indexDocumentCache=new Fi(32),this.codeDocumentCache=new Fi(32),this.providerService=t,this.rootUri=e,this.index=r,this.code=n,this.changes=this.computeChanges()}async computeChanges(){if(this.index===this.code)return new Map;const t=await this.providerService.compareCommits(this.rootUri,{base:this.index,compare:this.code});return t===void 0?new Map:new Map(t.map(e=>[e.uri.toString(),e.type]))}async needsMapping(t){const e=t.uri;if(!e.toString().startsWith(this.rootUri.toString()))return!1;if((await this.changes).get(e.toString())!==void 0)return!0;const i=await this.getIndexDocument(e);return i===void 0?!0:this.getDiff(1,i,t).length!==0}async mapPositionFromCodeToIndex(t,e){const r=t.uri;if(!r.toString().startsWith(this.rootUri.toString()))return;const i=(await this.changes).get(r.toString());if(i===rt.Created||i===rt.Deleted)return;const o=await this.getIndexDocument(r);if(o===void 0)return;const a=this.getDiff(2,o,t);if(a.length===0)return e;const s=t.offsetAt(new d.Position(e.line,e.character));let c=s;for(const f of a){if(f.modifiedStart<=s&&s<f.modifiedStart+f.modifiedLength)return;if(c<f.modifiedStart)break;c=c-(f.modifiedLength-f.originalLength)}const l=o.positionAt(c),u=this.getWordAtOffset(o.lineAt(l.line).text,l.character),h=this.getWordAtOffset(t.lineAt(e.line).text,e.character);if(!(u===void 0||h===void 0||u!==h))return new d.Position(l.line,l.character)}async mapRangeFromIndexToCode(t,e){const r=t instanceof d.Uri?t:t.uri;if(!r.toString().startsWith(this.rootUri.toString()))return;const i=(await this.changes).get(r.toString());if(i===rt.Created||i===rt.Deleted)return;const[o,a]=await Promise.all([this.getIndexDocument(r),this.getCodeDocument(t)]);if(o===void 0||a===void 0)return;const s=this.getDiff(1,o,a);if(s.length===0)return e;const c=o.offsetAt(e.start);let l=c;const u=o.offsetAt(e.end);let h=u;for(const y of s){if(h<y.originalStart)break;const x=y.modifiedLength-y.originalLength;if(y.originalStart<=c){if(c<y.originalStart+y.originalLength)return;l+=x}else if(u<y.originalStart+y.originalLength)return;if(y.originalStart<=u){if(u<y.originalStart+y.originalLength)return;h+=x}}const f=a.positionAt(l),p=a.positionAt(h),b=o.getText(e),w=a.getText(zh.makeRange(a,{start:f,end:p}));if(b===w)return new d.Range(f.line,f.character,p.line,p.character)}async getIndexDocument(t){return this.getDocument(this.indexDocumentCache,t,this.index)}async getCodeDocument(t){return t instanceof d.Uri?this.getDocument(this.codeDocumentCache,t,this.code):t}async getDocument(t,e,r){let n=t.get(e.toString());if(n!==null)return n!==void 0||(n=this._getDocument(e,r),t.set(e.toString(),n),n.then(i=>{i===void 0&&t.set(e.toString(),null)},void 0)),n}async _getDocument(t,e){const r=t.toString().substr(this.rootUri.toString().length);return this.providerService.getFileContent(this.rootUri,e,r).then(n=>new As(t,Number.MAX_VALUE,w0.textDecoder.decode(n)),()=>{})}getDiff(t,e,r){if(e.uri.toString()!==r.uri.toString())throw new Error(`Original (${e.uri.toString()}) and modified (${r.uri.toString()}) are pointing to a different document`);const n=`${t}${e.uri.toString()}`;let i=this.diffCache.get(n);return i!==void 0&&i.original===e.version&&i.modified===r.version||(i={original:e.version,modified:r.version,changes:_R(e.getText(),r.getText(),!0)},this.diffCache.set(n,i)),i.changes}getWordAtOffset(t,e){let r="findStart",n=0,i=t.length,o=0;for(;o<t.length&&r!=="endFound";){switch(o===e&&(r="findEnd"),t[o]){case" ":case"	":case"(":case")":case"[":case"]":case"{":case"}":case"'":case'"':case"`":switch(r){case"findStart":n=o+1;break;case"findEnd":i=o,r="endFound";break}break}o++}return r==="endFound"?t.substring(n,i):void 0}};let y0=w0;y0.textDecoder=new TextDecoder("utf8");var b0;(function(t){t[t.LineFeed=10]="LineFeed",t[t.CarriageReturn=13]="CarriageReturn"})(b0||(b0={}));class As{static computeLineOffsets(e,r,n=0){const i=r?[n]:[];for(let o=0;o<e.length;o++){const a=e.charCodeAt(o);(a===13||a===10)&&(a===13&&o+1<e.length&&e.charCodeAt(o+1)===10&&o++,i.push(n+o+1))}return i}constructor(e,r,n){this._content=n,this.uri=e,this.version=r,this._lineOffsets=void 0}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=As.computeLineOffsets(this._content,!0)),this._lineOffsets}getText(e){if(e){const r=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(r,n)}return this._content}lineAt(e){const r=this.getLineOffsets();if(e>=r.length)return{lineNumber:e,text:""};const n=r[e],i=r[e+1];if(i===void 0)return{lineNumber:e,text:this._content.substring(n)};const o=this._content.substring(n,i);let a=o.length-1;for(;a>=0&&(o[a]===`
`||o[a]==="\r");)a--;return{lineNumber:e,text:o.substr(0,a+1)}}positionAt(e){e=Math.max(Math.min(e,this._content.length),0);const r=this.getLineOffsets();let n=0,i=r.length;if(i===0)return{line:0,character:e};for(;n<i;){const a=Math.floor((n+i)/2);r[a]>e?i=a:n=a+1}const o=n-1;return{line:o,character:e-r[o]}}offsetAt(e){const r=this.getLineOffsets();if(e.line>=r.length)return this._content.length;if(e.line<0)return 0;const n=r[e.line],i=e.line+1<r.length?r[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)}get lineCount(){return this.getLineOffsets().length}}var _0;(function(t){t.MIN_VALUE=-2147483648,t.MAX_VALUE=2147483647})(_0||(_0={}));var Dl;(function(t){t.MIN_VALUE=0,t.MAX_VALUE=2147483647})(Dl||(Dl={}));var Bn;(function(t){function e(n,i){return n===Number.MAX_VALUE&&(n=Dl.MAX_VALUE),i===Number.MAX_VALUE&&(i=Dl.MAX_VALUE),{line:n,character:i}}t.create=e;function r(n){var i=n;return le.objectLiteral(i)&&le.uinteger(i.line)&&le.uinteger(i.character)}t.is=r})(Bn||(Bn={}));var xr;(function(t){function e(n,i,o,a){if(le.uinteger(n)&&le.uinteger(i)&&le.uinteger(o)&&le.uinteger(a))return{start:Bn.create(n,i),end:Bn.create(o,a)};if(Bn.is(n)&&Bn.is(i))return{start:n,end:i};throw new Error("Range#create called with invalid arguments["+n+", "+i+", "+o+", "+a+"]")}t.create=e;function r(n){var i=n;return le.objectLiteral(i)&&Bn.is(i.start)&&Bn.is(i.end)}t.is=r})(xr||(xr={}));var jh;(function(t){function e(n,i){return{uri:n,range:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&xr.is(i.range)&&(le.string(i.uri)||le.undefined(i.uri))}t.is=r})(jh||(jh={}));var Pl;(function(t){function e(n,i,o,a){return{targetUri:n,targetRange:i,targetSelectionRange:o,originSelectionRange:a}}t.create=e;function r(n){var i=n;return le.defined(i)&&xr.is(i.targetRange)&&le.string(i.targetUri)&&(xr.is(i.targetSelectionRange)||le.undefined(i.targetSelectionRange))&&(xr.is(i.originSelectionRange)||le.undefined(i.originSelectionRange))}t.is=r})(Pl||(Pl={}));var Vh;(function(t){function e(n,i,o,a){return{red:n,green:i,blue:o,alpha:a}}t.create=e;function r(n){var i=n;return le.numberRange(i.red,0,1)&&le.numberRange(i.green,0,1)&&le.numberRange(i.blue,0,1)&&le.numberRange(i.alpha,0,1)}t.is=r})(Vh||(Vh={}));var x0;(function(t){function e(n,i){return{range:n,color:i}}t.create=e;function r(n){var i=n;return xr.is(i.range)&&Vh.is(i.color)}t.is=r})(x0||(x0={}));var S0;(function(t){function e(n,i,o){return{label:n,textEdit:i,additionalTextEdits:o}}t.create=e;function r(n){var i=n;return le.string(i.label)&&(le.undefined(i.textEdit)||$i.is(i))&&(le.undefined(i.additionalTextEdits)||le.typedArray(i.additionalTextEdits,$i.is))}t.is=r})(S0||(S0={}));var ks;(function(t){t.Comment="comment",t.Imports="imports",t.Region="region"})(ks||(ks={}));var C0;(function(t){function e(n,i,o,a,s){var c={startLine:n,endLine:i};return le.defined(o)&&(c.startCharacter=o),le.defined(a)&&(c.endCharacter=a),le.defined(s)&&(c.kind=s),c}t.create=e;function r(n){var i=n;return le.uinteger(i.startLine)&&le.uinteger(i.startLine)&&(le.undefined(i.startCharacter)||le.uinteger(i.startCharacter))&&(le.undefined(i.endCharacter)||le.uinteger(i.endCharacter))&&(le.undefined(i.kind)||le.string(i.kind))}t.is=r})(C0||(C0={}));var Gh;(function(t){function e(n,i){return{location:n,message:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&jh.is(i.location)&&le.string(i.message)}t.is=r})(Gh||(Gh={}));var ga;(function(t){t.Error=1,t.Warning=2,t.Information=3,t.Hint=4})(ga||(ga={}));var Fl;(function(t){t.Unnecessary=1,t.Deprecated=2})(Fl||(Fl={}));var Kh;(function(t){function e(r){var n=r;return n!=null&&le.string(n.href)}t.is=e})(Kh||(Kh={}));var Nl;(function(t){function e(n,i,o,a,s,c){var l={range:n,message:i};return le.defined(o)&&(l.severity=o),le.defined(a)&&(l.code=a),le.defined(s)&&(l.source=s),le.defined(c)&&(l.relatedInformation=c),l}t.create=e;function r(n){var i,o=n;return le.defined(o)&&xr.is(o.range)&&le.string(o.message)&&(le.number(o.severity)||le.undefined(o.severity))&&(le.integer(o.code)||le.string(o.code)||le.undefined(o.code))&&(le.undefined(o.codeDescription)||le.string((i=o.codeDescription)===null||i===void 0?void 0:i.href))&&(le.string(o.source)||le.undefined(o.source))&&(le.undefined(o.relatedInformation)||le.typedArray(o.relatedInformation,Gh.is))}t.is=r})(Nl||(Nl={}));var Is;(function(t){function e(n,i){for(var o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];var s={title:n,command:i};return le.defined(o)&&o.length>0&&(s.arguments=o),s}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.title)&&le.string(i.command)}t.is=r})(Is||(Is={}));var $i;(function(t){function e(o,a){return{range:o,newText:a}}t.replace=e;function r(o,a){return{range:{start:o,end:o},newText:a}}t.insert=r;function n(o){return{range:o,newText:""}}t.del=n;function i(o){var a=o;return le.objectLiteral(a)&&le.string(a.newText)&&xr.is(a.range)}t.is=i})($i||($i={}));var ma;(function(t){function e(n,i,o){var a={label:n};return i!==void 0&&(a.needsConfirmation=i),o!==void 0&&(a.description=o),a}t.create=e;function r(n){var i=n;return i!==void 0&&le.objectLiteral(i)&&le.string(i.label)&&(le.boolean(i.needsConfirmation)||i.needsConfirmation===void 0)&&(le.string(i.description)||i.description===void 0)}t.is=r})(ma||(ma={}));var Dr;(function(t){function e(r){var n=r;return typeof n=="string"}t.is=e})(Dr||(Dr={}));var Mi;(function(t){function e(o,a,s){return{range:o,newText:a,annotationId:s}}t.replace=e;function r(o,a,s){return{range:{start:o,end:o},newText:a,annotationId:s}}t.insert=r;function n(o,a){return{range:o,newText:"",annotationId:a}}t.del=n;function i(o){var a=o;return $i.is(a)&&(ma.is(a.annotationId)||Dr.is(a.annotationId))}t.is=i})(Mi||(Mi={}));var Ds;(function(t){function e(n,i){return{textDocument:n,edits:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&Ml.is(i.textDocument)&&Array.isArray(i.edits)}t.is=r})(Ds||(Ds={}));var va;(function(t){function e(n,i,o){var a={kind:"create",uri:n};return i!==void 0&&(i.overwrite!==void 0||i.ignoreIfExists!==void 0)&&(a.options=i),o!==void 0&&(a.annotationId=o),a}t.create=e;function r(n){var i=n;return i&&i.kind==="create"&&le.string(i.uri)&&(i.options===void 0||(i.options.overwrite===void 0||le.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||le.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||Dr.is(i.annotationId))}t.is=r})(va||(va={}));var wa;(function(t){function e(n,i,o,a){var s={kind:"rename",oldUri:n,newUri:i};return o!==void 0&&(o.overwrite!==void 0||o.ignoreIfExists!==void 0)&&(s.options=o),a!==void 0&&(s.annotationId=a),s}t.create=e;function r(n){var i=n;return i&&i.kind==="rename"&&le.string(i.oldUri)&&le.string(i.newUri)&&(i.options===void 0||(i.options.overwrite===void 0||le.boolean(i.options.overwrite))&&(i.options.ignoreIfExists===void 0||le.boolean(i.options.ignoreIfExists)))&&(i.annotationId===void 0||Dr.is(i.annotationId))}t.is=r})(wa||(wa={}));var ya;(function(t){function e(n,i,o){var a={kind:"delete",uri:n};return i!==void 0&&(i.recursive!==void 0||i.ignoreIfNotExists!==void 0)&&(a.options=i),o!==void 0&&(a.annotationId=o),a}t.create=e;function r(n){var i=n;return i&&i.kind==="delete"&&le.string(i.uri)&&(i.options===void 0||(i.options.recursive===void 0||le.boolean(i.options.recursive))&&(i.options.ignoreIfNotExists===void 0||le.boolean(i.options.ignoreIfNotExists)))&&(i.annotationId===void 0||Dr.is(i.annotationId))}t.is=r})(ya||(ya={}));var Zh;(function(t){function e(r){var n=r;return n&&(n.changes!==void 0||n.documentChanges!==void 0)&&(n.documentChanges===void 0||n.documentChanges.every(function(i){return le.string(i.kind)?va.is(i)||wa.is(i)||ya.is(i):Ds.is(i)}))}t.is=e})(Zh||(Zh={}));var $l=function(){function t(e,r){this.edits=e,this.changeAnnotations=r}return t.prototype.insert=function(e,r,n){var i,o;if(n===void 0?i=$i.insert(e,r):Dr.is(n)?(o=n,i=Mi.insert(e,r,n)):(this.assertChangeAnnotations(this.changeAnnotations),o=this.changeAnnotations.manage(n),i=Mi.insert(e,r,o)),this.edits.push(i),o!==void 0)return o},t.prototype.replace=function(e,r,n){var i,o;if(n===void 0?i=$i.replace(e,r):Dr.is(n)?(o=n,i=Mi.replace(e,r,n)):(this.assertChangeAnnotations(this.changeAnnotations),o=this.changeAnnotations.manage(n),i=Mi.replace(e,r,o)),this.edits.push(i),o!==void 0)return o},t.prototype.delete=function(e,r){var n,i;if(r===void 0?n=$i.del(e):Dr.is(r)?(i=r,n=Mi.del(e,r)):(this.assertChangeAnnotations(this.changeAnnotations),i=this.changeAnnotations.manage(r),n=Mi.del(e,i)),this.edits.push(n),i!==void 0)return i},t.prototype.add=function(e){this.edits.push(e)},t.prototype.all=function(){return this.edits},t.prototype.clear=function(){this.edits.splice(0,this.edits.length)},t.prototype.assertChangeAnnotations=function(e){if(e===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},t}(),E0=function(){function t(e){this._annotations=e===void 0?Object.create(null):e,this._counter=0,this._size=0}return t.prototype.all=function(){return this._annotations},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.manage=function(e,r){var n;if(Dr.is(e)?n=e:(n=this.nextId(),r=e),this._annotations[n]!==void 0)throw new Error("Id "+n+" is already in use.");if(r===void 0)throw new Error("No annotation provided for id "+n);return this._annotations[n]=r,this._size++,n},t.prototype.nextId=function(){return this._counter++,this._counter.toString()},t}(),ED=function(){function t(e){var r=this;this._textEditChanges=Object.create(null),e!==void 0?(this._workspaceEdit=e,e.documentChanges?(this._changeAnnotations=new E0(e.changeAnnotations),e.changeAnnotations=this._changeAnnotations.all(),e.documentChanges.forEach(function(n){if(Ds.is(n)){var i=new $l(n.edits,r._changeAnnotations);r._textEditChanges[n.textDocument.uri]=i}})):e.changes&&Object.keys(e.changes).forEach(function(n){var i=new $l(e.changes[n]);r._textEditChanges[n]=i})):this._workspaceEdit={}}return Object.defineProperty(t.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),t.prototype.getTextEditChange=function(e){if(Ml.is(e)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var r={uri:e.uri,version:e.version},n=this._textEditChanges[r.uri];if(!n){var i=[],o={textDocument:r,edits:i};this._workspaceEdit.documentChanges.push(o),n=new $l(i,this._changeAnnotations),this._textEditChanges[r.uri]=n}return n}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var n=this._textEditChanges[e];if(!n){var i=[];this._workspaceEdit.changes[e]=i,n=new $l(i),this._textEditChanges[e]=n}return n}},t.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new E0,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},t.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},t.prototype.createFile=function(e,r,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var i;ma.is(r)||Dr.is(r)?i=r:n=r;var o,a;if(i===void 0?o=va.create(e,n):(a=Dr.is(i)?i:this._changeAnnotations.manage(i),o=va.create(e,n,a)),this._workspaceEdit.documentChanges.push(o),a!==void 0)return a},t.prototype.renameFile=function(e,r,n,i){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var o;ma.is(n)||Dr.is(n)?o=n:i=n;var a,s;if(o===void 0?a=wa.create(e,r,i):(s=Dr.is(o)?o:this._changeAnnotations.manage(o),a=wa.create(e,r,i,s)),this._workspaceEdit.documentChanges.push(a),s!==void 0)return s},t.prototype.deleteFile=function(e,r,n){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var i;ma.is(r)||Dr.is(r)?i=r:n=r;var o,a;if(i===void 0?o=ya.create(e,n):(a=Dr.is(i)?i:this._changeAnnotations.manage(i),o=ya.create(e,n,a)),this._workspaceEdit.documentChanges.push(o),a!==void 0)return a},t}(),R0;(function(t){function e(n){return{uri:n}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.uri)}t.is=r})(R0||(R0={}));var T0;(function(t){function e(n,i){return{uri:n,version:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.uri)&&le.integer(i.version)}t.is=r})(T0||(T0={}));var Ml;(function(t){function e(n,i){return{uri:n,version:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.uri)&&(i.version===null||le.integer(i.version))}t.is=r})(Ml||(Ml={}));var A0;(function(t){function e(n,i,o,a){return{uri:n,languageId:i,version:o,text:a}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.string(i.uri)&&le.string(i.languageId)&&le.integer(i.version)&&le.string(i.text)}t.is=r})(A0||(A0={}));var hi;(function(t){t.PlainText="plaintext",t.Markdown="markdown"})(hi||(hi={})),function(t){function e(r){var n=r;return n===t.PlainText||n===t.Markdown}t.is=e}(hi||(hi={}));var Xh;(function(t){function e(r){var n=r;return le.objectLiteral(r)&&hi.is(n.kind)&&le.string(n.value)}t.is=e})(Xh||(Xh={}));var k0;(function(t){t.Text=1,t.Method=2,t.Function=3,t.Constructor=4,t.Field=5,t.Variable=6,t.Class=7,t.Interface=8,t.Module=9,t.Property=10,t.Unit=11,t.Value=12,t.Enum=13,t.Keyword=14,t.Snippet=15,t.Color=16,t.File=17,t.Reference=18,t.Folder=19,t.EnumMember=20,t.Constant=21,t.Struct=22,t.Event=23,t.Operator=24,t.TypeParameter=25})(k0||(k0={}));var I0;(function(t){t.PlainText=1,t.Snippet=2})(I0||(I0={}));var D0;(function(t){t.Deprecated=1})(D0||(D0={}));var P0;(function(t){function e(n,i,o){return{newText:n,insert:i,replace:o}}t.create=e;function r(n){var i=n;return i&&le.string(i.newText)&&xr.is(i.insert)&&xr.is(i.replace)}t.is=r})(P0||(P0={}));var F0;(function(t){t.asIs=1,t.adjustIndentation=2})(F0||(F0={}));var N0;(function(t){function e(r){return{label:r}}t.create=e})(N0||(N0={}));var $0;(function(t){function e(r,n){return{items:r||[],isIncomplete:!!n}}t.create=e})($0||($0={}));var Bl;(function(t){function e(n){return n.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}t.fromPlainText=e;function r(n){var i=n;return le.string(i)||le.objectLiteral(i)&&le.string(i.language)&&le.string(i.value)}t.is=r})(Bl||(Bl={}));var M0;(function(t){function e(r){var n=r;return!!n&&le.objectLiteral(n)&&(Xh.is(n.contents)||Bl.is(n.contents)||le.typedArray(n.contents,Bl.is))&&(r.range===void 0||xr.is(r.range))}t.is=e})(M0||(M0={}));var B0;(function(t){function e(r,n){return n?{label:r,documentation:n}:{label:r}}t.create=e})(B0||(B0={}));var O0;(function(t){function e(r,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var a={label:r};return le.defined(n)&&(a.documentation=n),le.defined(i)?a.parameters=i:a.parameters=[],a}t.create=e})(O0||(O0={}));var Ps;(function(t){t.Text=1,t.Read=2,t.Write=3})(Ps||(Ps={}));var U0;(function(t){function e(r,n){var i={range:r};return le.number(n)&&(i.kind=n),i}t.create=e})(U0||(U0={}));var Qh;(function(t){t.File=1,t.Module=2,t.Namespace=3,t.Package=4,t.Class=5,t.Method=6,t.Property=7,t.Field=8,t.Constructor=9,t.Enum=10,t.Interface=11,t.Function=12,t.Variable=13,t.Constant=14,t.String=15,t.Number=16,t.Boolean=17,t.Array=18,t.Object=19,t.Key=20,t.Null=21,t.EnumMember=22,t.Struct=23,t.Event=24,t.Operator=25,t.TypeParameter=26})(Qh||(Qh={}));var Yh;(function(t){t.Deprecated=1})(Yh||(Yh={}));var L0;(function(t){function e(r,n,i,o,a){var s={name:r,kind:n,location:{uri:o,range:i}};return a&&(s.containerName=a),s}t.create=e})(L0||(L0={}));var H0;(function(t){function e(n,i,o,a,s,c){var l={name:n,detail:i,kind:o,range:a,selectionRange:s};return c!==void 0&&(l.children=c),l}t.create=e;function r(n){var i=n;return i&&le.string(i.name)&&le.number(i.kind)&&xr.is(i.range)&&xr.is(i.selectionRange)&&(i.detail===void 0||le.string(i.detail))&&(i.deprecated===void 0||le.boolean(i.deprecated))&&(i.children===void 0||Array.isArray(i.children))&&(i.tags===void 0||Array.isArray(i.tags))}t.is=r})(H0||(H0={}));var On;(function(t){t.Empty="",t.QuickFix="quickfix",t.Refactor="refactor",t.RefactorExtract="refactor.extract",t.RefactorInline="refactor.inline",t.RefactorRewrite="refactor.rewrite",t.Source="source",t.SourceOrganizeImports="source.organizeImports",t.SourceFixAll="source.fixAll"})(On||(On={}));var q0;(function(t){function e(n,i){var o={diagnostics:n};return i!=null&&(o.only=i),o}t.create=e;function r(n){var i=n;return le.defined(i)&&le.typedArray(i.diagnostics,Nl.is)&&(i.only===void 0||le.typedArray(i.only,le.string))}t.is=r})(q0||(q0={}));var W0;(function(t){function e(n,i,o){var a={title:n},s=!0;return typeof i=="string"?(s=!1,a.kind=i):Is.is(i)?a.command=i:a.edit=i,s&&o!==void 0&&(a.kind=o),a}t.create=e;function r(n){var i=n;return i&&le.string(i.title)&&(i.diagnostics===void 0||le.typedArray(i.diagnostics,Nl.is))&&(i.kind===void 0||le.string(i.kind))&&(i.edit!==void 0||i.command!==void 0)&&(i.command===void 0||Is.is(i.command))&&(i.isPreferred===void 0||le.boolean(i.isPreferred))&&(i.edit===void 0||Zh.is(i.edit))}t.is=r})(W0||(W0={}));var z0;(function(t){function e(n,i){var o={range:n};return le.defined(i)&&(o.data=i),o}t.create=e;function r(n){var i=n;return le.defined(i)&&xr.is(i.range)&&(le.undefined(i.command)||Is.is(i.command))}t.is=r})(z0||(z0={}));var j0;(function(t){function e(n,i){return{tabSize:n,insertSpaces:i}}t.create=e;function r(n){var i=n;return le.defined(i)&&le.uinteger(i.tabSize)&&le.boolean(i.insertSpaces)}t.is=r})(j0||(j0={}));var V0;(function(t){function e(n,i,o){return{range:n,target:i,data:o}}t.create=e;function r(n){var i=n;return le.defined(i)&&xr.is(i.range)&&(le.undefined(i.target)||le.string(i.target))}t.is=r})(V0||(V0={}));var G0;(function(t){function e(n,i){return{range:n,parent:i}}t.create=e;function r(n){var i=n;return i!==void 0&&xr.is(i.range)&&(i.parent===void 0||t.is(i.parent))}t.is=r})(G0||(G0={}));var RD=null,K0;(function(t){function e(o,a,s,c){return new SR(o,a,s,c)}t.create=e;function r(o){var a=o;return!!(le.defined(a)&&le.string(a.uri)&&(le.undefined(a.languageId)||le.string(a.languageId))&&le.uinteger(a.lineCount)&&le.func(a.getText)&&le.func(a.positionAt)&&le.func(a.offsetAt))}t.is=r;function n(o,a){for(var s=o.getText(),c=i(a,function(b,w){var y=b.range.start.line-w.range.start.line;return y===0?b.range.start.character-w.range.start.character:y}),l=s.length,u=c.length-1;u>=0;u--){var h=c[u],f=o.offsetAt(h.range.start),p=o.offsetAt(h.range.end);if(p<=l)s=s.substring(0,f)+h.newText+s.substring(p,s.length);else throw new Error("Overlapping edit");l=f}return s}t.applyEdits=n;function i(o,a){if(o.length<=1)return o;var s=o.length/2|0,c=o.slice(0,s),l=o.slice(s);i(c,a),i(l,a);for(var u=0,h=0,f=0;u<c.length&&h<l.length;){var p=a(c[u],l[h]);p<=0?o[f++]=c[u++]:o[f++]=l[h++]}for(;u<c.length;)o[f++]=c[u++];for(;h<l.length;)o[f++]=l[h++];return o}})(K0||(K0={}));var SR=function(){function t(e,r,n,i){this._uri=e,this._languageId=r,this._version=n,this._content=i,this._lineOffsets=void 0}return Object.defineProperty(t.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),t.prototype.getText=function(e){if(e){var r=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(r,n)}return this._content},t.prototype.update=function(e,r){this._content=e.text,this._version=r,this._lineOffsets=void 0},t.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var e=[],r=this._content,n=!0,i=0;i<r.length;i++){n&&(e.push(i),n=!1);var o=r.charAt(i);n=o==="\r"||o===`
`,o==="\r"&&i+1<r.length&&r.charAt(i+1)===`
`&&i++}n&&r.length>0&&e.push(r.length),this._lineOffsets=e}return this._lineOffsets},t.prototype.positionAt=function(e){e=Math.max(Math.min(e,this._content.length),0);var r=this.getLineOffsets(),n=0,i=r.length;if(i===0)return Bn.create(0,e);for(;n<i;){var o=Math.floor((n+i)/2);r[o]>e?i=o:n=o+1}var a=n-1;return Bn.create(a,e-r[a])},t.prototype.offsetAt=function(e){var r=this.getLineOffsets();if(e.line>=r.length)return this._content.length;if(e.line<0)return 0;var n=r[e.line],i=e.line+1<r.length?r[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)},Object.defineProperty(t.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),t}(),le;(function(t){var e=Object.prototype.toString;function r(p){return typeof p!="undefined"}t.defined=r;function n(p){return typeof p=="undefined"}t.undefined=n;function i(p){return p===!0||p===!1}t.boolean=i;function o(p){return e.call(p)==="[object String]"}t.string=o;function a(p){return e.call(p)==="[object Number]"}t.number=a;function s(p,b,w){return e.call(p)==="[object Number]"&&b<=p&&p<=w}t.numberRange=s;function c(p){return e.call(p)==="[object Number]"&&-2147483648<=p&&p<=2147483647}t.integer=c;function l(p){return e.call(p)==="[object Number]"&&0<=p&&p<=2147483647}t.uinteger=l;function u(p){return e.call(p)==="[object Function]"}t.func=u;function h(p){return p!==null&&typeof p=="object"}t.objectLiteral=h;function f(p,b){return Array.isArray(p)&&p.every(b)}t.typedArray=f})(le||(le={}));var Fs;(function(t){function e(n){return typeof n=="string"||n instanceof String}t.string=e;function r(n){return typeof n=="number"||n instanceof Number}t.number=r})(Fs||(Fs={}));var Jh;(function(t){function e(r){const n=r;return n!=null&&(Fs.number(n.value)||Fs.string(n.value))&&Fs.string(n.target)}t.is=e})(Jh||(Jh={}));class CR extends d.Diagnostic{constructor(e,r,n,i){super(e,r,n);this.data=i,this.hasDiagnosticCode=!1}}var Un;(function(t){const e=Object.prototype.toString;function r(u){return typeof u!="undefined"}t.defined=r;function n(u){return u===!0||u===!1}t.boolean=n;function i(u){return e.call(u)==="[object String]"}t.string=i;function o(u){return e.call(u)==="[object Number]"}t.number=o;function a(u){return u!==null&&typeof u=="object"}t.objectLiteral=a;function s(u){return Array.isArray(u)}t.array=s;function c(u){return s(u)&&u.every(h=>i(h))}t.stringArray=c;function l(u,h){return Array.isArray(u)&&u.every(h)}t.typedArray=l})(Un||(Un={}));var Ol;(function(t){function e(r){const n=r;return n&&Un.string(n.language)&&Un.string(n.value)}t.is=e})(Ol||(Ol={}));function ER(t){const e=O=>d.Uri.parse(O),r=t!=null?t:e;function n(O){return r(O)}function i(O){return O.map(o)}function o(O){const Ce=new CR(h(O.range),O.message,p(O.severity),O.data);return O.code!==void 0&&(Kh.is(O.codeDescription)?Ce.code={value:O.code,target:n(O.codeDescription.href)}:Jh.is(O.code)?(Ce.hasDiagnosticCode=!0,Ce.code={value:O.code.value,target:n(O.code.target)}):Ce.code=O.code),O.source&&(Ce.source=O.source),O.relatedInformation&&(Ce.relatedInformation=a(O.relatedInformation)),Array.isArray(O.tags)&&(Ce.tags=c(O.tags)),Ce}function a(O){return O.map(s)}function s(O){return new d.DiagnosticRelatedInformation(G(O.location),O.message)}function c(O){if(!O)return;const Ce=[];for(const ut of O){const Cr=l(ut);Cr!==void 0&&Ce.push(Cr)}return Ce.length>0?Ce:void 0}function l(O){switch(O){case Fl.Unnecessary:return d.DiagnosticTag.Unnecessary;case Fl.Deprecated:return d.DiagnosticTag.Deprecated;default:return}}function u(O){if(!!O)return new d.Position(O.line,O.character)}function h(O){if(!!O)return new d.Range(u(O.start),u(O.end))}function f(O){return O.map(Ce=>h(Ce))}function p(O){if(O==null)return d.DiagnosticSeverity.Error;switch(O){case ga.Error:return d.DiagnosticSeverity.Error;case ga.Warning:return d.DiagnosticSeverity.Warning;case ga.Information:return d.DiagnosticSeverity.Information;case ga.Hint:return d.DiagnosticSeverity.Hint}return d.DiagnosticSeverity.Error}function b(O){if(Un.string(O))return new d.MarkdownString(O);if(Ol.is(O))return new d.MarkdownString().appendCodeblock(O.value,O.language);if(Array.isArray(O)){const ut=[];for(const Cr of O){const cc=new d.MarkdownString;Ol.is(Cr)?cc.appendCodeblock(Cr.value,Cr.language):cc.appendMarkdown(Cr),ut.push(cc)}return ut}let Ce;switch(O.kind){case hi.Markdown:return new d.MarkdownString(O.value);case hi.PlainText:return Ce=new d.MarkdownString,Ce.appendText(O.value),Ce;default:return Ce=new d.MarkdownString,Ce.appendText(`Unsupported Markup content received. Kind is: ${O.kind}`),Ce}}function w(O){if(Un.string(O))return O;switch(O.kind){case hi.Markdown:return new d.MarkdownString(O.value);case hi.PlainText:return O.value;default:return`Unsupported Markup content received. Kind is: ${O.kind}`}}function y(O){if(!!O)return new d.Hover(b(O.contents),h(O.range))}function x(O){if(!!O)return new d.TextEdit(h(O.range),O.newText)}function S(O){if(!!O)return O.map(x)}function I(O){if(!O)return;const Ce=new d.SignatureHelp;return Un.number(O.activeSignature)?Ce.activeSignature=O.activeSignature:Ce.activeSignature=0,Un.number(O.activeParameter)?Ce.activeParameter=O.activeParameter:Ce.activeParameter=0,O.signatures&&(Ce.signatures=D(O.signatures)),Ce}function D(O){return O.map(U)}function U(O){const Ce=new d.SignatureInformation(O.label);return O.documentation!==void 0&&(Ce.documentation=w(O.documentation)),O.parameters!==void 0&&(Ce.parameters=te(O.parameters)),O.activeParameter!==void 0&&(Ce.activeParameter=O.activeParameter),Ce}function te(O){return O.map(J)}function J(O){const Ce=new d.ParameterInformation(O.label);return O.documentation&&(Ce.documentation=w(O.documentation)),Ce}function G(O){if(!!O)return new d.Location(r(O.uri),h(O.range))}function ue(O){if(!!O)return xe(O)}function re(O){if(!!O)return xe(O)}function se(O){if(!O)return;const Ce={targetUri:r(O.targetUri),targetRange:h(O.targetSelectionRange),originSelectionRange:h(O.originSelectionRange),targetSelectionRange:h(O.targetSelectionRange)};if(!Ce.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return Ce}function xe(O){if(!!O)return Un.array(O)?O.length===0?[]:Pl.is(O[0])?O.map(Cr=>se(Cr)):O.map(ut=>G(ut)):Pl.is(O)?[se(O)]:G(O)}function dt(O){if(!!O)return O.map(Ce=>G(Ce))}function ne(O){if(!!O)return O.map(Se)}function Se(O){const Ce=new d.DocumentHighlight(h(O.range));return Un.number(O.kind)&&(Ce.kind=ke(O.kind)),Ce}function ke(O){switch(O){case Ps.Text:return d.DocumentHighlightKind.Text;case Ps.Read:return d.DocumentHighlightKind.Read;case Ps.Write:return d.DocumentHighlightKind.Write}return d.DocumentHighlightKind.Text}function Ae(O,Ce){if(!!O)return O.map(ut=>wt(ut,Ce))}function ze(O){return O<=Qh.TypeParameter?O-1:d.SymbolKind.Property}function Ze(O){switch(O){case Yh.Deprecated:return d.SymbolTag.Deprecated;default:return}}function nt(O){if(O==null)return;const Ce=[];for(const ut of O){const Cr=Ze(ut);Cr!==void 0&&Ce.push(Cr)}return Ce.length===0?void 0:Ce}function wt(O,Ce){const ut=new d.SymbolInformation(O.name,ze(O.kind),h(O.location.range),O.location.uri?r(O.location.uri):Ce);return ve(ut,O),O.containerName&&(ut.containerName=O.containerName),ut}function Bt(O){if(O!=null)return O.map(un)}function un(O){var Ce;const ut=new d.DocumentSymbol(O.name,(Ce=O.detail)!=null?Ce:"",ze(O.kind),h(O.range),h(O.selectionRange));if(ve(ut,O),O.children!==void 0&&O.children.length>0){const Cr=[];for(const cc of O.children)Cr.push(un(cc));ut.children=Cr}return ut}function ve(O,Ce){O.tags=nt(Ce.tags),Ce.deprecated&&(O.tags?O.tags.includes(d.SymbolTag.Deprecated)||(O.tags=O.tags.concat(d.SymbolTag.Deprecated)):O.tags=[d.SymbolTag.Deprecated])}function Ie(O){const Ce={title:O.title,command:O.command};return O.arguments&&(Ce.arguments=O.arguments),Ce}function Oe(O){if(!!O)return O.map(Ie)}const Ne=new Map;Ne.set(On.Empty,d.CodeActionKind.Empty),Ne.set(On.QuickFix,d.CodeActionKind.QuickFix),Ne.set(On.Refactor,d.CodeActionKind.Refactor),Ne.set(On.RefactorExtract,d.CodeActionKind.RefactorExtract),Ne.set(On.RefactorInline,d.CodeActionKind.RefactorInline),Ne.set(On.RefactorRewrite,d.CodeActionKind.RefactorRewrite),Ne.set(On.Source,d.CodeActionKind.Source),Ne.set(On.SourceOrganizeImports,d.CodeActionKind.SourceOrganizeImports);function Ve(O){if(O==null)return;let Ce=Ne.get(O);if(Ce)return Ce;const ut=O.split(".");Ce=d.CodeActionKind.Empty;for(const Cr of ut)Ce=Ce.append(Cr);return Ce}function tt(O){if(O!=null)return O.map(Ce=>Ve(Ce))}function et(O){if(O==null)return;const Ce=new d.CodeAction(O.title);return O.kind!==void 0&&(Ce.kind=Ve(O.kind)),O.diagnostics&&(Ce.diagnostics=i(O.diagnostics)),O.edit&&(Ce.edit=yt(O.edit)),O.command&&(Ce.command=Ie(O.command)),O.isPreferred!==void 0&&(Ce.isPreferred=O.isPreferred),Ce}function yt(O){if(!O)return;const Ce=new d.WorkspaceEdit;return O.documentChanges?O.documentChanges.forEach(ut=>{if(va.is(ut))Ce.createFile(r(ut.uri),ut.options);else if(wa.is(ut))Ce.renameFile(r(ut.oldUri),r(ut.newUri),ut.options);else if(ya.is(ut))Ce.deleteFile(r(ut.uri),ut.options);else if(Ds.is(ut))Ce.set(r(ut.textDocument.uri),S(ut.edits));else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(ut,void 0,4)}`)}):O.changes&&Object.keys(O.changes).forEach(ut=>{Ce.set(r(ut),S(O.changes[ut]))}),Ce}function zt(O){return new d.Color(O.red,O.green,O.blue,O.alpha)}function er(O){return new d.ColorInformation(h(O.range),zt(O.color))}function Pr(O){if(Array.isArray(O))return O.map(er)}function wi(O){const Ce=new d.ColorPresentation(O.label);return Ce.additionalTextEdits=S(O.additionalTextEdits),O.textEdit&&(Ce.textEdit=x(O.textEdit)),Ce}function gu(O){if(Array.isArray(O))return O.map(wi)}function Da(O){if(O)switch(O){case ks.Comment:return d.FoldingRangeKind.Comment;case ks.Imports:return d.FoldingRangeKind.Imports;case ks.Region:return d.FoldingRangeKind.Region}}function dn(O){return new d.FoldingRange(O.startLine,O.endLine,Da(O.kind))}function tp(O){if(Array.isArray(O))return O.map(dn)}function rp(O){return new d.SelectionRange(h(O.range),O.parent?rp(O.parent):void 0)}function rD(O){if(!Array.isArray(O))return[];const Ce=[];for(const ut of O)Ce.push(rp(ut));return Ce}return{asUri:n,asDiagnostics:i,asDiagnostic:o,asRange:h,asRanges:f,asPosition:u,asDiagnosticSeverity:p,asDiagnosticTag:l,asHover:y,asTextEdit:x,asTextEdits:S,asSignatureHelp:I,asSignatureInformations:D,asSignatureInformation:U,asParameterInformations:te,asParameterInformation:J,asDeclarationResult:ue,asDefinitionResult:re,asLocation:G,asReferences:dt,asDocumentHighlights:ne,asDocumentHighlight:Se,asDocumentHighlightKind:ke,asSymbolKind:ze,asSymbolTag:Ze,asSymbolTags:nt,asSymbolInformations:Ae,asSymbolInformation:wt,asDocumentSymbols:Bt,asDocumentSymbol:un,asCommand:Ie,asCommands:Oe,asCodeAction:et,asCodeActionKind:Ve,asCodeActionKinds:tt,asWorkspaceEdit:yt,asFoldingRangeKind:Da,asFoldingRange:dn,asFoldingRanges:tp,asColor:zt,asColorInformation:er,asColorInformations:Pr,asColorPresentation:wi,asColorPresentations:gu,asSelectionRange:rp,asSelectionRanges:rD}}const ar=(0,yR.loadMessageBundle)();var Ln;(function(t){function e(n,i){const{provider:o,repo:a}=i instanceof d.Uri?n.getVirtualUriMetadata(i):i;return n.getRemoteUri(o.id,{repo:a})}t.externalUri=e;function r(n,i){const{provider:o,repo:a}=i instanceof d.Uri?n.getVirtualUriMetadata(i):i;return n.getRemoteUri(o.id,{repo:a})}t.externalIndexUri=r})(Ln||(Ln={}));var Bi;(function(t){function e(i){if(i.HEAD.type===Le.Branch||i.HEAD.type===Le.RemoteBranch)return i.HEAD.name}t.getBranchName=e;function r(i){if(i.HEAD.type!==Le.Branch)return;if(i.pullRequest!==void 0)return i.HEAD.name;const o=i.HEAD.name;return o===void 0||o.startsWith("refs/heads/")?o:`refs/heads/${o}`}t.getIndexBranchName=r;async function n(i,o,a=dr.timeout){const s=await i.getMetadata(o),c=Ln.externalIndexUri(i,s),l=t.getIndexBranchName(s);if(!(c===void 0||l===void 0))return dr.getIndexedTip(i.getAuthentication(o),c,l,a)}t.getIndexedTip=n})(Bi||(Bi={}));var Ns;(function(t){const e=new Fi(1024);function r(a,s,c){let l=e.get(c);return l!==void 0||(l=a.getCommit(s,c),e.set(c,l)),l}t.get=r;async function n(a,s,c){const l=[];for(const h of c)l.push(r(a,s,h));const u=[];for(const h of await Promise.all(l))h!==void 0&&u.push(h);return u}t.all=n;function i(a,s){const c=a.commitDate,l=s.commitDate;return c===void 0&&l===void 0?0:c===void 0?1:l===void 0?-1:c<l?1:c>l?-1:0}t.sort=i;function o(a){const s=a.authorName!==void 0?`  \u2022  ${a.authorName}`:"",c=a.commitDate!==void 0?`  \u2022  ${Ts(a.commitDate,{ago:!0})}`:"",l=a.branchName!==void 0?` - ${a.branchName}`:"",u=a.tags!==void 0?typeof a.tags=="string"?`  \u2022  ${a.tags}`:`  \u2022  ${a.tags.join(" ")}`:"";return{author:s,date:c,branch:l,tag:u}}t.getCommitInfo=o})(Ns||(Ns={}));var Z0;(function(t){t[t.Unknown=0]="Unknown",t[t.New=1]="New",t[t.Failed=2]="Failed",t[t.Partial=3]="Partial",t[t.InProgress=4]="InProgress",t[t.Complete=5]="Complete",t[t.PartialIndex=6]="PartialIndex",t[t.CompleteIndex=7]="CompleteIndex"})(Z0||(Z0={}));var Ul;(function(t){function e(n){return{workspaceId:n.WorkspaceId,snapshotId:n.SnapshotId,state:n.State,commitId:n.commitId.toLowerCase(),branchName:r(n.BranchName),creationDate:new Date(n._ts*1e3)}}t.asWorkspaceSnapshot=e;function r(n){if(n!==null)return n.startsWith("refs/heads/")?n.substr(11):n}})(Ul||(Ul={}));var dr;(function(t){t.timeout=5*60*1e3;const e=new Fi(32),r=new Fi(32);async function n(u,h,f,p=t.timeout){const b=await i(u,h,f,p);if(!(b===void 0||b.length===0))return b[0]}t.getIndexedTip=n;async function i(u,h,f,p=t.timeout){const b=a(h,f);let w=e.get(b);if(w===void 0||w!==void 0&&Date.now()-w.time>p){const y=an.getAllWorkspaceSnapshots(u,h,f);w={time:Date.now(),promise:y,snapshots:void 0},e.set(b,w)}if(w.snapshots!==null){if(w.snapshots===void 0){let y=await w.promise;if(y===void 0){w.snapshots=null;return}y.sort((x,S)=>S.creationDate.getTime()-x.creationDate.getTime()),y=y.filter(x=>x.state===5),w.snapshots=y}return w.snapshots}}t.all=i;async function o(u,h,f,p,b=t.timeout){const w=h.toString();let y=r.get(w);if(y===null)return;if(y!==void 0)return y;const x=a(h,p),S=e.get(x);if(S!==void 0&&Date.now()-S.time<=b){if(S.snapshots===null)return;const I=S.snapshots!==void 0?S.snapshots:await i(u,h,p);if(I!==void 0){for(const D of I)if(D.commitId===f)return D}return}if(y=await an.getWorkspaceSnapshot(u,f),y===void 0){r.set(w,null);return}return r.set(w,y),y}t.single=o;function a(u,h){return h!==void 0?`${h}\\${u.toString()}`:u.toString()}async function s(u,h,f,p=t.timeout){return await o(u,h,f,void 0,p)!==void 0}t.exists=s;async function c(u,h,f,p=t.timeout){return await i(u,h,f,p)!==void 0}t.branch=c;async function l(u,h,f){const p=new Map(f.map(y=>[y.commitId,y])),b=await Ns.all(u,h.uri,f.map(y=>y.commitId));if(b.length===0)return;const w=[];for(const y of b){const x=p.get(y.hash);x!==void 0&&w.push({...x,commit:y})}if(w.length!==0)return w}t.resolve=l})(dr||(dr={}));var Hn;(function(t){function e(r=!1){return{hoverProvider:r,declarationProvider:r,definitionProvider:r,typeDefinitionProvider:r,referencesProvider:r,documentSymbolProvider:r,foldingRangeProvider:r,diagnosticProvider:r}}t.create=e})(Hn||(Hn={}));var an;(function(t){const e="v0.1",r="https://prod.richnav.vsengsaas.visualstudio.com/api";async function n(x,S,I){const D=await on(S,{method:"POST",body:JSON.stringify(I),headers:{"Content-Type":"application/json",...(await x).getRichNavigationHeaders()}});if(!!D.ok)return D.json()}async function i(x,S,I){const D=await on(S,{method:"POST",body:I,headers:(await x).getRichNavigationHeaders()});if(!!D.ok)return await D.json()}function o(x,S){return`${r}/${e}/HttpLanguageService/${x}/${S}`}async function a(x,S){const I=await on(`${r}/${e}/WorkspaceSnapshot?commitId=${S}`,{headers:(await x).getRichNavigationHeaders()});if(I.ok){const D=await I.json();return{workspaceId:D.workspaceId,snapshotId:D.snapshotId,state:D.state,commitId:S.toLowerCase(),branchName:void 0,creationDate:new Date}}}t.getWorkspaceSnapshot=a;async function s(x,S,I){const D=new s0;D.append("uriString",S.toString(!0)),I!==void 0&&D.append("branchName",I);try{const U=await i(x,`${r}/${e}/WorkspaceSnapshot/all`,D);return U===void 0?void 0:U.map(Ul.asWorkspaceSnapshot)}catch(U){K.error(U);return}}t.getAllWorkspaceSnapshots=s;async function c(x,S,I){const D=new s0;D.append("uriString",S.toString(!0)),I!==void 0&&D.append("branchName",I);try{const U=await i(x,`${r}/${e}/WorkspaceSnapshot/latest`,D);return U===void 0?void 0:Ul.asWorkspaceSnapshot(U)}catch(U){K.error(U);return}}t.getLatestWorkspaceSnapshot=c;async function l(x,S,I){try{return n(x,o(S,"textDocument/capabilities"),I)}catch(D){K.error(D);return}}t.capabilities=l;async function u(x,S,I){try{return n(x,o(S,"textDocument/hover"),I)}catch(D){K.error(D);return}}t.provideHover=u;async function h(x,S,I){try{return n(x,o(S,"textDocument/definition"),I)}catch(D){K.error(D);return}}t.provideDefinition=h;async function f(x,S,I){try{return n(x,o(S,"textDocument/declaration"),I)}catch(D){K.error(D);return}}t.provideDeclaration=f;async function p(x,S,I){try{return n(x,o(S,"textDocument/typeDefinition"),I)}catch(D){K.error(D);return}}t.provideTypeDefinition=p;async function b(x,S,I){try{return n(x,o(S,"textDocument/references"),I)}catch(D){K.error(D);return}}t.provideReferences=b;async function w(x,S,I){try{return n(x,o(S,"textDocument/foldingRange"),I)}catch(D){K.error(D);return}}t.providerFoldingRanges=w;async function y(x,S,I){const D=d.Uri.from({scheme:"https",authority:"prod.richnav.vsengsaas.visualstudio.com",path:`/api/${e}/Workspace/${x}/${S}/assets/designtime`,query:`id=${I}`});try{const U=await on(D.toString().replace("?id%3D","?id="),{method:"GET",headers:{accept:"text/plain"}});return U.ok?U.text():void 0}catch(U){K.error(U);return}}t.getDesignTimeFileContent=y})(an||(an={}));class RR{constructor(e){this.providerService=e,this.metadata=new Map,this.providerService.onDidChangeRepositories(r=>{var n;for(const i of r.added){const o=i.uri,a=Ye.getIndexMemento(o);if(a!==void 0){const s=Ln.externalIndexUri(this.providerService,o);s!==void 0&&(typeof((n=a.branch)==null?void 0:n.name)=="string"?dr.all(this.providerService.getAuthentication(o),s,a.branch.name).catch(void 0):typeof a.ref=="string"&&Zn(a.ref)&&dr.single(this.providerService.getAuthentication(o),s,a.ref).catch(void 0))}this.providerService.getMetadata(o).then(s=>{const c={},l=s.pullRequest===void 0?Bi.getIndexBranchName(s):void 0;l!==void 0?c.branch={name:l}:c.ref=s.HEAD.sha,Ye.setIndexMemento(o,c).then(void 0,void 0)},void 0)}}),this.providerService.onDidChangeRepository(r=>{const n=r.repository.uri,i=we(n);this.metadata.delete(i),this.getIndexMetadata(n).catch(void 0)})}async resolveIndexRef(e,r){const n=await this.providerService.getModeRefType(e),i=Xi.decode(e);if(i!==void 0){if(i.type===Kr.Latest)return n===q.Branch?this.getIndexedTip(e,r?0:dr.timeout):void 0;if(i.type===Kr.SHA){const a=Ln.externalIndexUri(this.providerService,e);return a===void 0?void 0:await dr.exists(this.providerService.getAuthentication(e),a,i.sha,r?0:dr.timeout)?i.sha:void 0}}if(this.providerService.getModeConfig(e,n).index===A.Latest)return this.getIndexedTip(e,r?0:dr.timeout)}refresh(e){for(const r of e)this.metadata.delete(r.toString())}getIndexMetadata(e){const r=this.providerService.getVirtualRootUri(e),n=we(r);let i=this.metadata.get(n);return i!==void 0||(i=this.createIndexMetadata(e),this.metadata.set(n,i)),i}async getIndexedTip(e,r=dr.timeout){const n=await Bi.getIndexedTip(this.providerService,e,r);return n!==void 0?n.commitId:void 0}async createIndexMetadata(e){const r=new $e(`RichNavIndexProvider.createIndexMetadata(${e.toString()})`);try{const n=Ln.externalIndexUri(this.providerService,e);if(n===void 0)return;r.logStep("Getting metadata");const i=this.providerService.getMetadata(e),o=this.providerService.getModeRefType(e,i),a=await i;r.logStep("Getting snapshot",{suffix:" \u2022 Getting snapshot..."});const s=this.providerService.getAuthentication(e),c=a.pullRequest===void 0?Bi.getIndexBranchName(a):void 0,l=await dr.single(s,n,a.HEAD.sha,c);if(a.HEAD.type===Le.Branch||a.HEAD.type===Le.RemoteBranch){const p=Xi.decode(e);if(p!==void 0)return r.logStep("Handle legacy encoding",{suffix:" \u2022 Handle legacy encoding..."}),l===void 0?p.type===Kr.Latest?(r.logStep("Getting branch snapshot",{suffix:" \u2022 Getting branch snapshot..."}),c!==void 0&&await dr.branch(s,n,c)?{type:xt.Indexed}:{type:xt.NotIndexed}):{type:xt.NotIndexed}:p.type===Kr.Latest||p.type===Kr.SHA?{type:xt.Active,sha:Promise.resolve(l.commitId),branch:{name:l.branchName}}:{type:xt.Match,sha:Promise.resolve(l.commitId),branch:{name:l.branchName}}}r.logStep("Getting mode config",{suffix:" \u2022 Getting mode config..."});const h=this.providerService.getModeConfig(e,await o),f=this.providerService.getVirtualUriMetadata(e);if((h.index===A.Latest||h.index===A.Match)&&l!==void 0)return{type:xt.Active,sha:Promise.resolve(l.commitId),branch:{name:l.branchName}};if(h.index===A.TipPlusLatest&&f.provider.id===wr.GitHub){if(l!==void 0&&l.commitId===a.HEAD.sha)return{type:xt.Active,sha:Promise.resolve(l.commitId),branch:{name:l.branchName}};if(a.HEAD.type===Le.Branch&&c!==void 0){r.logStep("Getting closest index",{suffix:" \u2022 Getting closest index..."});const p=await dr.all(s,n,c);if(p!==void 0&&p.length>0)return{type:xt.Active,sha:this.computeClosestIndex(e,a.HEAD.sha,p),branch:{name:c}}}}return l!==void 0?{type:xt.Indexed}:a.HEAD.type===Le.Branch&&(r.logStep("Getting branch snapshot",{suffix:" \u2022 Getting branch snapshot..."}),c!==void 0&&await dr.branch(s,n,c))?{type:xt.Indexed}:{type:xt.NotIndexed}}finally{r.stop()}}async computeClosestIndex(e,r,n){if(n.length===0)throw new Error("At least on snapshot should exist");const i=new Set(n.map(u=>u.commitId)),o=await this.providerService.getCommits(e,{ref:r,limit:100});if(o===void 0)return;let a;for(const u of o.commits)if(u.hash===r){a=u;break}if(a===void 0)return;const s=new Map(o.commits.map(u=>[u.hash,u])),c=[a];let l;for(;c.length>0;){for(l=c.shift();l!==void 0&&!i.has(l.hash);)if(l.parents.length>0){for(let u=1;u<l.parents.length;u++){const h=s.get(l.parents[u]);h!==void 0&&c.push(h)}l=s.get(l.parents[0])}if(l!==void 0)break}return l!==void 0?l.hash:void 0}async getSnapshots(e,r){const n=Ln.externalIndexUri(this.providerService,e);if(n===void 0)return[];const i=await dr.all(this.providerService.getAuthentication(e),n);if(i===void 0)return[];const o=[];for(const a of i)a.branchName!==void 0&&o.push({workspaceId:a.workspaceId,snapshotId:a.snapshotId,hash:a.commitId,branch:{name:a.branchName}});return o}async getStatusBarContributions(e){const r=await this.providerService.getMetadata(e),[n,i]=await Promise.all([this.getIndexMetadata(e),this.providerService.getModeRefType(e,r)]),o=this.providerService.getModeConfig(e,i);if(n===void 0)return[];const{HEAD:a}=r,s=[];if(n!==void 0){let c;const l=[`${pr(a.sha)}`];if(n.type===xt.Active){const u=await n.sha;o.index===A.Latest||o.index===A.Match?(c=o.display===N.Browse?"$(layers-active)\u2009\u2009$(lock)":"$(layers-active)",l.push(ar("statusbar.active",`The commit is indexed and rich code navigation features are enabled.
The files in the workspace are readonly.`))):o.index===A.TipPlusLatest&&(c="$(layers-dot)",u!==r.HEAD.sha?l.push(ar("statusbar.tipPlusLatest","The commit is not indexed. Rich code navigation features are enabled using a former indexed commit which might lead to fuzzy results.")):l.push(ar("statusbar.tipPlusLatest","The commit is indexed. Rich code navigation features are enabled. Files in the workspace can be modified which might lead to fuzzy results.")))}else n.type===xt.Match?(c="$(layers)",l.push(ar("statusbar.match",`The commit you are on is indexed, but rich navigation is not enabled.
Click the status bar item to enable it.`))):n.type===xt.Indexed&&(c="$(layers)",l.push(ar("statusbar.indexed",`The branch you are on is indexed, but rich navigation is not enabled.
Click the status bar item to enable it.`)));c&&s.push(yn({command:"remoteHub.indexMode.select",title:c,tooltip:l.join(`
`),arguments:[{uri:e}]}))}return s}}var wo;(function(t){let e;function r(){return e=d.window.createStatusBarItem(d.StatusBarAlignment.Right),e.text="$(compass)",e.command="remoteHub.indexMode.select",e.hide(),[e,d.window.onDidChangeActiveTextEditor(()=>{c()}),d.commands.registerCommand("remoteHub.indexMode.select",u=>{l(u).catch(h=>K.log("Selecting index mode failed.",h))})]}t.create=r;const n=new Map;function i(u){n.set(u.key(),u)}t.addService=i;function o(u){n.delete(u.key())}t.removeService=o;function a(u){return n.get(we(u))}async function s(u){for(const h of n.values())if(await h.handles(u))return h}async function c(){try{let u=function(b){const w=b.lastIndexOf("/");return w<=0?b:b.substr(w+1)};const h=d.window.activeTextEditor;if(h===void 0){e.hide();return}const f=await s(h.document);if(f===void 0){e.hide();return}const p=await f.isDocumentIndexed(h.document);p===Ll.Indexed?(e.text="$(compass)",e.tooltip=new d.MarkdownString(ar("isIndexed","The source file '{0}' is indexed and provides rich code navigation features like Go to Declaration and Find all References.",u(h.document.uri.path))),e.show()):p===Ll.IndexMapped?(e.text="$(compass-dot)",e.tooltip=new d.MarkdownString(ar("isIndexed","The source file '{0}' provides rich code navigation features using an earlier indexed commit. Navigation results might be fuzzy.",u(h.document.uri.path))),e.show()):e.hide()}catch(u){e.hide()}}t.updateStatusBarItem=c;async function l(u){const h=u.uri,f=a(h);if(f===void 0)return;const[p,b,w,y]=await Promise.all([f.getBranchName(),f.getMetadata(),f.getIndexMetadata(),f.getModeRefType(h)]);if(w===void 0||!xt.hasIndex(w.type))return;let x,S=!1;const I=Xi.decode(h);(I==null?void 0:I.type)===Kr.Latest||(I==null?void 0:I.type)===Kr.SHA?(S=!0,x={display:N.Browse,index:I.type===Kr.Latest?A.Latest:A.Match}):x=f.getModeConfig(h,y);const D=ar("current item","{0} current","$(check)"),U={kind:"disable",label:ar("RichNavStatus.disable.label","Disable"),description:x.index===A.None?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.disable.detail","Disable rich navigation. Files will be writable.")},te=f.getUriMetadata();let J,G;if(y===q.PullRequestBranch||y===q.PullRequestRemoteBranch||y===q.Commit||y===q.Tag){const ue={kind:"match",label:ar("RichNavStatus.match.label","Current indexed commit - readonly"),description:x.index===A.Match&&x.display===N.Browse?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.match.detail","Enable rich navigation only if the current commit is indexed. Files will be read-only.")},re={kind:"match+writeable",label:ar("RichNavStatus.matchWritable.label","Current indexed commit - writable"),description:x.index===A.Match&&x.display===N.Edit?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.match.detail","Enable rich navigation only if the current commit is indexed. Files will be writable.")};let se=te.provider.id===wr.GitHub;se&&(se=b.HEAD.type===Le.RemoteBranch?b.HEAD.branch.remote.accessLevel>=$t.Write:!0);const xe=se?[ue,re,U]:[ue,U];G=await d.window.showQuickPick(xe,{placeHolder:"Pick a rich navigation mode"})}else if(y===q.Branch||y===q.RemoteBranch){const ue={kind:"latest",label:ar("RichNavStatus.latestIndexed.label","Latest indexed commit"),description:x.index===A.Latest?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.latestIndexed.detail","Enable rich navigation on the latest indexed commit. Files will be read-only.")},re={kind:"tip+latest",label:ar("RichNavStatus.matchLatestIndexed.label","Current commit & latest index"),description:x.index===A.TipPlusLatest?`  \u2022  ${D}`:void 0,detail:ar("RichNavStatus.matchLatestIndexed.detail","Enable rich navigation on the current commit using the latest index. Files will be writeable.")},se=te.provider.id===wr.GitHub?[ue,re,U]:[ue,U];G=await d.window.showQuickPick(se,{placeHolder:ar("RichNavStatus.placeHolder","Pick a rich navigation mode for branch {0}",p)})}if(G!==void 0&&(G.kind==="disable"?J={display:N.Edit,index:A.None}:G.kind==="match"?J={display:N.Browse,index:A.Match}:G.kind==="match+writeable"?J={display:N.Edit,index:A.Match}:G.kind==="tip+latest"?J={display:N.Edit,index:A.TipPlusLatest}:G.kind==="latest"&&(J={display:N.Browse,index:A.Latest}),J!==void 0&&!$.equals(x,J))){if(await f.hasChanges()&&J.display===N.Browse){await d.window.showInformationMessage("The repository has outgoing changes. Commit them first before switching to browse mode.",{modal:!0,useCustom:!0});return}if(J.index===A.Latest){const ue=await f.getIndexedTip();if(ue===void 0)return;await f.sync(ue.hash)}else J.index===A.TipPlusLatest&&await f.sync();if(await Ye.setMode(h,J),S){const ue=await f.getNonIndexedWorkspaceDescriptor();ue!==void 0&&nn(ue)}else f.refresh()}}})(wo||(wo={}));class X0{static createStatus(){return wo.create()}async createNavigationService(e,r,n){const i=await e.getIndexMetadata(r.uri);if(!(i===void 0||i.type===xt.NotIndexed))return()=>new tf(e,r,n)}}var $s;(function(t){const e=new RegExp("^vsck:\\/\\/([a-fA-F0-9]+)\\/(latest|[a-fA-F0-9]{15})\\/designtime\\/([a-fA-F0-9]+)(\\/?.*)$");function r(i){const o=e.exec(i);if(o===null||o.length!==5)return;const a={v:1,w:o[1],s:o[2],a:o[3]};return d.Uri.from({scheme:fi.scheme,authority:ku(JSON.stringify(a)),path:o[4]})}t.toVSCode=r;function n(i){if(i.scheme!==fi.scheme)return;let o;try{return o=JSON.parse(Up(i.authority)),o===void 0?void 0:{workspaceId:o.w,snapshotId:o.s,assetId:`${o.a}${i.path}`}}catch{return}}t.toRichNavComponents=n})($s||($s={}));const ef=class{constructor(){this._onDidChangeFile=new d.EventEmitter,this.cache=new Fi(64),this.textEncoder=new TextEncoder}get onDidChangeFile(){return this._onDidChangeFile.event}watch(t,e){return ef.emptyDisposable}async stat(t){const e=await this.getFile(t);if(e===void 0)throw d.FileSystemError.FileNotFound();return{type:d.FileType.File,mtime:e.time,ctime:e.time,size:e.content.length,permissions:d.FilePermission.Readonly}}readDirectory(t){return[]}createDirectory(t){throw d.FileSystemError.NoPermissions()}async readFile(t){const e=await this.getFile(t);if(e===void 0)throw d.FileSystemError.FileNotFound();return e.content}writeFile(t,e,r){throw d.FileSystemError.NoPermissions()}delete(t,e){throw d.FileSystemError.NoPermissions()}rename(t,e,r){throw d.FileSystemError.NoPermissions()}async getFile(t){let e=this.cache.get(t.toString());if(e!==void 0)return e;if(t.scheme!==ef.scheme)return;const r=$s.toRichNavComponents(t);if(r===void 0)return;const n=await an.getDesignTimeFileContent(r.workspaceId,r.snapshotId,r.assetId);if(n!==void 0)return e={content:this.textEncoder.encode(n),time:Date.now()},this.cache.set(t.toString(),e),e}};let fi=ef;fi.scheme="vsck-fs",fi.emptyDisposable={dispose:()=>{}};var Ll;(function(t){t[t.NotIndexed=0]="NotIndexed",t[t.IndexMapped=1]="IndexMapped",t[t.Indexed=2]="Indexed"})(Ll||(Ll={}));const qn=class{static registerCapability(t,e,r){var n;const i=this.disabledCapabilities.get(t);if(i==null?void 0:i[e])return!1;const o=this.localCapabilities.get(t);return(o==null?void 0:o[e])?!1:(n=r[e])!=null?n:!1}constructor(t,e,r){this.providerService=t,this.repository=e,this.changeStore=r,this.repositoryRoot=`${e.uri.toString()}/`;const n=(i=!1)=>{const o=this.repository.uri;i||(this.metadata=this.providerService.getMetadata(o),this.indexMetadata=this.providerService.getIndexMetadata(o)),Promise.all([this.metadata,this.indexMetadata,this.providerService.getModeRefType(o,this.metadata)]).then(async a=>{const[s,c,l]=this.currentlyResolved,[u,h,f]=a,p=this.providerService.getModeConfig(o,f);if(s!==void 0&&c!==void 0&&l!==void 0&&s.HEAD.sha===u.HEAD.sha&&h!==void 0&&c.type===h.type&&l.index===p.index&&l.display===p.display){const b=(c==null?void 0:c.type)===xt.Active?await c.sha:void 0,w=(h==null?void 0:h.type)===xt.Active?await h.sha:void 0;if(b===w)return}this.currentlyResolved=[u,h,p];for(const b of this.registeredFeatures.values())b.dispose();if(this.registeredFeatures.clear(),this.pendingCapabilitiesRequests.clear(),this.currentListeners!==void 0&&this.currentListeners.dispose(),this.workspaceSnapshot=void 0,this.mapper=void 0,yc.isActive(h)){const b=Ln.externalIndexUri(this.providerService,u),w=await h.sha;if(b!==void 0&&w!==void 0){const y=await dr.single(this.providerService.getAuthentication(o),b,w,Bi.getIndexBranchName(u));y!==void 0&&(this.workspaceSnapshot=y,this.currentListeners=this.installListeners(),((p==null?void 0:p.display)===N.Edit||u.HEAD.sha!==w)&&(this.mapper=new y0(this.providerService,o,w,u.HEAD.sha)))}}await wo.updateStatusBarItem()}).then(void 0,void 0)};this.metadata=this.providerService.getMetadata(this.repository.uri),this.indexMetadata=this.providerService.getIndexMetadata(this.repository.uri),this.currentlyResolved=[void 0,void 0,void 0],this.registeredFeatures=new Map,this.pendingCapabilitiesRequests=new Map,this.capabilitiesCache=new Fi(2048),this.knownDesignTimeFiles=new Set,this.providerService.onDidChangeRepository(i=>{we(i.repository.uri)===we(this.repository.uri)&&n()}),this.providerService.onDidRefresh(i=>{for(const o of i)if(we(o)===we(this.repository.uri)){n();break}}),n(!0),wo.addService(this),this.indexMetadata.then(async i=>{const o=this.repository.uri;let a=!1;const s=Xi.decode(this.repository.uri);if(s!==void 0&&i!==void 0&&(s.type===Kr.Latest&&i.type!==xt.Active||s.type===Kr.SHA&&(i.type!==xt.Active||await i.sha!==s.sha))&&(a=!0),!a){const c=this.providerService.getModeConfig(o,await this.providerService.getModeRefType(o,this.metadata),!0);c!==void 0&&c.display===N.Browse&&i!==void 0&&c.index!==A.None&&i.type!==xt.Active?a=!0:(i==null?void 0:i.type)===xt.Active&&await i.sha===void 0&&((c==null?void 0:c.display)===N.Browse,a=!0)}a&&d.window.showWarningMessage(ar("RichNavService.latest.notIndexed","The repository got opened in rich code navigation mode but no corresponding index is available. Rich code navigation features are disabled.")).then(void 0,void 0)},void 0),qn.fileSystemProvider===void 0&&(qn.fileSystemProvider=new fi,d.workspace.registerFileSystemProvider(fi.scheme,qn.fileSystemProvider))}key(){return we(this.repository.uri)}dispose(){for(const t of this.registeredFeatures.values())t.dispose();this.registeredFeatures.clear(),wo.removeService(this)}handles(t){return t.uri.scheme!==Pt.scheme?Promise.resolve(!1):Promise.resolve(t.uri.toString().startsWith(this.repositoryRoot))}async getBranchName(){return Bi.getBranchName(await this.metadata)}async getMetadata(){return this.metadata}async getIndexMetadata(){return this.indexMetadata}getUriMetadata(){return this.providerService.getVirtualUriMetadata(this.repository.uri)}getModeConfig(t,e){return this.providerService.getModeConfig(t,e)}getModeRefType(t){return this.providerService.getModeRefType(t)}refresh(){return this.providerService.refresh()}async getNonIndexedWorkspaceDescriptor(){const{name:t,repo:e}=await this.metadata,{ref:r}=this.providerService.getVirtualUriMetadata(this.repository.uri);return{name:t,uri:this.providerService.createVirtualUri(this.repository.uri,{repo:e,ref:r}),location:At.CurrentWindow}}async isDocumentIndexed(t){await this.metadata;const e=await this.indexMetadata;if(e===void 0||e.type===xt.NotIndexed||this.workspaceSnapshot===void 0)return 0;const r=this.pendingCapabilitiesRequests.get(t.uri.toString());return r!==void 0&&await r,this.registeredFeatures.has(t.uri.toString())?this.mapper===void 0?2:await this.mapper.needsMapping(t)?1:2:0}async getIndexedTip(){const t=await this.metadata,e=Ln.externalIndexUri(this.providerService,t),r=Bi.getIndexBranchName(t);if(e===void 0||r===void 0)return;const n=await dr.getIndexedTip(this.providerService.getAuthentication(this.repository.uri),e,r);if(n===void 0)return;const i=await Ns.get(this.providerService,this.repository.uri,n.commitId);if(i!==void 0)return{...i,branchName:r}}hasChanges(){return this.changeStore.hasChanges(this.repository.uri)}sync(t){return this.providerService.sync(this.repository.uri,this.changeStore,{to:t,reason:"user"})}async getCommit(t){const e=await this.metadata,r=Ln.externalIndexUri(this.providerService,e);if(r===void 0)return;const[n,i]=await Promise.all([Ns.get(this.providerService,this.repository.uri,t),dr.single(this.providerService.getAuthentication(this.repository.uri),r,t)]);if(!(n===void 0||i===void 0))return{...n,branchName:i.branchName}}installListeners(){const t=[],e=async r=>{const n=r.uri.scheme;if(Pt.scheme!==n&&fi.scheme!==n)return;const i=r.uri.toString();if(n===Pt.scheme&&!i.startsWith(this.repositoryRoot)||n===fi.scheme&&!this.knownDesignTimeFiles.has(i)||this.pendingCapabilitiesRequests.has(i))return;const o=this.workspaceSnapshot!==void 0?this.workspaceSnapshot.commitId:void 0;if(o===void 0)return;let a=this.capabilitiesCache.get(i);if(a!==null){if(a===void 0){const s=this.capabilities(r.uri);this.pendingCapabilitiesRequests.set(i,s),a=await s,this.pendingCapabilitiesRequests.delete(i),this.capabilitiesCache.set(i,a===void 0?null:a)}a===void 0||!d.workspace.textDocuments.some(s=>s===r)||this.registerProviders(r,a,o)}};return t.push(d.workspace.onDidOpenTextDocument(e)),d.workspace.textDocuments.forEach(e),t.push(d.workspace.onDidCloseTextDocument(r=>{const n=r.uri.toString(),i=this.registeredFeatures.get(n);i!==void 0&&(this.registeredFeatures.delete(r.uri.toString()),i.dispose()),this.pendingCapabilitiesRequests.delete(n)})),d.Disposable.from(...t)}registerProviders(t,e,r){if(this.workspaceSnapshot===void 0)return;const n=this.workspaceSnapshot,i=t.languageId,a=[{scheme:this.repository.uri.scheme,pattern:t.uri.fsPath,language:t.languageId,exclusive:!0}],s=[],c=new Promise((p,b)=>{const w=`vsck://${n.workspaceId}/${n.snapshotId}/source/`;this.metadata.then(y=>{p(ER(x=>{const S=d.Uri.parse(x);if(y===void 0)return S;try{if(x.startsWith(w))return this.repository.createRelativeUri(x.substr(w.length));const I=$s.toVSCode(x);return I!==void 0?(this.knownDesignTimeFiles.add(I.toString()),I):S}catch(I){return S}}))},b)}),l=new RegExp(`^vsck:\\/\\/${n.workspaceId}\\/(?:latest|[a-fA-F0-9]{15})\\/designtime\\/(?:[a-fA-F0-9]+)(\\/?.*)$`);function u(p){const b=l.exec(p);return b===null||b.length===2}function h(p){if(p==null)return p;if(Array.isArray(p)){if(p.length===0)return[];const b=p[0];return typeof b.uri=="string"?p.filter(x=>u(x.uri)):typeof b.targetUri=="string"?p.filter(x=>u(x.targetUri)):[]}return l.exec(p.uri)===null?p:void 0}async function f(p,b,w){var y,x,S;if(w==null||p===void 0)return w;const I=new Map(d.workspace.textDocuments.map(U=>[U.uri.toString(!0),U]));if(Array.isArray(w)){const U=[],te=[];if(w.length===0)return[];for(const J of w){const G=J;if(G.uri instanceof d.Uri){const ue=await p.mapRangeFromIndexToCode((y=I.get(G.uri.toString()))!=null?y:G.uri,G.range);ue!==void 0&&U.push(new d.Location(G.uri,ue))}else{const ue=J,re=(x=I.get(ue.targetUri.toString()))!=null?x:ue.targetUri,se=ue.originSelectionRange?await p.mapRangeFromIndexToCode(b,ue.originSelectionRange):void 0;if(se!==void 0||ue.originSelectionRange===void 0){const xe=await p.mapRangeFromIndexToCode(re,ue.targetRange);if(xe!==void 0){const dt=ue.targetSelectionRange?await p.mapRangeFromIndexToCode(re,ue.targetSelectionRange):void 0;(dt!==void 0||ue.targetSelectionRange===void 0)&&te.push({targetUri:ue.targetUri,targetRange:xe,targetSelectionRange:dt,originSelectionRange:se})}}}}return U.length>0?U:te}const D=await p.mapRangeFromIndexToCode((S=I.get(w.uri.toString()))!=null?S:w.uri,w.range);if(D!==void 0)return new d.Location(w.uri,D)}qn.registerCapability(i,"hoverProvider",e)&&s.push(d.languages.registerHoverProvider(a,{provideHover:async(p,b)=>{const w=await this.createTextDocumentPositionParams(p,b);if(w!==void 0)return(await c).asHover(await an.provideHover(this.providerService.getAuthentication(p.uri),r,w))}})),qn.registerCapability(i,"definitionProvider",e)&&s.push(d.languages.registerDefinitionProvider(a,{provideDefinition:async(p,b)=>{const w=await this.createTextDocumentPositionParams(p,b);if(w!==void 0)return f(this.mapper,p,(await c).asDefinitionResult(h(await an.provideDefinition(this.providerService.getAuthentication(p.uri),r,w))))}})),qn.registerCapability(i,"declarationProvider",e)&&s.push(d.languages.registerDeclarationProvider(a,{provideDeclaration:async(p,b)=>{const w=await this.createTextDocumentPositionParams(p,b);if(w!==void 0)return f(this.mapper,p,(await c).asDeclarationResult(h(await an.provideDeclaration(this.providerService.getAuthentication(p.uri),r,w))))}})),qn.registerCapability(i,"typeDefinitionProvider",e)&&s.push(d.languages.registerTypeDefinitionProvider(a,{provideTypeDefinition:async(p,b)=>{const w=await this.createTextDocumentPositionParams(p,b);if(w!==void 0)return f(this.mapper,p,(await c).asDefinitionResult(h(await an.provideTypeDefinition(this.providerService.getAuthentication(p.uri),r,w))))}})),qn.registerCapability(i,"referencesProvider",e)&&s.push(d.languages.registerReferenceProvider(a,{provideReferences:async(p,b,w)=>{const y=this.mapper!==void 0?await this.mapper.mapPositionFromCodeToIndex(p,b):b;if(y===void 0)return;const x={position:{line:y.line,character:y.character},textDocument:{uri:this.createRichNavDocumentUri(p.uri).toString(!0)},context:{includeDeclaration:w.includeDeclaration}};return f(this.mapper,p,(await c).asReferences(h(await an.provideReferences(this.providerService.getAuthentication(p.uri),r,x))))}})),qn.registerCapability(i,"foldingRangeProvider",e)&&s.push(d.languages.registerFoldingRangeProvider(a,{provideFoldingRanges:async p=>{if(!(this.mapper!==void 0&&await this.mapper.needsMapping(p)))return(await c).asFoldingRanges(await an.providerFoldingRanges(this.providerService.getAuthentication(p.uri),r,this.createTextDocumentParams(p.uri)))}})),this.registeredFeatures.set(t.uri.toString(),d.Disposable.from(...s)),wo.updateStatusBarItem()}async capabilities(t){var e;const r=this.workspaceSnapshot!==void 0?this.workspaceSnapshot.commitId:void 0;if(r!==void 0)return(e=await an.capabilities(this.providerService.getAuthentication(t),r,this.createTextDocumentParams(t)))!=null?e:void 0}createTextDocumentParams(t){return{textDocument:{uri:this.createRichNavDocumentUri(t).toString(!0)}}}async createTextDocumentPositionParams(t,e){const r=this.mapper!==void 0?await this.mapper.mapPositionFromCodeToIndex(t,e):e;if(r!==void 0)return{position:{line:r.line,character:r.character},textDocument:{uri:this.createRichNavDocumentUri(t.uri).toString(!0)}}}createRichNavDocumentUri(t){if(t.scheme===fi.scheme){const n=$s.toRichNavComponents(t);return n===void 0?t:d.Uri.file(n.assetId)}const e=this.repository.uri.toString(!0),r=t.toString(!0);return d.Uri.file(r.substr(e.length))}};let tf=qn;tf.localCapabilities=new Map([["javascript",Object.assign(Hn.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["javascriptreact",Object.assign(Hn.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["typescript",Object.assign(Hn.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})],["typescriptreact",Object.assign(Hn.create(),{documentSymbolProvider:!0,foldingRangeProvider:!0})]]),tf.disabledCapabilities=new Map([["javascript",Object.assign(Hn.create(),{declarationProvider:!0})],["javascriptreact",Object.assign(Hn.create(),{declarationProvider:!0})],["typescript",Object.assign(Hn.create(),{declarationProvider:!0})],["typescriptreact",Object.assign(Hn.create(),{declarationProvider:!0})]]);class TR{constructor(e){this.providerService=e}async getMetadata(e){const r=this.providerService.getVirtualUriMetadata(e);if(r===void 0)return;const{provider:n,repo:i}=r;return{provider:{id:n.id,name:n.name},repo:i,getRevision:async()=>{const{HEAD:o}=await this.providerService.getMetadata(e);return{type:o.type,name:o.name,revision:o.sha}}}}getProvider(e){return this.providerService.getRegisteredProvider(e)}getProviderUri(e){return this.providerService.getProviderUri(e)}getProviderRootUri(e){return this.providerService.getProviderRootUri(e)}isProviderUri(e,r){return e.scheme!==Pt.scheme&&this.providerService.hasProvider(e,r)}getVirtualUri(e){return this.providerService.getVirtualUri(e)}getVirtualWorkspaceUri(e){return this.providerService.getVirtualWorkspaceUri(e)}}var AR=Object.defineProperty,kR=Object.getOwnPropertyDescriptor,rf=(t,e,r,n)=>{for(var i=n>1?void 0:n?kR(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&AR(e,r,i),i};const nf=d.FileSystemError.FileNotFound().code;class Hl{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChangeFile=new d.EventEmitter,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.disposable=d.Disposable.from(d.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0}),d.workspace.registerFileSearchProvider(this.scheme,this),d.workspace.registerTextSearchProvider(this.scheme,this),e.onDidChangeRepository(n=>{n.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([n.repository.uri])}),e.onDidRefresh(n=>this.onRefreshOrRepositoryChanged(n)),r.onDidChange(n=>{const i=n.map(o=>{switch(o.type){case rt.Created:return{type:d.FileChangeType.Created,uri:o.uri};case rt.Changed:return{type:d.FileChangeType.Changed,uri:o.uri};case rt.Deleted:return{type:d.FileChangeType.Deleted,uri:o.uri}}});setTimeout(()=>this._onDidChangeFile.fire(i),0)}))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return Pt.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){e=e.filter(r=>r.scheme===this.scheme),e.length!==0&&(K.log(`fs.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.updateOpenOrWatchedUris(e))}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,o]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(a=>Kn(o,a))&&(this.implicitlyWatchedUris.delete(i),r.set(i,o));K.debug(`fs.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(we(i),i);const n=[...r.values()].map(i=>({type:d.FileChangeType.Changed,uri:i}));setTimeout(()=>{K.debug(`fs.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=we(e);this.watchedUris.set(n,e);const i=this.providerService.watch(this.providerService.getProviderUri(e),r);return{dispose:()=>{this.watchedUris.delete(n),i.dispose()}}}async stat(e){const r=new $e(`fs.stat(${e.toString()})`);let n;try{if(this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e),e)!==!1){if(r.logStep("ChangeStore query"),n=await this.changeStore.stat(e),n!==void 0)return n;r.logStep("Provider query",{message:": Not found \u2022",suffix:" \u2022 Querying provider..."})}else r.logStep("Provider query"),this.implicitlyWatchedUris.set(we(e),e);return n=await this.providerService.stat(this.providerService.getProviderUri(e)),n}finally{n===void 0&&this.implicitlyWatchedUris.delete(we(e)),r.stop()}}async readDirectory(e){const r=new $e(`fs.readDirectory(${e.toString()})`);this.implicitlyWatchedUris.set(we(e),e);try{r.logStep("Provider query");let n=await this.providerService.readDirectory(this.providerService.getProviderUri(e));return this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e))!==!1&&(r.logStep("Applying changes",{suffix:" \u2022 Applying changes..."}),n=await this.changeStore.updateDirectoryEntries(e,n)),n}finally{r.stop()}}async createDirectory(e){const r=new $e(`fs.createDirectory(${e.toString()})`);try{await this.changeStore.createDirectory(e)}catch(n){throw K.error(n,r.context),n}finally{r.stop()}}async readFile(e){const r=new $e(`fs.readFile(${e.toString()})`),n=we(e);let i;try{if(this.changeStore.maybeHasChanges(this.providerService.getVirtualRootUri(e),e)!==!1){r.logStep("ChangeStore query");const o=await this.changeStore.readFile(e);if(o!==void 0)return o;r.logStep("Provider query",{message:": Not found \u2022",suffix:" \u2022 Querying provider..."})}else r.logStep("Provider query"),this.implicitlyWatchedUris.set(n,e);return i=await this.providerService.readFile(this.providerService.getProviderUri(e)),i}finally{i===void 0&&this.implicitlyWatchedUris.delete(n),r.stop()}}async writeFile(e,r,n){const i=new $e(`fs.writeFile(${e.toString()})`,{},r.length,n);try{let o;try{if(o=await this.stat(e),!n.overwrite)throw d.FileSystemError.FileExists()}catch(a){if(a instanceof d.FileSystemError&&a.code===nf){if(!n.create)throw d.FileSystemError.FileNotFound(e)}else throw a}try{if(o===void 0)await this.changeStore.createFile(e,r);else{i.logStep("Provider original query");let a;try{a=await this.providerService.readFile(this.providerService.getProviderUri(e))}catch(s){if(s instanceof d.FileSystemError&&s.code===nf)a=new Uint8Array;else throw s}i.logStep("Writing file",{suffix:" \u2022 Writing file to Change Store..."}),await this.changeStore.writeFile(e,r,a)}}catch(a){throw K.error(a,i.context),a}}finally{i.stop()}}async delete(e,r){const n=new $e(`fs.delete(${e.toString()})`,{},r);try{switch((await this.stat(e)).type){case d.FileType.File:await this.changeStore.deleteFile(e);break;case d.FileType.Directory:{await this.deleteDirectory(e,r);break}default:throw d.FileSystemError.NoPermissions()}}catch(i){throw K.error(i,n.context),i}finally{n.stop()}}async deleteDirectory(e,r){const n=new $e(`fs.deleteDirectory(${e.toString()})`,{},r);try{const i=await this.readDirectory(e);if(i.length!==0){if(!r.recursive&&i.some(([,o])=>o===d.FileType.Directory))throw d.FileSystemError.NoPermissions();for(const[o,a]of i)a===d.FileType.Directory?await this.deleteDirectory(d.Uri.joinPath(e,o),r):await this.changeStore.deleteFile(d.Uri.joinPath(e,o))}await this.changeStore.deleteDirectory(e)}catch(i){throw K.error(i,n.context),i}finally{n.stop()}}async rename(e,r,n){const i=new $e(`fs.rename(${e.toString()} -> ${r.toString()})`,{},n);try{switch((await this.stat(e)).type){case d.FileType.File:{const a=await this.readFile(e);await this.writeFile(r,a,{create:!0,overwrite:n.overwrite}),await this.delete(e,{recursive:!1});break}case d.FileType.Directory:{await this.renameDirectory(e,r,n);break}default:throw d.FileSystemError.NoPermissions()}}catch(o){throw K.error(o,i.context),o}finally{i.stop()}}async renameDirectory(e,r,n){const i=new $e(`fs.renameDirectory(${e.toString()} -> ${r.toString()})`,{},n);try{await this.copyDirectory(e,r,n),await this.delete(e,{recursive:!0})}catch(o){throw K.error(o,i.context),o}finally{i.stop()}}async copy(e,r,n){const i=new $e(`fs.copy(${e.toString()} -> ${r.toString()})`,{},n);try{switch((await this.stat(e)).type){case d.FileType.File:{const a=await this.readFile(e);await this.writeFile(r,a,{create:!0,overwrite:n.overwrite});break}case d.FileType.Directory:{await this.copyDirectory(e,r,n);break}default:throw d.FileSystemError.NoPermissions()}}catch(o){throw K.error(o,i.context),o}finally{i.stop()}}async copyDirectory(e,r,n){const i=new $e(`fs.copyDirectory(${e.toString()} -> ${r.toString()})`,{},n);try{if(await this.exists(r))throw d.FileSystemError.FileExists();try{await this.createDirectory(r);const o=await this.readDirectory(e);for(const[a,s]of o)s===d.FileType.Directory?await this.copyDirectory(d.Uri.joinPath(e,a),d.Uri.joinPath(r,a),n):await this.copy(d.Uri.joinPath(e,a),d.Uri.joinPath(r,a),n)}catch(o){throw K.error(o,i.context),o}}finally{i.stop()}}async exists(e){try{return await this.stat(e),!0}catch(r){if(r instanceof d.FileSystemError&&r.code===nf)return!1;throw r}}async provideFileSearchResults(e,r,n){var i;const o=new $e(`fs.provideFileSearchResults(${e.pattern}, ${r.folder.toString()})`,{logLevel:Rt.Debug});let a;try{return a=await this.providerService.provideFileSearchResults(e,{...r,folder:this.providerService.getProviderUri(r.folder)},n),a==null?void 0:a.map(s=>this.providerService.getVirtualUri(s))}catch(s){throw K.error(s,o.context),s}finally{o.stop({suffix:` \u2022 ${(i=a==null?void 0:a.length)!=null?i:0} results found`})}}provideTextSearchResults(e,r,n,i){return this.providerService.provideTextSearchResults(e,{...r,folder:this.providerService.getProviderUri(r.folder)},{report:o=>n.report({...o,uri:this.providerService.getVirtualUri(o.uri)})},i)}}rf([xn()],Hl.prototype,"stat",1),rf([xn()],Hl.prototype,"readDirectory",1),rf([xn()],Hl.prototype,"readFile",1);function IR(t){return t.replace(/[\\{}*+?|^$.[\]()#]/g,"\\$&")}function DR(t,e,r={}){if(!t)throw new Error("Cannot create regex from empty string");e||(t=IR(t)),r.wholeWord&&(/\B/.test(t.charAt(0))||(t=`\\b${t}`),/\B/.test(t.charAt(t.length-1))||(t=`${t}\\b`));let n="gmu";return r.matchCase||(n+="i"),new RegExp(t,n)}let Q0,Y0,of;const PR=(t,e,r,n)=>{const i=`${e.join("--")};;;;${r.join("--")}`,o=t.map(s=>s.path).join("::");if(Q0===o&&i==Y0&&of)return of;const a=Uh((n?t.filter(s=>s.size<n):t).map(s=>s.path),e,r);return Q0=o,Y0=i,of=a,a},FR=(t,e,r,n)=>{var i;const o=[];let a;if(typeof t=="string")a=t;else{const u=t;if(u[0]==255&&u[1]==254)a=new TextDecoder("utf-16le").decode(u);else if(u[0]==254&&u[1]==255)a=new TextDecoder("utf-16be").decode(u);else if(a=new TextDecoder("utf8").decode(u),a.slice(0,1e3).includes("\uFFFD")&&u.includes(0))return[]}const s=[];let c=null,l=n.remainingResultQuota;for(;l>=0&&(c=r.exec(a));)s.push({matchStartIndex:c.index,matchedText:c[0]}),l--;if(s.length){const u=new Set,h=new Set,f=[],p=S=>a.slice(f[S].start,f[S].end);let b=0,w=null;const y=/\r?\n/g;for(;w=y.exec(a);)f.push({start:b,end:w.index}),b=w.index+w[0].length;b<a.length&&f.push({start:b,end:a.length});let x=0;for(const{matchStartIndex:S,matchedText:I}of s){if(l<0)break;for(;Boolean(f[x+1])&&S>f[x].end;)x++;let D=x;for(;Boolean(f[D+1])&&S+I.length>f[D].end;)D++;if(n.beforeContext)for(let re=Math.max(0,x-n.beforeContext);re<x;re++)u.add(re);let U="",te=0;for(let re=x;re<=D;re++){let se=p(re);((i=n.previewOptions)==null?void 0:i.charsPerLine)&&se.length>n.previewOptions.charsPerLine&&(te=Math.max(S-f[x].start-20,0),se=se.substr(te,n.previewOptions.charsPerLine)),U+=`${se}
`,h.add(re)}const J=new d.Range(x,S-f[x].start,D,S+I.length-f[D].start),G=new d.Range(0,S-f[x].start-te,D-x,S+I.length-f[D].start-(D===x?te:0)),ue={uri:d.Uri.file(e),ranges:J,preview:{text:U,matches:G}};if(o.push(ue),n.afterContext)for(let re=D+1;re<=Math.min(D+n.afterContext,f.length-1);re++)u.add(re)}for(const S of u)h.has(S)||o.push({uri:d.Uri.file(e),text:p(S),lineNumber:S+1})}return o};var NR=__webpack_require__(5790);/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */const $R=4,J0=0,ew=1,MR=2;function ba(t){let e=t.length;for(;--e>=0;)t[e]=0}const BR=0,tw=1,OR=2,UR=3,LR=258,af=29,Ms=256,Bs=Ms+1+af,_a=30,sf=19,rw=2*Bs+1,yo=15,cf=16,HR=7,lf=256,nw=16,iw=17,ow=18,uf=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ql=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),qR=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),aw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),WR=512,pi=new Array((Bs+2)*2);ba(pi);const Os=new Array(_a*2);ba(Os);const Us=new Array(WR);ba(Us);const Ls=new Array(LR-UR+1);ba(Ls);const df=new Array(af);ba(df);const Wl=new Array(_a);ba(Wl);function hf(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let sw,cw,lw;function ff(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const uw=t=>t<256?Us[t]:Us[256+(t>>>7)],Hs=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},qr=(t,e,r)=>{t.bi_valid>cf-r?(t.bi_buf|=e<<t.bi_valid&65535,Hs(t,t.bi_buf),t.bi_buf=e>>cf-t.bi_valid,t.bi_valid+=r-cf):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},Wn=(t,e,r)=>{qr(t,r[e*2],r[e*2+1])},dw=(t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},zR=t=>{t.bi_valid===16?(Hs(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},jR=(t,e)=>{const r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,h,f,p,b,w=0;for(f=0;f<=yo;f++)t.bl_count[f]=0;for(r[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<rw;l++)u=t.heap[l],f=r[r[u*2+1]*2+1]+1,f>c&&(f=c,w++),r[u*2+1]=f,!(u>n)&&(t.bl_count[f]++,p=0,u>=s&&(p=a[u-s]),b=r[u*2],t.opt_len+=b*(f+p),o&&(t.static_len+=b*(i[u*2+1]+p)));if(w!==0){do{for(f=c-1;t.bl_count[f]===0;)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[c]--,w-=2}while(w>0);for(f=c;f!==0;f--)for(u=t.bl_count[f];u!==0;)h=t.heap[--l],!(h>n)&&(r[h*2+1]!==f&&(t.opt_len+=(f-r[h*2+1])*r[h*2],r[h*2+1]=f),u--)}},hw=(t,e,r)=>{const n=new Array(yo+1);let i=0,o,a;for(o=1;o<=yo;o++)n[o]=i=i+r[o-1]<<1;for(a=0;a<=e;a++){let s=t[a*2+1];s!==0&&(t[a*2]=dw(n[s]++,s))}},VR=()=>{let t,e,r,n,i;const o=new Array(yo+1);for(r=0,n=0;n<af-1;n++)for(df[n]=r,t=0;t<1<<uf[n];t++)Ls[r++]=n;for(Ls[r-1]=n,i=0,n=0;n<16;n++)for(Wl[n]=i,t=0;t<1<<ql[n];t++)Us[i++]=n;for(i>>=7;n<_a;n++)for(Wl[n]=i<<7,t=0;t<1<<ql[n]-7;t++)Us[256+i++]=n;for(e=0;e<=yo;e++)o[e]=0;for(t=0;t<=143;)pi[t*2+1]=8,t++,o[8]++;for(;t<=255;)pi[t*2+1]=9,t++,o[9]++;for(;t<=279;)pi[t*2+1]=7,t++,o[7]++;for(;t<=287;)pi[t*2+1]=8,t++,o[8]++;for(hw(pi,Bs+1,o),t=0;t<_a;t++)Os[t*2+1]=5,Os[t*2]=dw(t,5);sw=new hf(pi,uf,Ms+1,Bs,yo),cw=new hf(Os,ql,0,_a,yo),lw=new hf(new Array(0),qR,0,sf,HR)},fw=t=>{let e;for(e=0;e<Bs;e++)t.dyn_ltree[e*2]=0;for(e=0;e<_a;e++)t.dyn_dtree[e*2]=0;for(e=0;e<sf;e++)t.bl_tree[e*2]=0;t.dyn_ltree[lf*2]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},pw=t=>{t.bi_valid>8?Hs(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},GR=(t,e,r,n)=>{pw(t),n&&(Hs(t,r),Hs(t,~r)),t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},gw=(t,e,r,n)=>{const i=e*2,o=r*2;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]},pf=(t,e,r)=>{const n=t.heap[r];let i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&gw(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!gw(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},mw=(t,e,r)=>{let n,i,o=0,a,s;if(t.last_lit!==0)do n=t.pending_buf[t.d_buf+o*2]<<8|t.pending_buf[t.d_buf+o*2+1],i=t.pending_buf[t.l_buf+o],o++,n===0?Wn(t,i,e):(a=Ls[i],Wn(t,a+Ms+1,e),s=uf[a],s!==0&&(i-=df[a],qr(t,i,s)),n--,a=uw(n),Wn(t,a,r),s=ql[a],s!==0&&(n-=Wl[a],qr(t,n,s)));while(o<t.last_lit);Wn(t,lf,e)},gf=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems;let a,s,c=-1,l;for(t.heap_len=0,t.heap_max=rw,a=0;a<o;a++)r[a*2]!==0?(t.heap[++t.heap_len]=c=a,t.depth[a]=0):r[a*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,r[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=n[l*2+1]);for(e.max_code=c,a=t.heap_len>>1;a>=1;a--)pf(t,r,a);l=o;do a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pf(t,r,1),s=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=s,r[l*2]=r[a*2]+r[s*2],t.depth[l]=(t.depth[a]>=t.depth[s]?t.depth[a]:t.depth[s])+1,r[a*2+1]=r[s*2+1]=l,t.heap[1]=l++,pf(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],jR(t,e),hw(r,c,t.bl_count)},vw=(t,e,r)=>{let n,i=-1,o,a=e[0*2+1],s=0,c=7,l=4;for(a===0&&(c=138,l=3),e[(r+1)*2+1]=65535,n=0;n<=r;n++)o=a,a=e[(n+1)*2+1],!(++s<c&&o===a)&&(s<l?t.bl_tree[o*2]+=s:o!==0?(o!==i&&t.bl_tree[o*2]++,t.bl_tree[nw*2]++):s<=10?t.bl_tree[iw*2]++:t.bl_tree[ow*2]++,s=0,i=o,a===0?(c=138,l=3):o===a?(c=6,l=3):(c=7,l=4))},ww=(t,e,r)=>{let n,i=-1,o,a=e[0*2+1],s=0,c=7,l=4;for(a===0&&(c=138,l=3),n=0;n<=r;n++)if(o=a,a=e[(n+1)*2+1],!(++s<c&&o===a)){if(s<l)do Wn(t,o,t.bl_tree);while(--s!=0);else o!==0?(o!==i&&(Wn(t,o,t.bl_tree),s--),Wn(t,nw,t.bl_tree),qr(t,s-3,2)):s<=10?(Wn(t,iw,t.bl_tree),qr(t,s-3,3)):(Wn(t,ow,t.bl_tree),qr(t,s-11,7));s=0,i=o,a===0?(c=138,l=3):o===a?(c=6,l=3):(c=7,l=4)}},KR=t=>{let e;for(vw(t,t.dyn_ltree,t.l_desc.max_code),vw(t,t.dyn_dtree,t.d_desc.max_code),gf(t,t.bl_desc),e=sf-1;e>=3&&t.bl_tree[aw[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},ZR=(t,e,r,n)=>{let i;for(qr(t,e-257,5),qr(t,r-1,5),qr(t,n-4,4),i=0;i<n;i++)qr(t,t.bl_tree[aw[i]*2+1],3);ww(t,t.dyn_ltree,e-1),ww(t,t.dyn_dtree,r-1)},XR=t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return J0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return ew;for(r=32;r<Ms;r++)if(t.dyn_ltree[r*2]!==0)return ew;return J0};let yw=!1;const QR=t=>{yw||(VR(),yw=!0),t.l_desc=new ff(t.dyn_ltree,sw),t.d_desc=new ff(t.dyn_dtree,cw),t.bl_desc=new ff(t.bl_tree,lw),t.bi_buf=0,t.bi_valid=0,fw(t)},bw=(t,e,r,n)=>{qr(t,(BR<<1)+(n?1:0),3),GR(t,e,r,!0)},YR=t=>{qr(t,tw<<1,3),Wn(t,lf,pi),zR(t)},JR=(t,e,r,n)=>{let i,o,a=0;t.level>0?(t.strm.data_type===MR&&(t.strm.data_type=XR(t)),gf(t,t.l_desc),gf(t,t.d_desc),a=KR(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&e!==-1?bw(t,e,r,n):t.strategy===$R||o===i?(qr(t,(tw<<1)+(n?1:0),3),mw(t,pi,Os)):(qr(t,(OR<<1)+(n?1:0),3),ZR(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),mw(t,t.dyn_ltree,t.dyn_dtree)),fw(t),n&&pw(t)},eT=(t,e,r)=>(t.pending_buf[t.d_buf+t.last_lit*2]=e>>>8&255,t.pending_buf[t.d_buf+t.last_lit*2+1]=e&255,t.pending_buf[t.l_buf+t.last_lit]=r&255,t.last_lit++,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(Ls[r]+Ms+1)*2]++,t.dyn_dtree[uw(e)*2]++),t.last_lit===t.lit_bufsize-1);var tT=QR,rT=bw,nT=JR,iT=eT,oT=YR,aT={_tr_init:tT,_tr_stored_block:rT,_tr_flush_block:nT,_tr_tally:iT,_tr_align:oT},qs=(t,e,r,n)=>{let i=t&65535|0,o=t>>>16&65535|0,a=0;for(;r!==0;){a=r>2e3?2e3:r,r-=a;do i=i+e[n++]|0,o=o+i|0;while(--a);i%=65521,o%=65521}return i|o<<16|0};const sT=()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},cT=new Uint32Array(sT());var mr=(t,e,r,n)=>{const i=cT,o=n+r;t^=-1;for(let a=n;a<o;a++)t=t>>>8^i[(t^e[a])&255];return t^-1},bo={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_o={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:lT,_tr_stored_block:uT,_tr_flush_block:dT,_tr_tally:Oi,_tr_align:hT}=aT,{Z_NO_FLUSH:xo,Z_PARTIAL_FLUSH:fT,Z_FULL_FLUSH:pT,Z_FINISH:Ui,Z_BLOCK:_w,Z_OK:zn,Z_STREAM_END:xw,Z_STREAM_ERROR:sn,Z_DATA_ERROR:gT,Z_BUF_ERROR:mf,Z_DEFAULT_COMPRESSION:mT,Z_FILTERED:vT,Z_HUFFMAN_ONLY:zl,Z_RLE:wT,Z_FIXED:yT,Z_DEFAULT_STRATEGY:bT,Z_UNKNOWN:_T,Z_DEFLATED:jl}=_o,xT=9,ST=15,CT=8,ET=29,vf=256+1+ET,RT=30,TT=19,AT=2*vf+1,kT=15,bt=3,Li=258,bn=Li+bt+1,IT=32,Vl=42,wf=69,Gl=73,Kl=91,Zl=103,So=113,Ws=666,hr=1,zs=2,Co=3,xa=4,DT=3,Hi=(t,e)=>(t.msg=bo[e],e),Sw=t=>(t<<1)-(t>4?9:0),qi=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let Wi=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const zi=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},Sr=(t,e)=>{dT(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,zi(t.strm)},Et=(t,e)=>{t.pending_buf[t.pending++]=e},js=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},PT=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),t.state.wrap===1?t.adler=qs(t.adler,e,i,r):t.state.wrap===2&&(t.adler=mr(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},Cw=(t,e)=>{let r=t.max_chain_length,n=t.strstart,i,o,a=t.prev_length,s=t.nice_match;const c=t.strstart>t.w_size-bn?t.strstart-(t.w_size-bn):0,l=t.window,u=t.w_mask,h=t.prev,f=t.strstart+Li;let p=l[n+a-1],b=l[n+a];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do if(i=e,!(l[i+a]!==b||l[i+a-1]!==p||l[i]!==l[n]||l[++i]!==l[n+1])){n+=2,i++;do;while(l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&n<f);if(o=Li-(f-n),n=f-Li,o>a){if(t.match_start=e,a=o,o>=s)break;p=l[n+a-1],b=l[n+a]}}while((e=h[e&u])>c&&--r!=0);return a<=t.lookahead?a:t.lookahead},Eo=t=>{const e=t.w_size;let r,n,i,o,a;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-bn)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,n=t.hash_size,r=n;do i=t.head[--r],t.head[r]=i>=e?i-e:0;while(--n);n=e,r=n;do i=t.prev[--r],t.prev[r]=i>=e?i-e:0;while(--n);o+=e}if(t.strm.avail_in===0)break;if(n=PT(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=n,t.lookahead+t.insert>=bt)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=Wi(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=Wi(t,t.ins_h,t.window[a+bt-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<bt)););}while(t.lookahead<bn&&t.strm.avail_in!==0)},FT=(t,e)=>{let r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Eo(t),t.lookahead===0&&e===xo)return hr;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;const n=t.block_start+r;if((t.strstart===0||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,Sr(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-bn&&(Sr(t,!1),t.strm.avail_out===0))return hr}return t.insert=0,e===Ui?(Sr(t,!0),t.strm.avail_out===0?Co:xa):(t.strstart>t.block_start&&(Sr(t,!1),t.strm.avail_out===0),hr)},yf=(t,e)=>{let r,n;for(;;){if(t.lookahead<bn){if(Eo(t),t.lookahead<bn&&e===xo)return hr;if(t.lookahead===0)break}if(r=0,t.lookahead>=bt&&(t.ins_h=Wi(t,t.ins_h,t.window[t.strstart+bt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-bn&&(t.match_length=Cw(t,r)),t.match_length>=bt)if(n=Oi(t,t.strstart-t.match_start,t.match_length-bt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=bt){t.match_length--;do t.strstart++,t.ins_h=Wi(t,t.ins_h,t.window[t.strstart+bt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Wi(t,t.ins_h,t.window[t.strstart+1]);else n=Oi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Sr(t,!1),t.strm.avail_out===0))return hr}return t.insert=t.strstart<bt-1?t.strstart:bt-1,e===Ui?(Sr(t,!0),t.strm.avail_out===0?Co:xa):t.last_lit&&(Sr(t,!1),t.strm.avail_out===0)?hr:zs},Sa=(t,e)=>{let r,n,i;for(;;){if(t.lookahead<bn){if(Eo(t),t.lookahead<bn&&e===xo)return hr;if(t.lookahead===0)break}if(r=0,t.lookahead>=bt&&(t.ins_h=Wi(t,t.ins_h,t.window[t.strstart+bt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=bt-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-bn&&(t.match_length=Cw(t,r),t.match_length<=5&&(t.strategy===vT||t.match_length===bt&&t.strstart-t.match_start>4096)&&(t.match_length=bt-1)),t.prev_length>=bt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-bt,n=Oi(t,t.strstart-1-t.prev_match,t.prev_length-bt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Wi(t,t.ins_h,t.window[t.strstart+bt-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=bt-1,t.strstart++,n&&(Sr(t,!1),t.strm.avail_out===0))return hr}else if(t.match_available){if(n=Oi(t,0,t.window[t.strstart-1]),n&&Sr(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return hr}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=Oi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<bt-1?t.strstart:bt-1,e===Ui?(Sr(t,!0),t.strm.avail_out===0?Co:xa):t.last_lit&&(Sr(t,!1),t.strm.avail_out===0)?hr:zs},NT=(t,e)=>{let r,n,i,o;const a=t.window;for(;;){if(t.lookahead<=Li){if(Eo(t),t.lookahead<=Li&&e===xo)return hr;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=bt&&t.strstart>0&&(i=t.strstart-1,n=a[i],n===a[++i]&&n===a[++i]&&n===a[++i])){o=t.strstart+Li;do;while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);t.match_length=Li-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=bt?(r=Oi(t,1,t.match_length-bt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=Oi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(Sr(t,!1),t.strm.avail_out===0))return hr}return t.insert=0,e===Ui?(Sr(t,!0),t.strm.avail_out===0?Co:xa):t.last_lit&&(Sr(t,!1),t.strm.avail_out===0)?hr:zs},$T=(t,e)=>{let r;for(;;){if(t.lookahead===0&&(Eo(t),t.lookahead===0)){if(e===xo)return hr;break}if(t.match_length=0,r=Oi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(Sr(t,!1),t.strm.avail_out===0))return hr}return t.insert=0,e===Ui?(Sr(t,!0),t.strm.avail_out===0?Co:xa):t.last_lit&&(Sr(t,!1),t.strm.avail_out===0)?hr:zs};function jn(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}const Vs=[new jn(0,0,0,0,FT),new jn(4,4,8,4,yf),new jn(4,5,16,8,yf),new jn(4,6,32,32,yf),new jn(4,4,16,16,Sa),new jn(8,16,32,32,Sa),new jn(8,16,128,128,Sa),new jn(8,32,128,256,Sa),new jn(32,128,258,1024,Sa),new jn(32,258,258,4096,Sa)],MT=t=>{t.window_size=2*t.w_size,qi(t.head),t.max_lazy_match=Vs[t.level].max_lazy,t.good_match=Vs[t.level].good_length,t.nice_match=Vs[t.level].nice_length,t.max_chain_length=Vs[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=bt-1,t.match_available=0,t.ins_h=0};function BT(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=jl,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(AT*2),this.dyn_dtree=new Uint16Array((2*RT+1)*2),this.bl_tree=new Uint16Array((2*TT+1)*2),qi(this.dyn_ltree),qi(this.dyn_dtree),qi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(kT+1),this.heap=new Uint16Array(2*vf+1),qi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*vf+1),qi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ew=t=>{if(!t||!t.state)return Hi(t,sn);t.total_in=t.total_out=0,t.data_type=_T;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Vl:So,t.adler=e.wrap===2?0:1,e.last_flush=xo,lT(e),zn},Rw=t=>{const e=Ew(t);return e===zn&&MT(t.state),e},OT=(t,e)=>!t||!t.state||t.state.wrap!==2?sn:(t.state.gzhead=e,zn),Tw=(t,e,r,n,i,o)=>{if(!t)return sn;let a=1;if(e===mT&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>xT||r!==jl||n<8||n>15||e<0||e>9||o<0||o>yT)return Hi(t,sn);n===8&&(n=9);const s=new BT;return t.state=s,s.strm=t,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+bt-1)/bt),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=(1+2)*s.lit_bufsize,s.level=e,s.strategy=o,s.method=r,Rw(t)},UT=(t,e)=>Tw(t,e,jl,ST,CT,bT),LT=(t,e)=>{let r,n;if(!t||!t.state||e>_w||e<0)return t?Hi(t,sn):sn;const i=t.state;if(!t.output||!t.input&&t.avail_in!==0||i.status===Ws&&e!==Ui)return Hi(t,t.avail_out===0?mf:sn);i.strm=t;const o=i.last_flush;if(i.last_flush=e,i.status===Vl)if(i.wrap===2)t.adler=0,Et(i,31),Et(i,139),Et(i,8),i.gzhead?(Et(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Et(i,i.gzhead.time&255),Et(i,i.gzhead.time>>8&255),Et(i,i.gzhead.time>>16&255),Et(i,i.gzhead.time>>24&255),Et(i,i.level===9?2:i.strategy>=zl||i.level<2?4:0),Et(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(Et(i,i.gzhead.extra.length&255),Et(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=mr(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=wf):(Et(i,0),Et(i,0),Et(i,0),Et(i,0),Et(i,0),Et(i,i.level===9?2:i.strategy>=zl||i.level<2?4:0),Et(i,DT),i.status=So);else{let a=jl+(i.w_bits-8<<4)<<8,s=-1;i.strategy>=zl||i.level<2?s=0:i.level<6?s=1:i.level===6?s=2:s=3,a|=s<<6,i.strstart!==0&&(a|=IT),a+=31-a%31,i.status=So,js(i,a),i.strstart!==0&&(js(i,t.adler>>>16),js(i,t.adler&65535)),t.adler=1}if(i.status===wf)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=mr(t.adler,i.pending_buf,i.pending-r,r)),zi(t),r=i.pending,i.pending===i.pending_buf_size));)Et(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(t.adler=mr(t.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Gl)}else i.status=Gl;if(i.status===Gl)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=mr(t.adler,i.pending_buf,i.pending-r,r)),zi(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,Et(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(t.adler=mr(t.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.gzindex=0,i.status=Kl)}else i.status=Kl;if(i.status===Kl)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=mr(t.adler,i.pending_buf,i.pending-r,r)),zi(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,Et(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(t.adler=mr(t.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.status=Zl)}else i.status=Zl;if(i.status===Zl&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&zi(t),i.pending+2<=i.pending_buf_size&&(Et(i,t.adler&255),Et(i,t.adler>>8&255),t.adler=0,i.status=So)):i.status=So),i.pending!==0){if(zi(t),t.avail_out===0)return i.last_flush=-1,zn}else if(t.avail_in===0&&Sw(e)<=Sw(o)&&e!==Ui)return Hi(t,mf);if(i.status===Ws&&t.avail_in!==0)return Hi(t,mf);if(t.avail_in!==0||i.lookahead!==0||e!==xo&&i.status!==Ws){let a=i.strategy===zl?$T(i,e):i.strategy===wT?NT(i,e):Vs[i.level].func(i,e);if((a===Co||a===xa)&&(i.status=Ws),a===hr||a===Co)return t.avail_out===0&&(i.last_flush=-1),zn;if(a===zs&&(e===fT?hT(i):e!==_w&&(uT(i,0,0,!1),e===pT&&(qi(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),zi(t),t.avail_out===0))return i.last_flush=-1,zn}return e!==Ui?zn:i.wrap<=0?xw:(i.wrap===2?(Et(i,t.adler&255),Et(i,t.adler>>8&255),Et(i,t.adler>>16&255),Et(i,t.adler>>24&255),Et(i,t.total_in&255),Et(i,t.total_in>>8&255),Et(i,t.total_in>>16&255),Et(i,t.total_in>>24&255)):(js(i,t.adler>>>16),js(i,t.adler&65535)),zi(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?zn:xw)},HT=t=>{if(!t||!t.state)return sn;const e=t.state.status;return e!==Vl&&e!==wf&&e!==Gl&&e!==Kl&&e!==Zl&&e!==So&&e!==Ws?Hi(t,sn):(t.state=null,e===So?Hi(t,gT):zn)},qT=(t,e)=>{let r=e.length;if(!t||!t.state)return sn;const n=t.state,i=n.wrap;if(i===2||i===1&&n.status!==Vl||n.lookahead)return sn;if(i===1&&(t.adler=qs(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){i===0&&(qi(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(r-n.w_size,r),0),e=c,r=n.w_size}const o=t.avail_in,a=t.next_in,s=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Eo(n);n.lookahead>=bt;){let c=n.strstart,l=n.lookahead-(bt-1);do n.ins_h=Wi(n,n.ins_h,n.window[c+bt-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--l);n.strstart=c,n.lookahead=bt-1,Eo(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=bt-1,n.match_available=0,t.next_in=a,t.input=s,t.avail_in=o,n.wrap=i,zn};var WT=UT,zT=Tw,jT=Rw,VT=Ew,GT=OT,KT=LT,ZT=HT,XT=qT,QT="pako deflate (from Nodeca project)",Gs={deflateInit:WT,deflateInit2:zT,deflateReset:jT,deflateResetKeep:VT,deflateSetHeader:GT,deflate:KT,deflateEnd:ZT,deflateSetDictionary:XT,deflateInfo:QT};const YT=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var JT=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(!!r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)YT(r,n)&&(t[n]=r[n])}}return t},eA=t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const r=new Uint8Array(e);for(let n=0,i=0,o=t.length;n<o;n++){let a=t[n];r.set(a,i),i+=a.length}return r},Xl={assign:JT,flattenChunks:eA};let Aw=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Aw=!1}const Ks=new Uint8Array(256);for(let t=0;t<256;t++)Ks[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ks[254]=Ks[254]=1;var tA=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,i,o,a=t.length,s=0;for(i=0;i<a;i++)r=t.charCodeAt(i),(r&64512)==55296&&i+1<a&&(n=t.charCodeAt(i+1),(n&64512)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(s),o=0,i=0;o<s;i++)r=t.charCodeAt(i),(r&64512)==55296&&i+1<a&&(n=t.charCodeAt(i+1),(n&64512)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|r&63):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|r&63):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|r&63);return e};const rA=(t,e)=>{if(e<65534&&t.subarray&&Aw)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r};var nA=(t,e)=>{const r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,i;const o=new Array(r*2);for(i=0,n=0;n<r;){let a=t[n++];if(a<128){o[i++]=a;continue}let s=Ks[a];if(s>4){o[i++]=65533,n+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&n<r;)a=a<<6|t[n++]&63,s--;if(s>1){o[i++]=65533;continue}a<65536?o[i++]=a:(a-=65536,o[i++]=55296|a>>10&1023,o[i++]=56320|a&1023)}return rA(o,i)},iA=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)==128;)r--;return r<0||r===0?e:r+Ks[t[r]]>e?r:e},Zs={string2buf:tA,buf2string:nA,utf8border:iA};function oA(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var kw=oA;const Iw=Object.prototype.toString,{Z_NO_FLUSH:aA,Z_SYNC_FLUSH:sA,Z_FULL_FLUSH:cA,Z_FINISH:lA,Z_OK:Ql,Z_STREAM_END:uA,Z_DEFAULT_COMPRESSION:dA,Z_DEFAULT_STRATEGY:hA,Z_DEFLATED:fA}=_o;function Xs(t){this.options=Xl.assign({level:dA,method:fA,chunkSize:16384,windowBits:15,memLevel:8,strategy:hA},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kw,this.strm.avail_out=0;let r=Gs.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Ql)throw new Error(bo[r]);if(e.header&&Gs.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=Zs.string2buf(e.dictionary):Iw.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,r=Gs.deflateSetDictionary(this.strm,n),r!==Ql)throw new Error(bo[r]);this._dict_set=!0}}Xs.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?lA:aA,typeof t=="string"?r.input=Zs.string2buf(t):Iw.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===sA||o===cA)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(i=Gs.deflate(r,o),i===uA)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Gs.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ql;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0},Xs.prototype.onData=function(t){this.chunks.push(t)},Xs.prototype.onEnd=function(t){t===Ql&&(this.result=Xl.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function bf(t,e){const r=new Xs(e);if(r.push(t,!0),r.err)throw r.msg||bo[r.err];return r.result}function pA(t,e){return e=e||{},e.raw=!0,bf(t,e)}function gA(t,e){return e=e||{},e.gzip=!0,bf(t,e)}var mA=Xs,vA=bf,wA=pA,yA=gA,bA=_o,_A={Deflate:mA,deflate:vA,deflateRaw:wA,gzip:yA,constants:bA};const Yl=30,xA=12;var SA=function(e,r){let n,i,o,a,s,c,l,u,h,f,p,b,w,y,x,S,I,D,U,te,J,G,ue,re;const se=e.state;n=e.next_in,ue=e.input,i=n+(e.avail_in-5),o=e.next_out,re=e.output,a=o-(r-e.avail_out),s=o+(e.avail_out-257),c=se.dmax,l=se.wsize,u=se.whave,h=se.wnext,f=se.window,p=se.hold,b=se.bits,w=se.lencode,y=se.distcode,x=(1<<se.lenbits)-1,S=(1<<se.distbits)-1;e:do{b<15&&(p+=ue[n++]<<b,b+=8,p+=ue[n++]<<b,b+=8),I=w[p&x];t:for(;;){if(D=I>>>24,p>>>=D,b-=D,D=I>>>16&255,D===0)re[o++]=I&65535;else if(D&16){U=I&65535,D&=15,D&&(b<D&&(p+=ue[n++]<<b,b+=8),U+=p&(1<<D)-1,p>>>=D,b-=D),b<15&&(p+=ue[n++]<<b,b+=8,p+=ue[n++]<<b,b+=8),I=y[p&S];r:for(;;){if(D=I>>>24,p>>>=D,b-=D,D=I>>>16&255,D&16){if(te=I&65535,D&=15,b<D&&(p+=ue[n++]<<b,b+=8,b<D&&(p+=ue[n++]<<b,b+=8)),te+=p&(1<<D)-1,te>c){e.msg="invalid distance too far back",se.mode=Yl;break e}if(p>>>=D,b-=D,D=o-a,te>D){if(D=te-D,D>u&&se.sane){e.msg="invalid distance too far back",se.mode=Yl;break e}if(J=0,G=f,h===0){if(J+=l-D,D<U){U-=D;do re[o++]=f[J++];while(--D);J=o-te,G=re}}else if(h<D){if(J+=l+h-D,D-=h,D<U){U-=D;do re[o++]=f[J++];while(--D);if(J=0,h<U){D=h,U-=D;do re[o++]=f[J++];while(--D);J=o-te,G=re}}}else if(J+=h-D,D<U){U-=D;do re[o++]=f[J++];while(--D);J=o-te,G=re}for(;U>2;)re[o++]=G[J++],re[o++]=G[J++],re[o++]=G[J++],U-=3;U&&(re[o++]=G[J++],U>1&&(re[o++]=G[J++]))}else{J=o-te;do re[o++]=re[J++],re[o++]=re[J++],re[o++]=re[J++],U-=3;while(U>2);U&&(re[o++]=re[J++],U>1&&(re[o++]=re[J++]))}}else if((D&64)==0){I=y[(I&65535)+(p&(1<<D)-1)];continue r}else{e.msg="invalid distance code",se.mode=Yl;break e}break}}else if((D&64)==0){I=w[(I&65535)+(p&(1<<D)-1)];continue t}else if(D&32){se.mode=xA;break e}else{e.msg="invalid literal/length code",se.mode=Yl;break e}break}}while(n<i&&o<s);U=b>>3,n-=U,b-=U<<3,p&=(1<<b)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=o<s?257+(s-o):257-(o-s),se.hold=p,se.bits=b};const Ca=15,Dw=852,Pw=592,Fw=0,_f=1,Nw=2,CA=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),EA=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),RA=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),TA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Qs=(t,e,r,n,i,o,a,s)=>{const c=s.bits;let l=0,u=0,h=0,f=0,p=0,b=0,w=0,y=0,x=0,S=0,I,D,U,te,J,G=null,ue=0,re;const se=new Uint16Array(Ca+1),xe=new Uint16Array(Ca+1);let dt=null,ne=0,Se,ke,Ae;for(l=0;l<=Ca;l++)se[l]=0;for(u=0;u<n;u++)se[e[r+u]]++;for(p=c,f=Ca;f>=1&&se[f]===0;f--);if(p>f&&(p=f),f===0)return i[o++]=1<<24|64<<16|0,i[o++]=1<<24|64<<16|0,s.bits=1,0;for(h=1;h<f&&se[h]===0;h++);for(p<h&&(p=h),y=1,l=1;l<=Ca;l++)if(y<<=1,y-=se[l],y<0)return-1;if(y>0&&(t===Fw||f!==1))return-1;for(xe[1]=0,l=1;l<Ca;l++)xe[l+1]=xe[l]+se[l];for(u=0;u<n;u++)e[r+u]!==0&&(a[xe[e[r+u]]++]=u);if(t===Fw?(G=dt=a,re=19):t===_f?(G=CA,ue-=257,dt=EA,ne-=257,re=256):(G=RA,dt=TA,re=-1),S=0,u=0,l=h,J=o,b=p,w=0,U=-1,x=1<<p,te=x-1,t===_f&&x>Dw||t===Nw&&x>Pw)return 1;for(;;){Se=l-w,a[u]<re?(ke=0,Ae=a[u]):a[u]>re?(ke=dt[ne+a[u]],Ae=G[ue+a[u]]):(ke=32+64,Ae=0),I=1<<l-w,D=1<<b,h=D;do D-=I,i[J+(S>>w)+D]=Se<<24|ke<<16|Ae|0;while(D!==0);for(I=1<<l-1;S&I;)I>>=1;if(I!==0?(S&=I-1,S+=I):S=0,u++,--se[l]==0){if(l===f)break;l=e[r+a[u]]}if(l>p&&(S&te)!==U){for(w===0&&(w=p),J+=h,b=l-w,y=1<<b;b+w<f&&(y-=se[b+w],!(y<=0));)b++,y<<=1;if(x+=1<<b,t===_f&&x>Dw||t===Nw&&x>Pw)return 1;U=S&te,i[U]=p<<24|b<<16|J-o|0}}return S!==0&&(i[J+S]=l-w<<24|64<<16|0),s.bits=p,0};const AA=0,$w=1,Mw=2,{Z_FINISH:Bw,Z_BLOCK:kA,Z_TREES:Jl,Z_OK:Ro,Z_STREAM_END:IA,Z_NEED_DICT:DA,Z_STREAM_ERROR:cn,Z_DATA_ERROR:Ow,Z_MEM_ERROR:Uw,Z_BUF_ERROR:PA,Z_DEFLATED:Lw}=_o,Hw=1,qw=2,Ww=3,zw=4,jw=5,Vw=6,Gw=7,Kw=8,Zw=9,Xw=10,eu=11,gi=12,xf=13,Qw=14,Sf=15,Yw=16,Jw=17,ey=18,ty=19,tu=20,ru=21,ry=22,ny=23,iy=24,oy=25,ay=26,Cf=27,sy=28,cy=29,Qt=30,ly=31,FA=32,NA=852,$A=592,MA=15,uy=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function BA(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const dy=t=>{if(!t||!t.state)return cn;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Hw,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(NA),e.distcode=e.distdyn=new Int32Array($A),e.sane=1,e.back=-1,Ro},hy=t=>{if(!t||!t.state)return cn;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,dy(t)},fy=(t,e)=>{let r;if(!t||!t.state)return cn;const n=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?cn:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,hy(t))},py=(t,e)=>{if(!t)return cn;const r=new BA;t.state=r,r.window=null;const n=fy(t,e);return n!==Ro&&(t.state=null),n},OA=t=>py(t,MA);let gy=!0,Ef,Rf;const UA=t=>{if(gy){Ef=new Int32Array(512),Rf=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Qs($w,t.lens,0,288,Ef,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Qs(Mw,t.lens,0,32,Rf,0,t.work,{bits:5}),gy=!1}t.lencode=Ef,t.lenbits=9,t.distcode=Rf,t.distbits=5},my=(t,e,r,n)=>{let i;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(r-n,r-n+i),o.wnext),n-=i,n?(o.window.set(e.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},LA=(t,e)=>{let r,n,i,o,a,s,c,l,u,h,f,p,b,w,y=0,x,S,I,D,U,te,J,G;const ue=new Uint8Array(4);let re,se;const xe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return cn;r=t.state,r.mode===gi&&(r.mode=xf),a=t.next_out,i=t.output,c=t.avail_out,o=t.next_in,n=t.input,s=t.avail_in,l=r.hold,u=r.bits,h=s,f=c,G=Ro;e:for(;;)switch(r.mode){case Hw:if(r.wrap===0){r.mode=xf;break}for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(r.wrap&2&&l===35615){r.check=0,ue[0]=l&255,ue[1]=l>>>8&255,r.check=mr(r.check,ue,2,0),l=0,u=0,r.mode=qw;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",r.mode=Qt;break}if((l&15)!==Lw){t.msg="unknown compression method",r.mode=Qt;break}if(l>>>=4,u-=4,J=(l&15)+8,r.wbits===0)r.wbits=J;else if(J>r.wbits){t.msg="invalid window size",r.mode=Qt;break}r.dmax=1<<r.wbits,t.adler=r.check=1,r.mode=l&512?Xw:gi,l=0,u=0;break;case qw:for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(r.flags=l,(r.flags&255)!==Lw){t.msg="unknown compression method",r.mode=Qt;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=Qt;break}r.head&&(r.head.text=l>>8&1),r.flags&512&&(ue[0]=l&255,ue[1]=l>>>8&255,r.check=mr(r.check,ue,2,0)),l=0,u=0,r.mode=Ww;case Ww:for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.head&&(r.head.time=l),r.flags&512&&(ue[0]=l&255,ue[1]=l>>>8&255,ue[2]=l>>>16&255,ue[3]=l>>>24&255,r.check=mr(r.check,ue,4,0)),l=0,u=0,r.mode=zw;case zw:for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.head&&(r.head.xflags=l&255,r.head.os=l>>8),r.flags&512&&(ue[0]=l&255,ue[1]=l>>>8&255,r.check=mr(r.check,ue,2,0)),l=0,u=0,r.mode=jw;case jw:if(r.flags&1024){for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.length=l,r.head&&(r.head.extra_len=l),r.flags&512&&(ue[0]=l&255,ue[1]=l>>>8&255,r.check=mr(r.check,ue,2,0)),l=0,u=0}else r.head&&(r.head.extra=null);r.mode=Vw;case Vw:if(r.flags&1024&&(p=r.length,p>s&&(p=s),p&&(r.head&&(J=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+p),J)),r.flags&512&&(r.check=mr(r.check,n,p,o)),s-=p,o+=p,r.length-=p),r.length))break e;r.length=0,r.mode=Gw;case Gw:if(r.flags&2048){if(s===0)break e;p=0;do J=n[o+p++],r.head&&J&&r.length<65536&&(r.head.name+=String.fromCharCode(J));while(J&&p<s);if(r.flags&512&&(r.check=mr(r.check,n,p,o)),s-=p,o+=p,J)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Kw;case Kw:if(r.flags&4096){if(s===0)break e;p=0;do J=n[o+p++],r.head&&J&&r.length<65536&&(r.head.comment+=String.fromCharCode(J));while(J&&p<s);if(r.flags&512&&(r.check=mr(r.check,n,p,o)),s-=p,o+=p,J)break e}else r.head&&(r.head.comment=null);r.mode=Zw;case Zw:if(r.flags&512){for(;u<16;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(l!==(r.check&65535)){t.msg="header crc mismatch",r.mode=Qt;break}l=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=gi;break;case Xw:for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}t.adler=r.check=uy(l),l=0,u=0,r.mode=eu;case eu:if(r.havedict===0)return t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=s,r.hold=l,r.bits=u,DA;t.adler=r.check=1,r.mode=gi;case gi:if(e===kA||e===Jl)break e;case xf:if(r.last){l>>>=u&7,u-=u&7,r.mode=Cf;break}for(;u<3;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}switch(r.last=l&1,l>>>=1,u-=1,l&3){case 0:r.mode=Qw;break;case 1:if(UA(r),r.mode=tu,e===Jl){l>>>=2,u-=2;break e}break;case 2:r.mode=Jw;break;case 3:t.msg="invalid block type",r.mode=Qt}l>>>=2,u-=2;break;case Qw:for(l>>>=u&7,u-=u&7;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if((l&65535)!=(l>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Qt;break}if(r.length=l&65535,l=0,u=0,r.mode=Sf,e===Jl)break e;case Sf:r.mode=Yw;case Yw:if(p=r.length,p){if(p>s&&(p=s),p>c&&(p=c),p===0)break e;i.set(n.subarray(o,o+p),a),s-=p,o+=p,c-=p,a+=p,r.length-=p;break}r.mode=gi;break;case Jw:for(;u<14;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(r.nlen=(l&31)+257,l>>>=5,u-=5,r.ndist=(l&31)+1,l>>>=5,u-=5,r.ncode=(l&15)+4,l>>>=4,u-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Qt;break}r.have=0,r.mode=ey;case ey:for(;r.have<r.ncode;){for(;u<3;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.lens[xe[r.have++]]=l&7,l>>>=3,u-=3}for(;r.have<19;)r.lens[xe[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,re={bits:r.lenbits},G=Qs(AA,r.lens,0,19,r.lencode,0,r.work,re),r.lenbits=re.bits,G){t.msg="invalid code lengths set",r.mode=Qt;break}r.have=0,r.mode=ty;case ty:for(;r.have<r.nlen+r.ndist;){for(;y=r.lencode[l&(1<<r.lenbits)-1],x=y>>>24,S=y>>>16&255,I=y&65535,!(x<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(I<16)l>>>=x,u-=x,r.lens[r.have++]=I;else{if(I===16){for(se=x+2;u<se;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(l>>>=x,u-=x,r.have===0){t.msg="invalid bit length repeat",r.mode=Qt;break}J=r.lens[r.have-1],p=3+(l&3),l>>>=2,u-=2}else if(I===17){for(se=x+3;u<se;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=x,u-=x,J=0,p=3+(l&7),l>>>=3,u-=3}else{for(se=x+7;u<se;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=x,u-=x,J=0,p=11+(l&127),l>>>=7,u-=7}if(r.have+p>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Qt;break}for(;p--;)r.lens[r.have++]=J}}if(r.mode===Qt)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=Qt;break}if(r.lenbits=9,re={bits:r.lenbits},G=Qs($w,r.lens,0,r.nlen,r.lencode,0,r.work,re),r.lenbits=re.bits,G){t.msg="invalid literal/lengths set",r.mode=Qt;break}if(r.distbits=6,r.distcode=r.distdyn,re={bits:r.distbits},G=Qs(Mw,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,re),r.distbits=re.bits,G){t.msg="invalid distances set",r.mode=Qt;break}if(r.mode=tu,e===Jl)break e;case tu:r.mode=ru;case ru:if(s>=6&&c>=258){t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=s,r.hold=l,r.bits=u,SA(t,f),a=t.next_out,i=t.output,c=t.avail_out,o=t.next_in,n=t.input,s=t.avail_in,l=r.hold,u=r.bits,r.mode===gi&&(r.back=-1);break}for(r.back=0;y=r.lencode[l&(1<<r.lenbits)-1],x=y>>>24,S=y>>>16&255,I=y&65535,!(x<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(S&&(S&240)==0){for(D=x,U=S,te=I;y=r.lencode[te+((l&(1<<D+U)-1)>>D)],x=y>>>24,S=y>>>16&255,I=y&65535,!(D+x<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=D,u-=D,r.back+=D}if(l>>>=x,u-=x,r.back+=x,r.length=I,S===0){r.mode=ay;break}if(S&32){r.back=-1,r.mode=gi;break}if(S&64){t.msg="invalid literal/length code",r.mode=Qt;break}r.extra=S&15,r.mode=ry;case ry:if(r.extra){for(se=r.extra;u<se;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=ny;case ny:for(;y=r.distcode[l&(1<<r.distbits)-1],x=y>>>24,S=y>>>16&255,I=y&65535,!(x<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if((S&240)==0){for(D=x,U=S,te=I;y=r.distcode[te+((l&(1<<D+U)-1)>>D)],x=y>>>24,S=y>>>16&255,I=y&65535,!(D+x<=u);){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}l>>>=D,u-=D,r.back+=D}if(l>>>=x,u-=x,r.back+=x,S&64){t.msg="invalid distance code",r.mode=Qt;break}r.offset=I,r.extra=S&15,r.mode=iy;case iy:if(r.extra){for(se=r.extra;u<se;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Qt;break}r.mode=oy;case oy:if(c===0)break e;if(p=f-c,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Qt;break}p>r.wnext?(p-=r.wnext,b=r.wsize-p):b=r.wnext-p,p>r.length&&(p=r.length),w=r.window}else w=i,b=a-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do i[a++]=w[b++];while(--p);r.length===0&&(r.mode=ru);break;case ay:if(c===0)break e;i[a++]=r.length,c--,r.mode=ru;break;case Cf:if(r.wrap){for(;u<32;){if(s===0)break e;s--,l|=n[o++]<<u,u+=8}if(f-=c,t.total_out+=f,r.total+=f,f&&(t.adler=r.check=r.flags?mr(r.check,i,f,a-f):qs(r.check,i,f,a-f)),f=c,(r.flags?l:uy(l))!==r.check){t.msg="incorrect data check",r.mode=Qt;break}l=0,u=0}r.mode=sy;case sy:if(r.wrap&&r.flags){for(;u<32;){if(s===0)break e;s--,l+=n[o++]<<u,u+=8}if(l!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=Qt;break}l=0,u=0}r.mode=cy;case cy:G=IA;break e;case Qt:G=Ow;break e;case ly:return Uw;case FA:default:return cn}return t.next_out=a,t.avail_out=c,t.next_in=o,t.avail_in=s,r.hold=l,r.bits=u,(r.wsize||f!==t.avail_out&&r.mode<Qt&&(r.mode<Cf||e!==Bw))&&my(t,t.output,t.next_out,f-t.avail_out),h-=t.avail_in,f-=t.avail_out,t.total_in+=h,t.total_out+=f,r.total+=f,r.wrap&&f&&(t.adler=r.check=r.flags?mr(r.check,i,f,t.next_out-f):qs(r.check,i,f,t.next_out-f)),t.data_type=r.bits+(r.last?64:0)+(r.mode===gi?128:0)+(r.mode===tu||r.mode===Sf?256:0),(h===0&&f===0||e===Bw)&&G===Ro&&(G=PA),G},HA=t=>{if(!t||!t.state)return cn;let e=t.state;return e.window&&(e.window=null),t.state=null,Ro},qA=(t,e)=>{if(!t||!t.state)return cn;const r=t.state;return(r.wrap&2)==0?cn:(r.head=e,e.done=!1,Ro)},WA=(t,e)=>{const r=e.length;let n,i,o;return!t||!t.state||(n=t.state,n.wrap!==0&&n.mode!==eu)?cn:n.mode===eu&&(i=1,i=qs(i,e,r,0),i!==n.check)?Ow:(o=my(t,e,r,r),o?(n.mode=ly,Uw):(n.havedict=1,Ro))};var zA=hy,jA=fy,VA=dy,GA=OA,KA=py,ZA=LA,XA=HA,QA=qA,YA=WA,JA="pako inflate (from Nodeca project)",mi={inflateReset:zA,inflateReset2:jA,inflateResetKeep:VA,inflateInit:GA,inflateInit2:KA,inflate:ZA,inflateEnd:XA,inflateGetHeader:QA,inflateSetDictionary:YA,inflateInfo:JA};function ek(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var tk=ek;const vy=Object.prototype.toString,{Z_NO_FLUSH:rk,Z_FINISH:nk,Z_OK:Ys,Z_STREAM_END:Tf,Z_NEED_DICT:Af,Z_STREAM_ERROR:ik,Z_DATA_ERROR:wy,Z_MEM_ERROR:ok}=_o;function Js(t){this.options=Xl.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kw,this.strm.avail_out=0;let r=mi.inflateInit2(this.strm,e.windowBits);if(r!==Ys)throw new Error(bo[r]);if(this.header=new tk,mi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Zs.string2buf(e.dictionary):vy.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=mi.inflateSetDictionary(this.strm,e.dictionary),r!==Ys)))throw new Error(bo[r])}Js.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,a,s;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?nk:rk,vy.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=mi.inflate(r,a),o===Af&&i&&(o=mi.inflateSetDictionary(r,i),o===Ys?o=mi.inflate(r,a):o===wy&&(o=Af));r.avail_in>0&&o===Tf&&r.state.wrap>0&&t[r.next_in]!==0;)mi.inflateReset(r),o=mi.inflate(r,a);switch(o){case ik:case wy:case Af:case ok:return this.onEnd(o),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(r.avail_out===0||o===Tf))if(this.options.to==="string"){let c=Zs.utf8border(r.output,r.next_out),l=r.next_out-c,u=Zs.buf2string(r.output,c);r.next_out=l,r.avail_out=n-l,l&&r.output.set(r.output.subarray(c,c+l),0),this.onData(u)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===Ys&&s===0)){if(o===Tf)return o=mi.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},Js.prototype.onData=function(t){this.chunks.push(t)},Js.prototype.onEnd=function(t){t===Ys&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Xl.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function kf(t,e){const r=new Js(e);if(r.push(t),r.err)throw r.msg||bo[r.err];return r.result}function ak(t,e){return e=e||{},e.raw=!0,kf(t,e)}var sk=Js,ck=kf,lk=ak,uk=kf,dk=_o,hk={Inflate:sk,inflate:ck,inflateRaw:lk,ungzip:uk,constants:dk};const{Deflate:fk,deflate:pk,deflateRaw:gk,gzip:mk}=_A,{Inflate:vk,inflate:wk,inflateRaw:yk,ungzip:bk}=hk;var _k=fk,xk=pk,Sk=gk,Ck=mk,Ek=vk,Rk=wk,Tk=yk,yy=bk,Ak=_o,FD={Deflate:_k,deflate:xk,deflateRaw:Sk,gzip:Ck,Inflate:Ek,inflate:Rk,inflateRaw:Tk,ungzip:yy,constants:Ak};const To=(0,C.loadMessageBundle)(),nu=new TextDecoder,iu=new TextEncoder;class kk{constructor(e,r=0){this.retainFor=r;try{this.weakRef=new WeakRef(e)}catch{}this.retain(e)}retain(e){this.retainTimeout&&clearTimeout(this.retainTimeout),this.strongRef=e,this.retainTimeout=setTimeout(()=>{this.strongRef=void 0,this.retainTimeout=void 0},this.retainFor)}deref(){var e,r;const n=(r=this.strongRef)!=null?r:(e=this.weakRef)==null?void 0:e.deref();return n&&this.retain(n),n}}class Ik{constructor(e,r){this.root=e,this.providerService=r,this._onDidChangeIndexingEnablement=new d.EventEmitter,this._onDidDownloadTar=new d.EventEmitter,this.ongoingRequests=new Map,this.usageFile=d.Uri.joinPath(this.root,"usageHistory.json"),this.indexingAllowanceFile=d.Uri.joinPath(this.root,"indexAllowances.json"),this._disposable=d.Disposable.from(...this.registerCommands()),this.updateContext()}get onDidChangeIndexingEnablement(){return this._onDidChangeIndexingEnablement.event}get onDidDownloadTar(){return this._onDidDownloadTar.event}async updateContext(){await ui(Nn.HasSearchIndexes,(await this.listTars()).length>0);const e=this.providerService.repositories.map(i=>i.name),r=await this.getIndexingEnabledRepos(),n=r.has("*")||e.every(i=>r.has(i));await ui(Nn.EnabledSomeSearchIndexes,r.size>0),await ui(Nn.EnabledAllSearchIndexes,n)}dispose(){this._disposable.dispose()}registerCommands(){return[d.commands.registerCommand("remoteHub.configureIndexingAllowedRepos",async()=>{await this.configureIndexingAllowedRepos()}),d.commands.registerCommand("remoteHub.enableIndexing",async()=>{const e={title:To("search download prompt enable","Enable")},r={title:To("search download prompt enable always","Always Enable")},n={title:To("search download prompt configure","Configure")},i={title:To("search download prompt cancel","Cancel"),isCloseAffordance:!0},o=await d.window.showInformationMessage(To("search download prompt",`Indexing creates a copy of this repository in your browser's storage in order to provide enhanced text searches.

Without indexing, searches will use GitHub's text search, which is imprecise.

Do you want to enable creating local indexes for this repository on this browser? You should only enable indexing on machines you trust.`),{modal:!0,useCustom:!0},e,r,n,i);if(o===n&&await d.commands.executeCommand("workbench.action.openSettings","remoteHub.search.download"),o===e)return await this.markIndexingEnabledForRepos(...this.providerService.repositories.map(a=>a.name)),{triggerSearch:!0};if(o===r)return await this.markIndexingEnabledForRepos("*"),{triggerSearch:!0}}),d.commands.registerCommand("remoteHub.deleteLocalRepositoryData",async()=>{const e=i=>{const o=[{power:9,name:"GB"},{power:6,name:"MB"},{power:3,name:"kB"},{power:0,name:"B"}];for(const a of o)if(i>10**a.power)return`${Math.round(i/10**a.power)} ${a.name}`;return"Unknown size"},r=await this.listTars();if(r.length===0){await d.window.showInformationMessage("No Search Indexes Found");return}const n=d.window.createQuickPick();n.canSelectMany=!0,n.items=r.map(({name:i,size:o,path:a})=>({label:i,path:a,description:o?e(o):void 0})),n.show(),n.onDidAccept(async()=>{n.hide();for(const{label:i,path:o}of n.selectedItems){const a=d.workspace.fs.delete(o),s=d.window.setStatusBarMessage(`$(loading) Deleting ${i}`,a);await a,s.dispose()}this.updateContext()}),n.onDidHide(()=>n.dispose())}),d.commands.registerCommand("remoteHub.deleteAllLocalRepositoryData",()=>d.window.withProgress({location:d.ProgressLocation.Notification,title:"Deleting Search Indexes..."},async()=>{await Promise.all([d.workspace.fs.delete(this.root,{recursive:!0})]),this.updateContext()}))]}getTarFromMemory(e){var r;if(e===this.lastReadKey){const n=(r=this.lastReadValue)==null?void 0:r.deref();if(n)return n;K.log("Weakref deallocated.")}}async getTarFromDisk(e){try{const r=await d.workspace.fs.readFile(e);return!r||!r.length?void 0:r}catch(r){if(r.code!=="FileNotFound")throw r;return}}async getTarFromNetwork(e){if(!await this.isIndexingEnabledForRepo(e))throw Error("Unable to search without indexing allowed");const r=await this.providerService.getTarGz(e);if(r===void 0)throw Error("Unable to search without an index");return this.updateContext(),r}async getTar(e,r){r===void 0&&({HEAD:{sha:r}}=await this.providerService.getMetadata(e)),e=this.providerService.getCanonicalUri(e);const n=this.getTarStorageUri(e,r),i=n.toString();try{let o=this.ongoingRequests.get(i);return o===void 0&&(o=this.getTarCore(e,r,n),this.ongoingRequests.set(i,o)),await o}finally{this.ongoingRequests.delete(i)}}async getCachedTar(e,r){return e=this.providerService.getCanonicalUri(e),this.getTarCore(e,r,this.getTarStorageUri(e,r),{skipDownload:!0})}async getTarCore(e,r,n,i){var o;const a=`${Eu(e,{excludeScheme:!0})}/${r}`,s=new $e(`TarPit.getTar(${a})`),c=n.toString(),l=Date.now();let u,h;try{if(s.logStep("Getting .tar from memory",{suffix:" \u2022 Getting .tar from memory..."}),h=this.getTarFromMemory(c),h)return u=" \u2022 Got .tar from memory",h;s.logStep("Getting .tar from disk",{message:": Not found \u2022",suffix:" \u2022 Getting .tar from disk..."});let f=!1,p=await this.getTarFromDisk(n);if(p==null?void 0:p.length)u=" \u2022 Got .tar from disk";else{if(i==null?void 0:i.skipDownload){u=" \u2022 Skipped download";return}s.logStep("Getting .tar from network",{message:": Not found \u2022",suffix:" \u2022 Getting .tar from network..."}),p=await this.getTarFromNetwork(e),f=!0,u=" \u2022 Got .tar from network",d.workspace.fs.writeFile(n,p).then(()=>K.debug(`Sucessfully wrote tarball to disk in ${Date.now()-l}ms`),y=>K.error(y,`Error writing tarball to disk in ${Date.now()-l}ms`))}if(!(p==null?void 0:p.length))throw new Error("Internal Error: Invalid search index. Try deleting repository data and running search again: `GitHub Repositories: Delete Local Repository Data...`");s.logStep("Unzipping .tar",{suffix:" \u2022 Unzipping .tar..."});const b=yy(p);s.logStep("Parsing .tar",{suffix:" \u2022 Parsing .tar..."}),h=(0,NR.t9)(b),s.logStep("Fixing up .tar entries",{suffix:" \u2022 Fixing up .tar entries..."});const w=[];for(const y of h.entries)((o=y.header.typeFlag)==null?void 0:o.name)==="Normal"&&(y.header.fullFileName=y.header.fullFileName.replace(/^[^/]+\/?/,""),w.push(y));return h.entries=w,this.lastReadValue=new kk(h,Date.now()-l),this.lastReadKey=c,f&&setTimeout(()=>this._onDidDownloadTar.fire({rootUri:e,sha:r}),0),h}catch(f){throw u=` \u2022 Failed; ${String(f)}`,f}finally{h&&(this.markCacheEntryUsed(`${a}`).catch(f=>K.log(`Error marking entry used: ${f}`)),this.cleanUpCache().catch(f=>K.log(`Error cleaning cache: ${f}`))),s.stop(u?{suffix:u}:void 0)}}getTarStorageUri(e,r){return d.Uri.joinPath(this.root,"tars",Eu(e,{excludeScheme:!0}),r)}async readDir(e){try{return(await d.workspace.fs.readDirectory(e)).map(r=>d.Uri.joinPath(e,r[0]))}catch{return[]}}async isIndexingEnabledForRepo(e){const r=await this.getIndexingEnabledRepos();if(r.has("*"))return!0;const{name:n}=this.providerService.getVirtualUriMetadata(e);return n?r.has(n):!1}async configureIndexingAllowedRepos(){const e=[...(await this.getIndexingEnabledRepos()).values()],r=await d.window.showQuickPick(e.map(n=>({picked:!0,description:n==="*"?To("all","All Repositories"):"",label:n})),{canPickMany:!0,title:To("select repos where indexing is allowed","Select repositories that should be indexed")});r&&await this.resetIndexingAllowedRepos(r.map(n=>n.label))}async getIndexingEnabledRepos(){let e;try{e=JSON.parse(nu.decode(await d.workspace.fs.readFile(this.indexingAllowanceFile)))}catch(r){r instanceof d.FileSystemError&&r.code!==d.FileSystemError.FileNotFound().code&&K.error(r,"Error reading index allowance data."),e=[]}return new Set(e)}async listTars(){const e=await this.readDir(d.Uri.joinPath(this.root,"tars")).catch(()=>[]),r=(await Promise.all(e.map(o=>this.readDir(o)))).flat(),n=(await Promise.all(r.map(o=>this.readDir(o)))).flat(),i=(await Promise.all(n.map(o=>this.readDir(o)))).flat();return Promise.all(i.map(async o=>({name:o.path.replace(/^.*\/tars\//,""),path:o,size:(await d.workspace.fs.stat(o)).size})))}async resetIndexingAllowedRepos(e){await d.workspace.fs.writeFile(this.indexingAllowanceFile,iu.encode(JSON.stringify(e))),await this.updateContext(),setTimeout(()=>this._onDidChangeIndexingEnablement.fire(),0)}async markIndexingEnabledForRepos(...e){let r;try{r=JSON.parse(nu.decode(await d.workspace.fs.readFile(this.indexingAllowanceFile)))}catch(n){n instanceof d.FileSystemError&&n.code!==d.FileSystemError.FileNotFound().code&&K.error(n,"Error reading index allowance data."),r=[]}for(const n of e)r.includes(n)||r.push(n);await d.workspace.fs.writeFile(this.indexingAllowanceFile,iu.encode(JSON.stringify(r))),await this.updateContext(),setTimeout(()=>this._onDidChangeIndexingEnablement.fire(),0)}async markCacheEntryUsed(e){let r;try{r=JSON.parse(nu.decode(await d.workspace.fs.readFile(this.usageFile)))}catch(n){n instanceof d.FileSystemError&&n.code!==d.FileSystemError.FileNotFound().code&&K.error(n,"Error reading usage data."),r={}}r[e]=Number(Date.now()),await d.workspace.fs.writeFile(this.usageFile,iu.encode(JSON.stringify(r)))}async cleanUpCache(){var e,r;K.log("Cleaning up search cache...");const n=await this.listTars();let i;try{i=JSON.parse(nu.decode(await d.workspace.fs.readFile(this.usageFile)))}catch(h){h instanceof d.FileSystemError&&h.code!==d.FileSystemError.FileNotFound().code&&K.error(h,"Error reading usage data. All existing indexes will be discarded."),i={}}const o=[];n.forEach(h=>{var f;const p=/^([^/]*\/[^/]*)\//.exec(h.name);if(!p)throw Error("Unexpected repo entry");const b=p[1],w=(f=i[h.name])!=null?f:0;o.push({...h,lastUsed:w,repo:b})}),o.sort((h,f)=>f.lastUsed-h.lastUsed);let a=0;const s=[],c=new Map,l=((e=Ye.get("search.download.sizeLimit"))!=null?e:100)*1024*1024,u=(r=Ye.get("search.download.repoLimit"))!=null?r:4;o.forEach(h=>{var f,p;(h.lastUsed===0||a>l||((f=c.get(h.repo))!=null?f:0)>u)&&s.push(h),a+=h.size,c.set(h.repo,((p=c.get(h.repo))!=null?p:0)+1)}),await Promise.all(s.map(async h=>{try{await d.workspace.fs.delete(h.path,{recursive:!0}),delete i[h.name],K.log(`Deleted cache entry for ${h.name}`)}catch(f){K.log(`Deleting cache entry for ${h.name} failed; ${String(f)}`)}})),await d.workspace.fs.writeFile(this.usageFile,iu.encode(JSON.stringify(i))),await this.updateContext()}}const Dk=(0,C.loadMessageBundle)();async function Pk(t,e,r,n,i,o,a){return If("provideTextSearchResults",async()=>{const s=DR(n.pattern,Boolean(n.isRegExp),{matchCase:n.isCaseSensitive,wholeWord:n.isWordMatch,multiline:n.isMultiline,global:!0}),c=await If("fetch tarball",async()=>{let y;const x=r.getTar(i.folder).then(S=>(y=S,y));return Promise.race([x,(async()=>(await new Promise(S=>setTimeout(S,2e3)),y||d.window.withProgress({location:d.ProgressLocation.Notification,title:Dk("fetching index","Fetching search index...")},()=>x)))()])});if(a.isCancellationRequested)return{limitHit:!1};const{maxResults:l,maxFileSize:u,includes:h,excludes:f}=i,p=await Fk(i.folder,t,c,e);if(a.isCancellationRequested)return{limitHit:!0};let b=l;const w=PR(p,h,f,u);return If("searchFiles",async()=>{var y,x;let S=0;for(const I of p){if(!w.has(I.path))continue;const D=FR(I.contents,I.path,s,{beforeContext:(y=i.beforeContext)!=null?y:0,afterContext:(x=i.afterContext)!=null?x:0,previewOptions:i.previewOptions,remainingResultQuota:b});for(const U of D)o.report({...U,uri:d.Uri.joinPath(i.folder,U.uri.path)});if(b-=D.length,b<=0)return{limitHit:!0};if(S++,S%1e4==0&&(await new Promise(U=>setTimeout(U,0)),a.isCancellationRequested))return{limitHit:!1}}return{limitHit:!1}})})}async function Fk(t,e,r,n){const i=r.entries,o=e.getVirtualRootUri(t),a=await n.getChanges(o,{predicate:h=>h.fileType===d.FileType.File});if(a.length===0)return i.map(h=>({contents:h.dataAsBytes,path:h.header.fullFileName,size:h.dataAsBytes.byteLength}));const s=await Promise.all(bc(a,h=>{if(h.type===rt.Created)return n.getContent(h.uri).then(f=>({path:e.getRelativeFilePath(o,h.uri),size:f.length,contents:f}))})),c=await Promise.all(bc(a,h=>{if(h.type===rt.Changed)return n.getContent(h.uri).then(f=>({path:e.getRelativeFilePath(o,h.uri),size:f.length,contents:f}))})),l=new Set(IS(Wa(c,h=>h.path),bc(a,h=>{if(h.type===rt.Deleted)return e.getRelativeFilePath(o,h.uri)})));return[...bc(i,h=>{if(!l.has(h.header.fullFileName))return{contents:h.dataAsBytes,path:h.header.fullFileName,size:h.dataAsBytes.byteLength}}),...s,...c]}function ND(t,e){const r=Date.now(),n=e();return Logger.log(`${t} time: ${Date.now()-r}`),n}async function If(t,e){const r=Date.now(),n=await e();return K.log(`${t} time: ${Date.now()-r}`),n}var Nk=Object.defineProperty,$k=Object.getOwnPropertyDescriptor,Df=(t,e,r,n)=>{for(var i=n>1?void 0:n?$k(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&Nk(e,r,i),i};const Pf=(0,C.loadMessageBundle)(),Mk=d.FileSystemError.FileNotFound().code,Bk=/(\/|\\)/g,by=".vscode/.github-pull-request.rec";class ou{constructor(e,r,n,i){this.providerService=e,this.github=r,this.changeStore=n,this.tarPit=i,this._onDidChangeFile=new d.EventEmitter,this.fileSearchCache=new Map,this.pendingUriRequests=new Map,this.pendingUriRequestsEventDelay=10,this.implicitlyWatchedUris=new Map,this.watchedUris=new Map,this.disposable=d.Disposable.from(d.workspace.registerFileSystemProvider(this.scheme,this,{isCaseSensitive:!0,isReadonly:!0}),d.workspace.registerFileSearchProvider(this.scheme,this),d.workspace.registerTextSearchProvider(this.scheme,this),e.onDidChangeRepository(o=>{o.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([o.repository.uri])}),e.onDidRefresh(o=>this.onRefreshOrRepositoryChanged(o)))}get onDidChangeFile(){return this._onDidChangeFile.event}get scheme(){return this.github.scheme}dispose(){var e;(e=this.disposable)==null||e.dispose()}onRefreshOrRepositoryChanged(e){if(e=e.filter(r=>Pt.getProviderId(r)===this.scheme).map(r=>this.providerService.getProviderUri(r)),e.length!==0){K.log(`GitHubFS.onRefreshOrRepositoryChanged(${e.map(r=>r.toString()).join(", ")})`),this.fileSearchCache.clear();for(const[r,n]of[...this.pendingUriRequests])e.some(i=>Kn(n.uri,i))&&(this.pendingUriRequests.delete(r),n.outdated=!0);this.updateOpenOrWatchedUris(e)}}updateOpenOrWatchedUris(e){const r=this.providerService.getOpenUris(this.scheme,e);for(const[i,o]of[...this.watchedUris,...this.implicitlyWatchedUris])e.some(a=>Kn(o,a))&&(this.implicitlyWatchedUris.delete(i),r.set(i,o));K.debug(`GitHubFS.updateOpenOrWatchedUris(${e.map(i=>i.toString()).join(", ")}): uris=${r.size}`);for(const i of e)r.set(we(i),i);const n=[...r.values()].map(i=>({type:d.FileChangeType.Changed,uri:i}));setTimeout(()=>{K.debug(`GitHubFS.updateOpenOrWatchedUris: Firing events=${n.map(i=>i.uri.toString()).join(", ")}`),this._onDidChangeFile.fire(n)},0)}watch(e,r){const n=we(e);return this.watchedUris.set(n,e),{dispose:()=>{this.watchedUris.delete(n)}}}async stat(e){var r,n;const i=we(e);this.implicitlyWatchedUris.set(i,e);const o=this.providerService.getRelativeFilePath(e),a={uri:e,outdated:!1};try{this.pendingUriRequests.set(`stat:${i}`,a);const s=await this.github.getFileTree(e),c=await s.get(o);if(c==null?void 0:c.stat)return c==null?void 0:c.stat;if(this.implicitlyWatchedUris.delete(i),e.query==="~")return{type:d.FileType.File,size:0,ctime:0,mtime:(r=s.timestamp)!=null?r:Date.now(),permissions:d.FilePermission.Readonly};if(o===by){const{ref:l}=this.providerService.getVirtualUriMetadata(e);if((l==null?void 0:l.type)===Ue.PullRequest)return{type:d.FileType.File,size:0,ctime:0,mtime:(n=s.timestamp)!=null?n:Date.now(),permissions:d.FilePermission.Readonly}}throw d.FileSystemError.FileNotFound(e)}finally{this.pendingUriRequests.delete(`stat:${i}`),(a==null?void 0:a.outdated)&&setTimeout(()=>{K.log(`GitHubFS.stat(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:d.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}async readDirectory(e,r){this.implicitlyWatchedUris.set(we(e),e);const n=await this.github.getFileTree(e),i=this.providerService.getRelativeFilePath(e),o=(await n.getChildren(i,r)).map(([a,{stat:{type:s}}])=>[a,s]);return i===""&&$e.stop("Time to root directory"),o}createDirectory(e){throw d.FileSystemError.NoPermissions()}async readFile(e){const r=we(e);this.implicitlyWatchedUris.set(r,e);const n={uri:e,outdated:!1};try{return this.pendingUriRequests.set(r,n),await this.github.getFileContent(e)}catch(i){if(this.implicitlyWatchedUris.delete(r),i instanceof d.FileSystemError&&i.code===Mk){if(e.query==="~")return new Uint8Array(0);if(this.providerService.getRelativeFilePath(e)===by){const{ref:a}=this.providerService.getVirtualUriMetadata(e);if((a==null?void 0:a.type)===Ue.PullRequest)return new Uint8Array(0)}}throw i}finally{this.pendingUriRequests.delete(r),(n==null?void 0:n.outdated)&&setTimeout(()=>{K.log(`GitHubFS.readFile(${e.toString()}): Repository changed; firing change event...`),this._onDidChangeFile.fire([{type:d.FileChangeType.Changed,uri:e}])},this.pendingUriRequestsEventDelay)}}writeFile(e,r,n){throw d.FileSystemError.NoPermissions()}delete(e,r){throw d.FileSystemError.NoPermissions()}rename(e,r,n){throw d.FileSystemError.NoPermissions()}copy(e,r,n){throw d.FileSystemError.NoPermissions()}async provideFileSearchResults(e,{folder:r,maxResults:n,includes:i,excludes:o},a){const s=`${we(r)}|${JSON.stringify({includes:i,excludes:o})}`;let c=this.fileSearchCache.get(s);if(c===void 0){const u=this.providerService.getRelativeFilePath(r);let h;await this.github.hasFileTree(r)&&(h=await this.github.getFileTree(r));let f;if(h===void 0||h.loading||!h.hasEntireTree?f=await this.github.getFileList(r,u):f=(await h.getChildren(u,{filter:d.FileType.File,recursive:!0})).map(([p])=>p),f.length===0||a.isCancellationRequested)return[];((i==null?void 0:i.length)||(o==null?void 0:o.length))&&(f=[...Uh(f,i,o)]),c=f.map(p=>ha.prepareSlow(p)),this.fileSearchCache.set(s,c)}let l;return e.pattern===""?l=c.map(u=>d.Uri.joinPath(r,u.target)):(l=ha.go(e.pattern.replace(Bk,"/"),c,{allowTypo:!0,limit:n}).map(u=>d.Uri.joinPath(r,u.target)),ha.cleanup()),n!==void 0&&n!==0&&n<l.length&&(l=l.slice(0,n)),l}async provideTextSearchResults(e,r,n,i){const o=[];if(await this.tarPit.isIndexingEnabledForRepo(r.folder))try{return Pk(this.providerService,this.changeStore,this.tarPit,e,r,n,i)}catch{o.push({text:Pf("index error","Error searching index, falling back to GitHub search. Try [deleting this repo's data]({0}) or [deleting all local data]({1}) to rebuild the index.","command:remoteHub.deleteLocalRepositoryData","command:remoteHub.deleteAllLocalRepositoryData"),type:d.TextSearchCompleteMessageType.Warning})}e.isCaseSensitive||e.isRegExp||e.isWordMatch?o.push({text:Pf("flags not supported","Search flags are not supported by GitHub search. [Enable indexing]({0}) for full search features and exact text searches.","command:remoteHub.enableIndexing"),type:d.TextSearchCompleteMessageType.Warning,trusted:!0}):o.push({text:Pf("enable index","Currently using GitHub text search. [Enable indexing]({0}) for exact text searches.","command:remoteHub.enableIndexing"),type:d.TextSearchCompleteMessageType.Information,trusted:!0});const a=await this.github.searchCodeQuery(e.pattern,r.folder,{maxResults:r.maxResults,context:{before:r.beforeContext,after:r.afterContext}});if(a.warnings&&a.warnings.forEach(c=>{o.push({text:c,trusted:!0,type:d.TextSearchCompleteMessageType.Warning})}),a===void 0)return{limitHit:!0,message:o};let s;for(const c of a.matches)s=d.Uri.joinPath(r.folder,c.path),n.report({uri:s,ranges:c.ranges,preview:{text:c.preview,matches:c.matches}});return{limitHit:!1,message:o}}}Df([xn()],ou.prototype,"stat",1),Df([xn()],ou.prototype,"readDirectory",1),Df([xn()],ou.prototype,"readFile",1);var Ok=__webpack_require__(6470),ec=__webpack_require__(4155);function au(){return typeof navigator=="object"&&"userAgent"in navigator?navigator.userAgent:typeof ec=="object"&&"version"in ec?`Node.js/${ec.version.substr(1)} (${ec.platform}; ${ec.arch})`:"<environment undetectable>"}var Uk=__webpack_require__(5186);/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function _y(t){return Object.prototype.toString.call(t)==="[object Object]"}function xy(t){var e,r;return _y(t)===!1?!1:(e=t.constructor,e===void 0?!0:(r=e.prototype,!(_y(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)))}function Lk(t){return t?Object.keys(t).reduce((e,r)=>(e[r.toLowerCase()]=t[r],e),{}):{}}function Sy(t,e){const r=Object.assign({},t);return Object.keys(e).forEach(n=>{xy(e[n])?n in t?r[n]=Sy(t[n],e[n]):Object.assign(r,{[n]:e[n]}):Object.assign(r,{[n]:e[n]})}),r}function Cy(t){for(const e in t)t[e]===void 0&&delete t[e];return t}function Ff(t,e,r){if(typeof e=="string"){let[i,o]=e.split(" ");r=Object.assign(o?{method:i,url:o}:{url:i},r)}else r=Object.assign({},e);r.headers=Lk(r.headers),Cy(r),Cy(r.headers);const n=Sy(t||{},r);return t&&t.mediaType.previews.length&&(n.mediaType.previews=t.mediaType.previews.filter(i=>!n.mediaType.previews.includes(i)).concat(n.mediaType.previews)),n.mediaType.previews=n.mediaType.previews.map(i=>i.replace(/-preview/,"")),n}function Hk(t,e){const r=/\?/.test(t)?"&":"?",n=Object.keys(e);return n.length===0?t:t+r+n.map(i=>i==="q"?"q="+e.q.split("+").map(encodeURIComponent).join("+"):`${i}=${encodeURIComponent(e[i])}`).join("&")}const qk=/\{[^}]+\}/g;function Wk(t){return t.replace(/^\W+|\W+$/g,"").split(/,/)}function zk(t){const e=t.match(qk);return e?e.map(Wk).reduce((r,n)=>r.concat(n),[]):[]}function Ey(t,e){return Object.keys(t).filter(r=>!e.includes(r)).reduce((r,n)=>(r[n]=t[n],r),{})}function Ry(t){return t.split(/(%[0-9A-Fa-f]{2})/g).map(function(e){return/%[0-9A-Fa-f]/.test(e)||(e=encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]")),e}).join("")}function Ea(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function tc(t,e,r){return e=t==="+"||t==="#"?Ry(e):Ea(e),r?Ea(r)+"="+e:e}function Ra(t){return t!=null}function Nf(t){return t===";"||t==="&"||t==="?"}function jk(t,e,r,n){var i=t[r],o=[];if(Ra(i)&&i!=="")if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")i=i.toString(),n&&n!=="*"&&(i=i.substring(0,parseInt(n,10))),o.push(tc(e,i,Nf(e)?r:""));else if(n==="*")Array.isArray(i)?i.filter(Ra).forEach(function(a){o.push(tc(e,a,Nf(e)?r:""))}):Object.keys(i).forEach(function(a){Ra(i[a])&&o.push(tc(e,i[a],a))});else{const a=[];Array.isArray(i)?i.filter(Ra).forEach(function(s){a.push(tc(e,s))}):Object.keys(i).forEach(function(s){Ra(i[s])&&(a.push(Ea(s)),a.push(tc(e,i[s].toString())))}),Nf(e)?o.push(Ea(r)+"="+a.join(",")):a.length!==0&&o.push(a.join(","))}else e===";"?Ra(i)&&o.push(Ea(r)):i===""&&(e==="&"||e==="?")?o.push(Ea(r)+"="):i===""&&o.push("");return o}function Vk(t){return{expand:Gk.bind(null,t)}}function Gk(t,e){var r=["+","#",".","/",";","?","&"];return t.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(n,i,o){if(i){let s="";const c=[];if(r.indexOf(i.charAt(0))!==-1&&(s=i.charAt(0),i=i.substr(1)),i.split(/,/g).forEach(function(l){var u=/([^:\*]*)(?::(\d+)|(\*))?/.exec(l);c.push(jk(e,s,u[1],u[2]||u[3]))}),s&&s!=="+"){var a=",";return s==="?"?a="&":s!=="#"&&(a=s),(c.length!==0?s:"")+c.join(a)}else return c.join(",")}else return Ry(o)})}function Ty(t){let e=t.method.toUpperCase(),r=(t.url||"/").replace(/:([a-z]\w+)/g,"{$1}"),n=Object.assign({},t.headers),i,o=Ey(t,["method","baseUrl","url","headers","request","mediaType"]);const a=zk(r);r=Vk(r).expand(o),/^http/.test(r)||(r=t.baseUrl+r);const s=Object.keys(t).filter(u=>a.includes(u)).concat("baseUrl"),c=Ey(o,s);if(!/application\/octet-stream/i.test(n.accept)&&(t.mediaType.format&&(n.accept=n.accept.split(/,/).map(u=>u.replace(/application\/vnd(\.\w+)(\.v3)?(\.\w+)?(\+json)?$/,`application/vnd$1$2.${t.mediaType.format}`)).join(",")),t.mediaType.previews.length)){const u=n.accept.match(/[\w-]+(?=-preview)/g)||[];n.accept=u.concat(t.mediaType.previews).map(h=>{const f=t.mediaType.format?`.${t.mediaType.format}`:"+json";return`application/vnd.github.${h}-preview${f}`}).join(",")}return["GET","HEAD"].includes(e)?r=Hk(r,c):"data"in c?i=c.data:Object.keys(c).length?i=c:n["content-length"]=0,!n["content-type"]&&typeof i!="undefined"&&(n["content-type"]="application/json; charset=utf-8"),["PATCH","PUT"].includes(e)&&typeof i=="undefined"&&(i=""),Object.assign({method:e,url:r,headers:n},typeof i!="undefined"?{body:i}:null,t.request?{request:t.request}:null)}function Kk(t,e,r){return Ty(Ff(t,e,r))}function Ay(t,e){const r=Ff(t,e),n=Kk.bind(null,r);return Object.assign(n,{DEFAULTS:r,defaults:Ay.bind(null,r),merge:Ff.bind(null,r),parse:Ty})}const Zk=`octokit-endpoint.js/6.0.12 ${au()}`,Xk=Ay(null,{method:"GET",baseUrl:"https://api.github.com",headers:{accept:"application/vnd.github.v3+json","user-agent":Zk},mediaType:{format:"",previews:[]}});var Qk=__webpack_require__(3672),Yk=__webpack_require__.n(Qk);const Jk="5.6.1";function eI(t){return t.arrayBuffer()}function ky(t){const e=t.request&&t.request.log?t.request.log:console;(xy(t.body)||Array.isArray(t.body))&&(t.body=JSON.stringify(t.body));let r={},n,i;return(t.request&&t.request.fetch||Yk())(t.url,Object.assign({method:t.method,body:t.body,headers:t.headers,redirect:t.redirect},t.request)).then(async a=>{i=a.url,n=a.status;for(const s of a.headers)r[s[0]]=s[1];if("deprecation"in r){const s=r.link&&r.link.match(/<([^>]+)>; rel="deprecation"/),c=s&&s.pop();e.warn(`[@octokit/request] "${t.method} ${t.url}" is deprecated. It is scheduled to be removed on ${r.sunset}${c?`. See ${c}`:""}`)}if(!(n===204||n===205)){if(t.method==="HEAD"){if(n<400)return;throw new Cn(a.statusText,n,{response:{url:i,status:n,headers:r,data:void 0},request:t})}if(n===304)throw new Cn("Not modified",n,{response:{url:i,status:n,headers:r,data:await $f(a)},request:t});if(n>=400){const s=await $f(a);throw new Cn(tI(s),n,{response:{url:i,status:n,headers:r,data:s},request:t})}return $f(a)}}).then(a=>({status:n,url:i,headers:r,data:a})).catch(a=>{throw a instanceof Cn?a:new Cn(a.message,500,{request:t})})}async function $f(t){const e=t.headers.get("content-type");return/application\/json/.test(e)?t.json():!e||/^text\/|charset=utf-8$/.test(e)?t.text():eI(t)}function tI(t){return typeof t=="string"?t:"message"in t?Array.isArray(t.errors)?`${t.message}: ${t.errors.map(JSON.stringify).join(", ")}`:t.message:`Unknown error: ${JSON.stringify(t)}`}function Mf(t,e){const r=t.defaults(e);return Object.assign(function(i,o){const a=r.merge(i,o);if(!a.request||!a.request.hook)return ky(r.parse(a));const s=(c,l)=>ky(r.parse(r.merge(c,l)));return Object.assign(s,{endpoint:r,defaults:Mf.bind(null,r)}),a.request.hook(s,a)},{endpoint:r,defaults:Mf.bind(null,r)})}const su=Mf(Xk,{headers:{"user-agent":`octokit-request.js/${Jk} ${au()}`}}),rI="4.8.0";function nI(t){return`Request failed due to following response errors:
`+t.errors.map(e=>` - ${e.message}`).join(`
`)}class rc extends Error{constructor(e,r,n){super(nI(n));this.request=e,this.headers=r,this.response=n,this.name="GraphqlResponseError",this.errors=n.errors,this.data=n.data,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}const iI=["method","baseUrl","url","headers","request","query","mediaType"],oI=["query","method","url"],Iy=/\/api\/v3\/?$/;function aI(t,e,r){if(r){if(typeof e=="string"&&"query"in r)return Promise.reject(new Error('[@octokit/graphql] "query" cannot be used as variable name'));for(const a in r)if(!!oI.includes(a))return Promise.reject(new Error(`[@octokit/graphql] "${a}" cannot be used as variable name`))}const n=typeof e=="string"?Object.assign({query:e},r):e,i=Object.keys(n).reduce((a,s)=>iI.includes(s)?(a[s]=n[s],a):(a.variables||(a.variables={}),a.variables[s]=n[s],a),{}),o=n.baseUrl||t.endpoint.DEFAULTS.baseUrl;return Iy.test(o)&&(i.url=o.replace(Iy,"/api/graphql")),t(i).then(a=>{if(a.data.errors){const s={};for(const c of Object.keys(a.headers))s[c]=a.headers[c];throw new rc(i,s,a.data)}return a.data.data})}function Bf(t,e){const r=t.defaults(e);return Object.assign((i,o)=>aI(r,i,o),{defaults:Bf.bind(null,r),endpoint:su.endpoint})}const BD=Bf(su,{headers:{"user-agent":`octokit-graphql.js/${rI} ${au()}`},method:"POST",url:"/graphql"});function sI(t){return Bf(t,{method:"POST",url:"/graphql"})}const cI=/^v1\./,lI=/^ghs_/,uI=/^ghu_/;async function dI(t){const e=t.split(/\./).length===3,r=cI.test(t)||lI.test(t),n=uI.test(t);return{type:"token",token:t,tokenType:e?"app":r?"installation":n?"user-to-server":"oauth"}}function hI(t){return t.split(/\./).length===3?`bearer ${t}`:`token ${t}`}async function fI(t,e,r,n){const i=e.endpoint.merge(r,n);return i.headers.authorization=hI(t),e(i)}const pI=function(e){if(!e)throw new Error("[@octokit/auth-token] No token passed to createTokenAuth");if(typeof e!="string")throw new Error("[@octokit/auth-token] Token passed to createTokenAuth is not a string");return e=e.replace(/^(token|bearer) +/i,""),Object.assign(dI.bind(null,e),{hook:fI.bind(null,e)})},Dy="3.5.1";class cu{constructor(e={}){const r=new Uk.Collection,n={baseUrl:su.endpoint.DEFAULTS.baseUrl,headers:{},request:Object.assign({},e.request,{hook:r.bind(null,"request")}),mediaType:{previews:[],format:""}};if(n.headers["user-agent"]=[e.userAgent,`octokit-core.js/${Dy} ${au()}`].filter(Boolean).join(" "),e.baseUrl&&(n.baseUrl=e.baseUrl),e.previews&&(n.mediaType.previews=e.previews),e.timeZone&&(n.headers["time-zone"]=e.timeZone),this.request=su.defaults(n),this.graphql=sI(this.request).defaults(n),this.log=Object.assign({debug:()=>{},info:()=>{},warn:console.warn.bind(console),error:console.error.bind(console)},e.log),this.hook=r,e.authStrategy){const{authStrategy:o,...a}=e,s=o(Object.assign({request:this.request,log:this.log,octokit:this,octokitOptions:a},e.auth));r.wrap("request",s.hook),this.auth=s}else if(!e.auth)this.auth=async()=>({type:"unauthenticated"});else{const o=pI(e.auth);r.wrap("request",o.hook),this.auth=o}this.constructor.plugins.forEach(o=>{Object.assign(this,o(this,e))})}static defaults(e){return class extends this{constructor(...n){const i=n[0]||{};if(typeof e=="function"){super(e(i));return}super(Object.assign({},e,i,i.userAgent&&e.userAgent?{userAgent:`${i.userAgent} ${e.userAgent}`}:null))}}}static plugin(...e){var r;const n=this.plugins;return r=class extends this{},r.plugins=n.concat(e.filter(o=>!n.includes(o))),r}}cu.VERSION=Dy,cu.plugins=[];function gI(t,e){return t.reduce((n,i)=>{const o=e(i),a=n.get(o);return a===void 0?n.set(o,[i]):a.push(i),n},new Map)}function mI(t){let e=0;for(const r of t){if(r===0)return!0;if(e++,e>8e3)break}return!1}function Of(t,e,r=n=>n){return[...t.reduce((i,o)=>{const a=e(o),s=i.get(a);if(s===void 0)i.set(a,o);else{const c=r(s,o);c!==void 0&&i.set(a,c)}return i},new Map).values()]}function Uf(t){const e="$memoize$";return function(...r){return this.hasOwnProperty(e)||Object.defineProperty(this,e,{configurable:!1,enumerable:!1,writable:!1,value:t.apply(this,r)}),this[e]}}class Py{constructor(e,r){this.path=e,this.relativePath=r}}class vI{constructor(){this.root=new Py("","")}get(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;for(const i of e.split("/")){const o=(r=n.children)==null?void 0:r.get(i);if(o===void 0)return;n=o}return n.path===e?n.data:void 0}getChildren(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;if(e)for(const i of e.split("/")){const o=(r=n.children)==null?void 0:r.get(i);if(o===void 0)return[];n=o}return n.children===void 0?[]:[...n.children.values()].map(i=>[i.relativePath,i.data])}getDescendants(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;const i=[];if(e)for(const o of e.split("/")){const a=(r=n.children)==null?void 0:r.get(o);if(a===void 0)return i;n=a}if(n.children!==void 0){let o=function(a,s,c){for(const l of a.values()){const u=`${s?`${s}/`:""}${l.relativePath}`;l.data&&c.push([u,l.data]),l.children!==void 0&&o(l.children,u,c)}};o(n.children,"",i)}return i}has(e){var r;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let n=this.root;for(const i of e.split("/")){const o=(r=n.children)==null?void 0:r.get(i);if(o===void 0)return!1;n=o}return n.path===e}set(e,r){var n;e.startsWith("/")?e=e.slice(1,e.endsWith("/")?-1:void 0):e.endsWith("/")&&(e=e.slice(0,-1));let i=this.root,o="";for(const a of e.split("/")){let s=(n=i.children)==null?void 0:n.get(a);o=`${o?`${o}/`:""}${a}`,s===void 0&&(i.children===void 0&&(i.children=new Map),s=new Py(o,a),i.children.set(a,s)),i=s}i.data=r}}class Fy{constructor(e,r,n,i,o){if(this.rootUri=e,this.sha=r,this.timestamp=n,this.provider=i,this.trie=new vI,this._hasEntireTree=!1,this._isContentCached=!1,i===void 0)return;const a=[i];i.onDidTriggerContentCaching!==void 0&&i.tryCachingContent!==void 0&&a.push(i.onDidTriggerContentCaching(s=>{(!s||we(s.rootUri)===we(this.rootUri)&&s.sha===this.sha)&&!this.loading&&this.hasEntireTree&&!this.isContentCached&&i.tryCachingContent(this.trie.get.bind(this.trie)).then(c=>this._isContentCached=c,()=>this._isContentCached=!0)})),this._loading=this.load(o==null?void 0:o.path,o==null?void 0:o.recursive).then(s=>(this._hasEntireTree=(s==null?void 0:s.success)?s.recursive:!1,this._hasEntireTree&&setTimeout(()=>{var c;return void((c=i.tryCachingContent)==null?void 0:c.call(i,this.trie.get.bind(this.trie)).then(l=>this._isContentCached=l,()=>this._isContentCached=!0))},0),ME("_codespaces.webeditor.connectWorkspace",{result:(s==null?void 0:s.success)?"Success":"Failure",errorMessage:this._hasEntireTree?"":"Unable to load entire tree",errorDetail:(s==null?void 0:s.success)===!1?s.error:void 0}),this._loading=void 0,this.preloading=void 0,this.treeSha=(s==null?void 0:s.success)?s.sha:void 0,this.treeSha)),(o==null?void 0:o.preload)&&(this.preloading=new Map([["",this.load("")],[".vscode",this.load(".vscode")]])),this.disposable=d.Disposable.from(...a)}get hasEntireTree(){return this._hasEntireTree}get isContentCached(){return this._isContentCached}get loading(){return this._loading!==void 0}get permissions(){var e;return(e=this.provider)==null?void 0:e.permissions}dispose(){var e;(e=this.disposable)==null||e.dispose()}async get(e){var r;if(e==="")return{mode:"040000",sha:this.treeSha,stat:{type:d.FileType.Directory,size:0,ctime:0,mtime:(r=this.timestamp)!=null?r:Date.now(),permissions:await this.permissions},getContent:void 0};let n=this.trie.get(e);return n!==void 0||(await this.ensureLoaded(e),n=this.trie.get(e)),n}async getChildren(e,r){await this.ensureLoaded(e,!0);const n=(r==null?void 0:r.recursive)?this.trie.getDescendants(e):this.trie.getChildren(e);return(r==null?void 0:r.filter)===void 0?n:n.filter(([,i])=>i.stat.type===r.filter)}async getTreeSha(){return await this.waitUntilLoaded(),this.treeSha}async waitUntilLoaded(){this._loading!==void 0&&await this._loading}async ensureLoaded(e,r=!1){if(this._loading!==void 0){let i;if(this.preloading!==void 0)if(r)i=this.preloading.get(e);else{const o=AS(this.preloading,([a])=>e.startsWith(a)&&e.lastIndexOf("/")===(a?a.length:-1));i=o==null?void 0:o[1]}await(i!=null?i:this._loading)}if(this.hasEntireTree||e==="")return;let n=this.trie.get(e);if(n)return r&&(n==null?void 0:n.loadChildren)?n.loadChildren():void 0;if(await this.ensureLoaded(e.substr(0,e.lastIndexOf("/")),!0),n=this.trie.get(e),r&&(n==null?void 0:n.loadChildren))return n.loadChildren()}async load(e,r=!1){var n;if(((n=this.provider)==null?void 0:n.getTree)===void 0)return;const i=new $e(`FileTree.load(${this.sha}:${e})`);let o;try{i.logStep("Tree query");const a=await this.provider.getTree(e,r);if(a.truncated){K.warn(`Loading file tree for path=${e} was truncated`),i.logStep("Fixing directories",{message:`: Tree=${a.sha};`,suffix:" \u2022 Fixing directories..."});for(const[c,l]of this.trie.getDescendants(""))l.stat.type===d.FileType.Directory&&(l.loadChildren=Uf(()=>this.load(c).then(()=>l.loadChildren=void 0)));return o=` \u2022 Tree=${a.sha} \u2022 Truncated`,{sha:a.sha,recursive:!1,success:!0}}let s;this.permissions!==void 0&&(i.logStep("Permissions query",{message:`: Tree=${a.sha};`,suffix:" \u2022 Waiting for permissions..."}),s=await this.permissions),i.logStep("Filling trie",{suffix:" \u2022 Filling trie..."});for(let{path:c,item:l}of a.tree)if(c!==void 0){switch(c=e?`${e}/${c}`:c,l.stat.permissions=s,l.stat.type){case d.FileType.File:l.getContent=Uf(()=>this.provider.getContent(l));break;case d.FileType.Directory:r||(l.loadChildren=Uf(()=>this.load(c).then(()=>l.loadChildren=void 0)));break}this.trie.set(c,l)}return o=` \u2022 Tree=${a.sha}`,{sha:a.sha,recursive:r,success:!0}}catch(a){return o=`\u2022 Loading for path=${e} failed; ${String(a)}`,{error:a,success:!1}}finally{i.stop(o?{suffix:o}:void 0)}}}var wI=__webpack_require__(7769);const yI="github-pr-owner-number";function bI(t){return`branch.${t}.${yI}`}const _I=(0,C.loadMessageBundle)(),Ny=new TextDecoder;class xI{constructor(e,r,n,i,o,a){this.providerService=e,this.rootUri=r,this.sourceControl=n,this.metadata=i,this.changeStore=o,this.github=a,this._onDidChangeSelection=new d.EventEmitter,this._onDidChangeState=new d.EventEmitter,this._objects=new Map,this.disposable=d.Disposable.from(this.sourceControl.onDidChangeSelection(()=>this._onDidChangeSelection.fire()),this.providerService.onDidRefresh(l=>{const u=we(this.rootUri);!l.some(h=>we(h)===u)||this.updateState(this.metadata)}),this.providerService.onDidChangeRepository(async({repository:l})=>{we(this.rootUri)===we(l.uri)&&this.updateState(await l.getMetadata())}),this.changeStore.onDidChange(()=>this.updateState(this.metadata)),this._onDidChangeSelection,this._onDidChangeState),this._inputBox={get value(){return n.inputBox.value},set value(l){n.inputBox.value=l}},this._ui={get selected(){return n.selected},onDidChange:this._onDidChangeSelection.event};const{repo:{owner:s,name:c}}=i;this.remote={name:"origin",fetchUrl:`https://github.com/${s}/${c}.git`,isReadOnly:i.accessLevel<$t.Write},this.remotes=[this.remote],this._state={HEAD:this.getHEADFromMetadata(i),mergeChanges:[],indexChanges:[],workingTreeChanges:[],onDidChange:this._onDidChangeState.event,rebaseCommit:void 0,refs:[],remotes:this.remotes,submodules:[]},this.updateState(i)}dispose(){this.disposable.dispose()}get inputBox(){return this._inputBox}get state(){return this._state}get ui(){return this._ui}getHEADFromMetadata(e){switch(e.HEAD.type){case Le.Branch:return{type:Mn.Head,commit:e.HEAD.sha,name:e.HEAD.branch.name,upstream:{name:e.HEAD.branch.name,remote:this.remote.name}};case Le.RemoteBranch:{const r=e.HEAD.branch.remote.repo.owner,n=e.HEAD.branch.remote.accessLevel<$t.Write,i=this.remotes.findIndex(o=>o.name===r);return this.remotes.splice(i===-1?this.remotes.length:i,i===-1?0:1,{name:r,fetchUrl:`https://github.com/${e.HEAD.branch.remote.repo.owner}/${e.HEAD.branch.remote.repo.name}.git`,pushUrl:n?void 0:`https://github.com/${e.HEAD.branch.remote.repo.owner}/${e.HEAD.branch.remote.repo.name}.git`,isReadOnly:n}),{type:Mn.RemoteHead,commit:e.HEAD.sha,name:e.HEAD.branch.name,upstream:{name:e.HEAD.branch.name,remote:e.HEAD.branch.remote.repo.owner}}}case Le.Tag:return{type:Mn.Tag,name:e.HEAD.detached.name,commit:e.HEAD.sha};case Le.Commit:return{type:Mn.Head,commit:e.HEAD.sha}}}async updateState(e){this.metadata=e;const r=await this.changeStore.getGroupedChanges(this.rootUri,{predicate:s=>s.fileType===d.FileType.File}),n=r.conflicts.map(s=>({uri:s.uri,status:Lf(s.type),originalUri:s.uri,renameUri:s.uri})),i=r.staged.map(s=>({uri:s.uri,status:Lf(s.type),originalUri:s.uri,renameUri:s.uri})),o=r.working.map(s=>({uri:s.uri,status:Lf(s.type),originalUri:s.uri,renameUri:s.uri})),a=Ye.get("staging.enabled");this._state={...this._state,HEAD:this.getHEADFromMetadata(e),mergeChanges:n,indexChanges:a?i:[],workingTreeChanges:a?o:[...i,...o]},this._onDidChangeState.fire()}getConfigs(){return Promise.resolve([])}getConfig(e){return this.metadata.HEAD.branch&&this.metadata.pullRequest&&e===bI(this.metadata.HEAD.branch.name)?Promise.resolve(`${this.metadata.repo.owner}#${this.metadata.repo.name}#${this.metadata.pullRequest.id}`):Promise.resolve("")}setConfig(e,r){return Promise.resolve("")}getGlobalConfig(e){throw new Error("Method not implemented.")}async getObjectDetails(e,r){const n=new $e(`IGit.getObjectDetails(${e}, ${r})`);try{return await this.github.getObjectDetails(this.rootUri,e,this.pathToRelativePath(r))}finally{n.stop()}}async detectObjectType(e){var r;const n=new $e(`IGit.detectObjectType(${e})`);try{const i=await this.github.getBlobContent(this.metadata.repo,e);if(!mI(i))return{mimetype:"text/plain"};const a=await(0,wI.fromBuffer)(i);return{mimetype:(r=a==null?void 0:a.mime)!=null?r:"application/octet-stream"}}finally{n.stop()}}async buffer(e,r){const n=new $e(`IGit.buffer(${e}, ${r})`);try{return await this.github.getFileContent(this.rootUri,e,this.pathToRelativePath(r))}finally{n.stop()}}async show(e,r){const n=new $e(`IGit.show(${e}, ${r})`);try{const i=await this.github.getFileContent(this.rootUri,e,this.pathToRelativePath(r));return Ny.decode(i)}finally{n.stop()}}async getCommit(e){const r=new $e(`IGit.getCommit(${e})`);try{const n=await this.github.getCommit(this.rootUri,e);if(n===void 0)throw new Error(`Unable to find commit for ref "${e}"`);return n}finally{r.stop()}}clean(e){return this._objects.clear(),Promise.resolve()}async apply(e,r){const n=new $e(`IGit.apply(reverse=${r})`);try{return await this.changeStore.applyPatch(this.rootUri,e,r?{reverse:!0}:void 0)}finally{n.stop()}}async diff(e){const r=new $e(`IGit.diff(${e})`);try{return await this.changeStore.createPatch(this.rootUri,void 0,e?{staged:!0}:void 0)}finally{r.stop()}}diffWithHEAD(e){return e?this.diffBetween("","HEAD",e):this.diffBetween("","HEAD")}diffWith(e,r){return r?this.diffBetween("",e,r):this.diffBetween("",e)}diffIndexWithHEAD(e){return e?this.diffBetween("~","HEAD",e):this.diffBetween("~","HEAD")}diffIndexWith(e,r){return r?this.diffBetween("~",e,r):this.diffBetween("~",e)}async diffBetween(e,r,n){if(!n)throw new Error("Method not implemented.");const i=new $e(`IGit.diffBetween(${e}, ${r}, ${n})`);try{const[o,a]=await Promise.all([this.getContent(e,n),this.getContent(r,n)]);return Pu(n,o,a)}finally{i.stop()}}async diffBlobs(e,r){const n=new $e(`IGit.diffBlobs(${e}, ${r})`);try{const i=await this.getBlobContent(e),o=await this.getBlobContent(r),a=Pu("untitled",i,o);return Promise.resolve(a)}finally{n.stop()}}async getBlobContent(e){const r=new $e(`IGit.getBlobContent(${e})`);try{const n=this._objects.get(e);if(n)return this._objects.delete(e),n;const{repo:i}=this.providerService.getVirtualUriMetadata(this.rootUri),o=await this.github.getBlobContent(i,e);return Ny.decode(o)}finally{r.stop()}}async getContent(e,r){const n=new $e(`IGit.getContent(${e}, ${r})`);try{const i=this.pathToRelativeUri(r);if(e===""||e==="~"){const o=await this.changeStore.getChange(i);if(o!==void 0&&(e===""||o.staged))return this.changeStore.getContent(i);e="HEAD"}return await this.show(e==="HEAD"?this.metadata.HEAD.sha:e,r)}finally{n.stop()}}async hashObject(e){const r=new $e("IGit.hashObject");try{const n=ku(await ja(e));return this._objects.set(n,e),n}finally{r.stop()}}async createBranch(e,r,n){const i=new $e(`IGit.createBranch(${e}, ${r}, ${n})`);try{n||(n=this.metadata.HEAD.sha);const o=await this.github.createBranch(this.rootUri,e,n);r&&await this.checkout(o)}finally{i.stop()}}deleteBranch(e,r){throw new Error("Method not implemented.")}async getBranch(e){const r=new $e(`IGit.getBranch(${e})`);try{const{branches:n}=await this.github.getBranches(this.rootUri,{query:e,limit:1}),[i]=n;if(i===void 0)throw new Error(`Unable to find branch named "${e}"`);return{type:i.type,name:i.name,commit:i.commit,remote:this.remote.name,upstream:{name:i.name,remote:i.commitUrl}}}finally{r.stop()}}async getBranches(e){var r,n;const i=(n=(r=e.contains)!=null?r:e.pattern)!=null?n:"",o=new $e(`IGit.getBranches(${i})`);try{const{branches:a}=await this.github.getBranches(this.rootUri,{query:i,limit:e.count});if(a.length===0)throw new Error(`Unable to find branches for "${i}"`);return a.map(s=>({type:s.type,name:s.name,commit:s.commit}))}finally{o.stop()}}setBranchUpstream(e,r){throw new Error("Method not implemented.")}getMergeBase(e,r){throw new Error("Method not implemented.")}async status(){}async checkout(e){const r=new $e(`IGit.checkout(${e})`);try{if(await this.github.repositoryObjectExists(this.rootUri,e)){const i=await this.github.switchTo(this.rootUri,e,{openInNewWindow:!1});throw i!==void 0&&await nn(i),new Error("User aborted")}const n=/pr\/(?<remote>.+)\/(?<num>\d+)/.exec(e);if(n==null?void 0:n.groups){const{num:i}=n.groups,{provider:o,repo:a}=this.providerService.getVirtualUriMetadata(this.rootUri),s=this.providerService.getRemoteUri(o.id,{repo:a,pullRequest:{id:i}});if(s!==void 0){const c=await this.providerService.createWorkspaceForRemoteUrl(s.toString());c!==void 0&&await nn(c)}}throw new Error("User aborted")}finally{r.stop()}}addRemote(e,r){var n;let i;const o=this.remotes.findIndex(a=>a.name===e);return o!==-1&&([i]=this.remotes.splice(o,1)),this.remotes.push({name:e,fetchUrl:r,isReadOnly:(n=i==null?void 0:i.isReadOnly)!=null?n:!1}),Promise.resolve()}removeRemote(e){const r=this.remotes.findIndex(n=>n.name===e);return r!==-1&&this.remotes.splice(r,1),Promise.resolve()}renameRemote(e,r){const n=this.remotes.findIndex(o=>o.name===e);if(n===-1)return Promise.resolve();const[i]=this.remotes.splice(n,1);return this.remotes.push({...i,name:r}),Promise.resolve()}async fetch(e,r,n){const i=new $e("IGit.fetch");try{return this.github.fetch(this.rootUri)}finally{i.stop()}}async pull(e){const r=new $e("IGit.pull");try{return this.github.sync(this.rootUri,this.changeStore,{conflictResolution:Zr.Merge})}finally{r.stop()}}push(e,r,n){return Promise.resolve()}blame(e){throw new Error("Method not implemented.")}async log(e){if((e==null?void 0:e.maxEntries)!==1||(e==null?void 0:e.path)!==void 0)throw new Error("The specified log options are not yet supported.");return[await this.getCommit(this.metadata.HEAD.sha)]}async commit(e,r){const n=new $e("IGit.commit");try{if((r==null?void 0:r.amend)!==void 0||(r==null?void 0:r.empty)!==void 0||(r==null?void 0:r.signCommit)!==void 0||(r==null?void 0:r.signoff)!==void 0)throw new Error("The specified commit options are not yet supported.");const i=(await this.providerService.getCommitOperations(this.rootUri,this.changeStore,{staged:(r==null?void 0:r.all)===!1})).filter(o=>o.fileType===d.FileType.File);if(!i.length){d.window.showInformationMessage(_I("no changes to commit","There are no changes to commit."));return}if(Ye.getUseNewCommitApi())await this.github.createAndPushCommit(this.rootUri,e,i,void 0);else{const o=await this.github.createCommit(this.rootUri,e,i);await this.github.pushCommit(this.rootUri,o)}}finally{n.stop()}}pathToRelativePath(e){return this.providerService.getRelativeFilePath(this.rootUri,this.pathToRelativeUri(e))}pathToRelativeUri(e){return Ma(this.rootUri,EI(e))}}const SI=/^\/?([a-zA-Z])(?::\/)(.*)$/,CI=/\\/g;function EI(t){t=d.Uri.file(t).fsPath.replace(CI,"/");const e=SI.exec(t);return e!==null&&([,,t]=e),t.startsWith("/")?t:`/${t}`}function Lf(t){switch(t){case rt.Changed:return Es.MODIFIED;case rt.Created:return Es.INTENT_TO_ADD;case rt.Deleted:return Es.DELETED}}var RI=Object.defineProperty,TI=Object.getOwnPropertyDescriptor,$y=(t,e,r,n)=>{for(var i=n>1?void 0:n?TI(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&RI(e,r,i),i};const nc=(0,C.loadMessageBundle)(),My=/^(?:https?:\/\/)?github\.(?:com|dev)\/(?<owner>[^/]+)\/(?<repo>[^/?#]+)(?:|\.git|\/tree\/(?<tree>[^?#]+)|\/blob\/(?<blob>[^?#]+)|\/commit\/(?<commit>[0-9a-f]{40})|\/pull\/(?<pull>[0-9]+))?(?<extra>[^?#]*)(?:\?(?<query>[^#]*))?(?:#(?<fragment>.*))?$/i,By=/(?<remoteOwner>[^/:]+)\/?(?<remoteRepo>[^/:]+)?:(?<remoteRef>.*)/,Hf=["repo","workflow"],lu=1,Oy=Object.freeze({id:wr.GitHub,name:"GitHub"});function Ta(t){const{scheme:e,metadata:r}=Pt.decodeAuthority(t,a=>{if(a.v!==void 0)return a;if(typeof a.pr=="string")return{v:lu,ref:{type:Ue.PullRequest,id:a.pr},idx:a.idx};if(typeof a.ref=="string")return{v:lu,ref:{type:Ue.Tree,id:a.ref},idx:a.idx}}),[,n,i,...o]=t.path.split("/");return{scheme:e,provider:Oy,name:`${n}/${i}`,repo:{owner:n,name:i},path:o.join("/")||"",ref:r==null?void 0:r.ref,idx:r==null?void 0:r.idx}}function AI(t,e){const{repo:r}=e!=null?e:Ta(t);return t.with({path:`/${r.owner}/${r.name}`,query:"",fragment:""})}function qf(t,e,r){const{repo:{owner:n,name:i}}=t instanceof d.Uri?Ta(t):t;return d.Uri.parse(`github://${Pt.encodeAuthority("github",{v:lu,ref:{type:Ue.Commit,id:e}})}/${n}/${i}/${r}`)}class Wf{constructor(e,r){this.providerService=e,this.tarPit=r,this.fileTreeCache=new Map,this.disposable=d.Disposable.from(e.onDidChangeRepository(n=>{n.reason==="HEAD"&&this.onRefreshOrRepositoryChanged([n.repository.uri])}),e.onDidRefresh(n=>this.onRefreshOrRepositoryChanged(n)))}get isReadonly(){return!1}get scheme(){return"github"}dispose(){this.disposable.dispose()}onRefreshOrRepositoryChanged(e){e=e.filter(r=>Pt.getProviderId(r)===this.scheme),e.length!==0&&(this.fileTreeCache.forEach(r=>r.dispose()),this.fileTreeCache.clear())}async ensureAuthenticated(e=!1){const r=new $e("GitHub.ensureAuthenticated");try{if(this._session===void 0){async function n(){try{return await d.authentication.getSession("github",Hf,{createIfNone:!0,forceNewSession:e})}catch{try{const o=await d.authentication.getSession("github",Hf,{createIfNone:!1});if(o!==void 0)return o}catch{}return new Promise(o=>{async function a(){const c=await d.authentication.getSession("github",Hf,{createIfNone:!0});c!==void 0&&o(c)}const s=d.authentication.onDidChangeSessions(async c=>{c.provider.id==="github"&&(s.dispose(),await a())})})}}this._session=await n();const i=d.authentication.onDidChangeSessions(o=>{if(this._session===void 0){i.dispose();return}o.provider.id==="github"&&(this.clearAuthenticationSession(),i.dispose())})}return this._session}finally{r.stop()}}async getAuthentication(e){const r=await this.ensureAuthenticated();return{provider:Oy,session:r,getRichNavigationHeaders:()=>({"X-Git-GitHub":`Bearer ${r.accessToken}`})}}clearAuthenticationSession(){this._session=void 0,this._octokit=void 0,this._octokitDefaults=void 0}async reauthenticate(){this.clearAuthenticationSession(),await this.ensureAuthenticated(!0)}async octokit(e){if(this._octokitDefaults===void 0){const n=await this.ensureAuthenticated();if(li){async function i(o,a){if(a.headers!==void 0){const{"user-agent":s,...c}=a.headers;s&&(a.headers=c)}return on(o,a)}this._octokitDefaults=cu.defaults({auth:`token ${n.accessToken}`,request:{fetch:i}})}else this._octokitDefaults=cu.defaults({auth:`token ${n.accessToken}`})}const r=new this._octokitDefaults(e);return(K.logLevel===Rt.Debug||K.isDebugging)&&r.hook.wrap("request",async(n,i)=>{var o;const a=new $e(`[GITHUB] ${i.method} ${i.url}`,{log:!1});try{return await n(i)}finally{let s;try{if(typeof i.query=="string"){const c=/(^[^({\n]+)/.exec(i.query);s=` ${(o=c==null?void 0:c[1].trim())!=null?o:i.query}`}}catch{}a.stop({message:s})}}),r}async graphql(e,r){this._octokit===void 0&&(this._octokit=await this.octokit());try{return await this._octokit.graphql(e,r)}catch(n){throw this.handleRequestErrors(n),n}}async request(e,r){this._octokit===void 0&&(this._octokit=await this.octokit());try{return await this._octokit.request(e,r)}catch(n){throw this.handleRequestErrors(n),n}}handleRequestErrors(e){var r,n;if(e instanceof Cn)switch(e.status){case 500:return e.response&&kr.showGitHubStatus500Message(),!0;case 401:return kr.showStatus401Message(()=>void this.reauthenticate()),!0;case 403:return kr.showStatus403Message(()=>void this.reauthenticate()),!0}else if(e instanceof rc&&((n=(r=e.errors)==null?void 0:r[0])==null?void 0:n.type)==="FORBIDDEN")return kr.showStatus403Message(()=>void this.reauthenticate()),!0;return!1}createIGitRepository(e,r,n,i){return new xI(this.providerService,e,r,n,i,this)}async createMetadata(e,r){var n,i,o,a,s,c;const l=new $e(`GitHub.createMetadata(${e.toString()}, ${r})`);let u;try{let{provider:h,name:f,repo:{owner:p,name:b},ref:w}=Ta(e);(!w||w.type===Ue.Commit&&/HEAD/i.test(w.id))&&(w={type:Ue.Commit,id:"HEAD"});const y=this.providerService.isInWorkspace(e);let x,S;Ye.get("experimental.prefetch")&&y&&(r?x=r:(w.type===Ue.Commit||w.type===Ue.Tree)&&(x=w.id),x&&(l.log({suffix:` \u2022 Prefetching tree for ${x}...`}),this.getFileTree(e,void 0,{cache:!0,recursive:!0,prefetched:{metadata:new Promise(J=>S=J),repo:{owner:p,name:b},HEAD:{sha:x},timestamp:Date.now()}})));const I=await this.getRepositoryInfo(p,b,y,w.type===Ue.PullRequest?{pr:Number(w.id)}:{ref:w.id});if(I===void 0)throw u=" \u2022 Aborted; Unable to get repository info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository info`);let D;if(r)D=r;else if(w.type===Ue.Commit||w.type===Ue.Tree&&I.ref===void 0)D=w.id;else if(D=(i=(n=I.ref)==null?void 0:n.sha)!=null?i:I.defaultBranch.sha,D===void 0)throw u=" \u2022 Aborted; Unable to get repository revision",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get repository revision`);let U;if(((o=I.ref)==null?void 0:o.prefix)==="refs/heads/")U={type:Le.Branch,name:I.ref.name,sha:D,branch:{name:I.ref.name,sha:I.ref.sha}};else if(((a=I.ref)==null?void 0:a.prefix)==="refs/remotes/"){if(!I.ref.remote)throw u=" \u2022 Aborted; Unable to get remote info",new Error(`Cannot get metadata for Uri(${e.toString()}); Unable to get remote info`);U={type:Le.RemoteBranch,name:`${I.ref.remote.repo.owner}${I.ref.remote.repo.name!==b?`/${I.ref.remote.repo.name}`:""}:${I.ref.name}`,sha:D,branch:{name:I.ref.name,sha:I.ref.sha,remote:I.ref.remote}}}else((s=I.ref)==null?void 0:s.prefix)==="refs/tags/"?U={type:Le.Tag,name:I.ref.name,sha:D,detached:{type:Le.Tag,name:I.ref.name}}:U={type:Le.Commit,name:pr(D),sha:D,detached:{type:Le.Commit,name:pr(D)}};if(x!==void 0&&x!==U.sha){const J=this.asFileTreeKey(e,x),G=this.fileTreeCache.get(J);G&&!Zn(x)&&U.sha===((c=U.branch)==null?void 0:c.sha)?(l.log({suffix:` \u2022 Updating prefetched tree for ${x}, since HEAD was resolved; HEAD=${U.sha}`}),this.fileTreeCache.set(this.asFileTreeKey(e,U.sha),G),this.fileTreeCache.delete(J)):(l.log({suffix:` \u2022 Removing prefetched tree for ${x}, since the HEAD changed; HEAD=${U.sha}`}),this.fileTreeCache.delete(J),G==null||G.dispose())}const te={version:Ba.schemaVersion,timestamp:Date.now(),provider:h,name:f,repo:I.repo,user:I.user,accessLevel:I.accessLevel,HEAD:U,defaultBranch:I.defaultBranch,pullRequest:I.pullRequest};return u=` \u2022 HEAD=${U.sha}`,S==null||S(te),te}finally{l.stop(u?{suffix:u}:void 0)}}getMetadata(e){return this.providerService.getMetadata(e)}getRemoteWorkspaceSourceProviders(){return[{name:"GitHub",icon:"$(github)",label:nc("open repo from","Open Repository from {0}","GitHub"),placeholder:nc("pick repo","Choose a repository"),provideSources:async(e,r)=>{e=e!=null?e:"";let n;const i=e==null?void 0:e.indexOf("/");return i!==-1&&(n=e.substring(0,i),e=e.substr(i+1)),(await this.searchRepositoriesQuery(e,{...r,user:n})).map(a=>({providerId:wr.GitHub,name:a.repoWithOwner,icon:"$(repo)",description:`${a.fork?`$(repo-forked) ${a.fork}`:""}${a.stars>0?`${a.fork?" \u2022 ":""}$(star-full) ${a.stars}`:""}`,detail:a.description,url:a.url}))}},{name:"GitHub",icon:"$(github)",label:nc("open pr from","Open Pull Request from {0}","GitHub"),placeholder:nc("pick pr","Choose a pull request"),provideSources:async(e,r)=>{e=e!=null?e:"";let n;const i=e==null?void 0:e.indexOf("/");return i!==-1&&(n=e.substring(0,i),e=e.substr(i+1)),(await this.searchPullRequestsQuery(e,{user:n})).map(a=>({providerId:wr.GitHub,name:a.title,icon:"$(git-pull-request)",description:a.reasons.length!==0?a.reasons.sort().join(", "):void 0,detail:`${a.repoWithOwner} #${a.number}`,url:a.url}))}}]}canOpenRemoteUrl(e){const r=My.exec(e);if((r==null?void 0:r.groups)===void 0)return;const{blob:n,commit:i,pull:o,tree:a}=r.groups;return o?Vr.PullRequest:i?Vr.Commit:a?Vr.Branch:n?Vr.File:Vr.Repository}async createWorkspaceForRemoteUrl(e,r=At.CurrentWindow){const n=My.exec(e);if((n==null?void 0:n.groups)===void 0)return;let{owner:i,repo:o,blob:a,commit:s,pull:c,tree:l,fragment:u}=n.groups;const h=await this.validateOwnerAndRepoAndSplitRefFromPath(i,o,l!=null?l:a);if(h===void 0)return;let f,p;if({owner:i,repo:o,ref:p,path:f}=h,l||a){if(f&&u&&a){const y=/L(?<start>\d+)(?:-L(?<end>\d+))?/.exec(u);if(y==null?void 0:y.groups){const{start:x,end:S}=y.groups;f+=`:${x}${S!==void 0?`-${S}`:""}`}}}else s?p={type:Ue.Commit,id:s}:c&&(p={type:Ue.PullRequest,id:c});const b=this.providerService.createVirtualUri(wr.GitHub,{repo:{owner:i,name:o},ref:p});return{name:(await this.getMetadata(b)).name,uri:b,location:r,filesToOpen:f?[f]:void 0}}createVirtualUri(e,{repo:r,ref:n,idx:i},o){const a=n!==void 0||i!==void 0?{v:lu}:void 0;return a&&(n&&(a.ref={...n,type:n.type===Ue.Branch||n.type===Ue.Tag?Ue.Tree:n.type}),i&&(a.idx=i)),e.with({authority:Pt.encodeAuthority("github",a),path:`/${r.owner}/${r.name}${(o==null?void 0:o.startsWith("/"))?o:o?`/${o}`:""}`})}getRemoteUri(e){const r=`https://github.com/${e.repo.owner}/${e.repo.name}`;return e.pullRequest?d.Uri.parse(`${r}/pull/${e.pullRequest.id}`):e.sha?d.Uri.parse(`${r}/commit/${e.sha}`):e.branch?d.Uri.parse(`${r}/tree/${e.branch}`):e.tag?d.Uri.parse(`${r}/tree/${e.tag}`):e.clone?d.Uri.parse(`${r}.git`):d.Uri.parse(r)}getProviderRootUri(e){return AI(e)}getRelativeFilePath(e,r){const{path:n}=Ta(e),{path:i}=Ta(Ma(e,r));return n.length!==0&&i!==n&&i.startsWith(n)?i.slice(n.length+1):i}getVirtualUriMetadata(e){const{provider:r,name:n,repo:i,ref:o}=Ta(e);return{provider:r,name:n,repo:i,ref:o}}async getModeRefType(e,r){const{HEAD:n,pullRequest:i}=await(r!=null?r:this.getMetadata(e));switch(n.type){case Le.Branch:return i!==void 0?q.PullRequestBranch:q.Branch;case Le.RemoteBranch:return i!==void 0?q.PullRequestRemoteBranch:q.RemoteBranch;case Le.Tag:return q.Tag;case Le.Commit:return q.Commit}}async createBranch(e,r,n,i){try{const{repo:{owner:o,name:a}}=i!=null?i:await this.getMetadata(e);return r.startsWith("refs/heads/")||(r=`refs/heads/${r}`),(await this.request("POST /repos/{owner}/{repo}/git/refs",{owner:o,repo:a,ref:r,sha:n})).data.ref.substr(11)}catch(o){throw o instanceof Cn&&o.status===422?o.message==="Reference already exists"?new La(o,!0):new La(o,!1):(K.error(o),o)}}async createAndPushCommit(e,r,n,i,o){var a;const s=new $e(`GitHub.createAndPushCommit(${e.toString()}${o?`, fork=${o.repo.owner}/${o.repo.name}`:""})`);if(n=n.filter(l=>l.fileType===d.FileType.File),n.length===0)throw s.stop({message:"Aborted; No changes to commit"}),new $o("No changes to commit");let c;try{const l=await this.getMetadata(e);let u;if(i!==void 0)u=i;else{if(l.HEAD.detached&&!l.HEAD.branch)throw new Ki("Unable to commit; no current branch");u=l.HEAD.branch.name}let h;if(o)h=`${o.repo.owner}/${o.repo.name}`;else if(l.HEAD.type===Le.RemoteBranch&&l.HEAD.branch.remote.accessLevel>=$t.Write){const{owner:x,name:S}=l.HEAD.branch.remote.repo;h=`${x}/${S}`}else h=`${l.repo.owner}/${l.repo.name}`;const f=[],p=[];for(const x of n)switch(x.type){case rt.Created:case rt.Changed:f.push({path:x.path,contents:xc(await x.content)});break;case rt.Deleted:p.push({path:x.path});break}const b={branch:{branchName:u,repositoryNameWithOwner:h},message:{headline:r},fileChanges:{additions:f,deletions:p},expectedHeadOid:l.HEAD.sha},w=`mutation($commitInput: CreateCommitOnBranchInput!) {
	createCommitOnBranch(input: $commitInput) {
		commit {
			oid
		}
		ref {
			name
		}
	}
}`,y=await this.graphql(w,{commitInput:b});if(c=y==null?void 0:y.createCommitOnBranch.commit.oid,!c)throw new wc;return i===void 0&&!l.HEAD.detached&&c!==void 0&&await this.fastForwardTo(e,c,l),c}catch(l){if(l instanceof rc){const u=(a=l.errors)==null?void 0:a[0];if((u==null?void 0:u.type)==="STALE_DATA"&&u.message.includes("Pull and try again"))throw new Ha(l)}throw K.error(l),l}finally{s.stop(c?{message:`: Created and pushed commit ${c}`}:void 0)}}async createCommit(e,r,n,i){const o=new $e(`GitHub.createCommit(${e.toString()}${i?`, fork=${i.repo.owner}/${i.repo.name}`:""})`);if(n=n.filter(s=>s.fileType===d.FileType.File),n.length===0)throw o.stop({message:"Aborted; No changes to commit"}),new $o("No changes to commit");let a;try{const s=await this.getMetadata(e);let c,l,u;i?({repo:{owner:c,name:l}}=i,u=await this.getFileTree(this.createVirtualUri(e,i),s.HEAD.sha)):s.HEAD.type===Le.RemoteBranch&&s.HEAD.branch.remote.accessLevel>=$t.Write?({owner:c,name:l}=s.HEAD.branch.remote.accessLevel===$t.WriteToPullRequest?s.repo:s.HEAD.branch.remote.repo,u=await this.getFileTree(this.createVirtualUri(e,{repo:s.HEAD.branch.remote.repo}),s.HEAD.sha)):({repo:{owner:c,name:l}}=s,u=await this.getFileTree(e,s.HEAD.sha));const h=await u.getTreeSha();if(!Zn(h))throw new Error(`Unable to create commit based on tree sha ${h}`);o.logStep("Creating Blobs",{message:`: Committing ${n.length} changes onto commit ${s.HEAD.sha} based on tree ${h}`,suffix:" \u2022 Creating blobs..."});const f=[];async function p(x){var S;try{const I=await this.request("POST /repos/{owner}/{repo}/git/blobs",{owner:c,repo:l,encoding:"base64",content:xc(await x.content),mediaType:{format:"raw"}});let D;if(x.type===rt.Changed){const U=await u.get(x.path);D=(S=U==null?void 0:U.mode)!=null?S:"100644"}else D="100644";f.push({path:x.path,mode:D,type:"blob",sha:I.data.sha})}catch(I){throw K.error(I,`Failed to create blob for ${x.path}`),I}}const b=[];for(const x of n)switch(x.type){case rt.Created:case rt.Changed:{b.push(p.call(this,x));break}case rt.Deleted:{f.push({path:x.path,mode:"100644",type:"blob",sha:null});break}}await Promise.all(b),o.logStep("Creating tree",{message:`: Created ${b.length} blobs;`,suffix:` \u2022 Creating tree based on ${h}...`});const w=await this.request("POST /repos/{owner}/{repo}/git/trees",{owner:c,repo:l,base_tree:h,tree:f});return o.logStep("Creating commit",{message:`: Created tree ${w.data.sha};`,suffix:" \u2022 Creating commit..."}),a=(await this.request("POST /repos/{owner}/{repo}/git/commits",{owner:c,repo:l,message:r,tree:w.data.sha,parents:[s.HEAD.sha]})).data.sha,a}catch(s){throw K.error(s),s}finally{o.stop(a?{message:`: Created commit ${a}`}:void 0)}}async createPullRequest(e,r,n,i,o){var a,s,c;const l=new $e(`GitHub.createPullRequest(${e.toString()}, ${r}${o?`, fork=${o.repo.owner}/${o.repo.name}`:""})`);try{const{repo:{owner:u,name:h},HEAD:{branch:f},defaultBranch:p}=await this.getMetadata(e),b=await this.request("POST /repos/{owner}/{repo}/pulls",{owner:u,repo:h,base:`refs/heads/${(a=f==null?void 0:f.name)!=null?a:p.name}`,head:o?`${o.repo.owner}:${r}`:r,title:n,draft:(s=i==null?void 0:i.draft)!=null?s:!1,maintainer_can_modify:(c=i==null?void 0:i.canMaintainerModify)!=null?c:!0});return{id:b.data.number.toString(),uri:d.Uri.parse(b.data.html_url)}}catch(u){throw K.error(u),u}finally{l.stop()}}async fetch(e,r){const{fetched:n,metadata:i}=await this.fetchCore(e,!1,r);n&&await this.providerService.updateMetadata(e,i)}async fetchCore(e,r,n){var i,o,a,s,c,l,u,h,f;const{force:p,to:b}={...n,force:r||(n==null?void 0:n.force)},w=new $e(`GitHub.fetch(${e.toString()}, force=${p}, to=${b})`);let y;try{const x=await this.getMetadata(e);if(x.HEAD.detached)return y=" \u2022 Skipped; detached HEAD",{fetched:!1,metadata:x};const S=await this.getBranchTips(e);if(!S)throw y=" \u2022 Unable to fetch branch tips",new Zi(r);if(!p&&!b&&((i=S.defaultBranch)==null?void 0:i.sha)!==void 0&&S.defaultBranch.sha===x.defaultBranch.sha&&((o=S.branch)==null?void 0:o.sha)!==void 0&&S.branch.sha===x.HEAD.branch.sha&&(x.HEAD.sha===x.HEAD.branch.sha||x.state!==void 0))return y=" \u2022 No changes detected",{fetched:!1,metadata:x};let I;if(((a=S.defaultBranch)==null?void 0:a.sha)!==void 0&&S.defaultBranch.sha!==x.defaultBranch.sha&&(I={defaultBranch:{...x.defaultBranch,sha:S.defaultBranch.sha}}),((s=S.branch)==null?void 0:s.sha)===void 0){if(y=" \u2022 Unable to find branch tip",p)throw new Zi(r);return I!==void 0?{fetched:!0,metadata:{...x,...I}}:{fetched:!1,metadata:x}}if(S.branch.sha!==x.HEAD.branch.sha&&(I={...I,HEAD:{...x.HEAD,branch:{...x.HEAD.branch,sha:S.branch.sha},detached:void 0}}),S.branch.sha===((c=n==null?void 0:n.to)!=null?c:x.HEAD.sha))return y=" \u2022 Up to date",x.state!==void 0||I!==void 0?{fetched:!0,metadata:{...x,...I,state:void 0}}:{fetched:!1,metadata:x};w.logStep("Fetching upstream changes");try{const D=await this.getAheadBehindState(e,x,{base:(l=n==null?void 0:n.to)!=null?l:x.HEAD.sha,head:(f=(h=(u=I==null?void 0:I.HEAD)==null?void 0:u.branch)==null?void 0:h.sha)!=null?f:x.HEAD.branch.sha});return y=` \u2022 Changes detected; ${D==null?void 0:D.behind} commits behind`,{fetched:!0,metadata:{...x,...I,state:D?{ahead:D.ahead,behind:D.behind,incomingChanges:D.incomingChanges}:void 0}}}catch(D){if(y=` \u2022 Failed fetching upstream changes; ${String(D)}`,p)throw new Zi(r);return I!==void 0?{fetched:!0,metadata:{...x,...I}}:{fetched:!1,metadata:x}}}finally{w.stop(y?{suffix:y}:void 0)}}async fork(e){try{const{repo:{owner:r,name:n}}=await this.getMetadata(e),i=await this.request("POST /repos/{owner}/{repo}/forks",{owner:r,repo:n});let o;for(;;){try{if(o=await this.getRepositoryInfo(i.data.owner.login,i.data.name,!1),o!==void 0)break}catch{}await new Promise(a=>setTimeout(a,250))}return{name:`${i.data.owner.login}/${i.data.name}`,repo:{owner:i.data.owner.login,name:i.data.name},url:i.data.url}}catch(r){throw K.error(r),r}}async getBranches(e,r){var n,i,o;try{const{repo:{owner:a,name:s}}=await this.getMetadata(e),c=`query getBranches(
	$owner: String!
	$repo: String!
	$branchQuery: String!
	$cursor: String
	$limit: Int = 100
) {
	repository(owner: $owner, name: $repo) {
		refs(query: $branchQuery, refPrefix: "refs/heads/", first: $limit, after: $cursor) {
			pageInfo {
				endCursor
				hasNextPage
			}
			nodes {
				name
				target {
					oid
				}
			}
		}
	}
}`,l=await this.graphql(c,{owner:a,repo:s,branchQuery:(n=r==null?void 0:r.query)!=null?n:"",cursor:r==null?void 0:r.cursor,limit:Math.min(100,(i=r==null?void 0:r.limit)!=null?i:100)});if(l===void 0)return{branches:[]};const u=(o=l.repository)==null?void 0:o.refs;if(u===void 0)return{branches:[]};const h=u.nodes.map(f=>({type:Mn.Head,name:f.name,commit:f.target.oid,commitUrl:f.target.commitUrl}));return{paging:{cursor:u.pageInfo.endCursor,more:u.pageInfo.hasNextPage},branches:h}}catch(a){return{branches:[]}}}async getCommit(e,r){var n;try{const{HEAD:i,repo:{owner:o,name:a}}=await this.getMetadata(e),s=`query getCommit(
	$owner: String!
	$repo: String!
	$ref: GitObjectID!
) {
	repository(name: $repo owner: $owner) {
		object(oid: $ref) {
			...on Commit {
				oid
				message
				parents(first: 100) {
					nodes {
						oid
					}
				}
				author {
					date
					email
					name
				}
				committer {
					date
				}
			}
		}
	}
}`;r.toUpperCase()==="HEAD"&&(r=i.sha);const c=await this.graphql(s,{owner:o,repo:a,ref:r});if(c===void 0)return;const l=(n=c.repository)==null?void 0:n.object;return l===void 0?void 0:{hash:l.oid,message:l.message,parents:l.parents.nodes.map(u=>u.oid),authorDate:new Date(l.author.date),authorEmail:l.author.email,authorName:l.author.name,commitDate:new Date(l.committer.date)}}catch(i){return}}async getCommits(e,r){var n,i,o;try{const{HEAD:a,repo:{owner:s,name:c}}=await this.getMetadata(e),l=`query getCommits(
	$owner: String!
	$repo: String!
	$ref: GitObjectID!
	$path: String
	$cursor: String
	$limit: Int = 100
) {
	repository(name: $repo, owner: $owner) {
		object(oid: $ref) {
			... on Commit {
				history(first: $limit, path: $path, after: $cursor) {
					pageInfo {
						endCursor
						hasNextPage
					}
					nodes {
						... on Commit {
							...commit
						}
					}
				}
			}
		}
	}
}

fragment commit on Commit {
	oid
	message
	parents(first: 100) {
		nodes {
			oid
		}
	}
	author {
		date
		email
		name
	}
	committer {
		date
	}
}
`;let u=r==null?void 0:r.ref;(u==null?void 0:u.toUpperCase())==="HEAD"&&(u=a.sha);const h=await this.graphql(l,{owner:s,repo:c,ref:u,cursor:r==null?void 0:r.cursor,path:r==null?void 0:r.path,limit:Math.min(100,(n=r==null?void 0:r.limit)!=null?n:100)});if(h===void 0)return;const f=(o=(i=h.repository)==null?void 0:i.object)==null?void 0:o.history;if(f===void 0)return;const p=f.nodes.map(b=>({hash:b.oid,message:b.message,parents:b.parents.nodes.map(w=>w.oid),authorDate:new Date(b.author.date),authorEmail:b.author.email,authorName:b.author.name,commitDate:new Date(b.committer.date)}));return{paging:{cursor:f.pageInfo.endCursor,more:f.pageInfo.hasNextPage},commits:p}}catch(a){return}}async getBlobContent(e,r){try{const n=await this.request("GET /repos/{owner}/{repo}/git/blobs/{file_sha}",{owner:e.owner,repo:e.name,file_sha:r});return BS(n.data.content)}catch(n){throw K.logLevel===Rt.Debug&&K.error(n),n}}async getFileContent(e,r,n){try{let i;if(r&&n&&!this.hasFileTree(e,r)){const o=this.providerService.getProviderRootUri(e);n.startsWith("/")&&(n=n.slice(1));let a=(0,Ok.dirname)(n);(a==="."||a==="/")&&(a=""),i=await(await this.getFileTree(o,r,{path:a,cache:!1,recursive:!1})).get(n)}else{const[o,{path:a}]=await Promise.all([this.getFileTree(e,r),n?{path:void 0}:this.providerService.getMetadata(e)]);i=await o.get(n!=null?n:a)}if((i==null?void 0:i.sha)===void 0)throw d.FileSystemError.FileNotFound(e);return await i.getContent()}catch(i){throw K.logLevel===Rt.Debug&&K.error(i),i}}async getFileList(e,r,n){const i=new $e(`GitHub.getFileList(${e.toString()}${n?`, ${n}`:""})`);try{const{repo:{owner:o,name:a},HEAD:{sha:s}}=await this.getMetadata(e),c=await this.request("GET /repos/{owner}/{repo}/git/tree-file-list/{treeish}",{owner:o,repo:a,treeish:`${n!=null?n:s}${r?`:${r}`:""}`});return c.status!==200?[]:c.data}catch(o){return K.error(o),[]}finally{i.stop()}}hasFileTree(e,r){return r?this.fileTreeCache.has(this.asFileTreeKey(e,r)):this.getMetadata(e).then(n=>this.fileTreeCache.has(this.asFileTreeKey(e,n.HEAD.sha)))}async getFileTree(e,r,n){var i,o,a,s,c;const l=this.providerService.isInWorkspace(e);let u=(i=n==null?void 0:n.cache)!=null?i:l,h,f,p;if(u||!r){const x=(a=(o=n==null?void 0:n.prefetched)==null?void 0:o.metadata)!=null?a:this.getMetadata(e);h=l?this.getFileTreePermissions(e,x):void 0;let S;({repo:f,HEAD:{sha:S},timestamp:p}=(s=n==null?void 0:n.prefetched)!=null?s:await x),r&&S!==r?(u=!1,p=Date.now()):r=S}else({repo:f}=(c=n==null?void 0:n.prefetched)!=null?c:this.providerService.getVirtualUriMetadata(e)),p=Date.now();const b=this.asFileTreeKey(e,r),w=this.providerService.getProviderRootUri(e),y=new $e(`GitHub.getFileTree(${b}): ${e.toString()}`,{log:!1,logLevel:Rt.Debug});try{let x=function(){var I;const D=new $e(`GitHub.createFileTree(${b})`);let U,te;u&&l&&(U=new d.EventEmitter,te=d.Disposable.from(this.tarPit.onDidChangeIndexingEnablement(()=>U.fire()),this.tarPit.onDidDownloadTar(G=>U.fire({rootUri:this.providerService.getProviderRootUri(G.rootUri),sha:G.sha}))));const J={dispose:()=>te==null?void 0:te.dispose(),permissions:h,getContent:G=>this.getBlobContent(f,G.sha),getTree:async(G,ue)=>{const re=await this.request("GET /repos/{owner}/{repo}/git/trees/{tree_sha}",{owner:f.owner,repo:f.name,recursive:ue?"1":void 0,tree_sha:`${r}${G?`:${G}`:""}`});return re.data.truncated?{sha:re.data.sha,truncated:!0}:{sha:re.data.sha,truncated:!1,tree:Wa(re.data.tree,se=>{var xe;return{path:se.path,item:{mode:se.mode,sha:se.sha,stat:{type:II(se.type),size:(xe=se.size)!=null?xe:0,ctime:0,mtime:p,permissions:void 0}}}})}},onDidTriggerContentCaching:U==null?void 0:U.event,tryCachingContent:u&&l?async G=>{const ue=Ye.get("experimental.fs.useTars");if(ue!=="always"&&ue!=="ifAvailable")return!1;const re=new $e(`FileTree.loadAllContent(${r})`);let se;try{let xe;if(ue==="ifAvailable"){if(re.logStep("Tar cache query"),xe=await this.tarPit.getCachedTar(w,r),xe===void 0)return se=" \u2022 No cached Tar",!1}else re.logStep("Tar query"),xe=await this.tarPit.getTar(w,r);re.logStep("Updating content",{suffix:" \u2022 Updating content..."});for(const dt of xe.entries){const ne=G(dt.header.fullFileName);if(ne===void 0)continue;const Se=dt.dataAsBytes;ne.getContent=()=>Se}return!0}catch(xe){return se=` \u2022 Failed ${String(xe)}`,!1}finally{re.stop(se?{suffix:se}:void 0)}}:void 0};try{return new Fy(w,r,p,J,{path:n==null?void 0:n.path,recursive:(I=n==null?void 0:n.recursive)!=null?I:u,preload:u||(n==null?void 0:n.recursive)})}catch(G){return K.error(G),new Fy(w,r,p,void 0)}finally{D.stop()}},S=this.fileTreeCache.get(b);return S!==void 0||(S=x.call(this),u&&this.fileTreeCache.set(b,S)),S}finally{y.stop()}}async getFileTreePermissions(e,r){if(this.providerService.getModeConfig(e,await this.getModeRefType(e,r)).display===N.Edit)return;const i=await this.providerService.getIndexMetadata(e);return yc.isActive(i)?d.FilePermission.Readonly:void 0}async getFork(e){var r,n,i;try{const{repo:{owner:o,name:a}}=await this.getMetadata(e),s=`query getFork(
	$owner: String!
	$repo: String!
) {
	repository(owner: $owner, name: $repo) {
		forks(affiliations: OWNER, first: 1) {
			nodes {
				owner {
					login
				}
				name
				url
			}
		}
	}
}`,c=await this.graphql(s,{owner:o,repo:a});if(c===void 0)return;const[l]=(i=(n=(r=c.repository)==null?void 0:r.forks)==null?void 0:n.nodes)!=null?i:[];return l===void 0?void 0:{name:`${l.owner.login}/${l.name}`,repo:{owner:l.owner.login,name:l.name},url:l.url}}catch(o){return}}async getIncomingChanges(e){var r,n;return(n=(r=(await this.getMetadata(e)).state)==null?void 0:r.incomingChanges)!=null?n:[]}async compareCommits(e,r){const n=await this.getMetadata(e),i=await this.getAheadBehindState(e,n,{base:r.base,head:r.compare});return i==null?void 0:i.incomingChanges}async getAheadBehindState(e,r,n){var i,o,a,s,c;const{base:l,head:u}={base:r.HEAD.sha,head:(i=r.HEAD.branch)==null?void 0:i.sha,...n},h=new $e(`GitHub.getAheadBehindState(${e.toString()}, base=${l}, head=${u})`);let f,p;try{if(!u){f=` \u2022 Skipped; Unsupported HEAD type (${r.HEAD.type})`;return}const b=await this.request("GET /repos/{owner}/{repo}/compare/{base}...{head}",{owner:r.repo.owner,repo:r.repo.name,base:l,head:u}),w=[];for(const y of(o=b.data.files)!=null?o:[])switch(y.status){case"added":case"copied":w.push({uri:d.Uri.joinPath(e,y.filename),type:rt.Created});break;case"removed":w.push({uri:d.Uri.joinPath(e,y.filename),type:rt.Deleted});break;case"modified":w.push({uri:d.Uri.joinPath(e,y.filename),type:rt.Changed});break;case"renamed":w.push({uri:d.Uri.joinPath(e,y.filename),type:rt.Created}),w.push({uri:d.Uri.joinPath(e,y.previous_filename),type:rt.Deleted});break;default:K.warn(`GitHub.getAheadBehindState(${e.toString()}, base=${l}, head=${u}): Unknown file status encountered '${y.status}'`);break}return p={ahead:(a=b.data.behind_by)!=null?a:0,behind:(s=b.data.ahead_by)!=null?s:0,incomingChanges:w},p}catch(b){throw f=` \u2022 Failed; ${String(b)}`,K.error(b),b}finally{h.stop({suffix:f!=null?f:` \u2022 ${(c=p==null?void 0:p.behind)!=null?c:0} commits behind`})}}async getObjectDetails(e,r,n){var i;try{const o=await this.getFileTree(e,r);n?n=this.providerService.getRelativeFilePath(e,this.providerService.createRelativeUri(e,n)):{path:n}=await this.providerService.getMetadata(e);const a=await o.get(n);if((a==null?void 0:a.mode)===void 0||(a==null?void 0:a.sha)===void 0)throw new Error(`Cannot get details of ${n} in ${r}`);return{mode:a.mode,object:a.sha,size:(i=a.stat.size)!=null?i:0}}catch(o){throw K.error(o),o}}async getPullRequest(e,r){const{repo:{owner:n,name:i}}=await this.getMetadata(e);return this.getPullRequestCore(n,i,r)}async getPullRequestCore(e,r,n){var i,o,a,s,c,l,u;try{const h=`query getPullRequest(
	$owner: String!
	$repo: String!
	$pr: Int!
) {
	repository(name: $repo, owner: $owner) {
		pullRequest(number: $pr) {
			author {
				login
				avatarUrl
				url
			}
			permalink
			number
			title
			state
			updatedAt
			closedAt
			mergedAt
			repository {
				name
				owner {
					login
				}
			}
			baseRef {
				name
			}
			baseRefName
			baseRefOid
			baseRepository {
				name
				owner {
					login
				}
			}
			headRef {
				name
			}
			headRefName
			headRefOid
			headRepository {
				name
				owner {
					login
				}
			}
			headRepositoryOwner {
				login
			}
		}
	}
}`,f=await this.graphql(h,{owner:e,repo:r,number:Number(n)}),p=(i=f==null?void 0:f.repository)==null?void 0:i.pullRequest;return p?{author:{name:p.author.login,avatarUrl:p.author.avatarUrl,url:p.author.url},closedAt:p.closedAt?new Date(p.closedAt):void 0,mergedAt:p.mergedAt?new Date(p.mergedAt):void 0,id:p.number.toString(),repo:{name:p.repository.name,owner:p.repository.owner.login},state:zf(p.state),title:p.title,updatedAt:new Date(p.updatedAt),url:p.permalink,refs:{base:{owner:p.baseRepository.owner.login,repo:p.baseRepository.name,branch:p.baseRefName,sha:p.baseRefOid,exists:p.baseRef!=null},head:{owner:(c=(s=(o=p.headRepository)==null?void 0:o.owner.login)!=null?s:(a=p.headRepositoryOwner)==null?void 0:a.login)!=null?c:"<unknown>",repo:(u=(l=p.headRepository)==null?void 0:l.name)!=null?u:p.baseRepository.name,branch:p.headRefName,sha:p.headRefOid,exists:p.headRef!=null}}}:void 0}catch(h){K.error(h);return}}async getPullRequestForBranch(e,r,n){var i,o,a,s,c;try{const{repo:{owner:l,name:u}}=await this.getMetadata(e),h=`query getPullRequestForBranch(
	$owner: String!
	$repo: String!
	$branch: String!
	$maxCount: Int!
	$states: [PullRequestState!]
) {
	repository(name: $repo, owner: $owner) {
		refs(query: $branch, refPrefix: "refs/heads/", first: 1) {
			nodes {
				associatedPullRequests(first: $maxCount, orderBy: {field: UPDATED_AT, direction: DESC}, states: $states) {
					nodes {
						author {
							login
							avatarUrl
							url
						}
						permalink
						number
						title
						state
						updatedAt
						closedAt
						mergedAt
						repository {
							isFork
							name
							owner {
								login
							}
						}
					}
				}
			}
		}
	}
}`,f=await this.graphql(h,{owner:l,repo:u,branch:r,maxCount:(i=n==null?void 0:n.maxCount)!=null?i:1,states:kI(n==null?void 0:n.include)}),p=(c=(s=(a=(o=f==null?void 0:f.repository)==null?void 0:o.refs.nodes[0])==null?void 0:a.associatedPullRequests)==null?void 0:s.nodes)==null?void 0:c.filter(w=>!w.repository.isFork||w.repository.owner.login===l);if(p==null||p.length===0)return;p.length>1&&p.sort((w,y)=>(w.repository.owner.login===l?-1:1)-(y.repository.owner.login===l?-1:1)||(w.state==="OPEN"?-1:1)-(y.state==="OPEN"?-1:1)||new Date(y.updatedAt).getTime()-new Date(w.updatedAt).getTime());const[b]=p;return{author:{name:b.author.login,avatarUrl:b.author.avatarUrl,url:b.author.url},closedAt:b.closedAt?new Date(b.closedAt):void 0,mergedAt:b.mergedAt?new Date(b.mergedAt):void 0,id:b.number.toString(),repo:{name:b.repository.name,owner:b.repository.owner.login},state:zf(b.state),title:b.title,updatedAt:new Date(b.updatedAt),url:b.permalink}}catch(l){K.error(l);return}}async getTags(e,r){var n,i,o;try{const{repo:{owner:a,name:s}}=await this.getMetadata(e),c=`query getTags(
	$owner: String!
	$repo: String!
	$tagQuery: String!
	$cursor: String
	$limit: Int = 100
) {
	repository(owner: $owner, name: $repo) {
		refs(query: $tagQuery, refPrefix: "refs/tags/", first: $limit, after: $cursor, orderBy: { field: TAG_COMMIT_DATE, direction: DESC }) {
			pageInfo {
				endCursor
				hasNextPage
			}
			nodes {
				name
				target {
					oid
				}
			}
		}
	}
}`,l=await this.graphql(c,{owner:a,repo:s,tagQuery:(n=r==null?void 0:r.query)!=null?n:"",cursor:r==null?void 0:r.cursor,limit:Math.min(100,(i=r==null?void 0:r.limit)!=null?i:100)});if(l===void 0)return{tags:[]};const u=(o=l.repository)==null?void 0:o.refs;if(u===void 0)return{tags:[]};const h=u.nodes.map(f=>({type:Mn.Tag,name:f.name,commit:f.target.oid,commitUrl:f.target.commitUrl}));return{paging:{cursor:u.pageInfo.endCursor,more:u.pageInfo.hasNextPage},tags:h}}catch(a){return{tags:[]}}}async getTarGz(e){var r;const{repo:{owner:n,name:i},HEAD:{sha:o}}=await this.getMetadata(e),a=await this.ensureAuthenticated();try{if(li){const l=Ye.get("search.download.corsProxy")||void 0;if(typeof l=="string")throw Error("Error: using outdated `search.download.corsProxy` setting. Please update to new object based configuration.");const u=(r=l==null?void 0:l["github.com"])!=null?r:"vscode.dev";if(u){const h=`https://${u}/indexes/github2/${n}/${i}/${o}`,p=await(await on(h,{headers:{"x-proxy-authorization":`Bearer ${a.accessToken}`},credentials:"include"})).text(),b=await on(p);return new Uint8Array(await b.arrayBuffer())}}const s=`https://api.github.com/repos/${n}/${i}/tarball/${o}`,c=await on(s,{headers:{Authorization:`Bearer ${a.accessToken}`}});return new Uint8Array(await c.arrayBuffer())}catch(s){throw K.error(s),s}}async pushCommit(e,r,n,i){const o=new $e(`GitHub.pushCommit(${e.toString()}, sha=${r}${n?`, ref=${n}`:""}${i?`, fork=${i.repo.owner}/${i.repo.name}`:""})`);let a;try{const s=await this.getMetadata(e);let c,l;if(i?{repo:{owner:c,name:l}}=i:s.HEAD.type===Le.RemoteBranch&&s.HEAD.branch.remote.accessLevel>=$t.Write?{owner:c,name:l}=s.HEAD.branch.remote.repo:{repo:{owner:c,name:l}}=s,n===void 0&&s.HEAD.detached)throw new Ki("Unable to commit; no current branch");(n==null?void 0:n.startsWith("refs/heads/"))&&(n=n.substr(11));const u=await this.request("PATCH /repos/{owner}/{repo}/git/refs/{ref}",{owner:c,repo:l,ref:`heads/${n!=null?n:s.HEAD.branch.name}`,sha:r});return n===void 0&&!s.HEAD.detached&&await this.fastForwardTo(e,r,s),a=u.data.ref,a}catch(s){throw s instanceof Cn&&s.status===422&&s.message.includes("Update is not a fast forward")?new Ha(s):(K.error(s),s)}finally{o.stop(a?{message:`: Pushed commit to ${a}`}:void 0)}}async queryRepositoryObject(e,r,n,i){var o,a;try{const{repo:{owner:s,name:c},HEAD:{sha:l},path:u}=await this.providerService.getMetadata(e),h=`query ${r}(
	$owner: String!
	$repo: String!
	$expression: String
) {
	repository(owner: $owner, name: $repo) {
		object(expression: $expression) {
			${n}
		}
	}
}`,f=await this.graphql(h,{owner:s,repo:c,expression:i!=null?i:`${l}:${u}`});return(a=(o=f==null?void 0:f.repository)==null?void 0:o.object)!=null?a:void 0}catch(s){K.error(s);return}}async repositoryObjectExists(e,r){return await this.queryRepositoryObject(e,"exists","			__typename",r)!==void 0}async searchPullRequestsQuery(e,r){try{let n=function(s,c){return{number:s.number,title:s.title,repoWithOwner:s.repository.nameWithOwner,reasons:c?[c]:[],url:s.url}};const i=`query searchPullRequests(
	$authored: String!
	$assigned: String!
	$reviewRequested: String!
	$mentioned: String!
) {
	viewer {
		repositories(first: 100, orderBy: { field: STARGAZERS, direction: DESC }) {
			nodes {
				pullRequests(first: 100, states: OPEN, orderBy: { field: UPDATED_AT, direction: DESC }) {
					nodes {
						number
						title
						url
						repository {
							nameWithOwner
						}
					}
				}
			}
		}
	}
	authored: search(first: 100, query: $authored, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	assigned: search(first: 100, query: $assigned, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	reviewRequested: search(first: 100, query: $reviewRequested, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
	mentioned: search(first: 100, query: $mentioned, type: ISSUE) {
		nodes {
			...on PullRequest {
				number
				title
				url
				repository {
					nameWithOwner
				}
			}
		}
	}
}`;e=e.trim(),(r==null?void 0:r.user)&&(e+=` user:${r.user}`);const o=await this.graphql(i,{authored:(e?`${e} is:pr is:open archived:false author:@me`:"is:pr is:open archived:false author:@me").trim(),assigned:(e?`${e} is:pr is:open archived:false assignee:@me`:"is:pr is:open archived:false assignee:@me").trim(),reviewRequested:(e?`${e} is:pr is:open archived:false review-requested:@me`:"is:pr is:open archived:false review-requested:@me").trim(),mentioned:(e?`${e} is:pr is:open archived:false mentions:@me`:"is:pr is:open archived:false mentions:@me").trim()});return o===void 0?[]:Of([...o.assigned.nodes.map(s=>n(s,"assigned")),...o.reviewRequested.nodes.map(s=>n(s,"review requested")),...o.mentioned.nodes.map(s=>n(s,"mentioned")),...o.authored.nodes.map(s=>n(s,"authored")),...Np(o.viewer.repositories.nodes,s=>s.pullRequests.nodes.map(c=>n(c)))],s=>s.url,(s,c)=>(c.reasons.length!==0&&s.reasons.push(...c.reasons),s))}catch(n){return[]}}async searchRepositoriesQuery(e,r){try{const n=`query searchRepositories(
	$search: String!
) {
	viewer {
		repositories(first: 100, orderBy: { field: UPDATED_AT, direction: DESC }) {
			nodes {
				nameWithOwner
				description
				url
				parent {
					nameWithOwner
				}
				stargazerCount
			}
		}
	}
	search(first: 100, query: $search, type: REPOSITORY) {
		nodes {
			...on Repository {
				nameWithOwner
				description
				url
				parent {
					nameWithOwner
				}
				stargazerCount
			}
		}
	}
}`;(r==null?void 0:r.user)&&(e+=` user:${r.user}`),(r==null?void 0:r.sort)&&(e+=` sort:${r.sort}`),e+=" fork:true";const i=await this.graphql(n,{search:e.trim()});return i===void 0?[]:Of((r==null?void 0:r.user)?[...i.search.nodes,...i.viewer.repositories.nodes]:[...i.viewer.repositories.nodes,...i.search.nodes],a=>a.url).map(a=>{var s,c,l;return{repoWithOwner:a.nameWithOwner,description:(s=a.description)!=null?s:void 0,url:a.url,fork:(l=(c=a.parent)==null?void 0:c.nameWithOwner)!=null?l:void 0,stars:a.stargazerCount}})}catch(n){return[]}}async searchCodeQuery(e,r,n){var i,o,a;const{repo:{owner:s,name:c},HEAD:l,defaultBranch:u}=await this.getMetadata(r),h=[];((i=l.branch)==null?void 0:i.name)!==u.name&&h.push(nc("Cant search branch","Unable to search {0} without index, falling back to {1}.",(a=(o=l.branch)==null?void 0:o.name)!=null?a:l.detached.name,u.name));try{const p=await(await this.octokit({request:{headers:{authorization:`Bearer ${(await this.ensureAuthenticated()).accessToken}`,accept:"application/vnd.github.v3.text-match+json"}}})).request("GET /search/code",{q:`${e} repo:${s}/${c}`}),b=new d.Range(0,0,0,0),w=[];let y=0,x;for(const S of p.data.items)for(const I of S.text_matches){if(y++,n.maxResults!==void 0&&y>n.maxResults)return{matches:w,limitHit:!0};x={path:S.path,ranges:[],preview:I.fragment,matches:[]};for(const D of I.matches){let U=0,te=0,J=0;for(let G=0;G<D.indices[1];G++)G===D.indices[0]&&(te=J),I.fragment[G]===`
`?(U++,J=0):J++;x.ranges.push(b),x.matches.push(new d.Range(U,te,U,J))}w.push(x)}return{matches:w,limitHit:!1,warnings:h}}catch(f){return{matches:[],limitHit:!0}}}async switchTo(e,r,n){const{name:i,repo:o,HEAD:{branch:a}}=await this.getMetadata(e);let s;if(!(r!==void 0&&(typeof r=="string"?(r==null?void 0:r.startsWith("refs/heads/"))?(s={type:Ue.Tree,id:r.substr(11)},r=r.substr(11)):(r==null?void 0:r.startsWith("refs/tags/"))?s={type:Ue.Tree,id:r.substr(10)}:s={type:Ue.Tree,id:r}:s={...r,type:r.type===Ue.Branch||r.type===Ue.Tag?Ue.Tree:r.type},(a==null?void 0:a.name)===s.id)))return{name:i,uri:this.providerService.createVirtualUri(e,{repo:o,ref:s}),location:(n==null?void 0:n.openInNewWindow)?At.NewWindow:At.CurrentWindow}}async sync(e,r,n){var i,o,a,s,c,l;const u=new $e(`GitHub.sync(${e.toString()}, resolution=${n.conflictResolution}, to=${n.to})`);let h;try{const{metadata:f}=await this.fetchCore(e,!0,{to:n.to});if(f.HEAD.detached){h=" \u2022 Skipped; detached HEAD";return}if(((o=(i=f==null?void 0:f.state)==null?void 0:i.behind)!=null?o:0)>0&&await r.hasChanges(e)){u.logStep("Fetching upstream changes");const p=[],b=(s=(a=f.state)==null?void 0:a.incomingChanges)!=null?s:[];if(b.length>0){const w=await r.getChanges(e);for(const y of w){const x=this.providerService.getRelativeFilePath(e,y.uri),S=b.find(I=>I.uri.path===x);if(S!==void 0){p.push({path:x,current:y,incomingType:S.type});break}}}if(p.length>0)switch(n.conflictResolution){case Zr.KeepCurrent:u.logStep("Syncing (keep) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (keep) upstream changes..."});for(const w of p)await r.keep(w.current.uri,{type:w.incomingType,providerUri:qf(f,f.HEAD.branch.sha,w.path)});break;case Zr.DiscardCurrent:u.logStep("Syncing (discard) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (discard) upstream changes..."});for(const w of p)await r.discard(w.current.uri);break;case Zr.Merge:u.logStep("Syncing (merge) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (merge) upstream changes..."});for(const w of p)await r.merge(w.current.uri,{type:w.incomingType,providerUri:qf(f,f.HEAD.branch.sha,w.path)},{providerUri:qf(f,f.HEAD.sha,w.path)});break;case Zr.Abort:default:throw u.logStep("Syncing (abort) upstream changes",{message:`: ${p.length} conflicts; \u2022`,suffix:" \u2022 Syncing (abort) upstream changes..."}),await this.providerService.updateMetadata(e,f),new qa}}h=` \u2022 to=${(c=n.to)!=null?c:f.HEAD.branch.sha}`,await this.fastForwardTo(e,(l=n.to)!=null?l:f.HEAD.branch.sha,f)}finally{u.stop(h?{suffix:h}:void 0)}}async fastForwardTo(e,r,n){if(n.HEAD.detached)throw new Ki("Unable to fast-forward; no current branch");if(n.HEAD.sha===r&&n.state===void 0)return;const i=this.asFileTreeKey(e,n.HEAD.sha),o=this.fileTreeCache.get(i);this.fileTreeCache.delete(i),o==null||o.dispose(),K.log(`Fast forward to ${r}; rootUri=${e.toString()}`),await this.providerService.updateMetadata(e,{...n,HEAD:{...n.HEAD,detached:void 0,sha:r},state:r!==n.HEAD.branch.sha?n.state:void 0,timestamp:Date.now()}),r!==n.HEAD.branch.sha&&n.state===void 0&&await this.fetchCore(e,!1,{to:r})}async getBranchTips(e,r){try{const{repo:{owner:n,name:i},HEAD:o}=await this.getMetadata(e);r===void 0&&(o.type===Le.RemoteBranch?r=`${o.branch.remote.repo.owner}/${o.branch.remote.repo.name}:refs/heads/${o.branch.name}`:r=o.branch?`refs/heads/${o.branch.name}`:"");const a=By.exec(r);if(a==null?void 0:a.groups)return this.getRemoteBranchTips(n,i,r);const s=`query getBranchTips(
	$owner: String!
	$repo: String!
	$ref: String!
) {
	repository(owner: $owner, name: $repo) {
		defaultBranchRef {
			target {
				oid
			}
		}
		ref(qualifiedName: $ref) {
			target {
				oid
			}
		}
	}
}`,c=await this.graphql(s,{owner:n,repo:i,ref:r});if((c==null?void 0:c.repository)==null)return;const{defaultBranchRef:l,ref:u}=c.repository;return!l&&!u?void 0:{defaultBranch:l?{sha:l.target.oid}:void 0,branch:u?{sha:u.target.oid}:void 0}}catch(n){return}}async getRemoteBranchTips(e,r,n){try{const i=By.exec(n);if((i==null?void 0:i.groups)==null)return;let{remoteOwner:o,remoteRepo:a,remoteRef:s}=i.groups;a||(a=r);const c=`query getRemoteBranchTips(
	$owner: String!
	$repo: String!
	$remoteOwner: String!
	$remoteRepo: String!
	$remoteRef: String!
) {
	repository(owner: $owner, name: $repo) {
		defaultBranchRef {
			target {
				oid
			}
		}
	}
	remote: repository(owner: $remoteOwner, name: $remoteRepo) {
		ref(qualifiedName: $remoteRef) {
			target {
				oid
			}
		}
	}
}`,l=await this.graphql(c,{owner:e,repo:r,remoteOwner:o,remoteRepo:a,remoteRef:s});if((l==null?void 0:l.repository)==null||(l==null?void 0:l.remote)==null)return;const{repository:{defaultBranchRef:u},remote:{ref:h}}=l;return!u&&!h?void 0:{defaultBranch:u?{sha:u.target.oid}:void 0,branch:h?{sha:h.target.oid}:void 0}}catch(i){return}}async getRepositoryInfo(e,r,n,i){var o,a,s,c,l,u,h,f,p,b,w,y,x,S,I,D;try{const U=`number
title
state
maintainerCanModify
baseRef { name }
baseRefName
baseRefOid
baseRepository {
	name
	owner { login }
	defaultBranchRef {
		name
		target { oid }
	}
	viewerPermission
}
headRef { name }
headRefName
headRefOid
headRepository {
	name
	owner { login }
	defaultBranchRef {
		name
		target { oid }
	}
	viewerPermission
}
mergeCommit { oid }
`,te=`query getRepository(
	$owner: String!
	$repo: String!
	$ref: String = ""
	$has_pr: Boolean!
	$pr: Int = 0
) {
	viewer { login }
	repository(owner: $owner, name: $repo) {
		name
		owner { login }
		defaultBranchRef {
			name
			target { oid }
		}
		ref(qualifiedName: $ref) {
			name
			prefix
			target { oid }
		}
		viewerPermission
		pullRequest(number: $pr) @include(if: $has_pr) {
			${U}
		}
	}
}`;let J,G;try{const xe=await this.graphql(te,{owner:e,repo:r,ref:(i==null?void 0:i.ref)!=="HEAD"?i==null?void 0:i.ref:void 0,has_pr:Boolean(i==null?void 0:i.pr),pr:(o=i==null?void 0:i.pr)!=null?o:0});if((xe==null?void 0:xe.repository)==null)return;({repository:G,viewer:{login:J}}=xe)}catch(xe){if((i==null?void 0:i.pr)&&xe instanceof rc&&((s=(a=xe.errors)==null?void 0:a[0])==null?void 0:s.type)==="NOT_FOUND"&&((c=xe.errors[0])==null?void 0:c.message.includes("Could not resolve to a PullRequest"))){({repository:G,viewer:{login:J}}=xe.data);try{const dt=await this.graphql(`query getPullRequestFromParentRepository(
	$owner: String!
	$repo: String!
	$pr: Int!
) {
	repository(owner: $owner, name: $repo) {
		parent {
			pullRequest(number: $pr) {
				${U}
			}
		}
	}
}`,{owner:e,repo:r,pr:i==null?void 0:i.pr});if(((u=(l=dt==null?void 0:dt.repository)==null?void 0:l.parent)==null?void 0:u.pullRequest)==null)throw xe;G.pullRequest=dt.repository.parent.pullRequest}catch{throw xe}}else throw xe}const ue=(h=G.defaultBranchRef)!=null?h:void 0;if((ue==null?void 0:ue.name)==null)return;const re=G.pullRequest;let se;if(G==null?void 0:G.ref)se={prefix:G.ref.prefix,name:G.ref.name,sha:G.ref.target.oid};else if(re==null?void 0:re.headRef){let xe=jf(re.headRepository.viewerPermission);xe<$t.Write&&re.maintainerCanModify&&jf(G.viewerPermission)>=$t.Write&&(xe=$t.WriteToPullRequest),se=re.headRepository.owner.login===e?{prefix:"refs/heads/",name:re==null?void 0:re.headRef.name,sha:(p=(f=re.mergeCommit)==null?void 0:f.oid)!=null?p:re==null?void 0:re.headRefOid}:{prefix:"refs/remotes/",name:re==null?void 0:re.headRef.name,sha:(w=(b=re.mergeCommit)==null?void 0:b.oid)!=null?w:re==null?void 0:re.headRefOid,remote:{name:`${re.headRepository.owner.login}/${re.headRepository.name}`,accessLevel:xe,repo:{owner:re.headRepository.owner.login,name:re.headRepository.name}}}}else(re==null?void 0:re.baseRef)?(se={prefix:"refs/heads/",name:re==null?void 0:re.baseRef.name,sha:(x=(y=re.mergeCommit)==null?void 0:y.oid)!=null?x:re==null?void 0:re.baseRefOid},n&&(K.log("Did not find a headRef for PR, falling back to baseRef",re.baseRef),kr.showPullRequestHeadNotFoundMessage(`${e}/${r}`,`#${i==null?void 0:i.pr}`))):(i==null?void 0:i.ref)==="HEAD"&&(se={prefix:"refs/heads/",name:ue.name,sha:ue.target.oid});return{user:J,repo:{owner:G.owner.login,name:G.name},accessLevel:jf(G.viewerPermission),ref:se,defaultBranch:{name:ue.name,sha:ue.target.oid},pullRequest:re?{id:re.number.toString(),state:zf(re.state),title:re.title}:void 0}}catch(U){if(U instanceof rc)switch((I=(S=U.errors)==null?void 0:S[0])==null?void 0:I.type){case"NOT_FOUND":{if((i==null?void 0:i.pr)&&((D=U.errors[0])==null?void 0:D.message.includes("Could not resolve to a PullRequest"))){const J=new mc(U,`${e}/${r}`,`#${i==null?void 0:i.pr}`);throw n&&kr.showPullRequestNotFoundMessage(J.name,J.id),J}const te=new Ua(U,`${e}/${r}`);throw n&&kr.showRepositoryNotFoundMessage(te.name),te}case"FORBIDDEN":{const te=new Oa(U,`${e}/${r}`);throw n&&kr.showRepositoryForbiddenMessage(te.name),te}}K.error(U,`Failed to get repository info for '${e}/${r}'`),!this.handleRequestErrors(U)&&n&&kr.showUnableToOpenRepositoryMessage(U);return}}async validateOwnerAndRepoAndSplitRefFromPath(e,r,n){try{const i=await this.request(`GET /repos/{owner}/{repo}/git/extract-ref/${n!=null?n:"HEAD"}`,{owner:e,repo:r});return[e,r]=i.data.name_with_owner.split("/"),n?{owner:e,repo:r,ref:{type:Ue.Tree,id:i.data.ref},path:i.data.path}:{owner:e,repo:r}}catch(i){if(i instanceof Cn)switch(i.status){case 401:throw new _n(i,()=>void this.reauthenticate());case 403:throw new Oa(i,`${e}/${r}`);case 404:throw new Ua(i,`${e}/${r}`);case 409:throw new vc(i,`${e}/${r}`)}return}}asFileTreeKey(e,r){return`${Gn(this.providerService.getProviderRootUri(e))}:${r}`}}$y([yr()],Wf.prototype,"ensureAuthenticated",1),$y([yr()],Wf.prototype,"octokit",1);function zf(t){switch(t){case"OPEN":return bi.Open;case"CLOSED":return bi.Closed;case"MERGED":return bi.Merged}}function kI(t){if(t!==void 0)return t.map(e=>{switch(e){case bi.Open:return"OPEN";case bi.Closed:return"CLOSED";case bi.Merged:return"MERGED"}})}var Ao;(function(t){t.ADMIN="ADMIN",t.MAINTAIN="MAINTAIN",t.WRITE="WRITE",t.TRIAGE="TRIAGE",t.READ="READ",t.NONE="NONE"})(Ao||(Ao={}));function jf(t){switch(t){case Ao.ADMIN:return $t.Admin;case Ao.MAINTAIN:return $t.Maintain;case Ao.WRITE:return $t.Write;case Ao.TRIAGE:return $t.Triage;case Ao.READ:return $t.Read;default:return $t.None}}function II(t){switch(t&&(t=t.toLocaleLowerCase()),t){case"blob":return d.FileType.File;case"tree":return d.FileType.Directory;default:return d.FileType.Unknown}}const Uy=class{constructor(t,e,r){this.providerService=t,this.storageService=e,this.changeStore=r,this.lock=new Ac("PendingRepositoryOpenActions"),this.disposable=d.Disposable.from(t.onDidChangeRepositories(n=>n.added.length&&this.onRepositoriesOpened(n.added)))}dispose(){this.disposable.dispose()}async onRepositoriesOpened(t){for(const e of t){const r=await this.getAndDelete(e);(r==null?void 0:r.applyChangeset)&&await this.applyPendingChangeset(e,r.applyChangeset),(r==null?void 0:r.filesToOpen)&&this.openPendingFiles(e.uri,r.filesToOpen),this.fetchOrSync(e)}}async fetchOrSync(t){await this.changeStore.hasChanges(t.uri)?await this.providerService.fetch(t.uri):await this.providerService.sync(t.uri,this.changeStore,{reason:"invoked"})}async get(t){return this.lock.synchronizeRead(()=>this.getCore(t.uri),"PendingRepositoryOpenActions.get")}async getAndDelete(t){K.debug(`RepositoryOpenActionsService.getAndDelete(${t.uri.toString()})`);try{return await this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t.uri);if(r!==void 0)return await this.storeCore(t.uri,void 0),r},"PendingRepositoryOpenActions.getAndDelete")}catch(e){K.error(e,`Failed to get pending actions for ${t.uri.toString()}`);return}}async openPendingFiles(t,e){if(e.length!==0){K.log(`RepositoryOpenActionsService.openPendingFiles(${t.toString()})`,e.join(","));for(let r of e){const n=/:(?<start>\d+)(?:-(?<end>\d+))?$/.exec(r);let i,o;(n==null?void 0:n.groups)!==void 0&&(i=Number(n.groups.start),isNaN(i)&&(i=void 0),o=Number(n.groups.end),isNaN(o)&&(o=void 0),r=r.substring(0,n.index));const a=d.Uri.joinPath(t,r);let s;try{s=await d.workspace.fs.stat(a)}catch{}if((s==null?void 0:s.type)===d.FileType.Directory)d.commands.executeCommand("revealInExplorer",a);else{let c;i!==void 0&&(c={selection:new d.Range(Number(i)-1,0,o!=null?o:i,0)}),d.commands.executeCommand("vscode.open",a,c)}}}}setChangesetToApply(t,e){return K.log(`RepositoryOpenActionsService.setChangesetToApply(${t.toString()})`),this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t);await this.storeCore(t,{...r,applyChangeset:e})},"PendingRepositoryOpenActions.setChangesetToApply")}setPendingFilesToOpen(t,e){return K.log(`RepositoryOpenActionsService.setPendingFilesToOpen(${t.toString()})`,e.length),this.lock.synchronizeWrite(async()=>{const r=await this.getCore(t);await this.storeCore(t,{...r,filesToOpen:e})},"PendingRepositoryOpenActions.setPendingFilesToOpen")}async applyPendingChangeset(t,e){K.log(`RepositoryOpenActionsService.applyPendingChangeset(${t.uri.toString()})`);try{await this.changeStore.applyChangeset(t.uri,e,{save:!0})}catch(r){K.error(r,`Failed to apply pending changeset for ${t.uri.toString()}`)}}async getCore(t){return this.fromStorage(await this.storageService.get(this.getStorageKey(t)))}storeCore(t,e){return e===void 0||e.applyChangeset===void 0&&(e.filesToOpen===void 0||e.filesToOpen.length===0)?this.storageService.delete(this.getStorageKey(t)):this.storageService.store(this.getStorageKey(t),this.toStorage(e))}getStorageKey(t){return`actions/${we(t)}`}fromStorage(t){if(!!t)try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&gc(n)?d.Uri.from(n):n);return{filesToOpen:e.filesToOpen,applyChangeset:e.applyChangeset}}catch(e){return K.error(e,"Failed to deserialize pending repository actions"),{}}}toStorage(t){const e={schemaVersion:Uy.storageSchemaVersion,...t};return JSON.stringify(e)}};let Ly=Uy;Ly.storageSchemaVersion=1;const ln=(0,C.loadMessageBundle)();class DI{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChangeFileDecorations=new d.EventEmitter,this._decorations=new Map,this.disposable=d.Disposable.from(d.window.registerFileDecorationProvider(this),e.onDidChangeRepository(this.onRefresh,this),e.onDidRefresh(this.onRefresh,this),r.onDidChange(this.onUrisChanged,this))}get onDidChangeFileDecorations(){return this._onDidChangeFileDecorations.event}dispose(){this.disposable.dispose(),this._decorations.clear()}onRefresh(){this._decorations.clear(),setTimeout(()=>this._onDidChangeFileDecorations.fire(void 0),0)}onUrisChanged(e){const r=e.map(({uri:n})=>(this._decorations.delete(we(n)),n));setTimeout(()=>this._onDidChangeFileDecorations.fire(r),0)}async provideFileDecoration(e,r){if(e.scheme!==Pt.scheme)return;const n=we(e);let i=this._decorations.get(n);if(i!==void 0)return i!=null?i:void 0;const o=await this.providerService.getIncomingChanges(this.providerService.getVirtualRootUri(e));let a;o.length>0&&(a=o.find(c=>we(c.uri)===n));const s=await this.changeStore.getChange(e);if(s===void 0){if(a!==void 0)switch(a.type){case rt.Created:i={badge:"\u2193A",color:new d.ThemeColor("remoteHub.decorations.incomingAddedForegroundColor"),tooltip:ln("decoration tooltip incoming change added","Pending Incoming Changes (Added)")};break;case rt.Deleted:i={badge:"\u2193D",color:new d.ThemeColor("remoteHub.decorations.incomingDeletedForegroundColor"),tooltip:ln("decoration tooltip incoming change deleted","Pending Incoming Changes (Deleted)")};break;case rt.Changed:i={badge:"\u2193M",color:new d.ThemeColor("remoteHub.decorations.incomingModifiedForegroundColor"),tooltip:ln("decoration tooltip incoming change modified","Pending Incoming Changes (Modified)")};break;default:i={badge:"\u2193~",color:new d.ThemeColor("remoteHub.decorations.incomingModifiedForegroundColor"),tooltip:ln("decoration tooltip incoming change","Pending Incoming Changes")};break}return this._decorations.set(n,i!=null?i:null),i}if(s.conflicts)i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.conflictForegroundColor"),tooltip:ln("decoration tooltip conflicts","Merge Conflicts ({0})",RC(s.conflicts.status))};else if(a!==void 0)switch(a.type){case rt.Created:i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ln("decoration tooltip possible conflict added","Possible Merge Conflicts (Added)")};break;case rt.Deleted:i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ln("decoration tooltip possible conflict deleted","Possible Merge Conflicts (Deleted)")};break;case rt.Changed:i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ln("decoration tooltip possible conflict","Possible Merge Conflicts")};break;default:i={badge:"\u26A0",color:new d.ThemeColor("remoteHub.decorations.possibleConflictForegroundColor"),tooltip:ln("decoration tooltip possible conflict","Possible Merge Conflicts")}}else switch(s.type){case rt.Created:i={badge:"A",color:new d.ThemeColor("remoteHub.decorations.addedForegroundColor"),tooltip:ln("decoration tooltip added","Added")};break;case rt.Changed:i={badge:"M",color:new d.ThemeColor("remoteHub.decorations.modifiedForegroundColor"),tooltip:ln("decoration tooltip modified","Modified")};break;case rt.Deleted:i={badge:"D",color:new d.ThemeColor("remoteHub.decorations.deletedForegroundColor"),tooltip:ln("decoration tooltip deleted","Deleted")};break}return this._decorations.set(n,i!=null?i:null),i}}class ko{constructor(e){this.command=e}get label(){return this.command.title}async execute(){var e;return void await d.commands.executeCommand(this.command.command,...(e=this.command.arguments)!=null?e:[])}}var uu;(function(t){async function e(r,n,i,o,a,s){let c;Array.isArray(a)?c=a:s===void 0&&(c=[],s=a);const l=d.window.createQuickPick(),u=new Fh(500),h=[u],{defaultBranch:f,HEAD:p}=await r.getMetadata(n);async function b(I){var D;const[U,te,J]=await Promise.all([r.getBranches(n,{query:I,limit:100}),r.getTags(n,{query:I,limit:100}),r.getSnapshots(n)]),G=new Set,ue=new Set;for(const se of J)G.add(se.hash),ue.add(se.branch.name);const re=((s==null?void 0:s.filterBranches)?U.branches.filter(s==null?void 0:s.filterBranches):U.branches).filter(se=>se.name!==f.name);return[...c,...((D=p.branch)==null?void 0:D.name)!==f.name?[{label:`$(git-branch) ${f.name} (default)`,description:`\u2022$(git-commit) ${pr(f.sha)}${ue.has(f.name)||G.has(f.sha)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,alwaysShow:!0,type:Ue.Branch,name:void 0,sha:f.sha}]:[],...re.map(se=>({label:`$(git-branch) ${se.name}`,description:`\u2022$(git-commit) ${pr(se.commit)}${ue.has(se.name)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,type:Ue.Branch,name:se.name,sha:se.commit})),...te.tags.map(se=>({label:`$(tag) ${se.name}`,description:`\u2022$(git-commit) ${pr(se.commit)}${G.has(se.commit)?"\xA0\xA0\u2022\xA0\xA0$(layers)":""}`,type:Ue.Tag,name:se.name,sha:se.commit}))]}const w=b(void 0);let y,x=!1;async function S(I){y=void 0;const D=l.activeItems;l.items=I!=null?I:await w,x&&D.length!==0&&(l.activeItems=l.items.filter(U=>D.some(te=>te.label===U.label))),l.busy=!1}try{return await new Promise(D=>{var U;h.push(l.onDidHide(()=>D(void 0)),l.onDidChangeValue(te=>{if(x=!1,te=te.trim(),(s==null?void 0:s.allowResetToSha)&&p.branch&&Zn(te)){S([{label:`Reset $(git-branch) ${p.branch.name} to $(git-commit) ${te}`,name:p.branch.name,sha:te,type:Ue.Branch}]);return}l.busy=!0;const J=u.debounce(te?()=>b(te):()=>w);y===void 0&&(y=J.then(async G=>S(G)))}),l.onDidAccept(()=>{if(l.activeItems.length!==0){const[te]=l.activeItems;D(te)}})),l.title=o,l.placeholder=i,l.matchOnDescription=!0,l.ignoreFocusOut=(U=s==null?void 0:s.ignoreFocusOut)!=null?U:!0,l.busy=!0,l.show(),y=u.debounce(async()=>w,0).then(te=>S(te))})}finally{l.dispose(),h.forEach(I=>void I.dispose())}}t.show=e})(uu||(uu={}));function Vf(t,e){switch(t){case Le.Branch:case Le.RemoteBranch:return e?"$(git-pull-request)":"$(git-branch)";case Le.Tag:return"$(tag)";case Le.Commit:return"$(git-commit)"}}function PI(t){switch(t){case xt.Active:return"$(layers-active)";case xt.Match:return"$(layers-dot)";case xt.Indexed:return"$(layers)"}}function FI(t,e){switch(t){case Le.Branch:case Le.RemoteBranch:return e?new d.ThemeIcon("git-pull-request"):new d.ThemeIcon("git-branch");case Le.Tag:return new d.ThemeIcon("tag");case Le.Commit:return new d.ThemeIcon("git-commit")}}const de=(0,C.loadMessageBundle)(),NI=new TextDecoder;class $I{constructor(e,r,n,i){this.providerService=e,this.changeStore=r,this.openActionsService=n,this.telemetryService=i,this._onDidCloseRepository=new d.EventEmitter,this._onDidOpenRepository=new d.EventEmitter,this._onDidChangeState=new d.EventEmitter,this._scmProviders=[],this._state="uninitialized",this.disposable=d.Disposable.from(Ye.onDidChange(this.onConfigurationChanged,this),this.providerService.onDidChangeRepositories(this.onRepositoriesChanged,this),this.providerService.onDidChangeRepository(async({repository:a})=>{const s=this.getScmProvider(this.providerService.getVirtualUri(a.uri));s!==void 0&&await this.updateStatusBarCommands(s,void 0)}),this.providerService.onDidSyncRepository(async({repository:a,syncing:s})=>{const c=this.getScmProvider(this.providerService.getVirtualUri(a.uri));c!==void 0&&await this.updateStatusBarCommands(c,{syncing:s})}),this.providerService.onDidRefresh(a=>{for(const s of a)this.update(s)}),this.changeStore.onDidChange(a=>this.update(a[0].rootUri)),...this.registerCommands());const o=this.providerService.repositories;this.onRepositoriesChanged({added:o,removed:[]})}get onDidCloseRepository(){return this._onDidCloseRepository.event}get onDidOpenRepository(){return this._onDidOpenRepository.event}get onDidChangeState(){return this._onDidChangeState.event}get repositories(){return this._scmProviders.map(e=>e.repository).filter(e=>Boolean(e))}dispose(){var e;(e=this.disposable)==null||e.dispose()}get staging(){return this._staging===void 0&&(this._staging=Ye.get("staging")),this._staging}get state(){return this._state}refresh(){for(const e of this._scmProviders)this.update(e.sourceControl.rootUri)}onConfigurationChanged(e){Ye.changed(e,"staging")&&(this._staging=void 0,Ye.changed(e,"staging.enabled")&&this.refresh()),Ye.changed(e,"commitDirectlyWarning")&&this.refresh()}async onRepositoriesChanged(e){if(e.added.length)for(const r of e.added){const n=await this.update(r.uri);(n==null?void 0:n.repository)&&this._onDidOpenRepository.fire(n.repository)}if(e.removed.length)for(const r of e.removed){const n=this._scmProviders.findIndex(i=>we(i.sourceControl.rootUri)===we(r.uri));if(n!==-1){const i=this._scmProviders[n];i.repository&&this._onDidCloseRepository.fire(i.repository),i.sourceControl.dispose(),this._scmProviders.splice(n,1)}}this._state!=="initialized"&&(this._state="initialized",this._onDidChangeState.fire(this._state)),ui(Nn.HasWriteableScmProvider,this._scmProviders.some(r=>!r.isReadonly))}registerCommands(){return[d.commands.registerCommand("remoteHub.createPullRequest",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.createPullRequest"),void this.createPullRequest(e)}),d.commands.registerCommand("remoteHub.createDraftPullRequest",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.createDraftPullRequest"),void this.createPullRequest(e,{draft:!0})}),d.commands.registerCommand("remoteHub.commit",e=>{if(e=this.getSourceControlFrom(e),e!==void 0)return this.telemetryService.sendEvent("command.commit"),void this.commitChanges(e)}),d.commands.registerCommand("remoteHub.discardAllChanges",async e=>{if(Hy(e)){const o=e.resourceStates.filter(ic);if(o.length!==0){if(await Kf(o))for(const a of o)await this.changeStore.discard(a.resourceUri);else this.telemetryService.sendEvent("command.discardAllChanges.abort",{reason:"aborted"});return}}const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)===void 0)return;this.telemetryService.sendEvent("command.discardAllChanges");const n=await this.changeStore.getChanges(r.rootUri);await Kf(n)?await this.changeStore.discardAll(r.rootUri):this.telemetryService.sendEvent("command.discardAllChanges.abort",{reason:"aborted"})}),d.commands.registerCommand("remoteHub.discardChanges",async e=>{!ic(e)||(this.telemetryService.sendEvent("command.discardChanges"),await Kf([e])?await this.changeStore.discard(e.resourceUri):this.telemetryService.sendEvent("command.discardChanges.abort",{reason:"aborted"}))}),d.commands.registerCommand("remoteHub.stageAllChanges",async e=>{const r=this.getSourceControlFrom(e);(r==null?void 0:r.rootUri)!==void 0&&(this.telemetryService.sendEvent("command.stageAllChanges"),await this.changeStore.stageAll(r.rootUri))}),d.commands.registerCommand("remoteHub.stageChanges",e=>{if(!!ic(e))return this.telemetryService.sendEvent("command.stageChanges"),void this.changeStore.stage(e.resourceUri)}),d.commands.registerCommand("remoteHub.unstageAllChanges",e=>{const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)!==void 0)return this.telemetryService.sendEvent("command.unstageAllChanges"),void this.changeStore.unstageAll(r.rootUri)}),d.commands.registerCommand("remoteHub.unstageChanges",e=>{if(!!ic(e))return this.telemetryService.sendEvent("command.unstageChanges"),void this.changeStore.unstage(e.resourceUri)}),d.commands.registerCommand("remoteHub.keepChanges",e=>{if(!!ic(e))return this.telemetryService.sendEvent("command.keepChanges"),void this.changeStore.keep(e.resourceUri)}),d.commands.registerCommand("remoteHub.openChanges",e=>{var r;const{command:n}=e;if(!!n)return this.telemetryService.sendEvent("command.openChanges"),void d.commands.executeCommand(n.command,...(r=n.arguments)!=null?r:[])}),d.commands.registerCommand("remoteHub.openFile",e=>{var r;if(Gf(e)){const i=this.changeStore.resolveOpenCommand(e.resourceUri,{preserveFocus:!1,preview:!1,viewColumn:d.ViewColumn.Active});return this.telemetryService.sendEvent("command.openFile"),void d.commands.executeCommand(i.command,...(r=i.arguments)!=null?r:[])}const n=d.window.activeTextEditor;if(!!n)return this.telemetryService.sendEvent("command.openFile"),void d.window.showTextDocument(n.document)}),d.commands.registerCommand("remoteHub.createBranch",async e=>{await Mh("remoteHub.createBranchFrom",{...e,fromSha:"HEAD"})}),d.commands.registerCommand("remoteHub.createBranchFrom",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await oc(this._scmProviders,de("choose repo for create branch placeholder","Choose which repository to create a new branch on"),de("choose repo for create branch title","Create Branch"));if(n===void 0)return;this.telemetryService.sendEvent("command.createBranchFrom");const i=await this.providerService.getMetadata(n);if(i.accessLevel<$t.Write){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"no permissions"}),d.window.showErrorMessage(de("no permissions to create branch ","You don't have access to create branches on this repository."));return}let o;if(e==null?void 0:e.fromSha)o=e.fromSha,o==="HEAD"&&(o=i.HEAD.sha);else{const f=await uu.show(this.providerService,n,de("choose branch for create placeholder","Choose which branch to create the new branch from"),de("choose branch for create title","Create Branch \u2022 {0}",i.name));if(!f){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"abandoned branch picker"});return}o=f.sha}let a;try{a=await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>du(this.providerService,n,o,de("create branch","Please provide a new branch name"),de("create branch placeholder","New branch name"),de("create branch title","Create Branch \u2022 {0}",i.name)))}catch(f){K.error(f),d.window.showErrorMessage(de("unable to create branch","Unable to create the new branch."));return}if(!a){this.telemetryService.sendEvent("command.createBranchFrom.abort",{reason:"abandoned branch name prompt"});return}const s=await this.providerService.switchTo(n,{type:Ue.Branch,id:a});if(!s)return;const c=await this.changeStore.createChangeset(n);c&&await this.openActionsService.setChangesetToApply(s.uri,c);const l=de("switch to branch prompt open","Switch to Branch"),u=de("switch to branch prompt open in new window","Open in New Window"),h=await d.window.showInformationMessage(de("switch to branch prompt",`Created new branch '{0}'.

Any uncommitted changes will be applied to the new branch.

Do you want to switch to the new branch?`,a),{modal:!0,useCustom:!0},l,u);!h||(s.location=h===u?At.NewWindow:At.CurrentWindow,await nn(s,{skipChangesPrompt:!0}))}),d.commands.registerCommand("remoteHub.applyPatch",async e=>{if(e=this.getSourceControlFrom(e),(e==null?void 0:e.rootUri)===void 0)return;this.telemetryService.sendEvent("command.applyPatch");let r;const n=d.window.activeTextEditor;if((n==null?void 0:n.document.languageId)!=="diff"){const i=await d.window.showOpenDialog({openLabel:de("open patch","Open Patch"),title:de("open patch","Open Patch"),canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Diff:["diff"],Patch:["*","patch"]}});if(i===void 0||i.length===0)return;r=NI.decode(await d.workspace.fs.readFile(i[0]))}else r=n.document.getText();try{await this.changeStore.applyPatch(e.rootUri,r)}catch{d.window.showErrorMessage(de("invalid patch file","Invalid patch file"))}}),d.commands.registerCommand("remoteHub.exportPatch",async e=>{const r=this.getSourceControlFrom(e);if((r==null?void 0:r.rootUri)===void 0)return;let n;Gf(e)&&(n=e.resourceUri),this.telemetryService.sendEvent("command.exportPatch");const i=await this.changeStore.createPatch(r.rootUri,n),o=await d.workspace.openTextDocument({language:"diff",content:i});await d.window.showTextDocument(o)}),d.commands.registerCommand("remoteHub.switchToBranch",async e=>{var r,n;const i=(r=e==null?void 0:e.uri)!=null?r:await oc(this._scmProviders,de("choose repo for switch branch placeholder","Choose which repository to switch branches on"),de("choose repo for switch branch title","Switch to Branch or Tag"));if(i===void 0)return;this.telemetryService.sendEvent("command.switchToBranch");const o=[],a=await this.providerService.getMetadata(i);if(e==null?void 0:e.commands)switch(a.accessLevel>=$t.Write&&o.push(new ko(yn({command:"remoteHub.createBranch",title:de("create branch command","$(add) Create New Branch..."),arguments:[{uri:i}]})),new ko(yn({command:"remoteHub.createBranchFrom",title:de("create branch from command","$(add) Create New Branch from..."),arguments:[{uri:i}]}))),a.HEAD.type){case Le.Branch:o.push(new ko(yn({command:"remoteHub.openOnRemote",title:de("open branch on remote command","$(globe) Open Branch on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,branch:a.HEAD.branch.name}]})));break;case Le.RemoteBranch:o.push(new ko(yn({command:"remoteHub.openOnRemote",title:de("open remote branch on remote command","$(globe) Open Remote Branch on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.HEAD.branch.remote.repo,branch:a.HEAD.branch.name}]})));break;case Le.Tag:o.push(new ko(yn({command:"remoteHub.openOnRemote",title:de("open tag on remote command","$(globe) Open Tag on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,tag:a.HEAD.detached.name}]})));break;case Le.Commit:o.push(new ko(yn({command:"remoteHub.openOnRemote",title:de("open commit on remote command","$(globe) Open Commit on {0}...",a.provider.name),arguments:[{provider:a.provider,repo:a.repo,sha:a.HEAD.sha}]})));break}const s=(n=a.HEAD.branch)==null?void 0:n.name,c=Boolean(s&&!await this.changeStore.hasChanges(i)),l=await uu.show(this.providerService,i,de("choose switch branch placeholder","Choose which branch to switch to"),de("choose switch branch title","Switch to Branch or Tag \u2022 {0}",a.name),o,{allowResetToSha:c,filterBranches:s?u=>u.name!==s:void 0,ignoreFocusOut:!1});if(!l){this.telemetryService.sendEvent("command.switchToBranch.abort",{reason:"abandoned branch picker"});return}return l instanceof ko?void l.execute():c&&l.type===Ue.Branch&&l.name===s&&l.sha?d.window.withProgress({location:d.ProgressLocation.SourceControl},async()=>{try{await this.providerService.sync(i,this.changeStore,{to:l.sha})}catch(u){K.error(u),d.window.showErrorMessage(de("reset failed","Unable to reset the repository to commit '{0}'.",pr(l.sha)))}}):void d.window.withProgress({location:d.ProgressLocation.SourceControl},async()=>{const u=await this.providerService.switchTo(i,l.name?{type:l.type,id:l.name}:void 0);if(u!==void 0)return nn(u)})}),d.commands.registerCommand("remoteHub.fetch",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await oc(this._scmProviders,de("choose repo for fetch placeholder","Choose which repository to fetch"),de("choose repo for fetch title","Fetch Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.fetch");try{await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.providerService.fetch(n,{force:!0}))}catch(i){d.window.showErrorMessage(de("fetch failed","Unable to fetch repository"))}}}),d.commands.registerCommand("remoteHub.fetchAll",async e=>{const r=this.providerService.repositories;if(r.length===0)return;(e==null?void 0:e.automated)||this.telemetryService.sendEvent("command.fetchAll"),(await d.window.withProgress({location:d.ProgressLocation.SourceControl},async()=>{const i=[];for(const o of r)try{await this.providerService.fetch(o.uri)}catch(a){i.push(a)}return i})).length&&!(e==null?void 0:e.automated)&&d.window.showErrorMessage(r.length?de("fetch all failed","Unable to fetch repositories"):de("fetch failed","Unable to fetch repository"))}),d.commands.registerCommand("remoteHub.pull",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await oc(this._scmProviders,de("choose repo for pull placeholder","Choose which repository to pull"),de("choose repo for pull title","Pull Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.pull");try{await this.sync(n,{pull:!0})}catch{}}}),d.commands.registerCommand("remoteHub.sync",async e=>{var r;const n=(r=e==null?void 0:e.uri)!=null?r:await oc(this._scmProviders,de("choose repo for sync placeholder","Choose which repository to sync"),de("choose repo for sync title","Synchronize Repository"));if(n!==void 0){this.telemetryService.sendEvent("command.sync");try{await this.sync(n)}catch{}}}),d.commands.registerCommand("remoteHub.disableCommitDirectlyWarning",()=>{this.telemetryService.sendEvent("command.disableCommitDirectlyWarning"),Ye.updateEffective("commitDirectlyWarning",B.Off)})]}async sync(e,{pull:r,...n}={pull:!1}){this.telemetryService.sendEvent("sync");try{await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.providerService.sync(e,this.changeStore,n))}catch(i){if(i instanceof qa){const o={title:de("sync confirm","Continue")},a={title:de("sync cancel","Cancel"),isCloseAffordance:!0};await d.window.showWarningMessage(r?de("sync pull",`Pulling in changes may cause conflicts with your uncommitted changes as one of more of those files has changed since you started editing.

Do you want to continue pulling in changes.`):de("sync",`Syncing changes may cause conflicts with your uncommitted changes as one of more of those files has changed since you started editing.

Do you want to continue syncing changes?`),{modal:!0,useCustom:!0},o,a)===o?await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.providerService.sync(e,this.changeStore,{conflictResolution:Zr.Merge})):this.telemetryService.sendEvent("sync.abort",{reason:"abandoned"})}else throw K.error(i),this.telemetryService.sendException(i),d.window.showErrorMessage(de("sync failed","Unable to sync the repository.")),i}}async commitChanges(e){try{await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.commitChangesCore(e))}catch(r){if(r instanceof $o){d.window.showInformationMessage(de("no changes to commit","There are no changes to commit."));return}K.error(r),d.window.showErrorMessage(de("commit unable","Unable to commit.")),this.telemetryService.sendException(r)}}async commitChangesCore(e){const r=e.rootUri;this.telemetryService.sendEvent("commit",{staging:String(this.staging.enabled)});const n=new $e(`VirtualSourceControl.commitChanges(${r.toString()})`);let i;try{const o=await this.providerService.getMetadata(r);let a,s;const c=this.staging.enabled?this.staging.smart?"auto":!0:!1;for(;;){const u=e.inputBox.value;if(await this.changeStore.hasMergeConflicts(r)){e.inputBox.showValidationMessage(de("commit resolve conflicts","You must resolve any pending conflicts before committing."),d.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("commit.abort",{reason:"aborted conflicts"}),i=": Aborted; Unresolved conflicts";return}const h=await this.providerService.getCommitOperations(r,this.changeStore,{staged:c});if(h.length===0){e.inputBox.showValidationMessage(this.staging.enabled?de("commit no staged changes","There are no staged changes to commit."):de("commit no changes","There are no changes to commit."),d.SourceControlInputBoxValidationType.Information),this.telemetryService.sendEvent("commit.abort",{reason:this.staging.enabled?"aborted no staged changes":"aborted no changes"}),i=`: Aborted; No ${this.staging.enabled?"staged ":""}changes`;return}if(!u){e.inputBox.showValidationMessage(de("specify commit message","You must specify a commit message before committing."),d.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("commit.abort",{reason:"aborted no message"}),i=": Aborted; No message";return}let f,p;if(o.HEAD.type===Le.RemoteBranch?(p=o.HEAD.branch.remote.accessLevel<$t.Write,f=p&&o.accessLevel<$t.Write):(f=o.accessLevel<$t.Write,p=f),s===void 0&&f&&(s=await this.providerService.getFork(r),s===void 0)){const b={title:de("fork confirm","Fork Repository")},w={title:de("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showInformationMessage(de("fork","You\u2019re trying to make changes in a project you don\u2019t have write access to. Do you want to create a fork of this project to commit your proposed changes to?"),{modal:!0,useCustom:!0},b,w)!==b){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned fork prompt"}),i=": Aborted; Abandoned fork prompt";return}if(s=await d.window.withProgress({location:d.ProgressLocation.Notification,title:de("fork progress","Forking {0}...",o.name)},()=>this.providerService.fork(r)),s===void 0){d.window.showErrorMessage(de("unable to fork","Unable to fork repository.")),this.telemetryService.sendEvent("commit.abort",{reason:"aborted fork failed"}),i=": Aborted; Fork failed";return}}if(s||p){if(s===void 0){const w={title:de("remote branch create branch prompt confirm","Commit to New Branch")},y={title:de("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showErrorMessage(de("remote branch create branch prompt",`You\u2019re trying to make changes to a branch you don\u2019t have write access to.

Do you want to commit your changes to a new branch?`),{modal:!0,useCustom:!0},w,y)!==w){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned remote branch prompt"}),i=": Aborted; Abandoned commit to new branch prompt";return}}let b=0;try{const w=await this.providerService.getBranches(s?this.providerService.createVirtualUri(r,s):r,{query:"patch-"});for(const y of w.branches){const x=/^patch-(?<num>\d+)$/.exec(y.name);if(x==null?void 0:x.groups){const S=Number(x.groups.num);S>b&&(b=S)}}}catch{}if(a=await du(this.providerService,r,o.HEAD.sha,de("create new branch prompt","Create a new branch to commit your changes to"),de("create new branch placeholder","New branch name"),de("create new branch title","Commit \u2022 Create Branch \u2022 {0}",s?s.name:o.name),s,`patch-${b+1}`),!a){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned create branch prompt"}),i=": Aborted; Abandoned create branch prompt";return}}try{if(Ye.getUseNewCommitApi())await this.providerService.createAndPushCommit(r,u,h,a,s);else{n.logStep("Creating commit");const b=await this.providerService.createCommit(r,u,h,s);n.logStep("Pushing",{message:`: Created commit ${b}`,suffix:" \u2022 Pushing..."}),await this.providerService.pushCommit(r,b,a,s)}}catch(b){if(b instanceof Ki){const w={title:de("detached head prompt confirm","Commit to New Branch")},y={title:de("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showErrorMessage(de("detached head prompt",`Unable to commit your changes because you are not currently on a branch.

Do you want to commit your changes to a new branch?`),{modal:!0},w,y)!==w){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned detached head prompt"}),i=": Aborted; Abandoned commit to new branch prompt (detached head)";return}if(a=await du(this.providerService,r,o.HEAD.sha,de("create new branch prompt","Create a new branch to commit your changes to"),de("create new branch placeholder","New branch name"),de("create new branch title","Commit \u2022 Create Branch \u2022 {0}",s?s.name:o.name),s),!a){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned detached head create branch prompt"}),i=": Aborted; Abandoned create branch prompt (detached head)";return}continue}else if(b instanceof Ha){const w={title:de("push conflicts prompt pull","Pull")},y={title:de("push conflicts prompt sync","Sync (Pull & Push)")},x={title:de("cancel","Cancel"),isCloseAffordance:!0},S=await d.window.showErrorMessage(de("push conflicts prompt",`Changes have been committed since you started editing, so you must merge those changes before you can commit.

Do you want to pull or sync (pull and automatically push) your changes?`),{modal:!0},w,y,x);if(S!==w&&S!==y){this.telemetryService.sendEvent("commit.abort",{reason:"abandoned conflicts prompt"}),i=": Aborted; Abandoned merge changes prompt";return}if(await this.sync(r,{pull:S===w,conflictResolution:Zr.Merge}),S===w){i=': Aborted; Chose "pull" from merge changes prompt';return}continue}else throw K.error(b),i=`: Aborted; ${String(b)}`,b}break}if(e.inputBox.value="",s?await this.changeStore.discardAll(r,{staged:c}):await this.changeStore.acceptAll(r,{staged:c}),ep(Io.HasCommitted,!0),!s&&!a)return;async function l(){if(s){const p={title:de("commit to fork confirm","Switch to Fork")},b={title:de("cancel","Cancel"),isCloseAffordance:!0},w=await d.window.showInformationMessage(de("commit to fork","Committed changes to your fork of {0}. Do you want to switch to your fork to continue making changes?",o.name),{modal:!0,useCustom:!0},p,b);if(this.telemetryService.sendEvent("commit.switchToFork",{confirm:String(w===p)}),w===p){let y;a!==void 0?y={type:Ue.Branch,id:a}:o.HEAD.branch!==void 0&&(y={type:Ue.Branch,id:o.HEAD.branch.name}),nn({name:s.name,uri:this.providerService.createVirtualUri(r,{repo:s.repo,ref:y}),location:At.CurrentWindow})}return}const u={title:de("commit to new branch confirm","Switch to Branch")},h={title:de("cancel","Cancel"),isCloseAffordance:!0},f=await d.window.showInformationMessage(de("commit to new branch","Committed changes to new branch '{0}'. Do you want to switch to the new branch to continue making changes?",a),{modal:!0,useCustom:!0},u,h);this.telemetryService.sendEvent("commit.switchToBranch",{confirm:String(f===u)}),f===u&&nn({name:o.name,uri:this.providerService.createVirtualUri(r,{repo:o.repo,ref:a?{type:Ue.Branch,id:a}:void 0}),location:At.CurrentWindow})}l.call(this)}finally{n.stop(i?{message:i}:void 0)}}async createPullRequest(e,r){try{await d.window.withProgress({location:d.ProgressLocation.SourceControl},()=>this.createPullRequestCore(e,r))}catch(n){if(n instanceof $o){d.window.showInformationMessage(de("no changes to commit","There are no changes to commit."));return}if(n instanceof wc){d.window.showErrorMessage(de("commit unable","Unable to commit."));return}K.error(n),d.window.showErrorMessage(de("unable to open pr","Unable to open a pull request.")),this.telemetryService.sendException(n)}}async createPullRequestCore(e,r){var n,i;const o=e.rootUri,a=(n=r==null?void 0:r.draft)!=null?n:!1;this.telemetryService.sendEvent("createPullRequest",{draft:String(a),staging:String(this.staging.enabled)});const s=new $e(`VirtualSourceControl.createPullRequest(${o.toString()})`);let c;try{let l=function(){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned branch prompt"}),c=": Aborted; Abandoned commit to new branch prompt"},u;const h=this.staging.enabled?this.staging.smart?"auto":!0:!1;if(!(r==null?void 0:r.sha)){if(await this.changeStore.hasMergeConflicts(o)){e.inputBox.showValidationMessage(de("commit resolve conflicts","You must resolve any pending conflicts before committing."),d.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted conflicts"}),c=": Aborted; Unresolved conflicts";return}if(u=await this.providerService.getCommitOperations(o,this.changeStore,{staged:this.staging.enabled?this.staging.smart?"auto":!0:!1}),u.length===0){e.inputBox.showValidationMessage(this.staging.enabled?de("commit no staged changes","There are no staged changes to commit."):de("commit no changes","There are no changes to commit."),d.SourceControlInputBoxValidationType.Information),this.telemetryService.sendEvent("createPullRequest.abort",{reason:this.staging.enabled?"aborted no staged changes":"aborted no changes"}),c=`: Aborted; No ${this.staging.enabled?"staged ":""}changes`;return}}const f=e.inputBox.value;if(!f){e.inputBox.showValidationMessage(de("specify commit message","You must specify a commit message before committing."),d.SourceControlInputBoxValidationType.Error),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted no message"}),c=": Aborted; No message";return}const p=await this.providerService.getMetadata(o);let b,w;p.HEAD.type===Le.RemoteBranch?(w=p.HEAD.branch.remote.accessLevel<$t.Write,b=w&&p.accessLevel<$t.Write):(b=p.accessLevel<$t.Write,w=b);let y=r==null?void 0:r.fork;if(y===void 0&&b&&(y=await this.providerService.getFork(o),y===void 0)){const te={title:de("fork confirm","Fork Repository")},J={title:de("cancel","Cancel"),isCloseAffordance:!0};if(await d.window.showInformationMessage(de("fork",`You\u2019re trying to make changes in a project you don\u2019t have write access to.

Do you want to create a fork of this project to commit your proposed changes to?`),{modal:!0,useCustom:!0},te,J)!==te){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned fork prompt"}),c=": Aborted; Abandoned fork prompt";return}if(y=await d.window.withProgress({location:d.ProgressLocation.Notification,title:de("fork progress","Forking {0}...",p.name)},()=>this.providerService.fork(o)),y===void 0){d.window.showErrorMessage(de("unable to fork","Unable to fork repository.")),this.telemetryService.sendEvent("createPullRequest.abort",{reason:"aborted fork failed"}),c=": Aborted; Fork failed";return}}const x=await d.window.showInputBox({ignoreFocusOut:!0,placeHolder:de("create pr placeholder","Pull request title"),prompt:de("create pr prompt","Enter a title for the new pull request"),title:de("create pr title","New Pull Request"),value:f});if(!x){this.telemetryService.sendEvent("createPullRequest.abort",{reason:"abandoned title prompt"}),c=": Aborted; Abandoned title prompt";return}async function S(te){let J=0;try{const G=await this.providerService.getBranches(y?this.providerService.createVirtualUri(o,y):o,{query:"patch-"});for(const ue of G.branches){const re=/^patch-(?<num>\d+)$/.exec(ue.name);if(re==null?void 0:re.groups){const se=Number(re.groups.num);se>J&&(J=se)}}}catch{}return du(this.providerService,o,te,de("create pr branch prompt","Create a new branch for this pull request"),de("create pr branch placeholder","New branch name"),de("create pr branch title","New Pull Request \u2022 Create Branch \u2022 {0}",y?y.name:p.name),y,`patch-${J+1}`)}let I;if(Ye.getUseNewCommitApi()){if(I=await S.call(this,p.HEAD.sha),!I){l.call(this);return}(u==null?void 0:u.length)&&await this.providerService.createAndPushCommit(o,f,u,I,y)}else{let te;if((u==null?void 0:u.length)?(te=await this.providerService.createCommit(o,f,u,y),s.log({message:`: Created commit ${te}`})):(te=(i=r==null?void 0:r.sha)!=null?i:p.HEAD.sha,s.log({message:`: Using commit ${te}`})),I=await S.call(this,te),!I){l.call(this);return}}const D=await this.providerService.createPullRequest(o,I,x,{draft:a},y);e.inputBox.value="",(u==null?void 0:u.length)&&(y?await this.changeStore.discardAll(o,{staged:h}):await this.changeStore.acceptAll(o,{staged:h}));async function U(){const te={title:de("created pr notification confirm","Switch to Pull Request")},J={title:de("cancel","Cancel"),isCloseAffordance:!0},G=await d.window.showInformationMessage(de("created pr notification",'Created [Pull Request #{0}]({1} "Open Pull Request #{0} on {2}") for {3}. Do you want to switch to the new pull request?',D.id,D.uri.toString(!0),p.provider.name,p.name),{modal:!0,useCustom:!0},te,J);this.telemetryService.sendEvent("createPullRequest.switchToPullRequest",{confirm:String(G===te)}),G===te&&nn({name:p.name,uri:this.providerService.createVirtualUri(o,{repo:p.repo,ref:{type:Ue.PullRequest,id:D.id}}),location:At.CurrentWindow})}U.call(this)}finally{s.stop(c?{message:c}:void 0)}}async update(e){const r=d.workspace.getWorkspaceFolder(e);if(r===void 0)return;const n=await this.createOrUpdateScmProvider(e,r.name),i=await this.changeStore.getGroupedChanges(e,{predicate:c=>c.fileType===d.FileType.File}),o=await Promise.all(i.conflicts.map(async c=>({type:c.type,resourceUri:c.uri,command:await this.changeStore.resolveDiffCommand(c.uri,c.conflicts.incomingUri,de("diff title with conflicts","{0} (Incoming Changes \u2194 Current Changes)",Ur(c.uri)))}))),a=await Promise.all(i.staged.map(async c=>({type:c.type,resourceUri:c.uri,command:await this.changeStore.resolveDiffCommand(c.uri,this.providerService.getProviderUri(c.uri),de("diff title index","{0} (Index)",Ur(c.uri)))}))),s=await Promise.all(i.working.map(async c=>({type:c.type,resourceUri:c.uri,decorations:{strikeThrough:c.type===rt.Deleted},command:await this.changeStore.resolveDiffCommand(c.uri,this.providerService.getProviderUri(c.uri),de("diff title working","{0} (Working Tree)",Ur(c.uri)))})));return this.ensureMergeConflictsGroup(n).resourceStates=o,this.ensureStagedChangesGroup(n).resourceStates=this.staging.enabled?a:[],this.ensureWorkingChangesGroup(n).resourceStates=this.staging.enabled?s:[...a,...s],n}async createOrUpdateScmProvider(e,r){const n=await this.providerService.getMetadata(e),i=this.providerService.isReadonly(e);let o;const a=n.HEAD.branch?n.HEAD.name:void 0;let s=this.getScmProvider(e);if(s===void 0){r=n.name,o=d.scm.createSourceControl(`remoteHub:${n.provider.id}`,r,e),o.quickDiffProvider={provideOriginalResource:l=>this.providerService.getProviderUri(l)};const c=this.providerService.createIGitRepository(e,o,n,this.changeStore);s={id:n.provider.id,name:n.provider.name,sourceControl:o,groups:[],repository:c,isReadonly:i},this.ensureMergeConflictsGroup(s),this.ensureStagedChangesGroup(s),this.ensureWorkingChangesGroup(s),this._scmProviders.push(s)}else o=s.sourceControl;return n.accessLevel>=$t.Write?(o.acceptInputCommand={command:"remoteHub.commit",title:de("scm input accept command title commit","Commit"),arguments:[o]},a?o.inputBox.placeholder=de("scm input placeholder commit","Message (Ctrl+Enter to commit directly to '{0}' on {1})",a,n.provider.name):o.inputBox.placeholder=de("scm input placeholder commit","Message (Ctrl+Enter to commit directly to {0})",n.provider.name),Ye.get("commitDirectlyWarning")===B.Off?o.inputBox.validateInput=void 0:o.inputBox.validateInput=c=>{if(Ye.get("commitDirectlyWarning")===B.Auto&&Yy(Io.HasCommitted))return;const l=new d.MarkdownString(a?de("scm input validation commit branch directly","Your changes will be committed directly to the '{0}' branch on {1}.",a,n.provider.name):de("scm input validation commit directly","Your changes will be committed directly to {0}.",n.provider.name));return l.isTrusted=!0,l.appendMarkdown(`&nbsp; [${de("scm input validation action","Don't show again")}](command:remoteHub.disableCommitDirectlyWarning '${de("scm input validation action tip","Hide")}')`),{message:l,type:d.SourceControlInputBoxValidationType.Information}}):i?(o.acceptInputCommand=void 0,o.inputBox.placeholder=de("scm input readonly placeholder","Committing is not available for readonly repositories.")):(o.acceptInputCommand={command:"remoteHub.createPullRequest",title:de("scm input accept command title pr","Create a Pull Request"),arguments:[o]},o.inputBox.placeholder=de("scm input placeholder pr","Message (Ctrl+Enter to create a pull request for '{0}'",r)),await this.updateStatusBarCommands(s,{syncing:!1},n),s}async updateStatusBarCommands(e,r,n){var i,o,a;const s=e.sourceControl.rootUri;n=n!=null?n:await this.providerService.getMetadata(s);const{HEAD:c}=n,l=await this.providerService.getIndexMetadata(s),u=(l==null?void 0:l.type)===xt.Active,h=(l==null?void 0:l.type)===xt.Active,f=xt.hasIndex(l==null?void 0:l.type),p=await this.changeStore.hasChanges(s),b=Vf(c.type),w=[];if(w.push(yn({command:"remoteHub.switchToBranch",title:`${b} ${c.name}${p?"*":""}`,tooltip:`${pr(c.sha)}`,arguments:[{uri:s,commands:!0}]})),c.detached||((r==null?void 0:r.syncing)?w.push(yn({command:"",title:"$(sync~spin)",tooltip:de("sync command syncing","Syncing Changes..."),arguments:[]})):w.push(yn({command:"remoteHub.sync",title:`$(sync)${((o=(i=n.state)==null?void 0:i.behind)!=null?o:0)>0?` ${(a=n.state)==null?void 0:a.behind}\u2193`:""}`,tooltip:u||h?de("sync index","Sync to latest indexed commit"):de("sync command","Sync (Pull & Push)"),arguments:[{uri:s}]}))),n.pullRequest&&w.push(yn({command:"remoteHub.openOnRemote",title:`$(git-pull-request) ${n.pullRequest.id}`,tooltip:de("scm statusbar command open pr",`Open Pull Request #{0} on {1}

{2}`,n.pullRequest.id,n.provider.name,n.pullRequest.title),arguments:[{provider:n.provider,repo:n.repo,pullRequest:{id:n.pullRequest.id}}]})),f){const y=this.providerService.getIndexProvider(s);y&&w.push(...await y.getStatusBarContributions(s))}e.sourceControl.statusBarCommands=w}ensureMergeConflictsGroup(e){const r="conflicts";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,de("scm group conflicts","Merge Conflicts")),n.hideWhenEmpty=!0,e.groups.push(n)),n}ensureStagedChangesGroup(e){const r="staged";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,de("scm group staged","Staged Changes")),n.hideWhenEmpty=!0,e.groups.push(n)),n}ensureWorkingChangesGroup(e){const r="changes";let n=e.groups.find(i=>i.id===r);return n===void 0&&(n=e.sourceControl.createResourceGroup(r,de("scm group changes","Changes")),e.groups.push(n)),n}getScmProvider(e){const r=we(e);return this._scmProviders.find(n=>we(n.sourceControl.rootUri)===r)}getSourceControlFrom(e){if(e===void 0){if(this._scmProviders.length!==1)return;e=this._scmProviders[0].sourceControl}let r;if(MI(e))r=e;else if(Hy(e)){const n=e,i=this._scmProviders.find(o=>o.groups.includes(n));r=i==null?void 0:i.sourceControl}else if(Gf(e)){const n=e,i=this._scmProviders.find(o=>o.groups.some(a=>a.resourceStates.includes(n)));r=i==null?void 0:i.sourceControl}else{if(this._scmProviders.length!==1)return;r=this._scmProviders[0].sourceControl}return r}}function MI(t){return"rootUri"in t&&"inputBox"in t}function Hy(t){return t!==void 0&&"id"in t&&"label"in t&&"resourceStates"in t&&Array.isArray(t.resourceStates)}function Gf(t){return t!==void 0&&"resourceUri"in t&&t.resourceUri instanceof d.Uri}function ic(t){return"type"in t}async function Kf(t){var e,r,n;if(t.length===0)return!0;let i,o=de("discard","Discard Changes");if(t.length===1){const s=t[0];s.type===rt.Created?(i=de("confirm delete",`Are you sure you want to DELETE {0}?
This is IRREVERSIBLE!
This file will be FOREVER LOST.`,Ur((e=s.resourceUri)!=null?e:s.uri)),o=de("delete file","Delete file")):s.type===rt.Deleted?(o=de("restore file","Restore file"),i=de("confirm restore","Are you sure you want to restore {0}?",Ur((r=s.resourceUri)!=null?r:s.uri))):i=de("confirm discard","Are you sure you want to discard changes in {0}?",Ur((n=s.resourceUri)!=null?n:s.uri))}else t.every(s=>s.type===rt.Created)?i=de("confirm delete multiple",`Are you sure you want to DELETE {0} files?
This is IRREVERSIBLE!
These files will be FOREVER LOST.`,t.length):t.every(s=>s.type===rt.Deleted)?(o=de("restore files","Restore files"),i=de("confirm restore multiple","Are you sure you want to restore {0} files?",t.length)):i=de("confirm discard multiple","Are you sure you want to discard changes in {0} files?",t.length);return await d.window.showWarningMessage(i,{modal:!0,useCustom:!0},o)===o}async function oc(t,e,r){if(t.length===0)return;if(t.length===1)return t[0].sourceControl.rootUri;const n=await d.window.showQuickPick(t.map(({sourceControl:i})=>({label:i.label,uri:i.rootUri})),{placeHolder:e,title:r});if(!!n)return n.uri}async function du(t,e,r,n,i,o,a,s){const c=new Set;let l;const u=d.window.createInputBox();u.ignoreFocusOut=!0;try{return await new Promise((h,f)=>{l=d.Disposable.from(u.onDidHide(()=>h(void 0)),u.onDidChangeValue(p=>{if(p=p.trim(),!p){u.validationMessage=de("scm create branch prompt validation missing name","Please enter a valid branch name");return}if(c.has(p)){u.validationMessage=de("scm create branch prompt validation already exists","Branch '{0}' already exists",p);return}if(!ES(p)){u.validationMessage=de("scm create branch prompt validation invalid name","'{0}' isn't a valid branch name",p);return}u.validationMessage=void 0}),u.onDidAccept(async()=>{const p=u.value;try{u.enabled=!1,u.busy=!0;const b=await t.createBranch(e,p,r,a);h(b)}catch(b){if(b instanceof La){u.enabled=!0,u.busy=!1,u.validationMessage=b.duplicate?de("scm create branch prompt validation already exists","Branch '{0}' already exists",p):de("scm create branch prompt validation invalid","Invalid branch name '{0}'",p),c.add(p);return}f(b)}})),u.prompt=n,u.placeholder=i,u.title=o,s&&(u.value=s),u.show()})}finally{u.dispose(),l==null||l.dispose()}}class Zf{constructor(e,r){this.memento=e,this.scope=r,this._onDidChange=new d.EventEmitter}get onDidChange(){return this._onDidChange.event}async get(e){const r=this.getScoped(e),n=new $e(`MementoStorage.get(${e}): scopedKey=${r}`,{logLevel:Rt.Debug});try{return await Promise.resolve(this.memento.get(r))}finally{n.stop()}}async getKeys(e){const r=this.getScoped(e),n=new $e(`MementoStorage.getKeys(${e}): scopedPrefix=${r}`,{logLevel:Rt.Debug});try{let i=this.getKeysCore(e);if(this.scope!==void 0){const o=this.scope.length+1;i=i.map(a=>a.substr(o))}return await Promise.resolve(i)}finally{n.stop()}}getKeysCore(e){let r=this.memento.keys();return e&&(r=r.filter(n=>n.startsWith(e))),r}async store(e,r){const n=this.getScoped(e),i=new $e(`MementoStorage.store(${e}): scopedKey=${n}`,{logLevel:Rt.Debug});try{return await this.storeCore(e,n,r)}finally{i.stop()}}async storeCore(e,r,n){await this.memento.update(r,n),this._onDidChange.fire({key:e})}async delete(e){const r=this.getScoped(e),n=new $e(`MementoStorage.delete(${e}): scopedKey=${r}`,{logLevel:Rt.Debug});try{return await this.storeCore(e,r,void 0)}finally{n.stop()}}async deleteKeys(e){const r=this.getScoped(e),n=new $e(`MementoStorage.deleteKeys(${e}): scopedPrefix=${r}`,{logLevel:Rt.Debug});try{const i=[],o=this.scope!==void 0?this.scope.length+1:0,a=this.getKeysCore(r);for(const s of a){const c=o!==0?s.substr(o):s;K.debug(`MementoStorage.deleteKeys(${e}): Deleting key=${c}, scopedKey=${s}`);try{await this.storeCore(c,s,void 0)}catch(l){K.debug(`MementoStorage.deleteKeys(${e}): Failed to delete key=${c}, scopedKey=${s}`),i.push(c)}}if(i.length)throw new Error(`Failed to delete keys: ${i.join(", ")}`)}finally{n.stop()}}with(e){return new Zf(this.memento,e)}getScoped(e){return`${this.scope!==void 0?`${this.scope}/`:""}${e!=null?e:""}`}}class Xf{constructor(e,r){this.storageUri=e,this.scope=r,this._onDidChange=new d.EventEmitter}get onDidChange(){return this._onDidChange.event}async get(e){const r=this.getScoped(e),n=new $e(`ExtFileStorageService.get(${e}): scopedKey=${r}`,{logLevel:Rt.Debug});try{return await d.workspace.fs.readFile(d.Uri.joinPath(this.storageUri,r))}catch(i){return}finally{n.stop()}}async store(e,r){const n=this.getScoped(e),i=new $e(`ExtFileStorageService.store(${e}): scopedKey=${n}`,{logLevel:Rt.Debug});try{return await this.storeCore(e,n,r)}finally{i.stop()}}async storeCore(e,r,n){await d.workspace.fs.writeFile(d.Uri.joinPath(this.storageUri,r),n),this._onDidChange.fire({key:e})}async delete(e){const r=this.getScoped(e),n=new $e(`ExtFileStorageService.delete(${e}): scopedKey=${r}`,{logLevel:Rt.Debug});try{return await d.workspace.fs.delete(d.Uri.joinPath(this.storageUri,r))}finally{n.stop()}}with(e){return new Xf(this.storageUri,e)}getScoped(e){return`${this.scope!==void 0?`${this.scope}/`:""}${e}`}}const Kt=(0,C.loadMessageBundle)();class vi extends d.TimelineItem{static is(e){return e instanceof vi}constructor(e,r,n,i,{dateType:o,showAuthor:a,dateFormatter:s}){var c;const l=n.message.indexOf(`
`),u=l!==-1?`${n.message.substring(0,l)} \u2026`:n.message,h=o==="authored"?n.authorDate:n.commitDate;super(u,(c=h==null?void 0:h.getTime())!=null?c:0);this.id=n.hash,this.contextValue=`vscode-vfs:${r}:file:commit`,this.command=i,a&&(this.description=n.authorName),this.detail=Kt("timeline item detail",`{0} ({1}) \u2014 {2}
{3}

{4}`,n.authorName,n.authorEmail,pr(n.hash),s.format(h),n.message),this.iconPath=new d.ThemeIcon("git-commit"),this.rootUri=e,this.providerId=r,this.hash=n.hash,this.parents=n.parents,this.message=n.message}}class Aa extends d.TimelineItem{static is(e){return e instanceof Aa}constructor(e,r,n,i,o,{dateFormatter:a,staged:s}){const c=s?Kt("timeline staged changes","Staged Changes"):Kt("timeline uncommitted changes","Uncommitted Changes");super(c,n.timestamp);this.id=s?"index":"working",this.contextValue=`vscode-vfs:${r}:file:${this.id}`,this.command=o,this.iconPath=new d.ThemeIcon("git-commit"),s?this.detail=Kt("timeline index detail",`{0}  \u2014 {1}
{2}

{3}`,Kt("timeline you","You"),Kt("timeline index","Index"),a.format(new Date(n.timestamp)),ag(n.type)):this.detail=Kt("timeline working detail",`{0}  \u2014 {1}
{2}

{3}`,Kt("timeline you","You"),Kt("timeline working","Working Tree"),a.format(new Date(n.timestamp)),ag(n.type)),this.rootUri=e,this.providerId=r,this.hash=s?"~":"",this.parents=i,this.message=c}}class BI{constructor(e,r){this.providerService=e,this.changeStore=r,this._onDidChange=new d.EventEmitter,this.id="github-file-history",this.label=Kt("timeline.source","GitHub File History"),this.debouncer=new Fh(500),this.disposable=d.Disposable.from(this.debouncer,e.onDidChangeProviders(this.onProvidersChanged,this),e.onDidChangeRepositories(this.onRepositoriesChanged,this),e.onDidChangeRepository(this.onRepositoryChanged,this),e.onDidRefresh(this.onRefresh,this),r.onDidChange(this.onUrisChanged,this),Ye.onDidChangeAny(this.onConfigurationChanged,this),...this.registerCommands()),e.hasProviders&&this.ensureProviderRegistration()}get onDidChange(){return this._onDidChange.event}dispose(){var e;(e=this.providerDisposable)==null||e.dispose(),this.disposable.dispose()}onConfigurationChanged(e){(e.affectsConfiguration("git.timeline.date")||e.affectsConfiguration("git.timeline.showAuthor"))&&this.fireChanged()}onProvidersChanged(e){this.ensureProviderRegistration(),this.fireChanged()}onRefresh(e){if(this.rootUri===void 0)return;const r=we(this.rootUri);!e.some(n=>we(n)===r)||this.fireChanged()}onRepositoriesChanged(e){if(this.rootUri===void 0)return;const r=we(this.rootUri);(e.added.some(n=>we(n.uri)===r)||e.removed.some(n=>we(n.uri)===r))&&this.fireChanged()}onRepositoryChanged(e){this.rootUri===void 0||we(this.rootUri)!==we(e.repository.uri)||this.fireChanged()}onUrisChanged(e){if(this.rootUri===void 0)return;const r=we(this.rootUri);e.some(n=>we(n.rootUri)===r)&&this.fireChanged()}async provideTimeline(e,r,n){var i;try{this.rootUri=this.providerService.getVirtualRootUri(e);for(const b of this.providerService.repositories)if(b.uri.path===this.rootUri.path){this.rootUri=b.uri;break}const o=this.providerService.getRelativeFilePath(this.rootUri,e),a=await this.providerService.getMetadata(this.rootUri);if(!a||n.isCancellationRequested)return{items:[]};const s=await this.providerService.getCommits(this.rootUri,{ref:a.HEAD.sha,path:o||void 0,cursor:r.cursor,limit:typeof r.limit=="number"?r.limit:void 0});if(s===void 0||s.commits.length===0||n.isCancellationRequested)return{items:[]};const c=((i=s.paging)==null?void 0:i.more)?{cursor:s.paging.cursor}:void 0,l=new Intl.DateTimeFormat(d.env.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}),u=Ye.getAny("git.timeline.date",void 0,"committed"),h=Ye.getAny("git.timeline.showAuthor",void 0,!0),f=s.commits.map(b=>new vi(this.rootUri,a.provider.id,b,this.resolveDiffCommand(b,a,e,o),{dateType:u,showAuthor:h,dateFormatter:l})),p=r.cursor===void 0?await this.changeStore.getChange(e):void 0;if(p){const b=Boolean(p.staged&&Ye.get("staging.enabled")),w=new Aa(this.rootUri,a.provider.id,p,[s.commits[0].hash],await this.changeStore.resolveDiffCommand(p.uri,this.providerService.getProviderUri(p.uri),b?Kt("diff title index","{0} (Index)",Ur(p.uri)):Kt("diff title working","{0} (Working Tree)",Ur(p.uri))),{dateFormatter:l,staged:b});f.splice(0,0,w)}return{items:f,paging:c}}catch(o){return K.error(o),{items:[]}}}ensureProviderRegistration(){this.providerDisposable===void 0&&(this.providerDisposable=d.workspace.registerTimelineProvider([Pt.scheme,...this.providerService.registeredProviders.map(e=>e.id)],this))}fireChanged(){this.debouncer.debounce(()=>this._onDidChange.fire(void 0))}registerCommands(){let e;return[d.commands.registerCommand("remoteHub.timeline.copyCommitId",(r,n,i)=>{!vi.is(r)||d.env.clipboard.writeText(r.hash)}),d.commands.registerCommand("remoteHub.timeline.copyCommitMessage",(r,n,i)=>{!vi.is(r)||d.env.clipboard.writeText(r.message)}),d.commands.registerCommand("remoteHub.timeline.openDiff",async(r,n,i)=>{var o;!vi.is(r)&&!Aa.is(r)||r.command!==void 0&&await d.commands.executeCommand(r.command.command,...(o=r.command.arguments)!=null?o:[])}),d.commands.registerCommand("remoteHub.timeline.openOnGitHub",async r=>{await this.openOnRemote(r)}),d.commands.registerCommand("remoteHub.timeline.openOnAzureRepos",async r=>{await this.openOnRemote(r)}),d.commands.registerCommand("remoteHub.timeline.selectForCompare",async(r,n,i)=>{!n||!vi.is(r)&&!Aa.is(r)||(e={uri:n,left:r},await d.commands.executeCommand("setContext","remoteHub.timeline.selectedForCompare",!0))}),d.commands.registerCommand("remoteHub.timeline.compareWithSelected",async(r,n,i)=>{if(!n||!e||!vi.is(r)&&!Aa.is(r)||we(n)!==we(e.uri))return;const{left:o}=e,a=this.providerService.getRelativeFilePath(r.rootUri,n),s=await this.providerService.getMetadata(r.rootUri),c=Ur(n),l=o.parents[0];let u;l===void 0?u=Kt("timeline diff title ref","{0} ({1})",c,pr(r.hash)):o.hash===""?u=Kt("timeline diff title working","{0} (Working Tree)",c):o.hash==="~"?u=Kt("timeline diff title index","{0} (Index)",c):u=Kt("timeline diff title ref","{0} ({1})",c,pr(o.hash));let h=o.hash===""||o.hash==="~"?n:this.providerService.createProviderUri(n,{repo:s.repo,ref:{type:Ue.Commit,id:l!=null?l:"0000000000000000000000000000000000000000"}},a);l===void 0&&(h=h.with({query:"~"}));const f=r.parents[0];let p;f===void 0?p=Kt("timeline diff title ref","{0} ({1})",c,pr(r.hash)):f==="~"&&r.hash===""?p=Kt("timeline diff title working","{0} (Working Tree)",c):r.hash==="~"?p=Kt("timeline diff title index","{0} (Index)",c):p=Kt("timeline diff title ref","{0} ({1})",c,pr(r.hash));const b=Kt("timeline diff title","{0} \u27F7 {1}",u,p),w=r.hash===""||r.hash==="~"?n:this.providerService.createProviderUri(n,{repo:s.repo,ref:{type:Ue.Commit,id:r.hash}},a);await d.commands.executeCommand("vscode.diff",h,w,b)})]}resolveDiffCommand(e,r,n,i,o){const a=Ur(n),s=e.parents[0];let c;s===void 0?c=Kt("timeline diff title ref","{0} ({1})",a,pr(e.hash)):e.hash===""?c=Kt("timeline diff title working","{0} (Working Tree)",a):e.hash==="~"?c=Kt("timeline diff title index","{0} (Index)",a):c=Kt("timeline diff title refs","{0} ({1}) \u27F7  {0} ({2})",a,pr(s),pr(e.hash));let l=this.providerService.createProviderUri(n,{repo:r.repo,ref:{type:Ue.Commit,id:s!=null?s:"0000000000000000000000000000000000000000"}},i);s===void 0&&(l=l.with({query:"~"}));const u=e.hash===""||e.hash==="~"?n:this.providerService.createProviderUri(n,{repo:r.repo,ref:{type:Ue.Commit,id:e.hash}},i);return{command:"vscode.diff",title:"Open Comparison",arguments:[l,u,c,o]}}async openOnRemote(e){if(!vi.is(e))return;const r=await this.providerService.getMetadata(e.rootUri);await Mh("remoteHub.openOnRemote",{provider:r.provider,repo:r.repo,sha:e.hash})}}class OI{constructor(e,r){this.providerService=e,this.telemetryService=r,this.disposable=d.window.registerUriHandler(this)}dispose(){this.disposable.dispose()}async handleUri(e){var r;const n=new $e(`RemoteUriHandler.handleUri(${e.path}, ${e.toString()})`);try{switch(e.path){case"/open":{this.telemetryService.sendEvent("handleUri.open");let i,o;for(const s of e.query.split("&")){const[c,l]=s.split("=");switch(c){case"url":i=decodeURIComponent(l);break;case"location":o=l===At.CurrentWindow?At.CurrentWindow:At.NewWindow;break}}if(!i){n.log({message:": Unable to find url parameter"}),this.telemetryService.sendEvent("handleUri.open.abort",{reason:"aborted url not found"});return}i=i.trim(),o=o!=null?o:At.NewWindow;const a=await this.providerService.createWorkspaceForRemoteUrl(i,void 0,o);if(!a){n.log({message:`: Unable to open workspace for ${i}`}),this.telemetryService.sendEvent("handleUri.open.abort",{reason:"aborted invalid url"});return}n.log({message:`: Opening ${i} in ${o}`}),nn(a);break}case"/open-files":{let i;for(const a of e.query.split("&")){const[s,c]=a.split("=");if(s==="url"){i=decodeURIComponent(c);break}}if(!i){n.log({message:": Unable to find url parameter"});return}i=i.trim();const o=await this.providerService.createWorkspaceForRemoteUrl(i);if(!o){n.log({message:`: Unable to open files/folders for ${i}`});return}o.filesToOpen?(n.log({message:`: Opening files/folders for ${i}`}),await((r=pu())==null?void 0:r.openPendingFiles(o.uri,o.filesToOpen))):n.log({message:`: No files/folders found to open for ${i}`});break}case"/login":{Jv.fire(e);break}default:{n.log({message:`: Unknown Uri ${e.toString()}`});break}}}finally{n.stop()}}}const Wr=(0,C.loadMessageBundle)(),ac=class{constructor(t,e,r,n){this.providerService=t,this.storageService=e,this.changeStore=r,this.workspaceId=n,this._onDidChange=new d.EventEmitter,this.cache=new Map,this.lock=new Ac("WorkspaceRepositories"),this.disposable=d.Disposable.from(this.providerService.onDidChangeRepositories(this.onRepositoriesChanged,this),this.providerService.onDidChangeRepository(this.onRepositoryChanged,this),this.changeStore.onDidChange(this.onChangeStoreChanged,this))}get onDidChange(){return this._onDidChange.event}dispose(){this.disposable.dispose()}async exportDebugInfo(){const t=await d.workspace.openTextDocument({language:"json",content:`Remote Repositories

${this.toStorage(await this.getCore())}`});return void d.window.showTextDocument(t)}onChangeStoreChanged(t){const e=Of(t.map(r=>r.rootUri),r=>we(r)).map(r=>this.providerService.getRepository(r)).filter(r=>Boolean(r));this.addOrUpdate(e)}onRepositoriesChanged(t){this.addOrUpdate(t.added)}onRepositoryChanged(t){this.addOrUpdate([t.repository])}async get(t){let e=await this.lock.synchronizeRead(async()=>{let r=this.cache.get("workspaceRepositories");return r===void 0&&(r=[...(await this.getCore()).values()].sort((n,i)=>i.timestamp-n.timestamp),this.cache.set("workspaceRepositories",r)),r},"WorkspaceRepositories.get");if(t){const r=we(t);e=e.filter(n=>we(n.canonicalUri)===r)}return e}async getCore(){return this.fromStorage(await this.storageService.get(ac.storageKey))}async getByCanonicalUri(){let t=this.cache.get("groupedWorkspaceRepositories");return t===void 0&&(t=gI(await this.get(),e=>we(e.canonicalUri)),this.cache.set("groupedWorkspaceRepositories",t)),t}async getRecents(t=10){return(await this.get()).slice(0,t)}async getRemoteWorkspaceSourceProvider(){const t=await this.getRecents();if(t.length!==0)return{name:"Recents",label:"Open Recent Repository",icon:"$(history)",placeholder:Wr("pick","Choose a recent repository"),provideSources:function(e,r){return t.map(n=>({providerId:n.provider.id,name:n.name,icon:"$(repo)",description:Ts(n.timestamp,{ago:!0}),detail:`${n.provider.name}${n.pullRequest?`\xA0\xA0\u2022\xA0\xA0$(git-pull-request) Pull Request #${n.pullRequest.id}`:""}${Pt.isCanonicalUri(n.uri)?"":`\xA0\xA0\u2022\xA0\xA0${Vf(n.ref.type)} ${n.ref.name}`}\xA0\xA0\u2022\xA0\xA0${Wy(n.changes)}${n.idx?`\xA0\xA0\u2022\xA0\xA0${PI(n.idx.type)}`:""}`,workspace:{uri:n.uri,name:n.name,location:At.CurrentWindow}}))}}}refresh(){this.cache.clear()}async remove(t){await this.lock.synchronizeWrite(async()=>{const e=await this.getCore(),r=`${t.workspaceId}/${we(t.uri)}`,n=e.get(r);if(n===void 0)return;const i=this.changeStore.getScopedChangeStore(n),o=await i.getChanges(n.uri);if(o.length!==0){const a={title:Wr("remove remote repo prompt confirm","Yes")},s={title:Wr("remove remote repo prompt cancel","No"),isCloseAffordance:!0};if(await d.window.showWarningMessage(o.length===1?Wr("remove remote repo prompt file changed",`This repository contains 1 file with uncommitted changes.

Removing it will cause those changes to be FOREVER LOST.
This is IRREVERSIBLE!

Are you sure you still want to remove it?`):Wr("remove remote repo prompt files changes",`This repository contains {0} files with uncommitted changes.

Removing it will cause those changes to be FOREVER LOST.
This is IRREVERSIBLE!

Are you sure you still want to remove it?`,o.length),{modal:!0,useCustom:!0},a,s)!==a)return;await i.discardAll(n.uri)}this.cache.clear(),e.delete(r);try{await this.storageService.store(ac.storageKey,this.toStorage(e))}catch(a){throw K.error(a,"Failed to save workspace repositories"),a}},"WorkspaceRepositories.remove"),this._onDidChange.fire()}async addOrUpdate(t){await this.lock.synchronizeWrite(async()=>{this.cache.clear();const e=await this.getCore();for(const r of t){const[{HEAD:n,pullRequest:i},o]=await Promise.all([r.getMetadata(),r.getIndexMetadata()]),a=await this.changeStore.getChanges(r.uri);e.set(`${this.workspaceId}/${we(r.uri)}`,{workspaceId:this.workspaceId,uri:r.uri,canonicalUri:r.canonicalUri,name:r.name,provider:r.provider,ref:{type:n.type,name:n.name},idx:(o==null?void 0:o.type)&&xt.hasIndex(o.type)?{type:o.type}:void 0,pullRequest:i?{id:i.id}:void 0,changes:LI(a),timestamp:Date.now()})}try{await this.storageService.store(ac.storageKey,this.toStorage(e)),ui(Nn.HasRecentRepositories,e.size>0)}catch(r){throw K.error(r,"Failed to save workspace repositories"),r}},"WorkspaceRepositories.addOrUpdate"),this._onDidChange.fire()}fromStorage(t){if(!t)return new Map;try{const e=JSON.parse(t,(r,n)=>(r==="uri"||r.endsWith("Uri"))&&gc(n)?d.Uri.from(n):n);return new Map(e.workspaceRepositories)}catch(e){return K.error(e,"Failed to deserialize workspace repositories"),new Map}}toStorage(t){const e={schemaVersion:ac.storageSchemaVersion,workspaceRepositories:[...t]};return JSON.stringify(e)}};let Qf=ac;Qf.storageKey="workspaceRepositories",Qf.storageSchemaVersion=1;function qy(t){return t!==void 0&&(t.added!==0||t.changed!==0||t.deleted!==0)}function UI(t){return qy(t.changes)}function LI(t){let e=0,r=0,n=0;for(const i of t)switch(i.type){case rt.Created:e++;break;case rt.Changed:r++;break;case rt.Deleted:n++;break}return e||r||n?{added:e,changed:r,deleted:n,timestamp:Date.now()}:void 0}function Wy(t,{compact:e=!0,preamble:r,separator:n=", ",short:i=!1,single:o=!1}={}){if(!qy(t))return Wr("no changes","Everything up to date");const{added:a,changed:s,deleted:c}=t;if(o){const u=a+s+c;return u===1?Wr("summary change","{0} change",u):Wr("changes changes","{0} changes",u)}let l=`${r!=null?r:""}`;return(a||!e)&&(l+=i?`+${a}`:a===1?Wr("file added","{0} file added",a):Wr("files added","{0} files added",a),(s||c||!e)&&(l+=n)),(s||!e)&&(l+=i?`~${s}`:s===1?Wr("file changed","{0} file changed",s):Wr("files changed","{0} files changed",s),(c||!e)&&(l+=n)),(c||!e)&&(l+=i?`-${c}`:c===1?Wr("file deleted","{0} file deleted",c):Wr("files deleted","{0} files deleted",c)),l}var HI=Object.defineProperty,qI=Object.getOwnPropertyDescriptor,WI=(t,e,r,n)=>{for(var i=n>1?void 0:n?qI(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&HI(e,r,i),i},ka;(function(t){t.Change="remoteHub:viewItem:change",t.WorkspaceRepository="remoteHub:viewItem:workspaceRepository",t.WorkspaceRepositories="remoteHub:viewItem:workspaceRepositories",t.Message="remoteHub:viewItem:message"})(ka||(ka={}));const zy=class{constructor(t,e){this.view=t,this.parent=e,this.splatted=!1}static is(t){return t instanceof zy}get id(){}toString(){return`${K.toLoggableName(this)}${this.id!==void 0?`(${this.id})`:""}`}getParent(){var t,e;return((t=this.parent)==null?void 0:t.splatted)?(e=this.parent)==null?void 0:e.getParent():this.parent}triggerChange(t=!1,e=!1,r){return this.splatted&&this.parent!==void 0&&this.parent!==r?this.parent.triggerChange(t,e):this.view.refreshNode(this,t,e)}};let Ia=zy;WI([yr((t=!1,e=!1,r)=>JSON.stringify([t,e,r==null?void 0:r.toString()]))],Ia.prototype,"triggerChange",1);class zI{constructor(e,r,n,i){this.id=e,this.name=r,this.providerService=n,this.telemetryService=i,this._onDidChangeTreeData=new d.EventEmitter,this.disposables=[];const o=!1;if(K.isDebugging&&o){const a=this.getTreeItem;this.getTreeItem=async function(s){var c;const l=await a.apply(this,[s]),u=s.getParent();return l.tooltip===void 0&&(l.tooltip=new d.MarkdownString(l.label!==void 0&&typeof l.label!="string"?l.label.label:(c=l.label)!=null?c:"")),typeof l.tooltip=="string"?l.tooltip=`${l.tooltip}

---
context: ${l.contextValue}
node: ${s.toString()}${u!==void 0?`
parent: ${u.toString()}`:""}`:l.tooltip.appendMarkdown(`

---

context: \`${l.contextValue}\`\\
node: \`${s.toString()}\`${u!==void 0?`\\
parent: \`${u.toString()}\``:""}`),l}}this.disposables.push(...this.registerCommands()),this.initialize({showCollapseAll:this.showCollapseAll}),setTimeout(()=>this.onConfigurationChanged(),0)}get onDidChangeTreeData(){return this._onDidChangeTreeData.event}get showCollapseAll(){return!0}filterConfigurationChanged(e){return!!Ye.changed(e,`views.${this.configKey}`)}dispose(){d.Disposable.from(...this.disposables).dispose()}get title(){return this._title}set title(e){this._title=e,this.tree!==void 0&&(this.tree.title=e)}get description(){return this._description}set description(e){this._description=e,this.tree!==void 0&&(this.tree.description=e)}get message(){return this._message}set message(e){this._message=e,this.tree!==void 0&&(this.tree.message=e)}getQualifiedCommand(e){return`${this.id}.${e}`}onConfigurationChanged(e){e!==void 0&&this.root!==void 0&&this.refresh(!0)}initialize(e={}){this.tree=d.window.createTreeView(this.id,{...e,treeDataProvider:this}),this.disposables.push(Ye.onDidChange(r=>{!this.filterConfigurationChanged(r)||(this._config=void 0,this.onConfigurationChanged(r))},this),this.tree),this._title=this.tree.title}ensureRoot(e=!1){return(this.root===void 0||e)&&(this.telemetryService.sendEvent("view.open",{view:this.id}),this.root=this.getRoot()),this.root}getChildren(e){return e!==void 0?e.getChildren():this.ensureRoot().getChildren()}getParent(e){return e.getParent()}getTreeItem(e){return e.getTreeItem()}get selection(){return this.tree===void 0||this.root===void 0?[]:this.tree.selection}get visible(){return this.tree!==void 0?this.tree.visible:!1}async refresh(e=!1){var r,n;await((n=(r=this.root)==null?void 0:r.refresh)==null?void 0:n.call(r,e)),this.triggerNodeChange()}async refreshNode(e,r=!1,n=!1){var i;const o=await((i=e.refresh)==null?void 0:i.call(e,r));!n&&o===!0||this.triggerNodeChange(e)}async reveal(e,r){if(this.tree!==void 0)try{await this.tree.reveal(e,r)}catch(n){K.error(n)}}async show(){try{await d.commands.executeCommand(`${this.id}.focus`)}catch(e){K.error(e)}}triggerNodeChange(e){this._onDidChangeTreeData.fire(e!==void 0&&e!==this.root?e:void 0)}get config(){return this._config===void 0&&(this._config=Ye.get("views")[this.configKey]),this._config}}class jI extends Ia{constructor(e,r,n,i,o,a,s){super(e,r);this._message=n,this._description=i,this._tooltip=o,this._iconPath=a,this._contextValue=s}getChildren(){return[]}getTreeItem(){var e;const r=new d.TreeItem(this._message,d.TreeItemCollapsibleState.None);return r.contextValue=(e=this._contextValue)!=null?e:ka.Message,r.description=this._description,r.tooltip=this._tooltip,r.iconPath=this._iconPath,r}}var VI=Object.defineProperty,GI=Object.getOwnPropertyDescriptor,Yf=(t,e,r,n)=>{for(var i=n>1?void 0:n?GI(e,r):e,o=t.length-1,a;o>=0;o--)(a=t[o])&&(i=(n?a(e,r,i):a(i))||i);return n&&i&&VI(e,r,i),i};const fr=(0,C.loadMessageBundle)(),jy=class extends Ia{constructor(t,e,r,n,i,o,a){super(t,e);this.changeStore=r,this.canonical=n,this.workspaceRepository=i,this.operation=o,this.canApplyChanges=a}static getId(t,e,r){return`${sc.getId(t,e)}:${this.key}(${r.uri.toString()})`}get id(){return jy.getId(this.canonical.uri,this.workspaceRepository,this.operation)}getChildren(){return[]}async getTreeItem(){const t=this.view.providerService.getRelativeFilePath(this.workspaceRepository.uri,this.operation.uri),e=new d.TreeItem(t,d.TreeItemCollapsibleState.None);return e.id=this.id,e.contextValue=`${ka.Change}${this.canApplyChanges?"+apply":""}`,e.resourceUri=this.view.changeStore.getScopedUri(this.operation.uri,this.workspaceRepository),e.command=await this.getDiffCommand(t,!0),e}async getDiffCommand(t,e=!1){if(e||this._command===void 0){const r=Boolean(this.operation.staged&&Ye.get("staging.enabled"));if(this.workspaceRepository.workspaceId===this.view.workspaceId){const n=this.view.providerService.getProviderUri(this.operation.uri);this._command=await this.changeStore.resolveDiffCommand(this.operation.uri,n,r?fr("diff title index","{0} (Index)",Ur(this.operation.uri),this.workspaceRepository.ref.name):fr("diff title working","{0} (Working Tree)",Ur(this.operation.uri),this.workspaceRepository.ref.name))}else{const{repo:n}=this.view.providerService.getVirtualUriMetadata(this.workspaceRepository.uri),i=this.view.providerService.createProviderUri(this.operation.uri,{repo:n,ref:{type:Ue.Commit,id:this.operation.revision}},t);this._command=await this.changeStore.resolveDiffCommand(this.operation.uri,i,r?fr("diff title changeset index","{0} (Index of {1})",Ur(this.operation.uri),this.workspaceRepository.ref.name):fr("diff title changeset working","{0} (Working Tree of {1})",Ur(this.operation.uri),this.workspaceRepository.ref.name))}}return this._command}async openChanges(){var t;const e=await this.getDiffCommand(this.view.providerService.getRelativeFilePath(this.workspaceRepository.uri,this.operation.uri));await d.commands.executeCommand(e.command,...(t=e.arguments)!=null?t:[])}async openFile(){const t=this.view.changeStore.getScopedUri(this.operation.uri,this.workspaceRepository.workspaceId);await d.window.showTextDocument(t)}async applyChanges(){const t=await this.view.getRepositoryToApplyChangesetTo(this.workspaceRepository);if(t!==void 0)try{await this.view.changeStore.applyChangeset(t.uri,this.workspaceRepository,this.operation)}catch(e){d.window.showErrorMessage(String(e))}}};let Vy=jy;Vy.key=":changes";const Gy=class extends Ia{constructor(t,e,r,n,i){super(t,e);this.canonical=r,this.workspaceRepository=n,this.root=i}static getId(t,e){return`${hu.getId(t)}:${this.key}(${e.workspaceId}/${e.uri.toString()})`}get id(){return Gy.getId(this.canonical.uri,this.workspaceRepository)}get name(){return this.workspaceRepository.name}get uri(){return this.workspaceRepository.uri}canApplyChanges(){if(!this.canonical.hasActive||d.workspace.getWorkspaceFolder(this.workspaceRepository.uri)!==void 0)return!1;const{changes:e}=this.workspaceRepository;return e!==void 0&&(e.added!==0||e.changed!==0||e.deleted!==0)}async getChildren(){if(this._children===void 0){const t=this.view.changeStore.getScopedChangeStore(this.workspaceRepository),e=await t.getChanges(this.workspaceRepository.uri);this._children=e.map(r=>new Vy(this.view,this,t,this.canonical,this.workspaceRepository,r,this.canApplyChanges()))}return this._children}getTreeItem(){const t=this.workspaceRepository.workspaceId===this.view.workspaceId,e=UI(this.workspaceRepository),r=Pt.isCanonicalUri(this.workspaceRepository.uri)?fr("repositories view repository default ref","{0} (default)",this.workspaceRepository.ref.name):this.workspaceRepository.ref.name,n=new d.TreeItem(this.root?this.canonical.name:r,e?d.TreeItemCollapsibleState.Collapsed:d.TreeItemCollapsibleState.None);return n.id=this.id,n.contextValue=`${ka.WorkspaceRepository}${t?"+active":""}${this.canApplyChanges()?"+apply":""}`,n.description=`${this.root?`${this.workspaceRepository.ref.name}\xA0\xA0\u2022\xA0\xA0`:""}${Ts(this.workspaceRepository.timestamp,{ago:!0})}`,n.iconPath=t?new d.ThemeIcon("check"):this.root?Xy(this.canonical.provider.id):FI(this.workspaceRepository.ref.type,this.workspaceRepository.pullRequest),n.tooltip=new d.MarkdownString(void 0,!0).appendMarkdown(fr("repositories view repository tooltip",`{0}{1}\\
{2} {3} {4}{5}\\
Last accessed {6}

{7}
`,this.canonical.name,this.workspaceRepository.pullRequest?fr("pull request",`\\
Pull request {0} #{1}`,"$(git-pull-request)",this.workspaceRepository.pullRequest.id):"",ZI(this.workspaceRepository.ref.type),Vf(this.workspaceRepository.ref.type),r,t?` \u2014 _${fr("repositories view repository tooltip active","Active")}_ `:"",Ts(this.workspaceRepository.timestamp,{ago:!0}),Wy(this.workspaceRepository.changes,{preamble:`${fr("repositories view has changes","Has Uncommitted Changes")}\\
`}))),e&&(n.resourceUri=d.Uri.parse("remotehub-view://wsrepo/changes")),n}refresh(t=!1){t&&(this._children=void 0)}async applyAllChanges(){const t=await this.view.getRepositoryToApplyChangesetTo(this.workspaceRepository);if(t!==void 0)try{await this.view.changeStore.applyChangeset(t.uri,this.workspaceRepository)}catch(e){d.window.showErrorMessage(String(e))}}remove(){return this.view.workspaceRepositories.remove(this.workspaceRepository)}};let sc=Gy;sc.key=":wsrepo",Yf([yr()],sc.prototype,"refresh",1);const Ky=class extends Ia{constructor(t,e,r,n){super(t,e);this.canonical=r,this.workspaceRepositories=n}static getId(t){return`remoteHub${this.key}(${t.toString()})`}get id(){return Ky.getId(this.canonical.uri)}get name(){return this.canonical.name}get uri(){return this.canonical.uri}getChildren(){if(this.children===void 0){const t=this.workspaceRepositories;if(t.length===0)return this.view.message=void 0,[new jI(this.view,this,fr("repositories view message empty","No GitHub repositories could be found."))];this.view.message=void 0,this.children=t.map(e=>new sc(this.view,this,this.canonical,e,!1))}return this.children}getTreeItem(){const t=this.workspaceRepositories.some(r=>r.workspaceId===this.view.workspaceId),e=new d.TreeItem(this.canonical.name,t?d.TreeItemCollapsibleState.Expanded:d.TreeItemCollapsibleState.Collapsed);return e.contextValue=ka.WorkspaceRepositories,e.iconPath=Xy(this.canonical.provider.id),e}refresh(t=!1){t&&(this.children=void 0)}};let hu=Ky;hu.key=":wsrepos",Yf([yr()],hu.prototype,"refresh",1);class Zy extends Ia{constructor(e){super(e);this.splatted=!0}async getChildren(){if(this.children===void 0){const e=await this.view.workspaceRepositories.getByCanonicalUri();if(e.size===0)return[];this.view.message=void 0;const r=[];for(const[n,i]of e){const o=d.Uri.parse(n);try{const{name:a,provider:s}=this.view.providerService.getVirtualUriMetadata(o),c={uri:o,name:a,provider:s,hasActive:i.some(l=>l.workspaceId===this.view.workspaceId)};i.length===1?r.push(new sc(this.view,this,c,i[0],!0)):r.push(new hu(this.view,this,c,i))}catch(a){if(a instanceof yi)continue;K.error(a)}}this.children=r}return this.children}getTreeItem(){return new d.TreeItem("Repositories",d.TreeItemCollapsibleState.Expanded)}refresh(e=!1){e&&(this.children=void 0)}}Yf([yr()],Zy.prototype,"refresh",1);class KI extends zI{constructor(e,r,n,i,o){super("remoteHub.views.workspaceRepositories",fr("remote view title","GitHub Repositories"),e,o);this.workspaceRepositories=r,this.changeStore=n,this.workspaceId=i,this.configKey="workspaceRepositories",this.disposables.push(this.workspaceRepositories.onDidChange(this.onRepositoriesChanged,this),d.window.registerFileDecorationProvider({provideFileDecoration:(a,s)=>{if(!(a.scheme!=="remotehub-view"||a.authority!=="wsrepo"||!a.path.includes("/changes")))return{badge:"\u25CF",color:new d.ThemeColor("remoteHub.decorations.workspaceRepositoriesView.hasUncommittedChangesForegroundColor"),tooltip:fr("repositories view decoration has changes","Has Uncommitted Changes")}}}))}getRoot(){return new Zy(this)}onRepositoriesChanged(){this.refresh(!0)}registerCommands(){return[d.commands.registerCommand(this.getQualifiedCommand("refresh"),()=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.refresh"),this.workspaceRepositories.refresh(),void this.refresh(!0)),this),d.commands.registerCommand(this.getQualifiedCommand("open"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.open"),nn({name:e.name,uri:e.uri,location:At.CurrentWindow})),this),d.commands.registerCommand(this.getQualifiedCommand("openInNewWindow"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openInNewWindow"),nn({name:e.name,uri:e.uri,location:At.NewWindow})),this),d.commands.registerCommand(this.getQualifiedCommand("applyAllChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.applyAllChanges"),e.applyAllChanges()),this),d.commands.registerCommand(this.getQualifiedCommand("remove"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.remove"),e.remove()),this),d.commands.registerCommand(this.getQualifiedCommand("openChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openChanges"),e.openChanges()),this),d.commands.registerCommand(this.getQualifiedCommand("openFile"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.openFile"),e.openFile()),this),d.commands.registerCommand(this.getQualifiedCommand("applyChanges"),e=>(this.telemetryService.sendEvent("command.views.workspaceRepositories.applyChanges"),e.applyChanges()),this)]}async getRepositoryToApplyChangesetTo(e){const r=we(this.providerService.getVirtualCanonicalRootUri(e.uri)),n=this.providerService.repositories.filter(o=>we(o.canonicalUri)===r);return await XI(n,fr("apply changeset pick repository placeholder","Choose a repository to apply the changeset to"))}}function ZI(t,e){switch(t){case Le.Branch:return e?fr("type pr branch","Pull Request #{0}",e.id):fr("type branch","Branch");case Le.RemoteBranch:return e?fr("type pr remote branch","Pull Request #{0}",e.id):fr("type remote branch","Remote Branch");case Le.Tag:return fr("type tag","Tag");case Le.Commit:return fr("type commit","Commit")}}function Xy(t){switch(t){case wr.GitHub:return new d.ThemeIcon("github");case wr.AzureRepos:return new d.ThemeIcon("azure");default:return new d.ThemeIcon("vm")}}async function XI(t,e){if(t.length!==0){if(t.length>1){const r=await d.window.showQuickPick(t.map(n=>({label:n.name,description:n.provider.name,repository:n})),{placeHolder:e});return r?r.repository:void 0}return t[0]}}const Qy=(0,C.loadMessageBundle)();let fu;function pu(){return fu}var Io;(function(t){t.HasCommitted="has:committed",t.Version="version"})(Io||(Io={}));let Jf;function Yy(t){return Jf.globalState.get(t)}async function ep(t,e){return Jf.globalState.update(t,e)}let Jy=!1;function eb(){return Jy}async function QI(t){Jf=t,Dp.configure(t),K.configure(t,Ye.get("logLevel")),$e.start("Time to root directory",{log:!1});const e=t.extension.packageJSON.displayName;if(t.extension.id==="GitHub.remotehub-insiders"){Jy=!0;const o=d.extensions.getExtension("GitHub.remotehub");if(o!==void 0){const a=o.packageJSON.displayName;K.warn(`${e} was NOT activated because ${a} is also enabled`),setTimeout(()=>void d.window.showErrorMessage(Qy("more than one version enabled warning","{0} cannot be used while {1} is also enabled. Please ensure that only one version is enabled.",e,a),Qy("ok","OK")),0);return}}const r=Dh.configure(t),n=new _s(t),i=t.extension.packageJSON.version;await ep(Io.Version,i),await t.workspaceState.update(Io.Version,i);try{const o=new Zf(t.globalState),a=o.with(r),s=new Xf(t.globalStorageUri,r),c=new Ba(a),l=new Pt(c,n),u=new Ka(l,a,s,n,r);u.getWorkspacesWithChanges(),fu=new Ly(l,o,u);const h=new $I(l,u,fu,n),f=new Ik(t.globalStorageUri,l),p=new TR(l),b=new Qf(l,o,u,r);return t.subscriptions.push(Ye.onDidChange(w=>{!Ye.changed(w,"logLevel")||(K.logLevel=Ye.get("logLevel"))}),l.onDidChangeRepositories(async w=>{for(const y of w.added)try{const x=await y.getMetadata(),{HEAD:S,defaultBranch:I,name:D,provider:U,pullRequest:te}=x,J=S.name.replace(/\//g,"\u2009\u2215\u2009");let G=" ";if(te!==void 0)G=` (PR ${te.id}) `;else if(S.type===Le.Tag)G=` (${J}) `;else if(S.type===Le.Commit)G=` (${J}) `;else if(S.type===Le.Branch||S.type===Le.RemoteBranch){const re=S.branch.name.replace(/\//g,"\u2009\u2215\u2009");S.branch.name!==I.name&&(G=` (${re})`)}const ue={uri:y.uri,type:"folder",label:`${D}${G}[${U.name}]`};d.commands.executeCommand("_workbench.addToRecentlyOpened",ue)}catch(x){K.error(x,"Failed to add repository to recently opened")}}),new DI(l,u),new VE,new Hl(l,u),new OI(l,n),...jE(l,u,b,t.extension.id,n),...tD(l,u),...YI(l,u,h,f,t),new BI(l,u),new KI(l,b,u,r,n),f,b,h,fu,u,l,n),n.sendEvent("activate"),Promise.resolve(p)}catch(o){throw K.error(o),o}}function YI(t,e,r,n,i){const o=tb()?new RR(t):void 0;return[JI(t,e,o,r,n),...Ye.get("azureRepos.enabled")?[new go(i),eD(t,e,o)]:[]]}function JI(t,e,r,n,i){const o=new Wf(t,i),a=new ou(t,o,e,i);async function s(){var l;try{let u=(l=d.extensions.getExtension("GitHub.vscode-pull-request-github"))!=null?l:d.extensions.getExtension("GitHub.vscode-pull-request-github-insiders");u||(K.log("[ GHPR] Not currently installed or enabled; waiting..."),await new Promise(y=>{const x=d.extensions.onDidChange(()=>{var S;u=(S=d.extensions.getExtension("GitHub.vscode-pull-request-github"))!=null?S:d.extensions.getExtension("GitHub.vscode-pull-request-github-insiders"),u&&(x.dispose(),y())})})),K.log("[ GHPR] Registering..."),ui(Nn.HasPullRequestExtension,!0);const h=await u.activate();if(!h)throw new Error("Unable to get registration api");const f=h.registerGitProvider(n),p=t.onDidChangeRepositories(y=>b(y));async function b(y){const x=y.added.filter(S=>S.provider.id===wr.GitHub);if(x.length!==0){K.log("[ GHPR] Checking for opened PRs...");for(const S of x){const I=await t.getBestRemoteUri(S.uri,Gr.PullRequest);if(!!I){p.dispose(),K.log("[ GHPR] Opened PR found; preloading"),d.commands.executeCommand("github.api.preloadPullRequest",I.toString());return}}K.log("[ GHPR] No opened PRs found")}}K.log("[ GHPR] Registration complete");const w=t.repositories;return w.length&&b({added:w,removed:[]}),d.Disposable.from(f,p)}catch(u){return K.error(u,"[ GHPR] Registration failed;"),{dispose:()=>{}}}}const c=s();return d.Disposable.from(t.register(wr.GitHub,"GitHub",o,a,r),o,a,{dispose:async()=>{var l;return void((l=await c)==null?void 0:l.dispose())}})}function eD(t,e,r){const n=new a0(t),i=new kl(t,n,e);return d.Disposable.from(t.register(wr.AzureRepos,"Azure Repos",n,i,r),n,i)}function tD(t,e){if(!tb())return[];const r=new wR(t,e);return[r,r.register(new X0),...X0.createStatus()]}function tb(){return d.env.uiKind===d.UIKind.Desktop||Ye.get("richNavigation.enabled")===!0}})(),module.exports=__webpack_exports__})();
